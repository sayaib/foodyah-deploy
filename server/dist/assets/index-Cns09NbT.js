function RR(f,g){for(var w=0;w<g.length;w++){const S=g[w];if(typeof S!="string"&&!Array.isArray(S)){for(const A in S)if(A!=="default"&&!(A in f)){const L=Object.getOwnPropertyDescriptor(S,A);L&&Object.defineProperty(f,A,L.get?L:{enumerable:!0,get:()=>S[A]})}}}return Object.freeze(Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}))}(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const A of document.querySelectorAll('link[rel="modulepreload"]'))S(A);new MutationObserver(A=>{for(const L of A)if(L.type==="childList")for(const N of L.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&S(N)}).observe(document,{childList:!0,subtree:!0});function w(A){const L={};return A.integrity&&(L.integrity=A.integrity),A.referrerPolicy&&(L.referrerPolicy=A.referrerPolicy),A.crossOrigin==="use-credentials"?L.credentials="include":A.crossOrigin==="anonymous"?L.credentials="omit":L.credentials="same-origin",L}function S(A){if(A.ep)return;A.ep=!0;const L=w(A);fetch(A.href,L)}})();var hp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nb(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var Sx={exports:{}},N_={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lS;function DR(){if(lS)return N_;lS=1;var f=Symbol.for("react.transitional.element"),g=Symbol.for("react.fragment");function w(S,A,L){var N=null;if(L!==void 0&&(N=""+L),A.key!==void 0&&(N=""+A.key),"key"in A){L={};for(var r in A)r!=="key"&&(L[r]=A[r])}else L=A;return A=L.ref,{$$typeof:f,type:S,key:N,ref:A!==void 0?A:null,props:L}}return N_.Fragment=g,N_.jsx=w,N_.jsxs=w,N_}var cS;function PR(){return cS||(cS=1,Sx.exports=DR()),Sx.exports}var W=PR(),Ex={exports:{}},xr={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uS;function OR(){if(uS)return xr;uS=1;var f=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),L=Symbol.for("react.consumer"),N=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),B=Symbol.for("react.memo"),$=Symbol.for("react.lazy"),ie=Symbol.iterator;function re(Ve){return Ve===null||typeof Ve!="object"?null:(Ve=ie&&Ve[ie]||Ve["@@iterator"],typeof Ve=="function"?Ve:null)}var Te={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_e=Object.assign,me={};function ge(Ve,Dt,ti){this.props=Ve,this.context=Dt,this.refs=me,this.updater=ti||Te}ge.prototype.isReactComponent={},ge.prototype.setState=function(Ve,Dt){if(typeof Ve!="object"&&typeof Ve!="function"&&Ve!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ve,Dt,"setState")},ge.prototype.forceUpdate=function(Ve){this.updater.enqueueForceUpdate(this,Ve,"forceUpdate")};function pe(){}pe.prototype=ge.prototype;function fe(Ve,Dt,ti){this.props=Ve,this.context=Dt,this.refs=me,this.updater=ti||Te}var se=fe.prototype=new pe;se.constructor=fe,_e(se,ge.prototype),se.isPureReactComponent=!0;var De=Array.isArray,we={H:null,A:null,T:null,S:null,V:null},ht=Object.prototype.hasOwnProperty;function At(Ve,Dt,ti,li,Mi,at){return ti=at.ref,{$$typeof:f,type:Ve,key:Dt,ref:ti!==void 0?ti:null,props:at}}function gt(Ve,Dt){return At(Ve.type,Dt,void 0,void 0,void 0,Ve.props)}function Xe(Ve){return typeof Ve=="object"&&Ve!==null&&Ve.$$typeof===f}function je(Ve){var Dt={"=":"=0",":":"=2"};return"$"+Ve.replace(/[=:]/g,function(ti){return Dt[ti]})}var $e=/\/+/g;function It(Ve,Dt){return typeof Ve=="object"&&Ve!==null&&Ve.key!=null?je(""+Ve.key):Dt.toString(36)}function Lt(){}function ct(Ve){switch(Ve.status){case"fulfilled":return Ve.value;case"rejected":throw Ve.reason;default:switch(typeof Ve.status=="string"?Ve.then(Lt,Lt):(Ve.status="pending",Ve.then(function(Dt){Ve.status==="pending"&&(Ve.status="fulfilled",Ve.value=Dt)},function(Dt){Ve.status==="pending"&&(Ve.status="rejected",Ve.reason=Dt)})),Ve.status){case"fulfilled":return Ve.value;case"rejected":throw Ve.reason}}throw Ve}function Et(Ve,Dt,ti,li,Mi){var at=typeof Ve;(at==="undefined"||at==="boolean")&&(Ve=null);var Rt=!1;if(Ve===null)Rt=!0;else switch(at){case"bigint":case"string":case"number":Rt=!0;break;case"object":switch(Ve.$$typeof){case f:case g:Rt=!0;break;case $:return Rt=Ve._init,Et(Rt(Ve._payload),Dt,ti,li,Mi)}}if(Rt)return Mi=Mi(Ve),Rt=li===""?"."+It(Ve,0):li,De(Mi)?(ti="",Rt!=null&&(ti=Rt.replace($e,"$&/")+"/"),Et(Mi,Dt,ti,"",function(ei){return ei})):Mi!=null&&(Xe(Mi)&&(Mi=gt(Mi,ti+(Mi.key==null||Ve&&Ve.key===Mi.key?"":(""+Mi.key).replace($e,"$&/")+"/")+Rt)),Dt.push(Mi)),1;Rt=0;var _i=li===""?".":li+":";if(De(Ve))for(var Oi=0;Oi<Ve.length;Oi++)li=Ve[Oi],at=_i+It(li,Oi),Rt+=Et(li,Dt,ti,at,Mi);else if(Oi=re(Ve),typeof Oi=="function")for(Ve=Oi.call(Ve),Oi=0;!(li=Ve.next()).done;)li=li.value,at=_i+It(li,Oi++),Rt+=Et(li,Dt,ti,at,Mi);else if(at==="object"){if(typeof Ve.then=="function")return Et(ct(Ve),Dt,ti,li,Mi);throw Dt=String(Ve),Error("Objects are not valid as a React child (found: "+(Dt==="[object Object]"?"object with keys {"+Object.keys(Ve).join(", ")+"}":Dt)+"). If you meant to render a collection of children, use an array instead.")}return Rt}function Qe(Ve,Dt,ti){if(Ve==null)return Ve;var li=[],Mi=0;return Et(Ve,li,"","",function(at){return Dt.call(ti,at,Mi++)}),li}function kt(Ve){if(Ve._status===-1){var Dt=Ve._result;Dt=Dt(),Dt.then(function(ti){(Ve._status===0||Ve._status===-1)&&(Ve._status=1,Ve._result=ti)},function(ti){(Ve._status===0||Ve._status===-1)&&(Ve._status=2,Ve._result=ti)}),Ve._status===-1&&(Ve._status=0,Ve._result=Dt)}if(Ve._status===1)return Ve._result.default;throw Ve._result}var ii=typeof reportError=="function"?reportError:function(Ve){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Dt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Ve=="object"&&Ve!==null&&typeof Ve.message=="string"?String(Ve.message):String(Ve),error:Ve});if(!window.dispatchEvent(Dt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Ve);return}console.error(Ve)};function Li(){}return xr.Children={map:Qe,forEach:function(Ve,Dt,ti){Qe(Ve,function(){Dt.apply(this,arguments)},ti)},count:function(Ve){var Dt=0;return Qe(Ve,function(){Dt++}),Dt},toArray:function(Ve){return Qe(Ve,function(Dt){return Dt})||[]},only:function(Ve){if(!Xe(Ve))throw Error("React.Children.only expected to receive a single React element child.");return Ve}},xr.Component=ge,xr.Fragment=w,xr.Profiler=A,xr.PureComponent=fe,xr.StrictMode=S,xr.Suspense=F,xr.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=we,xr.__COMPILER_RUNTIME={__proto__:null,c:function(Ve){return we.H.useMemoCache(Ve)}},xr.cache=function(Ve){return function(){return Ve.apply(null,arguments)}},xr.cloneElement=function(Ve,Dt,ti){if(Ve==null)throw Error("The argument must be a React element, but you passed "+Ve+".");var li=_e({},Ve.props),Mi=Ve.key,at=void 0;if(Dt!=null)for(Rt in Dt.ref!==void 0&&(at=void 0),Dt.key!==void 0&&(Mi=""+Dt.key),Dt)!ht.call(Dt,Rt)||Rt==="key"||Rt==="__self"||Rt==="__source"||Rt==="ref"&&Dt.ref===void 0||(li[Rt]=Dt[Rt]);var Rt=arguments.length-2;if(Rt===1)li.children=ti;else if(1<Rt){for(var _i=Array(Rt),Oi=0;Oi<Rt;Oi++)_i[Oi]=arguments[Oi+2];li.children=_i}return At(Ve.type,Mi,void 0,void 0,at,li)},xr.createContext=function(Ve){return Ve={$$typeof:N,_currentValue:Ve,_currentValue2:Ve,_threadCount:0,Provider:null,Consumer:null},Ve.Provider=Ve,Ve.Consumer={$$typeof:L,_context:Ve},Ve},xr.createElement=function(Ve,Dt,ti){var li,Mi={},at=null;if(Dt!=null)for(li in Dt.key!==void 0&&(at=""+Dt.key),Dt)ht.call(Dt,li)&&li!=="key"&&li!=="__self"&&li!=="__source"&&(Mi[li]=Dt[li]);var Rt=arguments.length-2;if(Rt===1)Mi.children=ti;else if(1<Rt){for(var _i=Array(Rt),Oi=0;Oi<Rt;Oi++)_i[Oi]=arguments[Oi+2];Mi.children=_i}if(Ve&&Ve.defaultProps)for(li in Rt=Ve.defaultProps,Rt)Mi[li]===void 0&&(Mi[li]=Rt[li]);return At(Ve,at,void 0,void 0,null,Mi)},xr.createRef=function(){return{current:null}},xr.forwardRef=function(Ve){return{$$typeof:r,render:Ve}},xr.isValidElement=Xe,xr.lazy=function(Ve){return{$$typeof:$,_payload:{_status:-1,_result:Ve},_init:kt}},xr.memo=function(Ve,Dt){return{$$typeof:B,type:Ve,compare:Dt===void 0?null:Dt}},xr.startTransition=function(Ve){var Dt=we.T,ti={};we.T=ti;try{var li=Ve(),Mi=we.S;Mi!==null&&Mi(ti,li),typeof li=="object"&&li!==null&&typeof li.then=="function"&&li.then(Li,ii)}catch(at){ii(at)}finally{we.T=Dt}},xr.unstable_useCacheRefresh=function(){return we.H.useCacheRefresh()},xr.use=function(Ve){return we.H.use(Ve)},xr.useActionState=function(Ve,Dt,ti){return we.H.useActionState(Ve,Dt,ti)},xr.useCallback=function(Ve,Dt){return we.H.useCallback(Ve,Dt)},xr.useContext=function(Ve){return we.H.useContext(Ve)},xr.useDebugValue=function(){},xr.useDeferredValue=function(Ve,Dt){return we.H.useDeferredValue(Ve,Dt)},xr.useEffect=function(Ve,Dt,ti){var li=we.H;if(typeof ti=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return li.useEffect(Ve,Dt)},xr.useId=function(){return we.H.useId()},xr.useImperativeHandle=function(Ve,Dt,ti){return we.H.useImperativeHandle(Ve,Dt,ti)},xr.useInsertionEffect=function(Ve,Dt){return we.H.useInsertionEffect(Ve,Dt)},xr.useLayoutEffect=function(Ve,Dt){return we.H.useLayoutEffect(Ve,Dt)},xr.useMemo=function(Ve,Dt){return we.H.useMemo(Ve,Dt)},xr.useOptimistic=function(Ve,Dt){return we.H.useOptimistic(Ve,Dt)},xr.useReducer=function(Ve,Dt,ti){return we.H.useReducer(Ve,Dt,ti)},xr.useRef=function(Ve){return we.H.useRef(Ve)},xr.useState=function(Ve){return we.H.useState(Ve)},xr.useSyncExternalStore=function(Ve,Dt,ti){return we.H.useSyncExternalStore(Ve,Dt,ti)},xr.useTransition=function(){return we.H.useTransition()},xr.version="19.1.1",xr}var hS;function Fb(){return hS||(hS=1,Ex.exports=OR()),Ex.exports}var Re=Fb();const fp=Nb(Re),dS=RR({__proto__:null,default:fp},[Re]);var Ax={exports:{}},F_={},Cx={exports:{}},Mx={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fS;function LR(){return fS||(fS=1,function(f){function g(Qe,kt){var ii=Qe.length;Qe.push(kt);e:for(;0<ii;){var Li=ii-1>>>1,Ve=Qe[Li];if(0<A(Ve,kt))Qe[Li]=kt,Qe[ii]=Ve,ii=Li;else break e}}function w(Qe){return Qe.length===0?null:Qe[0]}function S(Qe){if(Qe.length===0)return null;var kt=Qe[0],ii=Qe.pop();if(ii!==kt){Qe[0]=ii;e:for(var Li=0,Ve=Qe.length,Dt=Ve>>>1;Li<Dt;){var ti=2*(Li+1)-1,li=Qe[ti],Mi=ti+1,at=Qe[Mi];if(0>A(li,ii))Mi<Ve&&0>A(at,li)?(Qe[Li]=at,Qe[Mi]=ii,Li=Mi):(Qe[Li]=li,Qe[ti]=ii,Li=ti);else if(Mi<Ve&&0>A(at,ii))Qe[Li]=at,Qe[Mi]=ii,Li=Mi;else break e}}return kt}function A(Qe,kt){var ii=Qe.sortIndex-kt.sortIndex;return ii!==0?ii:Qe.id-kt.id}if(f.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var L=performance;f.unstable_now=function(){return L.now()}}else{var N=Date,r=N.now();f.unstable_now=function(){return N.now()-r}}var F=[],B=[],$=1,ie=null,re=3,Te=!1,_e=!1,me=!1,ge=!1,pe=typeof setTimeout=="function"?setTimeout:null,fe=typeof clearTimeout=="function"?clearTimeout:null,se=typeof setImmediate<"u"?setImmediate:null;function De(Qe){for(var kt=w(B);kt!==null;){if(kt.callback===null)S(B);else if(kt.startTime<=Qe)S(B),kt.sortIndex=kt.expirationTime,g(F,kt);else break;kt=w(B)}}function we(Qe){if(me=!1,De(Qe),!_e)if(w(F)!==null)_e=!0,ht||(ht=!0,It());else{var kt=w(B);kt!==null&&Et(we,kt.startTime-Qe)}}var ht=!1,At=-1,gt=5,Xe=-1;function je(){return ge?!0:!(f.unstable_now()-Xe<gt)}function $e(){if(ge=!1,ht){var Qe=f.unstable_now();Xe=Qe;var kt=!0;try{e:{_e=!1,me&&(me=!1,fe(At),At=-1),Te=!0;var ii=re;try{t:{for(De(Qe),ie=w(F);ie!==null&&!(ie.expirationTime>Qe&&je());){var Li=ie.callback;if(typeof Li=="function"){ie.callback=null,re=ie.priorityLevel;var Ve=Li(ie.expirationTime<=Qe);if(Qe=f.unstable_now(),typeof Ve=="function"){ie.callback=Ve,De(Qe),kt=!0;break t}ie===w(F)&&S(F),De(Qe)}else S(F);ie=w(F)}if(ie!==null)kt=!0;else{var Dt=w(B);Dt!==null&&Et(we,Dt.startTime-Qe),kt=!1}}break e}finally{ie=null,re=ii,Te=!1}kt=void 0}}finally{kt?It():ht=!1}}}var It;if(typeof se=="function")It=function(){se($e)};else if(typeof MessageChannel<"u"){var Lt=new MessageChannel,ct=Lt.port2;Lt.port1.onmessage=$e,It=function(){ct.postMessage(null)}}else It=function(){pe($e,0)};function Et(Qe,kt){At=pe(function(){Qe(f.unstable_now())},kt)}f.unstable_IdlePriority=5,f.unstable_ImmediatePriority=1,f.unstable_LowPriority=4,f.unstable_NormalPriority=3,f.unstable_Profiling=null,f.unstable_UserBlockingPriority=2,f.unstable_cancelCallback=function(Qe){Qe.callback=null},f.unstable_forceFrameRate=function(Qe){0>Qe||125<Qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):gt=0<Qe?Math.floor(1e3/Qe):5},f.unstable_getCurrentPriorityLevel=function(){return re},f.unstable_next=function(Qe){switch(re){case 1:case 2:case 3:var kt=3;break;default:kt=re}var ii=re;re=kt;try{return Qe()}finally{re=ii}},f.unstable_requestPaint=function(){ge=!0},f.unstable_runWithPriority=function(Qe,kt){switch(Qe){case 1:case 2:case 3:case 4:case 5:break;default:Qe=3}var ii=re;re=Qe;try{return kt()}finally{re=ii}},f.unstable_scheduleCallback=function(Qe,kt,ii){var Li=f.unstable_now();switch(typeof ii=="object"&&ii!==null?(ii=ii.delay,ii=typeof ii=="number"&&0<ii?Li+ii:Li):ii=Li,Qe){case 1:var Ve=-1;break;case 2:Ve=250;break;case 5:Ve=1073741823;break;case 4:Ve=1e4;break;default:Ve=5e3}return Ve=ii+Ve,Qe={id:$++,callback:kt,priorityLevel:Qe,startTime:ii,expirationTime:Ve,sortIndex:-1},ii>Li?(Qe.sortIndex=ii,g(B,Qe),w(F)===null&&Qe===w(B)&&(me?(fe(At),At=-1):me=!0,Et(we,ii-Li))):(Qe.sortIndex=Ve,g(F,Qe),_e||Te||(_e=!0,ht||(ht=!0,It()))),Qe},f.unstable_shouldYield=je,f.unstable_wrapCallback=function(Qe){var kt=re;return function(){var ii=re;re=kt;try{return Qe.apply(this,arguments)}finally{re=ii}}}}(Mx)),Mx}var pS;function zR(){return pS||(pS=1,Cx.exports=LR()),Cx.exports}var Ix={exports:{}},ll={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mS;function kR(){if(mS)return ll;mS=1;var f=Fb();function g(F){var B="https://react.dev/errors/"+F;if(1<arguments.length){B+="?args[]="+encodeURIComponent(arguments[1]);for(var $=2;$<arguments.length;$++)B+="&args[]="+encodeURIComponent(arguments[$])}return"Minified React error #"+F+"; visit "+B+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function w(){}var S={d:{f:w,r:function(){throw Error(g(522))},D:w,C:w,L:w,m:w,X:w,S:w,M:w},p:0,findDOMNode:null},A=Symbol.for("react.portal");function L(F,B,$){var ie=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:A,key:ie==null?null:""+ie,children:F,containerInfo:B,implementation:$}}var N=f.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function r(F,B){if(F==="font")return"";if(typeof B=="string")return B==="use-credentials"?B:""}return ll.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,ll.createPortal=function(F,B){var $=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!B||B.nodeType!==1&&B.nodeType!==9&&B.nodeType!==11)throw Error(g(299));return L(F,B,null,$)},ll.flushSync=function(F){var B=N.T,$=S.p;try{if(N.T=null,S.p=2,F)return F()}finally{N.T=B,S.p=$,S.d.f()}},ll.preconnect=function(F,B){typeof F=="string"&&(B?(B=B.crossOrigin,B=typeof B=="string"?B==="use-credentials"?B:"":void 0):B=null,S.d.C(F,B))},ll.prefetchDNS=function(F){typeof F=="string"&&S.d.D(F)},ll.preinit=function(F,B){if(typeof F=="string"&&B&&typeof B.as=="string"){var $=B.as,ie=r($,B.crossOrigin),re=typeof B.integrity=="string"?B.integrity:void 0,Te=typeof B.fetchPriority=="string"?B.fetchPriority:void 0;$==="style"?S.d.S(F,typeof B.precedence=="string"?B.precedence:void 0,{crossOrigin:ie,integrity:re,fetchPriority:Te}):$==="script"&&S.d.X(F,{crossOrigin:ie,integrity:re,fetchPriority:Te,nonce:typeof B.nonce=="string"?B.nonce:void 0})}},ll.preinitModule=function(F,B){if(typeof F=="string")if(typeof B=="object"&&B!==null){if(B.as==null||B.as==="script"){var $=r(B.as,B.crossOrigin);S.d.M(F,{crossOrigin:$,integrity:typeof B.integrity=="string"?B.integrity:void 0,nonce:typeof B.nonce=="string"?B.nonce:void 0})}}else B==null&&S.d.M(F)},ll.preload=function(F,B){if(typeof F=="string"&&typeof B=="object"&&B!==null&&typeof B.as=="string"){var $=B.as,ie=r($,B.crossOrigin);S.d.L(F,$,{crossOrigin:ie,integrity:typeof B.integrity=="string"?B.integrity:void 0,nonce:typeof B.nonce=="string"?B.nonce:void 0,type:typeof B.type=="string"?B.type:void 0,fetchPriority:typeof B.fetchPriority=="string"?B.fetchPriority:void 0,referrerPolicy:typeof B.referrerPolicy=="string"?B.referrerPolicy:void 0,imageSrcSet:typeof B.imageSrcSet=="string"?B.imageSrcSet:void 0,imageSizes:typeof B.imageSizes=="string"?B.imageSizes:void 0,media:typeof B.media=="string"?B.media:void 0})}},ll.preloadModule=function(F,B){if(typeof F=="string")if(B){var $=r(B.as,B.crossOrigin);S.d.m(F,{as:typeof B.as=="string"&&B.as!=="script"?B.as:void 0,crossOrigin:$,integrity:typeof B.integrity=="string"?B.integrity:void 0})}else S.d.m(F)},ll.requestFormReset=function(F){S.d.r(F)},ll.unstable_batchedUpdates=function(F,B){return F(B)},ll.useFormState=function(F,B,$){return N.H.useFormState(F,B,$)},ll.useFormStatus=function(){return N.H.useHostTransitionStatus()},ll.version="19.1.1",ll}var gS;function xE(){if(gS)return Ix.exports;gS=1;function f(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(f)}catch(g){console.error(g)}}return f(),Ix.exports=kR(),Ix.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _S;function NR(){if(_S)return F_;_S=1;var f=zR(),g=Fb(),w=xE();function S(o){var d="https://react.dev/errors/"+o;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)d+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+o+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function A(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function L(o){var d=o,x=o;if(o.alternate)for(;d.return;)d=d.return;else{o=d;do d=o,(d.flags&4098)!==0&&(x=d.return),o=d.return;while(o)}return d.tag===3?x:null}function N(o){if(o.tag===13){var d=o.memoizedState;if(d===null&&(o=o.alternate,o!==null&&(d=o.memoizedState)),d!==null)return d.dehydrated}return null}function r(o){if(L(o)!==o)throw Error(S(188))}function F(o){var d=o.alternate;if(!d){if(d=L(o),d===null)throw Error(S(188));return d!==o?null:o}for(var x=o,M=d;;){var z=x.return;if(z===null)break;var q=z.alternate;if(q===null){if(M=z.return,M!==null){x=M;continue}break}if(z.child===q.child){for(q=z.child;q;){if(q===x)return r(z),o;if(q===M)return r(z),d;q=q.sibling}throw Error(S(188))}if(x.return!==M.return)x=z,M=q;else{for(var ue=!1,Oe=z.child;Oe;){if(Oe===x){ue=!0,x=z,M=q;break}if(Oe===M){ue=!0,M=z,x=q;break}Oe=Oe.sibling}if(!ue){for(Oe=q.child;Oe;){if(Oe===x){ue=!0,x=q,M=z;break}if(Oe===M){ue=!0,M=q,x=z;break}Oe=Oe.sibling}if(!ue)throw Error(S(189))}}if(x.alternate!==M)throw Error(S(190))}if(x.tag!==3)throw Error(S(188));return x.stateNode.current===x?o:d}function B(o){var d=o.tag;if(d===5||d===26||d===27||d===6)return o;for(o=o.child;o!==null;){if(d=B(o),d!==null)return d;o=o.sibling}return null}var $=Object.assign,ie=Symbol.for("react.element"),re=Symbol.for("react.transitional.element"),Te=Symbol.for("react.portal"),_e=Symbol.for("react.fragment"),me=Symbol.for("react.strict_mode"),ge=Symbol.for("react.profiler"),pe=Symbol.for("react.provider"),fe=Symbol.for("react.consumer"),se=Symbol.for("react.context"),De=Symbol.for("react.forward_ref"),we=Symbol.for("react.suspense"),ht=Symbol.for("react.suspense_list"),At=Symbol.for("react.memo"),gt=Symbol.for("react.lazy"),Xe=Symbol.for("react.activity"),je=Symbol.for("react.memo_cache_sentinel"),$e=Symbol.iterator;function It(o){return o===null||typeof o!="object"?null:(o=$e&&o[$e]||o["@@iterator"],typeof o=="function"?o:null)}var Lt=Symbol.for("react.client.reference");function ct(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===Lt?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case _e:return"Fragment";case ge:return"Profiler";case me:return"StrictMode";case we:return"Suspense";case ht:return"SuspenseList";case Xe:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case Te:return"Portal";case se:return(o.displayName||"Context")+".Provider";case fe:return(o._context.displayName||"Context")+".Consumer";case De:var d=o.render;return o=o.displayName,o||(o=d.displayName||d.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case At:return d=o.displayName||null,d!==null?d:ct(o.type)||"Memo";case gt:d=o._payload,o=o._init;try{return ct(o(d))}catch{}}return null}var Et=Array.isArray,Qe=g.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,kt=w.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ii={pending:!1,data:null,method:null,action:null},Li=[],Ve=-1;function Dt(o){return{current:o}}function ti(o){0>Ve||(o.current=Li[Ve],Li[Ve]=null,Ve--)}function li(o,d){Ve++,Li[Ve]=o.current,o.current=d}var Mi=Dt(null),at=Dt(null),Rt=Dt(null),_i=Dt(null);function Oi(o,d){switch(li(Rt,d),li(at,o),li(Mi,null),d.nodeType){case 9:case 11:o=(o=d.documentElement)&&(o=o.namespaceURI)?My(o):0;break;default:if(o=d.tagName,d=d.namespaceURI)d=My(d),o=Iy(d,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}ti(Mi),li(Mi,o)}function ei(){ti(Mi),ti(at),ti(Rt)}function hn(o){o.memoizedState!==null&&li(_i,o);var d=Mi.current,x=Iy(d,o.type);d!==x&&(li(at,o),li(Mi,x))}function In(o){at.current===o&&(ti(Mi),ti(at)),_i.current===o&&(ti(_i),ip._currentValue=ii)}var Rn=Object.prototype.hasOwnProperty,Qi=f.unstable_scheduleCallback,Zr=f.unstable_cancelCallback,Fn=f.unstable_shouldYield,Qr=f.unstable_requestPaint,gs=f.unstable_now,No=f.unstable_getCurrentPriorityLevel,Or=f.unstable_ImmediatePriority,Nr=f.unstable_UserBlockingPriority,Jr=f.unstable_NormalPriority,Ao=f.unstable_LowPriority,Ja=f.unstable_IdlePriority,Ns=f.log,hl=f.unstable_setDisableYieldValue,eo=null,Ur=null;function ka(o){if(typeof Ns=="function"&&hl(o),Ur&&typeof Ur.setStrictMode=="function")try{Ur.setStrictMode(eo,o)}catch{}}var _s=Math.clz32?Math.clz32:aa,Dl=Math.log,xs=Math.LN2;function aa(o){return o>>>=0,o===0?32:31-(Dl(o)/xs|0)|0}var Na=256,bs=4194304;function Os(o){var d=o&42;if(d!==0)return d;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function oa(o,d,x){var M=o.pendingLanes;if(M===0)return 0;var z=0,q=o.suspendedLanes,ue=o.pingedLanes;o=o.warmLanes;var Oe=M&134217727;return Oe!==0?(M=Oe&~q,M!==0?z=Os(M):(ue&=Oe,ue!==0?z=Os(ue):x||(x=Oe&~o,x!==0&&(z=Os(x))))):(Oe=M&~q,Oe!==0?z=Os(Oe):ue!==0?z=Os(ue):x||(x=M&~o,x!==0&&(z=Os(x)))),z===0?0:d!==0&&d!==z&&(d&q)===0&&(q=z&-z,x=d&-d,q>=x||q===32&&(x&4194048)!==0)?d:z}function _a(o,d){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&d)===0}function On(o,d){switch(o){case 1:case 2:case 4:case 8:case 64:return d+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ya(){var o=Na;return Na<<=1,(Na&4194048)===0&&(Na=256),o}function Co(){var o=bs;return bs<<=1,(bs&62914560)===0&&(bs=4194304),o}function Fs(o){for(var d=[],x=0;31>x;x++)d.push(o);return d}function dl(o,d){o.pendingLanes|=d,d!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function to(o,d,x,M,z,q){var ue=o.pendingLanes;o.pendingLanes=x,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=x,o.entangledLanes&=x,o.errorRecoveryDisabledLanes&=x,o.shellSuspendCounter=0;var Oe=o.entanglements,it=o.expirationTimes,Ft=o.hiddenUpdates;for(x=ue&~x;0<x;){var ui=31-_s(x),xi=1<<ui;Oe[ui]=0,it[ui]=-1;var jt=Ft[ui];if(jt!==null)for(Ft[ui]=null,ui=0;ui<jt.length;ui++){var qt=jt[ui];qt!==null&&(qt.lane&=-536870913)}x&=~xi}M!==0&&Fa(o,M,0),q!==0&&z===0&&o.tag!==0&&(o.suspendedLanes|=q&~(ue&~d))}function Fa(o,d,x){o.pendingLanes|=d,o.suspendedLanes&=~d;var M=31-_s(d);o.entangledLanes|=d,o.entanglements[M]=o.entanglements[M]|1073741824|x&4194090}function Qt(o,d){var x=o.entangledLanes|=d;for(o=o.entanglements;x;){var M=31-_s(x),z=1<<M;z&d|o[M]&d&&(o[M]|=d),x&=~z}}function io(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function va(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function xa(){var o=kt.p;return o!==0?o:(o=window.event,o===void 0?32:am(o.type))}function wn(o,d){var x=kt.p;try{return kt.p=o,d()}finally{kt.p=x}}var nt=Math.random().toString(36).slice(2),ee="__reactFiber$"+nt,ae="__reactProps$"+nt,xe="__reactContainer$"+nt,ke="__reactEvents$"+nt,Me="__reactListeners$"+nt,He="__reactHandles$"+nt,et="__reactResources$"+nt,Ue="__reactMarker$"+nt;function tt(o){delete o[ee],delete o[ae],delete o[ke],delete o[Me],delete o[He]}function vt(o){var d=o[ee];if(d)return d;for(var x=o.parentNode;x;){if(d=x[xe]||x[ee]){if(x=d.alternate,d.child!==null||x!==null&&x.child!==null)for(o=eg(o);o!==null;){if(x=o[ee])return x;o=eg(o)}return d}o=x,x=o.parentNode}return null}function rt(o){if(o=o[ee]||o[xe]){var d=o.tag;if(d===5||d===6||d===13||d===26||d===27||d===3)return o}return null}function Xt(o){var d=o.tag;if(d===5||d===26||d===27||d===6)return o.stateNode;throw Error(S(33))}function pi(o){var d=o[et];return d||(d=o[et]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function si(o){o[Ue]=!0}var Bi=new Set,Ni={};function Vi(o,d){Ji(o,d),Ji(o+"Capture",d)}function Ji(o,d){for(Ni[o]=d,o=0;o<d.length;o++)Bi.add(d[o])}var Yi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Hn={},ir={};function Vn(o){return Rn.call(ir,o)?!0:Rn.call(Hn,o)?!1:Yi.test(o)?ir[o]=!0:(Hn[o]=!0,!1)}function Mn(o,d,x){if(Vn(d))if(x===null)o.removeAttribute(d);else{switch(typeof x){case"undefined":case"function":case"symbol":o.removeAttribute(d);return;case"boolean":var M=d.toLowerCase().slice(0,5);if(M!=="data-"&&M!=="aria-"){o.removeAttribute(d);return}}o.setAttribute(d,""+x)}}function Tn(o,d,x){if(x===null)o.removeAttribute(d);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(d);return}o.setAttribute(d,""+x)}}function Xn(o,d,x,M){if(M===null)o.removeAttribute(x);else{switch(typeof M){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(x);return}o.setAttributeNS(d,x,""+M)}}var dr,fr;function Fr(o){if(dr===void 0)try{throw Error()}catch(x){var d=x.stack.trim().match(/\n( *(at )?)/);dr=d&&d[1]||"",fr=-1<x.stack.indexOf(`
    at`)?" (<anonymous>)":-1<x.stack.indexOf("@")?"@unknown:0:0":""}return`
`+dr+o+fr}var Bs=!1;function As(o,d){if(!o||Bs)return"";Bs=!0;var x=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var M={DetermineComponentFrameRoot:function(){try{if(d){var xi=function(){throw Error()};if(Object.defineProperty(xi.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(xi,[])}catch(qt){var jt=qt}Reflect.construct(o,[],xi)}else{try{xi.call()}catch(qt){jt=qt}o.call(xi.prototype)}}else{try{throw Error()}catch(qt){jt=qt}(xi=o())&&typeof xi.catch=="function"&&xi.catch(function(){})}}catch(qt){if(qt&&jt&&typeof qt.stack=="string")return[qt.stack,jt.stack]}return[null,null]}};M.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var z=Object.getOwnPropertyDescriptor(M.DetermineComponentFrameRoot,"name");z&&z.configurable&&Object.defineProperty(M.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var q=M.DetermineComponentFrameRoot(),ue=q[0],Oe=q[1];if(ue&&Oe){var it=ue.split(`
`),Ft=Oe.split(`
`);for(z=M=0;M<it.length&&!it[M].includes("DetermineComponentFrameRoot");)M++;for(;z<Ft.length&&!Ft[z].includes("DetermineComponentFrameRoot");)z++;if(M===it.length||z===Ft.length)for(M=it.length-1,z=Ft.length-1;1<=M&&0<=z&&it[M]!==Ft[z];)z--;for(;1<=M&&0<=z;M--,z--)if(it[M]!==Ft[z]){if(M!==1||z!==1)do if(M--,z--,0>z||it[M]!==Ft[z]){var ui=`
`+it[M].replace(" at new "," at ");return o.displayName&&ui.includes("<anonymous>")&&(ui=ui.replace("<anonymous>",o.displayName)),ui}while(1<=M&&0<=z);break}}}finally{Bs=!1,Error.prepareStackTrace=x}return(x=o?o.displayName||o.name:"")?Fr(x):""}function Ba(o){switch(o.tag){case 26:case 27:case 5:return Fr(o.type);case 16:return Fr("Lazy");case 13:return Fr("Suspense");case 19:return Fr("SuspenseList");case 0:case 15:return As(o.type,!1);case 11:return As(o.type.render,!1);case 1:return As(o.type,!0);case 31:return Fr("Activity");default:return""}}function hs(o){try{var d="";do d+=Ba(o),o=o.return;while(o);return d}catch(x){return`
Error generating stack: `+x.message+`
`+x.stack}}function Cs(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Pl(o){var d=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function fl(o){var d=Pl(o)?"checked":"value",x=Object.getOwnPropertyDescriptor(o.constructor.prototype,d),M=""+o[d];if(!o.hasOwnProperty(d)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var z=x.get,q=x.set;return Object.defineProperty(o,d,{configurable:!0,get:function(){return z.call(this)},set:function(ue){M=""+ue,q.call(this,ue)}}),Object.defineProperty(o,d,{enumerable:x.enumerable}),{getValue:function(){return M},setValue:function(ue){M=""+ue},stopTracking:function(){o._valueTracker=null,delete o[d]}}}}function Fo(o){o._valueTracker||(o._valueTracker=fl(o))}function Ol(o){if(!o)return!1;var d=o._valueTracker;if(!d)return!0;var x=d.getValue(),M="";return o&&(M=Pl(o)?o.checked?"true":"false":o.value),o=M,o!==x?(d.setValue(o),!0):!1}function no(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var Bo=/[\n"\\]/g;function rs(o){return o.replace(Bo,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function ja(o,d,x,M,z,q,ue,Oe){o.name="",ue!=null&&typeof ue!="function"&&typeof ue!="symbol"&&typeof ue!="boolean"?o.type=ue:o.removeAttribute("type"),d!=null?ue==="number"?(d===0&&o.value===""||o.value!=d)&&(o.value=""+Cs(d)):o.value!==""+Cs(d)&&(o.value=""+Cs(d)):ue!=="submit"&&ue!=="reset"||o.removeAttribute("value"),d!=null?Ys(o,ue,Cs(d)):x!=null?Ys(o,ue,Cs(x)):M!=null&&o.removeAttribute("value"),z==null&&q!=null&&(o.defaultChecked=!!q),z!=null&&(o.checked=z&&typeof z!="function"&&typeof z!="symbol"),Oe!=null&&typeof Oe!="function"&&typeof Oe!="symbol"&&typeof Oe!="boolean"?o.name=""+Cs(Oe):o.removeAttribute("name")}function ba(o,d,x,M,z,q,ue,Oe){if(q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(o.type=q),d!=null||x!=null){if(!(q!=="submit"&&q!=="reset"||d!=null))return;x=x!=null?""+Cs(x):"",d=d!=null?""+Cs(d):x,Oe||d===o.value||(o.value=d),o.defaultValue=d}M=M??z,M=typeof M!="function"&&typeof M!="symbol"&&!!M,o.checked=Oe?o.checked:!!M,o.defaultChecked=!!M,ue!=null&&typeof ue!="function"&&typeof ue!="symbol"&&typeof ue!="boolean"&&(o.name=ue)}function Ys(o,d,x){d==="number"&&no(o.ownerDocument)===o||o.defaultValue===""+x||(o.defaultValue=""+x)}function js(o,d,x,M){if(o=o.options,d){d={};for(var z=0;z<x.length;z++)d["$"+x[z]]=!0;for(x=0;x<o.length;x++)z=d.hasOwnProperty("$"+o[x].value),o[x].selected!==z&&(o[x].selected=z),z&&M&&(o[x].defaultSelected=!0)}else{for(x=""+Cs(x),d=null,z=0;z<o.length;z++){if(o[z].value===x){o[z].selected=!0,M&&(o[z].defaultSelected=!0);return}d!==null||o[z].disabled||(d=o[z])}d!==null&&(d.selected=!0)}}function po(o,d,x){if(d!=null&&(d=""+Cs(d),d!==o.value&&(o.value=d),x==null)){o.defaultValue!==d&&(o.defaultValue=d);return}o.defaultValue=x!=null?""+Cs(x):""}function wa(o,d,x,M){if(d==null){if(M!=null){if(x!=null)throw Error(S(92));if(Et(M)){if(1<M.length)throw Error(S(93));M=M[0]}x=M}x==null&&(x=""),d=x}x=Cs(d),o.defaultValue=x,M=o.textContent,M===x&&M!==""&&M!==null&&(o.value=M)}function Ks(o,d){if(d){var x=o.firstChild;if(x&&x===o.lastChild&&x.nodeType===3){x.nodeValue=d;return}}o.textContent=d}var hc=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ro(o,d,x){var M=d.indexOf("--")===0;x==null||typeof x=="boolean"||x===""?M?o.setProperty(d,""):d==="float"?o.cssFloat="":o[d]="":M?o.setProperty(d,x):typeof x!="number"||x===0||hc.has(d)?d==="float"?o.cssFloat=x:o[d]=(""+x).trim():o[d]=x+"px"}function pl(o,d,x){if(d!=null&&typeof d!="object")throw Error(S(62));if(o=o.style,x!=null){for(var M in x)!x.hasOwnProperty(M)||d!=null&&d.hasOwnProperty(M)||(M.indexOf("--")===0?o.setProperty(M,""):M==="float"?o.cssFloat="":o[M]="");for(var z in d)M=d[z],d.hasOwnProperty(z)&&x[z]!==M&&ro(o,z,M)}else for(var q in d)d.hasOwnProperty(q)&&ro(o,q,d[q])}function Va(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ua=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),_u=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ot(o){return _u.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}var Ht=null;function Si(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Sn=null,qn=null;function ys(o){var d=rt(o);if(d&&(o=d.stateNode)){var x=o[ae]||null;e:switch(o=d.stateNode,d.type){case"input":if(ja(o,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name),d=x.name,x.type==="radio"&&d!=null){for(x=o;x.parentNode;)x=x.parentNode;for(x=x.querySelectorAll('input[name="'+rs(""+d)+'"][type="radio"]'),d=0;d<x.length;d++){var M=x[d];if(M!==o&&M.form===o.form){var z=M[ae]||null;if(!z)throw Error(S(90));ja(M,z.value,z.defaultValue,z.defaultValue,z.checked,z.defaultChecked,z.type,z.name)}}for(d=0;d<x.length;d++)M=x[d],M.form===o.form&&Ol(M)}break e;case"textarea":po(o,x.value,x.defaultValue);break e;case"select":d=x.value,d!=null&&js(o,!!x.multiple,d,!1)}}}var Qs=!1;function Er(o,d,x){if(Qs)return o(d,x);Qs=!0;try{var M=o(d);return M}finally{if(Qs=!1,(Sn!==null||qn!==null)&&(au(),Sn&&(d=Sn,o=qn,qn=Sn=null,ys(d),o)))for(d=0;d<o.length;d++)ys(o[d])}}function en(o,d){var x=o.stateNode;if(x===null)return null;var M=x[ae]||null;if(M===null)return null;x=M[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(M=!M.disabled)||(o=o.type,M=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!M;break e;default:o=!1}if(o)return null;if(x&&typeof x!="function")throw Error(S(231,d,typeof x));return x}var ss=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ga=!1;if(ss)try{var ds={};Object.defineProperty(ds,"passive",{get:function(){Ga=!0}}),window.addEventListener("test",ds,ds),window.removeEventListener("test",ds,ds)}catch{Ga=!1}var mo=null,ml=null,Ta=null;function Sa(){if(Ta)return Ta;var o,d=ml,x=d.length,M,z="value"in mo?mo.value:mo.textContent,q=z.length;for(o=0;o<x&&d[o]===z[o];o++);var ue=x-o;for(M=1;M<=ue&&d[x-M]===z[q-M];M++);return Ta=z.slice(o,1<M?1-M:void 0)}function jo(o){var d=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&d===13&&(o=13)):o=d,o===10&&(o=13),32<=o||o===13?o:0}function so(){return!0}function Ha(){return!1}function Js(o){function d(x,M,z,q,ue){this._reactName=x,this._targetInst=z,this.type=M,this.nativeEvent=q,this.target=ue,this.currentTarget=null;for(var Oe in o)o.hasOwnProperty(Oe)&&(x=o[Oe],this[Oe]=x?x(q):q[Oe]);return this.isDefaultPrevented=(q.defaultPrevented!=null?q.defaultPrevented:q.returnValue===!1)?so:Ha,this.isPropagationStopped=Ha,this}return $(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var x=this.nativeEvent;x&&(x.preventDefault?x.preventDefault():typeof x.returnValue!="unknown"&&(x.returnValue=!1),this.isDefaultPrevented=so)},stopPropagation:function(){var x=this.nativeEvent;x&&(x.stopPropagation?x.stopPropagation():typeof x.cancelBubble!="unknown"&&(x.cancelBubble=!0),this.isPropagationStopped=so)},persist:function(){},isPersistent:so}),d}var Gs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vo=Js(Gs),qe=$({},Gs,{view:0,detail:0}),Tt=Js(qe),vi,Zi,Rr,Bn=$({},qe,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nd,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Rr&&(Rr&&o.type==="mousemove"?(vi=o.screenX-Rr.screenX,Zi=o.screenY-Rr.screenY):Zi=vi=0,Rr=o),vi)},movementY:function(o){return"movementY"in o?o.movementY:Zi}}),es=Js(Bn),fs=$({},Bn,{dataTransfer:0}),Br=Js(fs),as=$({},qe,{relatedTarget:0}),Ls=Js(as),ea=$({},Gs,{animationName:0,elapsedTime:0,pseudoElement:0}),ln=Js(ea),ws=$({},Gs,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),go=Js(ws),Uo=$({},Gs,{data:0}),zi=Js(Uo),Go={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Fc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ho={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function la(o){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(o):(o=Ho[o])?!!d[o]:!1}function nd(){return la}var nh=$({},qe,{key:function(o){if(o.key){var d=Go[o.key]||o.key;if(d!=="Unidentified")return d}return o.type==="keypress"?(o=jo(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?Fc[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nd,charCode:function(o){return o.type==="keypress"?jo(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?jo(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),Di=Js(nh),Yn=$({},Bn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Un=Js(Yn),_o=$({},qe,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nd}),dc=Js(_o),$n=$({},Gs,{propertyName:0,elapsedTime:0,pseudoElement:0}),df=Js($n),rd=$({},Bn,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),sd=Js(rd),qa=$({},Gs,{newState:0,oldState:0}),Ts=Js(qa),Bg=[9,13,27,32],Bc=ss&&"CompositionEvent"in window,qo=null;ss&&"documentMode"in document&&(qo=document.documentMode);var ad=ss&&"TextEvent"in window&&!qo,od=ss&&(!Bc||qo&&8<qo&&11>=qo),rh=" ",ld=!1;function Ea(o,d){switch(o){case"keyup":return Bg.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ll(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Hs=!1;function yu(o,d){switch(o){case"compositionend":return Ll(d);case"keypress":return d.which!==32?null:(ld=!0,rh);case"textInput":return o=d.data,o===rh&&ld?null:o;default:return null}}function cn(o,d){if(Hs)return o==="compositionend"||!Bc&&Ea(o,d)?(o=Sa(),Ta=ml=mo=null,Hs=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return od&&d.locale!=="ko"?null:d.data;default:return null}}var yi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mo(o){var d=o&&o.nodeName&&o.nodeName.toLowerCase();return d==="input"?!!yi[o.type]:d==="textarea"}function qi(o,d,x,M){Sn?qn?qn.push(M):qn=[M]:Sn=M,d=Kf(d,"onChange"),0<d.length&&(x=new Vo("onChange","change",null,x,M),o.push({event:x,listeners:d}))}var Wr=null,fc=null;function Fi(o){Sy(o,0)}function pc(o){var d=Xt(o);if(Ol(d))return o}function vu(o,d){if(o==="change")return d}var mc=!1;if(ss){var ff;if(ss){var yo="oninput"in document;if(!yo){var Aa=document.createElement("div");Aa.setAttribute("oninput","return;"),yo=typeof Aa.oninput=="function"}ff=yo}else ff=!1;mc=ff&&(!document.documentMode||9<document.documentMode)}function sh(){Wr&&(Wr.detachEvent("onpropertychange",Vs),fc=Wr=null)}function Vs(o){if(o.propertyName==="value"&&pc(fc)){var d=[];qi(d,fc,o,Si(o)),Er(Fi,d)}}function _p(o,d,x){o==="focusin"?(sh(),Wr=d,fc=x,Wr.attachEvent("onpropertychange",Vs)):o==="focusout"&&sh()}function zl(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return pc(fc)}function Ca(o,d){if(o==="click")return pc(d)}function cd(o,d){if(o==="input"||o==="change")return pc(d)}function jg(o,d){return o===d&&(o!==0||1/o===1/d)||o!==o&&d!==d}var Io=typeof Object.is=="function"?Object.is:jg;function $o(o,d){if(Io(o,d))return!0;if(typeof o!="object"||o===null||typeof d!="object"||d===null)return!1;var x=Object.keys(o),M=Object.keys(d);if(x.length!==M.length)return!1;for(M=0;M<x.length;M++){var z=x[M];if(!Rn.call(d,z)||!Io(o[z],d[z]))return!1}return!0}function xu(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function jc(o,d){var x=xu(o);o=0;for(var M;x;){if(x.nodeType===3){if(M=o+x.textContent.length,o<=d&&M>=d)return{node:x,offset:d-o};o=M}e:{for(;x;){if(x.nextSibling){x=x.nextSibling;break e}x=x.parentNode}x=void 0}x=xu(x)}}function bu(o,d){return o&&d?o===d?!0:o&&o.nodeType===3?!1:d&&d.nodeType===3?bu(o,d.parentNode):"contains"in o?o.contains(d):o.compareDocumentPosition?!!(o.compareDocumentPosition(d)&16):!1:!1}function yp(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var d=no(o.document);d instanceof o.HTMLIFrameElement;){try{var x=typeof d.contentWindow.location.href=="string"}catch{x=!1}if(x)o=d.contentWindow;else break;d=no(o.document)}return d}function ah(o){var d=o&&o.nodeName&&o.nodeName.toLowerCase();return d&&(d==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||d==="textarea"||o.contentEditable==="true")}var vp=ss&&"documentMode"in document&&11>=document.documentMode,vo=null,xp=null,ud=null,pf=!1;function bp(o,d,x){var M=x.window===x?x.document:x.nodeType===9?x:x.ownerDocument;pf||vo==null||vo!==no(M)||(M=vo,"selectionStart"in M&&ah(M)?M={start:M.selectionStart,end:M.selectionEnd}:(M=(M.ownerDocument&&M.ownerDocument.defaultView||window).getSelection(),M={anchorNode:M.anchorNode,anchorOffset:M.anchorOffset,focusNode:M.focusNode,focusOffset:M.focusOffset}),ud&&$o(ud,M)||(ud=M,M=Kf(xp,"onSelect"),0<M.length&&(d=new Vo("onSelect","select",null,d,x),o.push({event:d,listeners:M}),d.target=vo)))}function Ro(o,d){var x={};return x[o.toLowerCase()]=d.toLowerCase(),x["Webkit"+o]="webkit"+d,x["Moz"+o]="moz"+d,x}var Vc={animationend:Ro("Animation","AnimationEnd"),animationiteration:Ro("Animation","AnimationIteration"),animationstart:Ro("Animation","AnimationStart"),transitionrun:Ro("Transition","TransitionRun"),transitionstart:Ro("Transition","TransitionStart"),transitioncancel:Ro("Transition","TransitionCancel"),transitionend:Ro("Transition","TransitionEnd")},mf={},hd={};ss&&(hd=document.createElement("div").style,"AnimationEvent"in window||(delete Vc.animationend.animation,delete Vc.animationiteration.animation,delete Vc.animationstart.animation),"TransitionEvent"in window||delete Vc.transitionend.transition);function gc(o){if(mf[o])return mf[o];if(!Vc[o])return o;var d=Vc[o],x;for(x in d)if(d.hasOwnProperty(x)&&x in hd)return mf[o]=d[x];return o}var gf=gc("animationend"),ca=gc("animationiteration"),oh=gc("animationstart"),wp=gc("transitionrun"),Tp=gc("transitionstart"),lh=gc("transitioncancel"),wu=gc("transitionend"),_f=new Map,ch="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ch.push("scrollEnd");function Ms(o,d){_f.set(o,d),Vi(d,[o])}var dd=new WeakMap;function Kt(o,d){if(typeof o=="object"&&o!==null){var x=dd.get(o);return x!==void 0?x:(d={value:o,source:d,stack:hs(d)},dd.set(o,d),d)}return{value:o,source:d,stack:hs(d)}}var xo=[],gl=0,Uc=0;function Gc(){for(var o=gl,d=Uc=gl=0;d<o;){var x=xo[d];xo[d++]=null;var M=xo[d];xo[d++]=null;var z=xo[d];xo[d++]=null;var q=xo[d];if(xo[d++]=null,M!==null&&z!==null){var ue=M.pending;ue===null?z.next=z:(z.next=ue.next,ue.next=z),M.pending=z}q!==0&&Do(x,z,q)}}function Hc(o,d,x,M){xo[gl++]=o,xo[gl++]=d,xo[gl++]=x,xo[gl++]=M,Uc|=M,o.lanes|=M,o=o.alternate,o!==null&&(o.lanes|=M)}function Zo(o,d,x,M){return Hc(o,d,x,M),mn(o)}function _c(o,d){return Hc(o,null,null,d),mn(o)}function Do(o,d,x){o.lanes|=x;var M=o.alternate;M!==null&&(M.lanes|=x);for(var z=!1,q=o.return;q!==null;)q.childLanes|=x,M=q.alternate,M!==null&&(M.childLanes|=x),q.tag===22&&(o=q.stateNode,o===null||o._visibility&1||(z=!0)),o=q,q=q.return;return o.tag===3?(q=o.stateNode,z&&d!==null&&(z=31-_s(x),o=q.hiddenUpdates,M=o[z],M===null?o[z]=[d]:M.push(d),d.lane=x|536870912),q):null}function mn(o){if(50<Za)throw Za=0,Ra=null,Error(S(185));for(var d=o.return;d!==null;)o=d,d=o.return;return o.tag===3?o.stateNode:null}var _l={};function Vg(o,d,x,M){this.tag=o,this.key=x,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=M,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Po(o,d,x,M){return new Vg(o,d,x,M)}function uh(o){return o=o.prototype,!(!o||!o.isReactComponent)}function yc(o,d){var x=o.alternate;return x===null?(x=Po(o.tag,d,o.key,o.mode),x.elementType=o.elementType,x.type=o.type,x.stateNode=o.stateNode,x.alternate=o,o.alternate=x):(x.pendingProps=d,x.type=o.type,x.flags=0,x.subtreeFlags=0,x.deletions=null),x.flags=o.flags&65011712,x.childLanes=o.childLanes,x.lanes=o.lanes,x.child=o.child,x.memoizedProps=o.memoizedProps,x.memoizedState=o.memoizedState,x.updateQueue=o.updateQueue,d=o.dependencies,x.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},x.sibling=o.sibling,x.index=o.index,x.ref=o.ref,x.refCleanup=o.refCleanup,x}function Dr(o,d){o.flags&=65011714;var x=o.alternate;return x===null?(o.childLanes=0,o.lanes=d,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=x.childLanes,o.lanes=x.lanes,o.child=x.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=x.memoizedProps,o.memoizedState=x.memoizedState,o.updateQueue=x.updateQueue,o.type=x.type,d=x.dependencies,o.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),o}function fd(o,d,x,M,z,q){var ue=0;if(M=o,typeof o=="function")uh(o)&&(ue=1);else if(typeof o=="string")ue=M0(o,x,Mi.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case Xe:return o=Po(31,x,d,z),o.elementType=Xe,o.lanes=q,o;case _e:return vc(x.children,z,q,d);case me:ue=8,z|=24;break;case ge:return o=Po(12,x,d,z|2),o.elementType=ge,o.lanes=q,o;case we:return o=Po(13,x,d,z),o.elementType=we,o.lanes=q,o;case ht:return o=Po(19,x,d,z),o.elementType=ht,o.lanes=q,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case pe:case se:ue=10;break e;case fe:ue=9;break e;case De:ue=11;break e;case At:ue=14;break e;case gt:ue=16,M=null;break e}ue=29,x=Error(S(130,o===null?"null":typeof o,"")),M=null}return d=Po(ue,x,d,z),d.elementType=o,d.type=M,d.lanes=q,d}function vc(o,d,x,M){return o=Po(7,o,M,d),o.lanes=x,o}function Sp(o,d,x){return o=Po(6,o,null,d),o.lanes=x,o}function Ep(o,d,x){return d=Po(4,o.children!==null?o.children:[],o.key,d),d.lanes=x,d.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},d}var hh=[],dh=0,pd=null,yf=0,ao=[],Wo=0,qc=null,yl=1,Xo="";function xc(o,d){hh[dh++]=yf,hh[dh++]=pd,pd=o,yf=d}function $c(o,d,x){ao[Wo++]=yl,ao[Wo++]=Xo,ao[Wo++]=qc,qc=o;var M=yl;o=Xo;var z=32-_s(M)-1;M&=~(1<<z),x+=1;var q=32-_s(d)+z;if(30<q){var ue=z-z%5;q=(M&(1<<ue)-1).toString(32),M>>=ue,z-=ue,yl=1<<32-_s(d)+z|x<<z|M,Xo=q+o}else yl=1<<q|x<<z|M,Xo=o}function Zc(o){o.return!==null&&(xc(o,1),$c(o,1,0))}function fh(o){for(;o===pd;)pd=hh[--dh],hh[dh]=null,yf=hh[--dh],hh[dh]=null;for(;o===qc;)qc=ao[--Wo],ao[Wo]=null,Xo=ao[--Wo],ao[Wo]=null,yl=ao[--Wo],ao[Wo]=null}var ua=null,os=null,jr=!1,bc=null,vl=!1,Wc=Error(S(519));function kl(o){var d=Error(S(418,""));throw ph(Kt(d,o)),Wc}function md(o){var d=o.stateNode,x=o.type,M=o.memoizedProps;switch(d[ee]=o,d[ae]=M,x){case"dialog":br("cancel",d),br("close",d);break;case"iframe":case"object":case"embed":br("load",d);break;case"video":case"audio":for(x=0;x<Xf.length;x++)br(Xf[x],d);break;case"source":br("error",d);break;case"img":case"image":case"link":br("error",d),br("load",d);break;case"details":br("toggle",d);break;case"input":br("invalid",d),ba(d,M.value,M.defaultValue,M.checked,M.defaultChecked,M.type,M.name,!0),Fo(d);break;case"select":br("invalid",d);break;case"textarea":br("invalid",d),wa(d,M.value,M.defaultValue,M.children),Fo(d)}x=M.children,typeof x!="string"&&typeof x!="number"&&typeof x!="bigint"||d.textContent===""+x||M.suppressHydrationWarning===!0||Cy(d.textContent,x)?(M.popover!=null&&(br("beforetoggle",d),br("toggle",d)),M.onScroll!=null&&br("scroll",d),M.onScrollEnd!=null&&br("scrollend",d),M.onClick!=null&&(d.onclick=Wm),d=!0):d=!1,d||kl(o)}function vf(o){for(ua=o.return;ua;)switch(ua.tag){case 5:case 13:vl=!1;return;case 27:case 3:vl=!0;return;default:ua=ua.return}}function Xc(o){if(o!==ua)return!1;if(!jr)return vf(o),jr=!0,!1;var d=o.tag,x;if((x=d!==3&&d!==27)&&((x=d===5)&&(x=o.type,x=!(x!=="form"&&x!=="button")||i_(o.type,o.memoizedProps)),x=!x),x&&os&&kl(o),vf(o),d===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(S(317));e:{for(o=o.nextSibling,d=0;o;){if(o.nodeType===8)if(x=o.data,x==="/$"){if(d===0){os=oc(o.nextSibling);break e}d--}else x!=="$"&&x!=="$!"&&x!=="$?"||d++;o=o.nextSibling}os=null}}else d===27?(d=os,is(o.type)?(o=Xd,Xd=null,os=o):os=d):os=ua?oc(o.stateNode.nextSibling):null;return!0}function wc(){os=ua=null,jr=!1}function Ap(){var o=bc;return o!==null&&(ar===null?ar=o:ar.push.apply(ar,o),bc=null),o}function ph(o){bc===null?bc=[o]:bc.push(o)}var xf=Dt(null),bo=null,Nl=null;function Tc(o,d,x){li(xf,d._currentValue),d._currentValue=x}function Sc(o){o._currentValue=xf.current,ti(xf)}function Cp(o,d,x){for(;o!==null;){var M=o.alternate;if((o.childLanes&d)!==d?(o.childLanes|=d,M!==null&&(M.childLanes|=d)):M!==null&&(M.childLanes&d)!==d&&(M.childLanes|=d),o===x)break;o=o.return}}function gd(o,d,x,M){var z=o.child;for(z!==null&&(z.return=o);z!==null;){var q=z.dependencies;if(q!==null){var ue=z.child;q=q.firstContext;e:for(;q!==null;){var Oe=q;q=z;for(var it=0;it<d.length;it++)if(Oe.context===d[it]){q.lanes|=x,Oe=q.alternate,Oe!==null&&(Oe.lanes|=x),Cp(q.return,x,o),M||(ue=null);break e}q=Oe.next}}else if(z.tag===18){if(ue=z.return,ue===null)throw Error(S(341));ue.lanes|=x,q=ue.alternate,q!==null&&(q.lanes|=x),Cp(ue,x,o),ue=null}else ue=z.child;if(ue!==null)ue.return=z;else for(ue=z;ue!==null;){if(ue===o){ue=null;break}if(z=ue.sibling,z!==null){z.return=ue.return,ue=z;break}ue=ue.return}z=ue}}function Yc(o,d,x,M){o=null;for(var z=d,q=!1;z!==null;){if(!q){if((z.flags&524288)!==0)q=!0;else if((z.flags&262144)!==0)break}if(z.tag===10){var ue=z.alternate;if(ue===null)throw Error(S(387));if(ue=ue.memoizedProps,ue!==null){var Oe=z.type;Io(z.pendingProps.value,ue.value)||(o!==null?o.push(Oe):o=[Oe])}}else if(z===_i.current){if(ue=z.alternate,ue===null)throw Error(S(387));ue.memoizedState.memoizedState!==z.memoizedState.memoizedState&&(o!==null?o.push(ip):o=[ip])}z=z.return}o!==null&&gd(d,o,x,M),d.flags|=262144}function Tu(o){for(o=o.firstContext;o!==null;){if(!Io(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function wo(o){bo=o,Nl=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function ha(o){return Rm(bo,o)}function mh(o,d){return bo===null&&wo(o),Rm(o,d)}function Rm(o,d){var x=d._currentValue;if(d={context:d,memoizedValue:x,next:null},Nl===null){if(o===null)throw Error(S(308));Nl=d,o.dependencies={lanes:0,firstContext:d},o.flags|=524288}else Nl=Nl.next=d;return x}var Su=typeof AbortController<"u"?AbortController:function(){var o=[],d=this.signal={aborted:!1,addEventListener:function(x,M){o.push(M)}};this.abort=function(){d.aborted=!0,o.forEach(function(x){return x()})}},Eu=f.unstable_scheduleCallback,Dm=f.unstable_NormalPriority,Gr={$$typeof:se,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function gh(){return{controller:new Su,data:new Map,refCount:0}}function Ec(o){o.refCount--,o.refCount===0&&Eu(Dm,function(){o.controller.abort()})}var Kc=null,_d=0,Qc=0,Ac=null;function yd(o,d){if(Kc===null){var x=Kc=[];_d=0,Qc=Qp(),Ac={status:"pending",value:void 0,then:function(M){x.push(M)}}}return _d++,d.then(Au,Au),d}function Au(){if(--_d===0&&Kc!==null){Ac!==null&&(Ac.status="fulfilled");var o=Kc;Kc=null,Qc=0,Ac=null;for(var d=0;d<o.length;d++)(0,o[d])()}}function Mp(o,d){var x=[],M={status:"pending",value:null,reason:null,then:function(z){x.push(z)}};return o.then(function(){M.status="fulfilled",M.value=d;for(var z=0;z<x.length;z++)(0,x[z])(d)},function(z){for(M.status="rejected",M.reason=z,z=0;z<x.length;z++)(0,x[z])(void 0)}),M}var _h=Qe.S;Qe.S=function(o,d){typeof d=="object"&&d!==null&&typeof d.then=="function"&&yd(o,d),_h!==null&&_h(o,d)};var Jc=Dt(null);function bf(){var o=Jc.current;return o!==null?o:Ci.pooledCache}function Fl(o,d){d===null?li(Jc,Jc.current):li(Jc,d.pool)}function Ip(){var o=bf();return o===null?null:{parent:Gr._currentValue,pool:o}}var vd=Error(S(460)),Pm=Error(S(474)),wf=Error(S(542)),yh={then:function(){}};function Om(o){return o=o.status,o==="fulfilled"||o==="rejected"}function Cu(){}function Tf(o,d,x){switch(x=o[x],x===void 0?o.push(d):x!==d&&(d.then(Cu,Cu),d=x),d.status){case"fulfilled":return d.value;case"rejected":throw o=d.reason,Sf(o),o;default:if(typeof d.status=="string")d.then(Cu,Cu);else{if(o=Ci,o!==null&&100<o.shellSuspendCounter)throw Error(S(482));o=d,o.status="pending",o.then(function(M){if(d.status==="pending"){var z=d;z.status="fulfilled",z.value=M}},function(M){if(d.status==="pending"){var z=d;z.status="rejected",z.reason=M}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw o=d.reason,Sf(o),o}throw vh=d,vd}}var vh=null;function eu(){if(vh===null)throw Error(S(459));var o=vh;return vh=null,o}function Sf(o){if(o===vd||o===wf)throw Error(S(483))}var Bl=!1;function Ef(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function jl(o,d){o=o.updateQueue,d.updateQueue===o&&(d.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function To(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function Cc(o,d,x){var M=o.updateQueue;if(M===null)return null;if(M=M.shared,(fi&2)!==0){var z=M.pending;return z===null?d.next=d:(d.next=z.next,z.next=d),M.pending=d,d=mn(o),Do(o,null,x),d}return Hc(o,M,d,x),mn(o)}function Yo(o,d,x){if(d=d.updateQueue,d!==null&&(d=d.shared,(x&4194048)!==0)){var M=d.lanes;M&=o.pendingLanes,x|=M,d.lanes=x,Qt(o,x)}}function xh(o,d){var x=o.updateQueue,M=o.alternate;if(M!==null&&(M=M.updateQueue,x===M)){var z=null,q=null;if(x=x.firstBaseUpdate,x!==null){do{var ue={lane:x.lane,tag:x.tag,payload:x.payload,callback:null,next:null};q===null?z=q=ue:q=q.next=ue,x=x.next}while(x!==null);q===null?z=q=d:q=q.next=d}else z=q=d;x={baseState:M.baseState,firstBaseUpdate:z,lastBaseUpdate:q,shared:M.shared,callbacks:M.callbacks},o.updateQueue=x;return}o=x.lastBaseUpdate,o===null?x.firstBaseUpdate=d:o.next=d,x.lastBaseUpdate=d}var Mu=!1;function Iu(){if(Mu){var o=Ac;if(o!==null)throw o}}function Ru(o,d,x,M){Mu=!1;var z=o.updateQueue;Bl=!1;var q=z.firstBaseUpdate,ue=z.lastBaseUpdate,Oe=z.shared.pending;if(Oe!==null){z.shared.pending=null;var it=Oe,Ft=it.next;it.next=null,ue===null?q=Ft:ue.next=Ft,ue=it;var ui=o.alternate;ui!==null&&(ui=ui.updateQueue,Oe=ui.lastBaseUpdate,Oe!==ue&&(Oe===null?ui.firstBaseUpdate=Ft:Oe.next=Ft,ui.lastBaseUpdate=it))}if(q!==null){var xi=z.baseState;ue=0,ui=Ft=it=null,Oe=q;do{var jt=Oe.lane&-536870913,qt=jt!==Oe.lane;if(qt?($i&jt)===jt:(M&jt)===jt){jt!==0&&jt===Qc&&(Mu=!0),ui!==null&&(ui=ui.next={lane:0,tag:Oe.tag,payload:Oe.payload,callback:null,next:null});e:{var zn=o,Dn=Oe;jt=d;var Yr=x;switch(Dn.tag){case 1:if(zn=Dn.payload,typeof zn=="function"){xi=zn.call(Yr,xi,jt);break e}xi=zn;break e;case 3:zn.flags=zn.flags&-65537|128;case 0:if(zn=Dn.payload,jt=typeof zn=="function"?zn.call(Yr,xi,jt):zn,jt==null)break e;xi=$({},xi,jt);break e;case 2:Bl=!0}}jt=Oe.callback,jt!==null&&(o.flags|=64,qt&&(o.flags|=8192),qt=z.callbacks,qt===null?z.callbacks=[jt]:qt.push(jt))}else qt={lane:jt,tag:Oe.tag,payload:Oe.payload,callback:Oe.callback,next:null},ui===null?(Ft=ui=qt,it=xi):ui=ui.next=qt,ue|=jt;if(Oe=Oe.next,Oe===null){if(Oe=z.shared.pending,Oe===null)break;qt=Oe,Oe=qt.next,qt.next=null,z.lastBaseUpdate=qt,z.shared.pending=null}}while(!0);ui===null&&(it=xi),z.baseState=it,z.firstBaseUpdate=Ft,z.lastBaseUpdate=ui,q===null&&(z.shared.lanes=0),Zn|=ue,o.lanes=ue,o.memoizedState=xi}}function bh(o,d){if(typeof o!="function")throw Error(S(191,o));o.call(d)}function wh(o,d){var x=o.callbacks;if(x!==null)for(o.callbacks=null,o=0;o<x.length;o++)bh(x[o],d)}var Du=Dt(null),xd=Dt(0);function Oo(o,d){o=Wi,li(xd,o),li(Du,d),Wi=o|d.baseLanes}function Rp(){li(xd,Wi),li(Du,Du.current)}function Dp(){Wi=xd.current,ti(Du),ti(xd)}var Vl=0,cr=null,Lr=null,Is=null,Ko=!1,Ul=!1,xl=!1,bd=0,Gl=0,bl=null,Af=0;function Rs(){throw Error(S(321))}function wd(o,d){if(d===null)return!1;for(var x=0;x<d.length&&x<o.length;x++)if(!Io(o[x],d[x]))return!1;return!0}function wl(o,d,x,M,z,q){return Vl=q,cr=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,Qe.H=o===null||o.memoizedState===null?Of:Dd,xl=!1,q=x(M,z),xl=!1,Ul&&(q=mi(d,x,M,z)),Hl(o),q}function Hl(o){Qe.H=Tl;var d=Lr!==null&&Lr.next!==null;if(Vl=0,Is=Lr=cr=null,Ko=!1,Gl=0,bl=null,d)throw Error(S(300));o===null||ia||(o=o.dependencies,o!==null&&Tu(o)&&(ia=!0))}function mi(o,d,x,M){cr=o;var z=0;do{if(Ul&&(bl=null),Gl=0,Ul=!1,25<=z)throw Error(S(301));if(z+=1,Is=Lr=null,o.updateQueue!=null){var q=o.updateQueue;q.lastEffect=null,q.events=null,q.stores=null,q.memoCache!=null&&(q.memoCache.index=0)}Qe.H=Rh,q=d(x,M)}while(Ul);return q}function Lm(){var o=Qe.H,d=o.useState()[0];return d=typeof d.then=="function"?Td(d):d,o=o.useState()[0],(Lr!==null?Lr.memoizedState:null)!==o&&(cr.flags|=1024),d}function Cf(){var o=bd!==0;return bd=0,o}function ql(o,d,x){d.updateQueue=o.updateQueue,d.flags&=-2053,o.lanes&=~x}function $l(o){if(Ko){for(o=o.memoizedState;o!==null;){var d=o.queue;d!==null&&(d.pending=null),o=o.next}Ko=!1}Vl=0,Is=Lr=cr=null,Ul=!1,Gl=bd=0,bl=null}function Ii(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Is===null?cr.memoizedState=Is=o:Is=Is.next=o,Is}function Ss(){if(Lr===null){var o=cr.alternate;o=o!==null?o.memoizedState:null}else o=Lr.next;var d=Is===null?cr.memoizedState:Is.next;if(d!==null)Is=d,Lr=o;else{if(o===null)throw cr.alternate===null?Error(S(467)):Error(S(310));Lr=o,o={memoizedState:Lr.memoizedState,baseState:Lr.baseState,baseQueue:Lr.baseQueue,queue:Lr.queue,next:null},Is===null?cr.memoizedState=Is=o:Is=Is.next=o}return Is}function Pp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Td(o){var d=Gl;return Gl+=1,bl===null&&(bl=[]),o=Tf(bl,o,d),d=cr,(Is===null?d.memoizedState:Is.next)===null&&(d=d.alternate,Qe.H=d===null||d.memoizedState===null?Of:Dd),o}function Th(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return Td(o);if(o.$$typeof===se)return ha(o)}throw Error(S(438,String(o)))}function Mf(o){var d=null,x=cr.updateQueue;if(x!==null&&(d=x.memoCache),d==null){var M=cr.alternate;M!==null&&(M=M.updateQueue,M!==null&&(M=M.memoCache,M!=null&&(d={data:M.data.map(function(z){return z.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),x===null&&(x=Pp(),cr.updateQueue=x),x.memoCache=d,x=d.data[d.index],x===void 0)for(x=d.data[d.index]=Array(o),M=0;M<o;M++)x[M]=je;return d.index++,x}function Mc(o,d){return typeof d=="function"?d(o):d}function Sd(o){var d=Ss();return Op(d,Lr,o)}function Op(o,d,x){var M=o.queue;if(M===null)throw Error(S(311));M.lastRenderedReducer=x;var z=o.baseQueue,q=M.pending;if(q!==null){if(z!==null){var ue=z.next;z.next=q.next,q.next=ue}d.baseQueue=z=q,M.pending=null}if(q=o.baseState,z===null)o.memoizedState=q;else{d=z.next;var Oe=ue=null,it=null,Ft=d,ui=!1;do{var xi=Ft.lane&-536870913;if(xi!==Ft.lane?($i&xi)===xi:(Vl&xi)===xi){var jt=Ft.revertLane;if(jt===0)it!==null&&(it=it.next={lane:0,revertLane:0,action:Ft.action,hasEagerState:Ft.hasEagerState,eagerState:Ft.eagerState,next:null}),xi===Qc&&(ui=!0);else if((Vl&jt)===jt){Ft=Ft.next,jt===Qc&&(ui=!0);continue}else xi={lane:0,revertLane:Ft.revertLane,action:Ft.action,hasEagerState:Ft.hasEagerState,eagerState:Ft.eagerState,next:null},it===null?(Oe=it=xi,ue=q):it=it.next=xi,cr.lanes|=jt,Zn|=jt;xi=Ft.action,xl&&x(q,xi),q=Ft.hasEagerState?Ft.eagerState:x(q,xi)}else jt={lane:xi,revertLane:Ft.revertLane,action:Ft.action,hasEagerState:Ft.hasEagerState,eagerState:Ft.eagerState,next:null},it===null?(Oe=it=jt,ue=q):it=it.next=jt,cr.lanes|=xi,Zn|=xi;Ft=Ft.next}while(Ft!==null&&Ft!==d);if(it===null?ue=q:it.next=Oe,!Io(q,o.memoizedState)&&(ia=!0,ui&&(x=Ac,x!==null)))throw x;o.memoizedState=q,o.baseState=ue,o.baseQueue=it,M.lastRenderedState=q}return z===null&&(M.lanes=0),[o.memoizedState,M.dispatch]}function Lp(o){var d=Ss(),x=d.queue;if(x===null)throw Error(S(311));x.lastRenderedReducer=o;var M=x.dispatch,z=x.pending,q=d.memoizedState;if(z!==null){x.pending=null;var ue=z=z.next;do q=o(q,ue.action),ue=ue.next;while(ue!==z);Io(q,d.memoizedState)||(ia=!0),d.memoizedState=q,d.baseQueue===null&&(d.baseState=q),x.lastRenderedState=q}return[q,M]}function oo(o,d,x){var M=cr,z=Ss(),q=jr;if(q){if(x===void 0)throw Error(S(407));x=x()}else x=d();var ue=!Io((Lr||z).memoizedState,x);ue&&(z.memoizedState=x,ia=!0),z=z.queue;var Oe=Zl.bind(null,M,z,o);if(lo(2048,8,Oe,[o]),z.getSnapshot!==d||ue||Is!==null&&Is.memoizedState.tag&1){if(M.flags|=2048,ni(9,Yl(),Ma.bind(null,M,z,x,d),null),Ci===null)throw Error(S(349));q||(Vl&124)!==0||If(M,d,x)}return x}function If(o,d,x){o.flags|=16384,o={getSnapshot:d,value:x},d=cr.updateQueue,d===null?(d=Pp(),cr.updateQueue=d,d.stores=[o]):(x=d.stores,x===null?d.stores=[o]:x.push(o))}function Ma(o,d,x,M){d.value=x,d.getSnapshot=M,tu(d)&&Ed(o)}function Zl(o,d,x){return x(function(){tu(d)&&Ed(o)})}function tu(o){var d=o.getSnapshot;o=o.value;try{var x=d();return!Io(o,x)}catch{return!0}}function Ed(o){var d=_c(o,2);d!==null&&$s(d,o,2)}function Sh(o){var d=Ii();if(typeof o=="function"){var x=o;if(o=x(),xl){ka(!0);try{x()}finally{ka(!1)}}}return d.memoizedState=d.baseState=o,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mc,lastRenderedState:o},d}function Pu(o,d,x,M){return o.baseState=x,Op(o,Lr,typeof M=="function"?M:Mc)}function zm(o,d,x,M,z){if(Qo(o))throw Error(S(485));if(o=d.action,o!==null){var q={payload:z,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ue){q.listeners.push(ue)}};Qe.T!==null?x(!0):q.isTransition=!1,M(q),x=d.pending,x===null?(q.next=d.pending=q,Wl(d,q)):(q.next=x.next,d.pending=x.next=q)}}function Wl(o,d){var x=d.action,M=d.payload,z=o.state;if(d.isTransition){var q=Qe.T,ue={};Qe.T=ue;try{var Oe=x(z,M),it=Qe.S;it!==null&&it(ue,Oe),Kn(o,d,Oe)}catch(Ft){Xl(o,d,Ft)}finally{Qe.T=q}}else try{q=x(z,M),Kn(o,d,q)}catch(Ft){Xl(o,d,Ft)}}function Kn(o,d,x){x!==null&&typeof x=="object"&&typeof x.then=="function"?x.then(function(M){Eh(o,d,M)},function(M){return Xl(o,d,M)}):Eh(o,d,x)}function Eh(o,d,x){d.status="fulfilled",d.value=x,zp(d),o.state=x,d=o.pending,d!==null&&(x=d.next,x===d?o.pending=null:(x=x.next,d.next=x,Wl(o,x)))}function Xl(o,d,x){var M=o.pending;if(o.pending=null,M!==null){M=M.next;do d.status="rejected",d.reason=x,zp(d),d=d.next;while(d!==M)}o.action=null}function zp(o){o=o.listeners;for(var d=0;d<o.length;d++)(0,o[d])()}function kp(o,d){return d}function Np(o,d){if(jr){var x=Ci.formState;if(x!==null){e:{var M=cr;if(jr){if(os){t:{for(var z=os,q=vl;z.nodeType!==8;){if(!q){z=null;break t}if(z=oc(z.nextSibling),z===null){z=null;break t}}q=z.data,z=q==="F!"||q==="F"?z:null}if(z){os=oc(z.nextSibling),M=z.data==="F!";break e}}kl(M)}M=!1}M&&(d=x[0])}}return x=Ii(),x.memoizedState=x.baseState=d,M={pending:null,lanes:0,dispatch:null,lastRenderedReducer:kp,lastRenderedState:d},x.queue=M,x=gr.bind(null,cr,M),M.dispatch=x,M=Sh(!1),q=Rd.bind(null,cr,!1,M.queue),M=Ii(),z={state:d,dispatch:null,action:o,pending:null},M.queue=z,x=zm.bind(null,cr,z,q,x),z.dispatch=x,M.memoizedState=o,[d,x,!1]}function km(o){var d=Ss();return Ou(d,Lr,o)}function Ou(o,d,x){if(d=Op(o,d,kp)[0],o=Sd(Mc)[0],typeof d=="object"&&d!==null&&typeof d.then=="function")try{var M=Td(d)}catch(ue){throw ue===vd?wf:ue}else M=d;d=Ss();var z=d.queue,q=z.dispatch;return x!==d.memoizedState&&(cr.flags|=2048,ni(9,Yl(),Lu.bind(null,z,x),null)),[M,q,o]}function Lu(o,d){o.action=d}function Ut(o){var d=Ss(),x=Lr;if(x!==null)return Ou(d,x,o);Ss(),d=d.memoizedState,x=Ss();var M=x.queue.dispatch;return x.memoizedState=o,[d,M,!1]}function ni(o,d,x,M){return o={tag:o,create:x,deps:M,inst:d,next:null},d=cr.updateQueue,d===null&&(d=Pp(),cr.updateQueue=d),x=d.lastEffect,x===null?d.lastEffect=o.next=o:(M=x.next,x.next=o,o.next=M,d.lastEffect=o),o}function Yl(){return{destroy:void 0,resource:void 0}}function zr(){return Ss().memoizedState}function Ye(o,d,x,M){var z=Ii();M=M===void 0?null:M,cr.flags|=o,z.memoizedState=ni(1|d,Yl(),x,M)}function lo(o,d,x,M){var z=Ss();M=M===void 0?null:M;var q=z.memoizedState.inst;Lr!==null&&M!==null&&wd(M,Lr.memoizedState.deps)?z.memoizedState=ni(d,q,x,M):(cr.flags|=o,z.memoizedState=ni(1|d,q,x,M))}function Ad(o,d){Ye(8390656,8,o,d)}function Cd(o,d){lo(2048,8,o,d)}function Rf(o,d){return lo(4,2,o,d)}function Fp(o,d){return lo(4,4,o,d)}function Bp(o,d){if(typeof d=="function"){o=o();var x=d(o);return function(){typeof x=="function"?x():d(null)}}if(d!=null)return o=o(),d.current=o,function(){d.current=null}}function zu(o,d,x){x=x!=null?x.concat([o]):null,lo(4,4,Bp.bind(null,d,o),x)}function jp(){}function Nm(o,d){var x=Ss();d=d===void 0?null:d;var M=x.memoizedState;return d!==null&&wd(d,M[1])?M[0]:(x.memoizedState=[o,d],o)}function Vp(o,d){var x=Ss();d=d===void 0?null:d;var M=x.memoizedState;if(d!==null&&wd(d,M[1]))return M[0];if(M=o(),xl){ka(!0);try{o()}finally{ka(!1)}}return x.memoizedState=[M,d],M}function Ah(o,d,x){return x===void 0||(Vl&1073741824)!==0?o.memoizedState=d:(o.memoizedState=x,o=sl(),cr.lanes|=o,Zn|=o,x)}function Df(o,d,x,M){return Io(x,d)?x:Du.current!==null?(o=Ah(o,x,M),Io(o,d)||(ia=!0),o):(Vl&42)===0?(ia=!0,o.memoizedState=x):(o=sl(),cr.lanes|=o,Zn|=o,d)}function Pf(o,d,x,M,z){var q=kt.p;kt.p=q!==0&&8>q?q:8;var ue=Qe.T,Oe={};Qe.T=Oe,Rd(o,!1,d,x);try{var it=z(),Ft=Qe.S;if(Ft!==null&&Ft(Oe,it),it!==null&&typeof it=="object"&&typeof it.then=="function"){var ui=Mp(it,M);En(o,d,ui,qs(o))}else En(o,d,M,qs(o))}catch(xi){En(o,d,{then:function(){},status:"rejected",reason:xi},qs())}finally{kt.p=q,Qe.T=ue}}function Fm(){}function Ch(o,d,x,M){if(o.tag!==5)throw Error(S(476));var z=Mh(o).queue;Pf(o,z,d,ii,x===null?Fm:function(){return iu(o),x(M)})}function Mh(o){var d=o.memoizedState;if(d!==null)return d;d={memoizedState:ii,baseState:ii,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mc,lastRenderedState:ii},next:null};var x={};return d.next={memoizedState:x,baseState:x,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mc,lastRenderedState:x},next:null},o.memoizedState=d,o=o.alternate,o!==null&&(o.memoizedState=d),d}function iu(o){var d=Mh(o).next.queue;En(o,d,{},qs())}function Md(){return ha(ip)}function Ic(){return Ss().memoizedState}function da(){return Ss().memoizedState}function Ug(o){for(var d=o.return;d!==null;){switch(d.tag){case 24:case 3:var x=qs();o=To(x);var M=Cc(d,o,x);M!==null&&($s(M,d,x),Yo(M,d,x)),d={cache:gh()},o.payload=d;return}d=d.return}}function Id(o,d,x){var M=qs();x={lane:M,revertLane:0,action:x,hasEagerState:!1,eagerState:null,next:null},Qo(o)?Ih(d,x):(x=Zo(o,d,x,M),x!==null&&($s(x,o,M),ku(x,d,M)))}function gr(o,d,x){var M=qs();En(o,d,x,M)}function En(o,d,x,M){var z={lane:M,revertLane:0,action:x,hasEagerState:!1,eagerState:null,next:null};if(Qo(o))Ih(d,z);else{var q=o.alternate;if(o.lanes===0&&(q===null||q.lanes===0)&&(q=d.lastRenderedReducer,q!==null))try{var ue=d.lastRenderedState,Oe=q(ue,x);if(z.hasEagerState=!0,z.eagerState=Oe,Io(Oe,ue))return Hc(o,d,z,0),Ci===null&&Gc(),!1}catch{}finally{}if(x=Zo(o,d,z,M),x!==null)return $s(x,o,M),ku(x,d,M),!0}return!1}function Rd(o,d,x,M){if(M={lane:2,revertLane:Qp(),action:M,hasEagerState:!1,eagerState:null,next:null},Qo(o)){if(d)throw Error(S(479))}else d=Zo(o,x,M,2),d!==null&&$s(d,o,2)}function Qo(o){var d=o.alternate;return o===cr||d!==null&&d===cr}function Ih(o,d){Ul=Ko=!0;var x=o.pending;x===null?d.next=d:(d.next=x.next,x.next=d),o.pending=d}function ku(o,d,x){if((x&4194048)!==0){var M=d.lanes;M&=o.pendingLanes,x|=M,d.lanes=x,Qt(o,x)}}var Tl={readContext:ha,use:Th,useCallback:Rs,useContext:Rs,useEffect:Rs,useImperativeHandle:Rs,useLayoutEffect:Rs,useInsertionEffect:Rs,useMemo:Rs,useReducer:Rs,useRef:Rs,useState:Rs,useDebugValue:Rs,useDeferredValue:Rs,useTransition:Rs,useSyncExternalStore:Rs,useId:Rs,useHostTransitionStatus:Rs,useFormState:Rs,useActionState:Rs,useOptimistic:Rs,useMemoCache:Rs,useCacheRefresh:Rs},Of={readContext:ha,use:Th,useCallback:function(o,d){return Ii().memoizedState=[o,d===void 0?null:d],o},useContext:ha,useEffect:Ad,useImperativeHandle:function(o,d,x){x=x!=null?x.concat([o]):null,Ye(4194308,4,Bp.bind(null,d,o),x)},useLayoutEffect:function(o,d){return Ye(4194308,4,o,d)},useInsertionEffect:function(o,d){Ye(4,2,o,d)},useMemo:function(o,d){var x=Ii();d=d===void 0?null:d;var M=o();if(xl){ka(!0);try{o()}finally{ka(!1)}}return x.memoizedState=[M,d],M},useReducer:function(o,d,x){var M=Ii();if(x!==void 0){var z=x(d);if(xl){ka(!0);try{x(d)}finally{ka(!1)}}}else z=d;return M.memoizedState=M.baseState=z,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:z},M.queue=o,o=o.dispatch=Id.bind(null,cr,o),[M.memoizedState,o]},useRef:function(o){var d=Ii();return o={current:o},d.memoizedState=o},useState:function(o){o=Sh(o);var d=o.queue,x=gr.bind(null,cr,d);return d.dispatch=x,[o.memoizedState,x]},useDebugValue:jp,useDeferredValue:function(o,d){var x=Ii();return Ah(x,o,d)},useTransition:function(){var o=Sh(!1);return o=Pf.bind(null,cr,o.queue,!0,!1),Ii().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,d,x){var M=cr,z=Ii();if(jr){if(x===void 0)throw Error(S(407));x=x()}else{if(x=d(),Ci===null)throw Error(S(349));($i&124)!==0||If(M,d,x)}z.memoizedState=x;var q={value:x,getSnapshot:d};return z.queue=q,Ad(Zl.bind(null,M,q,o),[o]),M.flags|=2048,ni(9,Yl(),Ma.bind(null,M,q,x,d),null),x},useId:function(){var o=Ii(),d=Ci.identifierPrefix;if(jr){var x=Xo,M=yl;x=(M&~(1<<32-_s(M)-1)).toString(32)+x,d="«"+d+"R"+x,x=bd++,0<x&&(d+="H"+x.toString(32)),d+="»"}else x=Af++,d="«"+d+"r"+x.toString(32)+"»";return o.memoizedState=d},useHostTransitionStatus:Md,useFormState:Np,useActionState:Np,useOptimistic:function(o){var d=Ii();d.memoizedState=d.baseState=o;var x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=x,d=Rd.bind(null,cr,!0,x),x.dispatch=d,[o,d]},useMemoCache:Mf,useCacheRefresh:function(){return Ii().memoizedState=Ug.bind(null,cr)}},Dd={readContext:ha,use:Th,useCallback:Nm,useContext:ha,useEffect:Cd,useImperativeHandle:zu,useInsertionEffect:Rf,useLayoutEffect:Fp,useMemo:Vp,useReducer:Sd,useRef:zr,useState:function(){return Sd(Mc)},useDebugValue:jp,useDeferredValue:function(o,d){var x=Ss();return Df(x,Lr.memoizedState,o,d)},useTransition:function(){var o=Sd(Mc)[0],d=Ss().memoizedState;return[typeof o=="boolean"?o:Td(o),d]},useSyncExternalStore:oo,useId:Ic,useHostTransitionStatus:Md,useFormState:km,useActionState:km,useOptimistic:function(o,d){var x=Ss();return Pu(x,Lr,o,d)},useMemoCache:Mf,useCacheRefresh:da},Rh={readContext:ha,use:Th,useCallback:Nm,useContext:ha,useEffect:Cd,useImperativeHandle:zu,useInsertionEffect:Rf,useLayoutEffect:Fp,useMemo:Vp,useReducer:Lp,useRef:zr,useState:function(){return Lp(Mc)},useDebugValue:jp,useDeferredValue:function(o,d){var x=Ss();return Lr===null?Ah(x,o,d):Df(x,Lr.memoizedState,o,d)},useTransition:function(){var o=Lp(Mc)[0],d=Ss().memoizedState;return[typeof o=="boolean"?o:Td(o),d]},useSyncExternalStore:oo,useId:Ic,useHostTransitionStatus:Md,useFormState:Ut,useActionState:Ut,useOptimistic:function(o,d){var x=Ss();return Lr!==null?Pu(x,Lr,o,d):(x.baseState=o,[o,x.queue.dispatch])},useMemoCache:Mf,useCacheRefresh:da},nu=null,So=0;function Sl(o){var d=So;return So+=1,nu===null&&(nu=[]),Tf(nu,o,d)}function Rc(o,d){d=d.props.ref,o.ref=d!==void 0?d:null}function Nu(o,d){throw d.$$typeof===ie?Error(S(525)):(o=Object.prototype.toString.call(d),Error(S(31,o==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":o)))}function Fu(o){var d=o._init;return d(o._payload)}function Bu(o){function d(Mt,_t){if(o){var zt=Mt.deletions;zt===null?(Mt.deletions=[_t],Mt.flags|=16):zt.push(_t)}}function x(Mt,_t){if(!o)return null;for(;_t!==null;)d(Mt,_t),_t=_t.sibling;return null}function M(Mt){for(var _t=new Map;Mt!==null;)Mt.key!==null?_t.set(Mt.key,Mt):_t.set(Mt.index,Mt),Mt=Mt.sibling;return _t}function z(Mt,_t){return Mt=yc(Mt,_t),Mt.index=0,Mt.sibling=null,Mt}function q(Mt,_t,zt){return Mt.index=zt,o?(zt=Mt.alternate,zt!==null?(zt=zt.index,zt<_t?(Mt.flags|=67108866,_t):zt):(Mt.flags|=67108866,_t)):(Mt.flags|=1048576,_t)}function ue(Mt){return o&&Mt.alternate===null&&(Mt.flags|=67108866),Mt}function Oe(Mt,_t,zt,ci){return _t===null||_t.tag!==6?(_t=Sp(zt,Mt.mode,ci),_t.return=Mt,_t):(_t=z(_t,zt),_t.return=Mt,_t)}function it(Mt,_t,zt,ci){var tn=zt.type;return tn===_e?ui(Mt,_t,zt.props.children,ci,zt.key):_t!==null&&(_t.elementType===tn||typeof tn=="object"&&tn!==null&&tn.$$typeof===gt&&Fu(tn)===_t.type)?(_t=z(_t,zt.props),Rc(_t,zt),_t.return=Mt,_t):(_t=fd(zt.type,zt.key,zt.props,null,Mt.mode,ci),Rc(_t,zt),_t.return=Mt,_t)}function Ft(Mt,_t,zt,ci){return _t===null||_t.tag!==4||_t.stateNode.containerInfo!==zt.containerInfo||_t.stateNode.implementation!==zt.implementation?(_t=Ep(zt,Mt.mode,ci),_t.return=Mt,_t):(_t=z(_t,zt.children||[]),_t.return=Mt,_t)}function ui(Mt,_t,zt,ci,tn){return _t===null||_t.tag!==7?(_t=vc(zt,Mt.mode,ci,tn),_t.return=Mt,_t):(_t=z(_t,zt),_t.return=Mt,_t)}function xi(Mt,_t,zt){if(typeof _t=="string"&&_t!==""||typeof _t=="number"||typeof _t=="bigint")return _t=Sp(""+_t,Mt.mode,zt),_t.return=Mt,_t;if(typeof _t=="object"&&_t!==null){switch(_t.$$typeof){case re:return zt=fd(_t.type,_t.key,_t.props,null,Mt.mode,zt),Rc(zt,_t),zt.return=Mt,zt;case Te:return _t=Ep(_t,Mt.mode,zt),_t.return=Mt,_t;case gt:var ci=_t._init;return _t=ci(_t._payload),xi(Mt,_t,zt)}if(Et(_t)||It(_t))return _t=vc(_t,Mt.mode,zt,null),_t.return=Mt,_t;if(typeof _t.then=="function")return xi(Mt,Sl(_t),zt);if(_t.$$typeof===se)return xi(Mt,mh(Mt,_t),zt);Nu(Mt,_t)}return null}function jt(Mt,_t,zt,ci){var tn=_t!==null?_t.key:null;if(typeof zt=="string"&&zt!==""||typeof zt=="number"||typeof zt=="bigint")return tn!==null?null:Oe(Mt,_t,""+zt,ci);if(typeof zt=="object"&&zt!==null){switch(zt.$$typeof){case re:return zt.key===tn?it(Mt,_t,zt,ci):null;case Te:return zt.key===tn?Ft(Mt,_t,zt,ci):null;case gt:return tn=zt._init,zt=tn(zt._payload),jt(Mt,_t,zt,ci)}if(Et(zt)||It(zt))return tn!==null?null:ui(Mt,_t,zt,ci,null);if(typeof zt.then=="function")return jt(Mt,_t,Sl(zt),ci);if(zt.$$typeof===se)return jt(Mt,_t,mh(Mt,zt),ci);Nu(Mt,zt)}return null}function qt(Mt,_t,zt,ci,tn){if(typeof ci=="string"&&ci!==""||typeof ci=="number"||typeof ci=="bigint")return Mt=Mt.get(zt)||null,Oe(_t,Mt,""+ci,tn);if(typeof ci=="object"&&ci!==null){switch(ci.$$typeof){case re:return Mt=Mt.get(ci.key===null?zt:ci.key)||null,it(_t,Mt,ci,tn);case Te:return Mt=Mt.get(ci.key===null?zt:ci.key)||null,Ft(_t,Mt,ci,tn);case gt:var mr=ci._init;return ci=mr(ci._payload),qt(Mt,_t,zt,ci,tn)}if(Et(ci)||It(ci))return Mt=Mt.get(zt)||null,ui(_t,Mt,ci,tn,null);if(typeof ci.then=="function")return qt(Mt,_t,zt,Sl(ci),tn);if(ci.$$typeof===se)return qt(Mt,_t,zt,mh(_t,ci),tn);Nu(_t,ci)}return null}function zn(Mt,_t,zt,ci){for(var tn=null,mr=null,dn=_t,Cn=_t=0,Oa=null;dn!==null&&Cn<zt.length;Cn++){dn.index>Cn?(Oa=dn,dn=null):Oa=dn.sibling;var Vr=jt(Mt,dn,zt[Cn],ci);if(Vr===null){dn===null&&(dn=Oa);break}o&&dn&&Vr.alternate===null&&d(Mt,dn),_t=q(Vr,_t,Cn),mr===null?tn=Vr:mr.sibling=Vr,mr=Vr,dn=Oa}if(Cn===zt.length)return x(Mt,dn),jr&&xc(Mt,Cn),tn;if(dn===null){for(;Cn<zt.length;Cn++)dn=xi(Mt,zt[Cn],ci),dn!==null&&(_t=q(dn,_t,Cn),mr===null?tn=dn:mr.sibling=dn,mr=dn);return jr&&xc(Mt,Cn),tn}for(dn=M(dn);Cn<zt.length;Cn++)Oa=qt(dn,Mt,Cn,zt[Cn],ci),Oa!==null&&(o&&Oa.alternate!==null&&dn.delete(Oa.key===null?Cn:Oa.key),_t=q(Oa,_t,Cn),mr===null?tn=Oa:mr.sibling=Oa,mr=Oa);return o&&dn.forEach(function(Xu){return d(Mt,Xu)}),jr&&xc(Mt,Cn),tn}function Dn(Mt,_t,zt,ci){if(zt==null)throw Error(S(151));for(var tn=null,mr=null,dn=_t,Cn=_t=0,Oa=null,Vr=zt.next();dn!==null&&!Vr.done;Cn++,Vr=zt.next()){dn.index>Cn?(Oa=dn,dn=null):Oa=dn.sibling;var Xu=jt(Mt,dn,Vr.value,ci);if(Xu===null){dn===null&&(dn=Oa);break}o&&dn&&Xu.alternate===null&&d(Mt,dn),_t=q(Xu,_t,Cn),mr===null?tn=Xu:mr.sibling=Xu,mr=Xu,dn=Oa}if(Vr.done)return x(Mt,dn),jr&&xc(Mt,Cn),tn;if(dn===null){for(;!Vr.done;Cn++,Vr=zt.next())Vr=xi(Mt,Vr.value,ci),Vr!==null&&(_t=q(Vr,_t,Cn),mr===null?tn=Vr:mr.sibling=Vr,mr=Vr);return jr&&xc(Mt,Cn),tn}for(dn=M(dn);!Vr.done;Cn++,Vr=zt.next())Vr=qt(dn,Mt,Cn,Vr.value,ci),Vr!==null&&(o&&Vr.alternate!==null&&dn.delete(Vr.key===null?Cn:Vr.key),_t=q(Vr,_t,Cn),mr===null?tn=Vr:mr.sibling=Vr,mr=Vr);return o&&dn.forEach(function(qy){return d(Mt,qy)}),jr&&xc(Mt,Cn),tn}function Yr(Mt,_t,zt,ci){if(typeof zt=="object"&&zt!==null&&zt.type===_e&&zt.key===null&&(zt=zt.props.children),typeof zt=="object"&&zt!==null){switch(zt.$$typeof){case re:e:{for(var tn=zt.key;_t!==null;){if(_t.key===tn){if(tn=zt.type,tn===_e){if(_t.tag===7){x(Mt,_t.sibling),ci=z(_t,zt.props.children),ci.return=Mt,Mt=ci;break e}}else if(_t.elementType===tn||typeof tn=="object"&&tn!==null&&tn.$$typeof===gt&&Fu(tn)===_t.type){x(Mt,_t.sibling),ci=z(_t,zt.props),Rc(ci,zt),ci.return=Mt,Mt=ci;break e}x(Mt,_t);break}else d(Mt,_t);_t=_t.sibling}zt.type===_e?(ci=vc(zt.props.children,Mt.mode,ci,zt.key),ci.return=Mt,Mt=ci):(ci=fd(zt.type,zt.key,zt.props,null,Mt.mode,ci),Rc(ci,zt),ci.return=Mt,Mt=ci)}return ue(Mt);case Te:e:{for(tn=zt.key;_t!==null;){if(_t.key===tn)if(_t.tag===4&&_t.stateNode.containerInfo===zt.containerInfo&&_t.stateNode.implementation===zt.implementation){x(Mt,_t.sibling),ci=z(_t,zt.children||[]),ci.return=Mt,Mt=ci;break e}else{x(Mt,_t);break}else d(Mt,_t);_t=_t.sibling}ci=Ep(zt,Mt.mode,ci),ci.return=Mt,Mt=ci}return ue(Mt);case gt:return tn=zt._init,zt=tn(zt._payload),Yr(Mt,_t,zt,ci)}if(Et(zt))return zn(Mt,_t,zt,ci);if(It(zt)){if(tn=It(zt),typeof tn!="function")throw Error(S(150));return zt=tn.call(zt),Dn(Mt,_t,zt,ci)}if(typeof zt.then=="function")return Yr(Mt,_t,Sl(zt),ci);if(zt.$$typeof===se)return Yr(Mt,_t,mh(Mt,zt),ci);Nu(Mt,zt)}return typeof zt=="string"&&zt!==""||typeof zt=="number"||typeof zt=="bigint"?(zt=""+zt,_t!==null&&_t.tag===6?(x(Mt,_t.sibling),ci=z(_t,zt),ci.return=Mt,Mt=ci):(x(Mt,_t),ci=Sp(zt,Mt.mode,ci),ci.return=Mt,Mt=ci),ue(Mt)):x(Mt,_t)}return function(Mt,_t,zt,ci){try{So=0;var tn=Yr(Mt,_t,zt,ci);return nu=null,tn}catch(dn){if(dn===vd||dn===wf)throw dn;var mr=Po(29,dn,null,Mt.mode);return mr.lanes=ci,mr.return=Mt,mr}finally{}}}var Es=Bu(!0),ju=Bu(!1),ta=Dt(null),Jo=null;function El(o){var d=o.alternate;li(Ds,Ds.current&1),li(ta,o),Jo===null&&(d===null||Du.current!==null||d.memoizedState!==null)&&(Jo=o)}function Lf(o){if(o.tag===22){if(li(Ds,Ds.current),li(ta,o),Jo===null){var d=o.alternate;d!==null&&d.memoizedState!==null&&(Jo=o)}}else el()}function el(){li(Ds,Ds.current),li(ta,ta.current)}function ls(o){ti(ta),Jo===o&&(Jo=null),ti(Ds)}var Ds=Dt(0);function Dh(o){for(var d=o;d!==null;){if(d.tag===13){var x=d.memoizedState;if(x!==null&&(x=x.dehydrated,x===null||x.data==="$?"||Wd(x)))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===o)break;for(;d.sibling===null;){if(d.return===null||d.return===o)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}function Pd(o,d,x,M){d=o.memoizedState,x=x(M,d),x=x==null?d:$({},d,x),o.memoizedState=x,o.lanes===0&&(o.updateQueue.baseState=x)}var Kl={enqueueSetState:function(o,d,x){o=o._reactInternals;var M=qs(),z=To(M);z.payload=d,x!=null&&(z.callback=x),d=Cc(o,z,M),d!==null&&($s(d,o,M),Yo(d,o,M))},enqueueReplaceState:function(o,d,x){o=o._reactInternals;var M=qs(),z=To(M);z.tag=1,z.payload=d,x!=null&&(z.callback=x),d=Cc(o,z,M),d!==null&&($s(d,o,M),Yo(d,o,M))},enqueueForceUpdate:function(o,d){o=o._reactInternals;var x=qs(),M=To(x);M.tag=2,d!=null&&(M.callback=d),d=Cc(o,M,x),d!==null&&($s(d,o,x),Yo(d,o,x))}};function Ph(o,d,x,M,z,q,ue){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(M,q,ue):d.prototype&&d.prototype.isPureReactComponent?!$o(x,M)||!$o(z,q):!0}function zf(o,d,x,M){o=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(x,M),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(x,M),d.state!==o&&Kl.enqueueReplaceState(d,d.state,null)}function Ql(o,d){var x=d;if("ref"in d){x={};for(var M in d)M!=="ref"&&(x[M]=d[M])}if(o=o.defaultProps){x===d&&(x=$({},x));for(var z in o)x[z]===void 0&&(x[z]=o[z])}return x}var Jl=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)};function kf(o){Jl(o)}function Oh(o){console.error(o)}function Vu(o){Jl(o)}function ru(o,d){try{var x=o.onUncaughtError;x(d.value,{componentStack:d.stack})}catch(M){setTimeout(function(){throw M})}}function Nf(o,d,x){try{var M=o.onCaughtError;M(x.value,{componentStack:x.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(z){setTimeout(function(){throw z})}}function Lh(o,d,x){return x=To(x),x.tag=3,x.payload={element:null},x.callback=function(){ru(o,d)},x}function Up(o){return o=To(o),o.tag=3,o}function Od(o,d,x,M){var z=x.type.getDerivedStateFromError;if(typeof z=="function"){var q=M.value;o.payload=function(){return z(q)},o.callback=function(){Nf(d,x,M)}}var ue=x.stateNode;ue!==null&&typeof ue.componentDidCatch=="function"&&(o.callback=function(){Nf(d,x,M),typeof z!="function"&&(pr===null?pr=new Set([this]):pr.add(this));var Oe=M.stack;this.componentDidCatch(M.value,{componentStack:Oe!==null?Oe:""})})}function Bm(o,d,x,M,z){if(x.flags|=32768,M!==null&&typeof M=="object"&&typeof M.then=="function"){if(d=x.alternate,d!==null&&Yc(d,x,z,!0),x=ta.current,x!==null){switch(x.tag){case 13:return Jo===null?ac():x.alternate===null&&Ui===0&&(Ui=3),x.flags&=-257,x.flags|=65536,x.lanes=z,M===yh?x.flags|=16384:(d=x.updateQueue,d===null?x.updateQueue=new Set([M]):d.add(M),Zg(o,M,z)),!1;case 22:return x.flags|=65536,M===yh?x.flags|=16384:(d=x.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([M])},x.updateQueue=d):(x=d.retryQueue,x===null?d.retryQueue=new Set([M]):x.add(M)),Zg(o,M,z)),!1}throw Error(S(435,x.tag))}return Zg(o,M,z),ac(),!1}if(jr)return d=ta.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=z,M!==Wc&&(o=Error(S(422),{cause:M}),ph(Kt(o,x)))):(M!==Wc&&(d=Error(S(423),{cause:M}),ph(Kt(d,x))),o=o.current.alternate,o.flags|=65536,z&=-z,o.lanes|=z,M=Kt(M,x),z=Lh(o.stateNode,M,z),xh(o,z),Ui!==4&&(Ui=2)),!1;var q=Error(S(520),{cause:M});if(q=Kt(q,x),yn===null?yn=[q]:yn.push(q),Ui!==4&&(Ui=2),d===null)return!0;M=Kt(M,x),x=d;do{switch(x.tag){case 3:return x.flags|=65536,o=z&-z,x.lanes|=o,o=Lh(x.stateNode,M,o),xh(x,o),!1;case 1:if(d=x.type,q=x.stateNode,(x.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(pr===null||!pr.has(q))))return x.flags|=65536,z&=-z,x.lanes|=z,z=Up(z),Od(z,o,x,M),xh(x,z),!1}x=x.return}while(x!==null);return!1}var Gp=Error(S(461)),ia=!1;function fa(o,d,x,M){d.child=o===null?ju(d,null,x,M):Es(d,o.child,x,M)}function Ff(o,d,x,M,z){x=x.render;var q=d.ref;if("ref"in M){var ue={};for(var Oe in M)Oe!=="ref"&&(ue[Oe]=M[Oe])}else ue=M;return wo(d),M=wl(o,d,x,ue,q,z),Oe=Cf(),o!==null&&!ia?(ql(o,d,z),tl(o,d,z)):(jr&&Oe&&Zc(d),d.flags|=1,fa(o,d,M,z),d.child)}function Hp(o,d,x,M,z){if(o===null){var q=x.type;return typeof q=="function"&&!uh(q)&&q.defaultProps===void 0&&x.compare===null?(d.tag=15,d.type=q,qp(o,d,q,M,z)):(o=fd(x.type,null,M,d,d.mode,z),o.ref=d.ref,o.return=d,d.child=o)}if(q=o.child,!Xr(o,z)){var ue=q.memoizedProps;if(x=x.compare,x=x!==null?x:$o,x(ue,M)&&o.ref===d.ref)return tl(o,d,z)}return d.flags|=1,o=yc(q,M),o.ref=d.ref,o.return=d,d.child=o}function qp(o,d,x,M,z){if(o!==null){var q=o.memoizedProps;if($o(q,M)&&o.ref===d.ref)if(ia=!1,d.pendingProps=M=q,Xr(o,z))(o.flags&131072)!==0&&(ia=!0);else return d.lanes=o.lanes,tl(o,d,z)}return Bf(o,d,x,M,z)}function $p(o,d,x){var M=d.pendingProps,z=M.children,q=o!==null?o.memoizedState:null;if(M.mode==="hidden"){if((d.flags&128)!==0){if(M=q!==null?q.baseLanes|x:x,o!==null){for(z=d.child=o.child,q=0;z!==null;)q=q|z.lanes|z.childLanes,z=z.sibling;d.childLanes=q&~M}else d.childLanes=0,d.child=null;return Zp(o,d,M,x)}if((x&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},o!==null&&Fl(d,q!==null?q.cachePool:null),q!==null?Oo(d,q):Rp(),Lf(d);else return d.lanes=d.childLanes=536870912,Zp(o,d,q!==null?q.baseLanes|x:x,x)}else q!==null?(Fl(d,q.cachePool),Oo(d,q),el(),d.memoizedState=null):(o!==null&&Fl(d,null),Rp(),el());return fa(o,d,z,x),d.child}function Zp(o,d,x,M){var z=bf();return z=z===null?null:{parent:Gr._currentValue,pool:z},d.memoizedState={baseLanes:x,cachePool:z},o!==null&&Fl(d,null),Rp(),Lf(d),o!==null&&Yc(o,d,M,!0),null}function Ld(o,d){var x=d.ref;if(x===null)o!==null&&o.ref!==null&&(d.flags|=4194816);else{if(typeof x!="function"&&typeof x!="object")throw Error(S(284));(o===null||o.ref!==x)&&(d.flags|=4194816)}}function Bf(o,d,x,M,z){return wo(d),x=wl(o,d,x,M,void 0,z),M=Cf(),o!==null&&!ia?(ql(o,d,z),tl(o,d,z)):(jr&&M&&Zc(d),d.flags|=1,fa(o,d,x,z),d.child)}function jm(o,d,x,M,z,q){return wo(d),d.updateQueue=null,x=mi(d,M,x,z),Hl(o),M=Cf(),o!==null&&!ia?(ql(o,d,q),tl(o,d,q)):(jr&&M&&Zc(d),d.flags|=1,fa(o,d,x,q),d.child)}function Vm(o,d,x,M,z){if(wo(d),d.stateNode===null){var q=_l,ue=x.contextType;typeof ue=="object"&&ue!==null&&(q=ha(ue)),q=new x(M,q),d.memoizedState=q.state!==null&&q.state!==void 0?q.state:null,q.updater=Kl,d.stateNode=q,q._reactInternals=d,q=d.stateNode,q.props=M,q.state=d.memoizedState,q.refs={},Ef(d),ue=x.contextType,q.context=typeof ue=="object"&&ue!==null?ha(ue):_l,q.state=d.memoizedState,ue=x.getDerivedStateFromProps,typeof ue=="function"&&(Pd(d,x,ue,M),q.state=d.memoizedState),typeof x.getDerivedStateFromProps=="function"||typeof q.getSnapshotBeforeUpdate=="function"||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(ue=q.state,typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount(),ue!==q.state&&Kl.enqueueReplaceState(q,q.state,null),Ru(d,M,q,z),Iu(),q.state=d.memoizedState),typeof q.componentDidMount=="function"&&(d.flags|=4194308),M=!0}else if(o===null){q=d.stateNode;var Oe=d.memoizedProps,it=Ql(x,Oe);q.props=it;var Ft=q.context,ui=x.contextType;ue=_l,typeof ui=="object"&&ui!==null&&(ue=ha(ui));var xi=x.getDerivedStateFromProps;ui=typeof xi=="function"||typeof q.getSnapshotBeforeUpdate=="function",Oe=d.pendingProps!==Oe,ui||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(Oe||Ft!==ue)&&zf(d,q,M,ue),Bl=!1;var jt=d.memoizedState;q.state=jt,Ru(d,M,q,z),Iu(),Ft=d.memoizedState,Oe||jt!==Ft||Bl?(typeof xi=="function"&&(Pd(d,x,xi,M),Ft=d.memoizedState),(it=Bl||Ph(d,x,it,M,jt,Ft,ue))?(ui||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount()),typeof q.componentDidMount=="function"&&(d.flags|=4194308)):(typeof q.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=M,d.memoizedState=Ft),q.props=M,q.state=Ft,q.context=ue,M=it):(typeof q.componentDidMount=="function"&&(d.flags|=4194308),M=!1)}else{q=d.stateNode,jl(o,d),ue=d.memoizedProps,ui=Ql(x,ue),q.props=ui,xi=d.pendingProps,jt=q.context,Ft=x.contextType,it=_l,typeof Ft=="object"&&Ft!==null&&(it=ha(Ft)),Oe=x.getDerivedStateFromProps,(Ft=typeof Oe=="function"||typeof q.getSnapshotBeforeUpdate=="function")||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(ue!==xi||jt!==it)&&zf(d,q,M,it),Bl=!1,jt=d.memoizedState,q.state=jt,Ru(d,M,q,z),Iu();var qt=d.memoizedState;ue!==xi||jt!==qt||Bl||o!==null&&o.dependencies!==null&&Tu(o.dependencies)?(typeof Oe=="function"&&(Pd(d,x,Oe,M),qt=d.memoizedState),(ui=Bl||Ph(d,x,ui,M,jt,qt,it)||o!==null&&o.dependencies!==null&&Tu(o.dependencies))?(Ft||typeof q.UNSAFE_componentWillUpdate!="function"&&typeof q.componentWillUpdate!="function"||(typeof q.componentWillUpdate=="function"&&q.componentWillUpdate(M,qt,it),typeof q.UNSAFE_componentWillUpdate=="function"&&q.UNSAFE_componentWillUpdate(M,qt,it)),typeof q.componentDidUpdate=="function"&&(d.flags|=4),typeof q.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof q.componentDidUpdate!="function"||ue===o.memoizedProps&&jt===o.memoizedState||(d.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||ue===o.memoizedProps&&jt===o.memoizedState||(d.flags|=1024),d.memoizedProps=M,d.memoizedState=qt),q.props=M,q.state=qt,q.context=it,M=ui):(typeof q.componentDidUpdate!="function"||ue===o.memoizedProps&&jt===o.memoizedState||(d.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||ue===o.memoizedProps&&jt===o.memoizedState||(d.flags|=1024),M=!1)}return q=M,Ld(o,d),M=(d.flags&128)!==0,q||M?(q=d.stateNode,x=M&&typeof x.getDerivedStateFromError!="function"?null:q.render(),d.flags|=1,o!==null&&M?(d.child=Es(d,o.child,null,z),d.child=Es(d,null,x,z)):fa(o,d,x,z),d.memoizedState=q.state,o=d.child):o=tl(o,d,z),o}function zd(o,d,x,M){return wc(),d.flags|=256,fa(o,d,x,M),d.child}var kr={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function jf(o){return{baseLanes:o,cachePool:Ip()}}function zh(o,d,x){return o=o!==null?o.childLanes&~x:0,d&&(o|=gn),o}function Vf(o,d,x){var M=d.pendingProps,z=!1,q=(d.flags&128)!==0,ue;if((ue=q)||(ue=o!==null&&o.memoizedState===null?!1:(Ds.current&2)!==0),ue&&(z=!0,d.flags&=-129),ue=(d.flags&32)!==0,d.flags&=-33,o===null){if(jr){if(z?El(d):el(),jr){var Oe=os,it;if(it=Oe){e:{for(it=Oe,Oe=vl;it.nodeType!==8;){if(!Oe){Oe=null;break e}if(it=oc(it.nextSibling),it===null){Oe=null;break e}}Oe=it}Oe!==null?(d.memoizedState={dehydrated:Oe,treeContext:qc!==null?{id:yl,overflow:Xo}:null,retryLane:536870912,hydrationErrors:null},it=Po(18,null,null,0),it.stateNode=Oe,it.return=d,d.child=it,ua=d,os=null,it=!0):it=!1}it||kl(d)}if(Oe=d.memoizedState,Oe!==null&&(Oe=Oe.dehydrated,Oe!==null))return Wd(Oe)?d.lanes=32:d.lanes=536870912,null;ls(d)}return Oe=M.children,M=M.fallback,z?(el(),z=d.mode,Oe=su({mode:"hidden",children:Oe},z),M=vc(M,z,x,null),Oe.return=d,M.return=d,Oe.sibling=M,d.child=Oe,z=d.child,z.memoizedState=jf(x),z.childLanes=zh(o,ue,x),d.memoizedState=kr,M):(El(d),Uf(d,Oe))}if(it=o.memoizedState,it!==null&&(Oe=it.dehydrated,Oe!==null)){if(q)d.flags&256?(El(d),d.flags&=-257,d=kd(o,d,x)):d.memoizedState!==null?(el(),d.child=o.child,d.flags|=128,d=null):(el(),z=M.fallback,Oe=d.mode,M=su({mode:"visible",children:M.children},Oe),z=vc(z,Oe,x,null),z.flags|=2,M.return=d,z.return=d,M.sibling=z,d.child=M,Es(d,o.child,null,x),M=d.child,M.memoizedState=jf(x),M.childLanes=zh(o,ue,x),d.memoizedState=kr,d=z);else if(El(d),Wd(Oe)){if(ue=Oe.nextSibling&&Oe.nextSibling.dataset,ue)var Ft=ue.dgst;ue=Ft,M=Error(S(419)),M.stack="",M.digest=ue,ph({value:M,source:null,stack:null}),d=kd(o,d,x)}else if(ia||Yc(o,d,x,!1),ue=(x&o.childLanes)!==0,ia||ue){if(ue=Ci,ue!==null&&(M=x&-x,M=(M&42)!==0?1:io(M),M=(M&(ue.suspendedLanes|x))!==0?0:M,M!==0&&M!==it.retryLane))throw it.retryLane=M,_c(o,M),$s(ue,o,M),Gp;Oe.data==="$?"||ac(),d=kd(o,d,x)}else Oe.data==="$?"?(d.flags|=192,d.child=o.child,d=null):(o=it.treeContext,os=oc(Oe.nextSibling),ua=d,jr=!0,bc=null,vl=!1,o!==null&&(ao[Wo++]=yl,ao[Wo++]=Xo,ao[Wo++]=qc,yl=o.id,Xo=o.overflow,qc=d),d=Uf(d,M.children),d.flags|=4096);return d}return z?(el(),z=M.fallback,Oe=d.mode,it=o.child,Ft=it.sibling,M=yc(it,{mode:"hidden",children:M.children}),M.subtreeFlags=it.subtreeFlags&65011712,Ft!==null?z=yc(Ft,z):(z=vc(z,Oe,x,null),z.flags|=2),z.return=d,M.return=d,M.sibling=z,d.child=M,M=z,z=d.child,Oe=o.child.memoizedState,Oe===null?Oe=jf(x):(it=Oe.cachePool,it!==null?(Ft=Gr._currentValue,it=it.parent!==Ft?{parent:Ft,pool:Ft}:it):it=Ip(),Oe={baseLanes:Oe.baseLanes|x,cachePool:it}),z.memoizedState=Oe,z.childLanes=zh(o,ue,x),d.memoizedState=kr,M):(El(d),x=o.child,o=x.sibling,x=yc(x,{mode:"visible",children:M.children}),x.return=d,x.sibling=null,o!==null&&(ue=d.deletions,ue===null?(d.deletions=[o],d.flags|=16):ue.push(o)),d.child=x,d.memoizedState=null,x)}function Uf(o,d){return d=su({mode:"visible",children:d},o.mode),d.return=o,o.child=d}function su(o,d){return o=Po(22,o,null,d),o.lanes=0,o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},o}function kd(o,d,x){return Es(d,o.child,null,x),o=Uf(d,d.pendingProps.children),o.flags|=2,d.memoizedState=null,o}function Nd(o,d,x){o.lanes|=d;var M=o.alternate;M!==null&&(M.lanes|=d),Cp(o.return,d,x)}function Uu(o,d,x,M,z){var q=o.memoizedState;q===null?o.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:M,tail:x,tailMode:z}:(q.isBackwards=d,q.rendering=null,q.renderingStartTime=0,q.last=M,q.tail=x,q.tailMode=z)}function ec(o,d,x){var M=d.pendingProps,z=M.revealOrder,q=M.tail;if(fa(o,d,M.children,x),M=Ds.current,(M&2)!==0)M=M&1|2,d.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=d.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&Nd(o,x,d);else if(o.tag===19)Nd(o,x,d);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===d)break e;for(;o.sibling===null;){if(o.return===null||o.return===d)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}M&=1}switch(li(Ds,M),z){case"forwards":for(x=d.child,z=null;x!==null;)o=x.alternate,o!==null&&Dh(o)===null&&(z=x),x=x.sibling;x=z,x===null?(z=d.child,d.child=null):(z=x.sibling,x.sibling=null),Uu(d,!1,z,x,q);break;case"backwards":for(x=null,z=d.child,d.child=null;z!==null;){if(o=z.alternate,o!==null&&Dh(o)===null){d.child=z;break}o=z.sibling,z.sibling=x,x=z,z=o}Uu(d,!0,x,null,q);break;case"together":Uu(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function tl(o,d,x){if(o!==null&&(d.dependencies=o.dependencies),Zn|=d.lanes,(x&d.childLanes)===0)if(o!==null){if(Yc(o,d,x,!1),(x&d.childLanes)===0)return null}else return null;if(o!==null&&d.child!==o.child)throw Error(S(153));if(d.child!==null){for(o=d.child,x=yc(o,o.pendingProps),d.child=x,x.return=d;o.sibling!==null;)o=o.sibling,x=x.sibling=yc(o,o.pendingProps),x.return=d;x.sibling=null}return d.child}function Xr(o,d){return(o.lanes&d)!==0?!0:(o=o.dependencies,!!(o!==null&&Tu(o)))}function tc(o,d,x){switch(d.tag){case 3:Oi(d,d.stateNode.containerInfo),Tc(d,Gr,o.memoizedState.cache),wc();break;case 27:case 5:hn(d);break;case 4:Oi(d,d.stateNode.containerInfo);break;case 10:Tc(d,d.type,d.memoizedProps.value);break;case 13:var M=d.memoizedState;if(M!==null)return M.dehydrated!==null?(El(d),d.flags|=128,null):(x&d.child.childLanes)!==0?Vf(o,d,x):(El(d),o=tl(o,d,x),o!==null?o.sibling:null);El(d);break;case 19:var z=(o.flags&128)!==0;if(M=(x&d.childLanes)!==0,M||(Yc(o,d,x,!1),M=(x&d.childLanes)!==0),z){if(M)return ec(o,d,x);d.flags|=128}if(z=d.memoizedState,z!==null&&(z.rendering=null,z.tail=null,z.lastEffect=null),li(Ds,Ds.current),M)break;return null;case 22:case 23:return d.lanes=0,$p(o,d,x);case 24:Tc(d,Gr,o.memoizedState.cache)}return tl(o,d,x)}function kh(o,d,x){if(o!==null)if(o.memoizedProps!==d.pendingProps)ia=!0;else{if(!Xr(o,x)&&(d.flags&128)===0)return ia=!1,tc(o,d,x);ia=(o.flags&131072)!==0}else ia=!1,jr&&(d.flags&1048576)!==0&&$c(d,yf,d.index);switch(d.lanes=0,d.tag){case 16:e:{o=d.pendingProps;var M=d.elementType,z=M._init;if(M=z(M._payload),d.type=M,typeof M=="function")uh(M)?(o=Ql(M,o),d.tag=1,d=Vm(null,d,M,o,x)):(d.tag=0,d=Bf(null,d,M,o,x));else{if(M!=null){if(z=M.$$typeof,z===De){d.tag=11,d=Ff(null,d,M,o,x);break e}else if(z===At){d.tag=14,d=Hp(null,d,M,o,x);break e}}throw d=ct(M)||M,Error(S(306,d,""))}}return d;case 0:return Bf(o,d,d.type,d.pendingProps,x);case 1:return M=d.type,z=Ql(M,d.pendingProps),Vm(o,d,M,z,x);case 3:e:{if(Oi(d,d.stateNode.containerInfo),o===null)throw Error(S(387));M=d.pendingProps;var q=d.memoizedState;z=q.element,jl(o,d),Ru(d,M,null,x);var ue=d.memoizedState;if(M=ue.cache,Tc(d,Gr,M),M!==q.cache&&gd(d,[Gr],x,!0),Iu(),M=ue.element,q.isDehydrated)if(q={element:M,isDehydrated:!1,cache:ue.cache},d.updateQueue.baseState=q,d.memoizedState=q,d.flags&256){d=zd(o,d,M,x);break e}else if(M!==z){z=Kt(Error(S(424)),d),ph(z),d=zd(o,d,M,x);break e}else{switch(o=d.stateNode.containerInfo,o.nodeType){case 9:o=o.body;break;default:o=o.nodeName==="HTML"?o.ownerDocument.body:o}for(os=oc(o.firstChild),ua=d,jr=!0,bc=null,vl=!0,x=ju(d,null,M,x),d.child=x;x;)x.flags=x.flags&-3|4096,x=x.sibling}else{if(wc(),M===z){d=tl(o,d,x);break e}fa(o,d,M,x)}d=d.child}return d;case 26:return Ld(o,d),o===null?(x=ng(d.type,null,d.pendingProps,null))?d.memoizedState=x:jr||(x=d.type,o=d.pendingProps,M=Xm(Rt.current).createElement(x),M[ee]=d,M[ae]=o,Wa(M,x,o),si(M),d.stateNode=M):d.memoizedState=ng(d.type,o.memoizedProps,d.pendingProps,o.memoizedState),null;case 27:return hn(d),o===null&&jr&&(M=d.stateNode=im(d.type,d.pendingProps,Rt.current),ua=d,vl=!0,z=os,is(d.type)?(Xd=z,os=oc(M.firstChild)):os=z),fa(o,d,d.pendingProps.children,x),Ld(o,d),o===null&&(d.flags|=4194304),d.child;case 5:return o===null&&jr&&((z=M=os)&&(M=Qm(M,d.type,d.pendingProps,vl),M!==null?(d.stateNode=M,ua=d,os=oc(M.firstChild),vl=!1,z=!0):z=!1),z||kl(d)),hn(d),z=d.type,q=d.pendingProps,ue=o!==null?o.memoizedProps:null,M=q.children,i_(z,q)?M=null:ue!==null&&i_(z,ue)&&(d.flags|=32),d.memoizedState!==null&&(z=wl(o,d,Lm,null,null,x),ip._currentValue=z),Ld(o,d),fa(o,d,M,x),d.child;case 6:return o===null&&jr&&((o=x=os)&&(x=Jm(x,d.pendingProps,vl),x!==null?(d.stateNode=x,ua=d,os=null,o=!0):o=!1),o||kl(d)),null;case 13:return Vf(o,d,x);case 4:return Oi(d,d.stateNode.containerInfo),M=d.pendingProps,o===null?d.child=Es(d,null,M,x):fa(o,d,M,x),d.child;case 11:return Ff(o,d,d.type,d.pendingProps,x);case 7:return fa(o,d,d.pendingProps,x),d.child;case 8:return fa(o,d,d.pendingProps.children,x),d.child;case 12:return fa(o,d,d.pendingProps.children,x),d.child;case 10:return M=d.pendingProps,Tc(d,d.type,M.value),fa(o,d,M.children,x),d.child;case 9:return z=d.type._context,M=d.pendingProps.children,wo(d),z=ha(z),M=M(z),d.flags|=1,fa(o,d,M,x),d.child;case 14:return Hp(o,d,d.type,d.pendingProps,x);case 15:return qp(o,d,d.type,d.pendingProps,x);case 19:return ec(o,d,x);case 31:return M=d.pendingProps,x=d.mode,M={mode:M.mode,children:M.children},o===null?(x=su(M,x),x.ref=d.ref,d.child=x,x.return=d,d=x):(x=yc(o.child,M),x.ref=d.ref,d.child=x,x.return=d,d=x),d;case 22:return $p(o,d,x);case 24:return wo(d),M=ha(Gr),o===null?(z=bf(),z===null&&(z=Ci,q=gh(),z.pooledCache=q,q.refCount++,q!==null&&(z.pooledCacheLanes|=x),z=q),d.memoizedState={parent:M,cache:z},Ef(d),Tc(d,Gr,z)):((o.lanes&x)!==0&&(jl(o,d),Ru(d,null,null,x),Iu()),z=o.memoizedState,q=d.memoizedState,z.parent!==M?(z={parent:M,cache:M},d.memoizedState=z,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=z),Tc(d,Gr,M)):(M=q.cache,Tc(d,Gr,M),M!==z.cache&&gd(d,[Gr],x,!0))),fa(o,d,d.pendingProps.children,x),d.child;case 29:throw d.pendingProps}throw Error(S(156,d.tag))}function il(o){o.flags|=4}function Wp(o,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!Ny(d)){if(d=ta.current,d!==null&&(($i&4194048)===$i?Jo!==null:($i&62914560)!==$i&&($i&536870912)===0||d!==Jo))throw vh=yh,Pm;o.flags|=8192}}function Gf(o,d){d!==null&&(o.flags|=4),o.flags&16384&&(d=o.tag!==22?Co():536870912,o.lanes|=d,_r|=d)}function ic(o,d){if(!jr)switch(o.tailMode){case"hidden":d=o.tail;for(var x=null;d!==null;)d.alternate!==null&&(x=d),d=d.sibling;x===null?o.tail=null:x.sibling=null;break;case"collapsed":x=o.tail;for(var M=null;x!==null;)x.alternate!==null&&(M=x),x=x.sibling;M===null?d||o.tail===null?o.tail=null:o.tail.sibling=null:M.sibling=null}}function vs(o){var d=o.alternate!==null&&o.alternate.child===o.child,x=0,M=0;if(d)for(var z=o.child;z!==null;)x|=z.lanes|z.childLanes,M|=z.subtreeFlags&65011712,M|=z.flags&65011712,z.return=o,z=z.sibling;else for(z=o.child;z!==null;)x|=z.lanes|z.childLanes,M|=z.subtreeFlags,M|=z.flags,z.return=o,z=z.sibling;return o.subtreeFlags|=M,o.childLanes=x,d}function nc(o,d,x){var M=d.pendingProps;switch(fh(d),d.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vs(d),null;case 1:return vs(d),null;case 3:return x=d.stateNode,M=null,o!==null&&(M=o.memoizedState.cache),d.memoizedState.cache!==M&&(d.flags|=2048),Sc(Gr),ei(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(o===null||o.child===null)&&(Xc(d)?il(d):o===null||o.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,Ap())),vs(d),null;case 26:return x=d.memoizedState,o===null?(il(d),x!==null?(vs(d),Wp(d,x)):(vs(d),d.flags&=-16777217)):x?x!==o.memoizedState?(il(d),vs(d),Wp(d,x)):(vs(d),d.flags&=-16777217):(o.memoizedProps!==M&&il(d),vs(d),d.flags&=-16777217),null;case 27:In(d),x=Rt.current;var z=d.type;if(o!==null&&d.stateNode!=null)o.memoizedProps!==M&&il(d);else{if(!M){if(d.stateNode===null)throw Error(S(166));return vs(d),null}o=Mi.current,Xc(d)?md(d):(o=im(z,M,x),d.stateNode=o,il(d))}return vs(d),null;case 5:if(In(d),x=d.type,o!==null&&d.stateNode!=null)o.memoizedProps!==M&&il(d);else{if(!M){if(d.stateNode===null)throw Error(S(166));return vs(d),null}if(o=Mi.current,Xc(d))md(d);else{switch(z=Xm(Rt.current),o){case 1:o=z.createElementNS("http://www.w3.org/2000/svg",x);break;case 2:o=z.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;default:switch(x){case"svg":o=z.createElementNS("http://www.w3.org/2000/svg",x);break;case"math":o=z.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;case"script":o=z.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o=typeof M.is=="string"?z.createElement("select",{is:M.is}):z.createElement("select"),M.multiple?o.multiple=!0:M.size&&(o.size=M.size);break;default:o=typeof M.is=="string"?z.createElement(x,{is:M.is}):z.createElement(x)}}o[ee]=d,o[ae]=M;e:for(z=d.child;z!==null;){if(z.tag===5||z.tag===6)o.appendChild(z.stateNode);else if(z.tag!==4&&z.tag!==27&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===d)break e;for(;z.sibling===null;){if(z.return===null||z.return===d)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}d.stateNode=o;e:switch(Wa(o,x,M),x){case"button":case"input":case"select":case"textarea":o=!!M.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&il(d)}}return vs(d),d.flags&=-16777217,null;case 6:if(o&&d.stateNode!=null)o.memoizedProps!==M&&il(d);else{if(typeof M!="string"&&d.stateNode===null)throw Error(S(166));if(o=Rt.current,Xc(d)){if(o=d.stateNode,x=d.memoizedProps,M=null,z=ua,z!==null)switch(z.tag){case 27:case 5:M=z.memoizedProps}o[ee]=d,o=!!(o.nodeValue===x||M!==null&&M.suppressHydrationWarning===!0||Cy(o.nodeValue,x)),o||kl(d)}else o=Xm(o).createTextNode(M),o[ee]=d,d.stateNode=o}return vs(d),null;case 13:if(M=d.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(z=Xc(d),M!==null&&M.dehydrated!==null){if(o===null){if(!z)throw Error(S(318));if(z=d.memoizedState,z=z!==null?z.dehydrated:null,!z)throw Error(S(317));z[ee]=d}else wc(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;vs(d),z=!1}else z=Ap(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=z),z=!0;if(!z)return d.flags&256?(ls(d),d):(ls(d),null)}if(ls(d),(d.flags&128)!==0)return d.lanes=x,d;if(x=M!==null,o=o!==null&&o.memoizedState!==null,x){M=d.child,z=null,M.alternate!==null&&M.alternate.memoizedState!==null&&M.alternate.memoizedState.cachePool!==null&&(z=M.alternate.memoizedState.cachePool.pool);var q=null;M.memoizedState!==null&&M.memoizedState.cachePool!==null&&(q=M.memoizedState.cachePool.pool),q!==z&&(M.flags|=2048)}return x!==o&&x&&(d.child.flags|=8192),Gf(d,d.updateQueue),vs(d),null;case 4:return ei(),o===null&&$m(d.stateNode.containerInfo),vs(d),null;case 10:return Sc(d.type),vs(d),null;case 19:if(ti(Ds),z=d.memoizedState,z===null)return vs(d),null;if(M=(d.flags&128)!==0,q=z.rendering,q===null)if(M)ic(z,!1);else{if(Ui!==0||o!==null&&(o.flags&128)!==0)for(o=d.child;o!==null;){if(q=Dh(o),q!==null){for(d.flags|=128,ic(z,!1),o=q.updateQueue,d.updateQueue=o,Gf(d,o),d.subtreeFlags=0,o=x,x=d.child;x!==null;)Dr(x,o),x=x.sibling;return li(Ds,Ds.current&1|2),d.child}o=o.sibling}z.tail!==null&&gs()>or&&(d.flags|=128,M=!0,ic(z,!1),d.lanes=4194304)}else{if(!M)if(o=Dh(q),o!==null){if(d.flags|=128,M=!0,o=o.updateQueue,d.updateQueue=o,Gf(d,o),ic(z,!0),z.tail===null&&z.tailMode==="hidden"&&!q.alternate&&!jr)return vs(d),null}else 2*gs()-z.renderingStartTime>or&&x!==536870912&&(d.flags|=128,M=!0,ic(z,!1),d.lanes=4194304);z.isBackwards?(q.sibling=d.child,d.child=q):(o=z.last,o!==null?o.sibling=q:d.child=q,z.last=q)}return z.tail!==null?(d=z.tail,z.rendering=d,z.tail=d.sibling,z.renderingStartTime=gs(),d.sibling=null,o=Ds.current,li(Ds,M?o&1|2:o&1),d):(vs(d),null);case 22:case 23:return ls(d),Dp(),M=d.memoizedState!==null,o!==null?o.memoizedState!==null!==M&&(d.flags|=8192):M&&(d.flags|=8192),M?(x&536870912)!==0&&(d.flags&128)===0&&(vs(d),d.subtreeFlags&6&&(d.flags|=8192)):vs(d),x=d.updateQueue,x!==null&&Gf(d,x.retryQueue),x=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(x=o.memoizedState.cachePool.pool),M=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(M=d.memoizedState.cachePool.pool),M!==x&&(d.flags|=2048),o!==null&&ti(Jc),null;case 24:return x=null,o!==null&&(x=o.memoizedState.cache),d.memoizedState.cache!==x&&(d.flags|=2048),Sc(Gr),vs(d),null;case 25:return null;case 30:return null}throw Error(S(156,d.tag))}function Fd(o,d){switch(fh(d),d.tag){case 1:return o=d.flags,o&65536?(d.flags=o&-65537|128,d):null;case 3:return Sc(Gr),ei(),o=d.flags,(o&65536)!==0&&(o&128)===0?(d.flags=o&-65537|128,d):null;case 26:case 27:case 5:return In(d),null;case 13:if(ls(d),o=d.memoizedState,o!==null&&o.dehydrated!==null){if(d.alternate===null)throw Error(S(340));wc()}return o=d.flags,o&65536?(d.flags=o&-65537|128,d):null;case 19:return ti(Ds),null;case 4:return ei(),null;case 10:return Sc(d.type),null;case 22:case 23:return ls(d),Dp(),o!==null&&ti(Jc),o=d.flags,o&65536?(d.flags=o&-65537|128,d):null;case 24:return Sc(Gr),null;case 25:return null;default:return null}}function Hf(o,d){switch(fh(d),d.tag){case 3:Sc(Gr),ei();break;case 26:case 27:case 5:In(d);break;case 4:ei();break;case 13:ls(d);break;case 19:ti(Ds);break;case 10:Sc(d.type);break;case 22:case 23:ls(d),Dp(),o!==null&&ti(Jc);break;case 24:Sc(Gr)}}function Dc(o,d){try{var x=d.updateQueue,M=x!==null?x.lastEffect:null;if(M!==null){var z=M.next;x=z;do{if((x.tag&o)===o){M=void 0;var q=x.create,ue=x.inst;M=q(),ue.destroy=M}x=x.next}while(x!==z)}}catch(Oe){ts(d,d.return,Oe)}}function Lo(o,d,x){try{var M=d.updateQueue,z=M!==null?M.lastEffect:null;if(z!==null){var q=z.next;M=q;do{if((M.tag&o)===o){var ue=M.inst,Oe=ue.destroy;if(Oe!==void 0){ue.destroy=void 0,z=d;var it=x,Ft=Oe;try{Ft()}catch(ui){ts(z,it,ui)}}}M=M.next}while(M!==q)}}catch(ui){ts(d,d.return,ui)}}function rc(o){var d=o.updateQueue;if(d!==null){var x=o.stateNode;try{wh(d,x)}catch(M){ts(o,o.return,M)}}}function nl(o,d,x){x.props=Ql(o.type,o.memoizedProps),x.state=o.memoizedState;try{x.componentWillUnmount()}catch(M){ts(o,d,M)}}function $a(o,d){try{var x=o.ref;if(x!==null){switch(o.tag){case 26:case 27:case 5:var M=o.stateNode;break;case 30:M=o.stateNode;break;default:M=o.stateNode}typeof x=="function"?o.refCleanup=x(M):x.current=M}}catch(z){ts(o,d,z)}}function co(o,d){var x=o.ref,M=o.refCleanup;if(x!==null)if(typeof M=="function")try{M()}catch(z){ts(o,d,z)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof x=="function")try{x(null)}catch(z){ts(o,d,z)}else x.current=null}function u(o){var d=o.type,x=o.memoizedProps,M=o.stateNode;try{e:switch(d){case"button":case"input":case"select":case"textarea":x.autoFocus&&M.focus();break e;case"img":x.src?M.src=x.src:x.srcSet&&(M.srcset=x.srcSet)}}catch(z){ts(o,o.return,z)}}function t(o,d,x){try{var M=o.stateNode;qd(M,o.type,x,d),M[ae]=d}catch(z){ts(o,o.return,z)}}function s(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&is(o.type)||o.tag===4}function h(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||s(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&is(o.type)||o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function _(o,d,x){var M=o.tag;if(M===5||M===6)o=o.stateNode,d?(x.nodeType===9?x.body:x.nodeName==="HTML"?x.ownerDocument.body:x).insertBefore(o,d):(d=x.nodeType===9?x.body:x.nodeName==="HTML"?x.ownerDocument.body:x,d.appendChild(o),x=x._reactRootContainer,x!=null||d.onclick!==null||(d.onclick=Wm));else if(M!==4&&(M===27&&is(o.type)&&(x=o.stateNode,d=null),o=o.child,o!==null))for(_(o,d,x),o=o.sibling;o!==null;)_(o,d,x),o=o.sibling}function y(o,d,x){var M=o.tag;if(M===5||M===6)o=o.stateNode,d?x.insertBefore(o,d):x.appendChild(o);else if(M!==4&&(M===27&&is(o.type)&&(x=o.stateNode),o=o.child,o!==null))for(y(o,d,x),o=o.sibling;o!==null;)y(o,d,x),o=o.sibling}function b(o){var d=o.stateNode,x=o.memoizedProps;try{for(var M=o.type,z=d.attributes;z.length;)d.removeAttributeNode(z[0]);Wa(d,M,x),d[ee]=o,d[ae]=x}catch(q){ts(o,o.return,q)}}var C=!1,I=!1,O=!1,k=typeof WeakSet=="function"?WeakSet:Set,U=null;function V(o,d){if(o=o.containerInfo,$d=lg,o=yp(o),ah(o)){if("selectionStart"in o)var x={start:o.selectionStart,end:o.selectionEnd};else e:{x=(x=o.ownerDocument)&&x.defaultView||window;var M=x.getSelection&&x.getSelection();if(M&&M.rangeCount!==0){x=M.anchorNode;var z=M.anchorOffset,q=M.focusNode;M=M.focusOffset;try{x.nodeType,q.nodeType}catch{x=null;break e}var ue=0,Oe=-1,it=-1,Ft=0,ui=0,xi=o,jt=null;t:for(;;){for(var qt;xi!==x||z!==0&&xi.nodeType!==3||(Oe=ue+z),xi!==q||M!==0&&xi.nodeType!==3||(it=ue+M),xi.nodeType===3&&(ue+=xi.nodeValue.length),(qt=xi.firstChild)!==null;)jt=xi,xi=qt;for(;;){if(xi===o)break t;if(jt===x&&++Ft===z&&(Oe=ue),jt===q&&++ui===M&&(it=ue),(qt=xi.nextSibling)!==null)break;xi=jt,jt=xi.parentNode}xi=qt}x=Oe===-1||it===-1?null:{start:Oe,end:it}}else x=null}x=x||{start:0,end:0}}else x=null;for(t_={focusedElem:o,selectionRange:x},lg=!1,U=d;U!==null;)if(d=U,o=d.child,(d.subtreeFlags&1024)!==0&&o!==null)o.return=d,U=o;else for(;U!==null;){switch(d=U,q=d.alternate,o=d.flags,d.tag){case 0:break;case 11:case 15:break;case 1:if((o&1024)!==0&&q!==null){o=void 0,x=d,z=q.memoizedProps,q=q.memoizedState,M=x.stateNode;try{var zn=Ql(x.type,z,x.elementType===x.type);o=M.getSnapshotBeforeUpdate(zn,q),M.__reactInternalSnapshotBeforeUpdate=o}catch(Dn){ts(x,x.return,Dn)}}break;case 3:if((o&1024)!==0){if(o=d.stateNode.containerInfo,x=o.nodeType,x===9)Km(o);else if(x===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":Km(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(S(163))}if(o=d.sibling,o!==null){o.return=d.return,U=o;break}U=d.return}}function H(o,d,x){var M=x.flags;switch(x.tag){case 0:case 11:case 15:Ke(o,x),M&4&&Dc(5,x);break;case 1:if(Ke(o,x),M&4)if(o=x.stateNode,d===null)try{o.componentDidMount()}catch(ue){ts(x,x.return,ue)}else{var z=Ql(x.type,d.memoizedProps);d=d.memoizedState;try{o.componentDidUpdate(z,d,o.__reactInternalSnapshotBeforeUpdate)}catch(ue){ts(x,x.return,ue)}}M&64&&rc(x),M&512&&$a(x,x.return);break;case 3:if(Ke(o,x),M&64&&(o=x.updateQueue,o!==null)){if(d=null,x.child!==null)switch(x.child.tag){case 27:case 5:d=x.child.stateNode;break;case 1:d=x.child.stateNode}try{wh(o,d)}catch(ue){ts(x,x.return,ue)}}break;case 27:d===null&&M&4&&b(x);case 26:case 5:Ke(o,x),d===null&&M&4&&u(x),M&512&&$a(x,x.return);break;case 12:Ke(o,x);break;case 13:Ke(o,x),M&4&&ve(o,x),M&64&&(o=x.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(x=Wg.bind(null,x),Ry(o,x))));break;case 22:if(M=x.memoizedState!==null||C,!M){d=d!==null&&d.memoizedState!==null||I,z=C;var q=I;C=M,(I=d)&&!q?mt(o,x,(x.subtreeFlags&8772)!==0):Ke(o,x),C=z,I=q}break;case 30:break;default:Ke(o,x)}}function Q(o){var d=o.alternate;d!==null&&(o.alternate=null,Q(d)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(d=o.stateNode,d!==null&&tt(d)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var X=null,J=!1;function ne(o,d,x){for(x=x.child;x!==null;)oe(o,d,x),x=x.sibling}function oe(o,d,x){if(Ur&&typeof Ur.onCommitFiberUnmount=="function")try{Ur.onCommitFiberUnmount(eo,x)}catch{}switch(x.tag){case 26:I||co(x,d),ne(o,d,x),x.memoizedState?x.memoizedState.count--:x.stateNode&&(x=x.stateNode,x.parentNode.removeChild(x));break;case 27:I||co(x,d);var M=X,z=J;is(x.type)&&(X=x.stateNode,J=!1),ne(o,d,x),nm(x.stateNode),X=M,J=z;break;case 5:I||co(x,d);case 6:if(M=X,z=J,X=null,ne(o,d,x),X=M,J=z,X!==null)if(J)try{(X.nodeType===9?X.body:X.nodeName==="HTML"?X.ownerDocument.body:X).removeChild(x.stateNode)}catch(q){ts(x,d,q)}else try{X.removeChild(x.stateNode)}catch(q){ts(x,d,q)}break;case 18:X!==null&&(J?(o=X,Zd(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,x.stateNode),hm(o)):Zd(X,x.stateNode));break;case 4:M=X,z=J,X=x.stateNode.containerInfo,J=!0,ne(o,d,x),X=M,J=z;break;case 0:case 11:case 14:case 15:I||Lo(2,x,d),I||Lo(4,x,d),ne(o,d,x);break;case 1:I||(co(x,d),M=x.stateNode,typeof M.componentWillUnmount=="function"&&nl(x,d,M)),ne(o,d,x);break;case 21:ne(o,d,x);break;case 22:I=(M=I)||x.memoizedState!==null,ne(o,d,x),I=M;break;default:ne(o,d,x)}}function ve(o,d){if(d.memoizedState===null&&(o=d.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{hm(o)}catch(x){ts(d,d.return,x)}}function Se(o){switch(o.tag){case 13:case 19:var d=o.stateNode;return d===null&&(d=o.stateNode=new k),d;case 22:return o=o.stateNode,d=o._retryCache,d===null&&(d=o._retryCache=new k),d;default:throw Error(S(435,o.tag))}}function Le(o,d){var x=Se(o);d.forEach(function(M){var z=lu.bind(null,o,M);x.has(M)||(x.add(M),M.then(z,z))})}function Ie(o,d){var x=d.deletions;if(x!==null)for(var M=0;M<x.length;M++){var z=x[M],q=o,ue=d,Oe=ue;e:for(;Oe!==null;){switch(Oe.tag){case 27:if(is(Oe.type)){X=Oe.stateNode,J=!1;break e}break;case 5:X=Oe.stateNode,J=!1;break e;case 3:case 4:X=Oe.stateNode.containerInfo,J=!0;break e}Oe=Oe.return}if(X===null)throw Error(S(160));oe(q,ue,z),X=null,J=!1,q=z.alternate,q!==null&&(q.return=null),z.return=null}if(d.subtreeFlags&13878)for(d=d.child;d!==null;)Ae(d,o),d=d.sibling}var Ce=null;function Ae(o,d){var x=o.alternate,M=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Ie(d,o),Pe(o),M&4&&(Lo(3,o,o.return),Dc(3,o),Lo(5,o,o.return));break;case 1:Ie(d,o),Pe(o),M&512&&(I||x===null||co(x,x.return)),M&64&&C&&(o=o.updateQueue,o!==null&&(M=o.callbacks,M!==null&&(x=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=x===null?M:x.concat(M))));break;case 26:var z=Ce;if(Ie(d,o),Pe(o),M&512&&(I||x===null||co(x,x.return)),M&4){var q=x!==null?x.memoizedState:null;if(M=o.memoizedState,x===null)if(M===null)if(o.stateNode===null){e:{M=o.type,x=o.memoizedProps,z=z.ownerDocument||z;t:switch(M){case"title":q=z.getElementsByTagName("title")[0],(!q||q[Ue]||q[ee]||q.namespaceURI==="http://www.w3.org/2000/svg"||q.hasAttribute("itemprop"))&&(q=z.createElement(M),z.head.insertBefore(q,z.querySelector("head > title"))),Wa(q,M,x),q[ee]=o,si(q),M=q;break e;case"link":var ue=zy("link","href",z).get(M+(x.href||""));if(ue){for(var Oe=0;Oe<ue.length;Oe++)if(q=ue[Oe],q.getAttribute("href")===(x.href==null||x.href===""?null:x.href)&&q.getAttribute("rel")===(x.rel==null?null:x.rel)&&q.getAttribute("title")===(x.title==null?null:x.title)&&q.getAttribute("crossorigin")===(x.crossOrigin==null?null:x.crossOrigin)){ue.splice(Oe,1);break t}}q=z.createElement(M),Wa(q,M,x),z.head.appendChild(q);break;case"meta":if(ue=zy("meta","content",z).get(M+(x.content||""))){for(Oe=0;Oe<ue.length;Oe++)if(q=ue[Oe],q.getAttribute("content")===(x.content==null?null:""+x.content)&&q.getAttribute("name")===(x.name==null?null:x.name)&&q.getAttribute("property")===(x.property==null?null:x.property)&&q.getAttribute("http-equiv")===(x.httpEquiv==null?null:x.httpEquiv)&&q.getAttribute("charset")===(x.charSet==null?null:x.charSet)){ue.splice(Oe,1);break t}}q=z.createElement(M),Wa(q,M,x),z.head.appendChild(q);break;default:throw Error(S(468,M))}q[ee]=o,si(q),M=q}o.stateNode=M}else ky(z,o.type,o.stateNode);else o.stateNode=Lc(z,M,o.memoizedProps);else q!==M?(q===null?x.stateNode!==null&&(x=x.stateNode,x.parentNode.removeChild(x)):q.count--,M===null?ky(z,o.type,o.stateNode):Lc(z,M,o.memoizedProps)):M===null&&o.stateNode!==null&&t(o,o.memoizedProps,x.memoizedProps)}break;case 27:Ie(d,o),Pe(o),M&512&&(I||x===null||co(x,x.return)),x!==null&&M&4&&t(o,o.memoizedProps,x.memoizedProps);break;case 5:if(Ie(d,o),Pe(o),M&512&&(I||x===null||co(x,x.return)),o.flags&32){z=o.stateNode;try{Ks(z,"")}catch(qt){ts(o,o.return,qt)}}M&4&&o.stateNode!=null&&(z=o.memoizedProps,t(o,z,x!==null?x.memoizedProps:z)),M&1024&&(O=!0);break;case 6:if(Ie(d,o),Pe(o),M&4){if(o.stateNode===null)throw Error(S(162));M=o.memoizedProps,x=o.stateNode;try{x.nodeValue=M}catch(qt){ts(o,o.return,qt)}}break;case 3:if(rg=null,z=Ce,Ce=Qf(d.containerInfo),Ie(d,o),Ce=z,Pe(o),M&4&&x!==null&&x.memoizedState.isDehydrated)try{hm(d.containerInfo)}catch(qt){ts(o,o.return,qt)}O&&(O=!1,Ne(o));break;case 4:M=Ce,Ce=Qf(o.stateNode.containerInfo),Ie(d,o),Pe(o),Ce=M;break;case 12:Ie(d,o),Pe(o);break;case 13:Ie(d,o),Pe(o),o.child.flags&8192&&o.memoizedState!==null!=(x!==null&&x.memoizedState!==null)&&(nr=gs()),M&4&&(M=o.updateQueue,M!==null&&(o.updateQueue=null,Le(o,M)));break;case 22:z=o.memoizedState!==null;var it=x!==null&&x.memoizedState!==null,Ft=C,ui=I;if(C=Ft||z,I=ui||it,Ie(d,o),I=ui,C=Ft,Pe(o),M&8192)e:for(d=o.stateNode,d._visibility=z?d._visibility&-2:d._visibility|1,z&&(x===null||it||C||I||Je(o)),x=null,d=o;;){if(d.tag===5||d.tag===26){if(x===null){it=x=d;try{if(q=it.stateNode,z)ue=q.style,typeof ue.setProperty=="function"?ue.setProperty("display","none","important"):ue.display="none";else{Oe=it.stateNode;var xi=it.memoizedProps.style,jt=xi!=null&&xi.hasOwnProperty("display")?xi.display:null;Oe.style.display=jt==null||typeof jt=="boolean"?"":(""+jt).trim()}}catch(qt){ts(it,it.return,qt)}}}else if(d.tag===6){if(x===null){it=d;try{it.stateNode.nodeValue=z?"":it.memoizedProps}catch(qt){ts(it,it.return,qt)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===o)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===o)break e;for(;d.sibling===null;){if(d.return===null||d.return===o)break e;x===d&&(x=null),d=d.return}x===d&&(x=null),d.sibling.return=d.return,d=d.sibling}M&4&&(M=o.updateQueue,M!==null&&(x=M.retryQueue,x!==null&&(M.retryQueue=null,Le(o,x))));break;case 19:Ie(d,o),Pe(o),M&4&&(M=o.updateQueue,M!==null&&(o.updateQueue=null,Le(o,M)));break;case 30:break;case 21:break;default:Ie(d,o),Pe(o)}}function Pe(o){var d=o.flags;if(d&2){try{for(var x,M=o.return;M!==null;){if(s(M)){x=M;break}M=M.return}if(x==null)throw Error(S(160));switch(x.tag){case 27:var z=x.stateNode,q=h(o);y(o,q,z);break;case 5:var ue=x.stateNode;x.flags&32&&(Ks(ue,""),x.flags&=-33);var Oe=h(o);y(o,Oe,ue);break;case 3:case 4:var it=x.stateNode.containerInfo,Ft=h(o);_(o,Ft,it);break;default:throw Error(S(161))}}catch(ui){ts(o,o.return,ui)}o.flags&=-3}d&4096&&(o.flags&=-4097)}function Ne(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var d=o;Ne(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),o=o.sibling}}function Ke(o,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)H(o,d.alternate,d),d=d.sibling}function Je(o){for(o=o.child;o!==null;){var d=o;switch(d.tag){case 0:case 11:case 14:case 15:Lo(4,d,d.return),Je(d);break;case 1:co(d,d.return);var x=d.stateNode;typeof x.componentWillUnmount=="function"&&nl(d,d.return,x),Je(d);break;case 27:nm(d.stateNode);case 26:case 5:co(d,d.return),Je(d);break;case 22:d.memoizedState===null&&Je(d);break;case 30:Je(d);break;default:Je(d)}o=o.sibling}}function mt(o,d,x){for(x=x&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var M=d.alternate,z=o,q=d,ue=q.flags;switch(q.tag){case 0:case 11:case 15:mt(z,q,x),Dc(4,q);break;case 1:if(mt(z,q,x),M=q,z=M.stateNode,typeof z.componentDidMount=="function")try{z.componentDidMount()}catch(Ft){ts(M,M.return,Ft)}if(M=q,z=M.updateQueue,z!==null){var Oe=M.stateNode;try{var it=z.shared.hiddenCallbacks;if(it!==null)for(z.shared.hiddenCallbacks=null,z=0;z<it.length;z++)bh(it[z],Oe)}catch(Ft){ts(M,M.return,Ft)}}x&&ue&64&&rc(q),$a(q,q.return);break;case 27:b(q);case 26:case 5:mt(z,q,x),x&&M===null&&ue&4&&u(q),$a(q,q.return);break;case 12:mt(z,q,x);break;case 13:mt(z,q,x),x&&ue&4&&ve(z,q);break;case 22:q.memoizedState===null&&mt(z,q,x),$a(q,q.return);break;case 30:break;default:mt(z,q,x)}d=d.sibling}}function xt(o,d){var x=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(x=o.memoizedState.cachePool.pool),o=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(o=d.memoizedState.cachePool.pool),o!==x&&(o!=null&&o.refCount++,x!=null&&Ec(x))}function Pt(o,d){o=null,d.alternate!==null&&(o=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==o&&(d.refCount++,o!=null&&Ec(o))}function Ze(o,d,x,M){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)lt(o,d,x,M),d=d.sibling}function lt(o,d,x,M){var z=d.flags;switch(d.tag){case 0:case 11:case 15:Ze(o,d,x,M),z&2048&&Dc(9,d);break;case 1:Ze(o,d,x,M);break;case 3:Ze(o,d,x,M),z&2048&&(o=null,d.alternate!==null&&(o=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==o&&(d.refCount++,o!=null&&Ec(o)));break;case 12:if(z&2048){Ze(o,d,x,M),o=d.stateNode;try{var q=d.memoizedProps,ue=q.id,Oe=q.onPostCommit;typeof Oe=="function"&&Oe(ue,d.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(it){ts(d,d.return,it)}}else Ze(o,d,x,M);break;case 13:Ze(o,d,x,M);break;case 23:break;case 22:q=d.stateNode,ue=d.alternate,d.memoizedState!==null?q._visibility&2?Ze(o,d,x,M):bt(o,d):q._visibility&2?Ze(o,d,x,M):(q._visibility|=2,Ge(o,d,x,M,(d.subtreeFlags&10256)!==0)),z&2048&&xt(ue,d);break;case 24:Ze(o,d,x,M),z&2048&&Pt(d.alternate,d);break;default:Ze(o,d,x,M)}}function Ge(o,d,x,M,z){for(z=z&&(d.subtreeFlags&10256)!==0,d=d.child;d!==null;){var q=o,ue=d,Oe=x,it=M,Ft=ue.flags;switch(ue.tag){case 0:case 11:case 15:Ge(q,ue,Oe,it,z),Dc(8,ue);break;case 23:break;case 22:var ui=ue.stateNode;ue.memoizedState!==null?ui._visibility&2?Ge(q,ue,Oe,it,z):bt(q,ue):(ui._visibility|=2,Ge(q,ue,Oe,it,z)),z&&Ft&2048&&xt(ue.alternate,ue);break;case 24:Ge(q,ue,Oe,it,z),z&&Ft&2048&&Pt(ue.alternate,ue);break;default:Ge(q,ue,Oe,it,z)}d=d.sibling}}function bt(o,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var x=o,M=d,z=M.flags;switch(M.tag){case 22:bt(x,M),z&2048&&xt(M.alternate,M);break;case 24:bt(x,M),z&2048&&Pt(M.alternate,M);break;default:bt(x,M)}d=d.sibling}}var st=8192;function Ct(o){if(o.subtreeFlags&st)for(o=o.child;o!==null;)Wt(o),o=o.sibling}function Wt(o){switch(o.tag){case 26:Ct(o),o.flags&st&&o.memoizedState!==null&&sg(Ce,o.memoizedState,o.memoizedProps);break;case 5:Ct(o);break;case 3:case 4:var d=Ce;Ce=Qf(o.stateNode.containerInfo),Ct(o),Ce=d;break;case 22:o.memoizedState===null&&(d=o.alternate,d!==null&&d.memoizedState!==null?(d=st,st=16777216,Ct(o),st=d):Ct(o));break;default:Ct(o)}}function wt(o){var d=o.alternate;if(d!==null&&(o=d.child,o!==null)){d.child=null;do d=o.sibling,o.sibling=null,o=d;while(o!==null)}}function Vt(o){var d=o.deletions;if((o.flags&16)!==0){if(d!==null)for(var x=0;x<d.length;x++){var M=d[x];U=M,hi(M,o)}wt(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)gi(o),o=o.sibling}function gi(o){switch(o.tag){case 0:case 11:case 15:Vt(o),o.flags&2048&&Lo(9,o,o.return);break;case 3:Vt(o);break;case 12:Vt(o);break;case 22:var d=o.stateNode;o.memoizedState!==null&&d._visibility&2&&(o.return===null||o.return.tag!==13)?(d._visibility&=-3,di(o)):Vt(o);break;default:Vt(o)}}function di(o){var d=o.deletions;if((o.flags&16)!==0){if(d!==null)for(var x=0;x<d.length;x++){var M=d[x];U=M,hi(M,o)}wt(o)}for(o=o.child;o!==null;){switch(d=o,d.tag){case 0:case 11:case 15:Lo(8,d,d.return),di(d);break;case 22:x=d.stateNode,x._visibility&2&&(x._visibility&=-3,di(d));break;default:di(d)}o=o.sibling}}function hi(o,d){for(;U!==null;){var x=U;switch(x.tag){case 0:case 11:case 15:Lo(8,x,d);break;case 23:case 22:if(x.memoizedState!==null&&x.memoizedState.cachePool!==null){var M=x.memoizedState.cachePool.pool;M!=null&&M.refCount++}break;case 24:Ec(x.memoizedState.cache)}if(M=x.child,M!==null)M.return=x,U=M;else e:for(x=o;U!==null;){M=U;var z=M.sibling,q=M.return;if(Q(M),M===x){U=null;break e}if(z!==null){z.return=q,U=z;break e}U=q}}}var Ai={getCacheForType:function(o){var d=ha(Gr),x=d.data.get(o);return x===void 0&&(x=o(),d.data.set(o,x)),x}},Pi=typeof WeakMap=="function"?WeakMap:Map,fi=0,Ci=null,Ri=null,$i=0,rn=0,_n=null,Ln=!1,Ar=!1,Ki=!1,Wi=0,Ui=0,Zn=0,Hr=0,sr=0,gn=0,_r=0,yn=null,ar=null,ur=!1,nr=0,or=1/0,Nn=null,pr=null,Cr=0,Qn=null,An=null,na=0,Ia=0,uo=null,rl=null,Za=0,Ra=null;function qs(){if((fi&2)!==0&&$i!==0)return $i&-$i;if(Qe.T!==null){var o=Qc;return o!==0?o:Qp()}return xa()}function sl(){gn===0&&(gn=($i&536870912)===0||jr?ya():536870912);var o=ta.current;return o!==null&&(o.flags|=32),gn}function $s(o,d,x){(o===Ci&&(rn===2||rn===9)||o.cancelPendingCommit!==null)&&(Pc(o,0),sc(o,$i,gn,!1)),dl(o,x),((fi&2)===0||o!==Ci)&&(o===Ci&&((fi&2)===0&&(Hr|=x),Ui===4&&sc(o,$i,gn,!1)),Oc(o))}function Nh(o,d,x){if((fi&6)!==0)throw Error(S(327));var M=!x&&(d&124)===0&&(d&o.expiredLanes)===0||_a(o,d),z=M?Um(o,d):Xp(o,d,!0),q=M;do{if(z===0){Ar&&!M&&sc(o,d,0,!1);break}else{if(x=o.current.alternate,q&&!Fh(x)){z=Xp(o,d,!1),q=!1;continue}if(z===2){if(q=d,o.errorRecoveryDisabledLanes&q)var ue=0;else ue=o.pendingLanes&-536870913,ue=ue!==0?ue:ue&536870912?536870912:0;if(ue!==0){d=ue;e:{var Oe=o;z=yn;var it=Oe.current.memoizedState.isDehydrated;if(it&&(Pc(Oe,ue).flags|=256),ue=Xp(Oe,ue,!1),ue!==2){if(Ki&&!it){Oe.errorRecoveryDisabledLanes|=q,Hr|=q,z=4;break e}q=ar,ar=z,q!==null&&(ar===null?ar=q:ar.push.apply(ar,q))}z=ue}if(q=!1,z!==2)continue}}if(z===1){Pc(o,0),sc(o,d,0,!0);break}e:{switch(M=o,q=z,q){case 0:case 1:throw Error(S(345));case 4:if((d&4194048)!==d)break;case 6:sc(M,d,gn,!Ln);break e;case 2:ar=null;break;case 3:case 5:break;default:throw Error(S(329))}if((d&62914560)===d&&(z=nr+300-gs(),10<z)){if(sc(M,d,gn,!Ln),oa(M,0,!0)!==0)break e;M.timeoutHandle=Ym(qf.bind(null,M,x,ar,Nn,ur,d,gn,Hr,_r,Ln,q,2,-0,0),z);break e}qf(M,x,ar,Nn,ur,d,gn,Hr,_r,Ln,q,0,-0,0)}}break}while(!0);Oc(o)}function qf(o,d,x,M,z,q,ue,Oe,it,Ft,ui,xi,jt,qt){if(o.timeoutHandle=-1,xi=d.subtreeFlags,(xi&8192||(xi&16785408)===16785408)&&(Gh={stylesheets:null,count:0,unsuspend:Fy},Wt(d),xi=By(),xi!==null)){o.cancelPendingCommit=xi(qg.bind(null,o,d,q,x,M,z,ue,Oe,it,ui,1,jt,qt)),sc(o,q,ue,!Ft);return}qg(o,d,q,x,M,z,ue,Oe,it)}function Fh(o){for(var d=o;;){var x=d.tag;if((x===0||x===11||x===15)&&d.flags&16384&&(x=d.updateQueue,x!==null&&(x=x.stores,x!==null)))for(var M=0;M<x.length;M++){var z=x[M],q=z.getSnapshot;z=z.value;try{if(!Io(q(),z))return!1}catch{return!1}}if(x=d.child,d.subtreeFlags&16384&&x!==null)x.return=d,d=x;else{if(d===o)break;for(;d.sibling===null;){if(d.return===null||d.return===o)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function sc(o,d,x,M){d&=~sr,d&=~Hr,o.suspendedLanes|=d,o.pingedLanes&=~d,M&&(o.warmLanes|=d),M=o.expirationTimes;for(var z=d;0<z;){var q=31-_s(z),ue=1<<q;M[q]=-1,z&=~ue}x!==0&&Fa(o,x,d)}function au(){return(fi&6)===0?(Vh(0),!1):!0}function Bh(){if(Ri!==null){if(rn===0)var o=Ri.return;else o=Ri,Nl=bo=null,$l(o),nu=null,So=0,o=Ri;for(;o!==null;)Hf(o.alternate,o),o=o.return;Ri=null}}function Pc(o,d){var x=o.timeoutHandle;x!==-1&&(o.timeoutHandle=-1,T0(x)),x=o.cancelPendingCommit,x!==null&&(o.cancelPendingCommit=null,x()),Bh(),Ci=o,Ri=x=yc(o.current,null),$i=d,rn=0,_n=null,Ln=!1,Ar=_a(o,d),Ki=!1,_r=gn=sr=Hr=Zn=Ui=0,ar=yn=null,ur=!1,(d&8)!==0&&(d|=d&32);var M=o.entangledLanes;if(M!==0)for(o=o.entanglements,M&=d;0<M;){var z=31-_s(M),q=1<<z;d|=o[z],M&=~q}return Wi=d,Gc(),x}function Al(o,d){cr=null,Qe.H=Tl,d===vd||d===wf?(d=eu(),rn=3):d===Pm?(d=eu(),rn=4):rn=d===Gp?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,_n=d,Ri===null&&(Ui=1,ru(o,Kt(d,o.current)))}function Gu(){var o=Qe.H;return Qe.H=Tl,o===null?Tl:o}function ou(){var o=Qe.A;return Qe.A=Ai,o}function ac(){Ui=4,Ln||($i&4194048)!==$i&&ta.current!==null||(Ar=!0),(Zn&134217727)===0&&(Hr&134217727)===0||Ci===null||sc(Ci,$i,gn,!1)}function Xp(o,d,x){var M=fi;fi|=2;var z=Gu(),q=ou();(Ci!==o||$i!==d)&&(Nn=null,Pc(o,d)),d=!1;var ue=Ui;e:do try{if(rn!==0&&Ri!==null){var Oe=Ri,it=_n;switch(rn){case 8:Bh(),ue=6;break e;case 3:case 2:case 9:case 6:ta.current===null&&(d=!0);var Ft=rn;if(rn=0,_n=null,Bd(o,Oe,it,Ft),x&&Ar){ue=0;break e}break;default:Ft=rn,rn=0,_n=null,Bd(o,Oe,it,Ft)}}$f(),ue=Ui;break}catch(ui){Al(o,ui)}while(!0);return d&&o.shellSuspendCounter++,Nl=bo=null,fi=M,Qe.H=z,Qe.A=q,Ri===null&&(Ci=null,$i=0,Gc()),ue}function $f(){for(;Ri!==null;)Gg(Ri)}function Um(o,d){var x=fi;fi|=2;var M=Gu(),z=ou();Ci!==o||$i!==d?(Nn=null,or=gs()+500,Pc(o,d)):Ar=_a(o,d);e:do try{if(rn!==0&&Ri!==null){d=Ri;var q=_n;t:switch(rn){case 1:rn=0,_n=null,Bd(o,d,q,1);break;case 2:case 9:if(Om(q)){rn=0,_n=null,Hg(d);break}d=function(){rn!==2&&rn!==9||Ci!==o||(rn=7),Oc(o)},q.then(d,d);break e;case 3:rn=7;break e;case 4:rn=5;break e;case 7:Om(q)?(rn=0,_n=null,Hg(d)):(rn=0,_n=null,Bd(o,d,q,7));break;case 5:var ue=null;switch(Ri.tag){case 26:ue=Ri.memoizedState;case 5:case 27:var Oe=Ri;if(!ue||Ny(ue)){rn=0,_n=null;var it=Oe.sibling;if(it!==null)Ri=it;else{var Ft=Oe.return;Ft!==null?(Ri=Ft,Yp(Ft)):Ri=null}break t}}rn=0,_n=null,Bd(o,d,q,5);break;case 6:rn=0,_n=null,Bd(o,d,q,6);break;case 8:Bh(),Ui=6;break e;default:throw Error(S(462))}}my();break}catch(ui){Al(o,ui)}while(!0);return Nl=bo=null,Qe.H=M,Qe.A=z,fi=x,Ri!==null?0:(Ci=null,$i=0,Gc(),Ui)}function my(){for(;Ri!==null&&!Fn();)Gg(Ri)}function Gg(o){var d=kh(o.alternate,o,Wi);o.memoizedProps=o.pendingProps,d===null?Yp(o):Ri=d}function Hg(o){var d=o,x=d.alternate;switch(d.tag){case 15:case 0:d=jm(x,d,d.pendingProps,d.type,void 0,$i);break;case 11:d=jm(x,d,d.pendingProps,d.type.render,d.ref,$i);break;case 5:$l(d);default:Hf(x,d),d=Ri=Dr(d,Wi),d=kh(x,d,Wi)}o.memoizedProps=o.pendingProps,d===null?Yp(o):Ri=d}function Bd(o,d,x,M){Nl=bo=null,$l(d),nu=null,So=0;var z=d.return;try{if(Bm(o,z,d,x,$i)){Ui=1,ru(o,Kt(x,o.current)),Ri=null;return}}catch(q){if(z!==null)throw Ri=z,q;Ui=1,ru(o,Kt(x,o.current)),Ri=null;return}d.flags&32768?(jr||M===1?o=!0:Ar||($i&536870912)!==0?o=!1:(Ln=o=!0,(M===2||M===9||M===3||M===6)&&(M=ta.current,M!==null&&M.tag===13&&(M.flags|=16384))),jh(d,o)):Yp(d)}function Yp(o){var d=o;do{if((d.flags&32768)!==0){jh(d,Ln);return}o=d.return;var x=nc(d.alternate,d,Wi);if(x!==null){Ri=x;return}if(d=d.sibling,d!==null){Ri=d;return}Ri=d=o}while(d!==null);Ui===0&&(Ui=5)}function jh(o,d){do{var x=Fd(o.alternate,o);if(x!==null){x.flags&=32767,Ri=x;return}if(x=o.return,x!==null&&(x.flags|=32768,x.subtreeFlags=0,x.deletions=null),!d&&(o=o.sibling,o!==null)){Ri=o;return}Ri=o=x}while(o!==null);Ui=6,Ri=null}function qg(o,d,x,M,z,q,ue,Oe,it){o.cancelPendingCommit=null;do Vd();while(Cr!==0);if((fi&6)!==0)throw Error(S(327));if(d!==null){if(d===o.current)throw Error(S(177));if(q=d.lanes|d.childLanes,q|=Uc,to(o,x,q,ue,Oe,it),o===Ci&&(Ri=Ci=null,$i=0),An=d,Qn=o,na=x,Ia=q,uo=z,rl=M,(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,Hu(Jr,function(){return yy(),null})):(o.callbackNode=null,o.callbackPriority=0),M=(d.flags&13878)!==0,(d.subtreeFlags&13878)!==0||M){M=Qe.T,Qe.T=null,z=kt.p,kt.p=2,ue=fi,fi|=4;try{V(o,d,x)}finally{fi=ue,kt.p=z,Qe.T=M}}Cr=1,Da(),jd(),gy()}}function Da(){if(Cr===1){Cr=0;var o=Qn,d=An,x=(d.flags&13878)!==0;if((d.subtreeFlags&13878)!==0||x){x=Qe.T,Qe.T=null;var M=kt.p;kt.p=2;var z=fi;fi|=4;try{Ae(d,o);var q=t_,ue=yp(o.containerInfo),Oe=q.focusedElem,it=q.selectionRange;if(ue!==Oe&&Oe&&Oe.ownerDocument&&bu(Oe.ownerDocument.documentElement,Oe)){if(it!==null&&ah(Oe)){var Ft=it.start,ui=it.end;if(ui===void 0&&(ui=Ft),"selectionStart"in Oe)Oe.selectionStart=Ft,Oe.selectionEnd=Math.min(ui,Oe.value.length);else{var xi=Oe.ownerDocument||document,jt=xi&&xi.defaultView||window;if(jt.getSelection){var qt=jt.getSelection(),zn=Oe.textContent.length,Dn=Math.min(it.start,zn),Yr=it.end===void 0?Dn:Math.min(it.end,zn);!qt.extend&&Dn>Yr&&(ue=Yr,Yr=Dn,Dn=ue);var Mt=jc(Oe,Dn),_t=jc(Oe,Yr);if(Mt&&_t&&(qt.rangeCount!==1||qt.anchorNode!==Mt.node||qt.anchorOffset!==Mt.offset||qt.focusNode!==_t.node||qt.focusOffset!==_t.offset)){var zt=xi.createRange();zt.setStart(Mt.node,Mt.offset),qt.removeAllRanges(),Dn>Yr?(qt.addRange(zt),qt.extend(_t.node,_t.offset)):(zt.setEnd(_t.node,_t.offset),qt.addRange(zt))}}}}for(xi=[],qt=Oe;qt=qt.parentNode;)qt.nodeType===1&&xi.push({element:qt,left:qt.scrollLeft,top:qt.scrollTop});for(typeof Oe.focus=="function"&&Oe.focus(),Oe=0;Oe<xi.length;Oe++){var ci=xi[Oe];ci.element.scrollLeft=ci.left,ci.element.scrollTop=ci.top}}lg=!!$d,t_=$d=null}finally{fi=z,kt.p=M,Qe.T=x}}o.current=d,Cr=2}}function jd(){if(Cr===2){Cr=0;var o=Qn,d=An,x=(d.flags&8772)!==0;if((d.subtreeFlags&8772)!==0||x){x=Qe.T,Qe.T=null;var M=kt.p;kt.p=2;var z=fi;fi|=4;try{H(o,d.alternate,d)}finally{fi=z,kt.p=M,Qe.T=x}}Cr=3}}function gy(){if(Cr===4||Cr===3){Cr=0,Qr();var o=Qn,d=An,x=na,M=rl;(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?Cr=5:(Cr=0,An=Qn=null,_y(o,o.pendingLanes));var z=o.pendingLanes;if(z===0&&(pr=null),va(x),d=d.stateNode,Ur&&typeof Ur.onCommitFiberRoot=="function")try{Ur.onCommitFiberRoot(eo,d,void 0,(d.current.flags&128)===128)}catch{}if(M!==null){d=Qe.T,z=kt.p,kt.p=2,Qe.T=null;try{for(var q=o.onRecoverableError,ue=0;ue<M.length;ue++){var Oe=M[ue];q(Oe.value,{componentStack:Oe.stack})}}finally{Qe.T=d,kt.p=z}}(na&3)!==0&&Vd(),Oc(o),z=o.pendingLanes,(x&4194090)!==0&&(z&42)!==0?o===Ra?Za++:(Za=0,Ra=o):Za=0,Vh(0)}}function _y(o,d){(o.pooledCacheLanes&=d)===0&&(d=o.pooledCache,d!=null&&(o.pooledCache=null,Ec(d)))}function Vd(o){return Da(),jd(),gy(),yy()}function yy(){if(Cr!==5)return!1;var o=Qn,d=Ia;Ia=0;var x=va(na),M=Qe.T,z=kt.p;try{kt.p=32>x?32:x,Qe.T=null,x=uo,uo=null;var q=Qn,ue=na;if(Cr=0,An=Qn=null,na=0,(fi&6)!==0)throw Error(S(331));var Oe=fi;if(fi|=4,gi(q.current),lt(q,q.current,ue,x),fi=Oe,Vh(0,!1),Ur&&typeof Ur.onPostCommitFiberRoot=="function")try{Ur.onPostCommitFiberRoot(eo,q)}catch{}return!0}finally{kt.p=z,Qe.T=M,_y(o,d)}}function $g(o,d,x){d=Kt(x,d),d=Lh(o.stateNode,d,2),o=Cc(o,d,2),o!==null&&(dl(o,2),Oc(o))}function ts(o,d,x){if(o.tag===3)$g(o,o,x);else for(;d!==null;){if(d.tag===3){$g(d,o,x);break}else if(d.tag===1){var M=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof M.componentDidCatch=="function"&&(pr===null||!pr.has(M))){o=Kt(x,o),x=Up(2),M=Cc(d,x,2),M!==null&&(Od(x,M,d,o),dl(M,2),Oc(M));break}}d=d.return}}function Zg(o,d,x){var M=o.pingCache;if(M===null){M=o.pingCache=new Pi;var z=new Set;M.set(d,z)}else z=M.get(d),z===void 0&&(z=new Set,M.set(d,z));z.has(x)||(Ki=!0,z.add(x),o=vy.bind(null,o,d,x),d.then(o,o))}function vy(o,d,x){var M=o.pingCache;M!==null&&M.delete(d),o.pingedLanes|=o.suspendedLanes&x,o.warmLanes&=~x,Ci===o&&($i&x)===x&&(Ui===4||Ui===3&&($i&62914560)===$i&&300>gs()-nr?(fi&2)===0&&Pc(o,0):sr|=x,_r===$i&&(_r=0)),Oc(o)}function xy(o,d){d===0&&(d=Co()),o=_c(o,d),o!==null&&(dl(o,d),Oc(o))}function Wg(o){var d=o.memoizedState,x=0;d!==null&&(x=d.retryLane),xy(o,x)}function lu(o,d){var x=0;switch(o.tag){case 13:var M=o.stateNode,z=o.memoizedState;z!==null&&(x=z.retryLane);break;case 19:M=o.stateNode;break;case 22:M=o.stateNode._retryCache;break;default:throw Error(S(314))}M!==null&&M.delete(d),xy(o,x)}function Hu(o,d){return Qi(o,d)}var Kp=null,Ud=null,Zf=!1,Wf=!1,Gd=!1,cu=0;function Oc(o){o!==Ud&&o.next===null&&(Ud===null?Kp=Ud=o:Ud=Ud.next=o),Wf=!0,Zf||(Zf=!0,by())}function Vh(o,d){if(!Gd&&Wf){Gd=!0;do for(var x=!1,M=Kp;M!==null;){if(o!==0){var z=M.pendingLanes;if(z===0)var q=0;else{var ue=M.suspendedLanes,Oe=M.pingedLanes;q=(1<<31-_s(42|o)+1)-1,q&=z&~(ue&~Oe),q=q&201326741?q&201326741|1:q?q|2:0}q!==0&&(x=!0,qu(M,q))}else q=$i,q=oa(M,M===Ci?q:0,M.cancelPendingCommit!==null||M.timeoutHandle!==-1),(q&3)===0||_a(M,q)||(x=!0,qu(M,q));M=M.next}while(x);Gd=!1}}function Xg(){Gm()}function Gm(){Wf=Zf=!1;var o=0;cu!==0&&(w0()&&(o=cu),cu=0);for(var d=gs(),x=null,M=Kp;M!==null;){var z=M.next,q=Yg(M,d);q===0?(M.next=null,x===null?Kp=z:x.next=z,z===null&&(Ud=x)):(x=M,(o!==0||(q&3)!==0)&&(Wf=!0)),M=z}Vh(o)}function Yg(o,d){for(var x=o.suspendedLanes,M=o.pingedLanes,z=o.expirationTimes,q=o.pendingLanes&-62914561;0<q;){var ue=31-_s(q),Oe=1<<ue,it=z[ue];it===-1?((Oe&x)===0||(Oe&M)!==0)&&(z[ue]=On(Oe,d)):it<=d&&(o.expiredLanes|=Oe),q&=~Oe}if(d=Ci,x=$i,x=oa(o,o===d?x:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),M=o.callbackNode,x===0||o===d&&(rn===2||rn===9)||o.cancelPendingCommit!==null)return M!==null&&M!==null&&Zr(M),o.callbackNode=null,o.callbackPriority=0;if((x&3)===0||_a(o,x)){if(d=x&-x,d===o.callbackPriority)return d;switch(M!==null&&Zr(M),va(x)){case 2:case 8:x=Nr;break;case 32:x=Jr;break;case 268435456:x=Ja;break;default:x=Jr}return M=Kg.bind(null,o),x=Qi(x,M),o.callbackPriority=d,o.callbackNode=x,d}return M!==null&&M!==null&&Zr(M),o.callbackPriority=2,o.callbackNode=null,2}function Kg(o,d){if(Cr!==0&&Cr!==5)return o.callbackNode=null,o.callbackPriority=0,null;var x=o.callbackNode;if(Vd()&&o.callbackNode!==x)return null;var M=$i;return M=oa(o,o===Ci?M:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),M===0?null:(Nh(o,M,d),Yg(o,gs()),o.callbackNode!=null&&o.callbackNode===x?Kg.bind(null,o):null)}function qu(o,d){if(Vd())return null;Nh(o,d,!0)}function by(){tm(function(){(fi&6)!==0?Qi(Or,Xg):Gm()})}function Qp(){return cu===0&&(cu=ya()),cu}function Qg(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:ot(""+o)}function wy(o,d){var x=d.ownerDocument.createElement("input");return x.name=d.name,x.value=d.value,o.id&&x.setAttribute("form",o.id),d.parentNode.insertBefore(x,d),o=new FormData(o),x.parentNode.removeChild(x),o}function v0(o,d,x,M,z){if(d==="submit"&&x&&x.stateNode===z){var q=Qg((z[ae]||null).action),ue=M.submitter;ue&&(d=(d=ue[ae]||null)?Qg(d.formAction):ue.getAttribute("formAction"),d!==null&&(q=d,ue=null));var Oe=new Vo("action","action",null,M,z);o.push({event:Oe,listeners:[{instance:null,listener:function(){if(M.defaultPrevented){if(cu!==0){var it=ue?wy(z,ue):new FormData(z);Ch(x,{pending:!0,data:it,method:z.method,action:q},null,it)}}else typeof q=="function"&&(Oe.preventDefault(),it=ue?wy(z,ue):new FormData(z),Ch(x,{pending:!0,data:it,method:z.method,action:q},q,it))},currentTarget:z}]})}}for(var Jg=0;Jg<ch.length;Jg++){var Hm=ch[Jg],Ty=Hm.toLowerCase(),x0=Hm[0].toUpperCase()+Hm.slice(1);Ms(Ty,"on"+x0)}Ms(gf,"onAnimationEnd"),Ms(ca,"onAnimationIteration"),Ms(oh,"onAnimationStart"),Ms("dblclick","onDoubleClick"),Ms("focusin","onFocus"),Ms("focusout","onBlur"),Ms(wp,"onTransitionRun"),Ms(Tp,"onTransitionStart"),Ms(lh,"onTransitionCancel"),Ms(wu,"onTransitionEnd"),Ji("onMouseEnter",["mouseout","mouseover"]),Ji("onMouseLeave",["mouseout","mouseover"]),Ji("onPointerEnter",["pointerout","pointerover"]),Ji("onPointerLeave",["pointerout","pointerover"]),Vi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Vi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Vi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Vi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Vi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Vi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),b0=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Xf));function Sy(o,d){d=(d&4)!==0;for(var x=0;x<o.length;x++){var M=o[x],z=M.event;M=M.listeners;e:{var q=void 0;if(d)for(var ue=M.length-1;0<=ue;ue--){var Oe=M[ue],it=Oe.instance,Ft=Oe.currentTarget;if(Oe=Oe.listener,it!==q&&z.isPropagationStopped())break e;q=Oe,z.currentTarget=Ft;try{q(z)}catch(ui){Jl(ui)}z.currentTarget=null,q=it}else for(ue=0;ue<M.length;ue++){if(Oe=M[ue],it=Oe.instance,Ft=Oe.currentTarget,Oe=Oe.listener,it!==q&&z.isPropagationStopped())break e;q=Oe,z.currentTarget=Ft;try{q(z)}catch(ui){Jl(ui)}z.currentTarget=null,q=it}}}}function br(o,d){var x=d[ke];x===void 0&&(x=d[ke]=new Set);var M=o+"__bubble";x.has(M)||(e_(d,o,2,!1),x.add(M))}function qm(o,d,x){var M=0;d&&(M|=4),e_(x,o,M,d)}var Jp="_reactListening"+Math.random().toString(36).slice(2);function $m(o){if(!o[Jp]){o[Jp]=!0,Bi.forEach(function(x){x!=="selectionchange"&&(b0.has(x)||qm(x,!1,o),qm(x,!0,o))});var d=o.nodeType===9?o:o.ownerDocument;d===null||d[Jp]||(d[Jp]=!0,qm("selectionchange",!1,d))}}function e_(o,d,x,M){switch(am(d)){case 2:var z=R0;break;case 8:z=D0;break;default:z=cg}x=z.bind(null,d,x,o),z=void 0,!Ga||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(z=!0),M?z!==void 0?o.addEventListener(d,x,{capture:!0,passive:z}):o.addEventListener(d,x,!0):z!==void 0?o.addEventListener(d,x,{passive:z}):o.addEventListener(d,x,!1)}function Zm(o,d,x,M,z){var q=M;if((d&1)===0&&(d&2)===0&&M!==null)e:for(;;){if(M===null)return;var ue=M.tag;if(ue===3||ue===4){var Oe=M.stateNode.containerInfo;if(Oe===z)break;if(ue===4)for(ue=M.return;ue!==null;){var it=ue.tag;if((it===3||it===4)&&ue.stateNode.containerInfo===z)return;ue=ue.return}for(;Oe!==null;){if(ue=vt(Oe),ue===null)return;if(it=ue.tag,it===5||it===6||it===26||it===27){M=q=ue;continue e}Oe=Oe.parentNode}}M=M.return}Er(function(){var Ft=q,ui=Si(x),xi=[];e:{var jt=_f.get(o);if(jt!==void 0){var qt=Vo,zn=o;switch(o){case"keypress":if(jo(x)===0)break e;case"keydown":case"keyup":qt=Di;break;case"focusin":zn="focus",qt=Ls;break;case"focusout":zn="blur",qt=Ls;break;case"beforeblur":case"afterblur":qt=Ls;break;case"click":if(x.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qt=es;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qt=Br;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qt=dc;break;case gf:case ca:case oh:qt=ln;break;case wu:qt=df;break;case"scroll":case"scrollend":qt=Tt;break;case"wheel":qt=sd;break;case"copy":case"cut":case"paste":qt=go;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qt=Un;break;case"toggle":case"beforetoggle":qt=Ts}var Dn=(d&4)!==0,Yr=!Dn&&(o==="scroll"||o==="scrollend"),Mt=Dn?jt!==null?jt+"Capture":null:jt;Dn=[];for(var _t=Ft,zt;_t!==null;){var ci=_t;if(zt=ci.stateNode,ci=ci.tag,ci!==5&&ci!==26&&ci!==27||zt===null||Mt===null||(ci=en(_t,Mt),ci!=null&&Dn.push(Yf(_t,ci,zt))),Yr)break;_t=_t.return}0<Dn.length&&(jt=new qt(jt,zn,null,x,ui),xi.push({event:jt,listeners:Dn}))}}if((d&7)===0){e:{if(jt=o==="mouseover"||o==="pointerover",qt=o==="mouseout"||o==="pointerout",jt&&x!==Ht&&(zn=x.relatedTarget||x.fromElement)&&(vt(zn)||zn[xe]))break e;if((qt||jt)&&(jt=ui.window===ui?ui:(jt=ui.ownerDocument)?jt.defaultView||jt.parentWindow:window,qt?(zn=x.relatedTarget||x.toElement,qt=Ft,zn=zn?vt(zn):null,zn!==null&&(Yr=L(zn),Dn=zn.tag,zn!==Yr||Dn!==5&&Dn!==27&&Dn!==6)&&(zn=null)):(qt=null,zn=Ft),qt!==zn)){if(Dn=es,ci="onMouseLeave",Mt="onMouseEnter",_t="mouse",(o==="pointerout"||o==="pointerover")&&(Dn=Un,ci="onPointerLeave",Mt="onPointerEnter",_t="pointer"),Yr=qt==null?jt:Xt(qt),zt=zn==null?jt:Xt(zn),jt=new Dn(ci,_t+"leave",qt,x,ui),jt.target=Yr,jt.relatedTarget=zt,ci=null,vt(ui)===Ft&&(Dn=new Dn(Mt,_t+"enter",zn,x,ui),Dn.target=zt,Dn.relatedTarget=Yr,ci=Dn),Yr=ci,qt&&zn)t:{for(Dn=qt,Mt=zn,_t=0,zt=Dn;zt;zt=Cl(zt))_t++;for(zt=0,ci=Mt;ci;ci=Cl(ci))zt++;for(;0<_t-zt;)Dn=Cl(Dn),_t--;for(;0<zt-_t;)Mt=Cl(Mt),zt--;for(;_t--;){if(Dn===Mt||Mt!==null&&Dn===Mt.alternate)break t;Dn=Cl(Dn),Mt=Cl(Mt)}Dn=null}else Dn=null;qt!==null&&ra(xi,jt,qt,Dn,!1),zn!==null&&Yr!==null&&ra(xi,Yr,zn,Dn,!0)}}e:{if(jt=Ft?Xt(Ft):window,qt=jt.nodeName&&jt.nodeName.toLowerCase(),qt==="select"||qt==="input"&&jt.type==="file")var tn=vu;else if(Mo(jt))if(mc)tn=cd;else{tn=zl;var mr=_p}else qt=jt.nodeName,!qt||qt.toLowerCase()!=="input"||jt.type!=="checkbox"&&jt.type!=="radio"?Ft&&Va(Ft.elementType)&&(tn=vu):tn=Ca;if(tn&&(tn=tn(o,Ft))){qi(xi,tn,x,ui);break e}mr&&mr(o,jt,Ft),o==="focusout"&&Ft&&jt.type==="number"&&Ft.memoizedProps.value!=null&&Ys(jt,"number",jt.value)}switch(mr=Ft?Xt(Ft):window,o){case"focusin":(Mo(mr)||mr.contentEditable==="true")&&(vo=mr,xp=Ft,ud=null);break;case"focusout":ud=xp=vo=null;break;case"mousedown":pf=!0;break;case"contextmenu":case"mouseup":case"dragend":pf=!1,bp(xi,x,ui);break;case"selectionchange":if(vp)break;case"keydown":case"keyup":bp(xi,x,ui)}var dn;if(Bc)e:{switch(o){case"compositionstart":var Cn="onCompositionStart";break e;case"compositionend":Cn="onCompositionEnd";break e;case"compositionupdate":Cn="onCompositionUpdate";break e}Cn=void 0}else Hs?Ea(o,x)&&(Cn="onCompositionEnd"):o==="keydown"&&x.keyCode===229&&(Cn="onCompositionStart");Cn&&(od&&x.locale!=="ko"&&(Hs||Cn!=="onCompositionStart"?Cn==="onCompositionEnd"&&Hs&&(dn=Sa()):(mo=ui,ml="value"in mo?mo.value:mo.textContent,Hs=!0)),mr=Kf(Ft,Cn),0<mr.length&&(Cn=new zi(Cn,o,null,x,ui),xi.push({event:Cn,listeners:mr}),dn?Cn.data=dn:(dn=Ll(x),dn!==null&&(Cn.data=dn)))),(dn=ad?yu(o,x):cn(o,x))&&(Cn=Kf(Ft,"onBeforeInput"),0<Cn.length&&(mr=new zi("onBeforeInput","beforeinput",null,x,ui),xi.push({event:mr,listeners:Cn}),mr.data=dn)),v0(xi,o,Ft,x,ui)}Sy(xi,d)})}function Yf(o,d,x){return{instance:o,listener:d,currentTarget:x}}function Kf(o,d){for(var x=d+"Capture",M=[];o!==null;){var z=o,q=z.stateNode;if(z=z.tag,z!==5&&z!==26&&z!==27||q===null||(z=en(o,x),z!=null&&M.unshift(Yf(o,z,q)),z=en(o,d),z!=null&&M.push(Yf(o,z,q))),o.tag===3)return M;o=o.return}return[]}function Cl(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function ra(o,d,x,M,z){for(var q=d._reactName,ue=[];x!==null&&x!==M;){var Oe=x,it=Oe.alternate,Ft=Oe.stateNode;if(Oe=Oe.tag,it!==null&&it===M)break;Oe!==5&&Oe!==26&&Oe!==27||Ft===null||(it=Ft,z?(Ft=en(x,q),Ft!=null&&ue.unshift(Yf(x,Ft,it))):z||(Ft=en(x,q),Ft!=null&&ue.push(Yf(x,Ft,it)))),x=x.return}ue.length!==0&&o.push({event:d,listeners:ue})}var Ey=/\r\n?/g,em=/\u0000|\uFFFD/g;function Ay(o){return(typeof o=="string"?o:""+o).replace(Ey,`
`).replace(em,"")}function Cy(o,d){return d=Ay(d),Ay(o)===d}function Wm(){}function ps(o,d,x,M,z,q){switch(x){case"children":typeof M=="string"?d==="body"||d==="textarea"&&M===""||Ks(o,M):(typeof M=="number"||typeof M=="bigint")&&d!=="body"&&Ks(o,""+M);break;case"className":Tn(o,"class",M);break;case"tabIndex":Tn(o,"tabindex",M);break;case"dir":case"role":case"viewBox":case"width":case"height":Tn(o,x,M);break;case"style":pl(o,M,q);break;case"data":if(d!=="object"){Tn(o,"data",M);break}case"src":case"href":if(M===""&&(d!=="a"||x!=="href")){o.removeAttribute(x);break}if(M==null||typeof M=="function"||typeof M=="symbol"||typeof M=="boolean"){o.removeAttribute(x);break}M=ot(""+M),o.setAttribute(x,M);break;case"action":case"formAction":if(typeof M=="function"){o.setAttribute(x,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof q=="function"&&(x==="formAction"?(d!=="input"&&ps(o,d,"name",z.name,z,null),ps(o,d,"formEncType",z.formEncType,z,null),ps(o,d,"formMethod",z.formMethod,z,null),ps(o,d,"formTarget",z.formTarget,z,null)):(ps(o,d,"encType",z.encType,z,null),ps(o,d,"method",z.method,z,null),ps(o,d,"target",z.target,z,null)));if(M==null||typeof M=="symbol"||typeof M=="boolean"){o.removeAttribute(x);break}M=ot(""+M),o.setAttribute(x,M);break;case"onClick":M!=null&&(o.onclick=Wm);break;case"onScroll":M!=null&&br("scroll",o);break;case"onScrollEnd":M!=null&&br("scrollend",o);break;case"dangerouslySetInnerHTML":if(M!=null){if(typeof M!="object"||!("__html"in M))throw Error(S(61));if(x=M.__html,x!=null){if(z.children!=null)throw Error(S(60));o.innerHTML=x}}break;case"multiple":o.multiple=M&&typeof M!="function"&&typeof M!="symbol";break;case"muted":o.muted=M&&typeof M!="function"&&typeof M!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(M==null||typeof M=="function"||typeof M=="boolean"||typeof M=="symbol"){o.removeAttribute("xlink:href");break}x=ot(""+M),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",x);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":M!=null&&typeof M!="function"&&typeof M!="symbol"?o.setAttribute(x,""+M):o.removeAttribute(x);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":M&&typeof M!="function"&&typeof M!="symbol"?o.setAttribute(x,""):o.removeAttribute(x);break;case"capture":case"download":M===!0?o.setAttribute(x,""):M!==!1&&M!=null&&typeof M!="function"&&typeof M!="symbol"?o.setAttribute(x,M):o.removeAttribute(x);break;case"cols":case"rows":case"size":case"span":M!=null&&typeof M!="function"&&typeof M!="symbol"&&!isNaN(M)&&1<=M?o.setAttribute(x,M):o.removeAttribute(x);break;case"rowSpan":case"start":M==null||typeof M=="function"||typeof M=="symbol"||isNaN(M)?o.removeAttribute(x):o.setAttribute(x,M);break;case"popover":br("beforetoggle",o),br("toggle",o),Mn(o,"popover",M);break;case"xlinkActuate":Xn(o,"http://www.w3.org/1999/xlink","xlink:actuate",M);break;case"xlinkArcrole":Xn(o,"http://www.w3.org/1999/xlink","xlink:arcrole",M);break;case"xlinkRole":Xn(o,"http://www.w3.org/1999/xlink","xlink:role",M);break;case"xlinkShow":Xn(o,"http://www.w3.org/1999/xlink","xlink:show",M);break;case"xlinkTitle":Xn(o,"http://www.w3.org/1999/xlink","xlink:title",M);break;case"xlinkType":Xn(o,"http://www.w3.org/1999/xlink","xlink:type",M);break;case"xmlBase":Xn(o,"http://www.w3.org/XML/1998/namespace","xml:base",M);break;case"xmlLang":Xn(o,"http://www.w3.org/XML/1998/namespace","xml:lang",M);break;case"xmlSpace":Xn(o,"http://www.w3.org/XML/1998/namespace","xml:space",M);break;case"is":Mn(o,"is",M);break;case"innerText":case"textContent":break;default:(!(2<x.length)||x[0]!=="o"&&x[0]!=="O"||x[1]!=="n"&&x[1]!=="N")&&(x=Ua.get(x)||x,Mn(o,x,M))}}function Hd(o,d,x,M,z,q){switch(x){case"style":pl(o,M,q);break;case"dangerouslySetInnerHTML":if(M!=null){if(typeof M!="object"||!("__html"in M))throw Error(S(61));if(x=M.__html,x!=null){if(z.children!=null)throw Error(S(60));o.innerHTML=x}}break;case"children":typeof M=="string"?Ks(o,M):(typeof M=="number"||typeof M=="bigint")&&Ks(o,""+M);break;case"onScroll":M!=null&&br("scroll",o);break;case"onScrollEnd":M!=null&&br("scrollend",o);break;case"onClick":M!=null&&(o.onclick=Wm);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ni.hasOwnProperty(x))e:{if(x[0]==="o"&&x[1]==="n"&&(z=x.endsWith("Capture"),d=x.slice(2,z?x.length-7:void 0),q=o[ae]||null,q=q!=null?q[x]:null,typeof q=="function"&&o.removeEventListener(d,q,z),typeof M=="function")){typeof q!="function"&&q!==null&&(x in o?o[x]=null:o.hasAttribute(x)&&o.removeAttribute(x)),o.addEventListener(d,M,z);break e}x in o?o[x]=M:M===!0?o.setAttribute(x,""):Mn(o,x,M)}}}function Wa(o,d,x){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":br("error",o),br("load",o);var M=!1,z=!1,q;for(q in x)if(x.hasOwnProperty(q)){var ue=x[q];if(ue!=null)switch(q){case"src":M=!0;break;case"srcSet":z=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(S(137,d));default:ps(o,d,q,ue,x,null)}}z&&ps(o,d,"srcSet",x.srcSet,x,null),M&&ps(o,d,"src",x.src,x,null);return;case"input":br("invalid",o);var Oe=q=ue=z=null,it=null,Ft=null;for(M in x)if(x.hasOwnProperty(M)){var ui=x[M];if(ui!=null)switch(M){case"name":z=ui;break;case"type":ue=ui;break;case"checked":it=ui;break;case"defaultChecked":Ft=ui;break;case"value":q=ui;break;case"defaultValue":Oe=ui;break;case"children":case"dangerouslySetInnerHTML":if(ui!=null)throw Error(S(137,d));break;default:ps(o,d,M,ui,x,null)}}ba(o,q,Oe,it,Ft,ue,z,!1),Fo(o);return;case"select":br("invalid",o),M=ue=q=null;for(z in x)if(x.hasOwnProperty(z)&&(Oe=x[z],Oe!=null))switch(z){case"value":q=Oe;break;case"defaultValue":ue=Oe;break;case"multiple":M=Oe;default:ps(o,d,z,Oe,x,null)}d=q,x=ue,o.multiple=!!M,d!=null?js(o,!!M,d,!1):x!=null&&js(o,!!M,x,!0);return;case"textarea":br("invalid",o),q=z=M=null;for(ue in x)if(x.hasOwnProperty(ue)&&(Oe=x[ue],Oe!=null))switch(ue){case"value":M=Oe;break;case"defaultValue":z=Oe;break;case"children":q=Oe;break;case"dangerouslySetInnerHTML":if(Oe!=null)throw Error(S(91));break;default:ps(o,d,ue,Oe,x,null)}wa(o,M,z,q),Fo(o);return;case"option":for(it in x)if(x.hasOwnProperty(it)&&(M=x[it],M!=null))switch(it){case"selected":o.selected=M&&typeof M!="function"&&typeof M!="symbol";break;default:ps(o,d,it,M,x,null)}return;case"dialog":br("beforetoggle",o),br("toggle",o),br("cancel",o),br("close",o);break;case"iframe":case"object":br("load",o);break;case"video":case"audio":for(M=0;M<Xf.length;M++)br(Xf[M],o);break;case"image":br("error",o),br("load",o);break;case"details":br("toggle",o);break;case"embed":case"source":case"link":br("error",o),br("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ft in x)if(x.hasOwnProperty(Ft)&&(M=x[Ft],M!=null))switch(Ft){case"children":case"dangerouslySetInnerHTML":throw Error(S(137,d));default:ps(o,d,Ft,M,x,null)}return;default:if(Va(d)){for(ui in x)x.hasOwnProperty(ui)&&(M=x[ui],M!==void 0&&Hd(o,d,ui,M,x,void 0));return}}for(Oe in x)x.hasOwnProperty(Oe)&&(M=x[Oe],M!=null&&ps(o,d,Oe,M,x,null))}function qd(o,d,x,M){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var z=null,q=null,ue=null,Oe=null,it=null,Ft=null,ui=null;for(qt in x){var xi=x[qt];if(x.hasOwnProperty(qt)&&xi!=null)switch(qt){case"checked":break;case"value":break;case"defaultValue":it=xi;default:M.hasOwnProperty(qt)||ps(o,d,qt,null,M,xi)}}for(var jt in M){var qt=M[jt];if(xi=x[jt],M.hasOwnProperty(jt)&&(qt!=null||xi!=null))switch(jt){case"type":q=qt;break;case"name":z=qt;break;case"checked":Ft=qt;break;case"defaultChecked":ui=qt;break;case"value":ue=qt;break;case"defaultValue":Oe=qt;break;case"children":case"dangerouslySetInnerHTML":if(qt!=null)throw Error(S(137,d));break;default:qt!==xi&&ps(o,d,jt,qt,M,xi)}}ja(o,ue,Oe,it,Ft,ui,q,z);return;case"select":qt=ue=Oe=jt=null;for(q in x)if(it=x[q],x.hasOwnProperty(q)&&it!=null)switch(q){case"value":break;case"multiple":qt=it;default:M.hasOwnProperty(q)||ps(o,d,q,null,M,it)}for(z in M)if(q=M[z],it=x[z],M.hasOwnProperty(z)&&(q!=null||it!=null))switch(z){case"value":jt=q;break;case"defaultValue":Oe=q;break;case"multiple":ue=q;default:q!==it&&ps(o,d,z,q,M,it)}d=Oe,x=ue,M=qt,jt!=null?js(o,!!x,jt,!1):!!M!=!!x&&(d!=null?js(o,!!x,d,!0):js(o,!!x,x?[]:"",!1));return;case"textarea":qt=jt=null;for(Oe in x)if(z=x[Oe],x.hasOwnProperty(Oe)&&z!=null&&!M.hasOwnProperty(Oe))switch(Oe){case"value":break;case"children":break;default:ps(o,d,Oe,null,M,z)}for(ue in M)if(z=M[ue],q=x[ue],M.hasOwnProperty(ue)&&(z!=null||q!=null))switch(ue){case"value":jt=z;break;case"defaultValue":qt=z;break;case"children":break;case"dangerouslySetInnerHTML":if(z!=null)throw Error(S(91));break;default:z!==q&&ps(o,d,ue,z,M,q)}po(o,jt,qt);return;case"option":for(var zn in x)if(jt=x[zn],x.hasOwnProperty(zn)&&jt!=null&&!M.hasOwnProperty(zn))switch(zn){case"selected":o.selected=!1;break;default:ps(o,d,zn,null,M,jt)}for(it in M)if(jt=M[it],qt=x[it],M.hasOwnProperty(it)&&jt!==qt&&(jt!=null||qt!=null))switch(it){case"selected":o.selected=jt&&typeof jt!="function"&&typeof jt!="symbol";break;default:ps(o,d,it,jt,M,qt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Dn in x)jt=x[Dn],x.hasOwnProperty(Dn)&&jt!=null&&!M.hasOwnProperty(Dn)&&ps(o,d,Dn,null,M,jt);for(Ft in M)if(jt=M[Ft],qt=x[Ft],M.hasOwnProperty(Ft)&&jt!==qt&&(jt!=null||qt!=null))switch(Ft){case"children":case"dangerouslySetInnerHTML":if(jt!=null)throw Error(S(137,d));break;default:ps(o,d,Ft,jt,M,qt)}return;default:if(Va(d)){for(var Yr in x)jt=x[Yr],x.hasOwnProperty(Yr)&&jt!==void 0&&!M.hasOwnProperty(Yr)&&Hd(o,d,Yr,void 0,M,jt);for(ui in M)jt=M[ui],qt=x[ui],!M.hasOwnProperty(ui)||jt===qt||jt===void 0&&qt===void 0||Hd(o,d,ui,jt,M,qt);return}}for(var Mt in x)jt=x[Mt],x.hasOwnProperty(Mt)&&jt!=null&&!M.hasOwnProperty(Mt)&&ps(o,d,Mt,null,M,jt);for(xi in M)jt=M[xi],qt=x[xi],!M.hasOwnProperty(xi)||jt===qt||jt==null&&qt==null||ps(o,d,xi,jt,M,qt)}var $d=null,t_=null;function Xm(o){return o.nodeType===9?o:o.ownerDocument}function My(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Iy(o,d){if(o===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&d==="foreignObject"?0:o}function i_(o,d){return o==="textarea"||o==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var n_=null;function w0(){var o=window.event;return o&&o.type==="popstate"?o===n_?!1:(n_=o,!0):(n_=null,!1)}var Ym=typeof setTimeout=="function"?setTimeout:void 0,T0=typeof clearTimeout=="function"?clearTimeout:void 0,r_=typeof Promise=="function"?Promise:void 0,tm=typeof queueMicrotask=="function"?queueMicrotask:typeof r_<"u"?function(o){return r_.resolve(null).then(o).catch(S0)}:Ym;function S0(o){setTimeout(function(){throw o})}function is(o){return o==="head"}function Zd(o,d){var x=d,M=0,z=0;do{var q=x.nextSibling;if(o.removeChild(x),q&&q.nodeType===8)if(x=q.data,x==="/$"){if(0<M&&8>M){x=M;var ue=o.ownerDocument;if(x&1&&nm(ue.documentElement),x&2&&nm(ue.body),x&4)for(x=ue.head,nm(x),ue=x.firstChild;ue;){var Oe=ue.nextSibling,it=ue.nodeName;ue[Ue]||it==="SCRIPT"||it==="STYLE"||it==="LINK"&&ue.rel.toLowerCase()==="stylesheet"||x.removeChild(ue),ue=Oe}}if(z===0){o.removeChild(q),hm(d);return}z--}else x==="$"||x==="$?"||x==="$!"?z++:M=x.charCodeAt(0)-48;else M=0;x=q}while(x);hm(d)}function Km(o){var d=o.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var x=d;switch(d=d.nextSibling,x.nodeName){case"HTML":case"HEAD":case"BODY":Km(x),tt(x);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(x.rel.toLowerCase()==="stylesheet")continue}o.removeChild(x)}}function Qm(o,d,x,M){for(;o.nodeType===1;){var z=x;if(o.nodeName.toLowerCase()!==d.toLowerCase()){if(!M&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(M){if(!o[Ue])switch(d){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(q=o.getAttribute("rel"),q==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(q!==z.rel||o.getAttribute("href")!==(z.href==null||z.href===""?null:z.href)||o.getAttribute("crossorigin")!==(z.crossOrigin==null?null:z.crossOrigin)||o.getAttribute("title")!==(z.title==null?null:z.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(q=o.getAttribute("src"),(q!==(z.src==null?null:z.src)||o.getAttribute("type")!==(z.type==null?null:z.type)||o.getAttribute("crossorigin")!==(z.crossOrigin==null?null:z.crossOrigin))&&q&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(d==="input"&&o.type==="hidden"){var q=z.name==null?null:""+z.name;if(z.type==="hidden"&&o.getAttribute("name")===q)return o}else return o;if(o=oc(o.nextSibling),o===null)break}return null}function Jm(o,d,x){if(d==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!x||(o=oc(o.nextSibling),o===null))return null;return o}function Wd(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState==="complete"}function Ry(o,d){var x=o.ownerDocument;if(o.data!=="$?"||x.readyState==="complete")d();else{var M=function(){d(),x.removeEventListener("DOMContentLoaded",M)};x.addEventListener("DOMContentLoaded",M),o._reactRetry=M}}function oc(o){for(;o!=null;o=o.nextSibling){var d=o.nodeType;if(d===1||d===3)break;if(d===8){if(d=o.data,d==="$"||d==="$!"||d==="$?"||d==="F!"||d==="F")break;if(d==="/$")return null}}return o}var Xd=null;function eg(o){o=o.previousSibling;for(var d=0;o;){if(o.nodeType===8){var x=o.data;if(x==="$"||x==="$!"||x==="$?"){if(d===0)return o;d--}else x==="/$"&&d++}o=o.previousSibling}return null}function im(o,d,x){switch(d=Xm(x),o){case"html":if(o=d.documentElement,!o)throw Error(S(452));return o;case"head":if(o=d.head,!o)throw Error(S(453));return o;case"body":if(o=d.body,!o)throw Error(S(454));return o;default:throw Error(S(451))}}function nm(o){for(var d=o.attributes;d.length;)o.removeAttributeNode(d[0]);tt(o)}var Ml=new Map,tg=new Set;function Qf(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var uu=kt.d;kt.d={f:Yd,r:E0,D:Dy,C:Py,L:ig,m:A0,X:a_,S:C0,M:Oy};function Yd(){var o=uu.f(),d=au();return o||d}function E0(o){var d=rt(o);d!==null&&d.tag===5&&d.type==="form"?iu(d):uu.r(o)}var Pa=typeof document>"u"?null:document;function s_(o,d,x){var M=Pa;if(M&&typeof d=="string"&&d){var z=rs(d);z='link[rel="'+o+'"][href="'+z+'"]',typeof x=="string"&&(z+='[crossorigin="'+x+'"]'),tg.has(z)||(tg.add(z),o={rel:o,crossOrigin:x,href:d},M.querySelector(z)===null&&(d=M.createElement("link"),Wa(d,"link",o),si(d),M.head.appendChild(d)))}}function Dy(o){uu.D(o),s_("dns-prefetch",o,null)}function Py(o,d){uu.C(o,d),s_("preconnect",o,d)}function ig(o,d,x){uu.L(o,d,x);var M=Pa;if(M&&o&&d){var z='link[rel="preload"][as="'+rs(d)+'"]';d==="image"&&x&&x.imageSrcSet?(z+='[imagesrcset="'+rs(x.imageSrcSet)+'"]',typeof x.imageSizes=="string"&&(z+='[imagesizes="'+rs(x.imageSizes)+'"]')):z+='[href="'+rs(o)+'"]';var q=z;switch(d){case"style":q=Uh(o);break;case"script":q=Kd(o)}Ml.has(q)||(o=$({rel:"preload",href:d==="image"&&x&&x.imageSrcSet?void 0:o,as:d},x),Ml.set(q,o),M.querySelector(z)!==null||d==="style"&&M.querySelector(Jf(q))||d==="script"&&M.querySelector(Qd(q))||(d=M.createElement("link"),Wa(d,"link",o),si(d),M.head.appendChild(d)))}}function A0(o,d){uu.m(o,d);var x=Pa;if(x&&o){var M=d&&typeof d.as=="string"?d.as:"script",z='link[rel="modulepreload"][as="'+rs(M)+'"][href="'+rs(o)+'"]',q=z;switch(M){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":q=Kd(o)}if(!Ml.has(q)&&(o=$({rel:"modulepreload",href:o},d),Ml.set(q,o),x.querySelector(z)===null)){switch(M){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(x.querySelector(Qd(q)))return}M=x.createElement("link"),Wa(M,"link",o),si(M),x.head.appendChild(M)}}}function C0(o,d,x){uu.S(o,d,x);var M=Pa;if(M&&o){var z=pi(M).hoistableStyles,q=Uh(o);d=d||"default";var ue=z.get(q);if(!ue){var Oe={loading:0,preload:null};if(ue=M.querySelector(Jf(q)))Oe.loading=5;else{o=$({rel:"stylesheet",href:o,"data-precedence":d},x),(x=Ml.get(q))&&l_(o,x);var it=ue=M.createElement("link");si(it),Wa(it,"link",o),it._p=new Promise(function(Ft,ui){it.onload=Ft,it.onerror=ui}),it.addEventListener("load",function(){Oe.loading|=1}),it.addEventListener("error",function(){Oe.loading|=2}),Oe.loading|=4,rm(ue,d,M)}ue={type:"stylesheet",instance:ue,count:1,state:Oe},z.set(q,ue)}}}function a_(o,d){uu.X(o,d);var x=Pa;if(x&&o){var M=pi(x).hoistableScripts,z=Kd(o),q=M.get(z);q||(q=x.querySelector(Qd(z)),q||(o=$({src:o,async:!0},d),(d=Ml.get(z))&&c_(o,d),q=x.createElement("script"),si(q),Wa(q,"link",o),x.head.appendChild(q)),q={type:"script",instance:q,count:1,state:null},M.set(z,q))}}function Oy(o,d){uu.M(o,d);var x=Pa;if(x&&o){var M=pi(x).hoistableScripts,z=Kd(o),q=M.get(z);q||(q=x.querySelector(Qd(z)),q||(o=$({src:o,async:!0,type:"module"},d),(d=Ml.get(z))&&c_(o,d),q=x.createElement("script"),si(q),Wa(q,"link",o),x.head.appendChild(q)),q={type:"script",instance:q,count:1,state:null},M.set(z,q))}}function ng(o,d,x,M){var z=(z=Rt.current)?Qf(z):null;if(!z)throw Error(S(446));switch(o){case"meta":case"title":return null;case"style":return typeof x.precedence=="string"&&typeof x.href=="string"?(d=Uh(x.href),x=pi(z).hoistableStyles,M=x.get(d),M||(M={type:"style",instance:null,count:0,state:null},x.set(d,M)),M):{type:"void",instance:null,count:0,state:null};case"link":if(x.rel==="stylesheet"&&typeof x.href=="string"&&typeof x.precedence=="string"){o=Uh(x.href);var q=pi(z).hoistableStyles,ue=q.get(o);if(ue||(z=z.ownerDocument||z,ue={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},q.set(o,ue),(q=z.querySelector(Jf(o)))&&!q._p&&(ue.instance=q,ue.state.loading=5),Ml.has(o)||(x={rel:"preload",as:"style",href:x.href,crossOrigin:x.crossOrigin,integrity:x.integrity,media:x.media,hrefLang:x.hrefLang,referrerPolicy:x.referrerPolicy},Ml.set(o,x),q||Ly(z,o,x,ue.state))),d&&M===null)throw Error(S(528,""));return ue}if(d&&M!==null)throw Error(S(529,""));return null;case"script":return d=x.async,x=x.src,typeof x=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=Kd(x),x=pi(z).hoistableScripts,M=x.get(d),M||(M={type:"script",instance:null,count:0,state:null},x.set(d,M)),M):{type:"void",instance:null,count:0,state:null};default:throw Error(S(444,o))}}function Uh(o){return'href="'+rs(o)+'"'}function Jf(o){return'link[rel="stylesheet"]['+o+"]"}function o_(o){return $({},o,{"data-precedence":o.precedence,precedence:null})}function Ly(o,d,x,M){o.querySelector('link[rel="preload"][as="style"]['+d+"]")?M.loading=1:(d=o.createElement("link"),M.preload=d,d.addEventListener("load",function(){return M.loading|=1}),d.addEventListener("error",function(){return M.loading|=2}),Wa(d,"link",x),si(d),o.head.appendChild(d))}function Kd(o){return'[src="'+rs(o)+'"]'}function Qd(o){return"script[async]"+o}function Lc(o,d,x){if(d.count++,d.instance===null)switch(d.type){case"style":var M=o.querySelector('style[data-href~="'+rs(x.href)+'"]');if(M)return d.instance=M,si(M),M;var z=$({},x,{"data-href":x.href,"data-precedence":x.precedence,href:null,precedence:null});return M=(o.ownerDocument||o).createElement("style"),si(M),Wa(M,"style",z),rm(M,x.precedence,o),d.instance=M;case"stylesheet":z=Uh(x.href);var q=o.querySelector(Jf(z));if(q)return d.state.loading|=4,d.instance=q,si(q),q;M=o_(x),(z=Ml.get(z))&&l_(M,z),q=(o.ownerDocument||o).createElement("link"),si(q);var ue=q;return ue._p=new Promise(function(Oe,it){ue.onload=Oe,ue.onerror=it}),Wa(q,"link",M),d.state.loading|=4,rm(q,x.precedence,o),d.instance=q;case"script":return q=Kd(x.src),(z=o.querySelector(Qd(q)))?(d.instance=z,si(z),z):(M=x,(z=Ml.get(q))&&(M=$({},x),c_(M,z)),o=o.ownerDocument||o,z=o.createElement("script"),si(z),Wa(z,"link",M),o.head.appendChild(z),d.instance=z);case"void":return null;default:throw Error(S(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(M=d.instance,d.state.loading|=4,rm(M,x.precedence,o));return d.instance}function rm(o,d,x){for(var M=x.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),z=M.length?M[M.length-1]:null,q=z,ue=0;ue<M.length;ue++){var Oe=M[ue];if(Oe.dataset.precedence===d)q=Oe;else if(q!==z)break}q?q.parentNode.insertBefore(o,q.nextSibling):(d=x.nodeType===9?x.head:x,d.insertBefore(o,d.firstChild))}function l_(o,d){o.crossOrigin==null&&(o.crossOrigin=d.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=d.referrerPolicy),o.title==null&&(o.title=d.title)}function c_(o,d){o.crossOrigin==null&&(o.crossOrigin=d.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=d.referrerPolicy),o.integrity==null&&(o.integrity=d.integrity)}var rg=null;function zy(o,d,x){if(rg===null){var M=new Map,z=rg=new Map;z.set(x,M)}else z=rg,M=z.get(x),M||(M=new Map,z.set(x,M));if(M.has(o))return M;for(M.set(o,null),x=x.getElementsByTagName(o),z=0;z<x.length;z++){var q=x[z];if(!(q[Ue]||q[ee]||o==="link"&&q.getAttribute("rel")==="stylesheet")&&q.namespaceURI!=="http://www.w3.org/2000/svg"){var ue=q.getAttribute(d)||"";ue=o+ue;var Oe=M.get(ue);Oe?Oe.push(q):M.set(ue,[q])}}return M}function ky(o,d,x){o=o.ownerDocument||o,o.head.insertBefore(x,d==="title"?o.querySelector("head > title"):null)}function M0(o,d,x){if(x===1||d.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;switch(d.rel){case"stylesheet":return o=d.disabled,typeof d.precedence=="string"&&o==null;default:return!0}case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function Ny(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}var Gh=null;function Fy(){}function sg(o,d,x){if(Gh===null)throw Error(S(475));var M=Gh;if(d.type==="stylesheet"&&(typeof x.media!="string"||matchMedia(x.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var z=Uh(x.href),q=o.querySelector(Jf(z));if(q){o=q._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(M.count++,M=ep.bind(M),o.then(M,M)),d.state.loading|=4,d.instance=q,si(q);return}q=o.ownerDocument||o,x=o_(x),(z=Ml.get(z))&&l_(x,z),q=q.createElement("link"),si(q);var ue=q;ue._p=new Promise(function(Oe,it){ue.onload=Oe,ue.onerror=it}),Wa(q,"link",x),d.instance=q}M.stylesheets===null&&(M.stylesheets=new Map),M.stylesheets.set(d,o),(o=d.state.preload)&&(d.state.loading&3)===0&&(M.count++,d=ep.bind(M),o.addEventListener("load",d),o.addEventListener("error",d))}}function By(){if(Gh===null)throw Error(S(475));var o=Gh;return o.stylesheets&&o.count===0&&ag(o,o.stylesheets),0<o.count?function(d){var x=setTimeout(function(){if(o.stylesheets&&ag(o,o.stylesheets),o.unsuspend){var M=o.unsuspend;o.unsuspend=null,M()}},6e4);return o.unsuspend=d,function(){o.unsuspend=null,clearTimeout(x)}}:null}function ep(){if(this.count--,this.count===0){if(this.stylesheets)ag(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var tp=null;function ag(o,d){o.stylesheets=null,o.unsuspend!==null&&(o.count++,tp=new Map,d.forEach(I0,o),tp=null,ep.call(o))}function I0(o,d){if(!(d.state.loading&4)){var x=tp.get(o);if(x)var M=x.get(null);else{x=new Map,tp.set(o,x);for(var z=o.querySelectorAll("link[data-precedence],style[data-precedence]"),q=0;q<z.length;q++){var ue=z[q];(ue.nodeName==="LINK"||ue.getAttribute("media")!=="not all")&&(x.set(ue.dataset.precedence,ue),M=ue)}M&&x.set(null,M)}z=d.instance,ue=z.getAttribute("data-precedence"),q=x.get(ue)||M,q===M&&x.set(null,z),x.set(ue,z),this.count++,M=ep.bind(this),z.addEventListener("load",M),z.addEventListener("error",M),q?q.parentNode.insertBefore(z,q.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(z,o.firstChild)),d.state.loading|=4}}var ip={$$typeof:se,Provider:null,Consumer:null,_currentValue:ii,_currentValue2:ii,_threadCount:0};function jy(o,d,x,M,z,q,ue,Oe){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Fs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fs(0),this.hiddenUpdates=Fs(null),this.identifierPrefix=M,this.onUncaughtError=z,this.onCaughtError=q,this.onRecoverableError=ue,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Oe,this.incompleteTransitions=new Map}function u_(o,d,x,M,z,q,ue,Oe,it,Ft,ui,xi){return o=new jy(o,d,x,ue,Oe,it,Ft,xi),d=1,q===!0&&(d|=24),q=Po(3,null,null,d),o.current=q,q.stateNode=o,d=gh(),d.refCount++,o.pooledCache=d,d.refCount++,q.memoizedState={element:M,isDehydrated:x,cache:d},Ef(q),o}function h_(o){return o?(o=_l,o):_l}function og(o,d,x,M,z,q){z=h_(z),M.context===null?M.context=z:M.pendingContext=z,M=To(d),M.payload={element:x},q=q===void 0?null:q,q!==null&&(M.callback=q),x=Cc(o,M,d),x!==null&&($s(x,o,d),Yo(x,o,d))}function d_(o,d){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var x=o.retryLane;o.retryLane=x!==0&&x<d?x:d}}function sm(o,d){d_(o,d),(o=o.alternate)&&d_(o,d)}function Vy(o){if(o.tag===13){var d=_c(o,67108864);d!==null&&$s(d,o,67108864),sm(o,67108864)}}var lg=!0;function R0(o,d,x,M){var z=Qe.T;Qe.T=null;var q=kt.p;try{kt.p=2,cg(o,d,x,M)}finally{kt.p=q,Qe.T=z}}function D0(o,d,x,M){var z=Qe.T;Qe.T=null;var q=kt.p;try{kt.p=8,cg(o,d,x,M)}finally{kt.p=q,Qe.T=z}}function cg(o,d,x,M){if(lg){var z=hu(M);if(z===null)Zm(o,d,M,Hh,x),lm(o,M);else if(P0(z,o,d,x,M))M.stopPropagation();else if(lm(o,M),d&4&&-1<Uy.indexOf(o)){for(;z!==null;){var q=rt(z);if(q!==null)switch(q.tag){case 3:if(q=q.stateNode,q.current.memoizedState.isDehydrated){var ue=Os(q.pendingLanes);if(ue!==0){var Oe=q;for(Oe.pendingLanes|=2,Oe.entangledLanes|=2;ue;){var it=1<<31-_s(ue);Oe.entanglements[1]|=it,ue&=~it}Oc(q),(fi&6)===0&&(or=gs()+500,Vh(0))}}break;case 13:Oe=_c(q,2),Oe!==null&&$s(Oe,q,2),au(),sm(q,2)}if(q=hu(M),q===null&&Zm(o,d,M,Hh,x),q===z)break;z=q}z!==null&&M.stopPropagation()}else Zm(o,d,M,null,x)}}function hu(o){return o=Si(o),Jd(o)}var Hh=null;function Jd(o){if(Hh=null,o=vt(o),o!==null){var d=L(o);if(d===null)o=null;else{var x=d.tag;if(x===13){if(o=N(d),o!==null)return o;o=null}else if(x===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;o=null}else d!==o&&(o=null)}}return Hh=o,null}function am(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(No()){case Or:return 2;case Nr:return 8;case Jr:case Ao:return 32;case Ja:return 268435456;default:return 32}default:return 32}}var ef=!1,$u=null,Zu=null,Wu=null,np=new Map,om=new Map,qh=[],Uy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function lm(o,d){switch(o){case"focusin":case"focusout":$u=null;break;case"dragenter":case"dragleave":Zu=null;break;case"mouseover":case"mouseout":Wu=null;break;case"pointerover":case"pointerout":np.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":om.delete(d.pointerId)}}function rp(o,d,x,M,z,q){return o===null||o.nativeEvent!==q?(o={blockedOn:d,domEventName:x,eventSystemFlags:M,nativeEvent:q,targetContainers:[z]},d!==null&&(d=rt(d),d!==null&&Vy(d)),o):(o.eventSystemFlags|=M,d=o.targetContainers,z!==null&&d.indexOf(z)===-1&&d.push(z),o)}function P0(o,d,x,M,z){switch(d){case"focusin":return $u=rp($u,o,d,x,M,z),!0;case"dragenter":return Zu=rp(Zu,o,d,x,M,z),!0;case"mouseover":return Wu=rp(Wu,o,d,x,M,z),!0;case"pointerover":var q=z.pointerId;return np.set(q,rp(np.get(q)||null,o,d,x,M,z)),!0;case"gotpointercapture":return q=z.pointerId,om.set(q,rp(om.get(q)||null,o,d,x,M,z)),!0}return!1}function f_(o){var d=vt(o.target);if(d!==null){var x=L(d);if(x!==null){if(d=x.tag,d===13){if(d=N(x),d!==null){o.blockedOn=d,wn(o.priority,function(){if(x.tag===13){var M=qs();M=io(M);var z=_c(x,M);z!==null&&$s(z,x,M),sm(x,M)}});return}}else if(d===3&&x.stateNode.current.memoizedState.isDehydrated){o.blockedOn=x.tag===3?x.stateNode.containerInfo:null;return}}}o.blockedOn=null}function sp(o){if(o.blockedOn!==null)return!1;for(var d=o.targetContainers;0<d.length;){var x=hu(o.nativeEvent);if(x===null){x=o.nativeEvent;var M=new x.constructor(x.type,x);Ht=M,x.target.dispatchEvent(M),Ht=null}else return d=rt(x),d!==null&&Vy(d),o.blockedOn=x,!1;d.shift()}return!0}function p_(o,d,x){sp(o)&&x.delete(d)}function Gy(){ef=!1,$u!==null&&sp($u)&&($u=null),Zu!==null&&sp(Zu)&&(Zu=null),Wu!==null&&sp(Wu)&&(Wu=null),np.forEach(p_),om.forEach(p_)}function cm(o,d){o.blockedOn===d&&(o.blockedOn=null,ef||(ef=!0,f.unstable_scheduleCallback(f.unstable_NormalPriority,Gy)))}var um=null;function m_(o){um!==o&&(um=o,f.unstable_scheduleCallback(f.unstable_NormalPriority,function(){um===o&&(um=null);for(var d=0;d<o.length;d+=3){var x=o[d],M=o[d+1],z=o[d+2];if(typeof M!="function"){if(Jd(M||x)===null)continue;break}var q=rt(x);q!==null&&(o.splice(d,3),d-=3,Ch(q,{pending:!0,data:z,method:x.method,action:M},M,z))}}))}function hm(o){function d(it){return cm(it,o)}$u!==null&&cm($u,o),Zu!==null&&cm(Zu,o),Wu!==null&&cm(Wu,o),np.forEach(d),om.forEach(d);for(var x=0;x<qh.length;x++){var M=qh[x];M.blockedOn===o&&(M.blockedOn=null)}for(;0<qh.length&&(x=qh[0],x.blockedOn===null);)f_(x),x.blockedOn===null&&qh.shift();if(x=(o.ownerDocument||o).$$reactFormReplay,x!=null)for(M=0;M<x.length;M+=3){var z=x[M],q=x[M+1],ue=z[ae]||null;if(typeof q=="function")ue||m_(x);else if(ue){var Oe=null;if(q&&q.hasAttribute("formAction")){if(z=q,ue=q[ae]||null)Oe=ue.formAction;else if(Jd(z)!==null)continue}else Oe=ue.action;typeof Oe=="function"?x[M+1]=Oe:(x.splice(M,3),M-=3),m_(x)}}}function ug(o){this._internalRoot=o}dm.prototype.render=ug.prototype.render=function(o){var d=this._internalRoot;if(d===null)throw Error(S(409));var x=d.current,M=qs();og(x,M,o,d,null,null)},dm.prototype.unmount=ug.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var d=o.containerInfo;og(o.current,2,null,o,null,null),au(),d[xe]=null}};function dm(o){this._internalRoot=o}dm.prototype.unstable_scheduleHydration=function(o){if(o){var d=xa();o={blockedOn:null,target:o,priority:d};for(var x=0;x<qh.length&&d!==0&&d<qh[x].priority;x++);qh.splice(x,0,o),x===0&&f_(o)}};var $h=g.version;if($h!=="19.1.1")throw Error(S(527,$h,"19.1.1"));kt.findDOMNode=function(o){var d=o._reactInternals;if(d===void 0)throw typeof o.render=="function"?Error(S(188)):(o=Object.keys(o).join(","),Error(S(268,o)));return o=F(d),o=o!==null?B(o):null,o=o===null?null:o.stateNode,o};var Hy={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:Qe,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fm.isDisabled&&fm.supportsFiber)try{eo=fm.inject(Hy),Ur=fm}catch{}}return F_.createRoot=function(o,d){if(!A(o))throw Error(S(299));var x=!1,M="",z=kf,q=Oh,ue=Vu,Oe=null;return d!=null&&(d.unstable_strictMode===!0&&(x=!0),d.identifierPrefix!==void 0&&(M=d.identifierPrefix),d.onUncaughtError!==void 0&&(z=d.onUncaughtError),d.onCaughtError!==void 0&&(q=d.onCaughtError),d.onRecoverableError!==void 0&&(ue=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(Oe=d.unstable_transitionCallbacks)),d=u_(o,1,!1,null,null,x,M,z,q,ue,Oe,null),o[xe]=d.current,$m(o),new ug(d)},F_.hydrateRoot=function(o,d,x){if(!A(o))throw Error(S(299));var M=!1,z="",q=kf,ue=Oh,Oe=Vu,it=null,Ft=null;return x!=null&&(x.unstable_strictMode===!0&&(M=!0),x.identifierPrefix!==void 0&&(z=x.identifierPrefix),x.onUncaughtError!==void 0&&(q=x.onUncaughtError),x.onCaughtError!==void 0&&(ue=x.onCaughtError),x.onRecoverableError!==void 0&&(Oe=x.onRecoverableError),x.unstable_transitionCallbacks!==void 0&&(it=x.unstable_transitionCallbacks),x.formState!==void 0&&(Ft=x.formState)),d=u_(o,1,!0,d,x??null,M,z,q,ue,Oe,it,Ft),d.context=h_(null),x=d.current,M=qs(),M=io(M),z=To(M),z.callback=null,Cc(x,z,M),x=M,d.current.lanes=x,dl(d,x),Oc(d),o[xe]=d.current,$m(o),new dm(d)},F_.version="19.1.1",F_}var yS;function FR(){if(yS)return Ax.exports;yS=1;function f(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(f)}catch(g){console.error(g)}}return f(),Ax.exports=NR(),Ax.exports}var BR=FR();/**
 * react-router v7.7.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var vS="popstate";function jR(f={}){function g(S,A){let{pathname:L,search:N,hash:r}=S.location;return ab("",{pathname:L,search:N,hash:r},A.state&&A.state.usr||null,A.state&&A.state.key||"default")}function w(S,A){return typeof A=="string"?A:K_(A)}return UR(g,w,null,f)}function Xs(f,g){if(f===!1||f===null||typeof f>"u")throw new Error(g)}function th(f,g){if(!f){typeof console<"u"&&console.warn(g);try{throw new Error(g)}catch{}}}function VR(){return Math.random().toString(36).substring(2,10)}function xS(f,g){return{usr:f.state,key:f.key,idx:g}}function ab(f,g,w=null,S){return{pathname:typeof f=="string"?f:f.pathname,search:"",hash:"",...typeof g=="string"?Pg(g):g,state:w,key:g&&g.key||S||VR()}}function K_({pathname:f="/",search:g="",hash:w=""}){return g&&g!=="?"&&(f+=g.charAt(0)==="?"?g:"?"+g),w&&w!=="#"&&(f+=w.charAt(0)==="#"?w:"#"+w),f}function Pg(f){let g={};if(f){let w=f.indexOf("#");w>=0&&(g.hash=f.substring(w),f=f.substring(0,w));let S=f.indexOf("?");S>=0&&(g.search=f.substring(S),f=f.substring(0,S)),f&&(g.pathname=f)}return g}function UR(f,g,w,S={}){let{window:A=document.defaultView,v5Compat:L=!1}=S,N=A.history,r="POP",F=null,B=$();B==null&&(B=0,N.replaceState({...N.state,idx:B},""));function $(){return(N.state||{idx:null}).idx}function ie(){r="POP";let ge=$(),pe=ge==null?null:ge-B;B=ge,F&&F({action:r,location:me.location,delta:pe})}function re(ge,pe){r="PUSH";let fe=ab(me.location,ge,pe);B=$()+1;let se=xS(fe,B),De=me.createHref(fe);try{N.pushState(se,"",De)}catch(we){if(we instanceof DOMException&&we.name==="DataCloneError")throw we;A.location.assign(De)}L&&F&&F({action:r,location:me.location,delta:1})}function Te(ge,pe){r="REPLACE";let fe=ab(me.location,ge,pe);B=$();let se=xS(fe,B),De=me.createHref(fe);N.replaceState(se,"",De),L&&F&&F({action:r,location:me.location,delta:0})}function _e(ge){return GR(ge)}let me={get action(){return r},get location(){return f(A,N)},listen(ge){if(F)throw new Error("A history only accepts one active listener");return A.addEventListener(vS,ie),F=ge,()=>{A.removeEventListener(vS,ie),F=null}},createHref(ge){return g(A,ge)},createURL:_e,encodeLocation(ge){let pe=_e(ge);return{pathname:pe.pathname,search:pe.search,hash:pe.hash}},push:re,replace:Te,go(ge){return N.go(ge)}};return me}function GR(f,g=!1){let w="http://localhost";typeof window<"u"&&(w=window.location.origin!=="null"?window.location.origin:window.location.href),Xs(w,"No window.location.(origin|href) available to create URL");let S=typeof f=="string"?f:K_(f);return S=S.replace(/ $/,"%20"),!g&&S.startsWith("//")&&(S=w+S),new URL(S,w)}function bE(f,g,w="/"){return HR(f,g,w,!1)}function HR(f,g,w,S){let A=typeof g=="string"?Pg(g):g,L=af(A.pathname||"/",w);if(L==null)return null;let N=wE(f);qR(N);let r=null;for(let F=0;r==null&&F<N.length;++F){let B=iD(L);r=eD(N[F],B,S)}return r}function wE(f,g=[],w=[],S=""){let A=(L,N,r)=>{let F={relativePath:r===void 0?L.path||"":r,caseSensitive:L.caseSensitive===!0,childrenIndex:N,route:L};F.relativePath.startsWith("/")&&(Xs(F.relativePath.startsWith(S),`Absolute route path "${F.relativePath}" nested under path "${S}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),F.relativePath=F.relativePath.slice(S.length));let B=rf([S,F.relativePath]),$=w.concat(F);L.children&&L.children.length>0&&(Xs(L.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${B}".`),wE(L.children,g,$,B)),!(L.path==null&&!L.index)&&g.push({path:B,score:QR(B,L.index),routesMeta:$})};return f.forEach((L,N)=>{if(L.path===""||!L.path?.includes("?"))A(L,N);else for(let r of TE(L.path))A(L,N,r)}),g}function TE(f){let g=f.split("/");if(g.length===0)return[];let[w,...S]=g,A=w.endsWith("?"),L=w.replace(/\?$/,"");if(S.length===0)return A?[L,""]:[L];let N=TE(S.join("/")),r=[];return r.push(...N.map(F=>F===""?L:[L,F].join("/"))),A&&r.push(...N),r.map(F=>f.startsWith("/")&&F===""?"/":F)}function qR(f){f.sort((g,w)=>g.score!==w.score?w.score-g.score:JR(g.routesMeta.map(S=>S.childrenIndex),w.routesMeta.map(S=>S.childrenIndex)))}var $R=/^:[\w-]+$/,ZR=3,WR=2,XR=1,YR=10,KR=-2,bS=f=>f==="*";function QR(f,g){let w=f.split("/"),S=w.length;return w.some(bS)&&(S+=KR),g&&(S+=WR),w.filter(A=>!bS(A)).reduce((A,L)=>A+($R.test(L)?ZR:L===""?XR:YR),S)}function JR(f,g){return f.length===g.length&&f.slice(0,-1).every((S,A)=>S===g[A])?f[f.length-1]-g[g.length-1]:0}function eD(f,g,w=!1){let{routesMeta:S}=f,A={},L="/",N=[];for(let r=0;r<S.length;++r){let F=S[r],B=r===S.length-1,$=L==="/"?g:g.slice(L.length)||"/",ie=Zv({path:F.relativePath,caseSensitive:F.caseSensitive,end:B},$),re=F.route;if(!ie&&B&&w&&!S[S.length-1].route.index&&(ie=Zv({path:F.relativePath,caseSensitive:F.caseSensitive,end:!1},$)),!ie)return null;Object.assign(A,ie.params),N.push({params:A,pathname:rf([L,ie.pathname]),pathnameBase:aD(rf([L,ie.pathnameBase])),route:re}),ie.pathnameBase!=="/"&&(L=rf([L,ie.pathnameBase]))}return N}function Zv(f,g){typeof f=="string"&&(f={path:f,caseSensitive:!1,end:!0});let[w,S]=tD(f.path,f.caseSensitive,f.end),A=g.match(w);if(!A)return null;let L=A[0],N=L.replace(/(.)\/+$/,"$1"),r=A.slice(1);return{params:S.reduce((B,{paramName:$,isOptional:ie},re)=>{if($==="*"){let _e=r[re]||"";N=L.slice(0,L.length-_e.length).replace(/(.)\/+$/,"$1")}const Te=r[re];return ie&&!Te?B[$]=void 0:B[$]=(Te||"").replace(/%2F/g,"/"),B},{}),pathname:L,pathnameBase:N,pattern:f}}function tD(f,g=!1,w=!0){th(f==="*"||!f.endsWith("*")||f.endsWith("/*"),`Route path "${f}" will be treated as if it were "${f.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${f.replace(/\*$/,"/*")}".`);let S=[],A="^"+f.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(N,r,F)=>(S.push({paramName:r,isOptional:F!=null}),F?"/?([^\\/]+)?":"/([^\\/]+)"));return f.endsWith("*")?(S.push({paramName:"*"}),A+=f==="*"||f==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):w?A+="\\/*$":f!==""&&f!=="/"&&(A+="(?:(?=\\/|$))"),[new RegExp(A,g?void 0:"i"),S]}function iD(f){try{return f.split("/").map(g=>decodeURIComponent(g).replace(/\//g,"%2F")).join("/")}catch(g){return th(!1,`The URL path "${f}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${g}).`),f}}function af(f,g){if(g==="/")return f;if(!f.toLowerCase().startsWith(g.toLowerCase()))return null;let w=g.endsWith("/")?g.length-1:g.length,S=f.charAt(w);return S&&S!=="/"?null:f.slice(w)||"/"}function nD(f,g="/"){let{pathname:w,search:S="",hash:A=""}=typeof f=="string"?Pg(f):f;return{pathname:w?w.startsWith("/")?w:rD(w,g):g,search:oD(S),hash:lD(A)}}function rD(f,g){let w=g.replace(/\/+$/,"").split("/");return f.split("/").forEach(A=>{A===".."?w.length>1&&w.pop():A!=="."&&w.push(A)}),w.length>1?w.join("/"):"/"}function Rx(f,g,w,S){return`Cannot include a '${f}' character in a manually specified \`to.${g}\` field [${JSON.stringify(S)}].  Please separate it out to the \`to.${w}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function sD(f){return f.filter((g,w)=>w===0||g.route.path&&g.route.path.length>0)}function Bb(f){let g=sD(f);return g.map((w,S)=>S===g.length-1?w.pathname:w.pathnameBase)}function jb(f,g,w,S=!1){let A;typeof f=="string"?A=Pg(f):(A={...f},Xs(!A.pathname||!A.pathname.includes("?"),Rx("?","pathname","search",A)),Xs(!A.pathname||!A.pathname.includes("#"),Rx("#","pathname","hash",A)),Xs(!A.search||!A.search.includes("#"),Rx("#","search","hash",A)));let L=f===""||A.pathname==="",N=L?"/":A.pathname,r;if(N==null)r=w;else{let ie=g.length-1;if(!S&&N.startsWith("..")){let re=N.split("/");for(;re[0]==="..";)re.shift(),ie-=1;A.pathname=re.join("/")}r=ie>=0?g[ie]:"/"}let F=nD(A,r),B=N&&N!=="/"&&N.endsWith("/"),$=(L||N===".")&&w.endsWith("/");return!F.pathname.endsWith("/")&&(B||$)&&(F.pathname+="/"),F}var rf=f=>f.join("/").replace(/\/\/+/g,"/"),aD=f=>f.replace(/\/+$/,"").replace(/^\/*/,"/"),oD=f=>!f||f==="?"?"":f.startsWith("?")?f:"?"+f,lD=f=>!f||f==="#"?"":f.startsWith("#")?f:"#"+f;function cD(f){return f!=null&&typeof f.status=="number"&&typeof f.statusText=="string"&&typeof f.internal=="boolean"&&"data"in f}var SE=["POST","PUT","PATCH","DELETE"];new Set(SE);var uD=["GET",...SE];new Set(uD);var Og=Re.createContext(null);Og.displayName="DataRouter";var c0=Re.createContext(null);c0.displayName="DataRouterState";Re.createContext(!1);var EE=Re.createContext({isTransitioning:!1});EE.displayName="ViewTransition";var hD=Re.createContext(new Map);hD.displayName="Fetchers";var dD=Re.createContext(null);dD.displayName="Await";var ih=Re.createContext(null);ih.displayName="Navigation";var oy=Re.createContext(null);oy.displayName="Location";var id=Re.createContext({outlet:null,matches:[],isDataRoute:!1});id.displayName="Route";var Vb=Re.createContext(null);Vb.displayName="RouteError";function fD(f,{relative:g}={}){Xs(Lg(),"useHref() may be used only in the context of a <Router> component.");let{basename:w,navigator:S}=Re.useContext(ih),{hash:A,pathname:L,search:N}=ly(f,{relative:g}),r=L;return w!=="/"&&(r=L==="/"?w:rf([w,L])),S.createHref({pathname:r,search:N,hash:A})}function Lg(){return Re.useContext(oy)!=null}function Nc(){return Xs(Lg(),"useLocation() may be used only in the context of a <Router> component."),Re.useContext(oy).location}var AE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function CE(f){Re.useContext(ih).static||Re.useLayoutEffect(f)}function gu(){let{isDataRoute:f}=Re.useContext(id);return f?AD():pD()}function pD(){Xs(Lg(),"useNavigate() may be used only in the context of a <Router> component.");let f=Re.useContext(Og),{basename:g,navigator:w}=Re.useContext(ih),{matches:S}=Re.useContext(id),{pathname:A}=Nc(),L=JSON.stringify(Bb(S)),N=Re.useRef(!1);return CE(()=>{N.current=!0}),Re.useCallback((F,B={})=>{if(th(N.current,AE),!N.current)return;if(typeof F=="number"){w.go(F);return}let $=jb(F,JSON.parse(L),A,B.relative==="path");f==null&&g!=="/"&&($.pathname=$.pathname==="/"?g:rf([g,$.pathname])),(B.replace?w.replace:w.push)($,B.state,B)},[g,w,L,A,f])}Re.createContext(null);function ly(f,{relative:g}={}){let{matches:w}=Re.useContext(id),{pathname:S}=Nc(),A=JSON.stringify(Bb(w));return Re.useMemo(()=>jb(f,JSON.parse(A),S,g==="path"),[f,A,S,g])}function mD(f,g){return ME(f,g)}function ME(f,g,w,S){Xs(Lg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:A}=Re.useContext(ih),{matches:L}=Re.useContext(id),N=L[L.length-1],r=N?N.params:{},F=N?N.pathname:"/",B=N?N.pathnameBase:"/",$=N&&N.route;{let pe=$&&$.path||"";IE(F,!$||pe.endsWith("*")||pe.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${F}" (under <Route path="${pe}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${pe}"> to <Route path="${pe==="/"?"*":`${pe}/*`}">.`)}let ie=Nc(),re;if(g){let pe=typeof g=="string"?Pg(g):g;Xs(B==="/"||pe.pathname?.startsWith(B),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${B}" but pathname "${pe.pathname}" was given in the \`location\` prop.`),re=pe}else re=ie;let Te=re.pathname||"/",_e=Te;if(B!=="/"){let pe=B.replace(/^\//,"").split("/");_e="/"+Te.replace(/^\//,"").split("/").slice(pe.length).join("/")}let me=bE(f,{pathname:_e});th($||me!=null,`No routes matched location "${re.pathname}${re.search}${re.hash}" `),th(me==null||me[me.length-1].route.element!==void 0||me[me.length-1].route.Component!==void 0||me[me.length-1].route.lazy!==void 0,`Matched leaf route at location "${re.pathname}${re.search}${re.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let ge=xD(me&&me.map(pe=>Object.assign({},pe,{params:Object.assign({},r,pe.params),pathname:rf([B,A.encodeLocation?A.encodeLocation(pe.pathname).pathname:pe.pathname]),pathnameBase:pe.pathnameBase==="/"?B:rf([B,A.encodeLocation?A.encodeLocation(pe.pathnameBase).pathname:pe.pathnameBase])})),L,w,S);return g&&ge?Re.createElement(oy.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...re},navigationType:"POP"}},ge):ge}function gD(){let f=ED(),g=cD(f)?`${f.status} ${f.statusText}`:f instanceof Error?f.message:JSON.stringify(f),w=f instanceof Error?f.stack:null,S="rgba(200,200,200, 0.5)",A={padding:"0.5rem",backgroundColor:S},L={padding:"2px 4px",backgroundColor:S},N=null;return console.error("Error handled by React Router default ErrorBoundary:",f),N=Re.createElement(Re.Fragment,null,Re.createElement("p",null,"💿 Hey developer 👋"),Re.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Re.createElement("code",{style:L},"ErrorBoundary")," or"," ",Re.createElement("code",{style:L},"errorElement")," prop on your route.")),Re.createElement(Re.Fragment,null,Re.createElement("h2",null,"Unexpected Application Error!"),Re.createElement("h3",{style:{fontStyle:"italic"}},g),w?Re.createElement("pre",{style:A},w):null,N)}var _D=Re.createElement(gD,null),yD=class extends Re.Component{constructor(f){super(f),this.state={location:f.location,revalidation:f.revalidation,error:f.error}}static getDerivedStateFromError(f){return{error:f}}static getDerivedStateFromProps(f,g){return g.location!==f.location||g.revalidation!=="idle"&&f.revalidation==="idle"?{error:f.error,location:f.location,revalidation:f.revalidation}:{error:f.error!==void 0?f.error:g.error,location:g.location,revalidation:f.revalidation||g.revalidation}}componentDidCatch(f,g){console.error("React Router caught the following error during render",f,g)}render(){return this.state.error!==void 0?Re.createElement(id.Provider,{value:this.props.routeContext},Re.createElement(Vb.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function vD({routeContext:f,match:g,children:w}){let S=Re.useContext(Og);return S&&S.static&&S.staticContext&&(g.route.errorElement||g.route.ErrorBoundary)&&(S.staticContext._deepestRenderedBoundaryId=g.route.id),Re.createElement(id.Provider,{value:f},w)}function xD(f,g=[],w=null,S=null){if(f==null){if(!w)return null;if(w.errors)f=w.matches;else if(g.length===0&&!w.initialized&&w.matches.length>0)f=w.matches;else return null}let A=f,L=w?.errors;if(L!=null){let F=A.findIndex(B=>B.route.id&&L?.[B.route.id]!==void 0);Xs(F>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(L).join(",")}`),A=A.slice(0,Math.min(A.length,F+1))}let N=!1,r=-1;if(w)for(let F=0;F<A.length;F++){let B=A[F];if((B.route.HydrateFallback||B.route.hydrateFallbackElement)&&(r=F),B.route.id){let{loaderData:$,errors:ie}=w,re=B.route.loader&&!$.hasOwnProperty(B.route.id)&&(!ie||ie[B.route.id]===void 0);if(B.route.lazy||re){N=!0,r>=0?A=A.slice(0,r+1):A=[A[0]];break}}}return A.reduceRight((F,B,$)=>{let ie,re=!1,Te=null,_e=null;w&&(ie=L&&B.route.id?L[B.route.id]:void 0,Te=B.route.errorElement||_D,N&&(r<0&&$===0?(IE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),re=!0,_e=null):r===$&&(re=!0,_e=B.route.hydrateFallbackElement||null)));let me=g.concat(A.slice(0,$+1)),ge=()=>{let pe;return ie?pe=Te:re?pe=_e:B.route.Component?pe=Re.createElement(B.route.Component,null):B.route.element?pe=B.route.element:pe=F,Re.createElement(vD,{match:B,routeContext:{outlet:F,matches:me,isDataRoute:w!=null},children:pe})};return w&&(B.route.ErrorBoundary||B.route.errorElement||$===0)?Re.createElement(yD,{location:w.location,revalidation:w.revalidation,component:Te,error:ie,children:ge(),routeContext:{outlet:null,matches:me,isDataRoute:!0}}):ge()},null)}function Ub(f){return`${f} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function bD(f){let g=Re.useContext(Og);return Xs(g,Ub(f)),g}function wD(f){let g=Re.useContext(c0);return Xs(g,Ub(f)),g}function TD(f){let g=Re.useContext(id);return Xs(g,Ub(f)),g}function Gb(f){let g=TD(f),w=g.matches[g.matches.length-1];return Xs(w.route.id,`${f} can only be used on routes that contain a unique "id"`),w.route.id}function SD(){return Gb("useRouteId")}function ED(){let f=Re.useContext(Vb),g=wD("useRouteError"),w=Gb("useRouteError");return f!==void 0?f:g.errors?.[w]}function AD(){let{router:f}=bD("useNavigate"),g=Gb("useNavigate"),w=Re.useRef(!1);return CE(()=>{w.current=!0}),Re.useCallback(async(A,L={})=>{th(w.current,AE),w.current&&(typeof A=="number"?f.navigate(A):await f.navigate(A,{fromRouteId:g,...L}))},[f,g])}var wS={};function IE(f,g,w){!g&&!wS[f]&&(wS[f]=!0,th(!1,w))}Re.memo(CD);function CD({routes:f,future:g,state:w}){return ME(f,void 0,w,g)}function MD({to:f,replace:g,state:w,relative:S}){Xs(Lg(),"<Navigate> may be used only in the context of a <Router> component.");let{static:A}=Re.useContext(ih);th(!A,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:L}=Re.useContext(id),{pathname:N}=Nc(),r=gu(),F=jb(f,Bb(L),N,S==="path"),B=JSON.stringify(F);return Re.useEffect(()=>{r(JSON.parse(B),{replace:g,state:w,relative:S})},[r,B,S,g,w]),null}function fo(f){Xs(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function ID({basename:f="/",children:g=null,location:w,navigationType:S="POP",navigator:A,static:L=!1}){Xs(!Lg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let N=f.replace(/^\/*/,"/"),r=Re.useMemo(()=>({basename:N,navigator:A,static:L,future:{}}),[N,A,L]);typeof w=="string"&&(w=Pg(w));let{pathname:F="/",search:B="",hash:$="",state:ie=null,key:re="default"}=w,Te=Re.useMemo(()=>{let _e=af(F,N);return _e==null?null:{location:{pathname:_e,search:B,hash:$,state:ie,key:re},navigationType:S}},[N,F,B,$,ie,re,S]);return th(Te!=null,`<Router basename="${N}"> is not able to match the URL "${F}${B}${$}" because it does not start with the basename, so the <Router> won't render anything.`),Te==null?null:Re.createElement(ih.Provider,{value:r},Re.createElement(oy.Provider,{children:g,value:Te}))}function RD({children:f,location:g}){return mD(ob(f),g)}function ob(f,g=[]){let w=[];return Re.Children.forEach(f,(S,A)=>{if(!Re.isValidElement(S))return;let L=[...g,A];if(S.type===Re.Fragment){w.push.apply(w,ob(S.props.children,L));return}Xs(S.type===fo,`[${typeof S.type=="string"?S.type:S.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Xs(!S.props.index||!S.props.children,"An index route cannot have child routes.");let N={id:S.props.id||L.join("-"),caseSensitive:S.props.caseSensitive,element:S.props.element,Component:S.props.Component,index:S.props.index,path:S.props.path,loader:S.props.loader,action:S.props.action,hydrateFallbackElement:S.props.hydrateFallbackElement,HydrateFallback:S.props.HydrateFallback,errorElement:S.props.errorElement,ErrorBoundary:S.props.ErrorBoundary,hasErrorBoundary:S.props.hasErrorBoundary===!0||S.props.ErrorBoundary!=null||S.props.errorElement!=null,shouldRevalidate:S.props.shouldRevalidate,handle:S.props.handle,lazy:S.props.lazy};S.props.children&&(N.children=ob(S.props.children,L)),w.push(N)}),w}var kv="get",Nv="application/x-www-form-urlencoded";function u0(f){return f!=null&&typeof f.tagName=="string"}function DD(f){return u0(f)&&f.tagName.toLowerCase()==="button"}function PD(f){return u0(f)&&f.tagName.toLowerCase()==="form"}function OD(f){return u0(f)&&f.tagName.toLowerCase()==="input"}function LD(f){return!!(f.metaKey||f.altKey||f.ctrlKey||f.shiftKey)}function zD(f,g){return f.button===0&&(!g||g==="_self")&&!LD(f)}var Av=null;function kD(){if(Av===null)try{new FormData(document.createElement("form"),0),Av=!1}catch{Av=!0}return Av}var ND=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Dx(f){return f!=null&&!ND.has(f)?(th(!1,`"${f}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nv}"`),null):f}function FD(f,g){let w,S,A,L,N;if(PD(f)){let r=f.getAttribute("action");S=r?af(r,g):null,w=f.getAttribute("method")||kv,A=Dx(f.getAttribute("enctype"))||Nv,L=new FormData(f)}else if(DD(f)||OD(f)&&(f.type==="submit"||f.type==="image")){let r=f.form;if(r==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let F=f.getAttribute("formaction")||r.getAttribute("action");if(S=F?af(F,g):null,w=f.getAttribute("formmethod")||r.getAttribute("method")||kv,A=Dx(f.getAttribute("formenctype"))||Dx(r.getAttribute("enctype"))||Nv,L=new FormData(r,f),!kD()){let{name:B,type:$,value:ie}=f;if($==="image"){let re=B?`${B}.`:"";L.append(`${re}x`,"0"),L.append(`${re}y`,"0")}else B&&L.append(B,ie)}}else{if(u0(f))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');w=kv,S=null,A=Nv,N=f}return L&&A==="text/plain"&&(N=L,L=void 0),{action:S,method:w.toLowerCase(),encType:A,formData:L,body:N}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Hb(f,g){if(f===!1||f===null||typeof f>"u")throw new Error(g)}function BD(f,g,w){let S=typeof f=="string"?new URL(f,typeof window>"u"?"server://singlefetch/":window.location.origin):f;return S.pathname==="/"?S.pathname=`_root.${w}`:g&&af(S.pathname,g)==="/"?S.pathname=`${g.replace(/\/$/,"")}/_root.${w}`:S.pathname=`${S.pathname.replace(/\/$/,"")}.${w}`,S}async function jD(f,g){if(f.id in g)return g[f.id];try{let w=await import(f.module);return g[f.id]=w,w}catch(w){return console.error(`Error loading route module \`${f.module}\`, reloading page...`),console.error(w),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function VD(f){return f==null?!1:f.href==null?f.rel==="preload"&&typeof f.imageSrcSet=="string"&&typeof f.imageSizes=="string":typeof f.rel=="string"&&typeof f.href=="string"}async function UD(f,g,w){let S=await Promise.all(f.map(async A=>{let L=g.routes[A.route.id];if(L){let N=await jD(L,w);return N.links?N.links():[]}return[]}));return $D(S.flat(1).filter(VD).filter(A=>A.rel==="stylesheet"||A.rel==="preload").map(A=>A.rel==="stylesheet"?{...A,rel:"prefetch",as:"style"}:{...A,rel:"prefetch"}))}function TS(f,g,w,S,A,L){let N=(F,B)=>w[B]?F.route.id!==w[B].route.id:!0,r=(F,B)=>w[B].pathname!==F.pathname||w[B].route.path?.endsWith("*")&&w[B].params["*"]!==F.params["*"];return L==="assets"?g.filter((F,B)=>N(F,B)||r(F,B)):L==="data"?g.filter((F,B)=>{let $=S.routes[F.route.id];if(!$||!$.hasLoader)return!1;if(N(F,B)||r(F,B))return!0;if(F.route.shouldRevalidate){let ie=F.route.shouldRevalidate({currentUrl:new URL(A.pathname+A.search+A.hash,window.origin),currentParams:w[0]?.params||{},nextUrl:new URL(f,window.origin),nextParams:F.params,defaultShouldRevalidate:!0});if(typeof ie=="boolean")return ie}return!0}):[]}function GD(f,g,{includeHydrateFallback:w}={}){return HD(f.map(S=>{let A=g.routes[S.route.id];if(!A)return[];let L=[A.module];return A.clientActionModule&&(L=L.concat(A.clientActionModule)),A.clientLoaderModule&&(L=L.concat(A.clientLoaderModule)),w&&A.hydrateFallbackModule&&(L=L.concat(A.hydrateFallbackModule)),A.imports&&(L=L.concat(A.imports)),L}).flat(1))}function HD(f){return[...new Set(f)]}function qD(f){let g={},w=Object.keys(f).sort();for(let S of w)g[S]=f[S];return g}function $D(f,g){let w=new Set;return new Set(g),f.reduce((S,A)=>{let L=JSON.stringify(qD(A));return w.has(L)||(w.add(L),S.push({key:L,link:A})),S},[])}function RE(){let f=Re.useContext(Og);return Hb(f,"You must render this element inside a <DataRouterContext.Provider> element"),f}function ZD(){let f=Re.useContext(c0);return Hb(f,"You must render this element inside a <DataRouterStateContext.Provider> element"),f}var qb=Re.createContext(void 0);qb.displayName="FrameworkContext";function DE(){let f=Re.useContext(qb);return Hb(f,"You must render this element inside a <HydratedRouter> element"),f}function WD(f,g){let w=Re.useContext(qb),[S,A]=Re.useState(!1),[L,N]=Re.useState(!1),{onFocus:r,onBlur:F,onMouseEnter:B,onMouseLeave:$,onTouchStart:ie}=g,re=Re.useRef(null);Re.useEffect(()=>{if(f==="render"&&N(!0),f==="viewport"){let me=pe=>{pe.forEach(fe=>{N(fe.isIntersecting)})},ge=new IntersectionObserver(me,{threshold:.5});return re.current&&ge.observe(re.current),()=>{ge.disconnect()}}},[f]),Re.useEffect(()=>{if(S){let me=setTimeout(()=>{N(!0)},100);return()=>{clearTimeout(me)}}},[S]);let Te=()=>{A(!0)},_e=()=>{A(!1),N(!1)};return w?f!=="intent"?[L,re,{}]:[L,re,{onFocus:B_(r,Te),onBlur:B_(F,_e),onMouseEnter:B_(B,Te),onMouseLeave:B_($,_e),onTouchStart:B_(ie,Te)}]:[!1,re,{}]}function B_(f,g){return w=>{f&&f(w),w.defaultPrevented||g(w)}}function XD({page:f,...g}){let{router:w}=RE(),S=Re.useMemo(()=>bE(w.routes,f,w.basename),[w.routes,f,w.basename]);return S?Re.createElement(KD,{page:f,matches:S,...g}):null}function YD(f){let{manifest:g,routeModules:w}=DE(),[S,A]=Re.useState([]);return Re.useEffect(()=>{let L=!1;return UD(f,g,w).then(N=>{L||A(N)}),()=>{L=!0}},[f,g,w]),S}function KD({page:f,matches:g,...w}){let S=Nc(),{manifest:A,routeModules:L}=DE(),{basename:N}=RE(),{loaderData:r,matches:F}=ZD(),B=Re.useMemo(()=>TS(f,g,F,A,S,"data"),[f,g,F,A,S]),$=Re.useMemo(()=>TS(f,g,F,A,S,"assets"),[f,g,F,A,S]),ie=Re.useMemo(()=>{if(f===S.pathname+S.search+S.hash)return[];let _e=new Set,me=!1;if(g.forEach(pe=>{let fe=A.routes[pe.route.id];!fe||!fe.hasLoader||(!B.some(se=>se.route.id===pe.route.id)&&pe.route.id in r&&L[pe.route.id]?.shouldRevalidate||fe.hasClientLoader?me=!0:_e.add(pe.route.id))}),_e.size===0)return[];let ge=BD(f,N,"data");return me&&_e.size>0&&ge.searchParams.set("_routes",g.filter(pe=>_e.has(pe.route.id)).map(pe=>pe.route.id).join(",")),[ge.pathname+ge.search]},[N,r,S,A,B,g,f,L]),re=Re.useMemo(()=>GD($,A),[$,A]),Te=YD($);return Re.createElement(Re.Fragment,null,ie.map(_e=>Re.createElement("link",{key:_e,rel:"prefetch",as:"fetch",href:_e,...w})),re.map(_e=>Re.createElement("link",{key:_e,rel:"modulepreload",href:_e,...w})),Te.map(({key:_e,link:me})=>Re.createElement("link",{key:_e,...me})))}function QD(...f){return g=>{f.forEach(w=>{typeof w=="function"?w(g):w!=null&&(w.current=g)})}}var PE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{PE&&(window.__reactRouterVersion="7.7.1")}catch{}function JD({basename:f,children:g,window:w}){let S=Re.useRef();S.current==null&&(S.current=jR({window:w,v5Compat:!0}));let A=S.current,[L,N]=Re.useState({action:A.action,location:A.location}),r=Re.useCallback(F=>{Re.startTransition(()=>N(F))},[N]);return Re.useLayoutEffect(()=>A.listen(r),[A,r]),Re.createElement(ID,{basename:f,children:g,location:L.location,navigationType:L.action,navigator:A})}var OE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,lc=Re.forwardRef(function({onClick:g,discover:w="render",prefetch:S="none",relative:A,reloadDocument:L,replace:N,state:r,target:F,to:B,preventScrollReset:$,viewTransition:ie,...re},Te){let{basename:_e}=Re.useContext(ih),me=typeof B=="string"&&OE.test(B),ge,pe=!1;if(typeof B=="string"&&me&&(ge=B,PE))try{let Xe=new URL(window.location.href),je=B.startsWith("//")?new URL(Xe.protocol+B):new URL(B),$e=af(je.pathname,_e);je.origin===Xe.origin&&$e!=null?B=$e+je.search+je.hash:pe=!0}catch{th(!1,`<Link to="${B}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let fe=fD(B,{relative:A}),[se,De,we]=WD(S,re),ht=nP(B,{replace:N,state:r,target:F,preventScrollReset:$,relative:A,viewTransition:ie});function At(Xe){g&&g(Xe),Xe.defaultPrevented||ht(Xe)}let gt=Re.createElement("a",{...re,...we,href:ge||fe,onClick:pe||L?g:At,ref:QD(Te,De),target:F,"data-discover":!me&&w==="render"?"true":void 0});return se&&!me?Re.createElement(Re.Fragment,null,gt,Re.createElement(XD,{page:fe})):gt});lc.displayName="Link";var eP=Re.forwardRef(function({"aria-current":g="page",caseSensitive:w=!1,className:S="",end:A=!1,style:L,to:N,viewTransition:r,children:F,...B},$){let ie=ly(N,{relative:B.relative}),re=Nc(),Te=Re.useContext(c0),{navigator:_e,basename:me}=Re.useContext(ih),ge=Te!=null&&lP(ie)&&r===!0,pe=_e.encodeLocation?_e.encodeLocation(ie).pathname:ie.pathname,fe=re.pathname,se=Te&&Te.navigation&&Te.navigation.location?Te.navigation.location.pathname:null;w||(fe=fe.toLowerCase(),se=se?se.toLowerCase():null,pe=pe.toLowerCase()),se&&me&&(se=af(se,me)||se);const De=pe!=="/"&&pe.endsWith("/")?pe.length-1:pe.length;let we=fe===pe||!A&&fe.startsWith(pe)&&fe.charAt(De)==="/",ht=se!=null&&(se===pe||!A&&se.startsWith(pe)&&se.charAt(pe.length)==="/"),At={isActive:we,isPending:ht,isTransitioning:ge},gt=we?g:void 0,Xe;typeof S=="function"?Xe=S(At):Xe=[S,we?"active":null,ht?"pending":null,ge?"transitioning":null].filter(Boolean).join(" ");let je=typeof L=="function"?L(At):L;return Re.createElement(lc,{...B,"aria-current":gt,className:Xe,ref:$,style:je,to:N,viewTransition:r},typeof F=="function"?F(At):F)});eP.displayName="NavLink";var tP=Re.forwardRef(({discover:f="render",fetcherKey:g,navigate:w,reloadDocument:S,replace:A,state:L,method:N=kv,action:r,onSubmit:F,relative:B,preventScrollReset:$,viewTransition:ie,...re},Te)=>{let _e=aP(),me=oP(r,{relative:B}),ge=N.toLowerCase()==="get"?"get":"post",pe=typeof r=="string"&&OE.test(r),fe=se=>{if(F&&F(se),se.defaultPrevented)return;se.preventDefault();let De=se.nativeEvent.submitter,we=De?.getAttribute("formmethod")||N;_e(De||se.currentTarget,{fetcherKey:g,method:we,navigate:w,replace:A,state:L,relative:B,preventScrollReset:$,viewTransition:ie})};return Re.createElement("form",{ref:Te,method:ge,action:me,onSubmit:S?F:fe,...re,"data-discover":!pe&&f==="render"?"true":void 0})});tP.displayName="Form";function iP(f){return`${f} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function LE(f){let g=Re.useContext(Og);return Xs(g,iP(f)),g}function nP(f,{target:g,replace:w,state:S,preventScrollReset:A,relative:L,viewTransition:N}={}){let r=gu(),F=Nc(),B=ly(f,{relative:L});return Re.useCallback($=>{if(zD($,g)){$.preventDefault();let ie=w!==void 0?w:K_(F)===K_(B);r(f,{replace:ie,state:S,preventScrollReset:A,relative:L,viewTransition:N})}},[F,r,B,w,S,g,f,A,L,N])}var rP=0,sP=()=>`__${String(++rP)}__`;function aP(){let{router:f}=LE("useSubmit"),{basename:g}=Re.useContext(ih),w=SD();return Re.useCallback(async(S,A={})=>{let{action:L,method:N,encType:r,formData:F,body:B}=FD(S,g);if(A.navigate===!1){let $=A.fetcherKey||sP();await f.fetch($,w,A.action||L,{preventScrollReset:A.preventScrollReset,formData:F,body:B,formMethod:A.method||N,formEncType:A.encType||r,flushSync:A.flushSync})}else await f.navigate(A.action||L,{preventScrollReset:A.preventScrollReset,formData:F,body:B,formMethod:A.method||N,formEncType:A.encType||r,replace:A.replace,state:A.state,fromRouteId:w,flushSync:A.flushSync,viewTransition:A.viewTransition})},[f,g,w])}function oP(f,{relative:g}={}){let{basename:w}=Re.useContext(ih),S=Re.useContext(id);Xs(S,"useFormAction must be used inside a RouteContext");let[A]=S.matches.slice(-1),L={...ly(f||".",{relative:g})},N=Nc();if(f==null){L.search=N.search;let r=new URLSearchParams(L.search),F=r.getAll("index");if(F.some($=>$==="")){r.delete("index"),F.filter(ie=>ie).forEach(ie=>r.append("index",ie));let $=r.toString();L.search=$?`?${$}`:""}}return(!f||f===".")&&A.route.index&&(L.search=L.search?L.search.replace(/^\?/,"?index&"):"?index"),w!=="/"&&(L.pathname=L.pathname==="/"?w:rf([w,L.pathname])),K_(L)}function lP(f,{relative:g}={}){let w=Re.useContext(EE);Xs(w!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:S}=LE("useViewTransitionState"),A=ly(f,{relative:g});if(!w.isTransitioning)return!1;let L=af(w.currentLocation.pathname,S)||w.currentLocation.pathname,N=af(w.nextLocation.pathname,S)||w.nextLocation.pathname;return Zv(A.pathname,N)!=null||Zv(A.pathname,L)!=null}var cP=xE();const zE="/api/auth",kE="pk.eyJ1Ijoic2F5YWlib3NsIiwiYSI6ImNtZG12bTgwdDFrdzkya3NmamoycXRteXQifQ.DZE5B9Hx6dXtGVGPUMYnYA";async function $b(f){return(await fetch(`${zE}/request-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})).json()}async function Zb(f){return(await fetch(`${zE}/verify-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})).json()}const NE=Re.createContext(),uP=({children:f})=>{const[g,w]=Re.useState(null),S=L=>{localStorage.setItem("user",JSON.stringify(L)),w(L)},A=()=>{w(null),localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("user")};return Re.useEffect(()=>{const L=localStorage.getItem("token"),N=localStorage.getItem("user");L&&N&&w(JSON.parse(N))},[]),W.jsx(NE.Provider,{value:{user:g,login:S,logout:A},children:f})},Im=()=>Re.useContext(NE);function hP(){const[f,g]=Re.useState(""),[w,S]=Re.useState(""),[A,L]=Re.useState(1),[N,r]=Re.useState(!0),[F,B]=Re.useState(""),$=gu(),{login:ie}=Im(),re=async()=>{const me=N?{email:f,role:"restaurant"}:{phone:f,role:"restaurant"};try{const ge=await $b(me);ge.newUser?$("/register",{state:{identifier:f,isEmail:N,otp:ge.otp}}):ge.otp?(B(`OTP sent to your ${N?"email":"phone"}`),L(2)):B(ge.msg||"Unexpected error")}catch{B("Failed to request OTP")}},Te=async()=>{const me=N?{email:f,otp:w}:{phone:f,otp:w};try{const ge=await Zb(me);ge.token?(localStorage.setItem("token",ge.token),localStorage.setItem("user",JSON.stringify(ge.user)),localStorage.setItem("role",ge.user.role),ie(ge.user),$("/restaurant-onboard")):B(ge.msg||"Invalid OTP")}catch{B("OTP verification failed")}},_e=()=>{L(1),S(""),B("")};return W.jsxs("div",{className:"min-h-screen flex",children:[W.jsx("div",{className:"hidden md:flex w-1/2 bg-cover bg-center",style:{backgroundImage:"url('/your-partner-banner.jpg')"},children:W.jsxs("div",{className:"h-full w-full bg-black bg-opacity-5 p-10 flex flex-col justify-center text-white",children:[W.jsx("p",{className:"uppercase text-sm tracking-wider text-orange-400 mb-2",children:"Partner with FoodYah!"}),W.jsx("h1",{className:"text-4xl font-bold leading-snug",children:"Access to FoodYah tools and support"})]})}),W.jsx("div",{className:"w-full md:w-1/2 flex items-center justify-center bg-gray-50",children:W.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg w-full max-w-sm",children:[W.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Get Started"}),W.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Enter a mobile number or email to continue"}),W.jsxs("div",{className:"flex gap-2 mb-4",children:[W.jsx("button",{onClick:()=>r(!0),disabled:A!==1,className:`w-1/2 py-2 rounded-full font-medium text-sm ${N?"bg-orange-400 text-white":"bg-gray-100 text-gray-700"}`,children:"Email"}),W.jsx("button",{onClick:()=>r(!1),disabled:A!==1,className:`w-1/2 py-2 rounded-full font-medium text-sm ${N?"bg-gray-100 text-gray-700":"bg-orange-400 text-white"}`,children:"Phone"})]}),A===1?W.jsxs(W.Fragment,{children:[W.jsx("input",{type:"text",value:f,onChange:me=>g(me.target.value),placeholder:N?"Enter your email address":"Enter your phone number",className:"w-full px-4 py-3 border border-gray-300 rounded-md mb-4 focus:ring-2 focus:ring-orange-400 focus:outline-none"}),W.jsx("button",{onClick:re,className:"w-full py-3 bg-orange-400 hover:bg-orange-500 text-white font-semibold rounded-md transition",children:"Continue"})]}):W.jsxs(W.Fragment,{children:[W.jsx("input",{type:"text",value:w,onChange:me=>S(me.target.value),placeholder:"Enter OTP",className:"w-full px-4 py-3 border border-gray-300 rounded-md mb-4 focus:ring-2 focus:ring-green-400 focus:outline-none"}),W.jsxs("div",{className:"flex gap-4",children:[W.jsx("button",{onClick:_e,className:"w-1/2 py-3 border border-gray-300 text-gray-700 rounded-md",children:"Back"}),W.jsx("button",{onClick:Te,className:"w-1/2 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-md",children:"Verify"})]})]}),F&&W.jsx("p",{className:"text-sm text-center text-red-500 mt-4",children:F}),W.jsxs("p",{className:"text-xs text-center text-grey-100 pt-2",children:["New here?"," ",W.jsx(lc,{to:"/restaurant-register",children:W.jsx("span",{className:"underline",children:"Register"})})]}),W.jsxs("p",{className:"text-xs text-center text-gray-400 mt-6",children:["By logging in, you agree to FoodYah's"," ",W.jsx("span",{className:"underline",children:"terms & conditions"}),"."]})]})})]})}function dP(){const g=Nc()?.state||{},[w,S]=Re.useState(""),[A,L]=Re.useState(g?.otp||""),[N,r]=Re.useState(""),[F,B]=Re.useState(""),$=gu(),ie=async()=>{const _e=await(await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:w,email:F,phone:N,otp:A,role:"user"})})).json();console.log(_e),_e.success?(alert("Your registration is complete. Please login."),$("/user-login",{replace:!0})):alert(_e.msg||"Registration failed.")};return W.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-orange-400 via-orange-700 to-red-500",children:W.jsxs("div",{className:"bg-white/10 backdrop-blur-md p-8 rounded-2xl shadow-2xl w-full max-w-md text-white",children:[W.jsx("div",{className:"flex justify-center mb-6",children:W.jsx("div",{className:"bg-white/20 p-4 rounded-full",children:W.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:W.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 14l9-5-9-5-9 5 9 5z"})})})}),W.jsxs("h2",{className:"text-3xl font-bold text-center mb-2",children:["Welcome to ",W.jsx("span",{className:"text-yellow-300",children:"FoodYah"})]}),W.jsx("p",{className:"text-center text-sm mb-4 text-orange-100",children:"Complete your registration to continue"}),W.jsx("input",{type:"text",placeholder:"Full Name",value:w,onChange:re=>S(re.target.value),className:"w-full p-3 mb-4 rounded-md bg-white/20 placeholder-white text-white focus:outline-none"}),W.jsx("input",{type:"email",placeholder:"Enter your email",value:F,onChange:re=>B(re.target.value),className:"w-full p-3 mb-4 rounded-md bg-white/20 placeholder-white text-white focus:outline-none"}),W.jsx("input",{type:"tel",placeholder:"Enter your phone number",value:N,onChange:re=>r(re.target.value),className:"w-full p-3 mb-4 rounded-md bg-white/20 placeholder-white text-white focus:outline-none"}),W.jsx("input",{type:"text",placeholder:"OTP",value:A,onChange:re=>L(re.target.value),className:"w-full p-3 mb-6 rounded-md bg-white/20 placeholder-white text-white focus:outline-none"}),W.jsx("button",{onClick:ie,className:"w-full py-3 rounded-md bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 text-white font-semibold transition-all",children:"Register"}),W.jsxs("p",{className:"mt-6 text-center text-xs text-orange-200",children:["By continuing, you agree to our"," ",W.jsx("span",{className:"underline",children:"Terms of Service"})," and"," ",W.jsx("span",{className:"underline",children:"Privacy Policy"}),"."]})]})})}const fP="/assets/partner-CKm4pGKw.jpg",pP=()=>W.jsxs("section",{className:"bg-gradient-to-br from-[#FF6600] to-[#FF3C28] text-white py-24 px-6 md:px-20 flex flex-col md:flex-row items-center justify-between gap-10",children:[W.jsxs("div",{className:"text-center md:text-left max-w-xl",children:[W.jsxs("h1",{className:"text-4xl md:text-5xl font-extrabold mb-6 leading-tight drop-shadow",children:["Partner with ",W.jsx("span",{className:"text-yellow-300",children:"FoodYah"})]}),W.jsx("p",{className:"text-lg md:text-xl text-red-100 mb-8",children:"Grow your restaurant business with online orders, real-time tracking, and a wide customer base — all powered by FoodYah."}),W.jsx(lc,{to:"/restaurant-onboard",children:W.jsx("button",{className:"bg-white text-red-600 hover:bg-red-100 px-8 py-3 rounded-full font-bold text-lg shadow-lg transition cursor-pointer",children:"🚀 Get Started Now"})})]}),W.jsx("img",{src:fP,alt:"Partner with FoodYah",className:"w-full max-w-md rounded-xl shadow-xl"})]});var FE={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},SS=fp.createContext&&fp.createContext(FE),mP=["attr","size","title"];function gP(f,g){if(f==null)return{};var w=_P(f,g),S,A;if(Object.getOwnPropertySymbols){var L=Object.getOwnPropertySymbols(f);for(A=0;A<L.length;A++)S=L[A],!(g.indexOf(S)>=0)&&Object.prototype.propertyIsEnumerable.call(f,S)&&(w[S]=f[S])}return w}function _P(f,g){if(f==null)return{};var w={};for(var S in f)if(Object.prototype.hasOwnProperty.call(f,S)){if(g.indexOf(S)>=0)continue;w[S]=f[S]}return w}function Wv(){return Wv=Object.assign?Object.assign.bind():function(f){for(var g=1;g<arguments.length;g++){var w=arguments[g];for(var S in w)Object.prototype.hasOwnProperty.call(w,S)&&(f[S]=w[S])}return f},Wv.apply(this,arguments)}function ES(f,g){var w=Object.keys(f);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(f);g&&(S=S.filter(function(A){return Object.getOwnPropertyDescriptor(f,A).enumerable})),w.push.apply(w,S)}return w}function Xv(f){for(var g=1;g<arguments.length;g++){var w=arguments[g]!=null?arguments[g]:{};g%2?ES(Object(w),!0).forEach(function(S){yP(f,S,w[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(w)):ES(Object(w)).forEach(function(S){Object.defineProperty(f,S,Object.getOwnPropertyDescriptor(w,S))})}return f}function yP(f,g,w){return g=vP(g),g in f?Object.defineProperty(f,g,{value:w,enumerable:!0,configurable:!0,writable:!0}):f[g]=w,f}function vP(f){var g=xP(f,"string");return typeof g=="symbol"?g:g+""}function xP(f,g){if(typeof f!="object"||!f)return f;var w=f[Symbol.toPrimitive];if(w!==void 0){var S=w.call(f,g);if(typeof S!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(f)}function BE(f){return f&&f.map((g,w)=>fp.createElement(g.tag,Xv({key:w},g.attr),BE(g.child)))}function cy(f){return g=>fp.createElement(bP,Wv({attr:Xv({},f.attr)},g),BE(f.child))}function bP(f){var g=w=>{var{attr:S,size:A,title:L}=f,N=gP(f,mP),r=A||w.size||"1em",F;return w.className&&(F=w.className),f.className&&(F=(F?F+" ":"")+f.className),fp.createElement("svg",Wv({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},w.attr,S,N,{className:F,style:Xv(Xv({color:f.color||w.color},w.style),f.style),height:r,width:r,xmlns:"http://www.w3.org/2000/svg"}),L&&fp.createElement("title",null,L),f.children)};return SS!==void 0?fp.createElement(SS.Consumer,null,w=>g(w)):g(FE)}function wP(f){return cy({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M488 192H336v56c0 39.7-32.3 72-72 72s-72-32.3-72-72V126.4l-64.9 39C107.8 176.9 96 197.8 96 220.2v47.3l-80 46.2C.7 322.5-4.6 342.1 4.3 357.4l80 138.6c8.8 15.3 28.4 20.5 43.7 11.7L231.4 448H368c35.3 0 64-28.7 64-64h16c17.7 0 32-14.3 32-32v-64h8c13.3 0 24-10.7 24-24v-48c0-13.3-10.7-24-24-24zm147.7-37.4L555.7 16C546.9.7 527.3-4.5 512 4.3L408.6 64H306.4c-12 0-23.7 3.4-33.9 9.7L239 94.6c-9.4 5.8-15 16.1-15 27.1V248c0 22.1 17.9 40 40 40s40-17.9 40-40v-88h184c30.9 0 56 25.1 56 56v28.5l80-46.2c15.3-8.9 20.5-28.4 11.7-43.7z"},child:[]}]})(f)}function TP(f){return cy({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(f)}function SP(f){return cy({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M512.9 192c-14.9-.1-29.1 2.3-42.4 6.9L437.6 144H520c13.3 0 24-10.7 24-24V88c0-13.3-10.7-24-24-24h-45.3c-6.8 0-13.3 2.9-17.8 7.9l-37.5 41.7-22.8-38C392.2 68.4 384.4 64 376 64h-80c-8.8 0-16 7.2-16 16v16c0 8.8 7.2 16 16 16h66.4l19.2 32H227.9c-17.7-23.1-44.9-40-99.9-40H72.5C59 104 47.7 115 48 128.5c.2 13 10.9 23.5 24 23.5h56c24.5 0 38.7 10.9 47.8 24.8l-11.3 20.5c-13-3.9-26.9-5.7-41.3-5.2C55.9 194.5 1.6 249.6 0 317c-1.6 72.1 56.3 131 128 131 59.6 0 109.7-40.8 124-96h84.2c13.7 0 24.6-11.4 24-25.1-2.1-47.1 17.5-93.7 56.2-125l12.5 20.8c-27.6 23.7-45.1 58.9-44.8 98.2.5 69.6 57.2 126.5 126.8 127.1 71.6.7 129.8-57.5 129.2-129.1-.7-69.6-57.6-126.4-127.2-126.9zM128 400c-44.1 0-80-35.9-80-80s35.9-80 80-80c4.2 0 8.4.3 12.5 1L99 316.4c-8.8 16 2.8 35.6 21 35.6h81.3c-12.4 28.2-40.6 48-73.3 48zm463.9-75.6c-2.2 40.6-35 73.4-75.5 75.5-46.1 2.5-84.4-34.3-84.4-79.9 0-21.4 8.4-40.8 22.1-55.1l49.4 82.4c4.5 7.6 14.4 10 22 5.5l13.7-8.2c7.6-4.5 10-14.4 5.5-22l-48.6-80.9c5.2-1.1 10.5-1.6 15.9-1.6 45.6-.1 82.3 38.2 79.9 84.3z"},child:[]}]})(f)}function EP(f){return cy({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(f)}function AP(f){return cy({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(f)}const CP=[{title:"New Customers",description:"Reach millions of hungry users near you and grow your restaurant’s visibility.",icon:W.jsx(AP,{className:"text-4xl text-red-500 mb-4"})},{title:"Delivery Support",description:"Get your food delivered fast and fresh by our trained rider fleet.",icon:W.jsx(SP,{className:"text-4xl text-red-500 mb-4"})},{title:"Onboarding Help",description:"Dedicated onboarding managers to assist you every step of the way.",icon:W.jsx(wP,{className:"text-4xl text-red-500 mb-4"})}],MP=()=>W.jsx("section",{className:"py-20 bg-white",children:W.jsxs("div",{className:"max-w-6xl mx-auto px-6 text-center",children:[W.jsx("h2",{className:"text-3xl font-bold text-orange-600 mb-12",children:"Why Partner with FoodYah?"}),W.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8",children:CP.map((f,g)=>W.jsxs("div",{className:"bg-gray-50 p-8 rounded-xl shadow hover:shadow-md transition",children:[f.icon,W.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-800",children:f.title}),W.jsx("p",{className:"text-gray-600",children:f.description})]},g))})]})}),IP="/assets/registration-Cys5_nTe.jpg",RP="/assets/upload-DvQzGqLz.jpg",DP="/assets/menu-Bf5a9nEt.jpg",PP=[{step:"Step 1",text:"Register your restaurant on FoodYah to reach more customers, boost your online presence, and get officially verified for increased trust and visibility.",image:IP},{step:"Step 2",text:"Easily upload your restaurant’s menu, set your operating hours, and go live on FoodYah to start receiving orders from hungry customers in your area.",image:RP},{step:"Step 3",text:"Begin receiving and managing customer orders in real-time, ensuring fast, efficient service and a seamless dining experience for your customers.",image:DP}],OP=()=>W.jsx("section",{className:"bg-gray-100 py-20",children:W.jsxs("div",{className:"max-w-6xl mx-auto px-6",children:[W.jsx("h2",{className:"text-3xl font-bold text-center mb-12 text-red-600",children:"How It Works"}),W.jsx("div",{className:"space-y-20",children:PP.map((f,g)=>W.jsxs("div",{className:`flex flex-col-reverse md:flex-row ${g%2!==0?"md:flex-row-reverse":""} items-center gap-10`,children:[W.jsxs("div",{className:"md:w-1/2",children:[W.jsx("h3",{className:"text-2xl font-bold mb-3 text-gray-800",children:f.step}),W.jsx("p",{className:"text-gray-700 text-lg",children:f.text})]}),W.jsx("div",{className:"md:w-1/2",children:W.jsx("img",{src:f.image,alt:f.step,className:"p-10 w-full rounded-xl shadow-lg"})})]},g))})]})}),LP=[{question:"What documents are required?",answer:"PAN, GST, FSSAI license, menu images, bank details."},{question:"Is onboarding free?",answer:"Yes, listing is free. FoodYah charges a commission per order."},{question:"How long does onboarding take?",answer:"Typically 2-3 working days after verification."},{question:"Can I update my menu anytime?",answer:"Yes, you can update your menu, prices, and availability from the partner dashboard."}],zP=()=>{const[f,g]=Re.useState(null);return W.jsx("section",{className:"py-16 bg-white",children:W.jsxs("div",{className:"max-w-3xl mx-auto px-6",children:[W.jsx("h2",{className:"text-3xl font-bold mb-8 text-center text-red-600",children:"Frequently Asked Questions"}),LP.map((w,S)=>W.jsxs("div",{className:"border border-gray-200 rounded-lg mb-4 overflow-hidden transition-all",children:[W.jsxs("button",{onClick:()=>g(f===S?null:S),className:"w-full flex justify-between items-center px-5 py-4 text-left font-medium text-gray-800 hover:bg-gray-50 transition","aria-expanded":f===S,children:[W.jsx("span",{children:w.question}),f===S?W.jsx(TP,{className:"text-red-500"}):W.jsx(EP,{className:"text-red-500"})]}),W.jsx("div",{className:`px-5 pb-4 text-gray-600 text-sm transition-all duration-300 ${f===S?"block":"hidden"}`,children:w.answer})]},S))]})})},kP=()=>W.jsx("footer",{className:"bg-red-600 text-white py-6 text-center",children:W.jsxs("p",{children:["© ",new Date().getFullYear()," FoodYah Clone. Built with ❤️ using React + Tailwind."]})});function NP(){const[f,g]=Re.useState(!1);return Re.useEffect(()=>{const w=()=>{g(window.scrollY>2)};return window.addEventListener("scroll",w),()=>window.removeEventListener("scroll",w)},[]),W.jsxs("div",{children:[W.jsx("header",{className:`fixed top-0 left-0 w-full z-50 px-6 py-4 md:px-12 transition-all duration-500 ease-in-out ${f?"bg-gradient-to-br from-[#FF6600] to-[#FF3C28] shadow-md":"bg-transparent backdrop-blur-md"}`,children:W.jsxs("div",{className:"flex justify-between items-center",children:[W.jsx(lc,{to:"/",children:W.jsx("h1",{className:"text-3xl font-bold drop-shadow text-white",children:"🍔 FoodYah"})}),W.jsx("nav",{className:"flex gap-2 sm:gap-4"})]})}),W.jsxs("div",{className:"font-sans",children:[W.jsx(pP,{}),W.jsx(MP,{}),W.jsx(OP,{}),W.jsx(zP,{}),W.jsx(kP,{})]})]})}const FP="/api/restaurant/getRestaurantData",BP=()=>{const f=gu(),[g,w]=Re.useState([]),[S,A]=Re.useState(""),[L,N]=Re.useState(1),[r,F]=Re.useState(1),B=async()=>{const $=await fetch(`${FP}?search=${S}&page=${L}&limit=10`),{data:ie,totalPages:re}=await $.json();w(ie),F(re)};return Re.useEffect(()=>{B()},[S,L]),console.log(g),W.jsxs("div",{className:"p-6 space-y-6",children:[W.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Restaurant List"}),W.jsx("input",{type:"text",placeholder:"Search by name or location...",className:"w-full md:w-1/3 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:S,onChange:$=>{A($.target.value),N(1)}}),W.jsx("div",{className:"overflow-x-auto shadow rounded-lg border border-gray-200",children:W.jsxs("table",{className:"min-w-full divide-y divide-gray-200 bg-white",children:[W.jsx("thead",{className:"bg-gray-100",children:W.jsxs("tr",{className:"text-center",children:[W.jsx("th",{className:"px-6 py-3  text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Name"}),W.jsx("th",{className:"px-6 py-3  text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Email"}),W.jsx("th",{className:"px-6 py-3  text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Phone No"}),W.jsx("th",{className:"px-6 py-3  text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Status"}),W.jsx("th",{className:"px-6 py-3 text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Action"})]})}),W.jsx("tbody",{className:"divide-y divide-gray-200",children:g.map($=>W.jsxs("tr",{className:"hover:bg-gray-50 transition duration-150 text-center",children:[W.jsx("td",{className:"px-6 py-4 text-sm text-gray-800",children:$.name}),W.jsx("td",{className:"px-6 py-4 text-sm text-gray-800",children:$.email}),W.jsx("td",{className:"px-6 py-4 text-sm text-gray-800",children:$.phone}),W.jsx("td",{className:`px-6 py-4 text-sm text-gray-800 ${$.status==="pending"?"bg-yellow-300":$.status==="active"?"bg-green-300":$.status==="suspended"?"bg-orange-300":$.status==="rejected"?"bg-red-300":""}`,children:$.status}),W.jsx("td",{className:"px-6 py-4",children:W.jsx("button",{onClick:()=>f(`/admin/verify/${$._id}`,{state:{restaurant:$}}),className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition cursor-pointer",children:"Verify"})})]},$._id))})]})}),W.jsxs("div",{className:"flex justify-center items-center gap-2",children:[W.jsx("button",{onClick:()=>N($=>$-1),disabled:L===1,className:"px-3 py-1 text-sm border border-gray-300 rounded-md disabled:opacity-50 hover:bg-gray-100",children:"Prev"}),[...Array(r)].map(($,ie)=>W.jsx("button",{onClick:()=>N(ie+1),className:`px-3 py-1 text-sm border rounded-md ${L===ie+1?"bg-blue-500 text-white border-blue-500":"border-gray-300 hover:bg-gray-100"}`,children:ie+1},ie)),W.jsx("button",{onClick:()=>N($=>$+1),disabled:L===r,className:"px-3 py-1 text-sm border border-gray-300 rounded-md disabled:opacity-50 hover:bg-gray-100",children:"Next"})]})]})},vm=({children:f,allowedRoles:g})=>{const w=localStorage.getItem("token"),S=localStorage.getItem("role");return!w||!g.includes(S)?W.jsx(MD,{to:"/login",replace:!0}):f};function jP(){const[f,g]=Re.useState(!1);return Re.useEffect(()=>{const w=()=>{g(window.scrollY>2)};return window.addEventListener("scroll",w),()=>window.removeEventListener("scroll",w)},[]),W.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#FF6600] to-[#FF3C28] text-white font-sans",children:[W.jsx("header",{className:`fixed top-0 left-0 w-full z-50 px-6 py-4 md:px-12 transition-all duration-500 ease-in-out ${f?"bg-gradient-to-br from-[#FF6600] to-[#FF3C28] shadow-md":"bg-transparent backdrop-blur-md"}`,children:W.jsxs("div",{className:"flex justify-between items-center",children:[W.jsx(lc,{to:"/",children:W.jsx("h1",{className:"text-3xl font-bold drop-shadow text-white",children:"🍔 FoodYah"})}),W.jsxs("nav",{className:"flex gap-2 sm:gap-4",children:[W.jsx(lc,{to:"/restaurant-partner",children:W.jsx("button",{className:"px-3 sm:px-4 py-2 bg-white text-orange-600 font-semibold rounded hover:bg-orange-100 transition cursor-pointer",children:"Restaurant Partner Login"})}),W.jsx(lc,{to:"/user-login",children:W.jsx("button",{className:"px-3 sm:px-4 py-2 bg-white text-orange-600 font-semibold rounded hover:bg-orange-100 transition cursor-pointer",children:"Order Now"})})]})]})}),W.jsxs("section",{className:"flex flex-col md:flex-row items-center justify-between px-6 md:px-20 py-16 gap-10 pt-28",children:[W.jsxs("div",{className:"max-w-xl",children:[W.jsx("h2",{className:"text-4xl md:text-5xl font-extrabold mb-6 drop-shadow-lg",children:"Fast & Fresh Food Delivered to Your Doorstep"}),W.jsx("p",{className:"text-lg text-orange-100 mb-6",children:"Enjoy delicious meals from top-rated restaurants delivered hot and quick. Convenience and quality at your fingertips!"}),W.jsx(lc,{to:"/explore-foods",children:W.jsx("button",{className:"px-6 py-3 bg-yellow-400 text-orange-900 rounded-full text-lg font-semibold hover:bg-yellow-500 transition cursor-pointer",children:"Explore Restaurants 🍽️"})})]}),W.jsx("img",{src:"https://media.istockphoto.com/id/1442417585/photo/person-getting-a-piece-of-cheesy-pepperoni-pizza.jpg?s=612x612&w=0&k=20&c=k60TjxKIOIxJpd4F4yLMVjsniB4W1BpEV4Mi_nb4uJU=",alt:"Food Delivery",className:"w-full max-w-md rounded-2xl shadow-2xl"})]}),W.jsxs("section",{className:"bg-white text-orange-900 py-12 px-6 md:px-20",children:[W.jsx("h3",{className:"text-3xl font-bold mb-6 text-center",children:"Why Choose FoodYah?"}),W.jsx("p",{className:"text-center max-w-2xl mx-auto text-lg",children:"FoodYah is more than just a food delivery service. We bring joy to your table with fast delivery, high-quality meals, and a seamless ordering experience."})]}),W.jsx("section",{className:"py-14 px-6 md:px-20 bg-orange-100 text-orange-900",children:W.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 text-center",children:[W.jsxs("div",{children:[W.jsx("h4",{className:"text-xl font-semibold mb-2",children:"🍛 Variety of Cuisines"}),W.jsx("p",{children:"Explore dishes from Indian, Chinese, Italian, and more top-rated restaurants near you."})]}),W.jsxs("div",{children:[W.jsx("h4",{className:"text-xl font-semibold mb-2",children:"⚡ Lightning Fast Delivery"}),W.jsx("p",{children:"Our delivery partners make sure your food reaches you hot and fresh every single time."})]}),W.jsxs("div",{children:[W.jsx("h4",{className:"text-xl font-semibold mb-2",children:"📱 Easy to Use App"}),W.jsx("p",{children:"Order, track, and pay in just a few taps with our user-friendly mobile app."})]})]})}),W.jsxs("section",{className:"py-14 px-6 md:px-20 bg-white text-orange-900",children:[W.jsx("h3",{className:"text-3xl font-bold mb-10 text-center",children:"What Our Customers Say"}),W.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[W.jsxs("div",{className:"bg-orange-50 p-6 rounded shadow text-center",children:[W.jsx("p",{className:"italic",children:"“I love FoodYah! The food is always fresh and arrives on time. Highly recommended!”"}),W.jsx("h5",{className:"font-bold mt-4",children:"- Anjali R."})]}),W.jsxs("div",{className:"bg-orange-50 p-6 rounded shadow text-center",children:[W.jsx("p",{className:"italic",children:"“The best delivery app I’ve used. Great restaurant options and smooth interface.”"}),W.jsx("h5",{className:"font-bold mt-4",children:"- Rajiv M."})]}),W.jsxs("div",{className:"bg-orange-50 p-6 rounded shadow text-center",children:[W.jsx("p",{className:"italic",children:"“Reliable service and great discounts. FoodYah has made my life easier.”"}),W.jsx("h5",{className:"font-bold mt-4",children:"- Sneha K."})]})]})]}),W.jsx("footer",{className:"bg-orange-900 text-white py-6 px-6 md:px-20",children:W.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center text-sm gap-4",children:[W.jsxs("p",{children:["© ",new Date().getFullYear()," FoodYah. All rights reserved."]}),W.jsxs("div",{className:"flex gap-4",children:[W.jsx("a",{href:"#",className:"hover:underline",children:"Privacy Policy"}),W.jsx("a",{href:"#",className:"hover:underline",children:"Terms of Service"}),W.jsx("a",{href:"#",className:"hover:underline",children:"Contact"})]})]})})]})}function Mm(f){"@babel/helpers - typeof";return Mm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},Mm(f)}function VP(f,g){if(Mm(f)!="object"||!f)return f;var w=f[Symbol.toPrimitive];if(w!==void 0){var S=w.call(f,g);if(Mm(S)!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(f)}function jE(f){var g=VP(f,"string");return Mm(g)=="symbol"?g:g+""}function H_(f,g,w){return(g=jE(g))in f?Object.defineProperty(f,g,{value:w,enumerable:!0,configurable:!0,writable:!0}):f[g]=w,f}function AS(f,g){var w=Object.keys(f);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(f);g&&(S=S.filter(function(A){return Object.getOwnPropertyDescriptor(f,A).enumerable})),w.push.apply(w,S)}return w}function jn(f){for(var g=1;g<arguments.length;g++){var w=arguments[g]!=null?arguments[g]:{};g%2?AS(Object(w),!0).forEach(function(S){H_(f,S,w[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(w)):AS(Object(w)).forEach(function(S){Object.defineProperty(f,S,Object.getOwnPropertyDescriptor(w,S))})}return f}function UP(f){if(Array.isArray(f))return f}function GP(f,g){var w=f==null?null:typeof Symbol<"u"&&f[Symbol.iterator]||f["@@iterator"];if(w!=null){var S,A,L,N,r=[],F=!0,B=!1;try{if(L=(w=w.call(f)).next,g===0){if(Object(w)!==w)return;F=!1}else for(;!(F=(S=L.call(w)).done)&&(r.push(S.value),r.length!==g);F=!0);}catch($){B=!0,A=$}finally{try{if(!F&&w.return!=null&&(N=w.return(),Object(N)!==N))return}finally{if(B)throw A}}return r}}function lb(f,g){(g==null||g>f.length)&&(g=f.length);for(var w=0,S=Array(g);w<g;w++)S[w]=f[w];return S}function VE(f,g){if(f){if(typeof f=="string")return lb(f,g);var w={}.toString.call(f).slice(8,-1);return w==="Object"&&f.constructor&&(w=f.constructor.name),w==="Map"||w==="Set"?Array.from(f):w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w)?lb(f,g):void 0}}function HP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sf(f,g){return UP(f)||GP(f,g)||VE(f,g)||HP()}function qP(f,g){if(f==null)return{};var w={};for(var S in f)if({}.hasOwnProperty.call(f,S)){if(g.indexOf(S)!==-1)continue;w[S]=f[S]}return w}function uf(f,g){if(f==null)return{};var w,S,A=qP(f,g);if(Object.getOwnPropertySymbols){var L=Object.getOwnPropertySymbols(f);for(S=0;S<L.length;S++)w=L[S],g.indexOf(w)===-1&&{}.propertyIsEnumerable.call(f,w)&&(A[w]=f[w])}return A}var $P=["defaultInputValue","defaultMenuIsOpen","defaultValue","inputValue","menuIsOpen","onChange","onInputChange","onMenuClose","onMenuOpen","value"];function ZP(f){var g=f.defaultInputValue,w=g===void 0?"":g,S=f.defaultMenuIsOpen,A=S===void 0?!1:S,L=f.defaultValue,N=L===void 0?null:L,r=f.inputValue,F=f.menuIsOpen,B=f.onChange,$=f.onInputChange,ie=f.onMenuClose,re=f.onMenuOpen,Te=f.value,_e=uf(f,$P),me=Re.useState(r!==void 0?r:w),ge=sf(me,2),pe=ge[0],fe=ge[1],se=Re.useState(F!==void 0?F:A),De=sf(se,2),we=De[0],ht=De[1],At=Re.useState(Te!==void 0?Te:N),gt=sf(At,2),Xe=gt[0],je=gt[1],$e=Re.useCallback(function(ii,Li){typeof B=="function"&&B(ii,Li),je(ii)},[B]),It=Re.useCallback(function(ii,Li){var Ve;typeof $=="function"&&(Ve=$(ii,Li)),fe(Ve!==void 0?Ve:ii)},[$]),Lt=Re.useCallback(function(){typeof re=="function"&&re(),ht(!0)},[re]),ct=Re.useCallback(function(){typeof ie=="function"&&ie(),ht(!1)},[ie]),Et=r!==void 0?r:pe,Qe=F!==void 0?F:we,kt=Te!==void 0?Te:Xe;return jn(jn({},_e),{},{inputValue:Et,menuIsOpen:Qe,onChange:$e,onInputChange:It,onMenuClose:ct,onMenuOpen:Lt,value:kt})}function Gn(){return Gn=Object.assign?Object.assign.bind():function(f){for(var g=1;g<arguments.length;g++){var w=arguments[g];for(var S in w)({}).hasOwnProperty.call(w,S)&&(f[S]=w[S])}return f},Gn.apply(null,arguments)}function WP(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")}function CS(f,g){for(var w=0;w<g.length;w++){var S=g[w];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(f,jE(S.key),S)}}function XP(f,g,w){return g&&CS(f.prototype,g),w&&CS(f,w),Object.defineProperty(f,"prototype",{writable:!1}),f}function cb(f,g){return cb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(w,S){return w.__proto__=S,w},cb(f,g)}function YP(f,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(g&&g.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),Object.defineProperty(f,"prototype",{writable:!1}),g&&cb(f,g)}function Yv(f){return Yv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},Yv(f)}function UE(){try{var f=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(UE=function(){return!!f})()}function KP(f){if(f===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f}function QP(f,g){if(g&&(Mm(g)=="object"||typeof g=="function"))return g;if(g!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return KP(f)}function JP(f){var g=UE();return function(){var w,S=Yv(f);if(g){var A=Yv(this).constructor;w=Reflect.construct(S,arguments,A)}else w=S.apply(this,arguments);return QP(this,w)}}function eO(f){if(Array.isArray(f))return lb(f)}function tO(f){if(typeof Symbol<"u"&&f[Symbol.iterator]!=null||f["@@iterator"]!=null)return Array.from(f)}function iO(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wb(f){return eO(f)||tO(f)||VE(f)||iO()}function nO(f){if(f.sheet)return f.sheet;for(var g=0;g<document.styleSheets.length;g++)if(document.styleSheets[g].ownerNode===f)return document.styleSheets[g]}function rO(f){var g=document.createElement("style");return g.setAttribute("data-emotion",f.key),f.nonce!==void 0&&g.setAttribute("nonce",f.nonce),g.appendChild(document.createTextNode("")),g.setAttribute("data-s",""),g}var sO=function(){function f(w){var S=this;this._insertTag=function(A){var L;S.tags.length===0?S.insertionPoint?L=S.insertionPoint.nextSibling:S.prepend?L=S.container.firstChild:L=S.before:L=S.tags[S.tags.length-1].nextSibling,S.container.insertBefore(A,L),S.tags.push(A)},this.isSpeedy=w.speedy===void 0?!0:w.speedy,this.tags=[],this.ctr=0,this.nonce=w.nonce,this.key=w.key,this.container=w.container,this.prepend=w.prepend,this.insertionPoint=w.insertionPoint,this.before=null}var g=f.prototype;return g.hydrate=function(S){S.forEach(this._insertTag)},g.insert=function(S){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(rO(this));var A=this.tags[this.tags.length-1];if(this.isSpeedy){var L=nO(A);try{L.insertRule(S,L.cssRules.length)}catch{}}else A.appendChild(document.createTextNode(S));this.ctr++},g.flush=function(){this.tags.forEach(function(S){var A;return(A=S.parentNode)==null?void 0:A.removeChild(S)}),this.tags=[],this.ctr=0},f}(),cl="-ms-",Kv="-moz-",cs="-webkit-",GE="comm",Xb="rule",Yb="decl",aO="@import",HE="@keyframes",oO="@layer",lO=Math.abs,h0=String.fromCharCode,cO=Object.assign;function uO(f,g){return ko(f,0)^45?(((g<<2^ko(f,0))<<2^ko(f,1))<<2^ko(f,2))<<2^ko(f,3):0}function qE(f){return f.trim()}function hO(f,g){return(f=g.exec(f))?f[0]:f}function us(f,g,w){return f.replace(g,w)}function ub(f,g){return f.indexOf(g)}function ko(f,g){return f.charCodeAt(g)|0}function Q_(f,g,w){return f.slice(g,w)}function Yh(f){return f.length}function Kb(f){return f.length}function Cv(f,g){return g.push(f),f}function dO(f,g){return f.map(g).join("")}var d0=1,Ig=1,$E=0,uc=0,Qa=0,zg="";function f0(f,g,w,S,A,L,N){return{value:f,root:g,parent:w,type:S,props:A,children:L,line:d0,column:Ig,length:N,return:""}}function j_(f,g){return cO(f0("",null,null,"",null,null,0),f,{length:-f.length},g)}function fO(){return Qa}function pO(){return Qa=uc>0?ko(zg,--uc):0,Ig--,Qa===10&&(Ig=1,d0--),Qa}function kc(){return Qa=uc<$E?ko(zg,uc++):0,Ig++,Qa===10&&(Ig=1,d0++),Qa}function Qh(){return ko(zg,uc)}function Fv(){return uc}function uy(f,g){return Q_(zg,f,g)}function J_(f){switch(f){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function ZE(f){return d0=Ig=1,$E=Yh(zg=f),uc=0,[]}function WE(f){return zg="",f}function Bv(f){return qE(uy(uc-1,hb(f===91?f+2:f===40?f+1:f)))}function mO(f){for(;(Qa=Qh())&&Qa<33;)kc();return J_(f)>2||J_(Qa)>3?"":" "}function gO(f,g){for(;--g&&kc()&&!(Qa<48||Qa>102||Qa>57&&Qa<65||Qa>70&&Qa<97););return uy(f,Fv()+(g<6&&Qh()==32&&kc()==32))}function hb(f){for(;kc();)switch(Qa){case f:return uc;case 34:case 39:f!==34&&f!==39&&hb(Qa);break;case 40:f===41&&hb(f);break;case 92:kc();break}return uc}function _O(f,g){for(;kc()&&f+Qa!==57;)if(f+Qa===84&&Qh()===47)break;return"/*"+uy(g,uc-1)+"*"+h0(f===47?f:kc())}function yO(f){for(;!J_(Qh());)kc();return uy(f,uc)}function vO(f){return WE(jv("",null,null,null,[""],f=ZE(f),0,[0],f))}function jv(f,g,w,S,A,L,N,r,F){for(var B=0,$=0,ie=N,re=0,Te=0,_e=0,me=1,ge=1,pe=1,fe=0,se="",De=A,we=L,ht=S,At=se;ge;)switch(_e=fe,fe=kc()){case 40:if(_e!=108&&ko(At,ie-1)==58){ub(At+=us(Bv(fe),"&","&\f"),"&\f")!=-1&&(pe=-1);break}case 34:case 39:case 91:At+=Bv(fe);break;case 9:case 10:case 13:case 32:At+=mO(_e);break;case 92:At+=gO(Fv()-1,7);continue;case 47:switch(Qh()){case 42:case 47:Cv(xO(_O(kc(),Fv()),g,w),F);break;default:At+="/"}break;case 123*me:r[B++]=Yh(At)*pe;case 125*me:case 59:case 0:switch(fe){case 0:case 125:ge=0;case 59+$:pe==-1&&(At=us(At,/\f/g,"")),Te>0&&Yh(At)-ie&&Cv(Te>32?IS(At+";",S,w,ie-1):IS(us(At," ","")+";",S,w,ie-2),F);break;case 59:At+=";";default:if(Cv(ht=MS(At,g,w,B,$,A,r,se,De=[],we=[],ie),L),fe===123)if($===0)jv(At,g,ht,ht,De,L,ie,r,we);else switch(re===99&&ko(At,3)===110?100:re){case 100:case 108:case 109:case 115:jv(f,ht,ht,S&&Cv(MS(f,ht,ht,0,0,A,r,se,A,De=[],ie),we),A,we,ie,r,S?De:we);break;default:jv(At,ht,ht,ht,[""],we,0,r,we)}}B=$=Te=0,me=pe=1,se=At="",ie=N;break;case 58:ie=1+Yh(At),Te=_e;default:if(me<1){if(fe==123)--me;else if(fe==125&&me++==0&&pO()==125)continue}switch(At+=h0(fe),fe*me){case 38:pe=$>0?1:(At+="\f",-1);break;case 44:r[B++]=(Yh(At)-1)*pe,pe=1;break;case 64:Qh()===45&&(At+=Bv(kc())),re=Qh(),$=ie=Yh(se=At+=yO(Fv())),fe++;break;case 45:_e===45&&Yh(At)==2&&(me=0)}}return L}function MS(f,g,w,S,A,L,N,r,F,B,$){for(var ie=A-1,re=A===0?L:[""],Te=Kb(re),_e=0,me=0,ge=0;_e<S;++_e)for(var pe=0,fe=Q_(f,ie+1,ie=lO(me=N[_e])),se=f;pe<Te;++pe)(se=qE(me>0?re[pe]+" "+fe:us(fe,/&\f/g,re[pe])))&&(F[ge++]=se);return f0(f,g,w,A===0?Xb:r,F,B,$)}function xO(f,g,w){return f0(f,g,w,GE,h0(fO()),Q_(f,2,-2),0)}function IS(f,g,w,S){return f0(f,g,w,Yb,Q_(f,0,S),Q_(f,S+1,-1),S)}function Cg(f,g){for(var w="",S=Kb(f),A=0;A<S;A++)w+=g(f[A],A,f,g)||"";return w}function bO(f,g,w,S){switch(f.type){case oO:if(f.children.length)break;case aO:case Yb:return f.return=f.return||f.value;case GE:return"";case HE:return f.return=f.value+"{"+Cg(f.children,S)+"}";case Xb:f.value=f.props.join(",")}return Yh(w=Cg(f.children,S))?f.return=f.value+"{"+w+"}":""}function wO(f){var g=Kb(f);return function(w,S,A,L){for(var N="",r=0;r<g;r++)N+=f[r](w,S,A,L)||"";return N}}function TO(f){return function(g){g.root||(g=g.return)&&f(g)}}function SO(f){var g=Object.create(null);return function(w){return g[w]===void 0&&(g[w]=f(w)),g[w]}}var EO=function(g,w,S){for(var A=0,L=0;A=L,L=Qh(),A===38&&L===12&&(w[S]=1),!J_(L);)kc();return uy(g,uc)},AO=function(g,w){var S=-1,A=44;do switch(J_(A)){case 0:A===38&&Qh()===12&&(w[S]=1),g[S]+=EO(uc-1,w,S);break;case 2:g[S]+=Bv(A);break;case 4:if(A===44){g[++S]=Qh()===58?"&\f":"",w[S]=g[S].length;break}default:g[S]+=h0(A)}while(A=kc());return g},CO=function(g,w){return WE(AO(ZE(g),w))},RS=new WeakMap,MO=function(g){if(!(g.type!=="rule"||!g.parent||g.length<1)){for(var w=g.value,S=g.parent,A=g.column===S.column&&g.line===S.line;S.type!=="rule";)if(S=S.parent,!S)return;if(!(g.props.length===1&&w.charCodeAt(0)!==58&&!RS.get(S))&&!A){RS.set(g,!0);for(var L=[],N=CO(w,L),r=S.props,F=0,B=0;F<N.length;F++)for(var $=0;$<r.length;$++,B++)g.props[B]=L[F]?N[F].replace(/&\f/g,r[$]):r[$]+" "+N[F]}}},IO=function(g){if(g.type==="decl"){var w=g.value;w.charCodeAt(0)===108&&w.charCodeAt(2)===98&&(g.return="",g.value="")}};function XE(f,g){switch(uO(f,g)){case 5103:return cs+"print-"+f+f;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return cs+f+f;case 5349:case 4246:case 4810:case 6968:case 2756:return cs+f+Kv+f+cl+f+f;case 6828:case 4268:return cs+f+cl+f+f;case 6165:return cs+f+cl+"flex-"+f+f;case 5187:return cs+f+us(f,/(\w+).+(:[^]+)/,cs+"box-$1$2"+cl+"flex-$1$2")+f;case 5443:return cs+f+cl+"flex-item-"+us(f,/flex-|-self/,"")+f;case 4675:return cs+f+cl+"flex-line-pack"+us(f,/align-content|flex-|-self/,"")+f;case 5548:return cs+f+cl+us(f,"shrink","negative")+f;case 5292:return cs+f+cl+us(f,"basis","preferred-size")+f;case 6060:return cs+"box-"+us(f,"-grow","")+cs+f+cl+us(f,"grow","positive")+f;case 4554:return cs+us(f,/([^-])(transform)/g,"$1"+cs+"$2")+f;case 6187:return us(us(us(f,/(zoom-|grab)/,cs+"$1"),/(image-set)/,cs+"$1"),f,"")+f;case 5495:case 3959:return us(f,/(image-set\([^]*)/,cs+"$1$`$1");case 4968:return us(us(f,/(.+:)(flex-)?(.*)/,cs+"box-pack:$3"+cl+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+cs+f+f;case 4095:case 3583:case 4068:case 2532:return us(f,/(.+)-inline(.+)/,cs+"$1$2")+f;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Yh(f)-1-g>6)switch(ko(f,g+1)){case 109:if(ko(f,g+4)!==45)break;case 102:return us(f,/(.+:)(.+)-([^]+)/,"$1"+cs+"$2-$3$1"+Kv+(ko(f,g+3)==108?"$3":"$2-$3"))+f;case 115:return~ub(f,"stretch")?XE(us(f,"stretch","fill-available"),g)+f:f}break;case 4949:if(ko(f,g+1)!==115)break;case 6444:switch(ko(f,Yh(f)-3-(~ub(f,"!important")&&10))){case 107:return us(f,":",":"+cs)+f;case 101:return us(f,/(.+:)([^;!]+)(;|!.+)?/,"$1"+cs+(ko(f,14)===45?"inline-":"")+"box$3$1"+cs+"$2$3$1"+cl+"$2box$3")+f}break;case 5936:switch(ko(f,g+11)){case 114:return cs+f+cl+us(f,/[svh]\w+-[tblr]{2}/,"tb")+f;case 108:return cs+f+cl+us(f,/[svh]\w+-[tblr]{2}/,"tb-rl")+f;case 45:return cs+f+cl+us(f,/[svh]\w+-[tblr]{2}/,"lr")+f}return cs+f+cl+f+f}return f}var RO=function(g,w,S,A){if(g.length>-1&&!g.return)switch(g.type){case Yb:g.return=XE(g.value,g.length);break;case HE:return Cg([j_(g,{value:us(g.value,"@","@"+cs)})],A);case Xb:if(g.length)return dO(g.props,function(L){switch(hO(L,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Cg([j_(g,{props:[us(L,/:(read-\w+)/,":"+Kv+"$1")]})],A);case"::placeholder":return Cg([j_(g,{props:[us(L,/:(plac\w+)/,":"+cs+"input-$1")]}),j_(g,{props:[us(L,/:(plac\w+)/,":"+Kv+"$1")]}),j_(g,{props:[us(L,/:(plac\w+)/,cl+"input-$1")]})],A)}return""})}},DO=[RO],PO=function(g){var w=g.key;if(w==="css"){var S=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(S,function(me){var ge=me.getAttribute("data-emotion");ge.indexOf(" ")!==-1&&(document.head.appendChild(me),me.setAttribute("data-s",""))})}var A=g.stylisPlugins||DO,L={},N,r=[];N=g.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+w+' "]'),function(me){for(var ge=me.getAttribute("data-emotion").split(" "),pe=1;pe<ge.length;pe++)L[ge[pe]]=!0;r.push(me)});var F,B=[MO,IO];{var $,ie=[bO,TO(function(me){$.insert(me)})],re=wO(B.concat(A,ie)),Te=function(ge){return Cg(vO(ge),re)};F=function(ge,pe,fe,se){$=fe,Te(ge?ge+"{"+pe.styles+"}":pe.styles),se&&(_e.inserted[pe.name]=!0)}}var _e={key:w,sheet:new sO({key:w,container:N,nonce:g.nonce,speedy:g.speedy,prepend:g.prepend,insertionPoint:g.insertionPoint}),nonce:g.nonce,inserted:L,registered:{},insert:F};return _e.sheet.hydrate(r),_e},Px={exports:{}},ms={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DS;function OO(){if(DS)return ms;DS=1;var f=typeof Symbol=="function"&&Symbol.for,g=f?Symbol.for("react.element"):60103,w=f?Symbol.for("react.portal"):60106,S=f?Symbol.for("react.fragment"):60107,A=f?Symbol.for("react.strict_mode"):60108,L=f?Symbol.for("react.profiler"):60114,N=f?Symbol.for("react.provider"):60109,r=f?Symbol.for("react.context"):60110,F=f?Symbol.for("react.async_mode"):60111,B=f?Symbol.for("react.concurrent_mode"):60111,$=f?Symbol.for("react.forward_ref"):60112,ie=f?Symbol.for("react.suspense"):60113,re=f?Symbol.for("react.suspense_list"):60120,Te=f?Symbol.for("react.memo"):60115,_e=f?Symbol.for("react.lazy"):60116,me=f?Symbol.for("react.block"):60121,ge=f?Symbol.for("react.fundamental"):60117,pe=f?Symbol.for("react.responder"):60118,fe=f?Symbol.for("react.scope"):60119;function se(we){if(typeof we=="object"&&we!==null){var ht=we.$$typeof;switch(ht){case g:switch(we=we.type,we){case F:case B:case S:case L:case A:case ie:return we;default:switch(we=we&&we.$$typeof,we){case r:case $:case _e:case Te:case N:return we;default:return ht}}case w:return ht}}}function De(we){return se(we)===B}return ms.AsyncMode=F,ms.ConcurrentMode=B,ms.ContextConsumer=r,ms.ContextProvider=N,ms.Element=g,ms.ForwardRef=$,ms.Fragment=S,ms.Lazy=_e,ms.Memo=Te,ms.Portal=w,ms.Profiler=L,ms.StrictMode=A,ms.Suspense=ie,ms.isAsyncMode=function(we){return De(we)||se(we)===F},ms.isConcurrentMode=De,ms.isContextConsumer=function(we){return se(we)===r},ms.isContextProvider=function(we){return se(we)===N},ms.isElement=function(we){return typeof we=="object"&&we!==null&&we.$$typeof===g},ms.isForwardRef=function(we){return se(we)===$},ms.isFragment=function(we){return se(we)===S},ms.isLazy=function(we){return se(we)===_e},ms.isMemo=function(we){return se(we)===Te},ms.isPortal=function(we){return se(we)===w},ms.isProfiler=function(we){return se(we)===L},ms.isStrictMode=function(we){return se(we)===A},ms.isSuspense=function(we){return se(we)===ie},ms.isValidElementType=function(we){return typeof we=="string"||typeof we=="function"||we===S||we===B||we===L||we===A||we===ie||we===re||typeof we=="object"&&we!==null&&(we.$$typeof===_e||we.$$typeof===Te||we.$$typeof===N||we.$$typeof===r||we.$$typeof===$||we.$$typeof===ge||we.$$typeof===pe||we.$$typeof===fe||we.$$typeof===me)},ms.typeOf=se,ms}var PS;function LO(){return PS||(PS=1,Px.exports=OO()),Px.exports}var Ox,OS;function zO(){if(OS)return Ox;OS=1;var f=LO(),g={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},w={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},S={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},A={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},L={};L[f.ForwardRef]=S,L[f.Memo]=A;function N(_e){return f.isMemo(_e)?A:L[_e.$$typeof]||g}var r=Object.defineProperty,F=Object.getOwnPropertyNames,B=Object.getOwnPropertySymbols,$=Object.getOwnPropertyDescriptor,ie=Object.getPrototypeOf,re=Object.prototype;function Te(_e,me,ge){if(typeof me!="string"){if(re){var pe=ie(me);pe&&pe!==re&&Te(_e,pe,ge)}var fe=F(me);B&&(fe=fe.concat(B(me)));for(var se=N(_e),De=N(me),we=0;we<fe.length;++we){var ht=fe[we];if(!w[ht]&&!(ge&&ge[ht])&&!(De&&De[ht])&&!(se&&se[ht])){var At=$(me,ht);try{r(_e,ht,At)}catch{}}}}return _e}return Ox=Te,Ox}zO();var kO=!0;function NO(f,g,w){var S="";return w.split(" ").forEach(function(A){f[A]!==void 0?g.push(f[A]+";"):A&&(S+=A+" ")}),S}var YE=function(g,w,S){var A=g.key+"-"+w.name;(S===!1||kO===!1)&&g.registered[A]===void 0&&(g.registered[A]=w.styles)},FO=function(g,w,S){YE(g,w,S);var A=g.key+"-"+w.name;if(g.inserted[w.name]===void 0){var L=w;do g.insert(w===L?"."+A:"",L,g.sheet,!0),L=L.next;while(L!==void 0)}};function BO(f){for(var g=0,w,S=0,A=f.length;A>=4;++S,A-=4)w=f.charCodeAt(S)&255|(f.charCodeAt(++S)&255)<<8|(f.charCodeAt(++S)&255)<<16|(f.charCodeAt(++S)&255)<<24,w=(w&65535)*1540483477+((w>>>16)*59797<<16),w^=w>>>24,g=(w&65535)*1540483477+((w>>>16)*59797<<16)^(g&65535)*1540483477+((g>>>16)*59797<<16);switch(A){case 3:g^=(f.charCodeAt(S+2)&255)<<16;case 2:g^=(f.charCodeAt(S+1)&255)<<8;case 1:g^=f.charCodeAt(S)&255,g=(g&65535)*1540483477+((g>>>16)*59797<<16)}return g^=g>>>13,g=(g&65535)*1540483477+((g>>>16)*59797<<16),((g^g>>>15)>>>0).toString(36)}var jO={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},VO=/[A-Z]|^ms/g,UO=/_EMO_([^_]+?)_([^]*?)_EMO_/g,KE=function(g){return g.charCodeAt(1)===45},LS=function(g){return g!=null&&typeof g!="boolean"},Lx=SO(function(f){return KE(f)?f:f.replace(VO,"-$&").toLowerCase()}),zS=function(g,w){switch(g){case"animation":case"animationName":if(typeof w=="string")return w.replace(UO,function(S,A,L){return Kh={name:A,styles:L,next:Kh},A})}return jO[g]!==1&&!KE(g)&&typeof w=="number"&&w!==0?w+"px":w};function ey(f,g,w){if(w==null)return"";var S=w;if(S.__emotion_styles!==void 0)return S;switch(typeof w){case"boolean":return"";case"object":{var A=w;if(A.anim===1)return Kh={name:A.name,styles:A.styles,next:Kh},A.name;var L=w;if(L.styles!==void 0){var N=L.next;if(N!==void 0)for(;N!==void 0;)Kh={name:N.name,styles:N.styles,next:Kh},N=N.next;var r=L.styles+";";return r}return GO(f,g,w)}case"function":{if(f!==void 0){var F=Kh,B=w(f);return Kh=F,ey(f,g,B)}break}}var $=w;return $}function GO(f,g,w){var S="";if(Array.isArray(w))for(var A=0;A<w.length;A++)S+=ey(f,g,w[A])+";";else for(var L in w){var N=w[L];if(typeof N!="object"){var r=N;LS(r)&&(S+=Lx(L)+":"+zS(L,r)+";")}else if(Array.isArray(N)&&typeof N[0]=="string"&&g==null)for(var F=0;F<N.length;F++)LS(N[F])&&(S+=Lx(L)+":"+zS(L,N[F])+";");else{var B=ey(f,g,N);switch(L){case"animation":case"animationName":{S+=Lx(L)+":"+B+";";break}default:S+=L+"{"+B+"}"}}}return S}var kS=/label:\s*([^\s;{]+)\s*(;|$)/g,Kh;function QE(f,g,w){if(f.length===1&&typeof f[0]=="object"&&f[0]!==null&&f[0].styles!==void 0)return f[0];var S=!0,A="";Kh=void 0;var L=f[0];if(L==null||L.raw===void 0)S=!1,A+=ey(w,g,L);else{var N=L;A+=N[0]}for(var r=1;r<f.length;r++)if(A+=ey(w,g,f[r]),S){var F=L;A+=F[r]}kS.lastIndex=0;for(var B="",$;($=kS.exec(A))!==null;)B+="-"+$[1];var ie=BO(A)+B;return{name:ie,styles:A,next:Kh}}var HO=function(g){return g()},qO=dS.useInsertionEffect?dS.useInsertionEffect:!1,$O=qO||HO,JE=Re.createContext(typeof HTMLElement<"u"?PO({key:"css"}):null);JE.Provider;var ZO=function(g){return Re.forwardRef(function(w,S){var A=Re.useContext(JE);return g(w,A,S)})},WO=Re.createContext({}),Qb={}.hasOwnProperty,db="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",XO=function(g,w){var S={};for(var A in w)Qb.call(w,A)&&(S[A]=w[A]);return S[db]=g,S},YO=function(g){var w=g.cache,S=g.serialized,A=g.isStringTag;return YE(w,S,A),$O(function(){return FO(w,S,A)}),null},KO=ZO(function(f,g,w){var S=f.css;typeof S=="string"&&g.registered[S]!==void 0&&(S=g.registered[S]);var A=f[db],L=[S],N="";typeof f.className=="string"?N=NO(g.registered,L,f.className):f.className!=null&&(N=f.className+" ");var r=QE(L,void 0,Re.useContext(WO));N+=g.key+"-"+r.name;var F={};for(var B in f)Qb.call(f,B)&&B!=="css"&&B!==db&&(F[B]=f[B]);return F.className=N,w&&(F.ref=w),Re.createElement(Re.Fragment,null,Re.createElement(YO,{cache:g,serialized:r,isStringTag:typeof A=="string"}),Re.createElement(A,F))}),QO=KO,Pn=function(g,w){var S=arguments;if(w==null||!Qb.call(w,"css"))return Re.createElement.apply(void 0,S);var A=S.length,L=new Array(A);L[0]=QO,L[1]=XO(g,w);for(var N=2;N<A;N++)L[N]=S[N];return Re.createElement.apply(null,L)};(function(f){var g;g||(g=f.JSX||(f.JSX={}))})(Pn||(Pn={}));function Jb(){for(var f=arguments.length,g=new Array(f),w=0;w<f;w++)g[w]=arguments[w];return QE(g)}function JO(){var f=Jb.apply(void 0,arguments),g="animation-"+f.name;return{name:g,styles:"@keyframes "+g+"{"+f.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}function eL(f,g){return g||(g=f.slice(0)),Object.freeze(Object.defineProperties(f,{raw:{value:Object.freeze(g)}}))}const tL=Math.min,iL=Math.max,Qv=Math.round,Mv=Math.floor,Jv=f=>({x:f,y:f});function nL(f){const{x:g,y:w,width:S,height:A}=f;return{width:S,height:A,top:w,left:g,right:g+S,bottom:w+A,x:g,y:w}}function p0(){return typeof window<"u"}function eA(f){return iA(f)?(f.nodeName||"").toLowerCase():"#document"}function of(f){var g;return(f==null||(g=f.ownerDocument)==null?void 0:g.defaultView)||window}function tA(f){var g;return(g=(iA(f)?f.ownerDocument:f.document)||window.document)==null?void 0:g.documentElement}function iA(f){return p0()?f instanceof Node||f instanceof of(f).Node:!1}function rL(f){return p0()?f instanceof Element||f instanceof of(f).Element:!1}function e1(f){return p0()?f instanceof HTMLElement||f instanceof of(f).HTMLElement:!1}function NS(f){return!p0()||typeof ShadowRoot>"u"?!1:f instanceof ShadowRoot||f instanceof of(f).ShadowRoot}const sL=new Set(["inline","contents"]);function nA(f){const{overflow:g,overflowX:w,overflowY:S,display:A}=t1(f);return/auto|scroll|overlay|hidden|clip/.test(g+S+w)&&!sL.has(A)}function aL(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const oL=new Set(["html","body","#document"]);function lL(f){return oL.has(eA(f))}function t1(f){return of(f).getComputedStyle(f)}function cL(f){if(eA(f)==="html")return f;const g=f.assignedSlot||f.parentNode||NS(f)&&f.host||tA(f);return NS(g)?g.host:g}function rA(f){const g=cL(f);return lL(g)?f.ownerDocument?f.ownerDocument.body:f.body:e1(g)&&nA(g)?g:rA(g)}function e0(f,g,w){var S;g===void 0&&(g=[]),w===void 0&&(w=!0);const A=rA(f),L=A===((S=f.ownerDocument)==null?void 0:S.body),N=of(A);if(L){const r=fb(N);return g.concat(N,N.visualViewport||[],nA(A)?A:[],r&&w?e0(r):[])}return g.concat(A,e0(A,[],w))}function fb(f){return f.parent&&Object.getPrototypeOf(f.parent)?f.frameElement:null}function uL(f){const g=t1(f);let w=parseFloat(g.width)||0,S=parseFloat(g.height)||0;const A=e1(f),L=A?f.offsetWidth:w,N=A?f.offsetHeight:S,r=Qv(w)!==L||Qv(S)!==N;return r&&(w=L,S=N),{width:w,height:S,$:r}}function i1(f){return rL(f)?f:f.contextElement}function FS(f){const g=i1(f);if(!e1(g))return Jv(1);const w=g.getBoundingClientRect(),{width:S,height:A,$:L}=uL(g);let N=(L?Qv(w.width):w.width)/S,r=(L?Qv(w.height):w.height)/A;return(!N||!Number.isFinite(N))&&(N=1),(!r||!Number.isFinite(r))&&(r=1),{x:N,y:r}}const hL=Jv(0);function dL(f){const g=of(f);return!aL()||!g.visualViewport?hL:{x:g.visualViewport.offsetLeft,y:g.visualViewport.offsetTop}}function fL(f,g,w){return!1}function BS(f,g,w,S){g===void 0&&(g=!1);const A=f.getBoundingClientRect(),L=i1(f);let N=Jv(1);g&&(N=FS(f));const r=fL()?dL(L):Jv(0);let F=(A.left+r.x)/N.x,B=(A.top+r.y)/N.y,$=A.width/N.x,ie=A.height/N.y;if(L){const re=of(L),Te=S;let _e=re,me=fb(_e);for(;me&&S&&Te!==_e;){const ge=FS(me),pe=me.getBoundingClientRect(),fe=t1(me),se=pe.left+(me.clientLeft+parseFloat(fe.paddingLeft))*ge.x,De=pe.top+(me.clientTop+parseFloat(fe.paddingTop))*ge.y;F*=ge.x,B*=ge.y,$*=ge.x,ie*=ge.y,F+=se,B+=De,_e=of(me),me=fb(_e)}}return nL({width:$,height:ie,x:F,y:B})}function sA(f,g){return f.x===g.x&&f.y===g.y&&f.width===g.width&&f.height===g.height}function pL(f,g){let w=null,S;const A=tA(f);function L(){var r;clearTimeout(S),(r=w)==null||r.disconnect(),w=null}function N(r,F){r===void 0&&(r=!1),F===void 0&&(F=1),L();const B=f.getBoundingClientRect(),{left:$,top:ie,width:re,height:Te}=B;if(r||g(),!re||!Te)return;const _e=Mv(ie),me=Mv(A.clientWidth-($+re)),ge=Mv(A.clientHeight-(ie+Te)),pe=Mv($),se={rootMargin:-_e+"px "+-me+"px "+-ge+"px "+-pe+"px",threshold:iL(0,tL(1,F))||1};let De=!0;function we(ht){const At=ht[0].intersectionRatio;if(At!==F){if(!De)return N();At?N(!1,At):S=setTimeout(()=>{N(!1,1e-7)},1e3)}At===1&&!sA(B,f.getBoundingClientRect())&&N(),De=!1}try{w=new IntersectionObserver(we,{...se,root:A.ownerDocument})}catch{w=new IntersectionObserver(we,se)}w.observe(f)}return N(!0),L}function mL(f,g,w,S){S===void 0&&(S={});const{ancestorScroll:A=!0,ancestorResize:L=!0,elementResize:N=typeof ResizeObserver=="function",layoutShift:r=typeof IntersectionObserver=="function",animationFrame:F=!1}=S,B=i1(f),$=A||L?[...B?e0(B):[],...e0(g)]:[];$.forEach(pe=>{A&&pe.addEventListener("scroll",w,{passive:!0}),L&&pe.addEventListener("resize",w)});const ie=B&&r?pL(B,w):null;let re=-1,Te=null;N&&(Te=new ResizeObserver(pe=>{let[fe]=pe;fe&&fe.target===B&&Te&&(Te.unobserve(g),cancelAnimationFrame(re),re=requestAnimationFrame(()=>{var se;(se=Te)==null||se.observe(g)})),w()}),B&&!F&&Te.observe(B),Te.observe(g));let _e,me=F?BS(f):null;F&&ge();function ge(){const pe=BS(f);me&&!sA(me,pe)&&w(),me=pe,_e=requestAnimationFrame(ge)}return w(),()=>{var pe;$.forEach(fe=>{A&&fe.removeEventListener("scroll",w),L&&fe.removeEventListener("resize",w)}),ie?.(),(pe=Te)==null||pe.disconnect(),Te=null,F&&cancelAnimationFrame(_e)}}var pb=Re.useLayoutEffect,gL=["className","clearValue","cx","getStyles","getClassNames","getValue","hasValue","isMulti","isRtl","options","selectOption","selectProps","setValue","theme"],t0=function(){};function _L(f,g){return g?g[0]==="-"?f+g:f+"__"+g:f}function yL(f,g){for(var w=arguments.length,S=new Array(w>2?w-2:0),A=2;A<w;A++)S[A-2]=arguments[A];var L=[].concat(S);if(g&&f)for(var N in g)g.hasOwnProperty(N)&&g[N]&&L.push("".concat(_L(f,N)));return L.filter(function(r){return r}).map(function(r){return String(r).trim()}).join(" ")}var jS=function(g){return CL(g)?g.filter(Boolean):Mm(g)==="object"&&g!==null?[g]:[]},aA=function(g){g.className,g.clearValue,g.cx,g.getStyles,g.getClassNames,g.getValue,g.hasValue,g.isMulti,g.isRtl,g.options,g.selectOption,g.selectProps,g.setValue,g.theme;var w=uf(g,gL);return jn({},w)},ga=function(g,w,S){var A=g.cx,L=g.getStyles,N=g.getClassNames,r=g.className;return{css:L(w,g),className:A(S??{},N(w,g),r)}};function m0(f){return[document.documentElement,document.body,window].indexOf(f)>-1}function vL(f){return m0(f)?window.innerHeight:f.clientHeight}function oA(f){return m0(f)?window.pageYOffset:f.scrollTop}function i0(f,g){if(m0(f)){window.scrollTo(0,g);return}f.scrollTop=g}function xL(f){var g=getComputedStyle(f),w=g.position==="absolute",S=/(auto|scroll)/;if(g.position==="fixed")return document.documentElement;for(var A=f;A=A.parentElement;)if(g=getComputedStyle(A),!(w&&g.position==="static")&&S.test(g.overflow+g.overflowY+g.overflowX))return A;return document.documentElement}function bL(f,g,w,S){return w*((f=f/S-1)*f*f+1)+g}function Iv(f,g){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:200,S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:t0,A=oA(f),L=g-A,N=10,r=0;function F(){r+=N;var B=bL(r,A,L,w);i0(f,B),r<w?window.requestAnimationFrame(F):S(f)}F()}function VS(f,g){var w=f.getBoundingClientRect(),S=g.getBoundingClientRect(),A=g.offsetHeight/3;S.bottom+A>w.bottom?i0(f,Math.min(g.offsetTop+g.clientHeight-f.offsetHeight+A,f.scrollHeight)):S.top-A<w.top&&i0(f,Math.max(g.offsetTop-A,0))}function wL(f){var g=f.getBoundingClientRect();return{bottom:g.bottom,height:g.height,left:g.left,right:g.right,top:g.top,width:g.width}}function US(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}function TL(){try{return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}catch{return!1}}var lA=!1,SL={get passive(){return lA=!0}},Rv=typeof window<"u"?window:{};Rv.addEventListener&&Rv.removeEventListener&&(Rv.addEventListener("p",t0,SL),Rv.removeEventListener("p",t0,!1));var EL=lA;function AL(f){return f!=null}function CL(f){return Array.isArray(f)}function Dv(f,g,w){return f?g:w}var ML=function(g){for(var w=arguments.length,S=new Array(w>1?w-1:0),A=1;A<w;A++)S[A-1]=arguments[A];var L=Object.entries(g).filter(function(N){var r=sf(N,1),F=r[0];return!S.includes(F)});return L.reduce(function(N,r){var F=sf(r,2),B=F[0],$=F[1];return N[B]=$,N},{})},IL=["children","innerProps"],RL=["children","innerProps"];function DL(f){var g=f.maxHeight,w=f.menuEl,S=f.minHeight,A=f.placement,L=f.shouldScroll,N=f.isFixedPosition,r=f.controlHeight,F=xL(w),B={placement:"bottom",maxHeight:g};if(!w||!w.offsetParent)return B;var $=F.getBoundingClientRect(),ie=$.height,re=w.getBoundingClientRect(),Te=re.bottom,_e=re.height,me=re.top,ge=w.offsetParent.getBoundingClientRect(),pe=ge.top,fe=N?window.innerHeight:vL(F),se=oA(F),De=parseInt(getComputedStyle(w).marginBottom,10),we=parseInt(getComputedStyle(w).marginTop,10),ht=pe-we,At=fe-me,gt=ht+se,Xe=ie-se-me,je=Te-fe+se+De,$e=se+me-we,It=160;switch(A){case"auto":case"bottom":if(At>=_e)return{placement:"bottom",maxHeight:g};if(Xe>=_e&&!N)return L&&Iv(F,je,It),{placement:"bottom",maxHeight:g};if(!N&&Xe>=S||N&&At>=S){L&&Iv(F,je,It);var Lt=N?At-De:Xe-De;return{placement:"bottom",maxHeight:Lt}}if(A==="auto"||N){var ct=g,Et=N?ht:gt;return Et>=S&&(ct=Math.min(Et-De-r,g)),{placement:"top",maxHeight:ct}}if(A==="bottom")return L&&i0(F,je),{placement:"bottom",maxHeight:g};break;case"top":if(ht>=_e)return{placement:"top",maxHeight:g};if(gt>=_e&&!N)return L&&Iv(F,$e,It),{placement:"top",maxHeight:g};if(!N&&gt>=S||N&&ht>=S){var Qe=g;return(!N&&gt>=S||N&&ht>=S)&&(Qe=N?ht-we:gt-we),L&&Iv(F,$e,It),{placement:"top",maxHeight:Qe}}return{placement:"bottom",maxHeight:g};default:throw new Error('Invalid placement provided "'.concat(A,'".'))}return B}function PL(f){var g={bottom:"top",top:"bottom"};return f?g[f]:"bottom"}var cA=function(g){return g==="auto"?"bottom":g},OL=function(g,w){var S,A=g.placement,L=g.theme,N=L.borderRadius,r=L.spacing,F=L.colors;return jn((S={label:"menu"},H_(S,PL(A),"100%"),H_(S,"position","absolute"),H_(S,"width","100%"),H_(S,"zIndex",1),S),w?{}:{backgroundColor:F.neutral0,borderRadius:N,boxShadow:"0 0 0 1px hsla(0, 0%, 0%, 0.1), 0 4px 11px hsla(0, 0%, 0%, 0.1)",marginBottom:r.menuGutter,marginTop:r.menuGutter})},uA=Re.createContext(null),LL=function(g){var w=g.children,S=g.minMenuHeight,A=g.maxMenuHeight,L=g.menuPlacement,N=g.menuPosition,r=g.menuShouldScrollIntoView,F=g.theme,B=Re.useContext(uA)||{},$=B.setPortalPlacement,ie=Re.useRef(null),re=Re.useState(A),Te=sf(re,2),_e=Te[0],me=Te[1],ge=Re.useState(null),pe=sf(ge,2),fe=pe[0],se=pe[1],De=F.spacing.controlHeight;return pb(function(){var we=ie.current;if(we){var ht=N==="fixed",At=r&&!ht,gt=DL({maxHeight:A,menuEl:we,minHeight:S,placement:L,shouldScroll:At,isFixedPosition:ht,controlHeight:De});me(gt.maxHeight),se(gt.placement),$?.(gt.placement)}},[A,L,N,r,S,$,De]),w({ref:ie,placerProps:jn(jn({},g),{},{placement:fe||cA(L),maxHeight:_e})})},zL=function(g){var w=g.children,S=g.innerRef,A=g.innerProps;return Pn("div",Gn({},ga(g,"menu",{menu:!0}),{ref:S},A),w)},kL=zL,NL=function(g,w){var S=g.maxHeight,A=g.theme.spacing.baseUnit;return jn({maxHeight:S,overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},w?{}:{paddingBottom:A,paddingTop:A})},FL=function(g){var w=g.children,S=g.innerProps,A=g.innerRef,L=g.isMulti;return Pn("div",Gn({},ga(g,"menuList",{"menu-list":!0,"menu-list--is-multi":L}),{ref:A},S),w)},hA=function(g,w){var S=g.theme,A=S.spacing.baseUnit,L=S.colors;return jn({textAlign:"center"},w?{}:{color:L.neutral40,padding:"".concat(A*2,"px ").concat(A*3,"px")})},BL=hA,jL=hA,VL=function(g){var w=g.children,S=w===void 0?"No options":w,A=g.innerProps,L=uf(g,IL);return Pn("div",Gn({},ga(jn(jn({},L),{},{children:S,innerProps:A}),"noOptionsMessage",{"menu-notice":!0,"menu-notice--no-options":!0}),A),S)},UL=function(g){var w=g.children,S=w===void 0?"Loading...":w,A=g.innerProps,L=uf(g,RL);return Pn("div",Gn({},ga(jn(jn({},L),{},{children:S,innerProps:A}),"loadingMessage",{"menu-notice":!0,"menu-notice--loading":!0}),A),S)},GL=function(g){var w=g.rect,S=g.offset,A=g.position;return{left:w.left,position:A,top:S,width:w.width,zIndex:1}},HL=function(g){var w=g.appendTo,S=g.children,A=g.controlElement,L=g.innerProps,N=g.menuPlacement,r=g.menuPosition,F=Re.useRef(null),B=Re.useRef(null),$=Re.useState(cA(N)),ie=sf($,2),re=ie[0],Te=ie[1],_e=Re.useMemo(function(){return{setPortalPlacement:Te}},[]),me=Re.useState(null),ge=sf(me,2),pe=ge[0],fe=ge[1],se=Re.useCallback(function(){if(A){var At=wL(A),gt=r==="fixed"?0:window.pageYOffset,Xe=At[re]+gt;(Xe!==pe?.offset||At.left!==pe?.rect.left||At.width!==pe?.rect.width)&&fe({offset:Xe,rect:At})}},[A,r,re,pe?.offset,pe?.rect.left,pe?.rect.width]);pb(function(){se()},[se]);var De=Re.useCallback(function(){typeof B.current=="function"&&(B.current(),B.current=null),A&&F.current&&(B.current=mL(A,F.current,se,{elementResize:"ResizeObserver"in window}))},[A,se]);pb(function(){De()},[De]);var we=Re.useCallback(function(At){F.current=At,De()},[De]);if(!w&&r!=="fixed"||!pe)return null;var ht=Pn("div",Gn({ref:we},ga(jn(jn({},g),{},{offset:pe.offset,position:r,rect:pe.rect}),"menuPortal",{"menu-portal":!0}),L),S);return Pn(uA.Provider,{value:_e},w?cP.createPortal(ht,w):ht)},qL=function(g){var w=g.isDisabled,S=g.isRtl;return{label:"container",direction:S?"rtl":void 0,pointerEvents:w?"none":void 0,position:"relative"}},$L=function(g){var w=g.children,S=g.innerProps,A=g.isDisabled,L=g.isRtl;return Pn("div",Gn({},ga(g,"container",{"--is-disabled":A,"--is-rtl":L}),S),w)},ZL=function(g,w){var S=g.theme.spacing,A=g.isMulti,L=g.hasValue,N=g.selectProps.controlShouldRenderValue;return jn({alignItems:"center",display:A&&L&&N?"flex":"grid",flex:1,flexWrap:"wrap",WebkitOverflowScrolling:"touch",position:"relative",overflow:"hidden"},w?{}:{padding:"".concat(S.baseUnit/2,"px ").concat(S.baseUnit*2,"px")})},WL=function(g){var w=g.children,S=g.innerProps,A=g.isMulti,L=g.hasValue;return Pn("div",Gn({},ga(g,"valueContainer",{"value-container":!0,"value-container--is-multi":A,"value-container--has-value":L}),S),w)},XL=function(){return{alignItems:"center",alignSelf:"stretch",display:"flex",flexShrink:0}},YL=function(g){var w=g.children,S=g.innerProps;return Pn("div",Gn({},ga(g,"indicatorsContainer",{indicators:!0}),S),w)},GS,KL=["size"],QL=["innerProps","isRtl","size"],JL={name:"8mmkcg",styles:"display:inline-block;fill:currentColor;line-height:1;stroke:currentColor;stroke-width:0"},dA=function(g){var w=g.size,S=uf(g,KL);return Pn("svg",Gn({height:w,width:w,viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",css:JL},S))},n1=function(g){return Pn(dA,Gn({size:20},g),Pn("path",{d:"M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"}))},fA=function(g){return Pn(dA,Gn({size:20},g),Pn("path",{d:"M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"}))},pA=function(g,w){var S=g.isFocused,A=g.theme,L=A.spacing.baseUnit,N=A.colors;return jn({label:"indicatorContainer",display:"flex",transition:"color 150ms"},w?{}:{color:S?N.neutral60:N.neutral20,padding:L*2,":hover":{color:S?N.neutral80:N.neutral40}})},e3=pA,t3=function(g){var w=g.children,S=g.innerProps;return Pn("div",Gn({},ga(g,"dropdownIndicator",{indicator:!0,"dropdown-indicator":!0}),S),w||Pn(fA,null))},i3=pA,n3=function(g){var w=g.children,S=g.innerProps;return Pn("div",Gn({},ga(g,"clearIndicator",{indicator:!0,"clear-indicator":!0}),S),w||Pn(n1,null))},r3=function(g,w){var S=g.isDisabled,A=g.theme,L=A.spacing.baseUnit,N=A.colors;return jn({label:"indicatorSeparator",alignSelf:"stretch",width:1},w?{}:{backgroundColor:S?N.neutral10:N.neutral20,marginBottom:L*2,marginTop:L*2})},s3=function(g){var w=g.innerProps;return Pn("span",Gn({},w,ga(g,"indicatorSeparator",{"indicator-separator":!0})))},a3=JO(GS||(GS=eL([`
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
`]))),o3=function(g,w){var S=g.isFocused,A=g.size,L=g.theme,N=L.colors,r=L.spacing.baseUnit;return jn({label:"loadingIndicator",display:"flex",transition:"color 150ms",alignSelf:"center",fontSize:A,lineHeight:1,marginRight:A,textAlign:"center",verticalAlign:"middle"},w?{}:{color:S?N.neutral60:N.neutral20,padding:r*2})},zx=function(g){var w=g.delay,S=g.offset;return Pn("span",{css:Jb({animation:"".concat(a3," 1s ease-in-out ").concat(w,"ms infinite;"),backgroundColor:"currentColor",borderRadius:"1em",display:"inline-block",marginLeft:S?"1em":void 0,height:"1em",verticalAlign:"top",width:"1em"},"","")})},l3=function(g){var w=g.innerProps,S=g.isRtl,A=g.size,L=A===void 0?4:A,N=uf(g,QL);return Pn("div",Gn({},ga(jn(jn({},N),{},{innerProps:w,isRtl:S,size:L}),"loadingIndicator",{indicator:!0,"loading-indicator":!0}),w),Pn(zx,{delay:0,offset:S}),Pn(zx,{delay:160,offset:!0}),Pn(zx,{delay:320,offset:!S}))},c3=function(g,w){var S=g.isDisabled,A=g.isFocused,L=g.theme,N=L.colors,r=L.borderRadius,F=L.spacing;return jn({label:"control",alignItems:"center",cursor:"default",display:"flex",flexWrap:"wrap",justifyContent:"space-between",minHeight:F.controlHeight,outline:"0 !important",position:"relative",transition:"all 100ms"},w?{}:{backgroundColor:S?N.neutral5:N.neutral0,borderColor:S?N.neutral10:A?N.primary:N.neutral20,borderRadius:r,borderStyle:"solid",borderWidth:1,boxShadow:A?"0 0 0 1px ".concat(N.primary):void 0,"&:hover":{borderColor:A?N.primary:N.neutral30}})},u3=function(g){var w=g.children,S=g.isDisabled,A=g.isFocused,L=g.innerRef,N=g.innerProps,r=g.menuIsOpen;return Pn("div",Gn({ref:L},ga(g,"control",{control:!0,"control--is-disabled":S,"control--is-focused":A,"control--menu-is-open":r}),N,{"aria-disabled":S||void 0}),w)},h3=u3,d3=["data"],f3=function(g,w){var S=g.theme.spacing;return w?{}:{paddingBottom:S.baseUnit*2,paddingTop:S.baseUnit*2}},p3=function(g){var w=g.children,S=g.cx,A=g.getStyles,L=g.getClassNames,N=g.Heading,r=g.headingProps,F=g.innerProps,B=g.label,$=g.theme,ie=g.selectProps;return Pn("div",Gn({},ga(g,"group",{group:!0}),F),Pn(N,Gn({},r,{selectProps:ie,theme:$,getStyles:A,getClassNames:L,cx:S}),B),Pn("div",null,w))},m3=function(g,w){var S=g.theme,A=S.colors,L=S.spacing;return jn({label:"group",cursor:"default",display:"block"},w?{}:{color:A.neutral40,fontSize:"75%",fontWeight:500,marginBottom:"0.25em",paddingLeft:L.baseUnit*3,paddingRight:L.baseUnit*3,textTransform:"uppercase"})},g3=function(g){var w=aA(g);w.data;var S=uf(w,d3);return Pn("div",Gn({},ga(g,"groupHeading",{"group-heading":!0}),S))},_3=p3,y3=["innerRef","isDisabled","isHidden","inputClassName"],v3=function(g,w){var S=g.isDisabled,A=g.value,L=g.theme,N=L.spacing,r=L.colors;return jn(jn({visibility:S?"hidden":"visible",transform:A?"translateZ(0)":""},x3),w?{}:{margin:N.baseUnit/2,paddingBottom:N.baseUnit/2,paddingTop:N.baseUnit/2,color:r.neutral80})},mA={gridArea:"1 / 2",font:"inherit",minWidth:"2px",border:0,margin:0,outline:0,padding:0},x3={flex:"1 1 auto",display:"inline-grid",gridArea:"1 / 1 / 2 / 3",gridTemplateColumns:"0 min-content","&:after":jn({content:'attr(data-value) " "',visibility:"hidden",whiteSpace:"pre"},mA)},b3=function(g){return jn({label:"input",color:"inherit",background:0,opacity:g?0:1,width:"100%"},mA)},w3=function(g){var w=g.cx,S=g.value,A=aA(g),L=A.innerRef,N=A.isDisabled,r=A.isHidden,F=A.inputClassName,B=uf(A,y3);return Pn("div",Gn({},ga(g,"input",{"input-container":!0}),{"data-value":S||""}),Pn("input",Gn({className:w({input:!0},F),ref:L,style:b3(r),disabled:N},B)))},T3=w3,S3=function(g,w){var S=g.theme,A=S.spacing,L=S.borderRadius,N=S.colors;return jn({label:"multiValue",display:"flex",minWidth:0},w?{}:{backgroundColor:N.neutral10,borderRadius:L/2,margin:A.baseUnit/2})},E3=function(g,w){var S=g.theme,A=S.borderRadius,L=S.colors,N=g.cropWithEllipsis;return jn({overflow:"hidden",textOverflow:N||N===void 0?"ellipsis":void 0,whiteSpace:"nowrap"},w?{}:{borderRadius:A/2,color:L.neutral80,fontSize:"85%",padding:3,paddingLeft:6})},A3=function(g,w){var S=g.theme,A=S.spacing,L=S.borderRadius,N=S.colors,r=g.isFocused;return jn({alignItems:"center",display:"flex"},w?{}:{borderRadius:L/2,backgroundColor:r?N.dangerLight:void 0,paddingLeft:A.baseUnit,paddingRight:A.baseUnit,":hover":{backgroundColor:N.dangerLight,color:N.danger}})},gA=function(g){var w=g.children,S=g.innerProps;return Pn("div",S,w)},C3=gA,M3=gA;function I3(f){var g=f.children,w=f.innerProps;return Pn("div",Gn({role:"button"},w),g||Pn(n1,{size:14}))}var R3=function(g){var w=g.children,S=g.components,A=g.data,L=g.innerProps,N=g.isDisabled,r=g.removeProps,F=g.selectProps,B=S.Container,$=S.Label,ie=S.Remove;return Pn(B,{data:A,innerProps:jn(jn({},ga(g,"multiValue",{"multi-value":!0,"multi-value--is-disabled":N})),L),selectProps:F},Pn($,{data:A,innerProps:jn({},ga(g,"multiValueLabel",{"multi-value__label":!0})),selectProps:F},w),Pn(ie,{data:A,innerProps:jn(jn({},ga(g,"multiValueRemove",{"multi-value__remove":!0})),{},{"aria-label":"Remove ".concat(w||"option")},r),selectProps:F}))},D3=R3,P3=function(g,w){var S=g.isDisabled,A=g.isFocused,L=g.isSelected,N=g.theme,r=N.spacing,F=N.colors;return jn({label:"option",cursor:"default",display:"block",fontSize:"inherit",width:"100%",userSelect:"none",WebkitTapHighlightColor:"rgba(0, 0, 0, 0)"},w?{}:{backgroundColor:L?F.primary:A?F.primary25:"transparent",color:S?F.neutral20:L?F.neutral0:"inherit",padding:"".concat(r.baseUnit*2,"px ").concat(r.baseUnit*3,"px"),":active":{backgroundColor:S?void 0:L?F.primary:F.primary50}})},O3=function(g){var w=g.children,S=g.isDisabled,A=g.isFocused,L=g.isSelected,N=g.innerRef,r=g.innerProps;return Pn("div",Gn({},ga(g,"option",{option:!0,"option--is-disabled":S,"option--is-focused":A,"option--is-selected":L}),{ref:N,"aria-disabled":S},r),w)},L3=O3,z3=function(g,w){var S=g.theme,A=S.spacing,L=S.colors;return jn({label:"placeholder",gridArea:"1 / 1 / 2 / 3"},w?{}:{color:L.neutral50,marginLeft:A.baseUnit/2,marginRight:A.baseUnit/2})},k3=function(g){var w=g.children,S=g.innerProps;return Pn("div",Gn({},ga(g,"placeholder",{placeholder:!0}),S),w)},N3=k3,F3=function(g,w){var S=g.isDisabled,A=g.theme,L=A.spacing,N=A.colors;return jn({label:"singleValue",gridArea:"1 / 1 / 2 / 3",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},w?{}:{color:S?N.neutral40:N.neutral80,marginLeft:L.baseUnit/2,marginRight:L.baseUnit/2})},B3=function(g){var w=g.children,S=g.isDisabled,A=g.innerProps;return Pn("div",Gn({},ga(g,"singleValue",{"single-value":!0,"single-value--is-disabled":S}),A),w)},j3=B3,V3={ClearIndicator:n3,Control:h3,DropdownIndicator:t3,DownChevron:fA,CrossIcon:n1,Group:_3,GroupHeading:g3,IndicatorsContainer:YL,IndicatorSeparator:s3,Input:T3,LoadingIndicator:l3,Menu:kL,MenuList:FL,MenuPortal:HL,LoadingMessage:UL,NoOptionsMessage:VL,MultiValue:D3,MultiValueContainer:C3,MultiValueLabel:M3,MultiValueRemove:I3,Option:L3,Placeholder:N3,SelectContainer:$L,SingleValue:j3,ValueContainer:WL},U3=function(g){return jn(jn({},V3),g.components)},HS=Number.isNaN||function(g){return typeof g=="number"&&g!==g};function G3(f,g){return!!(f===g||HS(f)&&HS(g))}function H3(f,g){if(f.length!==g.length)return!1;for(var w=0;w<f.length;w++)if(!G3(f[w],g[w]))return!1;return!0}function q3(f,g){g===void 0&&(g=H3);var w=null;function S(){for(var A=[],L=0;L<arguments.length;L++)A[L]=arguments[L];if(w&&w.lastThis===this&&g(A,w.lastArgs))return w.lastResult;var N=f.apply(this,A);return w={lastResult:N,lastArgs:A,lastThis:this},N}return S.clear=function(){w=null},S}var $3={name:"7pg0cj-a11yText",styles:"label:a11yText;z-index:9999;border:0;clip:rect(1px, 1px, 1px, 1px);height:1px;width:1px;position:absolute;overflow:hidden;padding:0;white-space:nowrap"},Z3=function(g){return Pn("span",Gn({css:$3},g))},qS=Z3,W3={guidance:function(g){var w=g.isSearchable,S=g.isMulti,A=g.tabSelectsValue,L=g.context,N=g.isInitialFocus;switch(L){case"menu":return"Use Up and Down to choose options, press Enter to select the currently focused option, press Escape to exit the menu".concat(A?", press Tab to select the option and exit the menu":"",".");case"input":return N?"".concat(g["aria-label"]||"Select"," is focused ").concat(w?",type to refine list":"",", press Down to open the menu, ").concat(S?" press left to focus selected values":""):"";case"value":return"Use left and right to toggle between focused values, press Backspace to remove the currently focused value";default:return""}},onChange:function(g){var w=g.action,S=g.label,A=S===void 0?"":S,L=g.labels,N=g.isDisabled;switch(w){case"deselect-option":case"pop-value":case"remove-value":return"option ".concat(A,", deselected.");case"clear":return"All selected options have been cleared.";case"initial-input-focus":return"option".concat(L.length>1?"s":""," ").concat(L.join(","),", selected.");case"select-option":return N?"option ".concat(A," is disabled. Select another option."):"option ".concat(A,", selected.");default:return""}},onFocus:function(g){var w=g.context,S=g.focused,A=g.options,L=g.label,N=L===void 0?"":L,r=g.selectValue,F=g.isDisabled,B=g.isSelected,$=g.isAppleDevice,ie=function(me,ge){return me&&me.length?"".concat(me.indexOf(ge)+1," of ").concat(me.length):""};if(w==="value"&&r)return"value ".concat(N," focused, ").concat(ie(r,S),".");if(w==="menu"&&$){var re=F?" disabled":"",Te="".concat(B?" selected":"").concat(re);return"".concat(N).concat(Te,", ").concat(ie(A,S),".")}return""},onFilter:function(g){var w=g.inputValue,S=g.resultsMessage;return"".concat(S).concat(w?" for search term "+w:"",".")}},X3=function(g){var w=g.ariaSelection,S=g.focusedOption,A=g.focusedValue,L=g.focusableOptions,N=g.isFocused,r=g.selectValue,F=g.selectProps,B=g.id,$=g.isAppleDevice,ie=F.ariaLiveMessages,re=F.getOptionLabel,Te=F.inputValue,_e=F.isMulti,me=F.isOptionDisabled,ge=F.isSearchable,pe=F.menuIsOpen,fe=F.options,se=F.screenReaderStatus,De=F.tabSelectsValue,we=F.isLoading,ht=F["aria-label"],At=F["aria-live"],gt=Re.useMemo(function(){return jn(jn({},W3),ie||{})},[ie]),Xe=Re.useMemo(function(){var Et="";if(w&&gt.onChange){var Qe=w.option,kt=w.options,ii=w.removedValue,Li=w.removedValues,Ve=w.value,Dt=function(Oi){return Array.isArray(Oi)?null:Oi},ti=ii||Qe||Dt(Ve),li=ti?re(ti):"",Mi=kt||Li||void 0,at=Mi?Mi.map(re):[],Rt=jn({isDisabled:ti&&me(ti,r),label:li,labels:at},w);Et=gt.onChange(Rt)}return Et},[w,gt,me,r,re]),je=Re.useMemo(function(){var Et="",Qe=S||A,kt=!!(S&&r&&r.includes(S));if(Qe&&gt.onFocus){var ii={focused:Qe,label:re(Qe),isDisabled:me(Qe,r),isSelected:kt,options:L,context:Qe===S?"menu":"value",selectValue:r,isAppleDevice:$};Et=gt.onFocus(ii)}return Et},[S,A,re,me,gt,L,r,$]),$e=Re.useMemo(function(){var Et="";if(pe&&fe.length&&!we&&gt.onFilter){var Qe=se({count:L.length});Et=gt.onFilter({inputValue:Te,resultsMessage:Qe})}return Et},[L,Te,pe,gt,fe,se,we]),It=w?.action==="initial-input-focus",Lt=Re.useMemo(function(){var Et="";if(gt.guidance){var Qe=A?"value":pe?"menu":"input";Et=gt.guidance({"aria-label":ht,context:Qe,isDisabled:S&&me(S,r),isMulti:_e,isSearchable:ge,tabSelectsValue:De,isInitialFocus:It})}return Et},[ht,S,A,_e,me,ge,pe,gt,r,De,It]),ct=Pn(Re.Fragment,null,Pn("span",{id:"aria-selection"},Xe),Pn("span",{id:"aria-focused"},je),Pn("span",{id:"aria-results"},$e),Pn("span",{id:"aria-guidance"},Lt));return Pn(Re.Fragment,null,Pn(qS,{id:B},It&&ct),Pn(qS,{"aria-live":At,"aria-atomic":"false","aria-relevant":"additions text",role:"log"},N&&!It&&ct))},Y3=X3,mb=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],K3=new RegExp("["+mb.map(function(f){return f.letters}).join("")+"]","g"),_A={};for(var kx=0;kx<mb.length;kx++)for(var Nx=mb[kx],Fx=0;Fx<Nx.letters.length;Fx++)_A[Nx.letters[Fx]]=Nx.base;var yA=function(g){return g.replace(K3,function(w){return _A[w]})},Q3=q3(yA),$S=function(g){return g.replace(/^\s+|\s+$/g,"")},J3=function(g){return"".concat(g.label," ").concat(g.value)},ez=function(g){return function(w,S){if(w.data.__isNew__)return!0;var A=jn({ignoreCase:!0,ignoreAccents:!0,stringify:J3,trim:!0,matchFrom:"any"},g),L=A.ignoreCase,N=A.ignoreAccents,r=A.stringify,F=A.trim,B=A.matchFrom,$=F?$S(S):S,ie=F?$S(r(w)):r(w);return L&&($=$.toLowerCase(),ie=ie.toLowerCase()),N&&($=Q3($),ie=yA(ie)),B==="start"?ie.substr(0,$.length)===$:ie.indexOf($)>-1}},tz=["innerRef"];function iz(f){var g=f.innerRef,w=uf(f,tz),S=ML(w,"onExited","in","enter","exit","appear");return Pn("input",Gn({ref:g},S,{css:Jb({label:"dummyInput",background:0,border:0,caretColor:"transparent",fontSize:"inherit",gridArea:"1 / 1 / 2 / 3",outline:0,padding:0,width:1,color:"transparent",left:-100,opacity:0,position:"relative",transform:"scale(.01)"},"","")}))}var nz=function(g){g.cancelable&&g.preventDefault(),g.stopPropagation()};function rz(f){var g=f.isEnabled,w=f.onBottomArrive,S=f.onBottomLeave,A=f.onTopArrive,L=f.onTopLeave,N=Re.useRef(!1),r=Re.useRef(!1),F=Re.useRef(0),B=Re.useRef(null),$=Re.useCallback(function(ge,pe){if(B.current!==null){var fe=B.current,se=fe.scrollTop,De=fe.scrollHeight,we=fe.clientHeight,ht=B.current,At=pe>0,gt=De-we-se,Xe=!1;gt>pe&&N.current&&(S&&S(ge),N.current=!1),At&&r.current&&(L&&L(ge),r.current=!1),At&&pe>gt?(w&&!N.current&&w(ge),ht.scrollTop=De,Xe=!0,N.current=!0):!At&&-pe>se&&(A&&!r.current&&A(ge),ht.scrollTop=0,Xe=!0,r.current=!0),Xe&&nz(ge)}},[w,S,A,L]),ie=Re.useCallback(function(ge){$(ge,ge.deltaY)},[$]),re=Re.useCallback(function(ge){F.current=ge.changedTouches[0].clientY},[]),Te=Re.useCallback(function(ge){var pe=F.current-ge.changedTouches[0].clientY;$(ge,pe)},[$]),_e=Re.useCallback(function(ge){if(ge){var pe=EL?{passive:!1}:!1;ge.addEventListener("wheel",ie,pe),ge.addEventListener("touchstart",re,pe),ge.addEventListener("touchmove",Te,pe)}},[Te,re,ie]),me=Re.useCallback(function(ge){ge&&(ge.removeEventListener("wheel",ie,!1),ge.removeEventListener("touchstart",re,!1),ge.removeEventListener("touchmove",Te,!1))},[Te,re,ie]);return Re.useEffect(function(){if(g){var ge=B.current;return _e(ge),function(){me(ge)}}},[g,_e,me]),function(ge){B.current=ge}}var ZS=["boxSizing","height","overflow","paddingRight","position"],WS={boxSizing:"border-box",overflow:"hidden",position:"relative",height:"100%"};function XS(f){f.cancelable&&f.preventDefault()}function YS(f){f.stopPropagation()}function KS(){var f=this.scrollTop,g=this.scrollHeight,w=f+this.offsetHeight;f===0?this.scrollTop=1:w===g&&(this.scrollTop=f-1)}function QS(){return"ontouchstart"in window||navigator.maxTouchPoints}var JS=!!(typeof window<"u"&&window.document&&window.document.createElement),V_=0,bg={capture:!1,passive:!1};function sz(f){var g=f.isEnabled,w=f.accountForScrollbars,S=w===void 0?!0:w,A=Re.useRef({}),L=Re.useRef(null),N=Re.useCallback(function(F){if(JS){var B=document.body,$=B&&B.style;if(S&&ZS.forEach(function(_e){var me=$&&$[_e];A.current[_e]=me}),S&&V_<1){var ie=parseInt(A.current.paddingRight,10)||0,re=document.body?document.body.clientWidth:0,Te=window.innerWidth-re+ie||0;Object.keys(WS).forEach(function(_e){var me=WS[_e];$&&($[_e]=me)}),$&&($.paddingRight="".concat(Te,"px"))}B&&QS()&&(B.addEventListener("touchmove",XS,bg),F&&(F.addEventListener("touchstart",KS,bg),F.addEventListener("touchmove",YS,bg))),V_+=1}},[S]),r=Re.useCallback(function(F){if(JS){var B=document.body,$=B&&B.style;V_=Math.max(V_-1,0),S&&V_<1&&ZS.forEach(function(ie){var re=A.current[ie];$&&($[ie]=re)}),B&&QS()&&(B.removeEventListener("touchmove",XS,bg),F&&(F.removeEventListener("touchstart",KS,bg),F.removeEventListener("touchmove",YS,bg)))}},[S]);return Re.useEffect(function(){if(g){var F=L.current;return N(F),function(){r(F)}}},[g,N,r]),function(F){L.current=F}}var az=function(g){var w=g.target;return w.ownerDocument.activeElement&&w.ownerDocument.activeElement.blur()},oz={name:"1kfdb0e",styles:"position:fixed;left:0;bottom:0;right:0;top:0"};function lz(f){var g=f.children,w=f.lockEnabled,S=f.captureEnabled,A=S===void 0?!0:S,L=f.onBottomArrive,N=f.onBottomLeave,r=f.onTopArrive,F=f.onTopLeave,B=rz({isEnabled:A,onBottomArrive:L,onBottomLeave:N,onTopArrive:r,onTopLeave:F}),$=sz({isEnabled:w}),ie=function(Te){B(Te),$(Te)};return Pn(Re.Fragment,null,w&&Pn("div",{onClick:az,css:oz}),g(ie))}var cz={name:"1a0ro4n-requiredInput",styles:"label:requiredInput;opacity:0;pointer-events:none;position:absolute;bottom:0;left:0;right:0;width:100%"},uz=function(g){var w=g.name,S=g.onFocus;return Pn("input",{required:!0,name:w,tabIndex:-1,"aria-hidden":"true",onFocus:S,css:cz,value:"",onChange:function(){}})},hz=uz;function r1(f){var g;return typeof window<"u"&&window.navigator!=null?f.test(((g=window.navigator.userAgentData)===null||g===void 0?void 0:g.platform)||window.navigator.platform):!1}function dz(){return r1(/^iPhone/i)}function vA(){return r1(/^Mac/i)}function fz(){return r1(/^iPad/i)||vA()&&navigator.maxTouchPoints>1}function pz(){return dz()||fz()}function mz(){return vA()||pz()}var gz=function(g){return g.label},_z=function(g){return g.label},yz=function(g){return g.value},vz=function(g){return!!g.isDisabled},xz={clearIndicator:i3,container:qL,control:c3,dropdownIndicator:e3,group:f3,groupHeading:m3,indicatorsContainer:XL,indicatorSeparator:r3,input:v3,loadingIndicator:o3,loadingMessage:jL,menu:OL,menuList:NL,menuPortal:GL,multiValue:S3,multiValueLabel:E3,multiValueRemove:A3,noOptionsMessage:BL,option:P3,placeholder:z3,singleValue:F3,valueContainer:ZL},bz={primary:"#2684FF",primary75:"#4C9AFF",primary50:"#B2D4FF",primary25:"#DEEBFF",danger:"#DE350B",dangerLight:"#FFBDAD",neutral0:"hsl(0, 0%, 100%)",neutral5:"hsl(0, 0%, 95%)",neutral10:"hsl(0, 0%, 90%)",neutral20:"hsl(0, 0%, 80%)",neutral30:"hsl(0, 0%, 70%)",neutral40:"hsl(0, 0%, 60%)",neutral50:"hsl(0, 0%, 50%)",neutral60:"hsl(0, 0%, 40%)",neutral70:"hsl(0, 0%, 30%)",neutral80:"hsl(0, 0%, 20%)",neutral90:"hsl(0, 0%, 10%)"},wz=4,xA=4,Tz=38,Sz=xA*2,Ez={baseUnit:xA,controlHeight:Tz,menuGutter:Sz},Bx={borderRadius:wz,colors:bz,spacing:Ez},Az={"aria-live":"polite",backspaceRemovesValue:!0,blurInputOnSelect:US(),captureMenuScroll:!US(),classNames:{},closeMenuOnSelect:!0,closeMenuOnScroll:!1,components:{},controlShouldRenderValue:!0,escapeClearsValue:!1,filterOption:ez(),formatGroupLabel:gz,getOptionLabel:_z,getOptionValue:yz,isDisabled:!1,isLoading:!1,isMulti:!1,isRtl:!1,isSearchable:!0,isOptionDisabled:vz,loadingMessage:function(){return"Loading..."},maxMenuHeight:300,minMenuHeight:140,menuIsOpen:!1,menuPlacement:"bottom",menuPosition:"absolute",menuShouldBlockScroll:!1,menuShouldScrollIntoView:!TL(),noOptionsMessage:function(){return"No options"},openMenuOnFocus:!1,openMenuOnClick:!0,options:[],pageSize:5,placeholder:"Select...",screenReaderStatus:function(g){var w=g.count;return"".concat(w," result").concat(w!==1?"s":""," available")},styles:{},tabIndex:0,tabSelectsValue:!0,unstyled:!1};function e2(f,g,w,S){var A=TA(f,g,w),L=SA(f,g,w),N=wA(f,g),r=n0(f,g);return{type:"option",data:g,isDisabled:A,isSelected:L,label:N,value:r,index:S}}function Vv(f,g){return f.options.map(function(w,S){if("options"in w){var A=w.options.map(function(N,r){return e2(f,N,g,r)}).filter(function(N){return i2(f,N)});return A.length>0?{type:"group",data:w,options:A,index:S}:void 0}var L=e2(f,w,g,S);return i2(f,L)?L:void 0}).filter(AL)}function bA(f){return f.reduce(function(g,w){return w.type==="group"?g.push.apply(g,Wb(w.options.map(function(S){return S.data}))):g.push(w.data),g},[])}function t2(f,g){return f.reduce(function(w,S){return S.type==="group"?w.push.apply(w,Wb(S.options.map(function(A){return{data:A.data,id:"".concat(g,"-").concat(S.index,"-").concat(A.index)}}))):w.push({data:S.data,id:"".concat(g,"-").concat(S.index)}),w},[])}function Cz(f,g){return bA(Vv(f,g))}function i2(f,g){var w=f.inputValue,S=w===void 0?"":w,A=g.data,L=g.isSelected,N=g.label,r=g.value;return(!AA(f)||!L)&&EA(f,{label:N,value:r,data:A},S)}function Mz(f,g){var w=f.focusedValue,S=f.selectValue,A=S.indexOf(w);if(A>-1){var L=g.indexOf(w);if(L>-1)return w;if(A<g.length)return g[A]}return null}function Iz(f,g){var w=f.focusedOption;return w&&g.indexOf(w)>-1?w:g[0]}var jx=function(g,w){var S,A=(S=g.find(function(L){return L.data===w}))===null||S===void 0?void 0:S.id;return A||null},wA=function(g,w){return g.getOptionLabel(w)},n0=function(g,w){return g.getOptionValue(w)};function TA(f,g,w){return typeof f.isOptionDisabled=="function"?f.isOptionDisabled(g,w):!1}function SA(f,g,w){if(w.indexOf(g)>-1)return!0;if(typeof f.isOptionSelected=="function")return f.isOptionSelected(g,w);var S=n0(f,g);return w.some(function(A){return n0(f,A)===S})}function EA(f,g,w){return f.filterOption?f.filterOption(g,w):!0}var AA=function(g){var w=g.hideSelectedOptions,S=g.isMulti;return w===void 0?S:w},Rz=1,CA=function(f){YP(w,f);var g=JP(w);function w(S){var A;if(WP(this,w),A=g.call(this,S),A.state={ariaSelection:null,focusedOption:null,focusedOptionId:null,focusableOptionsWithIds:[],focusedValue:null,inputIsHidden:!1,isFocused:!1,selectValue:[],clearFocusValueOnUpdate:!1,prevWasFocused:!1,inputIsHiddenAfterUpdate:void 0,prevProps:void 0,instancePrefix:"",isAppleDevice:!1},A.blockOptionHover=!1,A.isComposing=!1,A.commonProps=void 0,A.initialTouchX=0,A.initialTouchY=0,A.openAfterFocus=!1,A.scrollToFocusedOptionOnUpdate=!1,A.userIsDragging=void 0,A.controlRef=null,A.getControlRef=function(F){A.controlRef=F},A.focusedOptionRef=null,A.getFocusedOptionRef=function(F){A.focusedOptionRef=F},A.menuListRef=null,A.getMenuListRef=function(F){A.menuListRef=F},A.inputRef=null,A.getInputRef=function(F){A.inputRef=F},A.focus=A.focusInput,A.blur=A.blurInput,A.onChange=function(F,B){var $=A.props,ie=$.onChange,re=$.name;B.name=re,A.ariaOnChange(F,B),ie(F,B)},A.setValue=function(F,B,$){var ie=A.props,re=ie.closeMenuOnSelect,Te=ie.isMulti,_e=ie.inputValue;A.onInputChange("",{action:"set-value",prevInputValue:_e}),re&&(A.setState({inputIsHiddenAfterUpdate:!Te}),A.onMenuClose()),A.setState({clearFocusValueOnUpdate:!0}),A.onChange(F,{action:B,option:$})},A.selectOption=function(F){var B=A.props,$=B.blurInputOnSelect,ie=B.isMulti,re=B.name,Te=A.state.selectValue,_e=ie&&A.isOptionSelected(F,Te),me=A.isOptionDisabled(F,Te);if(_e){var ge=A.getOptionValue(F);A.setValue(Te.filter(function(pe){return A.getOptionValue(pe)!==ge}),"deselect-option",F)}else if(!me)ie?A.setValue([].concat(Wb(Te),[F]),"select-option",F):A.setValue(F,"select-option");else{A.ariaOnChange(F,{action:"select-option",option:F,name:re});return}$&&A.blurInput()},A.removeValue=function(F){var B=A.props.isMulti,$=A.state.selectValue,ie=A.getOptionValue(F),re=$.filter(function(_e){return A.getOptionValue(_e)!==ie}),Te=Dv(B,re,re[0]||null);A.onChange(Te,{action:"remove-value",removedValue:F}),A.focusInput()},A.clearValue=function(){var F=A.state.selectValue;A.onChange(Dv(A.props.isMulti,[],null),{action:"clear",removedValues:F})},A.popValue=function(){var F=A.props.isMulti,B=A.state.selectValue,$=B[B.length-1],ie=B.slice(0,B.length-1),re=Dv(F,ie,ie[0]||null);$&&A.onChange(re,{action:"pop-value",removedValue:$})},A.getFocusedOptionId=function(F){return jx(A.state.focusableOptionsWithIds,F)},A.getFocusableOptionsWithIds=function(){return t2(Vv(A.props,A.state.selectValue),A.getElementId("option"))},A.getValue=function(){return A.state.selectValue},A.cx=function(){for(var F=arguments.length,B=new Array(F),$=0;$<F;$++)B[$]=arguments[$];return yL.apply(void 0,[A.props.classNamePrefix].concat(B))},A.getOptionLabel=function(F){return wA(A.props,F)},A.getOptionValue=function(F){return n0(A.props,F)},A.getStyles=function(F,B){var $=A.props.unstyled,ie=xz[F](B,$);ie.boxSizing="border-box";var re=A.props.styles[F];return re?re(ie,B):ie},A.getClassNames=function(F,B){var $,ie;return($=(ie=A.props.classNames)[F])===null||$===void 0?void 0:$.call(ie,B)},A.getElementId=function(F){return"".concat(A.state.instancePrefix,"-").concat(F)},A.getComponents=function(){return U3(A.props)},A.buildCategorizedOptions=function(){return Vv(A.props,A.state.selectValue)},A.getCategorizedOptions=function(){return A.props.menuIsOpen?A.buildCategorizedOptions():[]},A.buildFocusableOptions=function(){return bA(A.buildCategorizedOptions())},A.getFocusableOptions=function(){return A.props.menuIsOpen?A.buildFocusableOptions():[]},A.ariaOnChange=function(F,B){A.setState({ariaSelection:jn({value:F},B)})},A.onMenuMouseDown=function(F){F.button===0&&(F.stopPropagation(),F.preventDefault(),A.focusInput())},A.onMenuMouseMove=function(F){A.blockOptionHover=!1},A.onControlMouseDown=function(F){if(!F.defaultPrevented){var B=A.props.openMenuOnClick;A.state.isFocused?A.props.menuIsOpen?F.target.tagName!=="INPUT"&&F.target.tagName!=="TEXTAREA"&&A.onMenuClose():B&&A.openMenu("first"):(B&&(A.openAfterFocus=!0),A.focusInput()),F.target.tagName!=="INPUT"&&F.target.tagName!=="TEXTAREA"&&F.preventDefault()}},A.onDropdownIndicatorMouseDown=function(F){if(!(F&&F.type==="mousedown"&&F.button!==0)&&!A.props.isDisabled){var B=A.props,$=B.isMulti,ie=B.menuIsOpen;A.focusInput(),ie?(A.setState({inputIsHiddenAfterUpdate:!$}),A.onMenuClose()):A.openMenu("first"),F.preventDefault()}},A.onClearIndicatorMouseDown=function(F){F&&F.type==="mousedown"&&F.button!==0||(A.clearValue(),F.preventDefault(),A.openAfterFocus=!1,F.type==="touchend"?A.focusInput():setTimeout(function(){return A.focusInput()}))},A.onScroll=function(F){typeof A.props.closeMenuOnScroll=="boolean"?F.target instanceof HTMLElement&&m0(F.target)&&A.props.onMenuClose():typeof A.props.closeMenuOnScroll=="function"&&A.props.closeMenuOnScroll(F)&&A.props.onMenuClose()},A.onCompositionStart=function(){A.isComposing=!0},A.onCompositionEnd=function(){A.isComposing=!1},A.onTouchStart=function(F){var B=F.touches,$=B&&B.item(0);$&&(A.initialTouchX=$.clientX,A.initialTouchY=$.clientY,A.userIsDragging=!1)},A.onTouchMove=function(F){var B=F.touches,$=B&&B.item(0);if($){var ie=Math.abs($.clientX-A.initialTouchX),re=Math.abs($.clientY-A.initialTouchY),Te=5;A.userIsDragging=ie>Te||re>Te}},A.onTouchEnd=function(F){A.userIsDragging||(A.controlRef&&!A.controlRef.contains(F.target)&&A.menuListRef&&!A.menuListRef.contains(F.target)&&A.blurInput(),A.initialTouchX=0,A.initialTouchY=0)},A.onControlTouchEnd=function(F){A.userIsDragging||A.onControlMouseDown(F)},A.onClearIndicatorTouchEnd=function(F){A.userIsDragging||A.onClearIndicatorMouseDown(F)},A.onDropdownIndicatorTouchEnd=function(F){A.userIsDragging||A.onDropdownIndicatorMouseDown(F)},A.handleInputChange=function(F){var B=A.props.inputValue,$=F.currentTarget.value;A.setState({inputIsHiddenAfterUpdate:!1}),A.onInputChange($,{action:"input-change",prevInputValue:B}),A.props.menuIsOpen||A.onMenuOpen()},A.onInputFocus=function(F){A.props.onFocus&&A.props.onFocus(F),A.setState({inputIsHiddenAfterUpdate:!1,isFocused:!0}),(A.openAfterFocus||A.props.openMenuOnFocus)&&A.openMenu("first"),A.openAfterFocus=!1},A.onInputBlur=function(F){var B=A.props.inputValue;if(A.menuListRef&&A.menuListRef.contains(document.activeElement)){A.inputRef.focus();return}A.props.onBlur&&A.props.onBlur(F),A.onInputChange("",{action:"input-blur",prevInputValue:B}),A.onMenuClose(),A.setState({focusedValue:null,isFocused:!1})},A.onOptionHover=function(F){if(!(A.blockOptionHover||A.state.focusedOption===F)){var B=A.getFocusableOptions(),$=B.indexOf(F);A.setState({focusedOption:F,focusedOptionId:$>-1?A.getFocusedOptionId(F):null})}},A.shouldHideSelectedOptions=function(){return AA(A.props)},A.onValueInputFocus=function(F){F.preventDefault(),F.stopPropagation(),A.focus()},A.onKeyDown=function(F){var B=A.props,$=B.isMulti,ie=B.backspaceRemovesValue,re=B.escapeClearsValue,Te=B.inputValue,_e=B.isClearable,me=B.isDisabled,ge=B.menuIsOpen,pe=B.onKeyDown,fe=B.tabSelectsValue,se=B.openMenuOnFocus,De=A.state,we=De.focusedOption,ht=De.focusedValue,At=De.selectValue;if(!me&&!(typeof pe=="function"&&(pe(F),F.defaultPrevented))){switch(A.blockOptionHover=!0,F.key){case"ArrowLeft":if(!$||Te)return;A.focusValue("previous");break;case"ArrowRight":if(!$||Te)return;A.focusValue("next");break;case"Delete":case"Backspace":if(Te)return;if(ht)A.removeValue(ht);else{if(!ie)return;$?A.popValue():_e&&A.clearValue()}break;case"Tab":if(A.isComposing||F.shiftKey||!ge||!fe||!we||se&&A.isOptionSelected(we,At))return;A.selectOption(we);break;case"Enter":if(F.keyCode===229)break;if(ge){if(!we||A.isComposing)return;A.selectOption(we);break}return;case"Escape":ge?(A.setState({inputIsHiddenAfterUpdate:!1}),A.onInputChange("",{action:"menu-close",prevInputValue:Te}),A.onMenuClose()):_e&&re&&A.clearValue();break;case" ":if(Te)return;if(!ge){A.openMenu("first");break}if(!we)return;A.selectOption(we);break;case"ArrowUp":ge?A.focusOption("up"):A.openMenu("last");break;case"ArrowDown":ge?A.focusOption("down"):A.openMenu("first");break;case"PageUp":if(!ge)return;A.focusOption("pageup");break;case"PageDown":if(!ge)return;A.focusOption("pagedown");break;case"Home":if(!ge)return;A.focusOption("first");break;case"End":if(!ge)return;A.focusOption("last");break;default:return}F.preventDefault()}},A.state.instancePrefix="react-select-"+(A.props.instanceId||++Rz),A.state.selectValue=jS(S.value),S.menuIsOpen&&A.state.selectValue.length){var L=A.getFocusableOptionsWithIds(),N=A.buildFocusableOptions(),r=N.indexOf(A.state.selectValue[0]);A.state.focusableOptionsWithIds=L,A.state.focusedOption=N[r],A.state.focusedOptionId=jx(L,N[r])}return A}return XP(w,[{key:"componentDidMount",value:function(){this.startListeningComposition(),this.startListeningToTouch(),this.props.closeMenuOnScroll&&document&&document.addEventListener&&document.addEventListener("scroll",this.onScroll,!0),this.props.autoFocus&&this.focusInput(),this.props.menuIsOpen&&this.state.focusedOption&&this.menuListRef&&this.focusedOptionRef&&VS(this.menuListRef,this.focusedOptionRef),mz()&&this.setState({isAppleDevice:!0})}},{key:"componentDidUpdate",value:function(A){var L=this.props,N=L.isDisabled,r=L.menuIsOpen,F=this.state.isFocused;(F&&!N&&A.isDisabled||F&&r&&!A.menuIsOpen)&&this.focusInput(),F&&N&&!A.isDisabled?this.setState({isFocused:!1},this.onMenuClose):!F&&!N&&A.isDisabled&&this.inputRef===document.activeElement&&this.setState({isFocused:!0}),this.menuListRef&&this.focusedOptionRef&&this.scrollToFocusedOptionOnUpdate&&(VS(this.menuListRef,this.focusedOptionRef),this.scrollToFocusedOptionOnUpdate=!1)}},{key:"componentWillUnmount",value:function(){this.stopListeningComposition(),this.stopListeningToTouch(),document.removeEventListener("scroll",this.onScroll,!0)}},{key:"onMenuOpen",value:function(){this.props.onMenuOpen()}},{key:"onMenuClose",value:function(){this.onInputChange("",{action:"menu-close",prevInputValue:this.props.inputValue}),this.props.onMenuClose()}},{key:"onInputChange",value:function(A,L){this.props.onInputChange(A,L)}},{key:"focusInput",value:function(){this.inputRef&&this.inputRef.focus()}},{key:"blurInput",value:function(){this.inputRef&&this.inputRef.blur()}},{key:"openMenu",value:function(A){var L=this,N=this.state,r=N.selectValue,F=N.isFocused,B=this.buildFocusableOptions(),$=A==="first"?0:B.length-1;if(!this.props.isMulti){var ie=B.indexOf(r[0]);ie>-1&&($=ie)}this.scrollToFocusedOptionOnUpdate=!(F&&this.menuListRef),this.setState({inputIsHiddenAfterUpdate:!1,focusedValue:null,focusedOption:B[$],focusedOptionId:this.getFocusedOptionId(B[$])},function(){return L.onMenuOpen()})}},{key:"focusValue",value:function(A){var L=this.state,N=L.selectValue,r=L.focusedValue;if(this.props.isMulti){this.setState({focusedOption:null});var F=N.indexOf(r);r||(F=-1);var B=N.length-1,$=-1;if(N.length){switch(A){case"previous":F===0?$=0:F===-1?$=B:$=F-1;break;case"next":F>-1&&F<B&&($=F+1);break}this.setState({inputIsHidden:$!==-1,focusedValue:N[$]})}}}},{key:"focusOption",value:function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"first",L=this.props.pageSize,N=this.state.focusedOption,r=this.getFocusableOptions();if(r.length){var F=0,B=r.indexOf(N);N||(B=-1),A==="up"?F=B>0?B-1:r.length-1:A==="down"?F=(B+1)%r.length:A==="pageup"?(F=B-L,F<0&&(F=0)):A==="pagedown"?(F=B+L,F>r.length-1&&(F=r.length-1)):A==="last"&&(F=r.length-1),this.scrollToFocusedOptionOnUpdate=!0,this.setState({focusedOption:r[F],focusedValue:null,focusedOptionId:this.getFocusedOptionId(r[F])})}}},{key:"getTheme",value:function(){return this.props.theme?typeof this.props.theme=="function"?this.props.theme(Bx):jn(jn({},Bx),this.props.theme):Bx}},{key:"getCommonProps",value:function(){var A=this.clearValue,L=this.cx,N=this.getStyles,r=this.getClassNames,F=this.getValue,B=this.selectOption,$=this.setValue,ie=this.props,re=ie.isMulti,Te=ie.isRtl,_e=ie.options,me=this.hasValue();return{clearValue:A,cx:L,getStyles:N,getClassNames:r,getValue:F,hasValue:me,isMulti:re,isRtl:Te,options:_e,selectOption:B,selectProps:ie,setValue:$,theme:this.getTheme()}}},{key:"hasValue",value:function(){var A=this.state.selectValue;return A.length>0}},{key:"hasOptions",value:function(){return!!this.getFocusableOptions().length}},{key:"isClearable",value:function(){var A=this.props,L=A.isClearable,N=A.isMulti;return L===void 0?N:L}},{key:"isOptionDisabled",value:function(A,L){return TA(this.props,A,L)}},{key:"isOptionSelected",value:function(A,L){return SA(this.props,A,L)}},{key:"filterOption",value:function(A,L){return EA(this.props,A,L)}},{key:"formatOptionLabel",value:function(A,L){if(typeof this.props.formatOptionLabel=="function"){var N=this.props.inputValue,r=this.state.selectValue;return this.props.formatOptionLabel(A,{context:L,inputValue:N,selectValue:r})}else return this.getOptionLabel(A)}},{key:"formatGroupLabel",value:function(A){return this.props.formatGroupLabel(A)}},{key:"startListeningComposition",value:function(){document&&document.addEventListener&&(document.addEventListener("compositionstart",this.onCompositionStart,!1),document.addEventListener("compositionend",this.onCompositionEnd,!1))}},{key:"stopListeningComposition",value:function(){document&&document.removeEventListener&&(document.removeEventListener("compositionstart",this.onCompositionStart),document.removeEventListener("compositionend",this.onCompositionEnd))}},{key:"startListeningToTouch",value:function(){document&&document.addEventListener&&(document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("touchend",this.onTouchEnd,!1))}},{key:"stopListeningToTouch",value:function(){document&&document.removeEventListener&&(document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"renderInput",value:function(){var A=this.props,L=A.isDisabled,N=A.isSearchable,r=A.inputId,F=A.inputValue,B=A.tabIndex,$=A.form,ie=A.menuIsOpen,re=A.required,Te=this.getComponents(),_e=Te.Input,me=this.state,ge=me.inputIsHidden,pe=me.ariaSelection,fe=this.commonProps,se=r||this.getElementId("input"),De=jn(jn(jn({"aria-autocomplete":"list","aria-expanded":ie,"aria-haspopup":!0,"aria-errormessage":this.props["aria-errormessage"],"aria-invalid":this.props["aria-invalid"],"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-required":re,role:"combobox","aria-activedescendant":this.state.isAppleDevice?void 0:this.state.focusedOptionId||""},ie&&{"aria-controls":this.getElementId("listbox")}),!N&&{"aria-readonly":!0}),this.hasValue()?pe?.action==="initial-input-focus"&&{"aria-describedby":this.getElementId("live-region")}:{"aria-describedby":this.getElementId("placeholder")});return N?Re.createElement(_e,Gn({},fe,{autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",id:se,innerRef:this.getInputRef,isDisabled:L,isHidden:ge,onBlur:this.onInputBlur,onChange:this.handleInputChange,onFocus:this.onInputFocus,spellCheck:"false",tabIndex:B,form:$,type:"text",value:F},De)):Re.createElement(iz,Gn({id:se,innerRef:this.getInputRef,onBlur:this.onInputBlur,onChange:t0,onFocus:this.onInputFocus,disabled:L,tabIndex:B,inputMode:"none",form:$,value:""},De))}},{key:"renderPlaceholderOrValue",value:function(){var A=this,L=this.getComponents(),N=L.MultiValue,r=L.MultiValueContainer,F=L.MultiValueLabel,B=L.MultiValueRemove,$=L.SingleValue,ie=L.Placeholder,re=this.commonProps,Te=this.props,_e=Te.controlShouldRenderValue,me=Te.isDisabled,ge=Te.isMulti,pe=Te.inputValue,fe=Te.placeholder,se=this.state,De=se.selectValue,we=se.focusedValue,ht=se.isFocused;if(!this.hasValue()||!_e)return pe?null:Re.createElement(ie,Gn({},re,{key:"placeholder",isDisabled:me,isFocused:ht,innerProps:{id:this.getElementId("placeholder")}}),fe);if(ge)return De.map(function(gt,Xe){var je=gt===we,$e="".concat(A.getOptionLabel(gt),"-").concat(A.getOptionValue(gt));return Re.createElement(N,Gn({},re,{components:{Container:r,Label:F,Remove:B},isFocused:je,isDisabled:me,key:$e,index:Xe,removeProps:{onClick:function(){return A.removeValue(gt)},onTouchEnd:function(){return A.removeValue(gt)},onMouseDown:function(Lt){Lt.preventDefault()}},data:gt}),A.formatOptionLabel(gt,"value"))});if(pe)return null;var At=De[0];return Re.createElement($,Gn({},re,{data:At,isDisabled:me}),this.formatOptionLabel(At,"value"))}},{key:"renderClearIndicator",value:function(){var A=this.getComponents(),L=A.ClearIndicator,N=this.commonProps,r=this.props,F=r.isDisabled,B=r.isLoading,$=this.state.isFocused;if(!this.isClearable()||!L||F||!this.hasValue()||B)return null;var ie={onMouseDown:this.onClearIndicatorMouseDown,onTouchEnd:this.onClearIndicatorTouchEnd,"aria-hidden":"true"};return Re.createElement(L,Gn({},N,{innerProps:ie,isFocused:$}))}},{key:"renderLoadingIndicator",value:function(){var A=this.getComponents(),L=A.LoadingIndicator,N=this.commonProps,r=this.props,F=r.isDisabled,B=r.isLoading,$=this.state.isFocused;if(!L||!B)return null;var ie={"aria-hidden":"true"};return Re.createElement(L,Gn({},N,{innerProps:ie,isDisabled:F,isFocused:$}))}},{key:"renderIndicatorSeparator",value:function(){var A=this.getComponents(),L=A.DropdownIndicator,N=A.IndicatorSeparator;if(!L||!N)return null;var r=this.commonProps,F=this.props.isDisabled,B=this.state.isFocused;return Re.createElement(N,Gn({},r,{isDisabled:F,isFocused:B}))}},{key:"renderDropdownIndicator",value:function(){var A=this.getComponents(),L=A.DropdownIndicator;if(!L)return null;var N=this.commonProps,r=this.props.isDisabled,F=this.state.isFocused,B={onMouseDown:this.onDropdownIndicatorMouseDown,onTouchEnd:this.onDropdownIndicatorTouchEnd,"aria-hidden":"true"};return Re.createElement(L,Gn({},N,{innerProps:B,isDisabled:r,isFocused:F}))}},{key:"renderMenu",value:function(){var A=this,L=this.getComponents(),N=L.Group,r=L.GroupHeading,F=L.Menu,B=L.MenuList,$=L.MenuPortal,ie=L.LoadingMessage,re=L.NoOptionsMessage,Te=L.Option,_e=this.commonProps,me=this.state.focusedOption,ge=this.props,pe=ge.captureMenuScroll,fe=ge.inputValue,se=ge.isLoading,De=ge.loadingMessage,we=ge.minMenuHeight,ht=ge.maxMenuHeight,At=ge.menuIsOpen,gt=ge.menuPlacement,Xe=ge.menuPosition,je=ge.menuPortalTarget,$e=ge.menuShouldBlockScroll,It=ge.menuShouldScrollIntoView,Lt=ge.noOptionsMessage,ct=ge.onMenuScrollToTop,Et=ge.onMenuScrollToBottom;if(!At)return null;var Qe=function(li,Mi){var at=li.type,Rt=li.data,_i=li.isDisabled,Oi=li.isSelected,ei=li.label,hn=li.value,In=me===Rt,Rn=_i?void 0:function(){return A.onOptionHover(Rt)},Qi=_i?void 0:function(){return A.selectOption(Rt)},Zr="".concat(A.getElementId("option"),"-").concat(Mi),Fn={id:Zr,onClick:Qi,onMouseMove:Rn,onMouseOver:Rn,tabIndex:-1,role:"option","aria-selected":A.state.isAppleDevice?void 0:Oi};return Re.createElement(Te,Gn({},_e,{innerProps:Fn,data:Rt,isDisabled:_i,isSelected:Oi,key:Zr,label:ei,type:at,value:hn,isFocused:In,innerRef:In?A.getFocusedOptionRef:void 0}),A.formatOptionLabel(li.data,"menu"))},kt;if(this.hasOptions())kt=this.getCategorizedOptions().map(function(ti){if(ti.type==="group"){var li=ti.data,Mi=ti.options,at=ti.index,Rt="".concat(A.getElementId("group"),"-").concat(at),_i="".concat(Rt,"-heading");return Re.createElement(N,Gn({},_e,{key:Rt,data:li,options:Mi,Heading:r,headingProps:{id:_i,data:ti.data},label:A.formatGroupLabel(ti.data)}),ti.options.map(function(Oi){return Qe(Oi,"".concat(at,"-").concat(Oi.index))}))}else if(ti.type==="option")return Qe(ti,"".concat(ti.index))});else if(se){var ii=De({inputValue:fe});if(ii===null)return null;kt=Re.createElement(ie,_e,ii)}else{var Li=Lt({inputValue:fe});if(Li===null)return null;kt=Re.createElement(re,_e,Li)}var Ve={minMenuHeight:we,maxMenuHeight:ht,menuPlacement:gt,menuPosition:Xe,menuShouldScrollIntoView:It},Dt=Re.createElement(LL,Gn({},_e,Ve),function(ti){var li=ti.ref,Mi=ti.placerProps,at=Mi.placement,Rt=Mi.maxHeight;return Re.createElement(F,Gn({},_e,Ve,{innerRef:li,innerProps:{onMouseDown:A.onMenuMouseDown,onMouseMove:A.onMenuMouseMove},isLoading:se,placement:at}),Re.createElement(lz,{captureEnabled:pe,onTopArrive:ct,onBottomArrive:Et,lockEnabled:$e},function(_i){return Re.createElement(B,Gn({},_e,{innerRef:function(ei){A.getMenuListRef(ei),_i(ei)},innerProps:{role:"listbox","aria-multiselectable":_e.isMulti,id:A.getElementId("listbox")},isLoading:se,maxHeight:Rt,focusedOption:me}),kt)}))});return je||Xe==="fixed"?Re.createElement($,Gn({},_e,{appendTo:je,controlElement:this.controlRef,menuPlacement:gt,menuPosition:Xe}),Dt):Dt}},{key:"renderFormField",value:function(){var A=this,L=this.props,N=L.delimiter,r=L.isDisabled,F=L.isMulti,B=L.name,$=L.required,ie=this.state.selectValue;if($&&!this.hasValue()&&!r)return Re.createElement(hz,{name:B,onFocus:this.onValueInputFocus});if(!(!B||r))if(F)if(N){var re=ie.map(function(me){return A.getOptionValue(me)}).join(N);return Re.createElement("input",{name:B,type:"hidden",value:re})}else{var Te=ie.length>0?ie.map(function(me,ge){return Re.createElement("input",{key:"i-".concat(ge),name:B,type:"hidden",value:A.getOptionValue(me)})}):Re.createElement("input",{name:B,type:"hidden",value:""});return Re.createElement("div",null,Te)}else{var _e=ie[0]?this.getOptionValue(ie[0]):"";return Re.createElement("input",{name:B,type:"hidden",value:_e})}}},{key:"renderLiveRegion",value:function(){var A=this.commonProps,L=this.state,N=L.ariaSelection,r=L.focusedOption,F=L.focusedValue,B=L.isFocused,$=L.selectValue,ie=this.getFocusableOptions();return Re.createElement(Y3,Gn({},A,{id:this.getElementId("live-region"),ariaSelection:N,focusedOption:r,focusedValue:F,isFocused:B,selectValue:$,focusableOptions:ie,isAppleDevice:this.state.isAppleDevice}))}},{key:"render",value:function(){var A=this.getComponents(),L=A.Control,N=A.IndicatorsContainer,r=A.SelectContainer,F=A.ValueContainer,B=this.props,$=B.className,ie=B.id,re=B.isDisabled,Te=B.menuIsOpen,_e=this.state.isFocused,me=this.commonProps=this.getCommonProps();return Re.createElement(r,Gn({},me,{className:$,innerProps:{id:ie,onKeyDown:this.onKeyDown},isDisabled:re,isFocused:_e}),this.renderLiveRegion(),Re.createElement(L,Gn({},me,{innerRef:this.getControlRef,innerProps:{onMouseDown:this.onControlMouseDown,onTouchEnd:this.onControlTouchEnd},isDisabled:re,isFocused:_e,menuIsOpen:Te}),Re.createElement(F,Gn({},me,{isDisabled:re}),this.renderPlaceholderOrValue(),this.renderInput()),Re.createElement(N,Gn({},me,{isDisabled:re}),this.renderClearIndicator(),this.renderLoadingIndicator(),this.renderIndicatorSeparator(),this.renderDropdownIndicator())),this.renderMenu(),this.renderFormField())}}],[{key:"getDerivedStateFromProps",value:function(A,L){var N=L.prevProps,r=L.clearFocusValueOnUpdate,F=L.inputIsHiddenAfterUpdate,B=L.ariaSelection,$=L.isFocused,ie=L.prevWasFocused,re=L.instancePrefix,Te=A.options,_e=A.value,me=A.menuIsOpen,ge=A.inputValue,pe=A.isMulti,fe=jS(_e),se={};if(N&&(_e!==N.value||Te!==N.options||me!==N.menuIsOpen||ge!==N.inputValue)){var De=me?Cz(A,fe):[],we=me?t2(Vv(A,fe),"".concat(re,"-option")):[],ht=r?Mz(L,fe):null,At=Iz(L,De),gt=jx(we,At);se={selectValue:fe,focusedOption:At,focusedOptionId:gt,focusableOptionsWithIds:we,focusedValue:ht,clearFocusValueOnUpdate:!1}}var Xe=F!=null&&A!==N?{inputIsHidden:F,inputIsHiddenAfterUpdate:void 0}:{},je=B,$e=$&&ie;return $&&!$e&&(je={value:Dv(pe,fe,fe[0]||null),options:fe,action:"initial-input-focus"},$e=!ie),B?.action==="initial-input-focus"&&(je=null),jn(jn(jn({},se),Xe),{},{prevProps:A,ariaSelection:je,prevWasFocused:$e})}}]),w}(Re.Component);CA.defaultProps=Az;var Dz=Re.forwardRef(function(f,g){var w=ZP(f);return Re.createElement(CA,Gn({ref:g},w))}),Pz=Dz;const U_="/api/menu",Oz=({restaurantId:f,userId:g})=>{const[w,S]=Re.useState([]),[A,L]=Re.useState(null),[N,r]=Re.useState("All"),[F,B]=Re.useState({name:"",description:"",price:"",category:"",image:"",type:"Veg"}),[$,ie]=Re.useState([]),re=async()=>{const se=await fetch(`${U_}/restaurant/${f}`),{data:De}=await se.json();S(De)},Te=async()=>{try{const se=await fetch(`${U_}/get-category`),{data:De}=await se.json(),we=De.map(ht=>({value:ht.name,label:ht.name}));ie(we)}catch(se){console.error("Failed to fetch categories:",se)}},_e=()=>{B({name:"",description:"",price:"",category:"",image:"",type:"Veg"}),L(null)},me=async se=>{se.preventDefault();const De=localStorage.getItem("token"),we=new FormData;we.append("name",F.name),we.append("description",F.description),we.append("price",F.price),we.append("category",F.category),we.append("type",F.type),we.append("restaurantId",f),we.append("userId",g),F.image&&we.append("image",F.image);const ht=A?`${U_}/update/${A}`:`${U_}/create`;(await(await fetch(ht,{method:A?"PUT":"POST",body:we,headers:{Authorization:`Bearer ${De}`}})).json()).success?(alert(A?"Menu item updated!":"Menu item added!"),_e(),re()):alert("Action failed.")},ge=se=>{B({name:se.name,description:se.description,price:se.price,category:se.category,image:se.image,type:se.type||"Veg"}),L(se._id)},pe=async se=>{if(!window.confirm("Are you sure you want to delete this item?"))return;(await(await fetch(`${U_}/delete/${se}`,{method:"DELETE"})).json()).success?re():alert("Delete failed.")};Re.useEffect(()=>{re(),Te()},[]);const fe=w.reduce((se,De)=>{const we=De.category||"Uncategorized";return se[we]||(se[we]=[]),(N==="All"||De.type===N)&&se[we].push(De),se},{});return W.jsxs("div",{className:"flex flex-col md:flex-row max-h-screen bg-gradient-to-br from-gray-50 to-white",children:[W.jsxs("div",{className:"w-full md:w-1/2 p-4 md:p-6 overflow-auto bg-white",children:[W.jsx("h3",{className:"text-3xl font-bold text-gray-800 mb-6 text-center md:text-left",children:"🍽️ Menu Dashboard"}),W.jsxs("form",{onSubmit:me,className:"space-y-4",children:[W.jsx("h4",{className:"text-xl font-semibold text-gray-700",children:"➕ Add / Edit Menu Item"}),W.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-4 py-2",placeholder:"Item Name *",value:F.name,onChange:se=>B({...F,name:se.target.value}),required:!0}),W.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded-lg px-4 py-2",placeholder:"Price ₹ *",value:F.price,onChange:se=>B({...F,price:se.target.value}),required:!0}),W.jsx(Pz,{options:$,value:$.find(se=>se.value===F.category)||null,onChange:se=>B({...F,category:se?.value||""}),placeholder:"Select Category",isClearable:!0}),W.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-4 py-2",value:F.type,onChange:se=>B({...F,type:se.target.value}),children:[W.jsx("option",{value:"Veg",children:"🥦 Veg"}),W.jsx("option",{value:"Non-Veg",children:"🍗 Non-Veg"})]}),W.jsx("input",{type:"file",accept:"image/*",className:"w-full border border-gray-300 rounded-lg px-4 py-2",onChange:se=>B({...F,image:se.target.files[0]})}),W.jsx("textarea",{rows:3,className:"w-full border border-gray-300 rounded-lg px-4 py-2",placeholder:"Description",value:F.description,onChange:se=>B({...F,description:se.target.value})}),W.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[W.jsx("button",{type:"submit",className:"bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-6 rounded-lg",children:A?"🔄 Update Item":"➕ Add Item"}),A&&W.jsx("button",{type:"button",onClick:_e,className:"bg-gray-300 hover:bg-gray-400 text-black py-2 px-6 rounded-lg",children:"Cancel"})]})]})]}),W.jsxs("div",{className:"w-full sm-h-screen md:w-1/2 p-4 md:p-6 overflow-y-auto md:h-[80vh] bg-gray-50",children:[W.jsxs("div",{className:"flex justify-between items-center mb-4",children:[W.jsx("h4",{className:"text-xl font-semibold text-gray-700",children:"📋 Menu List"}),W.jsxs("select",{value:N,onChange:se=>r(se.target.value),className:"border border-gray-300 rounded px-3 py-1",children:[W.jsx("option",{value:"All",children:"All"}),W.jsx("option",{value:"Veg",children:"🥦 Veg"}),W.jsx("option",{value:"Non-Veg",children:"🍗 Non-Veg"})]})]}),Object.keys(fe).length===0?W.jsx("p",{className:"text-gray-500",children:"No menu items found."}):Object.entries(fe).map(([se,De])=>W.jsx("div",{className:"mb-6",children:W.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:De.map(we=>W.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-4 flex flex-col justify-between",children:[W.jsx("img",{src:`/api/file/menu-image/${we.image}`,alt:we.name,className:"h-36 w-full object-cover rounded mb-3"}),W.jsxs("div",{children:[W.jsxs("h5",{className:"text-lg font-semibold text-gray-800",children:[we.name," ",W.jsxs("span",{className:"text-sm text-gray-500",children:["(",we.type,")"]})]}),W.jsx("p",{className:"text-sm text-gray-600",children:we.description})]}),W.jsxs("div",{className:"flex justify-between items-center mt-2 text-sm",children:[W.jsxs("span",{className:"text-red-600 font-bold",children:["₹",we.price]}),W.jsxs("div",{className:"flex gap-2",children:[W.jsx("button",{onClick:()=>ge(we),className:"px-3 py-1 bg-blue-500 text-white rounded text-xs",children:"Edit"}),W.jsx("button",{onClick:()=>pe(we._id),className:"px-3 py-1 bg-red-500 text-white rounded text-xs",children:"Delete"})]})]})]},we._id))})},se))]})]})};var Uv={exports:{}},Lz=Uv.exports,n2;function zz(){return n2||(n2=1,function(f,g){(function(w,S){f.exports=S()})(Lz,function(){var w,S,A;function L(r,F){if(!w)w=F;else if(!S)S=F;else{var B="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+w+")(sharedChunk); ("+S+")(sharedChunk); self.onerror = null;",$={};w($),A=F($),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(A.workerUrl=window.URL.createObjectURL(new Blob([B],{type:"text/javascript"})))}}L(["exports"],function(r){var F=1e-6,B=typeof Float32Array<"u"?Float32Array:Array;function $(n,e){var i=e[0],a=e[1],c=e[2],p=e[3],m=i*p-c*a;return m?(n[0]=p*(m=1/m),n[1]=-a*m,n[2]=-c*m,n[3]=i*m,n):null}function ie(){var n=new B(9);return B!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function re(n,e){var i=e[0],a=e[1],c=e[2],p=e[3],m=e[4],v=e[5],T=e[6],E=e[7],R=e[8];return n[0]=m*R-v*E,n[1]=c*E-a*R,n[2]=a*v-c*m,n[3]=v*T-p*R,n[4]=i*R-c*T,n[5]=c*p-i*v,n[6]=p*E-m*T,n[7]=a*T-i*E,n[8]=i*m-a*p,n}function Te(n,e,i){var a=e[0],c=e[1],p=e[2],m=e[3],v=e[4],T=e[5],E=e[6],R=e[7],D=e[8],P=i[0],j=i[1],G=i[2],Z=i[3],K=i[4],te=i[5],ce=i[6],he=i[7],Y=i[8];return n[0]=P*a+j*m+G*E,n[1]=P*c+j*v+G*R,n[2]=P*p+j*T+G*D,n[3]=Z*a+K*m+te*E,n[4]=Z*c+K*v+te*R,n[5]=Z*p+K*T+te*D,n[6]=ce*a+he*m+Y*E,n[7]=ce*c+he*v+Y*R,n[8]=ce*p+he*T+Y*D,n}function _e(){var n=new B(16);return B!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function me(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ge(n,e){var i=e[0],a=e[1],c=e[2],p=e[3],m=e[4],v=e[5],T=e[6],E=e[7],R=e[8],D=e[9],P=e[10],j=e[11],G=e[12],Z=e[13],K=e[14],te=e[15],ce=i*v-a*m,he=i*T-c*m,Y=i*E-p*m,le=a*T-c*v,de=a*E-p*v,be=c*E-p*T,Fe=R*Z-D*G,ze=R*K-P*G,Be=R*te-j*G,We=D*K-P*Z,dt=D*te-j*Z,Bt=P*te-j*K,St=ce*Bt-he*dt+Y*We+le*Be-de*ze+be*Fe;return St?(n[0]=(v*Bt-T*dt+E*We)*(St=1/St),n[1]=(c*dt-a*Bt-p*We)*St,n[2]=(Z*be-K*de+te*le)*St,n[3]=(P*de-D*be-j*le)*St,n[4]=(T*Be-m*Bt-E*ze)*St,n[5]=(i*Bt-c*Be+p*ze)*St,n[6]=(K*Y-G*be-te*he)*St,n[7]=(R*be-P*Y+j*he)*St,n[8]=(m*dt-v*Be+E*Fe)*St,n[9]=(a*Be-i*dt-p*Fe)*St,n[10]=(G*de-Z*Y+te*ce)*St,n[11]=(D*Y-R*de-j*ce)*St,n[12]=(v*ze-m*We-T*Fe)*St,n[13]=(i*We-a*ze+c*Fe)*St,n[14]=(Z*he-G*le-K*ce)*St,n[15]=(R*le-D*he+P*ce)*St,n):null}function pe(n,e,i){var a=e[0],c=e[1],p=e[2],m=e[3],v=e[4],T=e[5],E=e[6],R=e[7],D=e[8],P=e[9],j=e[10],G=e[11],Z=e[12],K=e[13],te=e[14],ce=e[15],he=i[0],Y=i[1],le=i[2],de=i[3];return n[0]=he*a+Y*v+le*D+de*Z,n[1]=he*c+Y*T+le*P+de*K,n[2]=he*p+Y*E+le*j+de*te,n[3]=he*m+Y*R+le*G+de*ce,n[4]=(he=i[4])*a+(Y=i[5])*v+(le=i[6])*D+(de=i[7])*Z,n[5]=he*c+Y*T+le*P+de*K,n[6]=he*p+Y*E+le*j+de*te,n[7]=he*m+Y*R+le*G+de*ce,n[8]=(he=i[8])*a+(Y=i[9])*v+(le=i[10])*D+(de=i[11])*Z,n[9]=he*c+Y*T+le*P+de*K,n[10]=he*p+Y*E+le*j+de*te,n[11]=he*m+Y*R+le*G+de*ce,n[12]=(he=i[12])*a+(Y=i[13])*v+(le=i[14])*D+(de=i[15])*Z,n[13]=he*c+Y*T+le*P+de*K,n[14]=he*p+Y*E+le*j+de*te,n[15]=he*m+Y*R+le*G+de*ce,n}function fe(n,e,i){var a,c,p,m,v,T,E,R,D,P,j,G,Z=i[0],K=i[1],te=i[2];return e===n?(n[12]=e[0]*Z+e[4]*K+e[8]*te+e[12],n[13]=e[1]*Z+e[5]*K+e[9]*te+e[13],n[14]=e[2]*Z+e[6]*K+e[10]*te+e[14],n[15]=e[3]*Z+e[7]*K+e[11]*te+e[15]):(c=e[1],p=e[2],m=e[3],v=e[4],T=e[5],E=e[6],R=e[7],D=e[8],P=e[9],j=e[10],G=e[11],n[0]=a=e[0],n[1]=c,n[2]=p,n[3]=m,n[4]=v,n[5]=T,n[6]=E,n[7]=R,n[8]=D,n[9]=P,n[10]=j,n[11]=G,n[12]=a*Z+v*K+D*te+e[12],n[13]=c*Z+T*K+P*te+e[13],n[14]=p*Z+E*K+j*te+e[14],n[15]=m*Z+R*K+G*te+e[15]),n}function se(n,e,i){var a=i[0],c=i[1],p=i[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*p,n[9]=e[9]*p,n[10]=e[10]*p,n[11]=e[11]*p,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function De(n,e,i){var a=Math.sin(i),c=Math.cos(i),p=e[4],m=e[5],v=e[6],T=e[7],E=e[8],R=e[9],D=e[10],P=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=p*c+E*a,n[5]=m*c+R*a,n[6]=v*c+D*a,n[7]=T*c+P*a,n[8]=E*c-p*a,n[9]=R*c-m*a,n[10]=D*c-v*a,n[11]=P*c-T*a,n}function we(n,e,i){var a=Math.sin(i),c=Math.cos(i),p=e[0],m=e[1],v=e[2],T=e[3],E=e[8],R=e[9],D=e[10],P=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*c-E*a,n[1]=m*c-R*a,n[2]=v*c-D*a,n[3]=T*c-P*a,n[8]=p*a+E*c,n[9]=m*a+R*c,n[10]=v*a+D*c,n[11]=T*a+P*c,n}function ht(n,e,i){var a=Math.sin(i),c=Math.cos(i),p=e[0],m=e[1],v=e[2],T=e[3],E=e[4],R=e[5],D=e[6],P=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*c+E*a,n[1]=m*c+R*a,n[2]=v*c+D*a,n[3]=T*c+P*a,n[4]=E*c-p*a,n[5]=R*c-m*a,n[6]=D*c-v*a,n[7]=P*c-T*a,n}function At(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function gt(n,e,i){var a,c,p,m=i[0],v=i[1],T=i[2],E=Math.hypot(m,v,T);return E<F?null:(m*=E=1/E,v*=E,T*=E,a=Math.sin(e),c=Math.cos(e),n[0]=m*m*(p=1-c)+c,n[1]=v*m*p+T*a,n[2]=T*m*p-v*a,n[3]=0,n[4]=m*v*p-T*a,n[5]=v*v*p+c,n[6]=T*v*p+m*a,n[7]=0,n[8]=m*T*p+v*a,n[9]=v*T*p-m*a,n[10]=T*T*p+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function Xe(n,e){var i=e[0],a=e[1],c=e[2],p=e[3],m=i+i,v=a+a,T=c+c,E=i*m,R=a*m,D=a*v,P=c*m,j=c*v,G=c*T,Z=p*m,K=p*v,te=p*T;return n[0]=1-D-G,n[1]=R+te,n[2]=P-K,n[3]=0,n[4]=R-te,n[5]=1-E-G,n[6]=j+Z,n[7]=0,n[8]=P+K,n[9]=j-Z,n[10]=1-E-D,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var je=pe;function $e(){var n=new B(3);return B!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function It(n){var e=new B(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Lt(n){return Math.hypot(n[0],n[1],n[2])}function ct(n,e,i){var a=new B(3);return a[0]=n,a[1]=e,a[2]=i,a}function Et(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Qe(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function kt(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function ii(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Li(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function Ve(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Dt(n,e,i,a){return n[0]=e[0]+i[0]*a,n[1]=e[1]+i[1]*a,n[2]=e[2]+i[2]*a,n}function ti(n,e){var i=e[0]-n[0],a=e[1]-n[1],c=e[2]-n[2];return i*i+a*a+c*c}function li(n){var e=n[0],i=n[1],a=n[2];return e*e+i*i+a*a}function Mi(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function at(n,e){var i=e[0],a=e[1],c=e[2],p=i*i+a*a+c*c;return p>0&&(p=1/Math.sqrt(p)),n[0]=e[0]*p,n[1]=e[1]*p,n[2]=e[2]*p,n}function Rt(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function _i(n,e,i){var a=e[0],c=e[1],p=e[2],m=i[0],v=i[1],T=i[2];return n[0]=c*T-p*v,n[1]=p*m-a*T,n[2]=a*v-c*m,n}function Oi(n,e,i,a){var c=e[0],p=e[1],m=e[2];return n[0]=c+a*(i[0]-c),n[1]=p+a*(i[1]-p),n[2]=m+a*(i[2]-m),n}function ei(n,e,i){var a=e[0],c=e[1],p=e[2],m=i[3]*a+i[7]*c+i[11]*p+i[15];return n[0]=(i[0]*a+i[4]*c+i[8]*p+i[12])/(m=m||1),n[1]=(i[1]*a+i[5]*c+i[9]*p+i[13])/m,n[2]=(i[2]*a+i[6]*c+i[10]*p+i[14])/m,n}function hn(n,e,i){var a=e[0],c=e[1],p=e[2];return n[0]=a*i[0]+c*i[3]+p*i[6],n[1]=a*i[1]+c*i[4]+p*i[7],n[2]=a*i[2]+c*i[5]+p*i[8],n}function In(n,e,i){var a=i[0],c=i[1],p=i[2],m=e[0],v=e[1],T=e[2],E=c*T-p*v,R=p*m-a*T,D=a*v-c*m,P=c*D-p*R,j=p*E-a*D,G=a*R-c*E,Z=2*i[3];return R*=Z,D*=Z,j*=2,G*=2,n[0]=m+(E*=Z)+(P*=2),n[1]=v+R+j,n[2]=T+D+G,n}function Rn(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var Qi=Qe,Zr=kt,Fn=Lt;function Qr(){var n=new B(4);return B!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function gs(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function No(n,e){var i=e[0],a=e[1],c=e[2],p=e[3],m=i*i+a*a+c*c+p*p;return m>0&&(m=1/Math.sqrt(m)),n[0]=i*m,n[1]=a*m,n[2]=c*m,n[3]=p*m,n}function Or(n,e,i){var a=e[0],c=e[1],p=e[2],m=e[3];return n[0]=i[0]*a+i[4]*c+i[8]*p+i[12]*m,n[1]=i[1]*a+i[5]*c+i[9]*p+i[13]*m,n[2]=i[2]*a+i[6]*c+i[10]*p+i[14]*m,n[3]=i[3]*a+i[7]*c+i[11]*p+i[15]*m,n}function Nr(){var n=new B(4);return B!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Jr(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Ao(n,e,i){i*=.5;var a=e[0],c=e[1],p=e[2],m=e[3],v=Math.sin(i),T=Math.cos(i);return n[0]=a*T+m*v,n[1]=c*T+p*v,n[2]=p*T-c*v,n[3]=m*T-a*v,n}function Ja(n,e,i){i*=.5;var a=e[0],c=e[1],p=e[2],m=e[3],v=Math.sin(i),T=Math.cos(i);return n[0]=a*T-p*v,n[1]=c*T+m*v,n[2]=p*T+a*v,n[3]=m*T-c*v,n}$e(),Qr();var Ns,hl,eo,Ur,ka,_s=No,Dl=(Ns=$e(),hl=ct(1,0,0),eo=ct(0,1,0),function(n,e,i){var a=Rt(e,i);return a<-.999999?(_i(Ns,hl,e),Fn(Ns)<1e-6&&_i(Ns,eo,e),at(Ns,Ns),function(c,p,m){m*=.5;var v=Math.sin(m);c[0]=v*p[0],c[1]=v*p[1],c[2]=v*p[2],c[3]=Math.cos(m)}(n,Ns,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(_i(Ns,e,i),n[0]=Ns[0],n[1]=Ns[1],n[2]=Ns[2],n[3]=1+a,_s(n,n))});function xs(){var n=new B(2);return B!=Float32Array&&(n[0]=0,n[1]=0),n}function aa(n,e){var i=new B(2);return i[0]=n,i[1]=e,i}function Na(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function bs(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function Os(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function oa(n){return Math.hypot(n[0],n[1])}function _a(n,e){var i=e[0],a=e[1],c=i*i+a*a;return c>0&&(c=1/Math.sqrt(c)),n[0]=e[0]*c,n[1]=e[1]*c,n}function On(n,e){return n[0]*e[0]+n[1]*e[1]}function ya(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}Nr(),Nr(),ie(),xs();var Co,Fs,dl=function(){if(ka)return Ur;function n(e,i,a,c){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=a,this.p2y=c}return ka=1,Ur=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,c=0;c<8;c++){var p=this.sampleCurveX(a)-e;if(Math.abs(p)<i)return a;var m=this.sampleCurveDerivativeX(a);if(Math.abs(m)<1e-6)break;a-=p/m}var v=0,T=1;for(a=e,c=0;c<20&&(p=this.sampleCurveX(a),!(Math.abs(p-e)<i));c++)e>p?v=a:T=a,a=.5*(T-v)+v;return a},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Ur}(),to=ya(dl);function Fa(){if(Fs)return Co;function n(e,i){this.x=e,this.y=i}return Fs=1,Co=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,a=e.y-this.y;return i*i+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),a=Math.sin(e),c=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=c,this},_rotateAround:function(e,i){var a=Math.cos(e),c=Math.sin(e),p=i.y+c*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-c*(this.y-i.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},Co}var Qt=ya(Fa());function io(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!io(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!io(n[i],e[i]))return!1;return!0}return n===e}const va=Math.PI/180,xa=180/Math.PI;function wn(n){return n*va}function nt(n){return n*xa}const ee=[[0,0],[1,0],[1,1],[0,1]];function ae(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function xe(n,e,i,a){const c=new to(n,e,i,a);return function(p){return c.solve(p)}}const ke=xe(.25,.1,.25,1);function Me(n,e,i){return Math.min(i,Math.max(e,n))}function He(n,e,i){return(i=Me((i-n)/(e-n),0,1))*i*(3-2*i)}function et(n,e,i){const a=i-e,c=((n-e)%a+a)%a+e;return c===e?i:c}function Ue(n,e,i){if(!n.length)return i(null,[]);let a=n.length;const c=new Array(n.length);let p=null;n.forEach((m,v)=>{e(m,(T,E)=>{T&&(p=T),c[v]=E,--a==0&&i(p,c)})})}function tt(n,...e){for(const i of e)for(const a in i)n[a]=i[a];return n}let vt=1;function rt(){return vt++}function Xt(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function pi(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function si(n,e,i){const a={};for(const c in n)a[c]=e.call(this,n[c],c,n);return a}function Bi(n,e,i){const a={};for(const c in n)e.call(this,n[c],c,n)&&(a[c]=n[c]);return a}function Ni(n){return Array.isArray(n)?n.map(Ni):typeof n=="object"&&n?si(n,Ni):n}function Vi(n,e){for(let i=0;i<n.length;i++)if(e.indexOf(n[i])>=0)return!0;return!1}const Ji={};function Yi(n){Ji[n]||(typeof console<"u"&&console.warn(n),Ji[n]=!0)}function Hn(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function ir(n){let e=0;for(let i,a,c=0,p=n.length,m=p-1;c<p;m=c++)i=n[c],a=n[m],e+=(a.x-i.x)*(i.y+a.y);return e}function Vn([n,e,i]){const a=wn(e+90),c=wn(i);return{x:n*Math.cos(a)*Math.sin(c),y:n*Math.sin(a)*Math.sin(c),z:n*Math.cos(c),azimuthal:e,polar:i}}function Mn(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Tn(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,c,p)=>{const m=c||p;return e[a]=!m||m.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Xn=null;function dr(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function fr(n,e,i,a){for(;e<i;){const c=e+i>>1;n[c]<a?e=c+1:i=c}return e}function Fr(n,e,i,a){for(;e<i;){const c=e+i>>1;n[c]<=a?e=c+1:i=c}return e}function Bs(n){return n>0?1/(1.001-n):1+n}function As(n){return n>0?1-1/(1.001-n):-n}function Ba(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const hs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!hs.API_URL)return null;try{const n=new URL(hs.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Cs(n){return hs.API_URL_REGEX.test(n)}function Pl(n){return hs.API_SPRITE_REGEX.test(n)}let fl,Fo,Ol,no,Bo,rs;function ja(){return fl==null&&(fl=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),fl}const ba={now:()=>no!==void 0?no:performance.now(),setNow(n){no=n},restoreNow(){no=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:a}=n;Bo||(Bo=document.createElement("canvas"));const c=Bo.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>Bo.width||a>Bo.height)&&(Bo.width=i,Bo.height=a),c.clearRect(-e,-e,i+2*e,a+2*e),c.drawImage(n,0,0,i,a),c.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:n=>(Fo||(Fo=document.createElement("a")),Fo.href=n,Fo.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ol==null&&(Ol=window.matchMedia("(prefers-reduced-motion: reduce)")),Ol.matches)},hasCanvasFingerprintNoise(){if(rs!==void 0)return rs;if(!ja())return rs=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let c=0;c<n.width;++c)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(c,0,1,1);const a=e.getImageData(0,0,n.width,n.height);i=0;for(let c=0;c<a.data.length;++c)if(c%4!=3&&i++!==a.data[c])return rs=!0,!0;return rs=!1,!1}};function Ys(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(n.slice(i));for(const c in e)a.set(c,e[c]);return`${n.slice(0,i)}?${a.toString()}`}function js(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const a=new URLSearchParams,c=new URLSearchParams(n.slice(i));for(const m of e.persistentParams){const v=c.get(m);v&&a.set(m,v)}const p=a.toString();return`${n.slice(0,i)}${p.length>0?`?${p}`:""}`}const po="mapbox-tiles";let wa=500,Ks=50;const hc=["language","worldview","jobid"];let ro,pl;function Va(){try{return caches}catch{}}function Ua(){const n=Va();n&&ro==null&&(ro=n.open(po))}let _u=1/0;const ot={supported:!1,testSupport:function(n){!Sn&&Si&&(qn?Qs(n):Ht=n)}};let Ht,Si,Sn=!1,qn=!1;const ys=typeof self<"u"?self:{};function Qs(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Si),n.isContextLost())return;ot.supported=!0}catch{}n.deleteTexture(e),Sn=!0}ys.document&&(Si=ys.document.createElement("img"),Si.onload=function(){Ht&&Qs(Ht),Ht=null,qn=!0},Si.onerror=function(){Sn=!0,Ht=null},Si.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Er={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Er);class en extends Error{constructor(e,i,a){i===401&&Cs(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ss=Mn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ga=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(ss())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,c){const p=new AbortController,m=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:ss(),referrerPolicy:a.referrerPolicy,signal:p.signal});let v=!1,T=!1;const E=(R=m.url).indexOf("sku=")>0&&Cs(R);var R;a.type==="json"&&m.headers.set("Accept","application/json");const D=(j,G,Z)=>{if(T)return;if(j&&j.message!=="SecurityError"&&Yi(j.toString()),G&&Z)return P(G);const K=Date.now();fetch(m).then(te=>{if(te.ok){const ce=E?te.clone():null;return P(te,ce,K)}return c(new en(te.statusText,te.status,a.url))}).catch(te=>{te.name!=="AbortError"&&c(new Error(`${te.message} ${a.url}`))})},P=(j,G,Z)=>{(a.type==="arrayBuffer"?j.arrayBuffer():a.type==="json"?j.json():j.text()).then(K=>{T||(G&&Z&&function(te,ce,he){if(Ua(),ro==null)return;const Y=Tn(ce.headers.get("Cache-Control")||"");if(Y["no-store"])return;const le={status:ce.status,statusText:ce.statusText,headers:new Headers};ce.headers.forEach((Fe,ze)=>le.headers.set(ze,Fe)),Y["max-age"]&&le.headers.set("Expires",new Date(he+1e3*Y["max-age"]).toUTCString());const de=le.headers.get("Expires");if(!de||new Date(de).getTime()-he<42e4)return;let be=js(te.url,{persistentParams:hc});if(ce.status===206){const Fe=te.headers.get("Range");if(!Fe)return;le.status=200,be=Ys(be,{range:Fe})}(function(Fe,ze){if(pl===void 0)try{new Response(new ReadableStream),pl=!0}catch{pl=!1}pl?ze(Fe.body):Fe.blob().then(ze).catch(Be=>Yi(Be.message))})(ce,Fe=>{const ze=new Response((Be=ce.status)!==200&&Be!==404&&[101,103,204,205,304].includes(Be)?null:Fe,le);var Be;Ua(),ro?.then(We=>We.put(be,ze)).catch(We=>Yi(We.message))})}(m,G,Z),v=!0,c(null,K,j.headers.get("Cache-Control"),j.headers.get("Expires")))}).catch(K=>{T||c(new Error(K.message))})};return E?function(j,G){if(Ua(),ro==null)return G(null);ro.then(Z=>{let K=js(j.url,{persistentParams:hc});const te=j.headers.get("Range");te&&(K=Ys(K,{range:te})),Z.match(K).then(ce=>{const he=function(Y){if(!Y)return!1;const le=new Date(Y.headers.get("Expires")||0),de=Tn(Y.headers.get("Cache-Control")||"");return Number(le)>Date.now()&&!de["no-cache"]}(ce);Z.delete(K).catch(G),he&&Z.put(K,ce.clone()).catch(G),G(null,ce,he)}).catch(G)}).catch(G)}(m,D):D(null,null),{cancel:()=>{T=!0,v||p.abort()}}}(n,e);if(Mn(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(a,c){const p=new XMLHttpRequest;p.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in a.headers)p.setRequestHeader(m,a.headers[m]);return a.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=a.credentials==="include",p.onerror=()=>{c(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(a.type==="json")try{m=JSON.parse(p.response)}catch(v){return c(v)}c(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else c(new en(p.statusText,p.status,a.url))},p.send(a.body),{cancel:()=>p.abort()}}(n,e)},ds=function(n,e){return Ga(tt(n,{type:"arrayBuffer"}),e)};function mo(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const ml="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ta,Sa;Ta=[],Sa=0;const jo=function(n,e){if(ot.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Sa>=hs.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ta.push(p),p}Sa++;let i=!1;const a=()=>{if(!i)for(i=!0,Sa--;Ta.length&&Sa<hs.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Ta.shift(),{requestParameters:m,callback:v,cancelled:T}=p;T||(p.cancel=jo(m,v).cancel)}},c=ds(n,(p,m,v,T)=>{a(),p?e(p):m&&(self.createImageBitmap?function(E,R){const D=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(D).then(P=>{R(null,P)}).catch(P=>{R(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(E,R)=>e(E,R,v,T)):function(E,R){const D=new Image;D.onload=()=>{R(null,D),URL.revokeObjectURL(D.src),D.onload=null,requestAnimationFrame(()=>{D.src=ml})},D.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(E)],{type:"image/png"});D.src=E.byteLength?URL.createObjectURL(P):ml}(m,(E,R)=>e(E,R,v,T)))});return{cancel:()=>{c.cancel(),a()}}};var so,Ha,Js,Gs={exports:{}},Vo={exports:{}},qe={exports:{}},Tt=function(){if(Js)return Gs.exports;Js=1;var n=(so||(so=1,Vo.exports=function(i,a){var c,p,m,v,T,E,R,D;for(p=i.length-(c=3&i.length),m=a,T=3432918353,E=461845907,D=0;D<p;)R=255&i.charCodeAt(D)|(255&i.charCodeAt(++D))<<8|(255&i.charCodeAt(++D))<<16|(255&i.charCodeAt(++D))<<24,++D,m=27492+(65535&(v=5*(65535&(m=(m^=R=(65535&(R=(R=(65535&R)*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*E+(((R>>>16)*E&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(R=0,c){case 3:R^=(255&i.charCodeAt(D+2))<<16;case 2:R^=(255&i.charCodeAt(D+1))<<8;case 1:m^=R=(65535&(R=(R=(65535&(R^=255&i.charCodeAt(D)))*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*E+(((R>>>16)*E&65535)<<16)&4294967295}return m^=i.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),Vo.exports),e=(Ha||(Ha=1,qe.exports=function(i,a){for(var c,p=i.length,m=a^p,v=0;p>=4;)c=1540483477*(65535&(c=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:m^=(255&i.charCodeAt(v+2))<<16;case 2:m^=(255&i.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&i.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),qe.exports);return Gs.exports=n,Gs.exports.murmur3=n,Gs.exports.murmur2=e,Gs.exports}(),vi=ya(Tt);class Zi{constructor(e,...i){tt(this,i[0]||{}),this.type=e}}class Rr extends Zi{constructor(e,i={}){super("error",tt({error:e},i))}}function Bn(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function es(n,e,i){if(i&&i[n]){const a=i[n].indexOf(e);a!==-1&&i[n].splice(a,1)}}class fs{on(e,i){return this._listeners=this._listeners||{},Bn(e,i,this._listeners),this}off(e,i){return es(e,i,this._listeners),es(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Bn(e,i,this._oneTimeListeners),this):new Promise(a=>{this.once(e,a)})}fire(e,i){const a=typeof e=="string"?new Zi(e,i):e,c=a.type;if(this.listens(c)){a.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const T of p)T.call(this,a);const m=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const T of m)es(c,T,this._oneTimeListeners),T.call(this,a);const v=this._eventedParent;v&&(tt(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(a))}else a instanceof Rr&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Br{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Br(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,a]=e.split("");return new Br({name:i,iconsetId:a})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Br.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var as,Ls={},ea=function(){if(as)return Ls;as=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(p){return(p=Math.round(p))<0?0:p>255?255:p}function i(p){return e(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function a(p){return(m=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:m>1?1:m;var m}function c(p,m,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?p+(m-p)*v*6:2*v<1?m:3*v<2?p+(m-p)*(2/3-v)*6:p}try{Ls.parseCSSColor=function(p){var m,v=p.replace(/ /g,"").toLowerCase();if(v in n)return n[v].slice();if(v[0]==="#")return v.length===4?(m=parseInt(v.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:v.length===7&&(m=parseInt(v.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var T=v.indexOf("("),E=v.indexOf(")");if(T!==-1&&E+1===v.length){var R=v.substr(0,T),D=v.substr(T+1,E-(T+1)).split(","),P=1;switch(R){case"rgba":if(D.length!==4)return null;P=a(D.pop());case"rgb":return D.length!==3?null:[i(D[0]),i(D[1]),i(D[2]),P];case"hsla":if(D.length!==4)return null;P=a(D.pop());case"hsl":if(D.length!==3)return null;var j=(parseFloat(D[0])%360+360)%360/360,G=a(D[1]),Z=a(D[2]),K=Z<=.5?Z*(G+1):Z+G-Z*G,te=2*Z-K;return[e(255*c(te,K,j+1/3)),e(255*c(te,K,j)),e(255*c(te,K,j-1/3)),P];default:return null}}return null}}catch{}return Ls}();class ln{constructor(e,i,a,c=1){this.r=e,this.g=i,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof ln)return e;if(typeof e!="string")return;const i=ea.parseCSSColor(e);return i?new ln(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,a,c]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*a)},${c})`}toNonPremultipliedRenderColor(e){const{r:i,g:a,b:c,a:p}=this;return new go(e,i,a,c,p)}toPremultipliedRenderColor(e){const{r:i,g:a,b:c,a:p}=this;return new Uo(e,i*p,a*p,c*p,p)}clone(){return new ln(this.r,this.g,this.b,this.a)}}class ws{constructor(e,i,a,c,p,m=!1){if(this.premultiplied=!1,this.premultiplied=m,e){const v=e.image.height,T=v*v;this.premultiplied?(i=p===0?0:i/p*(v-1),a=p===0?0:a/p*(v-1),c=p===0?0:c/p*(v-1)):(i*=v-1,a*=v-1,c*=v-1);const E=Math.floor(i),R=Math.floor(a),D=Math.floor(c),P=Math.ceil(i),j=Math.ceil(a),G=Math.ceil(c),Z=i-E,K=a-R,te=c-D,ce=e.image.data,he=4*(E+R*T+D*v),Y=4*(E+R*T+G*v),le=4*(E+j*T+D*v),de=4*(E+j*T+G*v),be=4*(P+R*T+D*v),Fe=4*(P+R*T+G*v),ze=4*(P+j*T+D*v),Be=4*(P+j*T+G*v);if(he<0||Be>=ce.length)throw new Error("out of range");this.r=zi(zi(zi(ce[he],ce[Y],te),zi(ce[le],ce[de],te),K),zi(zi(ce[be],ce[Fe],te),zi(ce[ze],ce[Be],te),K),Z)/255*(this.premultiplied?p:1),this.g=zi(zi(zi(ce[he+1],ce[Y+1],te),zi(ce[le+1],ce[de+1],te),K),zi(zi(ce[be+1],ce[Fe+1],te),zi(ce[ze+1],ce[Be+1],te),K),Z)/255*(this.premultiplied?p:1),this.b=zi(zi(zi(ce[he+2],ce[Y+2],te),zi(ce[le+2],ce[de+2],te),K),zi(zi(ce[be+2],ce[Fe+2],te),zi(ce[ze+2],ce[Be+2],te),K),Z)/255*(this.premultiplied?p:1),this.a=p}else this.r=i,this.g=a,this.b=c,this.a=p}toArray(){const{r:e,g:i,b:a,a:c}=this;return[255*e,255*i,255*a,c]}toHslaArray(){let{r:e,g:i,b:a,a:c}=this;if(this.premultiplied){if(c===0)return[0,0,0,0];e/=c,i/=c,a/=c}const p=Math.min(Math.max(e,0),1),m=Math.min(Math.max(i,0),1),v=Math.min(Math.max(a,0),1),T=Math.min(p,m,v),E=Math.max(p,m,v),R=(T+E)/2;if(T===E)return[0,0,100*R,c];const D=E-T,P=R>.5?D/(2-E-T):D/(E+T);let j=0;return E===p?j=(m-v)/D+(m<v?6:0):E===m?j=(v-p)/D+2:E===v&&(j=(p-m)/D+4),j*=60,[Math.min(Math.max(j,0),360),Math.min(Math.max(100*P,0),100),Math.min(Math.max(100*R,0),100),c]}toArray01(){const{r:e,g:i,b:a,a:c}=this;return[e,i,a,c]}toArray01Scaled(e){const{r:i,g:a,b:c}=this;return[i*e,a*e,c*e]}toArray01Linear(){const{r:e,g:i,b:a,a:c}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(a,2.2),c]}}class go extends ws{constructor(e,i,a,c,p){super(e,i,a,c,p,!1)}}class Uo extends ws{constructor(e,i,a,c,p){super(e,i,a,c,p,!0)}}function zi(n,e,i){return n*(1-i)+e*i}function Go(n,e,i){return n.map((a,c)=>zi(a,e[c],i))}ln.black=new ln(0,0,0,1),ln.white=new ln(1,1,1,1),ln.transparent=new ln(0,0,0,0),ln.red=new ln(1,0,0,1),ln.blue=new ln(0,0,1,1);var Fc=Object.freeze({__proto__:null,array:Go,color:function(n,e,i){return new ln(zi(n.r,e.r,i),zi(n.g,e.g,i),zi(n.b,e.b,i),zi(n.a,e.a,i))},number:zi});function Ho(n,...e){for(const i of e)for(const a in i)n[a]=i[a];return n}class la extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class nd{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,c]of i)this.bindings[a]=c}concat(e){return new nd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const nh={kind:"null"},Di={kind:"number"},Yn={kind:"string"},Un={kind:"boolean"},_o={kind:"color"},dc={kind:"object"},$n={kind:"value"},df={kind:"collator"},rd={kind:"formatted"},sd={kind:"resolvedImage"};function qa(n,e){return{kind:"array",itemType:n,N:e}}function Ts(n){if(n.kind==="array"){const e=Ts(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Bg=[nh,Di,Yn,Un,_o,rd,dc,qa($n),sd];function Bc(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Bc(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Bg)if(!Bc(i,e))return null}}return`Expected ${Ts(n)} but found ${Ts(e)} instead.`}function qo(n,e){return e.some(i=>i.kind===n.kind)}function ad(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function od(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&od(n.itemType,e.itemType):n.kind===e.kind}class rh{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ld{constructor(e,i,a,c,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=c,this.textColor=p}}class Ea{constructor(e){this.sections=e}static fromString(e){return new Ea([new ld(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Ea?e:Ea.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const c=i.image.getPrimary().id.toString();e.push(["image",c]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(a)}return e}}class Ll{constructor(e,i={}){if(this.id=Br.from(e),this.options=Object.assign({},i),i.transform){const{a,b:c,c:p,d:m,e:v,f:T}=i.transform;this.options.transform=new DOMMatrix([a,c,p,m,v,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:a,d:c,e:p,f:m}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:a,d:c,e:p,f:m}})}static parse(e){let i,a,c,p;try{({name:i,iconsetId:a,params:c,transform:p}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:m,b:v,c:T,d:E,e:R,f:D}=p||{};return new Ll({name:i,iconsetId:a},{params:c,transform:new DOMMatrix([m,v,T,E,R,D])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class Hs{constructor(e,i,a,c,p=!1){this.primaryId=Br.from(e),this.primaryOptions=i,a&&(this.secondaryId=Br.from(a)),this.secondaryOptions=c,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ll(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ll(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Hs.build({name:e}):e}static build(e,i,a,c){return!e||typeof e=="object"&&!("name"in e)?null:new Hs(e,a,i,c)}}function yu(n,e,i,a){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,e,i,a]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cn(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof ln||n instanceof rh||n instanceof Ea||n instanceof Hs)return!0;if(Array.isArray(n)){for(const e of n)if(!cn(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!cn(n[e]))return!1;return!0}return!1}function yi(n){if(n===null)return nh;if(typeof n=="string")return Yn;if(typeof n=="boolean")return Un;if(typeof n=="number")return Di;if(n instanceof ln)return _o;if(n instanceof rh)return df;if(n instanceof Ea)return rd;if(n instanceof Hs)return sd;if(Array.isArray(n)){const e=n.length;let i;for(const a of n){const c=yi(a);if(i){if(i===c)continue;i=$n;break}i=c}return qa(i||$n,e)}return dc}function Mo(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Ea||n instanceof Hs||n instanceof ln?n.toString():JSON.stringify(n)}class qi{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!cn(e[1]))return i.error("invalid value");const a=e[1];let c=yi(a);const p=i.expectedType;return c.kind!=="array"||c.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(c=p),new qi(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ln?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ea?this.value.serialize():this.value}}class Wr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const fc={string:Yn,number:Di,boolean:Un,object:dc};class Fi{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,c=1;const p=e[0];if(p==="array"){let v,T;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in fc)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=fc[E],c++}else v=$n;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);T=e[2],c++}a=qa(v,T)}else a=fc[p];const m=[];for(;c<e.length;c++){const v=i.parse(e[c],c,$n);if(!v)return null;m.push(v)}return new Fi(a,m)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!Bc(this.type,yi(a)))return a;if(i===this.args.length-1)throw new Wr(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Ts(yi(a))} but was expected to be of type ${Ts(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(a=>a.serialize()))}}class pc{constructor(e){this.type=rd,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const c=[];let p=!1;for(let m=1;m<=e.length-1;++m){const v=e[m];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let T=null;if(v["font-scale"]&&(T=i.parseObjectValue(v["font-scale"],m,"font-scale",Di),!T))return null;let E=null;if(v["text-font"]&&(E=i.parseObjectValue(v["text-font"],m,"text-font",qa(Yn)),!E))return null;let R=null;if(v["text-color"]&&(R=i.parseObjectValue(v["text-color"],m,"text-color",_o),!R))return null;const D=c[c.length-1];D.scale=T,D.font=E,D.textColor=R}else{const T=i.parse(e[m],m,$n);if(!T)return null;const E=T.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,c.push({content:T,scale:null,font:null,textColor:null})}}return new pc(c)}evaluate(e){return new Ea(this.sections.map(i=>{const a=i.content.evaluate(e);return od(yi(a),sd)?new ld("",a,null,null,null):new ld(Mo(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class vu{constructor(e,i,a,c){this._imageWarnHistory={},this.type=sd,this.namePrimary=e,this.nameSecondary=i,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),c&&(this.paramsSecondary=c.params,this.iconsetIdSecondary=c.iconset?c.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let a=1;const c=[];function p(){if(a<e.length){const v=i.parse(e[a],a++,Yn);return v?(c.push({image:v,options:{}}),!0):(i.error(c.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function m(){if(a<e.length){const T=e[a];if((v=T)===null||typeof v!="object"||Array.isArray(v))return!0;const E=T.params,R=T.iconset,D=i.concat(a);if(!E&&!R)return a++,!0;if(E){if(typeof E!="object"||E.constructor!==Object)return D.error('Image options "params" should be an object'),!1;const P={},j=D.concat(void 0,"params");for(const G in E){if(!G)return j.error("Image parameter name should be non-empty"),!1;const Z=j.concat(void 0,G).parse(E[G],void 0,_o,void 0,{typeAnnotation:"coerce"});if(!Z)return!1;P[G]=Z}c[c.length-1].options.params=P}if(R){if(typeof R!="object"||R.constructor!==Object)return D.error('Image options "iconset" should be an object'),!1;if(!R.id)return D.error('Image options "iconset" should have an "id" property'),!1;c[c.length-1].options.iconset=R}return a++,!0}var v;return!0}for(let v=0;v<2;v++)if(!p()||!m())return;return new vu(c[0].image,c[1]?c[1].image:void 0,c[0].options,c[1]?c[1].options:void 0)}evaluateParams(e,i){const a={};if(i){for(const c in i)if(i[c])try{a[c]=i[c].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,c=Hs.build(i,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(c&&e.availableImages){const p=c.getPrimary().id;if(c.available=e.availableImages.some(m=>Br.isEqual(m,p)),c.available){const m=c.getSecondary()?c.getSecondary().id:null;m&&(c.available=e.availableImages.some(v=>Br.isEqual(v,m)))}}return c}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const a={};if(i&&(a.iconset={id:i}),e){a.params={};for(const c in e)e[c]&&(a.params[c]=e[c].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function mc(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}const ff={"to-boolean":Un,"to-color":_o,"to-number":Di,"to-string":Yn};class yo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0],c=[];let p=nh;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);p=qa(i.expectedType.itemType,m)}else{if(!(m>0&&cn(e[1][0])))return null;p=qa(yi(e[1][0]),m)}for(let v=0;v<m;v++){const T=e[1][v];let E;if(mc(T)==="array")E=i.parse(T,void 0,p.itemType);else{const R=mc(T);if(R!==p.itemType.kind)return i.error(`Expected ${p.itemType.kind} but found ${R}.`);E=i.registry.literal.parse(["literal",T===void 0?null:T],i)}if(!E)return null;c.push(E)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");p=ff[a];for(let m=1;m<e.length;m++){const v=i.parse(e[m],m,$n);if(!v)return null;c.push(v)}}return new yo(p,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,a;for(const c of this.args){if(i=c.evaluate(e),a=null,i instanceof ln)return i;if(typeof i=="string"){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:yu(i[0],i[1],i[2],i[3]),!a))return new ln(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Wr(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new Wr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Ea.fromString(Mo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Hs.build(Mo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Mo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new pc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new vu(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Aa=["Unknown","Point","LineString","Polygon"];class sh{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Aa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(c*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=ln.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Vs{constructor(e,i,a,c,p){this.name=e,this.type=i,this._evaluate=a,this.args=c,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const i=Vs.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const a=e[0],c=Vs.definitions[a];if(!c)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,v=[];let T=null,E=-1;for(const[R,D]of m){if(Array.isArray(R)&&R.length!==e.length-1)continue;v.push(R),E++,T=new md(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const P=[];let j=!1;for(let G=1;G<e.length;G++){const Z=e[G],K=Array.isArray(R)?R[G-1]:R.type,te=T.parse(Z,1+P.length,K);if(!te){j=!0;break}P.push(te)}if(!j)if(Array.isArray(R)&&R.length!==P.length)T.error(`Expected ${R.length} arguments, but found ${P.length} instead.`);else{for(let G=0;G<P.length;G++){const Z=Array.isArray(R)?R[G]:R.type,K=P[G];T.concat(G+1).checkSubtype(Z,K.type)}if(T.errors.length===0)return new Vs(a,p,D,P,E)}}if(v.length===1)i.errors.push(...T.errors);else{const R=(v.length?v:m.map(([P])=>P)).map(_p).join(" | "),D=[];for(let P=1;P<e.length;P++){const j=i.parse(e[P],1+D.length);if(!j)return null;D.push(Ts(j.type))}i.error(`Expected arguments of type ${R}, but found (${D.join(", ")}) instead.`)}return null}static register(e,i){Vs.definitions=i;for(const a in i)e[a]=Vs}}function _p(n){return Array.isArray(n)?`(${n.map(Ts).join(", ")})`:`(${Ts(n.type)}...)`}class zl{constructor(e,i,a){this.type=df,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const c=a["case-sensitive"]===void 0?i.parse(!1,1,Un):i.parseObjectValue(a["case-sensitive"],1,"case-sensitive",Un);if(!c)return null;const p=a["diacritic-sensitive"]===void 0?i.parse(!1,1,Un):i.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",Un);if(!p)return null;let m=null;return a.locale&&(m=i.parseObjectValue(a.locale,1,"locale",Yn),!m)?null:new zl(c,p,m)}evaluate(e){return new rh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Ca(n,e,i=0,a=n.length-1,c=jg){for(;a>i;){if(a-i>600){const T=a-i+1,E=e-i+1,R=Math.log(T),D=.5*Math.exp(2*R/3),P=.5*Math.sqrt(R*D*(T-D)/T)*(E-T/2<0?-1:1);Ca(n,e,Math.max(i,Math.floor(e-E*D/T+P)),Math.min(a,Math.floor(e+(T-E)*D/T+P)),c)}const p=n[e];let m=i,v=a;for(cd(n,i,e),c(n[a],p)>0&&cd(n,i,a);m<v;){for(cd(n,m,v),m++,v--;c(n[m],p)<0;)m++;for(;c(n[v],p)>0;)v--}c(n[i],p)===0?cd(n,i,v):(v++,cd(n,v,a)),v<=e&&(i=v+1),e<=v&&(a=v-1)}}function cd(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}function jg(n,e){return n<e?-1:n>e?1:0}function Io(n){let e=0;for(let i,a,c=0,p=n.length,m=p-1;c<p;m=c++)i=n[c],a=n[m],e+=(a.x-i.x)*(i.y+a.y);return e}function $o(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function xu(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function jc(n,e,i){const a=n[0]-e[0],c=n[1]-e[1],p=n[0]-i[0],m=n[1]-i[1];return a*m-p*c==0&&a*p<=0&&c*m<=0}function bu(n,e,i=!1){let a=!1;for(let v=0,T=e.length;v<T;v++){const E=e[v];for(let R=0,D=E.length,P=D-1;R<D;P=R++){const j=E[P],G=E[R];if(jc(n,j,G))return i;(p=j)[1]>(c=n)[1]!=(m=G)[1]>c[1]&&c[0]<(m[0]-p[0])*(c[1]-p[1])/(m[1]-p[1])+p[0]&&(a=!a)}}var c,p,m;return a}function yp(n,e,i,a){const c=a[0]-i[0],p=a[1]-i[1],m=(n[0]-i[0])*p-c*(n[1]-i[1]),v=(e[0]-i[0])*p-c*(e[1]-i[1]);return m>0&&v<0||m<0&&v>0}function ah(n,e,i,a){return(c=[a[0]-i[0],a[1]-i[1]])[0]*(p=[e[0]-n[0],e[1]-n[1]])[1]-c[1]*p[0]!=0&&!(!yp(n,e,i,a)||!yp(i,a,n,e));var c,p}function vp(n){const e=new Qt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Qt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const a of n[0])e.x>a.x&&(e.x=a.x),e.y>a.y&&(e.y=a.y),i.x<a.x&&(i.x=a.x),i.y<a.y&&(i.y=a.y);return{min:e,max:i}}const vo=8192;function xp(n,e){const i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*vo),Math.round(a*c*vo)]}function ud(n,e){for(let i=0;i<e.length;i++)if(bu(n,e[i]))return!0;return!1}function pf(n,e,i){for(const a of i)for(let c=0,p=a.length,m=p-1;c<p;m=c++)if(ah(n,e,a[m],a[c]))return!0;return!1}function bp(n,e){for(let i=0;i<n.length;++i)if(!bu(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(pf(n[i],n[i+1],e))return!1;return!0}function Ro(n,e){for(let i=0;i<e.length;i++)if(bp(n,e[i]))return!0;return!1}function Vc(n,e,i){const a=[];for(let c=0;c<n.length;c++){const p=[];for(let m=0;m<n[c].length;m++){const v=xp(n[c][m],i);$o(e,v),p.push(v)}a.push(p)}return a}function mf(n,e,i){const a=[];for(let c=0;c<n.length;c++){const p=Vc(n[c],e,i);a.push(p)}return a}function hd(n,e,i,a){if(n[0]<i[0]||n[0]>i[2]){const c=.5*a;let p=n[0]-i[0]>c?-a:i[0]-n[0]>c?a:0;p===0&&(p=n[0]-i[2]>c?-a:i[2]-n[0]>c?a:0),n[0]+=p}$o(e,n)}function gc(n,e,i,a){const c=Math.pow(2,a.z)*vo,p=[a.x*vo,a.y*vo],m=[];if(!n)return m;for(const v of n)for(const T of v){const E=[T.x+p[0],T.y+p[1]];hd(E,e,i,c),m.push(E)}return m}function gf(n,e,i,a){const c=Math.pow(2,a.z)*vo,p=[a.x*vo,a.y*vo],m=[];if(!n)return m;for(const T of n){const E=[];for(const R of T){const D=[R.x+p[0],R.y+p[1]];$o(e,D),E.push(D)}m.push(E)}if(e[2]-e[0]<=c/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const T of m)for(const E of T)hd(E,e,i,c)}var v;return m}class ca{constructor(e,i){this.type=Un,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(cn(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){const p=a.features[c].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new ca(a,a.features[c].geometry)}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ca(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new ca(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(a.type==="Polygon"){const v=Vc(a.coordinates,p,m),T=gc(i.geometry(),c,p,m);if(!xu(c,p))return!1;for(const E of T)if(!bu(E,v))return!1}if(a.type==="MultiPolygon"){const v=mf(a.coordinates,p,m),T=gc(i.geometry(),c,p,m);if(!xu(c,p))return!1;for(const E of T)if(!ud(E,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(a.type==="Polygon"){const v=Vc(a.coordinates,p,m),T=gf(i.geometry(),c,p,m);if(!xu(c,p))return!1;for(const E of T)if(!bp(E,v))return!1}if(a.type==="MultiPolygon"){const v=mf(a.coordinates,p,m),T=gf(i.geometry(),c,p,m);if(!xu(c,p))return!1;for(const E of T)if(!Ro(E,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const oh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},wp=1/298.257223563,Tp=wp*(2-wp),lh=Math.PI/180;class wu{static fromTile(e,i,a){const c=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),p=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/lh;return new wu(p,a)}static get units(){return oh}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!oh[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(oh).join(", ")}`);const a=6378.137*lh*(i?oh[i]:1),c=Math.cos(e*lh),p=1/(1-Tp*(1-c*c)),m=Math.sqrt(p);this.kx=a*m*c,this.ky=a*m*p*(1-Tp)}distance(e,i){const a=Ms(e[0]-i[0])*this.kx,c=(e[1]-i[1])*this.ky;return Math.sqrt(a*a+c*c)}bearing(e,i){const a=Ms(i[0]-e[0])*this.kx;return Math.atan2(a,(i[1]-e[1])*this.ky)/lh}destination(e,i,a){const c=a*lh;return this.offset(e,Math.sin(c)*i,Math.cos(c)*i)}offset(e,i,a){return[e[0]+i/this.kx,e[1]+a/this.ky]}lineDistance(e){let i=0;for(let a=0;a<e.length-1;a++)i+=this.distance(e[a],e[a+1]);return i}area(e){let i=0;for(let a=0;a<e.length;a++){const c=e[a];for(let p=0,m=c.length,v=m-1;p<m;v=p++)i+=Ms(c[p][0]-c[v][0])*(c[p][1]+c[v][1])*(a?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let a=0;if(i<=0)return e[0];for(let c=0;c<e.length-1;c++){const p=e[c],m=e[c+1],v=this.distance(p,m);if(a+=v,a>i)return ch(p,m,(i-(a-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,i,a){let[c,p]=i,m=Ms(a[0]-c)*this.kx,v=(a[1]-p)*this.ky;if(m!==0||v!==0){const T=(Ms(e[0]-c)*this.kx*m+(e[1]-p)*this.ky*v)/(m*m+v*v);T>1?(c=a[0],p=a[1]):T>0&&(c+=m/this.kx*T,p+=v/this.ky*T)}return m=Ms(e[0]-c)*this.kx,v=(e[1]-p)*this.ky,Math.sqrt(m*m+v*v)}pointOnLine(e,i){let a=1/0,c=e[0][0],p=e[0][1],m=0,v=0;for(let T=0;T<e.length-1;T++){let E=e[T][0],R=e[T][1],D=Ms(e[T+1][0]-E)*this.kx,P=(e[T+1][1]-R)*this.ky,j=0;D===0&&P===0||(j=(Ms(i[0]-E)*this.kx*D+(i[1]-R)*this.ky*P)/(D*D+P*P),j>1?(E=e[T+1][0],R=e[T+1][1]):j>0&&(E+=D/this.kx*j,R+=P/this.ky*j)),D=Ms(i[0]-E)*this.kx,P=(i[1]-R)*this.ky;const G=D*D+P*P;G<a&&(a=G,c=E,p=R,m=T,v=j)}return{point:[c,p],index:m,t:Math.max(0,Math.min(1,v))}}lineSlice(e,i,a){let c=this.pointOnLine(a,e),p=this.pointOnLine(a,i);if(c.index>p.index||c.index===p.index&&c.t>p.t){const E=c;c=p,p=E}const m=[c.point],v=c.index+1,T=p.index;!_f(a[v],m[0])&&v<=T&&m.push(a[v]);for(let E=v+1;E<=T;E++)m.push(a[E]);return _f(a[T],p.point)||m.push(p.point),m}lineSliceAlong(e,i,a){let c=0;const p=[];for(let m=0;m<a.length-1;m++){const v=a[m],T=a[m+1],E=this.distance(v,T);if(c+=E,c>e&&p.length===0&&p.push(ch(v,T,(e-(c-E))/E)),c>=i)return p.push(ch(v,T,(i-(c-E))/E)),p;c>e&&p.push(T)}return p}bufferPoint(e,i){const a=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-a,e[0]+c,e[1]+a]}bufferBBox(e,i){const a=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-a,e[2]+c,e[3]+a]}insideBBox(e,i){return Ms(e[0]-i[0])>=0&&Ms(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function _f(n,e){return n[0]===e[0]&&n[1]===e[1]}function ch(n,e,i){const a=Ms(e[0]-n[0]);return[n[0]+a*i,n[1]+(e[1]-n[1])*i]}function Ms(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class dd{constructor(e=[],i=(a,c)=>a<c?-1:a>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,c=i[e];for(;e>0;){const p=e-1>>1,m=i[p];if(a(c,m)>=0)break;i[e]=m,e=p}i[e]=c}_down(e){const{data:i,compare:a}=this,c=this.length>>1,p=i[e];for(;e<c;){let m=1+(e<<1);const v=m+1;if(v<this.length&&a(i[v],i[m])<0&&(m=v),a(i[m],p)>=0)break;i[e]=i[m],e=m}i[e]=p}}var Kt=8192;function xo(n,e){return e.dist-n.dist}const gl=100,Uc=50;function Gc(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function Hc(n){return n[1]-n[0]+1}function Zo(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function _c(n,e){if(n[0]>n[1])return[null,null];const i=Hc(n);if(e){if(i===2)return[n,null];const a=Math.floor(i/2);return[[n[0],n[0]+a],[n[0]+a,n[1]]]}{if(i===1)return[n,null];const a=Math.floor(i/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}}function Do(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!Zo(e,n.length))return i;for(let a=e[0];a<=e[1];++a)$o(i,n[a]);return i}function mn(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let a=0;a<n[i].length;++a)$o(e,n[i][a]);return e}function _l(n,e,i){if(Gc(n)||Gc(e))return NaN;let a=0,c=0;return n[2]<e[0]&&(a=e[0]-n[2]),n[0]>e[2]&&(a=n[0]-e[2]),n[1]>e[3]&&(c=n[1]-e[3]),n[3]<e[1]&&(c=e[1]-n[3]),i.distance([0,0],[a,c])}function Vg(n){return 360*n-180}function Po(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function uh(n,e){const i=Math.pow(2,e.z),a=(n.y/Kt+e.y)/i;return[Vg((n.x/Kt+e.x)/i),Po(a)]}function yc(n,e){const i=[];for(let a=0;a<n.length;++a)i.push(uh(n[a],e));return i}function Dr(n,e,i){const a=i.pointOnLine(e,n).point;return i.distance(n,a)}function fd(n,e,i,a,c){const p=i.slice(a[0],a[1]+1);let m=1/0;for(let v=e[0];v<=e[1];++v)if((m=Math.min(m,Dr(n[v],p,c)))===0)return 0;return m}function vc(n,e,i,a,c){const p=Math.min(c.pointToSegmentDistance(n,i,a),c.pointToSegmentDistance(e,i,a)),m=Math.min(c.pointToSegmentDistance(i,n,e),c.pointToSegmentDistance(a,n,e));return Math.min(p,m)}function Sp(n,e,i,a,c){if(!Zo(e,n.length)||!Zo(a,i.length))return NaN;let p=1/0;for(let m=e[0];m<e[1];++m)for(let v=a[0];v<a[1];++v){if(ah(n[m],n[m+1],i[v],i[v+1]))return 0;p=Math.min(p,vc(n[m],n[m+1],i[v],i[v+1],c))}return p}function Ep(n,e,i,a,c){if(!Zo(e,n.length)||!Zo(a,i.length))return NaN;let p=1/0;for(let m=e[0];m<=e[1];++m)for(let v=a[0];v<=a[1];++v)if((p=Math.min(p,c.distance(n[m],i[v])))===0)return p;return p}function hh(n,e,i){if(bu(n,e,!0))return 0;let a=1/0;for(const c of e){const p=c.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[p-1]&&(a=Math.min(a,i.pointToSegmentDistance(n,c[p-1],c[0])))===0||(a=Math.min(a,Dr(n,c,i)))===0)return a}return a}function dh(n,e,i,a){if(!Zo(e,n.length))return NaN;for(let p=e[0];p<=e[1];++p)if(bu(n[p],i,!0))return 0;let c=1/0;for(let p=e[0];p<e[1];++p)for(const m of i)for(let v=0,T=m.length,E=T-1;v<T;E=v++){if(ah(n[p],n[p+1],m[E],m[v]))return 0;c=Math.min(c,vc(n[p],n[p+1],m[E],m[v],a))}return c}function pd(n,e){for(const i of n)for(let a=0;a<=i.length-1;++a)if(bu(i[a],e,!0))return!0;return!1}function yf(n,e,i,a=1/0){const c=mn(n),p=mn(e);if(a!==1/0&&_l(c,p,i)>=a)return a;if(xu(c,p)){if(pd(n,e))return 0}else if(pd(e,n))return 0;let m=a;for(const v of n)for(let T=0,E=v.length,R=E-1;T<E;R=T++)for(const D of e)for(let P=0,j=D.length,G=j-1;P<j;G=P++){if(ah(v[R],v[T],D[G],D[P]))return 0;m=Math.min(m,vc(v[R],v[T],D[G],D[P],i))}return m}function ao(n,e,i,a,c,p,m){if(p===null||m===null)return;const v=_l(Do(a,p),Do(c,m),i);v<e&&n.push({dist:v,range1:p,range2:m})}function Wo(n,e,i,a,c=1/0){let p=Math.min(a.distance(n[0],i[0][0]),c);if(p===0)return p;const m=new dd([{dist:0,range1:[0,n.length-1],range2:[0,0]}],xo),v=e?Uc:gl,T=mn(i);for(;m.length;){const E=m.pop();if(E.dist>=p)continue;const R=E.range1;if(Hc(R)<=v){if(!Zo(R,n.length))return NaN;if(e){const D=dh(n,R,i,a);if((p=Math.min(p,D))===0)return p}else for(let D=R[0];D<=R[1];++D){const P=hh(n[D],i,a);if((p=Math.min(p,P))===0)return p}}else{const D=_c(R,e);if(D[0]!==null){const P=_l(Do(n,D[0]),T,a);P<p&&m.push({dist:P,range1:D[0],range2:[0,0]})}if(D[1]!==null){const P=_l(Do(n,D[1]),T,a);P<p&&m.push({dist:P,range1:D[1],range2:[0,0]})}}}return p}function qc(n,e,i,a,c,p=1/0){let m=Math.min(p,c.distance(n[0],i[0]));if(m===0)return m;const v=new dd([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],xo),T=e?Uc:gl,E=a?Uc:gl;for(;v.length;){const R=v.pop();if(R.dist>=m)continue;const D=R.range1,P=R.range2;if(Hc(D)<=T&&Hc(P)<=E){if(!Zo(D,n.length)||!Zo(P,i.length))return NaN;if(e&&a?m=Math.min(m,Sp(n,D,i,P,c)):e||a?e&&!a?m=Math.min(m,fd(i,P,n,D,c)):!e&&a&&(m=Math.min(m,fd(n,D,i,P,c))):m=Math.min(m,Ep(n,D,i,P,c)),m===0)return m}else{const j=_c(D,e),G=_c(P,a);ao(v,m,c,n,i,j[0],G[0]),ao(v,m,c,n,i,j[0],G[1]),ao(v,m,c,n,i,j[1],G[0]),ao(v,m,c,n,i,j[1],G[1])}}return m}function yl(n,e,i,a,c=1/0){let p=c;const m=Do(n,[0,n.length-1]);for(const v of i)if(!(p!==1/0&&_l(m,Do(v,[0,v.length-1]),a)>=p)&&(p=Math.min(p,qc(n,e,v,!0,a,p)),p===0))return p;return p}function Xo(n,e,i,a,c=1/0){let p=c;const m=Do(n,[0,n.length-1]);for(const v of i){if(p!==1/0&&_l(m,mn(v),a)>=p)continue;const T=Wo(n,e,v,a,p);if(isNaN(T))return T;if((p=Math.min(p,T))===0)return p}return p}function xc(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class $c{constructor(e,i){this.type=Di,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(cn(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let c=0;c<a.features.length;++c)if(xc(a.features[c].geometry.type))return new $c(a,a.features[c].geometry)}else if(a.type==="Feature"){if(xc(a.geometry.type))return new $c(a,a.geometry)}else if(xc(a.type))return new $c(a,a)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),a=e.canonicalID();if(i!=null&&a!=null){if(e.geometryType()==="Point")return function(c,p,m){const v=[];for(const E of c)for(const R of E)v.push(uh(R,p));const T=new wu(v[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?qc(v,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",T):m.type==="MultiLineString"?yl(v,!1,m.coordinates,T):m.type==="Polygon"||m.type==="MultiPolygon"?Xo(v,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,T):null}(i,a,this.geometries);if(e.geometryType()==="LineString")return function(c,p,m){const v=[];for(const E of c){const R=[];for(const D of E)R.push(uh(D,p));v.push(R)}const T=new wu(v[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return yl(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,T);if(m.type==="MultiLineString"){let E=1/0;for(let R=0;R<m.coordinates.length;R++){const D=yl(m.coordinates[R],!0,v,T,E);if(isNaN(D))return D;if((E=Math.min(E,D))===0)return E}return E}if(m.type==="Polygon"||m.type==="MultiPolygon"){let E=1/0;for(let R=0;R<v.length;R++){const D=Xo(v[R],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,T,E);if(isNaN(D))return D;if((E=Math.min(E,D))===0)return E}return E}return null}(i,a,this.geometries);if(e.geometryType()==="Polygon")return function(c,p,m){const v=[];for(const E of function(R,D){const P=R.length;if(P<=1)return[R];const j=[];let G,Z;for(let K=0;K<P;K++){const te=Io(R[K]);te!==0&&(R[K].area=Math.abs(te),Z===void 0&&(Z=te<0),Z===te<0?(G&&j.push(G),G=[R[K]]):G.push(R[K]))}return G&&j.push(G),j}(c)){const R=[];for(let D=0;D<E.length;++D)R.push(yc(E[D],p));v.push(R)}const T=new wu(v[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Xo(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,T);if(m.type==="MultiLineString"){let E=1/0;for(let R=0;R<m.coordinates.length;R++){const D=Xo(m.coordinates[R],!0,v,T,E);if(isNaN(D))return D;if((E=Math.min(E,D))===0)return E}return E}return m.type==="Polygon"||m.type==="MultiPolygon"?function(E,R,D){let P=1/0;for(const j of E)for(const G of R){const Z=yf(j,G,D,P);if(isNaN(Z))return Z;if((P=Math.min(P,Z))===0)return P}return P}(m.type==="Polygon"?[m.coordinates]:m.coordinates,v,T):null}(i,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Zc(n){if(n instanceof Vs&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof ca||n instanceof $c)return!1;if(n instanceof Wc)return n.featureConstant;let e=!0;return n.eachChild(i=>{e&&!Zc(i)&&(e=!1)}),e}function fh(n){if(n instanceof Vs&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!fh(i)&&(e=!1)}),e}function ua(n){if(n instanceof Wc)return new Set([n.key]);let e=new Set;return n.eachChild(i=>{e=new Set([...e,...ua(i)])}),e}function os(n,e){if(n instanceof Vs&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!os(a,e)&&(i=!1)}),i}function jr(n,e,i){return[n,e,i].filter(Boolean).join("")}function bc(n,e){switch(n){case"string":return Mo(e);case"number":return+e;case"boolean":return!!e;case"color":return ln.parse(e);case"formatted":return Ea.fromString(Mo(e));case"resolvedImage":return Hs.build(Mo(e))}return e}function vl(n,e,i,a){return a!==void 0&&(n=a*Math.round(n/a)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class Wc{constructor(e,i,a,c=!1){this.type=e,this.key=i,this.scope=a,this.featureConstant=c}static parse(e,i){let a=i.expectedType;if(a==null&&(a=$n),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const c=i.parse(e[1],1);if(!(c instanceof qi))return i.error("Key name of 'config' expression must be a string literal.");let p,m=!0;const v=Mo(c.value);if(e.length>=3){const T=i.parse(e[2],2);if(!(T instanceof qi))return i.error("Scope of 'config' expression must be a string literal.");p=Mo(T.value)}if(i.options){const T=jr(v,p,i._scope),E=i.options.get(T);E&&(m=Zc(E.value||E.default))}return new Wc(a,v,p,m)}evaluate(e){const i=jr(this.key,this.scope,e.scope),a=e.getConfig(i);if(!a)return null;const{type:c,value:p,values:m,minValue:v,maxValue:T,stepValue:E}=a,R=a.default.evaluate(e);let D=R;if(p){const P=e.scope;e.scope=(P||"").split("").slice(1).join(""),D=p.evaluate(e),e.scope=P}return c&&(D=bc(c,D)),D===void 0||v===void 0&&T===void 0&&E===void 0||(typeof D=="number"?D=vl(D,v,T,E):Array.isArray(D)&&(D=D.map(P=>typeof P=="number"?vl(P,v,T,E):P))),p!==void 0&&D!==void 0&&m&&!m.includes(D)&&(D=R,c&&(D=bc(c,D))),(c&&c!==this.type||D!==void 0&&!od(yi(D),this.type))&&(D=bc(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class kl{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new kl(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class md{constructor(e,i=[],a,c=new nd,p=[],m,v){this.registry=e,this.path=i,this.key=i.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=c,this.errors=p,this.expectedType=a,this._scope=m,this.options=v}parse(e,i,a,c,p={}){return i||a?this.concat(i,null,a,c)._parse(e,p):this._parse(e,p)}parseObjectValue(e,i,a,c,p,m={}){return this.concat(i,a,c,p)._parse(e,m)}_parse(e,i){function a(c,p,m){return m==="assert"?new Fi(p,[c]):m==="coerce"?new yo(p,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let p=c.parse(e,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,v=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else p=a(p,m,i.typeAnnotation||"coerce");else p=a(p,m,i.typeAnnotation||"assert")}if(!(p instanceof qi)&&p.type.kind!=="resolvedImage"&&vf(p)){const m=new sh(this._scope,this.options);try{p=new qi(p.type,p.evaluate(m))}catch(v){return this.error(v.message),null}}return p}return yo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a,c){let p=typeof e=="number"?this.path.concat(e):this.path;p=typeof i=="string"?p.concat(i):p;const m=c?this.scope.concat(c):this.scope;return new md(this.registry,p,a||null,m,this.errors,this._scope,this.options)}error(e,...i){const a=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new la(a,e))}checkSubtype(e,i){const a=Bc(e,i);return a&&this.error(a),a}}function vf(n){if(n instanceof kl)return vf(n.boundExpression);if(n instanceof Vs&&n.name==="error"||n instanceof zl||n instanceof ca||n instanceof $c||n instanceof Wc)return!1;const e=n instanceof yo||n instanceof Fi;let i=!0;return n.eachChild(a=>{i=e?i&&vf(a):i&&a instanceof qi}),!!i&&Zc(n)&&os(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Xc(n,e){const i=n.length-1;let a,c,p=0,m=i,v=0;for(;p<=m;)if(v=Math.floor((p+m)/2),a=n[v],c=n[v+1],a<=e){if(v===i||e<c)return v;p=v+1}else{if(!(a>e))throw new Wr("Input is not a number.");m=v-1}return 0}class wc{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,p]of a)this.labels.push(c),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,Di);if(!a)return null;const c=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let m=1;m<e.length;m+=2){const v=m===1?-1/0:e[m],T=e[m+1],E=m,R=m+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(c.length&&c[c.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const D=i.parse(T,R,p);if(!D)return null;p=p||D.type,c.push([v,D])}return new wc(p,a,c)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return a[0].evaluate(e);const p=i.length;return c>=i[p-1]?a[p-1].evaluate(e):a[Xc(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Ap=.95047,ph=1.08883,xf=4/29,bo=6/29,Nl=3*bo*bo,Tc=bo*bo*bo,Sc=Math.PI/180,Cp=180/Math.PI;function gd(n){return n>Tc?Math.pow(n,1/3):n/Nl+xf}function Yc(n){return n>bo?n*n*n:Nl*(n-xf)}function Tu(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function wo(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function ha(n){const e=wo(n.r),i=wo(n.g),a=wo(n.b),c=gd((.4124564*e+.3575761*i+.1804375*a)/Ap),p=gd((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*p-16,a:500*(c-p),b:200*(p-gd((.0193339*e+.119192*i+.9503041*a)/ph)),alpha:n.a}}function mh(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,a=isNaN(n.b)?e:e-n.b/200;return e=1*Yc(e),i=Ap*Yc(i),a=ph*Yc(a),new ln(Tu(3.2404542*i-1.5371385*e-.4985314*a),Tu(-.969266*i+1.8760108*e+.041556*a),Tu(.0556434*i-.2040259*e+1.0572252*a),n.alpha)}function Rm(n,e,i){const a=e-n;return n+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const Su={forward:ha,reverse:mh,interpolate:function(n,e,i){return{l:zi(n.l,e.l,i),a:zi(n.a,e.a,i),b:zi(n.b,e.b,i),alpha:zi(n.alpha,e.alpha,i)}}},Eu={forward:function(n){const{l:e,a:i,b:a}=ha(n),c=Math.atan2(a,i)*Cp;return{h:c<0?c+360:c,c:Math.sqrt(i*i+a*a),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Sc,i=n.c;return mh({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Rm(n.h,e.h,i),c:zi(n.c,e.c,i),l:zi(n.l,e.l,i),alpha:zi(n.alpha,e.alpha,i)}}};var Dm=Object.freeze({__proto__:null,hcl:Eu,lab:Su});class Gr{constructor(e,i,a,c,p){this.type=e,this.operator=i,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[m,v]of p)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(e,i,a,c){let p=0;if(e.name==="exponential")p=gh(i,e.base,a,c);else if(e.name==="linear")p=gh(i,1,a,c);else if(e.name==="cubic-bezier"){const m=e.controlPoints;p=new to(m[0],m[1],m[2],m[3]).solve(gh(i,1,a,c))}return p}static parse(e,i){let[a,c,p,...m]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const E=c[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:E}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const E=c.slice(1);if(E.length!==4||E.some(R=>typeof R!="number"||R<0||R>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,Di),!p)return null;const v=[];let T=null;a==="interpolate-hcl"||a==="interpolate-lab"?T=_o:i.expectedType&&i.expectedType.kind!=="value"&&(T=i.expectedType);for(let E=0;E<m.length;E+=2){const R=m[E],D=m[E+1],P=E+3,j=E+4;if(typeof R!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(v.length&&v[v.length-1][0]>=R)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const G=i.parse(D,j,T);if(!G)return null;T=T||G.type,v.push([R,G])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new Gr(T,a,c,p,v):i.error(`Type ${Ts(T)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return a[0].evaluate(e);const p=i.length;if(c>=i[p-1])return a[p-1].evaluate(e);const m=Xc(i,c),v=Gr.interpolationFactor(this.interpolation,c,i[m],i[m+1]),T=a[m].evaluate(e),E=a[m+1].evaluate(e);return this.operator==="interpolate"?Fc[this.type.kind.toLowerCase()](T,E,v):this.operator==="interpolate-hcl"?Eu.reverse(Eu.interpolate(Eu.forward(T),Eu.forward(E),v)):Su.reverse(Su.interpolate(Su.forward(T),Su.forward(E),v))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function gh(n,e,i,a){const c=a-i,p=n-i;return c===0?0:e===1?p/c:(Math.pow(e,p)-1)/(Math.pow(e,c)-1)}class Ec{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const c=i.expectedType;c&&c.kind!=="value"&&(a=c);const p=[];for(const v of e.slice(1)){const T=i.parse(v,1+p.length,a,void 0,{typeAnnotation:"omit"});if(!T)return null;a=a||T.type,p.push(T)}const m=c&&p.some(v=>Bc(c,v.type));return new Ec(m?$n:a,p)}evaluate(e){let i,a=null,c=0;for(const p of this.args){if(c++,a=p.evaluate(e),a&&a instanceof Hs&&!a.available&&(i||(i=a),a=null,c===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Kc{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let p=1;p<e.length-1;p+=2){const m=e[p];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=i.parse(e[p+1],p+1);if(!v)return null;a.push([m,v])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return c?new Kc(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class _d{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Di),c=i.parse(e[2],2,qa(i.expectedType||$n));return a&&c?new _d(c.type.itemType,a,c):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Wr(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Wr(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Wr(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Qc{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Di),c=i.parse(e[2],2,qa(i.expectedType||$n));return a&&c?new Qc(c.type.itemType,a,c):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Wr(`Array index out of bounds: ${i} < 0.`);if(i>a.length-1)throw new Wr(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i===Math.floor(i))return a[i];const c=Math.floor(i),p=Math.ceil(i),m=a[c],v=a[p];if(typeof m!="number"||typeof v!="number")throw new Wr(`Cannot interpolate between non-number values at index ${i}.`);const T=i-c;return m*(1-T)+v*T}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Ac{constructor(e,i){this.type=Un,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,$n),c=i.parse(e[2],2,$n);return a&&c?qo(a.type,[Un,Yn,Di,nh,$n])?new Ac(a,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ts(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!ad(i,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${Ts(yi(i))} instead.`);if(!ad(a,["string","array"]))throw new Wr(`Expected second argument to be of type array or string, but found ${Ts(yi(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class yd{constructor(e,i,a){this.type=Di,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,$n),c=i.parse(e[2],2,$n);if(!a||!c)return null;if(!qo(a.type,[Un,Yn,Di,nh,$n]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ts(a.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,Di);return p?new yd(a,c,p):null}return new yd(a,c)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!ad(i,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${Ts(yi(i))} instead.`);if(!ad(a,["string","array"]))throw new Wr(`Expected second argument to be of type array or string, but found ${Ts(yi(a))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return a.indexOf(i,c)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Au{constructor(e,i,a,c,p,m){this.inputType=e,this.type=i,this.input=a,this.cases=c,this.outputs=p,this.otherwise=m}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const p={},m=[];for(let E=2;E<e.length-1;E+=2){let R=e[E];const D=e[E+1];Array.isArray(R)||(R=[R]);const P=i.concat(E);if(R.length===0)return P.error("Expected at least one branch label.");for(const G of R){if(typeof G!="number"&&typeof G!="string")return P.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return P.error("Numeric branch labels must be integer values.");if(a){if(P.checkSubtype(a,yi(G)))return null}else a=yi(G);if(p[String(G)]!==void 0)return P.error("Branch labels must be unique.");p[String(G)]=m.length}const j=i.parse(D,E,c);if(!j)return null;c=c||j.type,m.push(j)}const v=i.parse(e[1],1,$n);if(!v)return null;const T=i.parse(e[e.length-1],e.length-1,c);return T?v.type.kind!=="value"&&i.concat(1).checkSubtype(a,v.type)?null:new Au(a,c,v,p,m,T):null}evaluate(e){const i=this.input.evaluate(e);return(od(yi(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],c={};for(const m of i){const v=c[this.cases[m]];v===void 0?(c[this.cases[m]]=a.length,a.push([this.cases[m],[m]])):a[v][1].push(m)}const p=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,v]of a)e.push(v.length===1?p(v[0]):v.map(p)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class Mp{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const c=[];for(let m=1;m<e.length-1;m+=2){const v=i.parse(e[m],m,Un);if(!v)return null;const T=i.parse(e[m+1],m+1,a);if(!T)return null;c.push([v,T]),a=a||T.type}const p=i.parse(e[e.length-1],e.length-1,a);return p?new Mp(a,c,p):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class _h{constructor(e,i,a,c){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,$n),c=i.parse(e[2],2,Di);if(!a||!c)return null;if(!qo(a.type,[qa($n),Yn,$n]))return i.error(`Expected first argument to be of type array or string, but found ${Ts(a.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,Di);return p?new _h(a.type,a,c,p):null}return new _h(a.type,a,c)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!ad(i,["string","array"]))throw new Wr(`Expected first argument to be of type array or string, but found ${Ts(yi(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(a,c)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Jc(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function bf(n,e,i,a){return a.compare(e,i)===0}function Fl(n,e,i){const a=n!=="=="&&n!=="!=";return class MA{constructor(p,m,v){this.type=Un,this.lhs=p,this.rhs=m,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const v=p[0];let T=m.parse(p[1],1,$n);if(!T)return null;if(!Jc(v,T.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${Ts(T.type)}'.`);let E=m.parse(p[2],2,$n);if(!E)return null;if(!Jc(v,E.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${Ts(E.type)}'.`);if(T.type.kind!==E.type.kind&&T.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${Ts(T.type)}' and '${Ts(E.type)}'.`);a&&(T.type.kind==="value"&&E.type.kind!=="value"?T=new Fi(E.type,[T]):T.type.kind!=="value"&&E.type.kind==="value"&&(E=new Fi(T.type,[E])));let R=null;if(p.length===4){if(T.type.kind!=="string"&&E.type.kind!=="string"&&T.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(R=m.parse(p[3],3,df),!R)return null}return new MA(T,E,R)}evaluate(p){const m=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(a&&this.hasUntypedArgument){const T=yi(m),E=yi(v);if(T.kind!==E.kind||T.kind!=="string"&&T.kind!=="number")throw new Wr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${T.kind}, ${E.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const T=yi(m),E=yi(v);if(T.kind!=="string"||E.kind!=="string")return e(p,m,v)}return this.collator?i(p,m,v,this.collator.evaluate(p)):e(p,m,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[n];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const Ip=Fl("==",function(n,e,i){return e===i},bf),vd=Fl("!=",function(n,e,i){return e!==i},function(n,e,i,a){return!bf(0,e,i,a)}),Pm=Fl("<",function(n,e,i){return e<i},function(n,e,i,a){return a.compare(e,i)<0}),wf=Fl(">",function(n,e,i){return e>i},function(n,e,i,a){return a.compare(e,i)>0}),yh=Fl("<=",function(n,e,i){return e<=i},function(n,e,i,a){return a.compare(e,i)<=0}),Om=Fl(">=",function(n,e,i){return e>=i},function(n,e,i,a){return a.compare(e,i)>=0});class Cu{constructor(e,i,a,c,p,m){this.type=Yn,this.number=e,this.locale=i,this.currency=a,this.unit=c,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,Di);if(!a)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let p=null;if(c.locale&&(p=i.parseObjectValue(c.locale,2,"locale",Yn),!p))return null;let m=null;if(c.currency&&(m=i.parseObjectValue(c.currency,2,"currency",Yn),!m))return null;let v=null;if(c.unit&&(v=i.parseObjectValue(c.unit,2,"unit",Yn),!v))return null;let T=null;if(c["min-fraction-digits"]&&(T=i.parseObjectValue(c["min-fraction-digits"],2,"min-fraction-digits",Di),!T))return null;let E=null;return c["max-fraction-digits"]&&(E=i.parseObjectValue(c["max-fraction-digits"],2,"max-fraction-digits",Di),!E)?null:new Cu(a,p,m,v,T,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Tf{constructor(e){this.type=Di,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Ts(a.type)} instead.`):new Tf(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Wr(`Expected value to be of type string or array, but found ${Ts(yi(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function vh(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const eu={"==":Ip,"!=":vd,">":wf,"<":Pm,">=":Om,"<=":yh,array:Fi,at:_d,"at-interpolated":Qc,boolean:Fi,case:Mp,coalesce:Ec,collator:zl,format:pc,image:vu,in:Ac,"index-of":yd,interpolate:Gr,"interpolate-hcl":Gr,"interpolate-lab":Gr,length:Tf,let:Kc,literal:qi,match:Au,number:Fi,"number-format":Cu,object:Fi,slice:_h,step:wc,string:Fi,"to-boolean":yo,"to-color":yo,"to-number":yo,"to-string":yo,var:kl,within:ca,distance:$c,config:Wc};function Sf(n,[e,i,a,c]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const p=c?c.evaluate(n):1,m=yu(e,i,a,p);if(m)throw new Wr(m);return new ln(e/255,i/255,a/255,p)}function Bl(n,[e,i,a,c]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const p=c?c.evaluate(n):1,m=function(E,R,D,P){return typeof E=="number"&&E>=0&&E<=360?typeof R=="number"&&R>=0&&R<=100&&typeof D=="number"&&D>=0&&D<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[E,R,D,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[E,R,D,P]:[E,R,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[E,R,D,P]:[E,R,D]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,a,p);if(m)throw new Wr(m);const v=`hsla(${e}, ${i}%, ${a}%, ${p})`,T=ln.parse(v);if(!T)throw new Wr(`Failed to parse HSLA color: ${v}`);return T}function Ef(n,e){return n in e}function jl(n,e){const i=e[n];return i===void 0?null:i}function To(n){return{type:n}}function Cc(n){return{result:"success",value:n}}function Yo(n){return{result:"error",value:n}}function xh(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function Mu(n){return n["property-type"]==="data-driven"}function Iu(n){return xh(n.expression,"measure-light")}function Ru(n){return xh(n.expression,"zoom")}function bh(n){return!!n.expression&&n.expression.interpolated}function wh(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Du(n){return n}function xd(n,e){const i=e.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",c=a||!(a||n.property!==void 0),p=n.type||(bh(e)?"exponential":"interval");if(i&&((n=Ho({},n)).stops&&(n.stops=n.stops.map(E=>[E[0],ln.parse(E[1])])),n.default=ln.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!Dm[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let m,v,T;if(p==="exponential")m=Vl;else if(p==="interval")m=Dp;else if(p==="categorical"){m=Rp,v=Object.create(null);for(const E of n.stops)v[E[0]]=E[1];T=typeof n.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=cr}if(a){const E={},R=[];for(let j=0;j<n.stops.length;j++){const G=n.stops[j],Z=G[0].zoom;E[Z]===void 0&&(E[Z]={zoom:Z,type:n.type,property:n.property,default:n.default,stops:[]},R.push(Z)),E[Z].stops.push([G[0].value,G[1]])}const D=[];for(const j of R)D.push([E[j].zoom,xd(E[j],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Gr.interpolationFactor.bind(void 0,P),zoomStops:D.map(j=>j[0]),evaluate:({zoom:j},G)=>Vl({stops:D,base:n.base},e,j).evaluate(j,G)}}if(c){const E=p==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Gr.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map(R=>R[0]),evaluate:({zoom:R})=>m(n,e,R,v,T)}}return{kind:"source",evaluate(E,R){const D=R&&R.properties?R.properties[n.property]:void 0;return D===void 0?Oo(n.default,e.default):m(n,e,D,v,T)}}}function Oo(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function Rp(n,e,i,a,c){return Oo(typeof i===c?a[i]:void 0,n.default,e.default)}function Dp(n,e,i){if(mc(i)!=="number")return Oo(n.default,e.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const c=Xc(n.stops.map(p=>p[0]),i);return n.stops[c][1]}function Vl(n,e,i){const a=n.base!==void 0?n.base:1;if(mc(i)!=="number")return Oo(n.default,e.default);const c=n.stops.length;if(c===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[c-1][0])return n.stops[c-1][1];const p=Xc(n.stops.map(R=>R[0]),i),m=function(R,D,P,j){const G=j-P,Z=R-P;return G===0?0:D===1?Z/G:(Math.pow(D,Z)-1)/(Math.pow(D,G)-1)}(i,a,n.stops[p][0],n.stops[p+1][0]),v=n.stops[p][1],T=n.stops[p+1][1];let E=Fc[e.type]||Du;if(n.colorSpace&&n.colorSpace!=="rgb"){const R=Dm[n.colorSpace];E=(D,P)=>R.reverse(R.interpolate(R.forward(D),R.forward(P),m))}return typeof v.evaluate=="function"?{evaluate(...R){const D=v.evaluate.apply(void 0,R),P=T.evaluate.apply(void 0,R);if(D!==void 0&&P!==void 0)return E(D,P,m)}}:E(v,T,m)}function cr(n,e,i){return e.type==="color"?i=ln.parse(i):e.type==="formatted"?i=Ea.fromString(i.toString()):e.type==="resolvedImage"?i=Hs.build(i.toString()):mc(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Oo(i,n.default,e.default)}Vs.register(eu,{error:[{kind:"error"},[Yn],(n,[e])=>{throw new Wr(e.evaluate(n))}],typeof:[Yn,[$n],(n,[e])=>Ts(yi(e.evaluate(n)))],"to-rgba":[qa(Di,4),[_o],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[qa(Di,4),[_o],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[_o,[Di,Di,Di],Sf],rgba:[_o,[Di,Di,Di,Di],Sf],hsl:[_o,[Di,Di,Di],Bl],hsla:[_o,[Di,Di,Di,Di],Bl],has:{type:Un,overloads:[[[Yn],(n,[e])=>Ef(e.evaluate(n),n.properties())],[[Yn,dc],(n,[e,i])=>Ef(e.evaluate(n),i.evaluate(n))]]},get:{type:$n,overloads:[[[Yn],(n,[e])=>jl(e.evaluate(n),n.properties())],[[Yn,dc],(n,[e,i])=>jl(e.evaluate(n),i.evaluate(n))]]},"feature-state":[$n,[Yn],(n,[e])=>jl(e.evaluate(n),n.featureState||{})],properties:[dc,[],n=>n.properties()],"geometry-type":[Yn,[],n=>n.geometryType()],worldview:[Yn,[],n=>n.globals.worldview||""],id:[$n,[],n=>n.id()],zoom:[Di,[],n=>n.globals.zoom],pitch:[Di,[],n=>n.globals.pitch||0],"distance-from-center":[Di,[],n=>n.distanceFromCenter()],"measure-light":[Di,[Yn],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[Di,[],n=>n.globals.heatmapDensity||0],"line-progress":[Di,[],n=>n.globals.lineProgress||0],"raster-value":[Di,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[Di,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[Di,[],n=>n.globals.skyRadialProgress||0],accumulated:[$n,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Di,To(Di),(n,e)=>{let i=0;for(const a of e)i+=a.evaluate(n);return i}],"*":[Di,To(Di),(n,e)=>{let i=1;for(const a of e)i*=a.evaluate(n);return i}],"-":{type:Di,overloads:[[[Di,Di],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Di],(n,[e])=>-e.evaluate(n)]]},"/":[Di,[Di,Di],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Di,[Di,Di],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Di,[],()=>Math.LN2],pi:[Di,[],()=>Math.PI],e:[Di,[],()=>Math.E],"^":[Di,[Di,Di],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Di,[Di],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Di,[Di],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Di,[Di],(n,[e])=>Math.log(e.evaluate(n))],log2:[Di,[Di],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Di,[Di],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Di,[Di],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Di,[Di],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Di,[Di],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Di,[Di],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Di,[Di],(n,[e])=>Math.atan(e.evaluate(n))],min:[Di,To(Di),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Di,To(Di),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Di,[Di],(n,[e])=>Math.abs(e.evaluate(n))],round:[Di,[Di],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Di,[Di],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Di,[Di],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Un,[Yn,$n],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Un,[$n],(n,[e])=>n.id()===e.value],"filter-type-==":[Un,[Yn],(n,[e])=>n.geometryType()===e.value],"filter-<":[Un,[Yn,$n],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Un,[$n],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[Un,[Yn,$n],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a>c}],"filter-id->":[Un,[$n],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[Un,[Yn,$n],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Un,[$n],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[Un,[Yn,$n],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Un,[$n],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[Un,[$n],(n,[e])=>e.value in n.properties()],"filter-has-id":[Un,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Un,[qa(Yn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Un,[qa($n)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Un,[Yn,qa($n)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Un,[Yn,qa($n)],(n,[e,i])=>function(a,c,p,m){for(;p<=m;){const v=p+m>>1;if(c[v]===a)return!0;c[v]>a?m=v-1:p=v+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Un,overloads:[[[Un,Un],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[To(Un),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Un,overloads:[[[Un,Un],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[To(Un),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Un,[Un],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Un,[Yn],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Yn,[Yn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Yn,[Yn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Yn,To($n),(n,e)=>e.map(i=>Mo(i.evaluate(n))).join("")],"resolved-locale":[Yn,[df],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[Di,[Di,Di,$n],(n,e)=>{const[i,a,c]=e.map(m=>m.evaluate(n));if(i>a||i===a)return i;let p;if(typeof c=="string")p=function(m){let v=0;if(m.length===0)return v;for(let T=0;T<m.length;T++)v=(v<<5)-v+m.charCodeAt(T),v|=0;return v}(c);else{if(typeof c!="number")throw new Wr(`Invalid seed input: ${c}`);p=c}return i+vh(p)()*(a-i)}]});class Lr{constructor(e,i,a,c){this.expression=e,this._warningHistory={},this._evaluator=new sh(a,c),this._defaultValue=i?function(p){return p.type==="color"&&(wh(p.default)||Array.isArray(p.default))?new ln(0,0,0,0):p.type==="color"?ln.parse(p.default)||null:p.default===void 0?null:p.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=ua(e)}evaluateWithoutErrorHandling(e,i,a,c,p,m,v,T){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,c,p,m,v,T){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=T||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Wr(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${E.message}`)),this._defaultValue}}}function Is(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in eu}function Ko(n,e,i,a){const c=new md(eu,[],e?function(m){const v={color:_o,string:Yn,number:Di,enum:Yn,boolean:Un,formatted:rd,resolvedImage:sd};return m.type==="array"?qa(v[m.value]||$n,m.length):v[m.type]}(e):void 0,void 0,void 0,i,a),p=c.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Cc(new Lr(p,e,i,a)):Yo(c.errors)}class Ul{constructor(e,i,a,c){this.kind=e,this._styleExpression=i,this.isLightConstant=a,this.isLineProgressConstant=c,this.isStateDependent=e!=="constant"&&!fh(i.expression),this.configDependencies=ua(i.expression)}evaluateWithoutErrorHandling(e,i,a,c,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,c,p,m)}evaluate(e,i,a,c,p,m){return this._styleExpression.evaluate(e,i,a,c,p,m)}}class xl{constructor(e,i,a,c,p,m){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!fh(i.expression),this.isLightConstant=p,this.isLineProgressConstant=m,this.configDependencies=ua(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,a,c,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,c,p,m)}evaluate(e,i,a,c,p,m){return this._styleExpression.evaluate(e,i,a,c,p,m)}interpolationFactor(e,i,a){return this.interpolationType?Gr.interpolationFactor(this.interpolationType,e,i,a):0}}function bd(n,e,i,a){if((n=Ko(n,e,i,a)).result==="error")return n;const c=n.value.expression,p=Zc(c);if(!p&&!Mu(e))return Yo([new la("","data expressions not supported")]);const m=os(c,["zoom","pitch","distance-from-center"]);if(!m&&!Ru(e))return Yo([new la("","zoom expressions not supported")]);const v=os(c,["measure-light"]);if(!v&&!Iu(e))return Yo([new la("","measure-light expression not supported")]);const T=os(c,["line-progress"]);if(!T&&!function(D){return xh(D.expression,"line-progress")}(e))return Yo([new la("","line-progress expression not supported")]);const E=e.expression&&e.expression.relaxZoomRestriction,R=bl(c);return R||m||E?R instanceof la?Yo([R]):R instanceof Gr&&!bh(e)?Yo([new la("",'"interpolate" expressions cannot be used with this property')]):Cc(R?new xl(p&&T?"camera":"composite",n.value,R.labels,R instanceof Gr?R.interpolation:void 0,v,T):new Ul(p&&T?"constant":"source",n.value,v,T)):Yo([new la("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Gl{constructor(e,i){this._parameters=e,this._specification=i,Ho(this,xd(this._parameters,this._specification))}static deserialize(e){return new Gl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function bl(n){let e=null;if(n instanceof Kc)e=bl(n.result);else if(n instanceof Ec){for(const i of n.args)if(e=bl(i),e)break}else(n instanceof wc||n instanceof Gr)&&n.input instanceof Vs&&n.input.name==="zoom"&&(e=n);return e instanceof la||n.eachChild(i=>{const a=bl(i);a instanceof la?e=a:e&&a&&e!==a&&(e=new la("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Af,Rs,wd=function(){if(Rs)return Af;Rs=1,Af=e;var n=3;function e(i,a,c){var p=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var m=new Int32Array(this.arrayBuffer);i=m[0],this.d=(a=m[1])+2*(c=m[2]);for(var v=0;v<this.d*this.d;v++){var T=m[n+v],E=m[n+v+1];p.push(T===E?null:m.subarray(T,E))}var R=m[n+p.length+1];this.keys=m.subarray(m[n+p.length],R),this.bboxes=m.subarray(R),this.insert=this._insertReadonly}else{this.d=a+2*c;for(var D=0;D<this.d*this.d;D++)p.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=i,this.padding=c,this.scale=a/i,this.uid=0;var P=c/a*i;this.min=-P,this.max=i+P}return e.prototype.insert=function(i,a,c,p,m){this._forEachCell(a,c,p,m,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,a,c,p,m,v){this.cells[m].push(v)},e.prototype.query=function(i,a,c,p,m){var v=this.min,T=this.max;if(i<=v&&a<=v&&T<=c&&T<=p&&!m)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(i,a,c,p,this._queryCell,E,{},m),E},e.prototype._queryCell=function(i,a,c,p,m,v,T,E){var R=this.cells[m];if(R!==null)for(var D=this.keys,P=this.bboxes,j=0;j<R.length;j++){var G=R[j];if(T[G]===void 0){var Z=4*G;(E?E(P[Z+0],P[Z+1],P[Z+2],P[Z+3]):i<=P[Z+2]&&a<=P[Z+3]&&c>=P[Z+0]&&p>=P[Z+1])?(T[G]=!0,v.push(D[G])):T[G]=!1}}},e.prototype._forEachCell=function(i,a,c,p,m,v,T,E){for(var R=this._convertToCellCoord(i),D=this._convertToCellCoord(a),P=this._convertToCellCoord(c),j=this._convertToCellCoord(p),G=R;G<=P;G++)for(var Z=D;Z<=j;Z++){var K=this.d*Z+G;if((!E||E(this._convertFromCellCoord(G),this._convertFromCellCoord(Z),this._convertFromCellCoord(G+1),this._convertFromCellCoord(Z+1)))&&m.call(this,i,a,c,p,K,v,T,E))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,a=n+this.cells.length+1+1,c=0,p=0;p<this.cells.length;p++)c+=this.cells[p].length;var m=new Int32Array(a+c+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var v=a,T=0;T<i.length;T++){var E=i[T];m[n+T]=v,m.set(E,v),v+=E.length}return m[n+i.length]=v,m.set(this.keys,v),m[n+i.length+1]=v+=this.keys.length,m.set(this.bboxes,v),v+=this.bboxes.length,m.buffer},Af}(),wl=ya(wd);const Hl={};function mi(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),Hl[e]={klass:n,omit:i.omit||[]}}mi(Object,"Object"),wl.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},wl.deserialize=function(n){return new wl(n.buffer)},Object.defineProperty(wl,"name",{value:"Grid"}),mi(wl,"Grid"),typeof DOMMatrix<"u"&&mi(DOMMatrix,"DOMMatrix"),mi(ln,"Color"),mi(Error,"Error"),mi(Ea,"Formatted"),mi(ld,"FormattedSection"),mi(en,"AJAXError"),mi(Hs,"ResolvedImage"),mi(Gl,"StylePropertyFunction"),mi(Lr,"StyleExpression",{omit:["_evaluator"]}),mi(Br,"ImageId"),mi(Ll,"ImageVariant"),mi(xl,"ZoomDependentExpression"),mi(Ul,"ZoomConstantExpression"),mi(Vs,"CompoundExpression",{omit:["_evaluate"]});for(const n in eu)Hl[eu[n]._classRegistryKey]||mi(eu[n],`Expression${n}`);function Lm(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Cf(n){return self.ImageBitmap&&n instanceof ImageBitmap}function ql(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Lm(n)||Cf(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const a of n)i.push(ql(a,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[a,c]of n.entries())i.entries.push(ql(a),ql(c,e));return i}if(n instanceof Set){const i={$name:"Set"};let a=0;for(const c of n.values())i[++a]=ql(c);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},a=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const c of a)i[c]=n[c];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,a=i._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const c=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const p in n)n.hasOwnProperty(p)&&(Hl[a].omit.indexOf(p)>=0||(c[p]=ql(n[p],e)));n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof n)}function $l(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Lm(n)||Cf(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map($l);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const c=n.entries||[],p=new Map;for(let m=0;m<c.length;m+=2)p.set($l(c[m]),$l(c[m+1]));return p}if(e==="Set"){const c=new Set;for(const p of Object.keys(n))p!=="$name"&&c.add($l(n[p]));return c}if(e==="DOMMatrix"){let c;return c=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(c)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=Hl[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const a=Object.create(i.prototype);for(const c of Object.keys(n))c!=="$name"&&(a[c]=$l(n[c]));return a}throw new Error("can't deserialize object of type "+typeof n)}const Ii={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function Ss(n){for(const e of n)if(Th(e.charCodeAt(0)))return!0;return!1}function Pp(n){for(const e of n)if(!Td(e.charCodeAt(0)))return!1;return!0}function Td(n){return!(Ii.Arabic(n)||Ii["Arabic Supplement"](n)||Ii["Arabic Extended-A"](n)||Ii["Arabic Presentation Forms-A"](n)||Ii["Arabic Presentation Forms-B"](n))}function Th(n){return!(n!==746&&n!==747&&(n<4352||!(Ii["Bopomofo Extended"](n)||Ii.Bopomofo(n)||Ii["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Ii["CJK Compatibility Ideographs"](n)||Ii["CJK Compatibility"](n)||Ii["CJK Radicals Supplement"](n)||Ii["CJK Strokes"](n)||!(!Ii["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Ii["CJK Unified Ideographs Extension A"](n)||Ii["CJK Unified Ideographs"](n)||Ii["Enclosed CJK Letters and Months"](n)||Ii["Hangul Compatibility Jamo"](n)||Ii["Hangul Jamo Extended-A"](n)||Ii["Hangul Jamo Extended-B"](n)||Ii["Hangul Jamo"](n)||Ii["Hangul Syllables"](n)||Ii.Hiragana(n)||Ii["Ideographic Description Characters"](n)||Ii.Kanbun(n)||Ii["Kangxi Radicals"](n)||Ii["Katakana Phonetic Extensions"](n)||Ii.Katakana(n)&&n!==12540||!(!Ii["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Ii["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Ii["Unified Canadian Aboriginal Syllabics"](n)||Ii["Unified Canadian Aboriginal Syllabics Extended"](n)||Ii["Vertical Forms"](n)||Ii["Yijing Hexagram Symbols"](n)||Ii["Yi Syllables"](n)||Ii["Yi Radicals"](n))))}function Mf(n){return!(Th(n)||function(e){return!!(Ii["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ii["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ii["Letterlike Symbols"](e)||Ii["Number Forms"](e)||Ii["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ii["Control Pictures"](e)&&e!==9251||Ii["Optical Character Recognition"](e)||Ii["Enclosed Alphanumerics"](e)||Ii["Geometric Shapes"](e)||Ii["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ii["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ii["CJK Symbols and Punctuation"](e)||Ii.Katakana(e)||Ii["Private Use Area"](e)||Ii["CJK Compatibility Forms"](e)||Ii["Small Form Variants"](e)||Ii["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function Mc(n){return Ii.Arabic(n)||Ii["Arabic Supplement"](n)||Ii["Arabic Extended-A"](n)||Ii["Arabic Presentation Forms-A"](n)||Ii["Arabic Presentation Forms-B"](n)}function Sd(n){return n>=1424&&n<=2303||Ii["Arabic Presentation Forms-A"](n)||Ii["Arabic Presentation Forms-B"](n)}function Op(n,e){return!(!e&&Sd(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Ii.Khmer(n))}function Lp(n){for(const e of n)if(Sd(e.charCodeAt(0)))return!0;return!1}const oo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let If=null,Ma=oo.unavailable,Zl=null;const tu=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Ma=oo.error),If&&If(n)};function Ed(){Sh.fire(new Zi("pluginStateChange",{pluginStatus:Ma,pluginURL:Zl}))}const Sh=new fs,Pu=function(){return Ma},zm=function(){if(Ma!==oo.deferred||!Zl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ma=oo.loading,Ed(),Zl&&ds({url:Zl},n=>{n?tu(n):(Ma=oo.loaded,Ed())})},Wl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ma===oo.loaded||Wl.applyArabicShaping!=null,isLoading:()=>Ma===oo.loading,setState(n){Ma=n.pluginStatus,Zl=n.pluginURL},isParsing:()=>Ma===oo.parsing,isParsed:()=>Ma===oo.parsed,getPluginURL:()=>Zl};class Kn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,a){for(const c of i)if(!Op(c.charCodeAt(0),a))return!1;return!0}(e,Wl.isLoaded())}}class Eh{constructor(e,i,a,c){this.property=e,this.value=i,this.expression=function(p,m,v,T){if(wh(p))return new Gl(p,m);if(Is(p)||Array.isArray(p)&&p.length>0){const E=bd(p,m,v,T);if(E.result==="error")throw new Error(E.value.map(R=>`${R.key}: ${R.message}`).join(", "));return E.value}{let E=p;return typeof p=="string"&&m.type==="color"&&(E=ln.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>E}}}(i===void 0?e.specification.default:i,e.specification,a,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a){return this.property.possiblyEvaluate(this,e,i,a)}}class Xl{constructor(e,i,a){this.property=e,this.value=new Eh(e,void 0,i,a)}transitioned(e,i){return new kp(this.property,this.value,i,tt({},e.transition,this.transition),e.now)}untransitioned(){return new kp(this.property,this.value,null,{},0)}}class zp{constructor(e,i,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=a,this.configDependencies=new Set}getValue(e){return Ni(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Xl(this._values[e].property,this._scope,this._options)),this._values[e].value=new Eh(this._values[e].property,i===null?void 0:Ni(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const a=this._properties.properties;if(e)for(const c in e){const p=e[c];if(c.endsWith("-transition")){const m=c.slice(0,-11);a[m]&&this.setTransition(m,p)}else a.hasOwnProperty(c)&&this.setValue(c,p)}}getTransition(e){return Ni(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Xl(this._values[e].property)),this._values[e].transition=Ni(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const a=new Np(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,i._values[c]);return a}untransitioned(){const e=new Np(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class kp{constructor(e,i,a,c,p){const m=c.delay||0,v=c.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+m,this.end=this.begin+v,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const c=e.now||0,p=this.value.possiblyEvaluate(e,i,a),m=this.prior;if(m){if(c>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(c<this.begin)return m.possiblyEvaluate(e,i,a);{const v=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,i,a),p,ae(v))}}return p}}class Np{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const c=new Lu(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(e,i,a);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class km{constructor(e,i,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=a,this.configDependencies=new Set}getValue(e){return Ni(this._values[e].value)}setValue(e,i){this._values[e]=new Eh(this._values[e].property,i===null?void 0:Ni(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a){const c=new Lu(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(e,i,a);return c}}class Ou{constructor(e,i,a){this.property=e,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,c){return this.property.evaluate(this.value,this.parameters,e,i,a,c)}}class Lu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ut{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const c=Fc[this.specification.type];return c?c(e,i,a):e}}class ni{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,c){return new Ou(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},a,c)}:e.expression,i)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ou(this,{kind:"constant",value:void 0},e.parameters);const c=Fc[this.specification.type];return c?new Ou(this,{kind:"constant",value:c(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,c,p,m){return e.kind==="constant"?e.value:e.evaluate(i,a,c,p,m)}}class Yl{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,c){return!!e.expression.evaluate(i,null,{},a,c)}interpolate(){return!1}}class zr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Kn(0,{});for(const a in e){const c=e[a];c.specification.overridable&&this.overridableProperties.push(a);const p=this.defaultPropertyValues[a]=new Eh(c,void 0),m=this.defaultTransitionablePropertyValues[a]=new Xl(c);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=p.possiblyEvaluate(i)}}}mi(ni,"DataDrivenProperty"),mi(Ut,"DataConstantProperty"),mi(Yl,"ColorRampProperty");var Ye=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function lo(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Ad(n){if(Array.isArray(n))return n.map(Ad);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Ad(n[i]);return e}return lo(n)}function Cd(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Cd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Rf(n,e="",i=null,a="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Cd(n)||(n=Ah(n));const c=n;let p=!0;try{p=function(R){if(!zu(R))return R;let D=Ad(R);return Bp(D),D=Fp(D),D}(c)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(c,null,2)}
        `)}let m=null,v=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){v=Ye[`filter_${a}`];const R=Ko(p,v,e,i);if(R.result==="error")throw new Error(R.value.map(D=>`${D.key}: ${D.message}`).join(", "));m=(D,P,j)=>R.value.evaluate(D,P,{},j)}let T=null,E=null;if(p!==c){const R=Ko(c,v,e,i);if(R.result==="error")throw new Error(R.value.map(D=>`${D.key}: ${D.message}`).join(", "));T=(D,P,j,G,Z)=>R.value.evaluate(D,P,{},j,void 0,void 0,G,Z),E=!Zc(R.value.expression)}return{filter:m,dynamicFilter:T||void 0,needGeometry:Vp(p),needFeature:!!E}}function Fp(n){if(!Array.isArray(n))return n;const e=function(i){if(jp.has(i[0])){for(let a=1;a<i.length;a++)if(zu(i[a]))return!0}return i}(n);return e===!0?e:e.map(i=>Fp(i))}function Bp(n){let e=!1;const i=[];if(n[0]==="case"){for(let a=1;a<n.length-1;a+=2)e=e||zu(n[a]),i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||zu(n[1]);for(let a=2;a<n.length-1;a+=2)i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||zu(n[1]);for(let a=1;a<n.length-1;a+=2)i.push(n[a+1])}e&&(n.length=0,n.push("any",...i));for(let a=1;a<n.length;a++)Bp(n[a])}function zu(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(zu(n[i]))return!0;return!1}const jp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Nm(n,e){return n<e?-1:n>e?1:0}function Vp(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Vp(n[e]))return!0;return!1}function Ah(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Df(n[1],n[2],"=="):e==="!="?Ch(Df(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Df(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Ah))):e==="all"?["all"].concat(n.slice(1).map(Ah)):e==="none"?["all"].concat(n.slice(1).map(Ah).map(Ch)):e==="in"?Pf(n[1],n.slice(2)):e==="!in"?Ch(Pf(n[1],n.slice(2))):e==="has"?Fm(n[1]):e!=="!has"||Ch(Fm(n[1]));var i}function Df(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Pf(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Nm)]]:["filter-in-small",n,["literal",e]]}}function Fm(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ch(n){return["!",n]}const Mh="";function iu(n,e){return e?`${n}${Mh}${e}`:n}const Md="-transition",Ic=new Set(["fill","line","background","hillshade","raster"]);class da extends fs{constructor(e,i,a,c,p){if(super(),this.id=e.id,this.fqid=iu(this.id,a),this.type=e.type,this.scope=a,this.lut=c,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const m=Ko(this.filter,Ye[`filter_${e.type}`]);m.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...m.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new km(i.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new zp(i.paint,this.scope,p);for(const m in e.paint)this.setPaintProperty(m,e.paint[m]);for(const m in e.layout)this.setLayoutProperty(m,e.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Lu(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Ic.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Md)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const a=this._transitionablePaint,c=a._properties.properties;if(e.endsWith(Md)){const D=e.slice(0,-11);return c[D]&&a.setTransition(D,i||void 0),!1}if(!c[e])return!1;const p=a._values[e],m=p.value.isDataDriven(),v=p.value;a.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const T=a._values[e].value,E=T.isDataDriven(),R=e.endsWith("pattern")||e==="line-dasharray";return E||m||R||this._handleOverridablePaintPropertyUpdate(e,v,T)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,a){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Bi({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ou&&Mu(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Rf(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,a,c,p,m,v,T,E){}}const Ug={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Id{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gr{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function En(n,e=1){let i=0,a=0;return{members:n.map(c=>{const p=Ug[c.type].BYTES_PER_ELEMENT,m=i=Rd(i,Math.max(e,p)),v=c.components||1;return a=Math.max(a,p),i+=p*v,{name:c.name,type:c.type,components:v,offset:m}}),size:Rd(i,Math.max(a,e)),alignment:e}}function Rd(n,e){return Math.ceil(n/e)*e}class Qo extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=a,e}}Qo.prototype.bytesPerElement=4,mi(Qo,"StructArrayLayout2i4");class Ih extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=a,this.int16[p+2]=c,e}}Ih.prototype.bytesPerElement=6,mi(Ih,"StructArrayLayout3i6");class ku extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,c)}emplace(e,i,a,c,p){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=a,this.int16[m+2]=c,this.int16[m+3]=p,e}}ku.prototype.bytesPerElement=8,mi(ku,"StructArrayLayout4i8");class Tl extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Tl.prototype.bytesPerElement=4,mi(Tl,"StructArrayLayout1f4");class Of extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const p=4*e,m=2*e;return this.int16[p+0]=i,this.int16[p+1]=a,this.float32[m+1]=c,e}}Of.prototype.bytesPerElement=8,mi(Of,"StructArrayLayout2i1f8");class Dd extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=a,this.int16[p+2]=c,e}}Dd.prototype.bytesPerElement=8,mi(Dd,"StructArrayLayout3i8");class Rh extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,c,p)}emplace(e,i,a,c,p,m){const v=5*e;return this.int16[v+0]=i,this.int16[v+1]=a,this.int16[v+2]=c,this.int16[v+3]=p,this.int16[v+4]=m,e}}Rh.prototype.bytesPerElement=10,mi(Rh,"StructArrayLayout5i10");class nu extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,a,c,p,m,v)}emplace(e,i,a,c,p,m,v,T){const E=6*e,R=12*e,D=3*e;return this.int16[E+0]=i,this.int16[E+1]=a,this.uint8[R+4]=c,this.uint8[R+5]=p,this.uint8[R+6]=m,this.uint8[R+7]=v,this.float32[D+2]=T,e}}nu.prototype.bytesPerElement=12,mi(nu,"StructArrayLayout2i4ub1f12");class So extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=a,this.float32[p+2]=c,e}}So.prototype.bytesPerElement=12,mi(So,"StructArrayLayout3f12");class Sl extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,c,p)}emplace(e,i,a,c,p,m){const v=6*e,T=3*e;return this.uint16[v+0]=i,this.uint16[v+1]=a,this.uint16[v+2]=c,this.uint16[v+3]=p,this.float32[T+2]=m,e}}Sl.prototype.bytesPerElement=12,mi(Sl,"StructArrayLayout4ui1f12");class Rc extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,c)}emplace(e,i,a,c,p){const m=4*e;return this.uint16[m+0]=i,this.uint16[m+1]=a,this.uint16[m+2]=c,this.uint16[m+3]=p,e}}Rc.prototype.bytesPerElement=8,mi(Rc,"StructArrayLayout4ui8");class Nu extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,a,c,p,m)}emplace(e,i,a,c,p,m,v){const T=6*e;return this.int16[T+0]=i,this.int16[T+1]=a,this.int16[T+2]=c,this.int16[T+3]=p,this.int16[T+4]=m,this.int16[T+5]=v,e}}Nu.prototype.bytesPerElement=12,mi(Nu,"StructArrayLayout6i12");class Fu extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m,v,T,E,R,D,P){const j=this.length;return this.resize(j+1),this.emplace(j,e,i,a,c,p,m,v,T,E,R,D,P)}emplace(e,i,a,c,p,m,v,T,E,R,D,P,j){const G=12*e;return this.int16[G+0]=i,this.int16[G+1]=a,this.int16[G+2]=c,this.int16[G+3]=p,this.uint16[G+4]=m,this.uint16[G+5]=v,this.uint16[G+6]=T,this.uint16[G+7]=E,this.int16[G+8]=R,this.int16[G+9]=D,this.int16[G+10]=P,this.int16[G+11]=j,e}}Fu.prototype.bytesPerElement=24,mi(Fu,"StructArrayLayout4i4ui4i24");class Bu extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,a,c,p,m)}emplace(e,i,a,c,p,m,v){const T=10*e,E=5*e;return this.int16[T+0]=i,this.int16[T+1]=a,this.int16[T+2]=c,this.float32[E+2]=p,this.float32[E+3]=m,this.float32[E+4]=v,e}}Bu.prototype.bytesPerElement=20,mi(Bu,"StructArrayLayout3i3f20");class Es extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,c)}emplace(e,i,a,c,p){const m=4*e;return this.float32[m+0]=i,this.float32[m+1]=a,this.float32[m+2]=c,this.float32[m+3]=p,e}}Es.prototype.bytesPerElement=16,mi(Es,"StructArrayLayout4f16");class ju extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}ju.prototype.bytesPerElement=4,mi(ju,"StructArrayLayout1ul4");class ta extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=a,e}}ta.prototype.bytesPerElement=4,mi(ta,"StructArrayLayout2ui4");class Jo extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m,v,T,E,R,D,P,j){const G=this.length;return this.resize(G+1),this.emplace(G,e,i,a,c,p,m,v,T,E,R,D,P,j)}emplace(e,i,a,c,p,m,v,T,E,R,D,P,j,G){const Z=20*e,K=10*e;return this.int16[Z+0]=i,this.int16[Z+1]=a,this.int16[Z+2]=c,this.int16[Z+3]=p,this.int16[Z+4]=m,this.float32[K+3]=v,this.float32[K+4]=T,this.float32[K+5]=E,this.float32[K+6]=R,this.int16[Z+14]=D,this.uint32[K+8]=P,this.uint16[Z+18]=j,this.uint16[Z+19]=G,e}}Jo.prototype.bytesPerElement=40,mi(Jo,"StructArrayLayout5i4f1i1ul2ui40");class El extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,a,c,p,m,v)}emplace(e,i,a,c,p,m,v,T){const E=8*e;return this.int16[E+0]=i,this.int16[E+1]=a,this.int16[E+2]=c,this.int16[E+4]=p,this.int16[E+5]=m,this.int16[E+6]=v,this.int16[E+7]=T,e}}El.prototype.bytesPerElement=16,mi(El,"StructArrayLayout3i2i2i16");class Lf extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,c,p)}emplace(e,i,a,c,p,m){const v=4*e,T=8*e;return this.float32[v+0]=i,this.float32[v+1]=a,this.float32[v+2]=c,this.int16[T+6]=p,this.int16[T+7]=m,e}}Lf.prototype.bytesPerElement=16,mi(Lf,"StructArrayLayout2f1f2i16");class el extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,a,c,p,m)}emplace(e,i,a,c,p,m,v){const T=20*e,E=5*e;return this.uint8[T+0]=i,this.uint8[T+1]=a,this.float32[E+1]=c,this.float32[E+2]=p,this.float32[E+3]=m,this.float32[E+4]=v,e}}el.prototype.bytesPerElement=20,mi(el,"StructArrayLayout2ub4f20");class ls extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=a,this.uint16[p+2]=c,e}}ls.prototype.bytesPerElement=6,mi(ls,"StructArrayLayout3ui6");class Ds extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z,K,te,ce,he,Y,le){const de=this.length;return this.resize(de+1),this.emplace(de,e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z,K,te,ce,he,Y,le)}emplace(e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z,K,te,ce,he,Y,le,de){const be=30*e,Fe=15*e,ze=60*e;return this.int16[be+0]=i,this.int16[be+1]=a,this.int16[be+2]=c,this.float32[Fe+2]=p,this.float32[Fe+3]=m,this.uint16[be+8]=v,this.uint16[be+9]=T,this.uint32[Fe+5]=E,this.uint32[Fe+6]=R,this.uint32[Fe+7]=D,this.uint16[be+16]=P,this.uint16[be+17]=j,this.uint16[be+18]=G,this.float32[Fe+10]=Z,this.float32[Fe+11]=K,this.uint8[ze+48]=te,this.uint8[ze+49]=ce,this.uint8[ze+50]=he,this.uint32[Fe+13]=Y,this.int16[be+28]=le,this.uint8[ze+58]=de,e}}Ds.prototype.bytesPerElement=60,mi(Ds,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Dh extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z,K,te,ce,he,Y,le,de,be,Fe,ze,Be,We,dt,Bt,St,Nt,Gt,pt){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z,K,te,ce,he,Y,le,de,be,Fe,ze,Be,We,dt,Bt,St,Nt,Gt,pt)}emplace(e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z,K,te,ce,he,Y,le,de,be,Fe,ze,Be,We,dt,Bt,St,Nt,Gt,pt,Ot){const ut=20*e,ft=40*e,Zt=80*e;return this.float32[ut+0]=i,this.float32[ut+1]=a,this.int16[ft+4]=c,this.int16[ft+5]=p,this.int16[ft+6]=m,this.int16[ft+7]=v,this.int16[ft+8]=T,this.int16[ft+9]=E,this.int16[ft+10]=R,this.int16[ft+11]=D,this.int16[ft+12]=P,this.uint16[ft+13]=j,this.uint16[ft+14]=G,this.uint16[ft+15]=Z,this.uint16[ft+16]=K,this.uint16[ft+17]=te,this.uint16[ft+18]=ce,this.uint16[ft+19]=he,this.uint16[ft+20]=Y,this.uint16[ft+21]=le,this.uint16[ft+22]=de,this.uint16[ft+23]=be,this.uint16[ft+24]=Fe,this.uint16[ft+25]=ze,this.uint16[ft+26]=Be,this.uint16[ft+27]=We,this.uint32[ut+14]=dt,this.float32[ut+15]=Bt,this.float32[ut+16]=St,this.float32[ut+17]=Nt,this.float32[ut+18]=Gt,this.uint8[Zt+76]=pt,this.uint16[ft+39]=Ot,e}}Dh.prototype.bytesPerElement=80,mi(Dh,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Pd extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,a,c,p,m)}emplace(e,i,a,c,p,m,v){const T=6*e;return this.float32[T+0]=i,this.float32[T+1]=a,this.float32[T+2]=c,this.float32[T+3]=p,this.float32[T+4]=m,this.float32[T+5]=v,e}}Pd.prototype.bytesPerElement=24,mi(Pd,"StructArrayLayout6f24");class Kl extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,c,p)}emplace(e,i,a,c,p,m){const v=5*e;return this.float32[v+0]=i,this.float32[v+1]=a,this.float32[v+2]=c,this.float32[v+3]=p,this.float32[v+4]=m,e}}Kl.prototype.bytesPerElement=20,mi(Kl,"StructArrayLayout5f20");class Ph extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,a,c,p,m,v)}emplace(e,i,a,c,p,m,v,T){const E=7*e;return this.float32[E+0]=i,this.float32[E+1]=a,this.float32[E+2]=c,this.float32[E+3]=p,this.float32[E+4]=m,this.float32[E+5]=v,this.float32[E+6]=T,e}}Ph.prototype.bytesPerElement=28,mi(Ph,"StructArrayLayout7f28");class zf extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m,v,T,E,R,D){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,a,c,p,m,v,T,E,R,D)}emplace(e,i,a,c,p,m,v,T,E,R,D,P){const j=11*e;return this.float32[j+0]=i,this.float32[j+1]=a,this.float32[j+2]=c,this.float32[j+3]=p,this.float32[j+4]=m,this.float32[j+5]=v,this.float32[j+6]=T,this.float32[j+7]=E,this.float32[j+8]=R,this.float32[j+9]=D,this.float32[j+10]=P,e}}zf.prototype.bytesPerElement=44,mi(zf,"StructArrayLayout11f44");class Ql extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m,v,T,E){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,a,c,p,m,v,T,E)}emplace(e,i,a,c,p,m,v,T,E,R){const D=9*e;return this.float32[D+0]=i,this.float32[D+1]=a,this.float32[D+2]=c,this.float32[D+3]=p,this.float32[D+4]=m,this.float32[D+5]=v,this.float32[D+6]=T,this.float32[D+7]=E,this.float32[D+8]=R,e}}Ql.prototype.bytesPerElement=36,mi(Ql,"StructArrayLayout9f36");class Jl extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=a,e}}Jl.prototype.bytesPerElement=8,mi(Jl,"StructArrayLayout2f8");class kf extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,c)}emplace(e,i,a,c,p){const m=6*e;return this.uint32[3*e+0]=i,this.uint16[m+2]=a,this.uint16[m+3]=c,this.uint16[m+4]=p,e}}kf.prototype.bytesPerElement=12,mi(kf,"StructArrayLayout1ul3ui12");class Oh extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Oh.prototype.bytesPerElement=2,mi(Oh,"StructArrayLayout1ui2");class Vu extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z,K){const te=this.length;return this.resize(te+1),this.emplace(te,e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z,K)}emplace(e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z,K,te){const ce=16*e;return this.float32[ce+0]=i,this.float32[ce+1]=a,this.float32[ce+2]=c,this.float32[ce+3]=p,this.float32[ce+4]=m,this.float32[ce+5]=v,this.float32[ce+6]=T,this.float32[ce+7]=E,this.float32[ce+8]=R,this.float32[ce+9]=D,this.float32[ce+10]=P,this.float32[ce+11]=j,this.float32[ce+12]=G,this.float32[ce+13]=Z,this.float32[ce+14]=K,this.float32[ce+15]=te,e}}Vu.prototype.bytesPerElement=64,mi(Vu,"StructArrayLayout16f64");class ru extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,p,m,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,a,c,p,m,v)}emplace(e,i,a,c,p,m,v,T){const E=10*e,R=5*e;return this.uint16[E+0]=i,this.uint16[E+1]=a,this.uint16[E+2]=c,this.uint16[E+3]=p,this.float32[R+2]=m,this.float32[R+3]=v,this.float32[R+4]=T,e}}ru.prototype.bytesPerElement=20,mi(ru,"StructArrayLayout4ui3f20");class Nf extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Nf.prototype.bytesPerElement=2,mi(Nf,"StructArrayLayout1i2");class Lh extends gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Lh.prototype.bytesPerElement=1,mi(Lh,"StructArrayLayout1ub1");class Up extends Id{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Up.prototype.size=40;class Od extends Jo{get(e){return new Up(this,e)}}mi(Od,"CollisionBoxArray");class Bm extends Id{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Bm.prototype.size=60;class Gp extends Ds{get(e){return new Bm(this,e)}}mi(Gp,"PlacedSymbolArray");class ia extends Id{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}ia.prototype.size=80;class fa extends Dh{get(e){return new ia(this,e)}}mi(fa,"SymbolInstanceArray");class Ff extends Tl{getoffsetX(e){return this.float32[1*e+0]}}mi(Ff,"GlyphOffsetArray");class Hp extends Qo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}mi(Hp,"SymbolLineVertexArray");class qp extends Id{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}qp.prototype.size=12;class $p extends kf{get(e){return new qp(this,e)}}mi($p,"FeatureIndexArray");class Zp extends ta{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}mi(Zp,"FillExtrusionCentroidArray");class Ld extends Id{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Ld.prototype.size=6;class Bf extends Ih{get(e){return new Ld(this,e)}}mi(Bf,"FillExtrusionWallArray");const jm=En([{name:"a_pos",components:2,type:"Int16"}],4),Vm=En([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),zd=En([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class kr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,a,c){let p=this.segments[this.segments.length-1];return e>kr.MAX_VERTEX_ARRAY_LENGTH&&Yi(`Max vertices per segment is ${kr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>kr.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==c)&&(p={vertexOffset:i,primitiveOffset:a,vertexLength:0,primitiveLength:0},c!==void 0&&(p.sortKey=c),this.segments.push(p)),p}prepareSegment(e,i,a,c){return this._prepareSegment(e,i.length,a.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,c){return new kr([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function jf(n,e){return 256*(n=Me(Math.floor(n),0,255))+Me(Math.floor(e),0,255)}kr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mi(kr,"SegmentVector");const zh=En([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Vf=En([{name:"a_pattern_b",components:4,type:"Uint16"}]),Uf=En([{name:"a_dash",components:4,type:"Uint16"}]);class su{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,a,c){this.ids.push(kd(e)),this.positions.push(i,a,c)}eachPosition(e,i){const a=kd(e);let c=0,p=this.ids.length-1;for(;c<p;){const m=c+p>>1;this.ids[m]>=a?p=m:c=m+1}for(;this.ids[c]===a;)i(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,i){const a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Nd(a,c,0,a.length-1),i&&(i.add(a.buffer),i.add(c.buffer)),{ids:a,positions:c}}static deserialize(e){const i=new su;let a;i.ids=e.ids,i.positions=e.positions;for(const c of i.ids)c!==a&&i.uniqueIds.push(c),a=c;return i.indexed=!0,i}}function kd(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:vi(String(n))}function Nd(n,e,i,a){for(;i<a;){const c=n[i+a>>1];let p=i-1,m=a+1;for(;;){do p++;while(n[p]<c);do m--;while(n[m]>c);if(p>=m)break;Uu(n,p,m),Uu(e,3*p,3*m),Uu(e,3*p+1,3*m+1),Uu(e,3*p+2,3*m+2)}m-i<a-m?(Nd(n,e,i,m),i=m+1):(Nd(n,e,m+1,a),a=m)}}function Uu(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}mi(su,"FeaturePositionMap");class ec{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class tl extends ec{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Xr extends ec{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class tc extends ec{constructor(e){super(e),this.current=[0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class kh extends ec{constructor(e){super(e),this.current=[0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class il extends ec{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Wp extends ec{constructor(e){super(e),this.current=ln.transparent.toPremultipliedRenderColor(null)}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const Gf=new Float32Array(16);class ic extends ec{constructor(e){super(e),this.current=Gf}set(e,i,a){if(this.fetchUniformLocation(e,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const vs=new Float32Array(9),nc=new Float32Array(4);class Fd extends ec{constructor(e){super(e),this.current=nc}set(e,i,a){if(this.fetchUniformLocation(e,i)){for(let c=0;c<4;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function Hf(n){return[jf(255*n.r,255*n.g),jf(255*n.b,255*n.a)]}class Dc{constructor(e,i,a,c){this.value=e,this.uniformNames=i.map(p=>`u_${p}`),this.type=a,this.context=c}setUniform(e,i,a,c,p){const m=c.constantOr(this.value);i.set(e,p,m instanceof ln?m.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):m)}getBinding(e,i){return this.type==="color"?new Wp(e):new Xr(e)}}class Lo{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,a,c,p){let m=null;p!=="u_pattern"&&p!=="u_dash"||(m=this.pattern),p==="u_pattern_b"&&(m=this.patternTransition),p==="u_pixel_ratio"&&(m=this.pixelRatio),m&&i.set(e,p,m)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new il(e):new Xr(e)}}class rc{constructor(e,i,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,a,c,p,m,v,T){const E=this.paintVertexArray.length,R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Kn(0,{brightness:m,worldview:T}),i,{},p,c,v):this.expression.kind==="constant"&&this.expression.value,D=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Kn(0,{brightness:m,worldview:T}),i,{},p,c,v):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(E,e,R,D?null:this.context.lut)}updatePaintArray(e,i,a,c,p,m,v,T){const E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:T},a,c,void 0,p):this.expression.kind==="constant"&&this.expression.value,R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Kn(0,{brightness:v,worldview:T}),a,c,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,i,E,R?null:this.context.lut)}_setPaintValue(e,i,a,c){if(this.type==="color"){const p=Hf(a.toPremultipliedRenderColor(c));for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class nl{constructor(e,i,a,c,p,m){this.expression=e,this.uniformNames=i.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=c,this.context=p,this.maxValue=0,this.paintVertexAttributes=i.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,i,a,c,p,m,v,T){const E=this.expression.evaluate(new Kn(this.context.zoom,{brightness:m,worldview:T}),i,{},p,c,v),R=this.expression.evaluate(new Kn(this.context.zoom+1,{brightness:m,worldview:T}),i,{},p,c,v),D=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Kn(0,{brightness:m,worldview:T}),i,{},p,c,v):this.lutExpression.value)==="none",P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,E,R,D?null:this.context.lut)}updatePaintArray(e,i,a,c,p,m,v,T){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:T},a,c,void 0,p),R=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:T},a,c,void 0,p),D=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Kn(0,{brightness:v,worldview:T}),a,c,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,i,E,R,D?null:this.context.lut)}_setPaintValue(e,i,a,c,p){if(this.type==="color"){const m=Hf(a.toPremultipliedRenderColor(p)),v=Hf(a.toPremultipliedRenderColor(p));for(let T=e;T<i;T++)this.paintVertexArray.emplace(T,m[0],m[1],v[0],v[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,c,p){const m=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,v=Me(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);i.set(e,p,v)}getBinding(e,i){return new Xr(e)}}class $a{constructor(e,i,a,c,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(a==="array"?Uf:zh).members;for(let m=0;m<i.length;++m);this.paintVertexArray=new c,this.paintTransitionVertexArray=new Rc}populatePaintArray(e,i,a,c){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,c,p,m,v){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(e,i,a,c){if(!c||!a)return;const p=c[a[0]],m=c[a[1]];if(p){if(p){const{tl:v,br:T,pixelRatio:E}=p;for(let R=e;R<i;R++)this.paintVertexArray.emplace(R,v[0],v[1],T[0],T[1],E)}if(m){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:T}=m;for(let E=e;E<i;E++)this.paintTransitionVertexArray.emplace(E,v[0],v[1],T[0],T[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Vf.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class co{constructor(e,i,a=()=>!0){this.binders={},this._buffers=[],this.context=i;const c=[];for(const p in e.paint._values){const m=e.paint.get(p);if(p.endsWith("-use-theme")||!a(p)||!(m instanceof Ou&&Mu(m.property.specification)))continue;const v=s(p,e.type),T=m.value,E=m.property.specification.type,R=!!m.property.useIntegerZoom,D=p==="line-dasharray"||p.endsWith("pattern"),P=e.paint.get(`${p}-use-theme`),j=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||P&&P.value.kind!=="constant";if(T.kind!=="constant"||j)if(T.kind==="source"||j||D){const G=y(p,E,"source");this.binders[p]=D?new $a(T,v,E,G,e.id):new rc(T,v,E,G),c.push(`/a_${p}`)}else{const G=y(p,E,"composite");this.binders[p]=new nl(T,v,E,R,i,G),c.push(`/z_${p}`)}else this.binders[p]=D?new Lo(T.value,v):new Dc(T.value,v,E,i),c.push(`/u_${p}`);P&&(this.binders[p].lutExpression=P.value)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof rc||i instanceof nl?i.maxValue:0}populatePaintArrays(e,i,a,c,p,m,v,T){for(const E in this.binders){const R=this.binders[E];R.context=this.context,(R instanceof rc||R instanceof nl||R instanceof $a)&&R.populatePaintArray(e,i,a,c,p,m,v,T)}}setConstantPatternPositions(e,i){for(const a in this.binders){const c=this.binders[a];c instanceof Lo&&c.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof $a?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,a,c,p,m,v,T,E,R){let D=!1;const P=Object.keys(e),j=P.length!==0&&!T,G=j?P:i.uniqueIds;this.context.lut=p.lut;for(const Z in this.binders){const K=this.binders[Z];if(K.context=this.context,(K instanceof rc||K instanceof nl||K instanceof $a)&&K.expression&&K.expression.kind&&K.expression.kind!=="constant"&&(K.expression.isStateDependent===!0||K.expression.isLightConstant===!1)){const te=p.paint.get(Z);K.expression=te.value;for(const ce of G){const he=e[ce.toString()];i.eachPosition(ce,(Y,le,de)=>{const be=c.feature(Y);K.updatePaintArray(le,de,be,he,m,v,E,R)})}if(!j)for(const ce of a.uniqueIds){const he=e[ce.toString()];a.eachPosition(ce,(Y,le,de)=>{const be=c.feature(Y);K.updatePaintArray(le,de,be,he,m,v,E,R)})}D=!0}}return D}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Dc||a instanceof Lo)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof rc||a instanceof nl||a instanceof $a)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name);if(a instanceof $a)for(let c=0;c<Vf.members.length;c++)e.push(Vf.members[c].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Dc||a instanceof Lo||a instanceof nl)for(const c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof Dc||c instanceof Lo||c instanceof nl)for(const p of c.uniformNames)i.push({name:p,property:a,binding:c.getBinding(e,p)})}return i}setUniforms(e,i,a,c,p){for(const{name:m,property:v,binding:T}of a)this.binders[v].setUniform(e,T,p,c.get(v),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof rc||i instanceof nl||i instanceof $a)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof $a&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof rc||a instanceof nl||a instanceof $a)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof rc||i instanceof nl||i instanceof $a)&&i.destroy()}}}class u{constructor(e,i,a=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new co(c,i,a);this.needsUpload=!1,this._featureMap=new su,this._featureMapWithoutIds=new su,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,a,c,p,m,v,T,E){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(e,i,c,p,m,v,T,E);i.id!==void 0?this._featureMap.add(i.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,c,p,m,v,T){for(const E of a)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,E,c,p,m,v||0,T)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const t={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function s(n,e){return t[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const h={"line-pattern":{source:Sl,composite:Sl},"fill-pattern":{source:Sl,composite:Sl},"fill-extrusion-pattern":{source:Sl,composite:Sl},"line-dasharray":{source:Rc,composite:Rc}},_={color:{source:Jl,composite:Es},number:{source:Tl,composite:Jl}};function y(n,e,i){const a=h[n];return a&&a[i]||_[e][i]}mi(Dc,"ConstantBinder"),mi(Lo,"PatternConstantBinder"),mi(rc,"SourceExpressionBinder"),mi($a,"PatternCompositeBinder"),mi(nl,"CompositeExpressionBinder"),mi(co,"ProgramConfiguration",{omit:["_buffers"]}),mi(u,"ProgramConfigurationSet");const b=Kt/Math.PI/2,C=5,I=6,O=16383,k=64,U=[k,32,16],V=-b,H=b;function Q(n,e,i,a=b){return i=wn(i),[n*Math.sin(i)*a,-e*a,n*Math.cos(i)*a]}function X(n,e,i){return Q(Math.cos(wn(n)),Math.sin(wn(n)),e,i)}const J=63710088e-1,ne=2*Math.PI*J;class oe{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new oe(et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,c=e.lat*i,p=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return J*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new ve({lng:this.lng-a,lat:this.lat-i},{lng:this.lng+a,lat:this.lat+i})}toEcef(e){return X(this.lat,this.lng,b+e*b/J)}static convert(e){if(e instanceof oe)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new oe(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new oe(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ve{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{const a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof oe?new oe(e.lng,e.lat):oe.convert(e),this}setSouthWest(e){return this._sw=e instanceof oe?new oe(e.lng,e.lat):oe.convert(e),this}extend(e){const i=this._sw,a=this._ne;let c,p;if(e instanceof oe)c=e,p=e;else{if(!(e instanceof ve))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ve.convert(e)):this.extend(oe.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(oe.convert(e)):this;if(c=e._sw,p=e._ne,!c||!p)return this}return i||a?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),a.lng=Math.max(p.lng,a.lng),a.lat=Math.max(p.lat,a.lat)):(this._sw=new oe(c.lng,c.lat),this._ne=new oe(p.lng,p.lat)),this}getCenter(){return new oe((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new oe(this.getWest(),this.getNorth())}getSouthEast(){return new oe(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=oe.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){if(e)return e instanceof ve?e:new ve(e)}}const Se=0,Le=25.5;function Ie(n){return ne*Math.cos(n*Math.PI/180)}function Ce(n){return(180+n)/360}function Ae(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Pe(n,e){return n/Ie(e)}function Ne(n){return 360*n-180}function Ke(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Je(n,e){return n*Ie(Ke(e))}const mt=85.051129;function xt(n){return Math.cos(wn(Me(n,-85.051129,mt)))}function Pt(n,e){const i=Me(e,Se,Le),a=Math.pow(2,i);return xt(n)*ne/(512*a)}function Ze(n){return 1/Math.cos(n*Math.PI/180)}function lt(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/Kt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/Kt/(1<<n.z)}class Ge{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=oe.convert(e);return new Ge(Ce(a.lng),Ae(a.lat),Pe(i,a.lat))}toLngLat(){return new oe(Ne(this.x),Ke(this.y))}toAltitude(){return Je(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ne*Ze(Ke(this.y))}}function bt(n,e,i,a,c,p,m,v,T){const E=(e+a)/2,R=(i+c)/2,D=new Qt(E,R);v(D),function(P,j,G,Z,K,te){const ce=G-K,he=Z-te;return Math.abs((Z-j)*ce-(G-P)*he)/Math.hypot(ce,he)}(D.x,D.y,p.x,p.y,m.x,m.y)>=T?(bt(n,e,i,E,R,p,D,v,T),bt(n,E,R,a,c,D,m,v,T)):n.push(m)}function st(n,e,i){let a=n[0],c=a.x,p=a.y;e(a);const m=[a];for(let v=1;v<n.length;v++){const T=n[v],{x:E,y:R}=T;e(T),bt(m,c,p,E,R,a,T,e,i),c=E,p=R,a=T}return m}function Ct(n,e,i,a){if(a(e,i)){const c=e.add(i)._mult(.5);Ct(n,e,c,a),Ct(n,c,i,a)}else n.push(i)}function Wt(n,e){let i=n[0];const a=[i];for(let c=1;c<n.length;c++){const p=n[c];Ct(a,i,p,e),i=p}return a}const wt=Math.pow(2,14)-1,Vt=-wt-1;function gi(n,e){const i=Math.round(n.x*e),a=Math.round(n.y*e);return n.x=Me(i,Vt,wt),n.y=Me(a,Vt,wt),(i<n.x||i>n.x+1||a<n.y||a>n.y+1)&&Yi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function di(n,e,i){const a=n.loadGeometry(),c=n.extent,p=Kt/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:v,x:T,y:E,projection:R}=i,D=P=>{const j=Ne((e.x+P.x/c)/m),G=Ke((e.y+P.y/c)/m),Z=R.project(j,G);P.x=(Z.x*v-T)*c,P.y=(Z.y*v-E)*c};for(let P=0;P<a.length;P++)if(n.type!==1)a[P]=st(a[P],D,1);else{const j=[];for(const G of a[P])G.x<0||G.x>=c||G.y<0||G.y>=c||(D(G),j.push(G));a[P]=j}}for(const m of a)for(const v of m)gi(v,p);return a}function hi(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?di(n):[]}}var Ai,Pi,fi,Ci,Ri,$i,rn,_n={};function Ln(){if(Pi)return Ai;Pi=1;var n=Fa();function e(c,p,m,v,T){this.properties={},this.extent=m,this.type=0,this._pbf=c,this._geometry=-1,this._keys=v,this._values=T,c.readFields(i,this,p)}function i(c,p,m){c==1?p.id=m.readVarint():c==2?function(v,T){for(var E=v.readVarint()+v.pos;v.pos<E;){var R=T._keys[v.readVarint()],D=T._values[v.readVarint()];T.properties[R]=D}}(m,p):c==3?p.type=m.readVarint():c==4&&(p._geometry=m.pos)}function a(c){for(var p,m,v=0,T=0,E=c.length,R=E-1;T<E;R=T++)v+=((m=c[R]).x-(p=c[T]).x)*(p.y+m.y);return v}return Ai=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var p,m=c.readVarint()+c.pos,v=1,T=0,E=0,R=0,D=[];c.pos<m;){if(T<=0){var P=c.readVarint();v=7&P,T=P>>3}if(T--,v===1||v===2)E+=c.readSVarint(),R+=c.readSVarint(),v===1&&(p&&D.push(p),p=[]),p.push(new n(E,R));else{if(v!==7)throw new Error("unknown command "+v);p&&p.push(p[0].clone())}}return p&&D.push(p),D},e.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var p=c.readVarint()+c.pos,m=1,v=0,T=0,E=0,R=1/0,D=-1/0,P=1/0,j=-1/0;c.pos<p;){if(v<=0){var G=c.readVarint();m=7&G,v=G>>3}if(v--,m===1||m===2)(T+=c.readSVarint())<R&&(R=T),T>D&&(D=T),(E+=c.readSVarint())<P&&(P=E),E>j&&(j=E);else if(m!==7)throw new Error("unknown command "+m)}return[R,P,D,j]},e.prototype.toGeoJSON=function(c,p,m){var v,T,E=this.extent*Math.pow(2,m),R=this.extent*c,D=this.extent*p,P=this.loadGeometry(),j=e.types[this.type];function G(te){for(var ce=0;ce<te.length;ce++){var he=te[ce];te[ce]=[360*(he.x+R)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(he.y+D)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var Z=[];for(v=0;v<P.length;v++)Z[v]=P[v][0];G(P=Z);break;case 2:for(v=0;v<P.length;v++)G(P[v]);break;case 3:for(P=function(te){var ce=te.length;if(ce<=1)return[te];for(var he,Y,le=[],de=0;de<ce;de++){var be=a(te[de]);be!==0&&(Y===void 0&&(Y=be<0),Y===be<0?(he&&le.push(he),he=[te[de]]):he.push(te[de]))}return he&&le.push(he),le}(P),v=0;v<P.length;v++)for(T=0;T<P[v].length;T++)G(P[v][T])}P.length===1?P=P[0]:j="Multi"+j;var K={type:"Feature",geometry:{type:j,coordinates:P},properties:this.properties};return"id"in this&&(K.id=this.id),K},Ai}function Ar(){if(Ci)return fi;Ci=1;var n=Ln();function e(a,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(i,this,c),this.length=this._features.length}function i(a,c,p){a===15?c.version=p.readVarint():a===1?c.name=p.readString():a===5?c.extent=p.readVarint():a===2?c._features.push(p.pos):a===3?c._keys.push(p.readString()):a===4&&c._values.push(function(m){for(var v=null,T=m.readVarint()+m.pos;m.pos<T;){var E=m.readVarint()>>3;v=E===1?m.readString():E===2?m.readFloat():E===3?m.readDouble():E===4?m.readVarint64():E===5?m.readVarint():E===6?m.readSVarint():E===7?m.readBoolean():null}return v}(p))}return fi=e,e.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var c=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,c,this.extent,this._keys,this._values)},fi}function Ki(){return rn||(rn=1,_n.VectorTile=function(){if($i)return Ri;$i=1;var n=Ar();function e(i,a,c){if(i===3){var p=new n(c,c.readVarint()+c.pos);p.length&&(a[p.name]=p)}}return Ri=function(i,a){this.layers=i.readFields(e,{},a)},Ri}(),_n.VectorTileFeature=Ln(),_n.VectorTileLayer=Ar()),_n}var Wi=Ki();const Ui="3d_elevation_id",Zn="level";class Hr{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,a){return this.get(e,!0,i,a)}optional(e,i,a){return this.get(e,!1,i,a)}success(){return this._valid}get(e,i,a,c){const p=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?a(c?c(p):p):i&&(this._valid=!1),this}}class sr{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,a){return this.featureFunc(e,i,a)}parseVertex(e,i,a){return this.vertexFunc(e,i,a)}}const gn=new sr((n,e,i)=>n.reset(e).require(Ui,a=>{i.id=a}).optional("fixed_height_relative",a=>{i.constantHeight=a},yn.decodeRelativeHeight).geometry(a=>{i.bounds=a},vp).success(),(n,e,i)=>n.reset(e).require(Ui,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height_relative",a=>{i.height=a},yn.decodeRelativeHeight).geometry(a=>{i.position=a},yn.getPoint).success()),_r=new sr((n,e,i)=>n.reset(e).require(Ui,a=>{i.id=a}).optional("fixed_height",a=>{i.constantHeight=a},yn.decodeMetricHeight).geometry(a=>{i.bounds=a},vp).success(),(n,e,i)=>n.reset(e).require(Ui,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height",a=>{i.height=a},yn.decodeMetricHeight).geometry(a=>{i.position=a},yn.getPoint).success());class yn{static getPoint(e){return aa(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],a=[],c=e.length,p=new Hr;for(let v=0;v<c;v++){const T=e.feature(v),E=T.properties.hasOwnProperty("version")?String(T.properties.version):void 0,R=(m=E)?m==="1.0.1"?_r:void 0:gn;if(R===void 0){Yi(`Unknown elevation feature version number ${E||"(unknown)"}`);continue}const D=T.properties.hasOwnProperty("type")?T.properties.type:void 0;if(D){if(Wi.VectorTileFeature.types[T.type]==="Point"&&D==="curve_point"){const P={};R.parseVertex(p,T,P)&&i.push(P)}else if(Wi.VectorTileFeature.types[T.type]==="Polygon"&&D==="curve_meta"){const P={};R.parseFeature(p,T,P)&&a.push(P)}}}var m;return{vertices:i,features:a}}}class ar{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const c=On(i,this.dir);if(Math.abs(c)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/c;return a[0]=this.pos[0]+this.dir[0]*p,a[1]=this.pos[1]+this.dir[1]*p,!0}}class ur{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const c=Rt(i,this.dir);if(Math.abs(c)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return a[0]=this.pos[0]+this.dir[0]*p,a[1]=this.pos[1]+this.dir[1]*p,a[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,i,a){if(function(j,G){var Z=j[0],K=j[1],te=j[2],ce=G[0],he=G[1],Y=G[2];return Math.abs(Z-ce)<=F*Math.max(1,Math.abs(Z),Math.abs(ce))&&Math.abs(K-he)<=F*Math.max(1,Math.abs(K),Math.abs(he))&&Math.abs(te-Y)<=F*Math.max(1,Math.abs(te),Math.abs(Y))}(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[c,p,m]=this.dir,v=this.pos[0]-e[0],T=this.pos[1]-e[1],E=this.pos[2]-e[2],R=c*c+p*p+m*m,D=2*(v*c+T*p+E*m),P=D*D-4*R*(v*v+T*T+E*E-i*i);if(P<0){const j=Math.max(-D/2,0),G=v+c*j,Z=T+p*j,K=E+m*j,te=Math.hypot(G,Z,K);return a[0]=G*i/te,a[1]=Z*i/te,a[2]=K*i/te,!1}{const j=(-D-Math.sqrt(P))/(2*R);if(j<0){const G=Math.hypot(v,T,E);return a[0]=v*i/G,a[1]=T*i/G,a[2]=E*i/G,!1}return a[0]=v+c*j,a[1]=T+p*j,a[2]=E+m*j,!0}}}class nr{constructor(e,i,a,c,p){this.TL=e,this.TR=i,this.BR=a,this.BL=c,this.horizon=p}static fromInvProjectionMatrix(e,i,a){const c=[-1,1,1],p=[1,1,1],m=[1,-1,1],v=[-1,-1,1],T=ei(c,c,e),E=ei(p,p,e),R=ei(m,m,e),D=ei(v,v,e);return new nr(T,E,R,D,i/a)}}function or(n,e,i){let a=1/0,c=-1/0;const p=[];for(const m of n){Qi(p,m,e);const v=Rt(p,i);a=Math.min(a,v),c=Math.max(c,v)}return[a,c]}function Nn(n,e){let i=!0;for(let a=0;a<n.planes.length;a++){const c=n.planes[a];let p=0;for(let m=0;m<e.length;m++)p+=Rt(c,e[m])+c[3]>=0;if(p===0)return 0;p!==e.length&&(i=!1)}return i?2:1}function pr(n,e){for(const i of n.projections){const a=or(e,n.points[0],i.axis);if(i.projection[1]<a[0]||i.projection[0]>a[1])return 0}return 1}function Cr(n,e){let i=0;const a=[0,0,0,0];for(let m=0;m<n.length;m++)a[0]=n[m][0],a[1]=n[m][1],a[2]=n[m][2],a[3]=1,(c=a)[0]*(p=e)[0]+c[1]*p[1]+c[2]*p[2]+c[3]*p[3]>=0&&i++;var c,p;return i}class Qn{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=An.fromPoints(this.points),this.projections=[],this.frustumEdges=[Qi([],this.points[2],this.points[3]),Qi([],this.points[0],this.points[3]),Qi([],this.points[4],this.points[0]),Qi([],this.points[5],this.points[1]),Qi([],this.points[6],this.points[2]),Qi([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const c=[0,-a[2],a[1]],p=[a[2],0,-a[0]];this.projections.push({axis:c,projection:or(this.points,this.points[0],c)}),this.projections.push({axis:p,projection:or(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,i,a,c){const p=Math.pow(2,a),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const R=Or([],E,e),D=1/R[3]/i*p;return(P=R)[0]=(j=R)[0]*(G=[D,D,c?1/R[3]:D,D])[0],P[1]=j[1]*G[1],P[2]=j[2]*G[2],P[3]=j[3]*G[3],P;var P,j,G}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const R=at([],_i([],Qi([],m[E[0]],m[E[1]]),Qi([],m[E[2]],m[E[1]]))),D=-Rt(R,m[E[1]]);return R.concat(D)}),T=[];for(let E=0;E<m.length;E++)T.push([m[E][0],m[E][1],m[E][2]]);return new Qn(T,v)}intersectsPrecise(e,i,a){for(let c=0;c<i.length;c++)if(!Cr(e,i[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!Cr(e,this.planes[c]))return 0;for(const c of a)for(const p of this.frustumEdges){const m=_i([],c,p),v=Lt(m);if(v===0)continue;Ve(m,m,1/v);const T=or(this.points,this.points[0],m),E=or(e,this.points[0],m);if(T[0]>E[1]||E[0]>T[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const a=i[3];if(Rt([i[0],i[1],i[2]],e)+a<0)return!1}return!0}}class An{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const c of e)ii(i,i,c),Li(a,a,c);return new An(i,a)}static fromTileIdAndHeight(e,i,a){const c=1<<e.canonical.z,p=e.canonical.x,m=e.canonical.y;return new An([p/c,m/c,i],[(p+1)/c,(m+1)/c,a])}static applyTransform(e,i){const a=e.getCorners();for(let c=0;c<a.length;++c)ei(a[c],a[c],i);return An.fromPoints(a)}static applyTransformFast(e,i){const a=[i[12],i[13],i[14]],c=[...a];for(let p=0;p<3;p++)for(let m=0;m<3;m++){const v=i[4*m+p],T=v*e.min[m],E=v*e.max[m];a[p]+=Math.min(T,E),c[p]+=Math.max(T,E)}return new An(a,c)}static projectAabbCorners(e,i){const a=e.getCorners();for(let c=0;c<a.length;++c)ei(a[c],a[c],i);return a}constructor(e,i){this.min=e,this.max=i,this.center=Ve([],Et([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=It(this.min),c=It(this.max);for(let p=0;p<i.length;p++)a[p]=i[p]?this.min[p]:this.center[p],c[p]=i[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new An(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Nn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Nn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?pr(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?pr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}mi(An,"Aabb");class na{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,a=i[1],c=-i[0],p=(e.extent+1)*this.metersToTile;return[new Qt(Math.trunc(e.position[0]+a*p),Math.trunc(e.position[1]+c*p)),new Qt(Math.trunc(e.position[0]-a*p),Math.trunc(e.position[1]-c*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Ia{constructor(e,i,a,c,p,m){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:a,max:a},this.safeArea=i,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||c.length!==0)){this.vertices=c,this.edges=p,this.edges=this.edges.filter(v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((T=this.vertices[v.a].position)[0]===(E=this.vertices[v.b].position)[0]&&T[1]===E[1]);var T,E}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:aa(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const T=this.vertices[v.a].position,E=this.vertices[v.b].position,R=bs(xs(),E,T),D=oa(R),P=Os(xs(),R,1/D);this.edgeProps.push({vec:R,dir:P,len:D});const j=this.vertexProps[v.a].dir,G=this.vertexProps[v.b].dir;Na(j,j,P),Na(G,G,P)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||_a(v.dir,v.dir);this.tessellate(m)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[a,c]=i;return zi(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,c)}computeSlopeNormal(e,i){const a=this.getClosestEdge(e);if(!a)return ct(0,0,1);const c=a[0],p=this.edges[c],m=this.edgeProps[c].vec,v=ct(m[0],m[1],(this.vertices[p.b].height-this.vertices[p.a].height)*i),T=ct(v[1],-v[0],0);_i(T,T,v);const E=Lt(T);return E>0?Ve(T,T,1/E):ct(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,a=Number.POSITIVE_INFINITY,c=0;const p=aa(e.x,e.y);for(let m=0;m<this.edges.length;m++){const v=this.edges[m],T=this.edgeProps[m].dir,E=new ar(p,this.edgeProps[m].dir),R=this.vertices[v.a].position,D=this.vertices[v.b].position,P=xs(),j=xs(),G=E.intersectsPlane(R,this.vertexProps[v.a].dir,P),Z=E.intersectsPlane(D,this.vertexProps[v.b].dir,j);if(!G||!Z)continue;const K=bs(xs(),j,P),te=bs(xs(),p,P),ce=On(K,K),he=ce>0?On(te,K)/ce:0,Y=Me(he,0,1),le=Math.abs((he-Y)*this.edgeProps[m].len),de=bs(xs(),p,R),be=le+Math.abs(On(de,aa(T[1],-T[0])));be<a&&(i=m,a=be,c=Y)}return[i,c]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const a=this.edges[i].a,c=this.edges[i].b,{position:p,height:m,extent:v}=this.vertices[a],{position:T,height:E,extent:R}=this.vertices[c],D=this.vertexProps[a].dir,P=this.vertexProps[c].dir,j=ct(p[0]/e,p[1]/e,m),G=ct(T[0]/e,T[1]/e,E),Z=ct(D[1],-D[0],0);Ve(Z,Z,v);const K=ct(P[1],-P[0],0);if(Ve(K,K,R),this.distSqLines(ct(j[0]+.5*Z[0],j[1]+.5*Z[1],j[2]+.5*Z[2]),ct(G[0]-.5*K[0],G[1]-.5*K[1],G[2]-.5*K[2]),ct(j[0]-.5*Z[0],j[1]-.5*Z[1],j[2]-.5*Z[2]),ct(G[0]+.5*K[0],G[1]+.5*K[1],G[2]+.5*K[2]))<=.0025000000000000005)continue;const te=this.vertices.length,ce=Na(xs(),p,T);this.vertices.push({position:Os(ce,ce,.5),height:.5*(m+E),extent:.5*(v+R)});const he=Na(xs(),D,P);this.vertexProps.push({dir:_a(he,he)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a,b:te}),this.edges.push({a:te,b:c});const Y=bs(xs(),this.vertices[te].position,p),le=oa(Y),de={vec:Y,dir:Os(xs(),Y,1/le),len:le};this.edgeProps.push(de),this.edgeProps.push(de)}}distSqLines(e,i,a,c){const p=Qe($e(),i,e),m=Qe($e(),c,a),v=Qe($e(),e,a),T=Rt(p,p),E=Rt(p,m),R=Rt(p,v),D=Rt(m,m),P=Rt(m,v),j=T*D-E*E;if(j===0){const K=Rt(v,m)/Rt(m,m);return ti(Oi($e(),a,c,K),e)}const G=(E*P-R*D)/j,Z=(T*P-E*R)/j;return ti(Oi($e(),e,i,G),Oi($e(),a,c,Z))}}class uo{static parseFrom(e,i){const a=yn.parse(e);if(!a)return[];let{vertices:c,features:p}=a;const m=1/lt(i);p.sort((R,D)=>R.id-D.id),c.sort((R,D)=>R.id-D.id||R.idx-D.idx),c=c.filter((R,D,P)=>D===P.findIndex(j=>j.id===R.id&&j.idx===R.idx));const v=new Array;let T=0;const E=c.length;for(const R of p){if(R.constantHeight){v.push(new Ia(R.id,R.bounds,R.constantHeight));continue}for(;T!==E&&c[T].id<R.id;)T++;if(T===E||c[T].id!==R.id)continue;const D=new Array,P=new Array,j=T;for(;T!==E&&c[T].id===R.id;){const G=c[T];if(D.push({position:G.position,height:G.height,extent:G.extent}),T!==j&&c[T-1].idx===G.idx-1){const Z=T-j;P.push({a:Z-1,b:Z})}T++}v.push(new Ia(R.id,R.bounds,void 0,D,P,m))}return v}static getElevationFeature(e,i){if(!i)return;const a=+e.properties[Ui];return Number.isNaN(a)?void 0:i.find(c=>c.id===a)}}class rl{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Kt,this.yOffset=(e.y*this.zScale-i.y)*Kt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,a){const c=this.constantElevation(i,a);return c??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),a))}computeBiasedHeight(e,i){return i<=0?e:e+i*He(0,i,e>=0?e:Math.abs(.5*e))}}mi(Ia,"ElevationFeature");class Za{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Qo,this.indexArray=new ls,this.segments=new kr,this.programConfigurations=new u(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Tl),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,c){const p=this.layers[0],m=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:E,id:R,index:D,sourceLayerIndex:P}of e){const j=this.layers[0]._featureFilter.needGeometry,G=hi(E,j);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom,{worldview:this.worldview}),G,a))continue;const Z=v?v.evaluate(G,{},a):void 0,K={id:R,properties:E.properties,type:E.type,sourceLayerIndex:P,index:D,geometry:j?G.geometry:di(E,a,c),patterns:{},sortKey:Z};m.push(K)}v&&m.sort((E,R)=>E.sortKey-R.sortKey);let T=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new Nu,T=c.projection);for(const E of m){const{geometry:R,index:D,sourceLayerIndex:P}=E,j=e[D].feature;this.addFeature(E,R,D,i.availableImages,a,T,i.brightness,i.elevationFeatures),i.featureIndex.insert(j,R,D,P,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,a,c,p,m,v){this.programConfigurations.updatePaintArrays(e,i,p,a,c,m,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,zd.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Vm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,a,c,p,m,v,T){let E;this.elevationMode!=="none"&&(E=uo.getElevationFeature(e,T));for(const R of i)for(const D of R){const P=D.x,j=D.y;if(P<0||P>=Kt||j<0||j>=Kt)continue;if(m){const K=m.projectTilePoint(P,j,p),te=m.upVector(p,P,j);this.addGlobeExtVertex(K,te),this.addGlobeExtVertex(K,te),this.addGlobeExtVertex(K,te),this.addGlobeExtVertex(K,te)}const G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),Z=G.vertexLength;if(this.addCircleVertex(P,j,-1,-1),this.addCircleVertex(P,j,1,-1),this.addCircleVertex(P,j,1,1),this.addCircleVertex(P,j,-1,1),this.elevationMode!=="none"){const K=E?E.pointElevation(new Qt(P,j)):0;this.hasElevation=this.hasElevation||K!==0;for(let te=0;te<4;te++)this.elevatedLayoutVertexArray.emplaceBack(K)}this.indexArray.emplaceBack(Z,Z+1,Z+2),this.indexArray.emplaceBack(Z,Z+2,Z+3),G.vertexLength+=4,G.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,p,v,void 0,this.worldview)}addCircleVertex(e,i,a,c){this.layoutVertexArray.emplaceBack(2*e+(a+1)/2,2*i+(c+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Ra(n,e){for(let i=0;i<n.length;i++)if(Al(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Al(n,e[i]))return!0;return!!Nh(n,e)}function qs(n,e,i){return!!Al(n,e)||!!au(e,n,i)}function sl(n,e){if(n.length===1)return Pc(e,n[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let c=0;c<a.length;c++)if(Al(n,a[c]))return!0}for(let i=0;i<n.length;i++)if(Pc(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Nh(n,e[i]))return!0;return!1}function $s(n,e,i){if(n.length>1){if(Nh(n,e))return!0;for(let a=0;a<e.length;a++)if(au(e[a],n,i))return!0}for(let a=0;a<n.length;a++)if(au(n[a],e,i))return!0;return!1}function Nh(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const a=n[i],c=n[i+1];for(let p=0;p<e.length-1;p++)if(qf(a,c,e[p],e[p+1]))return!0}return!1}function qf(n,e,i,a){return Hn(n,i,a)!==Hn(e,i,a)&&Hn(n,e,i)!==Hn(n,e,a)}function Fh(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function sc(n,e,i,a){const c=Fh(n,e,a),p=Fh(n,e,i);if(Math.sign(c)===Math.sign(p))return;const m=Fh(i,a,n),v=m+p-c;return Math.sign(m)!==Math.sign(v)?[m/(m-v),p/(p-c)]:void 0}function au(n,e,i){const a=i*i;if(e.length===1)return n.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(Bh(n,e[c-1],e[c])<a)return!0;return!1}function Bh(n,e,i){const a=e.distSqr(i);if(a===0)return n.distSqr(e);const c=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/a;return n.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function Pc(n,e){let i,a,c,p=!1;for(let m=0;m<n.length;m++){i=n[m];for(let v=0,T=i.length-1;v<i.length;T=v++)a=i[v],c=i[T],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(p=!p)}return p}function Al(n,e){let i=!1;for(let a=0,c=n.length-1;a<n.length;c=a++){const p=n[a],m=n[c];p.y>e.y!=m.y>e.y&&e.x<(m.x-p.x)*(e.y-p.y)/(m.y-p.y)+p.x&&(i=!i)}return i}function Gu(n,e,i,a,c){for(const m of n)if(e<=m.x&&i<=m.y&&a>=m.x&&c>=m.y)return!0;const p=[new Qt(e,i),new Qt(e,c),new Qt(a,c),new Qt(a,i)];if(n.length>2){for(const m of p)if(Al(n,m))return!0}for(let m=0;m<n.length-1;m++)if(ou(n[m],n[m+1],p))return!0;return!1}function ou(n,e,i){const a=i[0],c=i[2];if(n.x<a.x&&e.x<a.x||n.x>c.x&&e.x>c.x||n.y<a.y&&e.y<a.y||n.y>c.y&&e.y>c.y)return!1;const p=Hn(n,e,i[0]);return p!==Hn(n,e,i[1])||p!==Hn(n,e,i[2])||p!==Hn(n,e,i[3])}function ac(n,e,i,a,c,p){let m=e.y-n.y,v=n.x-e.x;if(p=p||0){const T=m*m+v*v;if(T===0)return!0;const E=Math.sqrt(T);m/=E,v/=E}return!((i.x-n.x)*m+(i.y-n.y)*v-p<0||(a.x-n.x)*m+(a.y-n.y)*v-p<0||(c.x-n.x)*m+(c.y-n.y)*v-p<0)}function Xp(n,e,i,a,c,p,m){return!(ac(n,e,a,c,p,m)||ac(e,i,a,c,p,m)||ac(i,n,a,c,p,m)||ac(a,c,n,e,i,m)||ac(c,p,n,e,i,m)||ac(p,a,n,e,i,m))}function $f(n,e,i){const a=e.paint.get(n).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Um(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function my(n,e,i,a,c){if(!e[0]&&!e[1])return n;const p=Qt.convert(e)._mult(c);i==="viewport"&&p._rotate(-a);const m=[];for(let v=0;v<n.length;v++)m.push(n[v].sub(p));return m}function Gg(n,e,i,a){const c=Qt.convert(n)._mult(a);return e==="viewport"&&c._rotate(-i),c}let Hg,Bd;function Yp(n,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}mi(Za,"CircleBucket",{omit:["layers"]});class jh{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=jd(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const a=function(p,m,v){var T=Yp(256*p,256*(m=Math.pow(2,v)-m-1),v),E=Yp(256*(p+1),256*(m+1),v);return T[0]+","+T[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),c=function(p,m,v){let T,E="";for(let R=p;R>0;R--)T=1<<R-1,E+=(m&T?1:0)+(v&T?2:0);return E}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qg{constructor(e,i){this.wrap=e,this.canonical=i,this.key=jd(e,i.z,i.z,i.x,i.y)}}class Da{constructor(e,i,a,c,p){this.overscaledZ=e,this.wrap=i,this.canonical=new jh(a,+c,+p),this.key=i===0&&e===a?this.canonical.key:jd(i,e,a,c,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Da(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Da(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return jd(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return jd(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Da(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new Da(i,this.wrap,i,a,c),new Da(i,this.wrap,i,a+1,c),new Da(i,this.wrap,i,a,c+1),new Da(i,this.wrap,i,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Da(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Da(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function jd(n,e,i,a,c){const p=1<<Math.min(i,22);let m=p*(c%p)+a%p;return n&&i<22&&(m+=p*p*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*m+i)+(e-i)}const gy=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new Da(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new Da(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new Da(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new Da(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];mi(jh,"CanonicalTileID"),mi(Da,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const _y=En([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Vd}=_y,yy=En([{name:"a_pos_3",components:3,type:"Int16"}]);var $g=En([{name:"a_pos",type:"Int16",components:2}]);function ts(n){return n*b/J}const Zg=[new An([V,V,V],[H,H,H]),new An([V,V,V],[0,0,H]),new An([0,V,V],[H,0,H]),new An([V,0,V],[0,H,H]),new An([0,0,V],[H,H,H])];function vy(n,e,i,a=!0){const c=Ve([],n._camera.position,n.worldSize),p=[e,i,1,1];Or(p,p,n.pixelMatrixInverse),gs(p,p,1/p[3]);const m=at([],Qi([],p,c)),v=n.globeMatrix,T=[v[12],v[13],v[14]],E=Qi([],T,c),R=Lt(E),D=at([],E),P=n.worldSize/(2*Math.PI),j=Rt(D,m),G=Math.asin(P/R);if(G<Math.acos(j)){if(!a)return null;const Be=[],We=[];Ve(Be,m,R/j),at(We,Qi(We,Be,E)),at(m,Et(m,E,Ve(m,We,Math.tan(G)*R)))}const Z=[];new ur(c,m).closestPointOnSphere(T,P,Z);const K=at([],dr(v,0)),te=at([],dr(v,1)),ce=at([],dr(v,2)),he=Rt(K,Z),Y=Rt(te,Z),le=Rt(ce,Z),de=nt(Math.asin(-Y/P));let be=nt(Math.atan2(he,le));be=n.center.lng+function(Be,We){const dt=(We-Be+180)%360-180;return dt<-180?dt+360:dt}(n.center.lng,be);const Fe=Ce(be),ze=Me(Ae(de),0,1);return new Ge(Fe,ze)}class xy{constructor(e,i,a){this.a=Qi([],e,a),this.b=Qi([],i,a),this.center=a;const c=at([],this.a),p=at([],this.b);this.angle=Math.acos(Rt(c,p))}}function Wg(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(a,c,p,m){const v=Math.sin(p);return a*(Math.sin((1-m)*p)/v)+c*(Math.sin(m*p)/v)}(n.a[e],n.b[e],n.angle,Me(i,0,1))+n.center[e]}function lu(n){if(n.z<=1)return Zg[n.z+2*n.y+n.x];const e=Wf(Zf(n));return An.fromPoints(e)}function Hu(n,e,i){return Ve(n,n,1-i),Dt(n,n,e,i)}function Kp(n,e,i){for(const a of n)ei(a,a,e),Ve(a,a,i)}function Ud(n,e,i,a){const c=e/n.worldSize,p=n.globeMatrix;if(i.z<=1){const ze=lu(i).getCorners();return Kp(ze,p,c),An.fromPoints(ze)}const m=Zf(i,a),v=Wf(m,b+ts(n._tileCoverLift));Kp(v,p,c);const T=Number.MAX_VALUE,E=[-T,-T,-T],R=[T,T,T];if(m.contains(n.center)){for(const We of v)ii(R,R,We),Li(E,E,We);E[2]=0;const ze=n.point,Be=[ze.x*c,ze.y*c,0];return ii(R,R,Be),Li(E,E,Be),new An(R,E)}if(n._tileCoverLift>0){for(const ze of v)ii(R,R,ze),Li(E,E,ze);return new An(R,E)}const D=[p[12]*c,p[13]*c,p[14]*c],P=m.getCenter(),j=Me(n.center.lat,-85.051129,mt),G=Me(P.lat,-85.051129,mt),Z=Ce(n.center.lng),K=Ae(j);let te=Z-Ce(P.lng);const ce=K-Ae(G);te>.5?te-=1:te<-.5&&(te+=1);let he=0;Math.abs(te)>Math.abs(ce)?he=te>=0?1:3:(he=ce>=0?0:2,Dt(D,D,[p[4]*c,p[5]*c,p[6]*c],-Math.sin(wn(ce>=0?m.getSouth():m.getNorth()))*b));const Y=v[he],le=v[(he+1)%4],de=new xy(Y,le,D),be=[Wg(de,0)||Y[0],Wg(de,1)||Y[1],Wg(de,2)||Y[2]],Fe=qu(n.zoom);if(Fe>0){const ze=function({x:We,y:dt,z:Bt},St,Nt,Gt,pt){const Ot=1/(1<<Bt);let ut=We*Ot,ft=ut+Ot,Zt=dt*Ot,Yt=Zt+Ot,ki=0;const Ti=(ut+ft)/2-Gt;return Ti>.5?ki=-1:Ti<-.5&&(ki=1),ut=((ut+ki)*St-(Gt*=St))*Nt+Gt,ft=((ft+ki)*St-Gt)*Nt+Gt,Zt=(Zt*St-(pt*=St))*Nt+pt,Yt=(Yt*St-pt)*Nt+pt,[[ut,Yt,0],[ft,Yt,0],[ft,Zt,0],[ut,Zt,0]]}(i,e,n._pixelsPerMercatorPixel,Z,K);for(let We=0;We<v.length;We++)Hu(v[We],ze[We],Fe);const Be=Et([],ze[he],ze[(he+1)%4]);Ve(Be,Be,.5),Hu(be,Be,Fe)}for(const ze of v)ii(R,R,ze),Li(E,E,ze);return R[2]=Math.min(Y[2],le[2]),ii(R,R,be),Li(E,E,be),new An(R,E)}function Zf({x:n,y:e,z:i},a=!1){const c=1/(1<<i),p=new oe(Ne(n*c),e===(1<<i)-1&&a?-90:Ke((e+1)*c)),m=new oe(Ne((n+1)*c),e===0&&a?90:Ke(e*c));return new ve(p,m)}function Wf(n,e=b){const i=wn(n.getNorth()),a=wn(n.getSouth()),c=Math.cos(i),p=Math.cos(a),m=Math.sin(i),v=Math.sin(a),T=n.getWest(),E=n.getEast();return[Q(p,v,T,e),Q(p,v,E,e),Q(c,m,E,e),Q(c,m,T,e)]}function Gd(n,e,i,a){const c=1<<i.z,p=(n/Kt+i.x)/c;return X(Ke((e/Kt+i.y)/c),Ne(p),a)}function cu({min:n,max:e}){return O/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Oc=new Float64Array(16);function Vh(n){const e=cu(n),i=At(Oc,[e,e,e]);return fe(i,i,Mi([],n.min))}function Xg(n){const e=(a=n.min,(i=Oc)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i);var i,a;const c=1/cu(n);return se(e,e,[c,c,c])}function Gm(n){const e=Kt/(2*Math.PI);return n/(2*Math.PI)/e}function Yg(n,e){return Kt/(512*Math.pow(2,n))*cu(lu(e))}function Kg(n,e,i,a,c){const p=Gm(i),m=[n,e,-i/(2*Math.PI)],v=me(new Float64Array(16));return fe(v,v,m),se(v,v,[p,p,p]),De(v,v,wn(-c)),we(v,v,wn(-a)),v}function qu(n){return He(C,I,n)}function by(n,e){const i=X(e.lat,e.lng),a=function(G){const Z=X(G._center.lat,G._center.lng);let K=_i([],ct(0,1,0),Z);const te=gt([],-G.angle,Z);K=ei(K,K,te),gt(te,-G._pitch,K);const ce=at([],Z);return Ve(ce,ce,ts(G.cameraToCenterDistance/G.pixelsPerMeter)),ei(ce,ce,te),Et([],Z,ce)}(n);return m=(c=Qe([],a,i))[0],v=c[1],T=c[2],E=(p=i)[0],R=p[1],D=p[2],j=(P=Math.sqrt(m*m+v*v+T*T)*Math.sqrt(E*E+R*R+D*D))&&Rt(c,p)/P,Math.acos(Math.min(Math.max(j,-1),1));var c,p,m,v,T,E,R,D,P,j}function Qp(n,e){return by(n,e)>Math.PI/2*1.01}const Qg=wn(85),wy=Math.cos(Qg),v0=Math.sin(Qg),Jg=_e(),Hm=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Ty(n,e,i,a,c,p,m,v,T){if(p&&n.queryGeometry.isAboveHorizon)return!1;p&&(T*=n.pixelToTileUnitsFactor);const E=n.tileID.canonical,R=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const D of e)for(const P of D){const j=P.add(v),G=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(j.x,j.y,!0):0,Z=i.projection.projectTilePoint(j.x,j.y,E);if(G>0){const he=i.projection.upVector(E,j.x,j.y);Z.x+=he[0]*R*G,Z.y+=he[1]*R*G,Z.z+=he[2]*R*G}const K=p?j:x0(Z.x,Z.y,Z.z,a),te=p?n.tilespaceRays.map(he=>Sy(he,G)):n.queryGeometry.screenGeometry,ce=Or([],[Z.x,Z.y,Z.z,1],a);if(!m&&p?T*=ce[3]/i.cameraToCenterDistance:m&&!p&&(T*=i.cameraToCenterDistance/ce[3]),p){const he=Ke((P.y/Kt+E.y)/(1<<E.z));T/=i.projection.pixelsPerMeter(he,1)/Pe(1,he)}if(qs(te,K,T))return!0}return!1}function x0(n,e,i,a){const c=Or([],[n,e,i,1],a);return new Qt(c[0]/c[3],c[1]/c[3])}const Xf=ct(0,0,0),b0=ct(0,0,1);function Sy(n,e){const i=$e();return Xf[2]=e,n.intersectsPlane(Xf,b0,i),new Qt(i[0],i[1])}class br extends Za{}let qm,Jp,$m,e_;function Zm(n,{width:e,height:i},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*a);return n.width=e,n.height=i,n.data=c,n}function Yf(n,e,i){const{width:a,height:c}=e;a===n.width&&c===n.height||(Kf(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,a),height:Math.min(n.height,c)},i,null),n.width=a,n.height=c,n.data=e.data)}function Kf(n,e,i,a,c,p,m,v){if(c.width===0||c.height===0)return e;if(c.width>n.width||c.height>n.height||i.x>n.width-c.width||i.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const T=n.data,E=e.data,R=p===4&&v;for(let D=0;D<c.height;D++){const P=((i.y+D)*n.width+i.x)*p,j=((a.y+D)*e.width+a.x)*p;if(R)for(let G=0;G<c.width;G++){const Z=P+G*p+3,K=j+G*p;E[K+0]=255,E[K+1]=255,E[K+2]=255,E[K+3]=T[Z]}else if(m)for(let G=0;G<c.width;G++){const Z=P+G*p,K=j+G*p,te=new ln(T[Z+0]/255,T[Z+1]/255,T[Z+2]/255,T[Z+3]).toNonPremultipliedRenderColor(m).toArray();E[K+0]=te[0],E[K+1]=te[1],E[K+2]=te[2],E[K+3]=te[3]}else for(let G=0;G<c.width*p;G++)E[j+G]=T[P+G]}return e}mi(br,"HeatmapBucket",{omit:["layers"]});class Cl{constructor(e,i){Zm(this,e,1,i)}resize(e){Yf(this,new Cl(e),1)}clone(){return new Cl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,c,p){Kf(e,i,a,c,p,1,null)}}class ra{constructor(e,i){Zm(this,e,4,i)}resize(e){Yf(this,new ra(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ra({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,c,p,m,v){Kf(e,i,a,c,p,4,m,v)}}class Ey{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function em(n){const e={},i=n.resolution||256,a=n.clips?n.clips.length:1,c=n.image||new ra({width:i,height:a}),p=(m,v,T)=>{e[n.evaluationKey]=T;const E=n.expression.evaluate(e),R=E?E.toNonPremultipliedRenderColor(null):null;R&&(c.data[m+v+0]=Math.floor(255*R.r),c.data[m+v+1]=Math.floor(255*R.g),c.data[m+v+2]=Math.floor(255*R.b),c.data[m+v+3]=Math.floor(255*R.a))};if(n.clips)for(let m=0,v=0;m<a;++m,v+=4*i)for(let T=0,E=0;T<i;T++,E+=4){const R=T/(i-1),{start:D,end:P}=n.clips[m];p(v,E,D*(1-R)+P*R)}else for(let m=0,v=0;m<i;m++,v+=4)p(0,v,m/(i-1));return c}mi(Cl,"AlphaImage"),mi(ra,"RGBAImage");const Ay=En([{name:"a_pos",components:2,type:"Int16"}],4),Cy=En([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Wm=En([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),ps=En([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Hd(n,e,i=2){const a=e&&e.length,c=a?e[0]*i:n.length;let p=Wa(n,0,c,i,!0);const m=[];if(!p||p.next===p.prev)return m;let v,T,E;if(a&&(p=function(R,D,P,j){const G=[];for(let Z=0,K=D.length;Z<K;Z++){const te=Wa(R,D[Z]*j,Z<K-1?D[Z+1]*j:R.length,j,!1);te===te.next&&(te.steiner=!0),G.push(T0(te))}G.sort(i_);for(let Z=0;Z<G.length;Z++)P=n_(G[Z],P);return P}(n,e,p,i)),n.length>80*i){v=1/0,T=1/0;let R=-1/0,D=-1/0;for(let P=i;P<c;P+=i){const j=n[P],G=n[P+1];j<v&&(v=j),G<T&&(T=G),j>R&&(R=j),G>D&&(D=G)}E=Math.max(R-v,D-T),E=E!==0?32767/E:0}return $d(p,m,i,v,T,E,0),m}function Wa(n,e,i,a,c){let p;if(c===function(m,v,T,E){let R=0;for(let D=v,P=T-E;D<T;D+=E)R+=(m[P]-m[D])*(m[D+1]+m[P+1]),P=D;return R}(n,e,i,a)>0)for(let m=e;m<i;m+=a)p=oc(m/a|0,n[m],n[m+1],p);else for(let m=i-a;m>=e;m-=a)p=oc(m/a|0,n[m],n[m+1],p);return p&&Zd(p,p.next)&&(Xd(p),p=p.next),p}function qd(n,e){if(!n)return n;e||(e=n);let i,a=n;do if(i=!1,a.steiner||!Zd(a,a.next)&&is(a.prev,a,a.next)!==0)a=a.next;else{if(Xd(a),a=e=a.prev,a===a.next)break;i=!0}while(i||a!==e);return e}function $d(n,e,i,a,c,p,m){if(!n)return;!m&&p&&function(T,E,R,D){let P=T;do P.z===0&&(P.z=Ym(P.x,P.y,E,R,D)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==T);P.prevZ.nextZ=null,P.prevZ=null,function(j){let G,Z=1;do{let K,te=j;j=null;let ce=null;for(G=0;te;){G++;let he=te,Y=0;for(let de=0;de<Z&&(Y++,he=he.nextZ,he);de++);let le=Z;for(;Y>0||le>0&&he;)Y!==0&&(le===0||!he||te.z<=he.z)?(K=te,te=te.nextZ,Y--):(K=he,he=he.nextZ,le--),ce?ce.nextZ=K:j=K,K.prevZ=ce,ce=K;te=he}ce.nextZ=null,Z*=2}while(G>1)}(P)}(n,a,c,p);let v=n;for(;n.prev!==n.next;){const T=n.prev,E=n.next;if(p?Xm(n,a,c,p):t_(n))e.push(T.i,n.i,E.i),Xd(n),n=E.next,v=E.next;else if((n=E)===v){m?m===1?$d(n=My(qd(n),e),e,i,a,c,p,2):m===2&&Iy(n,e,i,a,c,p):$d(qd(n),e,i,a,c,p,1);break}}}function t_(n){const e=n.prev,i=n,a=n.next;if(is(e,i,a)>=0)return!1;const c=e.x,p=i.x,m=a.x,v=e.y,T=i.y,E=a.y,R=Math.min(c,p,m),D=Math.min(v,T,E),P=Math.max(c,p,m),j=Math.max(v,T,E);let G=a.next;for(;G!==e;){if(G.x>=R&&G.x<=P&&G.y>=D&&G.y<=j&&tm(c,v,p,T,m,E,G.x,G.y)&&is(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function Xm(n,e,i,a){const c=n.prev,p=n,m=n.next;if(is(c,p,m)>=0)return!1;const v=c.x,T=p.x,E=m.x,R=c.y,D=p.y,P=m.y,j=Math.min(v,T,E),G=Math.min(R,D,P),Z=Math.max(v,T,E),K=Math.max(R,D,P),te=Ym(j,G,e,i,a),ce=Ym(Z,K,e,i,a);let he=n.prevZ,Y=n.nextZ;for(;he&&he.z>=te&&Y&&Y.z<=ce;){if(he.x>=j&&he.x<=Z&&he.y>=G&&he.y<=K&&he!==c&&he!==m&&tm(v,R,T,D,E,P,he.x,he.y)&&is(he.prev,he,he.next)>=0||(he=he.prevZ,Y.x>=j&&Y.x<=Z&&Y.y>=G&&Y.y<=K&&Y!==c&&Y!==m&&tm(v,R,T,D,E,P,Y.x,Y.y)&&is(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;he&&he.z>=te;){if(he.x>=j&&he.x<=Z&&he.y>=G&&he.y<=K&&he!==c&&he!==m&&tm(v,R,T,D,E,P,he.x,he.y)&&is(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;Y&&Y.z<=ce;){if(Y.x>=j&&Y.x<=Z&&Y.y>=G&&Y.y<=K&&Y!==c&&Y!==m&&tm(v,R,T,D,E,P,Y.x,Y.y)&&is(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function My(n,e){let i=n;do{const a=i.prev,c=i.next.next;!Zd(a,c)&&Km(a,i,i.next,c)&&Wd(a,c)&&Wd(c,a)&&(e.push(a.i,i.i,c.i),Xd(i),Xd(i.next),i=n=c),i=i.next}while(i!==n);return qd(i)}function Iy(n,e,i,a,c,p){let m=n;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&S0(m,v)){let T=Ry(m,v);return m=qd(m,m.next),T=qd(T,T.next),$d(m,e,i,a,c,p,0),void $d(T,e,i,a,c,p,0)}v=v.next}m=m.next}while(m!==n)}function i_(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function n_(n,e){const i=function(c,p){let m=p;const v=c.x,T=c.y;let E,R=-1/0;if(Zd(c,m))return m;do{if(Zd(c,m.next))return m.next;if(T<=m.y&&T>=m.next.y&&m.next.y!==m.y){const Z=m.x+(T-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(Z<=v&&Z>R&&(R=Z,E=m.x<m.next.x?m:m.next,Z===v))return E}m=m.next}while(m!==p);if(!E)return null;const D=E,P=E.x,j=E.y;let G=1/0;m=E;do{if(v>=m.x&&m.x>=P&&v!==m.x&&r_(T<j?v:R,T,P,j,T<j?R:v,T,m.x,m.y)){const Z=Math.abs(T-m.y)/(v-m.x);Wd(m,c)&&(Z<G||Z===G&&(m.x>E.x||m.x===E.x&&w0(E,m)))&&(E=m,G=Z)}m=m.next}while(m!==D);return E}(n,e);if(!i)return e;const a=Ry(i,n);return qd(a,a.next),qd(i,i.next)}function w0(n,e){return is(n.prev,n,e.prev)<0&&is(e.next,n,n.next)<0}function Ym(n,e,i,a,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function T0(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function r_(n,e,i,a,c,p,m,v){return(c-m)*(e-v)>=(n-m)*(p-v)&&(n-m)*(a-v)>=(i-m)*(e-v)&&(i-m)*(p-v)>=(c-m)*(a-v)}function tm(n,e,i,a,c,p,m,v){return!(n===m&&e===v)&&r_(n,e,i,a,c,p,m,v)}function S0(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,a){let c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==a.i&&c.next.i!==a.i&&Km(c,c.next,i,a))return!0;c=c.next}while(c!==i);return!1}(n,e)&&(Wd(n,e)&&Wd(e,n)&&function(i,a){let c=i,p=!1;const m=(i.x+a.x)/2,v=(i.y+a.y)/2;do c.y>v!=c.next.y>v&&c.next.y!==c.y&&m<(c.next.x-c.x)*(v-c.y)/(c.next.y-c.y)+c.x&&(p=!p),c=c.next;while(c!==i);return p}(n,e)&&(is(n.prev,n,e.prev)||is(n,e.prev,e))||Zd(n,e)&&is(n.prev,n,n.next)>0&&is(e.prev,e,e.next)>0)}function is(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Zd(n,e){return n.x===e.x&&n.y===e.y}function Km(n,e,i,a){const c=Jm(is(n,e,i)),p=Jm(is(n,e,a)),m=Jm(is(i,a,n)),v=Jm(is(i,a,e));return c!==p&&m!==v||!(c!==0||!Qm(n,i,e))||!(p!==0||!Qm(n,a,e))||!(m!==0||!Qm(i,n,a))||!(v!==0||!Qm(i,e,a))}function Qm(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Jm(n){return n>0?1:n<0?-1:0}function Wd(n,e){return is(n.prev,n,n.next)<0?is(n,e,n.next)>=0&&is(n,n.prev,e)>=0:is(n,e,n.prev)<0||is(n,n.next,e)<0}function Ry(n,e){const i=eg(n.i,n.x,n.y),a=eg(e.i,e.x,e.y),c=n.next,p=e.prev;return n.next=e,e.prev=n,i.next=c,c.prev=i,a.next=i,i.prev=a,p.next=a,a.prev=p,a}function oc(n,e,i,a){const c=eg(n,e,i);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Xd(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function eg(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function im(n,e){const i=n.length;if(i<=1)return[n];const a=[];let c,p;for(let m=0;m<i;m++){const v=ir(n[m]);v!==0&&(n[m].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(c&&a.push(c),c=[n[m]]):c.push(n[m]))}if(c&&a.push(c),e>1)for(let m=0;m<a.length;m++)a[m].length<=e||(Ca(a[m],e,1,a[m].length-1,nm),a[m]=a[m].slice(0,e));return a}function nm(n,e){return e.area-n.area}function Ml(n,e,i=1){if(!n)return null;const a=typeof n=="string"?Hs.from(n).getPrimary():n.getPrimary(),c=typeof n=="string"?null:n.getSecondary();for(const p of[a,c]){if(!p)continue;const m=p.id.toString();e.has(m)||e.set(m,[]),p.scaleSelf(i),e.get(m).push(p)}return{primary:a.toString(),secondary:c?c.toString():null}}function tg(n,e,i,a){const c=a.patternDependencies;let p=!1;for(const m of e){const v=m.paint.get(`${n}-pattern`);v.isConstant()||(p=!0),Ml(v.constantOr(null),c,i)&&(p=!0)}return p}function Qf(n,e,i,a,c,p){const m=p.patternDependencies;for(const v of e){const T=v.paint.get(`${n}-pattern`).value;if(T.kind!=="constant"){let E=T.evaluate({zoom:a},i,{},p.availableImages);E=E&&E.name?E.name:E;const R=Ml(E,m,c);if(!R)continue;const{primary:D,secondary:P}=R;D&&(i.patterns[v.id]=[D,P].filter(Boolean))}}return i}class uu{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,a]of e.polygons)this.add(i,...a)}}class Yd{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new Yd;let i=[];for(const E of e)i.push(...E.portals);if(i.length===0)return new Yd;const a=(E,R)=>E<=0&&R<=0||E>=Kt&&R>=Kt;for(const E of i){const R=E.va,D=E.vb;(a(R.x,D.x)||a(R.y,D.y))&&(E.type="border")}const c=i.filter(E=>E.type!=="unevaluated"),p=i.filter(E=>E.type==="unevaluated");if(p.length===0)return new Yd;p.sort((E,R)=>E.hash===R.hash?E.isTunnel===R.isTunnel?0:E.isTunnel?-1:1:E.hash<R.hash?1:-1),i=c.concat(p);let m=c.length,v=m,T=m;do if(v++,v===i.length||i[m].hash!==i[v].hash){if(v-m==2){T<m&&(i[T]=i[m],i[m]=null);const E=i[T],R=i[v-1];E.type=E.isTunnel!==R.isTunnel?"tunnel":"polygon",E.connection={a:E.connection.a,b:R.connection.a},T++}m=v}while(m!==i.length);return i.splice(T),i.sort((E,R)=>E.hash<R.hash?1:-1),{portals:i}}}mi(Yd,"ElevationPortalGraph"),mi(uu,"ElevationPolygons");class E0{constructor(e,i,a){this.outPositions=e,this.outNormals=i,this.outIndices=a,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,a){let c=e[2];a!=null&&(c*=a);const p=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),m=this.vertexLookup.get(p);if(m!=null)return m;const v=this.outPositions.length;this.vertexLookup.set(p,v);const T=Math.trunc(16384*i[0]),E=Math.trunc(16384*i[1]),R=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],c),this.outNormals.emplaceBack(T,E,R),v}addVertices(e,i,...a){const c=[];for(const p of a){const m=this.addVertex(p,e,i);c.push(m)}return c}addTriangles(e,i,a){if(i&&a){const c=a.length===1,p=ct(0,0,0);for(let m=0;m<e.length;m+=3){const v=i[e[m+0]],T=i[e[m+1]],E=i[e[m+2]],R=c?a[0]:a[e[m+1]],D=c?a[0]:a[e[m+2]],P=this.addVertex(ct(v.x,v.y,c?a[0]:a[e[m+0]]),p),j=this.addVertex(ct(T.x,T.y,R),p),G=this.addVertex(ct(E.x,E.y,D),p);this.outIndices.emplaceBack(P,j,G)}}else for(let c=0;c<e.length;c+=3)this.outIndices.emplaceBack(e[c+0],e[c+1],e[c+2])}addQuad(e,i){const a=this.addVertices(i,void 0,...e.map(T=>ct(T.coord.x,T.coord.y,T.height))),[c,p,m,v]=a;this.addTriangles([c,p,m,m,v,c])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Pa{constructor(e,i,a,c){this.unevaluatedPortals=new Yd,this.portalPolygons=new uu,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Of,this.vertexNormals=new Dd,this.indexArray=new ls,this.tileToMeters=lt(e),this.bridgeProgramConfigurations=new u(i,{zoom:a,lut:c},p=>p!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new u(i,{zoom:a,lut:c},p=>p!=="fill-bridge-guard-rail-color")}addVertices(e,i){const a=this.unevalVertices.length;for(let c=0;c<e.length;c++)this.unevalVertices.push(e[c]),this.unevalHeights.push(i[c]);return a}addTriangles(e,i,a){const c=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of e)c.push(p+i)}addRenderableRing(e,i,a,c,p,m){const v=[new Qt(p.min.x,p.min.y),new Qt(p.max.x,p.min.y),new Qt(p.max.x,p.max.y),new Qt(p.min.x,p.max.y)];for(let T=0;T<a-1;T++){const E=i+T,R=E+1,D=this.unevalVertices[E],P=this.unevalVertices[R];if(!(D.x>=p.min.x&&D.x<=p.max.x&&D.y>=p.min.y&&D.y<=p.max.y||P.x>=p.min.x&&P.x<=p.max.x&&P.y>=p.min.y&&P.y<=p.max.y||ou(D,P,v))||this.isOnBorder(D.x,P.x)||this.isOnBorder(D.y,P.y))continue;const j=Pa.computeEdgeHash(this.unevalVertices[E],this.unevalVertices[R]);let G,Z=this.vertexHashLookup.get(Pa.computePosHash(D));Z!=null?G=Z.next:(Z=this.vertexHashLookup.get(Pa.computePosHash(P)),G=Z!=null?Z.prev:j),this.unevalEdges.push({polygonIdx:e,a:E,b:R,hash:j,portalHash:G,isTunnel:c,type:"unevaluated",featureInfo:m})}}addPortalCandidates(e,i,a,c,p){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:p});const m=i[0];this.vertexHashLookup.clear();let v=Pa.computeEdgeHash(m[m.length-2],m[m.length-1]);for(let T=0;T<m.length-1;T++){const E=m[T+0],R=m[T+1],D=aa(R.x-E.x,R.y-E.y),P=oa(D);if(P===0)continue;let j="unevaluated";const G=c.pointElevation(E),Z=c.pointElevation(R);Math.abs(G)<.01&&Math.abs(Z)<.01?j="entrance":(this.isOnBorder(E.x,R.x)||this.isOnBorder(E.y,R.y))&&(j="border");const K=Pa.computeEdgeHash(E,R);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:E,vb:R,vab:D,length:P,hash:K,isTunnel:a,type:j});const te=Pa.computePosHash(E);this.vertexHashLookup.set(te,{prev:v,next:K}),v=K}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=P=>{P.primitiveLength=this.indexArray.length-P.primitiveOffset},c=new E0(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const p=i(),m=i(),v=i(),T=(P,j)=>{P.sort((Z,K)=>Z.type===j&&K.type!==j?-1:Z.type!==j&&K.type===j?1:0);const G=P.findIndex(Z=>Z.type!==j);return G>=0?G:P.length};let E=0;this.unevalEdges.length>0&&(E=T(this.unevalEdges,"none"),this.constructBridgeStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},this.tileToMeters)),a(v);const R=i(),D=i();if(this.unevalEdges.length>0){const P=this.unevalEdges.splice(E),j=T(P,"tunnel")+E;this.unevalEdges.push(...P),this.constructTunnelStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},{min:E,max:j})}a(R),c.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(D),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(m),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(p),this.maskSegments=kr.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.depthSegments=kr.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength),this.renderableBridgeSegments=kr.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=kr.simpleSegment(0,R.primitiveOffset,0,R.primitiveLength),this.shadowCasterSegments=kr.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}update(e,i,a,c,p,m,v,T){this.bridgeProgramConfigurations.updatePaintArrays(e,i,p,a,c,m,v,T),this.tunnelProgramConfigurations.updatePaintArrays(e,i,p,a,c,m,v,T)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,Wm.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,ps.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,a,c,p){const m=(v,T)=>{for(let E=0;E<T.length-1;E++){const R=T[E].featureIndex,D=T[E+1].vertexStart,P=e.feature(R);v.populatePaintArrays(D,P,R,{},a,i,c,void 0,p)}};m(this.bridgeProgramConfigurations,this.bridgeFeatureSections),m(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,a,c,p){const m=new Map;for(let v=c;v<p;v++){const T=a[v],E=T.a,R=T.b,D=Pa.computePosHash(e[E]),P=Pa.computePosHash(e[R]);m.has(D)||m.set(D,{}),m.has(P)||m.set(P,{});const j=m.get(D),G=m.get(P);i[E]<=0&&i[R]<=0||(j.to=R,G.from=E)}return m}constructBridgeStructures(e,i,a,c,p,m){e.clearVertexLookup();const v=this.computeVertexConnections(i,a,c,p.min,p.max),T=1/m,E=.5*T,R=j=>ct(i[j].x,i[j].y,a[j]*T),D=j=>{const G=v.get(Pa.computePosHash(i[j])),Z=G.from,K=G.to;if(!Z||!K)return;const te=R(Z),ce=R(j),he=R(K),Y=ct(0,0,0);if(!Rn(te,ce)){const de=Qi($e(),ce,te);Et(Y,Y,at(de,de))}if(!Rn(he,ce)){const de=Qi($e(),he,ce);Et(Y,Y,at(de,de))}const le=Fn(Y);return le>0?Ve(Y,Y,1/le):void 0};let P=Number.POSITIVE_INFINITY;this.sortSubarray(c,p.min,p.max,(j,G)=>j.featureInfo.featureIndex-G.featureInfo.featureIndex);for(let j=p.min;j<p.max;j++){const G=c[j];if(!G.featureInfo.guardRailEnabled)continue;const Z=this.prepareEdgePoints(i,a,G,(Xi,wi)=>Xi>wi);if(Z==null)continue;const K=Z[0],te=Z[1],ce=ct(K.coord.x,K.coord.y,T*K.height),he=ct(te.coord.x,te.coord.y,T*te.height);if(Rn(ce,he))continue;const Y=Qi($e(),he,ce);at(Y,Y);const le=Xi=>at(Xi,Xi),de=D(G.a)||Y,be=D(G.b)||Y,Fe=le(ct(de[1],-de[0],0)),ze=le(ct(be[1],-be[0],0)),Be=le(_i($e(),Fe,de)),We=le(_i($e(),ze,be)),dt=$e(),Bt=[Et($e(),ce,Ve(dt,Qi(dt,Fe,Be),E)),Et($e(),ce,Ve(dt,Et(dt,Fe,Be),E)),Et($e(),ce,Ve(dt,Be,E)),ce],St=[Et($e(),he,Ve(dt,Qi(dt,ze,We),E)),Et($e(),he,Ve(dt,Et(dt,ze,We),E)),Et($e(),he,Ve(dt,We,E)),he];P=this.addFeatureSection(G.featureInfo.featureIndex,P,this.bridgeFeatureSections,e);const[Nt,Gt]=e.addVertices(Fe,m,Bt[0],Bt[1]),[pt,Ot]=e.addVertices(ze,m,St[0],St[1]);e.addTriangles([Nt,Gt,pt,Gt,Ot,pt]);const[ut,ft]=e.addVertices(Be,m,Bt[1],Bt[2]),[Zt,Yt]=e.addVertices(We,m,St[1],St[2]);e.addTriangles([ut,ft,Zt,ft,Yt,Zt]);const[ki,Ti]=e.addVertices(Mi(Fe,Fe),m,Bt[2],Bt[3]),[ai,$t]=e.addVertices(Mi(ze,ze),m,St[2],St[3]);e.addTriangles([ki,Ti,ai,Ti,$t,ai])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,a,c,p,m){e.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const T=(R,D)=>R.featureInfo.featureIndex-D.featureInfo.featureIndex;this.sortSubarray(c,p.min,p.max,T),this.sortSubarray(c,m.min,m.max,T);const E=R=>at(R,R);for(let R=p.min;R<p.max;R++){const D=this.prepareEdgePoints(i,a,c[R],(Z,K)=>Z<K);if(D==null)continue;const[P,j]=D,G=E(ct(-(j.coord.y-P.coord.y),j.coord.x-P.coord.x,0));v=this.addFeatureSection(c[R].featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad([P,j,{coord:j.coord,height:c[R].isTunnel?-.1:0},{coord:P.coord,height:c[R].isTunnel?-.1:0}],G)}for(let R=m.min;R<m.max;R++){const D=c[R];D.isTunnel&&([D.a,D.b]=[D.b,D.a]);const P=i[D.a],j=i[D.b],G=E(ct(-(j.y-P.y),j.x-P.x,0));v=this.addFeatureSection(D.featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad([{coord:j,height:0},{coord:P,height:0},{coord:P,height:a[D.a]+4},{coord:j,height:a[D.b]+4}],G),e.addQuad([{coord:P,height:0},{coord:j,height:0},{coord:j,height:a[D.b]+4},{coord:P,height:a[D.a]+4}],G)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}prepareEdgePoints(e,i,a,c){let p=i[a.a],m=i[a.b];const v=c(p,0),T=c(m,0);if(v&&T)return[{coord:e[a.a],height:p},{coord:e[a.b],height:m}];if(!v&&!T)return;const E=e[a.a].clone(),R=e[a.b].clone();if(v){if(!T){const D=m/(m-p);R.x=zi(R.x,E.x,D),R.y=zi(R.y,E.y,D),m=zi(m,p,D)}}else{const D=p/(p-m);E.x=zi(E.x,R.x,D),E.y=zi(E.y,R.y,D),p=zi(p,m,D)}return[{coord:E,height:p},{coord:R,height:m}]}prepareEdges(e,i){if(i.length===0)return;i.sort((v,T)=>v.hash===T.hash?T.polygonIdx-v.polygonIdx:T.hash>v.hash?1:-1);let a=0,c=0,p=0,m=i[a].polygonIdx;do c++,(c===i.length||i[a].hash!==i[c].hash)&&((c-a==1||i[c-1].polygonIdx!==m)&&(p<a&&(i[p]=i[a],i[a]=null),i[p].type="none",p++),a=c,a!==i.length&&(m=i[a].polygonIdx));while(a!==i.length);if(i.splice(p),i.length!==0&&e.length!==0){i.sort((E,R)=>E.portalHash<R.portalHash?1:-1);let v=0,T=0;for(;v!==i.length&&T!==e.length;){const E=i[v],R=e[T];E.portalHash>R.hash?v++:R.hash>E.portalHash?T++:(E.type=R.type,v++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Kt&&i>=Kt}addFeatureSection(e,i,a,c){return e!==i&&(i=e,a.push({featureIndex:e,vertexStart:c.getVertexCount()}),c.clearVertexLookup()),i}sortSubarray(e,i,a,c){const p=e.slice(i,a);p.sort(c),e.splice(i,p.length,...p)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Pa.computePosHash(e))<<32n|BigInt(Pa.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var s_,Dy={exports:{}},Py=(s_||(s_=1,function(n,e){(function(i){function a(ye,Ee){return ye>Ee?1:ye<Ee?-1:0}var c=function(ye,Ee){ye===void 0&&(ye=a),Ee===void 0&&(Ee=!1),this._compare=ye,this._root=null,this._size=0,this._noDuplicates=!!Ee},p={size:{configurable:!0}};function m(ye,Ee,yt,Jt,oi){var ri=oi-Jt;if(ri>0){var bi=Jt+Math.floor(ri/2),Gi={key:Ee[bi],data:yt[bi],parent:ye};return Gi.left=m(Gi,Ee,yt,Jt,bi),Gi.right=m(Gi,Ee,yt,bi+1,oi),Gi}return null}function v(ye,Ee,yt,Jt,oi){if(!(yt>=Jt)){for(var ri=ye[yt+Jt>>1],bi=yt-1,Gi=Jt+1;;){do bi++;while(oi(ye[bi],ri)<0);do Gi--;while(oi(ye[Gi],ri)>0);if(bi>=Gi)break;var vn=ye[bi];ye[bi]=ye[Gi],ye[Gi]=vn,vn=Ee[bi],Ee[bi]=Ee[Gi],Ee[Gi]=vn}v(ye,Ee,yt,Gi,oi),v(ye,Ee,Gi+1,Jt,oi)}}c.prototype.rotateLeft=function(ye){var Ee=ye.right;Ee&&(ye.right=Ee.left,Ee.left&&(Ee.left.parent=ye),Ee.parent=ye.parent),ye.parent?ye===ye.parent.left?ye.parent.left=Ee:ye.parent.right=Ee:this._root=Ee,Ee&&(Ee.left=ye),ye.parent=Ee},c.prototype.rotateRight=function(ye){var Ee=ye.left;Ee&&(ye.left=Ee.right,Ee.right&&(Ee.right.parent=ye),Ee.parent=ye.parent),ye.parent?ye===ye.parent.left?ye.parent.left=Ee:ye.parent.right=Ee:this._root=Ee,Ee&&(Ee.right=ye),ye.parent=Ee},c.prototype._splay=function(ye){for(;ye.parent;){var Ee=ye.parent;Ee.parent?Ee.left===ye&&Ee.parent.left===Ee?(this.rotateRight(Ee.parent),this.rotateRight(Ee)):Ee.right===ye&&Ee.parent.right===Ee?(this.rotateLeft(Ee.parent),this.rotateLeft(Ee)):Ee.left===ye&&Ee.parent.right===Ee?(this.rotateRight(Ee),this.rotateLeft(Ee)):(this.rotateLeft(Ee),this.rotateRight(Ee)):Ee.left===ye?this.rotateRight(Ee):this.rotateLeft(Ee)}},c.prototype.splay=function(ye){for(var Ee,yt,Jt,oi,ri;ye.parent;)(yt=(Ee=ye.parent).parent)&&yt.parent?((Jt=yt.parent).left===yt?Jt.left=ye:Jt.right=ye,ye.parent=Jt):(ye.parent=null,this._root=ye),oi=ye.left,ri=ye.right,ye===Ee.left?(yt&&(yt.left===Ee?(Ee.right?(yt.left=Ee.right,yt.left.parent=yt):yt.left=null,Ee.right=yt,yt.parent=Ee):(oi?(yt.right=oi,oi.parent=yt):yt.right=null,ye.left=yt,yt.parent=ye)),ri?(Ee.left=ri,ri.parent=Ee):Ee.left=null,ye.right=Ee,Ee.parent=ye):(yt&&(yt.right===Ee?(Ee.left?(yt.right=Ee.left,yt.right.parent=yt):yt.right=null,Ee.left=yt,yt.parent=Ee):(ri?(yt.left=ri,ri.parent=yt):yt.left=null,ye.right=yt,yt.parent=ye)),oi?(Ee.right=oi,oi.parent=Ee):Ee.right=null,ye.left=Ee,Ee.parent=ye)},c.prototype.replace=function(ye,Ee){ye.parent?ye===ye.parent.left?ye.parent.left=Ee:ye.parent.right=Ee:this._root=Ee,Ee&&(Ee.parent=ye.parent)},c.prototype.minNode=function(ye){if(ye===void 0&&(ye=this._root),ye)for(;ye.left;)ye=ye.left;return ye},c.prototype.maxNode=function(ye){if(ye===void 0&&(ye=this._root),ye)for(;ye.right;)ye=ye.right;return ye},c.prototype.insert=function(ye,Ee){var yt=this._root,Jt=null,oi=this._compare;if(this._noDuplicates)for(;yt;){if(Jt=yt,oi(yt.key,ye)===0)return;yt=oi(yt.key,ye)<0?yt.right:yt.left}else for(;yt;)Jt=yt,yt=oi(yt.key,ye)<0?yt.right:yt.left;return yt={key:ye,data:Ee,left:null,right:null,parent:Jt},Jt?oi(Jt.key,yt.key)<0?Jt.right=yt:Jt.left=yt:this._root=yt,this.splay(yt),this._size++,yt},c.prototype.find=function(ye){for(var Ee=this._root,yt=this._compare;Ee;){var Jt=yt(Ee.key,ye);if(Jt<0)Ee=Ee.right;else{if(!(Jt>0))return Ee;Ee=Ee.left}}return null},c.prototype.contains=function(ye){for(var Ee=this._root,yt=this._compare;Ee;){var Jt=yt(ye,Ee.key);if(Jt===0)return!0;Ee=Jt<0?Ee.left:Ee.right}return!1},c.prototype.remove=function(ye){var Ee=this.find(ye);if(!Ee)return!1;if(this.splay(Ee),Ee.left)if(Ee.right){var yt=this.minNode(Ee.right);yt.parent!==Ee&&(this.replace(yt,yt.right),yt.right=Ee.right,yt.right.parent=yt),this.replace(Ee,yt),yt.left=Ee.left,yt.left.parent=yt}else this.replace(Ee,Ee.left);else this.replace(Ee,Ee.right);return this._size--,!0},c.prototype.removeNode=function(ye){if(!ye)return!1;if(this.splay(ye),ye.left)if(ye.right){var Ee=this.minNode(ye.right);Ee.parent!==ye&&(this.replace(Ee,Ee.right),Ee.right=ye.right,Ee.right.parent=Ee),this.replace(ye,Ee),Ee.left=ye.left,Ee.left.parent=Ee}else this.replace(ye,ye.left);else this.replace(ye,ye.right);return this._size--,!0},c.prototype.erase=function(ye){var Ee=this.find(ye);if(Ee){this.splay(Ee);var yt=Ee.left,Jt=Ee.right,oi=null;yt&&(yt.parent=null,oi=this.maxNode(yt),this.splay(oi),this._root=oi),Jt&&(yt?oi.right=Jt:this._root=Jt,Jt.parent=oi),this._size--}},c.prototype.pop=function(){var ye=this._root,Ee=null;if(ye){for(;ye.left;)ye=ye.left;Ee={key:ye.key,data:ye.data},this.remove(ye.key)}return Ee},c.prototype.next=function(ye){var Ee=ye;if(Ee)if(Ee.right)for(Ee=Ee.right;Ee&&Ee.left;)Ee=Ee.left;else for(Ee=ye.parent;Ee&&Ee.right===ye;)ye=Ee,Ee=Ee.parent;return Ee},c.prototype.prev=function(ye){var Ee=ye;if(Ee)if(Ee.left)for(Ee=Ee.left;Ee&&Ee.right;)Ee=Ee.right;else for(Ee=ye.parent;Ee&&Ee.left===ye;)ye=Ee,Ee=Ee.parent;return Ee},c.prototype.forEach=function(ye){for(var Ee=this._root,yt=[],Jt=!1,oi=0;!Jt;)Ee?(yt.push(Ee),Ee=Ee.left):yt.length>0?(ye(Ee=yt.pop(),oi++),Ee=Ee.right):Jt=!0;return this},c.prototype.range=function(ye,Ee,yt,Jt){for(var oi=[],ri=this._compare,bi=this._root;oi.length!==0||bi;)if(bi)oi.push(bi),bi=bi.left;else{if(ri((bi=oi.pop()).key,Ee)>0)break;if(ri(bi.key,ye)>=0&&yt.call(Jt,bi))return this;bi=bi.right}return this},c.prototype.keys=function(){for(var ye=this._root,Ee=[],yt=[],Jt=!1;!Jt;)ye?(Ee.push(ye),ye=ye.left):Ee.length>0?(ye=Ee.pop(),yt.push(ye.key),ye=ye.right):Jt=!0;return yt},c.prototype.values=function(){for(var ye=this._root,Ee=[],yt=[],Jt=!1;!Jt;)ye?(Ee.push(ye),ye=ye.left):Ee.length>0?(ye=Ee.pop(),yt.push(ye.data),ye=ye.right):Jt=!0;return yt},c.prototype.at=function(ye){for(var Ee=this._root,yt=[],Jt=!1,oi=0;!Jt;)if(Ee)yt.push(Ee),Ee=Ee.left;else if(yt.length>0){if(Ee=yt.pop(),oi===ye)return Ee;oi++,Ee=Ee.right}else Jt=!0;return null},c.prototype.load=function(ye,Ee,yt){if(ye===void 0&&(ye=[]),Ee===void 0&&(Ee=[]),yt===void 0&&(yt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Jt=ye.length;return yt&&v(ye,Ee,0,Jt-1,this._compare),this._root=m(null,ye,Ee,0,Jt),this._size=Jt,this},c.prototype.min=function(){var ye=this.minNode(this._root);return ye?ye.key:null},c.prototype.max=function(){var ye=this.maxNode(this._root);return ye?ye.key:null},c.prototype.isEmpty=function(){return this._root===null},p.size.get=function(){return this._size},c.createTree=function(ye,Ee,yt,Jt,oi){return new c(yt,oi).load(ye,Ee,Jt)},Object.defineProperties(c.prototype,p);var T=0,E=1,R=2,D=3,P=0,j=1,G=2,Z=3;function K(ye,Ee,yt){Ee===null?(ye.inOut=!1,ye.otherInOut=!0):(ye.isSubject===Ee.isSubject?(ye.inOut=!Ee.inOut,ye.otherInOut=Ee.otherInOut):(ye.inOut=!Ee.otherInOut,ye.otherInOut=Ee.isVertical()?!Ee.inOut:Ee.inOut),Ee&&(ye.prevInResult=!te(Ee,yt)||Ee.isVertical()?Ee.prevInResult:Ee));var Jt=te(ye,yt);ye.resultTransition=Jt?function(oi,ri){var bi,Gi=!oi.inOut,vn=!oi.otherInOut;switch(ri){case P:bi=Gi&&vn;break;case j:bi=Gi||vn;break;case Z:bi=Gi^vn;break;case G:bi=oi.isSubject?Gi&&!vn:vn&&!Gi}return bi?1:-1}(ye,yt):0}function te(ye,Ee){switch(ye.type){case T:switch(Ee){case P:return!ye.otherInOut;case j:return ye.otherInOut;case G:return ye.isSubject&&ye.otherInOut||!ye.isSubject&&!ye.otherInOut;case Z:return!0}break;case R:return Ee===P||Ee===j;case D:return Ee===G;case E:return!1}return!1}var ce=function(ye,Ee,yt,Jt,oi){this.left=Ee,this.point=ye,this.otherEvent=yt,this.isSubject=Jt,this.type=oi||T,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},he={inResult:{configurable:!0}};function Y(ye,Ee){return ye[0]===Ee[0]&&ye[1]===Ee[1]}ce.prototype.isBelow=function(ye){var Ee=this.point,yt=this.otherEvent.point;return this.left?(Ee[0]-ye[0])*(yt[1]-ye[1])-(yt[0]-ye[0])*(Ee[1]-ye[1])>0:(yt[0]-ye[0])*(Ee[1]-ye[1])-(Ee[0]-ye[0])*(yt[1]-ye[1])>0},ce.prototype.isAbove=function(ye){return!this.isBelow(ye)},ce.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},he.inResult.get=function(){return this.resultTransition!==0},ce.prototype.clone=function(){var ye=new ce(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ye.contourId=this.contourId,ye.resultTransition=this.resultTransition,ye.prevInResult=this.prevInResult,ye.isExteriorRing=this.isExteriorRing,ye.inOut=this.inOut,ye.otherInOut=this.otherInOut,ye},Object.defineProperties(ce.prototype,he);var le=11102230246251565e-32,de=134217729,be=(3+8*le)*le;function Fe(ye,Ee,yt,Jt,oi){var ri,bi,Gi,vn,xn=Ee[0],on=Jt[0],tr=0,yr=0;on>xn==on>-xn?(ri=xn,xn=Ee[++tr]):(ri=on,on=Jt[++yr]);var bn=0;if(tr<ye&&yr<yt)for(on>xn==on>-xn?(Gi=ri-((bi=xn+ri)-xn),xn=Ee[++tr]):(Gi=ri-((bi=on+ri)-on),on=Jt[++yr]),ri=bi,Gi!==0&&(oi[bn++]=Gi);tr<ye&&yr<yt;)on>xn==on>-xn?(Gi=ri-((bi=ri+xn)-(vn=bi-ri))+(xn-vn),xn=Ee[++tr]):(Gi=ri-((bi=ri+on)-(vn=bi-ri))+(on-vn),on=Jt[++yr]),ri=bi,Gi!==0&&(oi[bn++]=Gi);for(;tr<ye;)Gi=ri-((bi=ri+xn)-(vn=bi-ri))+(xn-vn),xn=Ee[++tr],ri=bi,Gi!==0&&(oi[bn++]=Gi);for(;yr<yt;)Gi=ri-((bi=ri+on)-(vn=bi-ri))+(on-vn),on=Jt[++yr],ri=bi,Gi!==0&&(oi[bn++]=Gi);return ri===0&&bn!==0||(oi[bn++]=ri),bn}function ze(ye){return new Float64Array(ye)}var Be=33306690738754716e-32,We=22204460492503146e-32,dt=11093356479670487e-47,Bt=ze(4),St=ze(8),Nt=ze(12),Gt=ze(16),pt=ze(4);function Ot(ye,Ee,yt){var Jt=function(oi,ri,bi,Gi,vn,xn){var on=(ri-xn)*(bi-vn),tr=(oi-vn)*(Gi-xn),yr=on-tr;if(on===0||tr===0||on>0!=tr>0)return yr;var bn=Math.abs(on+tr);return Math.abs(yr)>=Be*bn?yr:-function(qr,Tr,er,ns,Mr,vr,Sr){var rr,un,lr,$r,ji,kn,Ir,Kr,Pr,zs,hr,Ps,al,Xa,La,ol,Wh,ks,Zs=qr-Mr,Ya=er-Mr,Eo=Tr-vr,ho=ns-vr;Bt[0]=(La=(Kr=Zs-(Ir=(kn=de*Zs)-(kn-Zs)))*(zs=ho-(Pr=(kn=de*ho)-(kn-ho)))-((Xa=Zs*ho)-Ir*Pr-Kr*Pr-Ir*zs))-((hr=La-(Wh=(Kr=Eo-(Ir=(kn=de*Eo)-(kn-Eo)))*(zs=Ya-(Pr=(kn=de*Ya)-(kn-Ya)))-((ol=Eo*Ya)-Ir*Pr-Kr*Pr-Ir*zs)))+(ji=La-hr))+(ji-Wh),Bt[1]=(al=Xa-((Ps=Xa+hr)-(ji=Ps-Xa))+(hr-ji))-((hr=al-ol)+(ji=al-hr))+(ji-ol),Bt[2]=Ps-((ks=Ps+hr)-(ji=ks-Ps))+(hr-ji),Bt[3]=ks;var up=function(s5,aS){for(var oS=aS[0],Tx=1;Tx<4;Tx++)oS+=aS[Tx];return oS}(0,Bt),k_=We*Sr;if(up>=k_||-up>=k_||(rr=qr-(Zs+(ji=qr-Zs))+(ji-Mr),lr=er-(Ya+(ji=er-Ya))+(ji-Mr),un=Tr-(Eo+(ji=Tr-Eo))+(ji-vr),$r=ns-(ho+(ji=ns-ho))+(ji-vr),rr===0&&un===0&&lr===0&&$r===0)||(k_=dt*Sr+be*Math.abs(up),(up+=Zs*$r+ho*rr-(Eo*lr+Ya*un))>=k_||-up>=k_))return up;pt[0]=(La=(Kr=rr-(Ir=(kn=de*rr)-(kn-rr)))*(zs=ho-(Pr=(kn=de*ho)-(kn-ho)))-((Xa=rr*ho)-Ir*Pr-Kr*Pr-Ir*zs))-((hr=La-(Wh=(Kr=un-(Ir=(kn=de*un)-(kn-un)))*(zs=Ya-(Pr=(kn=de*Ya)-(kn-Ya)))-((ol=un*Ya)-Ir*Pr-Kr*Pr-Ir*zs)))+(ji=La-hr))+(ji-Wh),pt[1]=(al=Xa-((Ps=Xa+hr)-(ji=Ps-Xa))+(hr-ji))-((hr=al-ol)+(ji=al-hr))+(ji-ol),pt[2]=Ps-((ks=Ps+hr)-(ji=ks-Ps))+(hr-ji),pt[3]=ks;var CR=Fe(4,Bt,4,pt,St);pt[0]=(La=(Kr=Zs-(Ir=(kn=de*Zs)-(kn-Zs)))*(zs=$r-(Pr=(kn=de*$r)-(kn-$r)))-((Xa=Zs*$r)-Ir*Pr-Kr*Pr-Ir*zs))-((hr=La-(Wh=(Kr=Eo-(Ir=(kn=de*Eo)-(kn-Eo)))*(zs=lr-(Pr=(kn=de*lr)-(kn-lr)))-((ol=Eo*lr)-Ir*Pr-Kr*Pr-Ir*zs)))+(ji=La-hr))+(ji-Wh),pt[1]=(al=Xa-((Ps=Xa+hr)-(ji=Ps-Xa))+(hr-ji))-((hr=al-ol)+(ji=al-hr))+(ji-ol),pt[2]=Ps-((ks=Ps+hr)-(ji=ks-Ps))+(hr-ji),pt[3]=ks;var MR=Fe(CR,St,4,pt,Nt);pt[0]=(La=(Kr=rr-(Ir=(kn=de*rr)-(kn-rr)))*(zs=$r-(Pr=(kn=de*$r)-(kn-$r)))-((Xa=rr*$r)-Ir*Pr-Kr*Pr-Ir*zs))-((hr=La-(Wh=(Kr=un-(Ir=(kn=de*un)-(kn-un)))*(zs=lr-(Pr=(kn=de*lr)-(kn-lr)))-((ol=un*lr)-Ir*Pr-Kr*Pr-Ir*zs)))+(ji=La-hr))+(ji-Wh),pt[1]=(al=Xa-((Ps=Xa+hr)-(ji=Ps-Xa))+(hr-ji))-((hr=al-ol)+(ji=al-hr))+(ji-ol),pt[2]=Ps-((ks=Ps+hr)-(ji=ks-Ps))+(hr-ji),pt[3]=ks;var IR=Fe(MR,Nt,4,pt,Gt);return Gt[IR-1]}(oi,ri,bi,Gi,vn,xn,bn)}(ye[0],ye[1],Ee[0],Ee[1],yt[0],yt[1]);return Jt>0?-1:Jt<0?1:0}function ut(ye,Ee){var yt=ye.point,Jt=Ee.point;return yt[0]>Jt[0]?1:yt[0]<Jt[0]?-1:yt[1]!==Jt[1]?yt[1]>Jt[1]?1:-1:function(oi,ri,bi,Gi){return oi.left!==ri.left?oi.left?1:-1:Ot(bi,oi.otherEvent.point,ri.otherEvent.point)!==0?oi.isBelow(ri.otherEvent.point)?-1:1:!oi.isSubject&&ri.isSubject?1:-1}(ye,Ee,yt)}function ft(ye,Ee,yt){var Jt=new ce(Ee,!1,ye,ye.isSubject),oi=new ce(Ee,!0,ye.otherEvent,ye.isSubject);return Y(ye.point,ye.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ye),Jt.contourId=oi.contourId=ye.contourId,ut(oi,ye.otherEvent)>0&&(ye.otherEvent.left=!0,oi.left=!1),ye.otherEvent.otherEvent=oi,ye.otherEvent=Jt,yt.push(oi),yt.push(Jt),yt}function Zt(ye,Ee){return ye[0]*Ee[1]-ye[1]*Ee[0]}function Yt(ye,Ee){return ye[0]*Ee[0]+ye[1]*Ee[1]}function ki(ye,Ee,yt){var Jt=function(vn,xn,on,tr,yr){var bn=[xn[0]-vn[0],xn[1]-vn[1]],qr=[tr[0]-on[0],tr[1]-on[1]];function Tr(kn,Ir,Kr){return[kn[0]+Ir*Kr[0],kn[1]+Ir*Kr[1]]}var er=[on[0]-vn[0],on[1]-vn[1]],ns=Zt(bn,qr),Mr=ns*ns,vr=Yt(bn,bn);if(Mr>0){var Sr=Zt(er,qr)/ns;if(Sr<0||Sr>1)return null;var rr=Zt(er,bn)/ns;return rr<0||rr>1?null:Sr===0||Sr===1?[Tr(vn,Sr,bn)]:rr===0||rr===1?[Tr(on,rr,qr)]:[Tr(vn,Sr,bn)]}if((Mr=(ns=Zt(er,bn))*ns)>0)return null;var un=Yt(bn,er)/vr,lr=un+Yt(bn,qr)/vr,$r=Math.min(un,lr),ji=Math.max(un,lr);return $r<=1&&ji>=0?$r===1?[Tr(vn,$r>0?$r:0,bn)]:ji===0?[Tr(vn,ji<1?ji:1,bn)]:[Tr(vn,$r>0?$r:0,bn),Tr(vn,ji<1?ji:1,bn)]:null}(ye.point,ye.otherEvent.point,Ee.point,Ee.otherEvent.point),oi=Jt?Jt.length:0;if(oi===0||oi===1&&(Y(ye.point,Ee.point)||Y(ye.otherEvent.point,Ee.otherEvent.point))||oi===2&&ye.isSubject===Ee.isSubject)return 0;if(oi===1)return Y(ye.point,Jt[0])||Y(ye.otherEvent.point,Jt[0])||ft(ye,Jt[0],yt),Y(Ee.point,Jt[0])||Y(Ee.otherEvent.point,Jt[0])||ft(Ee,Jt[0],yt),1;var ri=[],bi=!1,Gi=!1;return Y(ye.point,Ee.point)?bi=!0:ut(ye,Ee)===1?ri.push(Ee,ye):ri.push(ye,Ee),Y(ye.otherEvent.point,Ee.otherEvent.point)?Gi=!0:ut(ye.otherEvent,Ee.otherEvent)===1?ri.push(Ee.otherEvent,ye.otherEvent):ri.push(ye.otherEvent,Ee.otherEvent),bi&&Gi||bi?(Ee.type=E,ye.type=Ee.inOut===ye.inOut?R:D,bi&&!Gi&&ft(ri[1].otherEvent,ri[0].point,yt),2):Gi?(ft(ri[0],ri[1].point,yt),3):ri[0]!==ri[3].otherEvent?(ft(ri[0],ri[1].point,yt),ft(ri[1],ri[2].point,yt),3):(ft(ri[0],ri[1].point,yt),ft(ri[3].otherEvent,ri[2].point,yt),3)}function Ti(ye,Ee){if(ye===Ee)return 0;if(Ot(ye.point,ye.otherEvent.point,Ee.point)!==0||Ot(ye.point,ye.otherEvent.point,Ee.otherEvent.point)!==0)return Y(ye.point,Ee.point)?ye.isBelow(Ee.otherEvent.point)?-1:1:ye.point[0]===Ee.point[0]?ye.point[1]<Ee.point[1]?-1:1:ut(ye,Ee)===1?Ee.isAbove(ye.point)?-1:1:ye.isBelow(Ee.point)?-1:1;if(ye.isSubject!==Ee.isSubject)return ye.isSubject?-1:1;var yt=ye.point,Jt=Ee.point;return yt[0]===Jt[0]&&yt[1]===Jt[1]?(yt=ye.otherEvent.point)[0]===(Jt=Ee.otherEvent.point)[0]&&yt[1]===Jt[1]?0:ye.contourId>Ee.contourId?1:-1:ut(ye,Ee)===1?1:-1}var ai=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function $t(ye,Ee,yt,Jt){var oi,ri=ye+1,bi=Ee[ye].point,Gi=Ee.length;for(ri<Gi&&(oi=Ee[ri].point);ri<Gi&&oi[0]===bi[0]&&oi[1]===bi[1];){if(!yt[ri])return ri;++ri<Gi&&(oi=Ee[ri].point)}for(ri=ye-1;yt[ri]&&ri>Jt;)ri--;return ri}ai.prototype.isExterior=function(){return this.holeOf==null};var Xi=Ei,wi=Ei;function Ei(ye,Ee){if(!(this instanceof Ei))return new Ei(ye,Ee);if(this.data=ye||[],this.length=this.data.length,this.compare=Ee||Hi,this.length>0)for(var yt=(this.length>>1)-1;yt>=0;yt--)this._down(yt)}function Hi(ye,Ee){return ye<Ee?-1:ye>Ee?1:0}Ei.prototype={push:function(ye){this.data.push(ye),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ye=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ye}},peek:function(){return this.data[0]},_up:function(ye){for(var Ee=this.data,yt=this.compare,Jt=Ee[ye];ye>0;){var oi=ye-1>>1,ri=Ee[oi];if(yt(Jt,ri)>=0)break;Ee[ye]=ri,ye=oi}Ee[ye]=Jt},_down:function(ye){for(var Ee=this.data,yt=this.compare,Jt=this.length>>1,oi=Ee[ye];ye<Jt;){var ri=1+(ye<<1),bi=ri+1,Gi=Ee[ri];if(bi<this.length&&yt(Ee[bi],Gi)<0&&(ri=bi,Gi=Ee[bi]),yt(Gi,oi)>=0)break;Ee[ye]=Gi,ye=ri}Ee[ye]=oi}},Xi.default=wi;var sn=Math.max,nn=Math.min,fn=0;function an(ye,Ee,yt,Jt,oi,ri){var bi,Gi,vn,xn,on,tr;for(bi=0,Gi=ye.length-1;bi<Gi;bi++)if(xn=ye[bi+1],on=new ce(vn=ye[bi],!1,void 0,Ee),tr=new ce(xn,!1,on,Ee),on.otherEvent=tr,vn[0]!==xn[0]||vn[1]!==xn[1]){on.contourId=tr.contourId=yt,ri||(on.isExteriorRing=!1,tr.isExteriorRing=!1),ut(on,tr)>0?tr.left=!0:on.left=!0;var yr=vn[0],bn=vn[1];oi[0]=nn(oi[0],yr),oi[1]=nn(oi[1],bn),oi[2]=sn(oi[2],yr),oi[3]=sn(oi[3],bn),Jt.push(on),Jt.push(tr)}}var pn=[];function Jn(ye,Ee,yt){typeof ye[0][0][0]=="number"&&(ye=[ye]),typeof Ee[0][0][0]=="number"&&(Ee=[Ee]);var Jt=function(bn,qr,Tr){var er=null;return bn.length*qr.length==0&&(Tr===P?er=pn:Tr===G?er=bn:Tr!==j&&Tr!==Z||(er=bn.length===0?qr:bn)),er}(ye,Ee,yt);if(Jt)return Jt===pn?null:Jt;var oi=[1/0,1/0,-1/0,-1/0],ri=[1/0,1/0,-1/0,-1/0],bi=function(bn,qr,Tr,er,ns){var Mr,vr,Sr,rr,un,lr,$r=new Xi(null,ut);for(Sr=0,rr=bn.length;Sr<rr;Sr++)for(un=0,lr=(Mr=bn[Sr]).length;un<lr;un++)(vr=un===0)&&fn++,an(Mr[un],!0,fn,$r,Tr,vr);for(Sr=0,rr=qr.length;Sr<rr;Sr++)for(un=0,lr=(Mr=qr[Sr]).length;un<lr;un++)vr=un===0,ns===G&&(vr=!1),vr&&fn++,an(Mr[un],!1,fn,$r,er,vr);return $r}(ye,Ee,oi,ri,yt);if(Jt=function(bn,qr,Tr,er,ns){var Mr=null;return(Tr[0]>er[2]||er[0]>Tr[2]||Tr[1]>er[3]||er[1]>Tr[3])&&(ns===P?Mr=pn:ns===G?Mr=bn:ns!==j&&ns!==Z||(Mr=bn.concat(qr))),Mr}(ye,Ee,oi,ri,yt))return Jt===pn?null:Jt;for(var Gi=function(bn){var qr,Tr,er=function(Sr){var rr,un,lr,$r,ji=[];for(un=0,lr=Sr.length;un<lr;un++)((rr=Sr[un]).left&&rr.inResult||!rr.left&&rr.otherEvent.inResult)&&ji.push(rr);for(var kn=!1;!kn;)for(kn=!0,un=0,lr=ji.length;un<lr;un++)un+1<lr&&ut(ji[un],ji[un+1])===1&&($r=ji[un],ji[un]=ji[un+1],ji[un+1]=$r,kn=!1);for(un=0,lr=ji.length;un<lr;un++)(rr=ji[un]).otherPos=un;for(un=0,lr=ji.length;un<lr;un++)(rr=ji[un]).left||($r=rr.otherPos,rr.otherPos=rr.otherEvent.otherPos,rr.otherEvent.otherPos=$r);return ji}(bn),ns={},Mr=[],vr=function(){if(!ns[qr]){var Sr=Mr.length,rr=function(ji,kn,Ir){var Kr=new ai;if(ji.prevInResult!=null){var Pr=ji.prevInResult,zs=Pr.outputContourId;if(Pr.resultTransition>0){var hr=kn[zs];if(hr.holeOf!=null){var Ps=hr.holeOf;kn[Ps].holeIds.push(Ir),Kr.holeOf=Ps,Kr.depth=kn[zs].depth}else kn[zs].holeIds.push(Ir),Kr.holeOf=zs,Kr.depth=kn[zs].depth+1}else Kr.holeOf=null,Kr.depth=kn[zs].depth}else Kr.holeOf=null,Kr.depth=0;return Kr}(er[qr],Mr,Sr),un=function(ji){ns[ji]=!0,ji<er.length&&er[ji]&&(er[ji].outputContourId=Sr)},lr=qr,$r=qr;for(rr.points.push(er[qr].point);un(lr),un(lr=er[lr].otherPos),rr.points.push(er[lr].point),!((lr=$t(lr,er,ns,$r))==$r||lr>=er.length)&&er[lr];);Mr.push(rr)}};for(qr=0,Tr=er.length;qr<Tr;qr++)vr();return Mr}(function(bn,qr,Tr,er,ns,Mr){for(var vr,Sr,rr,un=new c(Ti),lr=[],$r=Math.min(er[2],ns[2]);bn.length!==0;){var ji=bn.pop();if(lr.push(ji),Mr===P&&ji.point[0]>$r||Mr===G&&ji.point[0]>er[2])break;if(ji.left){Sr=vr=un.insert(ji),vr=vr!==(rr=un.minNode())?un.prev(vr):null,Sr=un.next(Sr);var kn=vr?vr.key:null;if(K(ji,kn,Mr),Sr&&ki(ji,Sr.key,bn)===2&&(K(ji,kn,Mr),K(Sr.key,ji,Mr)),vr&&ki(vr.key,ji,bn)===2){var Ir=vr;K(kn,(Ir=Ir!==rr?un.prev(Ir):null)?Ir.key:null,Mr),K(ji,kn,Mr)}}else Sr=vr=un.find(ji=ji.otherEvent),vr&&Sr&&(vr=vr!==rr?un.prev(vr):null,Sr=un.next(Sr),un.remove(ji),Sr&&vr&&ki(vr.key,Sr.key,bn))}return lr}(bi,0,0,oi,ri,yt)),vn=[],xn=0;xn<Gi.length;xn++){var on=Gi[xn];if(on.isExterior()){for(var tr=[on.points],yr=0;yr<on.holeIds.length;yr++)tr.push(Gi[on.holeIds[yr]].points);vn.push(tr)}}return vn}var wr={UNION:j,DIFFERENCE:G,INTERSECTION:P,XOR:Z};i.diff=function(ye,Ee){return Jn(ye,Ee,G)},i.intersection=function(ye,Ee){return Jn(ye,Ee,P)},i.operations=wr,i.union=function(ye,Ee){return Jn(ye,Ee,j)},i.xor=function(ye,Ee){return Jn(ye,Ee,Z)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Dy.exports)),Dy.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function ig(n,e,i,a){const c=[],p=a===0?(m,v,T,E,R,D)=>{m.push(new Qt(D,T+(D-v)/(E-v)*(R-T)))}:(m,v,T,E,R,D)=>{m.push(new Qt(v+(D-T)/(R-T)*(E-v),D))};for(const m of n){const v=[];for(const T of m){if(T.length<=2)continue;const E=[];for(let P=0;P<T.length-1;P++){const j=T[P].x,G=T[P].y,Z=T[P+1].x,K=T[P+1].y,te=a===0?j:G,ce=a===0?Z:K;te<e?ce>e&&p(E,j,G,Z,K,e):te>i?ce<i&&p(E,j,G,Z,K,i):E.push(T[P]),ce<e&&te>=e&&p(E,j,G,Z,K,e),ce>i&&te<=i&&p(E,j,G,Z,K,i)}let R=T[T.length-1];const D=a===0?R.x:R.y;D>=e&&D<=i&&E.push(R),E.length&&(R=E[E.length-1],E[0].x===R.x&&E[0].y===R.y||E.push(E[0]),v.push(E))}v.length&&c.push(v)}return c}function A0(n,e){const i=a_(n),a=a_([e]),c=Py.intersection(i,a);return c==null?[]:Oy(c)}function C0(n,e){let a=a_(n,65536);for(;e.valid();e.next()){const[c,p]=e.get(),m=c.x*65536,v=c.y*65536,T=p.x*65536,E=p.y*65536,R=T-m,D=E-v,P=Math.hypot(R,D),j=Math.trunc(D/P*3),G=-Math.trunc(R/P*3);a=Py.diff(a,[[[m,v],[T,E],[T+j,E+G],[m+j,v+G],[m,v]]])}return Oy(a,1/65536)}function a_(n,e=1){return[n.map(i=>i.map(a=>[a.x*e,a.y*e]))]}function Oy(n,e=1){return n.map(i=>i.map((a,c)=>{const p=a.map(m=>new Qt(m[0]*e,m[1]*e).round());return c>0&&p.reverse(),p}))}class ng{constructor(e,i){this.layoutVertexArray=new Qo,this.indexArray=new ls,this.lineIndexArray=new ta,this.triangleSegments=new kr,this.lineSegments=new kr,this.programConfigurations=new u(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Tl)}update(e,i,a,c,p,m,v,T){this.programConfigurations.updatePaintArrays(e,i,p,a,c,m,v,T)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ay.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Cy.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,a,c,p,m,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,a,c,p,m,void 0,v)}}class Uh{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new ng(e,!1),this.elevationBufferData=new ng(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,c){this.hasPattern=tg("fill",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:v,id:T,index:E,sourceLayerIndex:R}of e){const D=this.layers[0]._featureFilter.needGeometry,P=hi(v,D);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom,{worldview:this.worldview}),P,a))continue;const j=p?p.evaluate(P,{},a,i.availableImages):void 0,G={id:T,properties:v.properties,type:v.type,sourceLayerIndex:R,index:E,geometry:D?P.geometry:di(v,a,c),patterns:{},sortKey:j};m.push(G)}p&&m.sort((v,T)=>v.sortKey-T.sortKey);for(const v of m){const{geometry:T,index:E,sourceLayerIndex:R}=v;if(this.hasPattern){const D=Qf("fill",this.layers,v,this.zoom,this.pixelRatio,i);this.patternFeatures.push(D)}else this.addFeature(v,T,E,a,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[E].feature,T,E,R,this.index)}}update(e,i,a,c,p,m,v){this.bufferData.update(e,i,a,c,p,m,v,this.worldview),this.elevationBufferData.update(e,i,a,c,p,m,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,a,c,p,m,v,this.worldview)}addFeatures(e,i,a,c,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,a,c,m,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,a,c,p,m=[],v,T){const E=im(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,E,c,a,T):this.addGeometry(E,this.bufferData),this.bufferData.populatePaintArrays(e,a,p,m,c,v,this.worldview),this.elevationBufferData.populatePaintArrays(e,a,p,m,c,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,a,c,p){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,a,c,p,this.worldview))}addElevatedRoadFeature(e,i,a,c,p){const m=new Array,v=uo.getElevationFeature(e,p);if(!v)return void this.addGeometry(i,this.bufferData);{const E=this.clipPolygonsToTile(i,1);E.length>0&&m.push({polygons:E,elevationFeature:v,elevationTileID:a})}const T={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},a),featureIndex:c};for(const E of m)if(E.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Pa(E.elevationTileID,this.layers,this.zoom,this.lut));const D=E.elevationFeature.isTunnel();let P=0;e.properties.hasOwnProperty(Zn)&&(P=+e.properties[Zn]);for(const j of E.polygons)this.elevatedStructures.addPortalCandidates(E.elevationFeature.id,j,D,E.elevationFeature,P)}E.elevationFeature.constantHeight==null&&(E.polygons=this.prepareElevatedPolygons(E.polygons,E.elevationFeature,E.elevationTileID));const R=new rl(a,E.elevationTileID);this.addElevatedGeometry(E.polygons,R,E.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,c,T)}}addElevatedGeometry(e,i,a,c,p,m){const v={elevation:a,elevationSampler:i,bias:c,index:p,featureInfo:m},[T,E]=this.addGeometry(e,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:T,max:E}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,T),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,E))}addGeometry(e,i,a){let c=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,m=null;a&&(m=a.elevationSampler.constantElevation(a.elevation,a.bias),m!=null&&(c=m,p=m));const v=(T,E,R)=>{if(a!=null)if(E.push(T),m!=null)i.elevatedLayoutVertexArray.emplaceBack(m),R.push(m);else{const D=a.elevationSampler.pointElevation(T,a.elevation,a.bias);i.elevatedLayoutVertexArray.emplaceBack(D),R.push(D),c=Math.min(c,D),p=Math.max(p,D)}};for(const T of e){let E=0;for(const he of T)E+=he.length;const R=i.triangleSegments.prepareSegment(E,i.layoutVertexArray,i.indexArray),D=R.vertexLength,P=[],j=[],G=[],Z=[],K=[],te=i.layoutVertexArray.length;for(const he of T){if(he.length===0)continue;he!==T[0]&&j.push(P.length/2);const Y=i.lineSegments.prepareSegment(he.length,i.layoutVertexArray,i.lineIndexArray),le=Y.vertexLength;a&&K.push(i.layoutVertexArray.length-te),v(he[0],G,Z),i.layoutVertexArray.emplaceBack(he[0].x,he[0].y),i.lineIndexArray.emplaceBack(le+he.length-1,le),P.push(he[0].x),P.push(he[0].y);for(let de=1;de<he.length;de++)v(he[de],G,Z),i.layoutVertexArray.emplaceBack(he[de].x,he[de].y),i.lineIndexArray.emplaceBack(le+de-1,le+de),P.push(he[de].x),P.push(he[de].y);Y.vertexLength+=he.length,Y.primitiveLength+=he.length}const ce=Hd(P,j);for(let he=0;he<ce.length;he+=3)i.indexArray.emplaceBack(D+ce[he],D+ce[he+1],D+ce[he+2]);if(ce.length>0&&a&&this.elevationMode==="hd-road-base"){const he=a.elevation.isTunnel(),Y=a.elevation.safeArea,le=this.elevatedStructures.addVertices(G,Z);this.elevatedStructures.addTriangles(ce,le,he);const de=K.length;if(de>0){for(let be=0;be<de-1;be++)this.elevatedStructures.addRenderableRing(a.index,K[be]+le,K[be+1]-K[be],he,Y,a.featureInfo);this.elevatedStructures.addRenderableRing(a.index,K[de-1]+le,G.length-K[de-1],he,Y,a.featureInfo)}}R.vertexLength+=E,R.primitiveLength+=ce.length/3}return[c,p]}prepareElevatedPolygons(e,i,a){const c=1/lt(a),p=[];for(const m of e){const v=C0(m,new na(i,c));p.push(...v)}return p}clipPolygonsToTile(e,i){const a=-i,c=-i,p=Kt+i,m=Kt+i;let v=0;const T=[],E=[];for(;v<e.length;v++){const P=e[v],j=vp(P);(j.min.x>=a&&j.max.x<=p&&j.min.y>=c&&j.max.y<=m?T:E).push(P)}if(T.length===e.length)return e;const R=[new Qt(a,c),new Qt(p,c),new Qt(p,m),new Qt(a,m),new Qt(a,c)],D=T;for(const P of E)D.push(...A0(P,R));return D}}let Jf,o_,Ly,Kd;mi(Uh,"FillBucket",{omit:["layers","patternFeatures"]}),mi(ng,"FillBufferData"),mi(Pa,"ElevatedStructures");class Qd{constructor(e,i,a,c){if(this.triangleCount=i.length/3,this.min=new Qt(0,0),this.max=new Qt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[p,m]=[e[0].clone(),e[0].clone()];for(let D=1;D<e.length;++D){const P=e[D];p.x=Math.min(p.x,P.x),p.y=Math.min(p.y,P.y),m.x=Math.max(m.x,P.x),m.y=Math.max(m.y,P.y)}if(c){const D=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/c);a=Math.max(a,D)}if(a===0)return;this.min=p,this.max=m;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const T=Math.max(v.x,v.y)/a;this.cellsX=Math.max(1,Math.ceil(v.x/T)),this.cellsY=Math.max(1,Math.ceil(v.y/T)),this.xScale=1/T,this.yScale=1/T;const E=[];for(let D=0;D<this.triangleCount;D++){const P=e[i[3*D+0]].sub(this.min),j=e[i[3*D+1]].sub(this.min),G=e[i[3*D+2]].sub(this.min),Z=Lc(Math.floor(Math.min(P.x,j.x,G.x)),this.xScale,this.cellsX),K=Lc(Math.floor(Math.max(P.x,j.x,G.x)),this.xScale,this.cellsX),te=Lc(Math.floor(Math.min(P.y,j.y,G.y)),this.yScale,this.cellsY),ce=Lc(Math.floor(Math.max(P.y,j.y,G.y)),this.yScale,this.cellsY),he=new Qt(0,0),Y=new Qt(0,0),le=new Qt(0,0),de=new Qt(0,0);for(let be=te;be<=ce;++be){he.y=Y.y=be*T,le.y=de.y=(be+1)*T;for(let Fe=Z;Fe<=K;++Fe)he.x=le.x=Fe*T,Y.x=de.x=(Fe+1)*T,(Xp(P,j,G,he,Y,de)||Xp(P,j,G,he,de,le))&&E.push({cellIdx:be*this.cellsX+Fe,triIdx:D})}}if(E.length===0)return;E.sort((D,P)=>D.cellIdx-P.cellIdx||D.triIdx-P.triIdx);let R=0;for(;R<E.length;){const D=E[R].cellIdx,P={start:this.payload.length,len:0};for(;R<E.length&&E[R].cellIdx===D;)++P.len,this.payload.push(E[R++].triIdx);this.cells[D]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=Lc(e.x-this.min.x,this.xScale,this.cellsX),c=Lc(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[c*this.cellsX+a];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){const v=this.payload[p.start+m],T=Math.floor(v/8),E=1<<v%8;if(!(this.lookup[T]&E)&&(this.lookup[T]|=E,i.push(v),i.length===this.triangleCount))return}}}query(e,i,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const c=Lc(e.x-this.min.x,this.xScale,this.cellsX),p=Lc(i.x-this.min.x,this.xScale,this.cellsX),m=Lc(e.y-this.min.y,this.yScale,this.cellsY),v=Lc(i.y-this.min.y,this.yScale,this.cellsY);for(let T=m;T<=v;T++)for(let E=c;E<=p;E++){const R=this.cells[T*this.cellsX+E];if(R)for(let D=0;D<R.len;D++){const P=this.payload[R.start+D],j=Math.floor(P/8),G=1<<P%8;if(!(this.lookup[j]&G)&&(this.lookup[j]|=G,a.push(P),a.length===this.triangleCount))return}}}}function Lc(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}mi(Qd,"TriangleGridIndex");class rm{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}populate(e,i,a,c){const p=[];for(const{feature:m,id:v,index:T,sourceLayerIndex:E}of e){const R=this.layers[0]._featureFilter.needGeometry,D=hi(m,R);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom,{worldview:this.worldview}),D,a))continue;const P={id:v,properties:m.properties,type:m.type,sourceLayerIndex:E,index:T,geometry:R?D.geometry:di(m,a,c),patterns:{}};p.push(P)}for(const m of p){const{geometry:v,index:T,sourceLayerIndex:E}=m;this.addFeature(m,v,T,a,{},i.availableImages,i.brightness),i.featureIndex.insert(e[T].feature,v,T,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,a,c,p,m,v){}destroy(){}addFeature(e,i,a,c,p,m=[],v){for(const T of im(i,2)){const E=[],R=[],D=[],P=new Qt(1/0,1/0),j=new Qt(-1/0,-1/0);for(const K of T)if(K.length!==0){K!==T[0]&&D.push(R.length/2);for(let te=0;te<K.length;te++)R.push(K[te].x),R.push(K[te].y),E.push(K[te]),P.x=Math.min(P.x,K[te].x),P.y=Math.min(P.y,K[te].y),j.x=Math.max(j.x,K[te].x),j.y=Math.max(j.y,K[te].y)}const G=Hd(R,D),Z=new Qd(E,G,8,256);this.footprints.push({vertices:E,indices:G,grid:Z,min:P,max:j})}}}mi(rm,"ClipBucket",{omit:["layers"]});const l_=En([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),c_=En([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),rg=En([{name:"a_centroid_pos",components:2,type:"Uint16"}]),zy=En([{name:"a_join_normal_inside",components:3,type:"Int16"}]),ky=En([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),M0=En([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ny}=l_,Gh=Number.MAX_SAFE_INTEGER;function Fy(n,e,i,a){return n.order<e||n.order===Gh||!(n.clipMask&i)||function(c,p){return p.length!==0&&p.find(m=>m===c)===void 0}(a,n.clipScope)}function sg(n,e){return n.x-e.x||n.y-e.y}function By(n,e){return sg(n.min,e.min)===0&&sg(n.max,e.max)===0}function ep(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function tp(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!By(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!io(n[i].clipScope,e[i].clipScope))return!1;return!0}function ag(n,e,i){const a=1/Kt,c=1/(1<<i.canonical.z),p=(e.x*a+i.canonical.x)*c+i.wrap,m=(e.y*a+i.canonical.y)*c;return{min:new Qt((n.x*a+i.canonical.x)*c+i.wrap,(n.y*a+i.canonical.y)*c),max:new Qt(p,m)}}function I0(n,e,i){const a=1<<i.canonical.z,c=((e.x-i.wrap)*a-i.canonical.x)*Kt,p=(e.y*a-i.canonical.y)*Kt;return{min:new Qt(((n.x-i.wrap)*a-i.canonical.x)*Kt,(n.y*a-i.canonical.y)*Kt),max:new Qt(c,p)}}function ip(n,e,i,a,c,p,m){const v=n.indices,T=n.vertices,E=[];for(let R=a;R<a+c;R+=3){const D=e[i[R+0]+p],P=e[i[R+1]+p],j=e[i[R+2]+p],G=Math.min(D.x,P.x,j.x),Z=Math.max(D.x,P.x,j.x),K=Math.min(D.y,P.y,j.y),te=Math.max(D.y,P.y,j.y);E.length=0,n.grid.query(new Qt(G,K),new Qt(Z,te),E);for(let ce=0;ce<E.length;ce++){const he=E[ce];if(Xp(T[v[3*he+0]],T[v[3*he+1]],T[v[3*he+2]],D,P,j,m))return!0}}return!1}function jy(n,e,i,a){if(!n||!i)return!1;let c=n.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(i.vertices.length<n.vertices.length)return jy(i,a,n,e);const p=e.canonical,m=a.canonical,v=Math.pow(2,m.z-p.z);c=n.vertices.map(T=>new Qt((T.x+p.x*Kt)*v-m.x*Kt,(T.y+p.y*Kt)*v-m.y*Kt))}return ip(i,c,n.indices,0,n.indices.length,0,0)}function u_(n,e,i,a){const c=Math.pow(2,a.z-i.z);return new Qt((n+i.x*Kt)*c-a.x*Kt,(e+i.y*Kt)*c-a.y*Kt)}function h_(n,e){const i=[];e.grid.queryPoint(n,i);const a=e.indices,c=e.vertices;for(let p=0;p<i.length;p++){const m=i[p];if(Al([c[a[3*m+0]],c[a[3*m+1]],c[a[3*m+2]]],n))return!0}return!1}const og=[new Qt(0,0),new Qt(Kt,0),new Qt(Kt,Kt),new Qt(0,Kt)];function d_(n,e){const i=[];let a=[];if(!e||n.length<2)return[n];if(n.length===2)return ou(n[0],n[1],og)?[n]:[];for(let c=0;c<n.length+2;c++){const p=n[c%n.length],m=n[(c+1)%n.length],v=ou(c===0?n[n.length-1]:n[(c-1)%n.length],p,og),T=ou(p,m,og),E=v||T;E&&a.push(p),E&&T||a.length>0&&(a.length>1&&i.push(a),a=[])}return a.length>1&&i.push(a),i}const sm=Wi.VectorTileFeature.types,Vy=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],lg=["fill-extrusion-flood-light-ground-radius"],R0=Math.pow(2,13),D0=Math.pow(2,15)-1,cg=new Qt(0,1),hu=2147483648;function Hh(n,e,i,a,c,p,m,v){n.emplaceBack((e<<1)+m,(i<<1)+p,(Math.floor(a*R0)<<1)+c,Math.round(v))}function Jd(n,e,i){n.emplaceBack(e.x*Kt,e.y*Kt,i?1:0)}function am(n,e,i,a,c,p){n.emplaceBack(e.x,e.y,(i.x<<1)+a,(i.y<<1)+c,p)}function ef(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class $u{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Zu{constructor(){this.centroidXY=new Qt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Qt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Qt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Qt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Wu{constructor(){this.acc=new Qt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,a){this.accCount++,this.acc._add(i);let c=!!this.borders;i.x<e.min.x?(e.min.x=i.x,c=!0):i.x>e.max.x&&(e.max.x=i.x,c=!0),i.y<e.min.y?(e.min.y=i.y,c=!0):i.y>e.max.y&&(e.max.y=i.y,c=!0),((i.x===0||i.x===Kt)&&i.x===a.x)!=((i.y===0||i.y===Kt)&&i.y===a.y)&&this.processBorderOverlap(i,a),c&&this.checkBorderIntersection(i,a)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,zi(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Kt!=e.x>Kt&&this.addBorderIntersection(1,zi(i.y,e.y,(Kt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,zi(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Kt!=e.y>Kt&&this.addBorderIntersection(3,zi(i.x,e.x,(Kt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new Qt(0,0):new Qt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function np(n,e){const i=n.add(e)._unit(),a=Me(n.x*i.x+n.y*i.y,-1,1);var c,p,m;return c=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(c)))/4*D0*((p=n).x*(m=e).y-p.y*m.x<0?-1:1)}const om=[n=>n.x<0,n=>n.x>Kt,n=>n.y<0,n=>n.y>Kt];function qh(n,e,i,a){const c=[4];if(a===0)return c;i._mult(a);const p=n.sub(i),m=e.sub(i),v=[n,e,p,m];for(let T=0;T<4;T++)for(const E of v)if(om[T](E)){c.push(T);break}return c}class Uy{constructor(e){this.vertexArray=new Rh,this.indexArray=new ls,this.programConfigurations=new u(e.layers,{zoom:e.zoom,lut:e.lut},i=>lg.includes(i)),this._segments=new kr,this.hiddenByLandmarkVertexArray=new Lh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new kr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,a,c=!1){const p=e.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let T;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const E=e[0],R=e[1];T=np(E.sub(e[p-1])._perp()._unit(),R.sub(E)._perp()._unit())}for(let E=0;E<p;E++){const R=E===p-1?0:E+1,D=e[E],P=e[R],j=e[R===p-1?0:R+1],G=P.sub(D)._perp()._unit(),Z=np(G,j.sub(P)._perp()._unit()),K=T,te=Z;if(sp(D,P,i)||c&&p_(D,i)&&p_(P,i)){T=Z;continue}const ce=v.vertexLength;am(this.vertexArray,D,P,1,1,K),am(this.vertexArray,D,P,1,0,K),am(this.vertexArray,D,P,0,1,te),am(this.vertexArray,D,P,0,0,te),v.vertexLength+=4;const he=qh(D,P,G,a);for(const Y of he)this._segmentToGroundQuads[m].push({id:ce,region:Y}),this._segmentToRegionTriCounts[m][Y]+=2,v.primitiveLength+=2;T=Z}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let a=0;a<i;a++)this._segmentToGroundQuads[a].sort((c,p)=>c.region-p.region);for(let a=0;a<i;a++){const c=this._segmentToGroundQuads[a],p=e[a],m=this._segmentToRegionTriCounts[a];m.reduce((T,E)=>T+E,0);let v=0;for(let T=0;T<=4;T++){const E=m[T];if(E!==0){let R=this.regionSegments[T];R||(R=this.regionSegments[T]=new kr);const D={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+v,vertexLength:p.vertexLength,primitiveLength:E};R.get().push(D)}v+=E}for(let T=0;T<c.length;T++){const E=c[T].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,a,c,p,m,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,a,c,p,m,void 0,v)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,c_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,a,c,p,m,v,T){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,a,c,p,m,v,T)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const a=e.flags&hu?1:0;for(let c=e.groundVertexArrayOffset;c<i;++c)this.hiddenByLandmarkVertexArray.emplace(c,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,ky.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class lm{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ls,this.footprintVertices=new Qo,this.footprintSegments=[],this.layoutVertexArray=new ku,this.centroidVertexArray=new Zp,this.wallVertexArray=new Bf,this.indexArray=new ls,this.programConfigurations=new u(e.layers,{zoom:e.zoom,lut:e.lut},i=>Vy.includes(i)),this.segments=new kr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Uy(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,c){this.features=[],this.hasPattern=tg("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=lt(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:m,index:v,sourceLayerIndex:T}of e){const E=this.layers[0]._featureFilter.needGeometry,R=hi(p,E);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom,{worldview:this.worldview}),R,a))continue;const D={id:m,sourceLayerIndex:T,index:v,geometry:E?R.geometry:di(p,a,c),properties:p.properties,type:p.type,patterns:{}},P=this.layoutVertexArray.length,j=sm[D.type]==="Polygon";if(this.hasPattern)this.features.push(Qf("fill-extrusion",this.layers,D,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const G of D.geometry)for(const Z of d_(G,j))this.addFeature(D,[Z],v,a,{},i.availableImages,c,i.brightness);else this.addFeature(D,D.geometry,v,a,{},i.availableImages,c,i.brightness);i.featureIndex.insert(p,D.geometry,v,T,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,a,c,p,m){for(const v of this.features){const T=sm[v.type]==="Polygon",{geometry:E}=v;if(this.wallMode)for(const R of E)for(const D of d_(R,T))this.addFeature(v,[D],v.index,i,a,c,p,m);else this.addFeature(v,E,v.index,i,a,c,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,a,c,p,m,v){this.programConfigurations.updatePaintArrays(e,i,p,a,c,m,v,this.worldview),this.groundEffect.update(e,i,p,a,c,m,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ny),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,zy.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,M0.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,rg.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,c,p,m,v,T){const E=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,R=[new Qt(0,0),new Qt(Kt,Kt)],D=v.projection,P=D.name==="globe",j=this.wallMode||sm[e.type]==="Polygon",G=new Wu;G.centroidDataIndex=this.centroidData.length;const Z=new Zu,K=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,te=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);let ce;if(Z.height=te,Z.vertexArrayOffset=this.layoutVertexArray.length,Z.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Nu),this.wallMode){if(P)return void Yi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;ce=function(Be){const We=Be[0].x===Be[Be.length-1].x&&Be[0].y===Be[Be.length-1].y;(function(ai){let $t=0;const Xi=ai.length;for(let wi=0;wi<Xi;wi++)$t+=(ai[(wi+1)%Xi].x-ai[wi].x)*(ai[(wi+1)%Xi].y+ai[wi].y);return $t>=0})(Be)||(Be=Be.reverse());const Bt={geometry:[],joinNormals:[],indices:[]},St=[],Nt=[],Gt=[];let pt=Be.length;for(;pt>=2&&Be[pt-1].equals(Be[pt-2]);)pt--;if(pt<(We?3:2))return Bt;let Ot,ut,ft,Zt,Yt,ki=0;for(;ki<pt-1&&Be[ki].equals(Be[ki+1]);)ki++;We&&(Ot=Be[pt-2],Yt=Be[ki].sub(Ot)._unit()._perp());for(let ai=ki;ai<pt;ai++){if(ft=ai===pt-1?We?Be[ki+1]:void 0:Be[ai+1],ft&&Be[ai].equals(ft))continue;Yt&&(Zt=Yt),Ot&&(ut=Ot),Ot=Be[ai],Yt=ft?ft.sub(Ot)._unit()._perp():Zt,Zt=Zt||Yt;let $t=Zt.add(Yt);$t.x===0&&$t.y===0||$t._unit();const Xi=$t.x*Yt.x+$t.y*Yt.y,wi=Xi!==0?1/Xi:1/0,Ei=Zt.x*Yt.y-Zt.y*Yt.x>0;let Hi="miter";const sn=2;Hi==="miter"&&wi>sn&&(Hi="bevel"),Hi==="bevel"&&(wi>100&&(Hi="flipbevel"),wi<sn&&(Hi="miter"));const nn=(fn,an,pn,Jn)=>{const wr=new Qt(fn.x,fn.y),ye=new Qt(fn.x,fn.y);wr.x+=an.x*Jn,wr.y+=an.y*Jn,ye.x-=an.x*Math.max(pn,1),ye.y-=an.y*Math.max(pn,1),Gt.push(an),St.push(wr),Nt.push(ye)};if(Hi==="miter")$t._mult(wi),nn(Ot,$t,0,0);else if(Hi==="flipbevel")$t=Yt.mult(-1),nn(Ot,$t,0,0),nn(Ot,$t.mult(-1),0,0);else{const fn=-Math.sqrt(wi*wi-1),an=Ei?fn:0,pn=Ei?0:fn;ut&&nn(Ot,Zt,an,pn),ft&&nn(Ot,Yt,an,pn)}}Bt.geometry=[...St,...Nt.reverse(),St[0]],Bt.joinNormals=[...Gt,...Gt.reverse(),Gt[Gt.length-1]];const Ti=Bt.geometry.length-1;for(let ai=0;ai<Ti/2;ai++)if(ai+1<Ti/2){let $t=ai,Xi=ai+1,wi=Ti-1-ai,Ei=Ti-2-ai;$t=$t===0?Ti-1:$t-1,Xi=Xi===0?Ti-1:Xi-1,wi=wi===0?Ti-1:wi-1,Ei=Ei===0?Ti-1:Ei-1,Bt.indices.push(wi),Bt.indices.push(Xi),Bt.indices.push($t),Bt.indices.push(wi),Bt.indices.push(Ei),Bt.indices.push(Xi)}return Bt}(i[0]),i=[ce.geometry]}const he=(Be,We)=>Be<(We.length-1)/2||Be===We.length-1,Y=this.wallMode?[i]:im(i,500);for(let Be=Y.length-1;Be>=0;Be--){const We=Y[Be];(We.length===0||(le=We[0]).every(dt=>dt.x<=0)||le.every(dt=>dt.x>=Kt)||le.every(dt=>dt.y<=0)||le.every(dt=>dt.y>=Kt))&&Y.splice(Be,1)}var le;let de;if(P)de=m_(Y,R,c);else{de=[];for(const Be of Y)de.push({polygon:Be,bounds:R})}const be=j?this.edgeRadius:0,Fe=be>0&&this.zoom<17,ze=(Be,We)=>{if(Be.length===0)return!1;const dt=Be[Be.length-1];return We.x===dt.x&&We.y===dt.y};for(const{polygon:Be,bounds:We}of de){let dt=0,Bt=0;for(const pt of Be)j&&!pt[0].equals(pt[pt.length-1])&&pt.push(pt[0]),Bt+=j?pt.length-1:pt.length;const St=this.segments.prepareSegment((j?5:4)*Bt,this.layoutVertexArray,this.indexArray);Z.footprintSegIdx<0&&(Z.footprintSegIdx=this.footprintSegments.length),Z.polygonSegIdx<0&&(Z.polygonSegIdx=this.polygonSegments.length);const Nt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Gt=new $u;if(Gt.vertexOffset=this.footprintVertices.length,Gt.indexOffset=3*this.footprintIndices.length,Gt.ringIndices=[],j){const pt=[],Ot=[];dt=St.vertexLength;for(let ft=0;ft<Be.length;ft++){const Zt=Be[ft];Zt.length&&ft!==0&&Ot.push(pt.length/2);const Yt=[];let ki,Ti;ki=Zt[1].sub(Zt[0])._perp()._unit(),Gt.ringIndices.push(Zt.length-1);for(let ai=1;ai<Zt.length;ai++){const $t=Zt[ai],Xi=Zt[ai===Zt.length-1?1:ai+1],wi=$t.clone();if(be){Ti=Xi.sub($t)._perp()._unit();const Ei=ki.add(Ti)._unit(),Hi=be*Math.min(4,1/(ki.x*Ei.x+ki.y*Ei.y));wi.x+=Hi*Ei.x,wi.y+=Hi*Ei.y,wi.x=Math.round(wi.x),wi.y=Math.round(wi.y),ki=Ti}if(!K||be!==0&&!Fe||ze(Yt,wi)||Yt.push(wi),Hh(this.layoutVertexArray,wi.x,wi.y,0,0,1,1,0),this.wallMode){const Ei=he(ai,Zt);Jd(this.wallVertexArray,ce.joinNormals[ai],!Ei)}St.vertexLength++,this.footprintVertices.emplaceBack($t.x,$t.y),pt.push($t.x,$t.y),P&&ef(this.layoutVertexExtArray,D.projectTilePoint(wi.x,wi.y,c),D.upVector(c,wi.x,wi.y))}K&&(be===0||Fe)&&(Yt.length!==0&&ze(Yt,Yt[0])&&Yt.pop(),this.groundEffect.addData(Yt,We,E))}const ut=this.wallMode?ce.indices:Hd(pt,Ot);for(let ft=0;ft<ut.length;ft+=3)this.footprintIndices.emplaceBack(Gt.vertexOffset+ut[ft+0],Gt.vertexOffset+ut[ft+1],Gt.vertexOffset+ut[ft+2]),this.indexArray.emplaceBack(dt+ut[ft],dt+ut[ft+2],dt+ut[ft+1]),St.primitiveLength++;Gt.indexCount+=ut.length,Gt.vertexCount+=this.footprintVertices.length-Gt.vertexOffset}for(let pt=0;pt<Be.length;pt++){const Ot=Be[pt];G.startRing(Z,Ot[0]);let ut=Ot.length>4&&Gy(Ot[Ot.length-2],Ot[0],Ot[1]),ft=be?P0(Ot[Ot.length-2],Ot[0],Ot[1],be):0;const Zt=[];let Yt,ki,Ti;ki=Ot[1].sub(Ot[0])._perp()._unit();let ai=!0;for(let $t=1,Xi=0;$t<Ot.length;$t++){let wi=Ot[$t-1],Ei=Ot[$t];const Hi=Ot[$t===Ot.length-1?1:$t+1];if(G.appendEdge(Z,Ei,wi),sp(Ei,wi,We)){be&&(ki=Hi.sub(Ei)._perp()._unit(),ai=!ai);continue}const sn=Ei.sub(wi)._perp(),nn=sn.x/(Math.abs(sn.x)+Math.abs(sn.y)),fn=sn.y>0?1:0,an=wi.dist(Ei);if(Xi+an>32768&&(Xi=0),be){Ti=Hi.sub(Ei)._perp()._unit();let ye=f_(wi,Ei,Hi,rp(ki,Ti),be);isNaN(ye)&&(ye=0);const Ee=Ei.sub(wi)._unit();wi=wi.add(Ee.mult(ft))._round(),Ei=Ei.add(Ee.mult(-ye))._round(),ft=ye,ki=Ti,K&&this.zoom>=17&&(ze(Zt,wi)||Zt.push(wi),ze(Zt,Ei)||Zt.push(Ei))}const pn=St.vertexLength,Jn=Ot.length>4&&Gy(wi,Ei,Hi);let wr=cm(Xi,ut,ai);if(Hh(this.layoutVertexArray,wi.x,wi.y,nn,fn,0,0,wr),Hh(this.layoutVertexArray,wi.x,wi.y,nn,fn,0,1,wr),this.wallMode){const ye=he($t-1,Ot),Ee=ce.joinNormals[$t-1];Jd(this.wallVertexArray,Ee,ye),Jd(this.wallVertexArray,Ee,ye)}if(Xi+=an,wr=cm(Xi,Jn,!ai),ut=Jn,Hh(this.layoutVertexArray,Ei.x,Ei.y,nn,fn,0,0,wr),Hh(this.layoutVertexArray,Ei.x,Ei.y,nn,fn,0,1,wr),this.wallMode){const ye=he($t,Ot),Ee=ce.joinNormals[$t];Jd(this.wallVertexArray,Ee,ye),Jd(this.wallVertexArray,Ee,ye)}if(St.vertexLength+=4,this.indexArray.emplaceBack(pn+0,pn+1,pn+2),this.indexArray.emplaceBack(pn+1,pn+3,pn+2),St.primitiveLength+=2,be){const ye=dt+($t===1?Ot.length-2:$t-2),Ee=$t===1?dt:ye+1;if(this.indexArray.emplaceBack(pn+1,ye,pn+3),this.indexArray.emplaceBack(ye,Ee,pn+3),St.primitiveLength+=2,Yt===void 0&&(Yt=pn),!sp(Hi,Ot[$t],We)){const yt=$t===Ot.length-1?Yt:St.vertexLength;this.indexArray.emplaceBack(pn+2,pn+3,yt),this.indexArray.emplaceBack(pn+3,yt+1,yt),this.indexArray.emplaceBack(pn+3,Ee,yt+1),St.primitiveLength+=3}ai=!ai}if(P){const ye=this.layoutVertexExtArray,Ee=D.projectTilePoint(wi.x,wi.y,c),yt=D.projectTilePoint(Ei.x,Ei.y,c),Jt=D.upVector(c,wi.x,wi.y),oi=D.upVector(c,Ei.x,Ei.y);ef(ye,Ee,Jt),ef(ye,Ee,Jt),ef(ye,yt,oi),ef(ye,yt,oi)}}j&&(dt+=Ot.length-1),K&&be&&this.zoom>=17&&(Zt.length!==0&&ze(Zt,Zt[0])&&Zt.pop(),this.groundEffect.addData(Zt,We,E,be>0))}this.footprintSegments.push(Gt),Nt.triangleCount=this.indexArray.length-Nt.triangleArrayOffset,this.polygonSegments.push(Nt),++Z.footprintSegLen,++Z.polygonSegLen}if(Z.vertexCount=this.layoutVertexArray.length-Z.vertexArrayOffset,Z.groundVertexCount=this.groundEffect.vertexArray.length-Z.groundVertexArrayOffset,Z.vertexCount!==0){if(Z.centroidXY=G.borders?cg:this.encodeCentroid(G,Z),this.centroidData.push(Z),G.borders){this.featuresOnBorder.push(G);const Be=this.featuresOnBorder.length-1;for(let We=0;We<G.borders.length;We++)G.borders[We][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[We].push(Be)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,m,c,T,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(e,a,p,m,c,T,this.worldview),this.maxHeight=Math.max(this.maxHeight,te)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let v=0;v<this.centroidData.length;v++){const T=this.centroidData[v],E=+(T.min.y+T.max.y>Kt),R=2*E+(+(T.min.x+T.max.x>Kt)^E);for(let D=0;D<T.polygonSegLen;D++){const P=T.polygonSegIdx+D;e.push({centroidIdx:v,subtile:R,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const i=new ls;e.sort((v,T)=>v.triangleSegmentIdx===T.triangleSegmentIdx?v.subtile-T.subtile:v.triangleSegmentIdx-T.triangleSegmentIdx);let a=0,c=0,p=0;for(const v of e){if(v.triangleSegmentIdx!==a)break;p++}const m=e.length;for(;c!==e.length;){a=e[c].triangleSegmentIdx;let v=0,T=c,E=c;for(let R=T;R<p&&e[R].subtile===v;R++)E++;for(;T!==p;){const R=e[T];v=R.subtile;const D=this.centroidData[R.centroidIdx].min.clone(),P=this.centroidData[R.centroidIdx].max.clone(),j={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let G=T;G<E;G++){const Z=e[G],K=this.polygonSegments[Z.polygonSegmentIdx],te=this.centroidData[Z.centroidIdx].min,ce=this.centroidData[Z.centroidIdx].max,he=this.indexArray.uint16;for(let Y=K.triangleArrayOffset;Y<K.triangleArrayOffset+K.triangleCount;Y++)i.emplaceBack(he[3*Y],he[3*Y+1],he[3*Y+2]);j.primitiveLength+=K.triangleCount,D.x=Math.min(D.x,te.x),D.y=Math.min(D.y,te.y),P.x=Math.max(P.x,ce.x),P.y=Math.max(P.y,ce.y)}j.primitiveLength>0&&this.triangleSubSegments.push({segment:j,min:D,max:P}),T=E;for(let G=T;G<p&&e[G].subtile===e[T].subtile;G++)E++}c=p;for(let R=c;R<m&&e[R].triangleSegmentIdx===e[c].triangleSegmentIdx;R++)p++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,a){const c=new kr;if(this.wallMode){for(const Z of this.triangleSubSegments)c.segments.push(Z.segment);return c}let p=0,m=0;const v=1<<e.canonical.z;if(i){const Z=i.getMinMaxForTile(e);Z&&(p=Z.min,m=Z.max)}m+=this.maxHeight;const T=e.toUnwrapped();let E;const R=[T.canonical.x/v+T.wrap,T.canonical.y/v],D=[(T.canonical.x+1)/v+T.wrap,(T.canonical.y+1)/v],P=(Z,K,te)=>[Z[0]*(1-te[0])+K[0]*te[0],Z[1]*(1-te[1])+K[1]*te[1]],j=[],G=[];for(const Z of this.triangleSubSegments){j[0]=Z.min.x/Kt,j[1]=Z.min.y/Kt,G[0]=Z.max.x/Kt,G[1]=Z.max.y/Kt;const K=P(R,D,j),te=P(R,D,G);if(new An([K[0],K[1],p],[te[0],te[1],m]).intersectsPrecise(a)===0){E&&(c.segments.push(E),E=void 0);continue}const ce=Z.segment;E&&E.vertexOffset!==ce.vertexOffset&&(c.segments.push(E),E=void 0),E?(E.vertexLength+=ce.vertexLength,E.primitiveLength+=ce.primitiveLength):E={vertexOffset:ce.vertexOffset,primitiveLength:ce.primitiveLength,vertexLength:ce.vertexLength,primitiveOffset:ce.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&c.segments.push(E),c}encodeCentroid(e,i){const a=e.centroid(),c=i.span(),p=Math.min(7,Math.round(c.x*this.tileToMeter/10)),m=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new Qt(Me(a.x,1,Kt-1)<<3|p,Me(a.y,1,Kt-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new Qt(0,0);const i=e.borders,a=Number.MAX_VALUE;if(i[0][0]!==a||i[1][0]!==a){const c=i[0][0]!==a?0:1;return new Qt(6|(i[0][0]!==a?0:65528),(i[c][0]+i[c][1])/2<<3|6)}{const c=i[2][0]!==a?2:3;return new Qt((i[c][0]+i[c][1])/2<<3|6,6|(i[2][0]!==a?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=hu,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,c=e.flags&hu?cg:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==c.y||p!==c.x){for(let m=i;m<a;++m)this.centroidVertexArray.emplace(m,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(e.toUnwrapped());if(tp(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const p=[];for(const m of this.activeReplacements){if(m.order<a)continue;const v=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(const T of this.centroidData)if(!(T.flags&hu||m.min.x>T.max.x||T.min.x>m.max.x||m.min.y>T.max.y||T.min.y>m.max.y))for(let E=0;E<T.footprintSegLen;E++){const R=this.footprintSegments[T.footprintSegIdx+E];if(p.length=0,hm(this.footprintVertices,R.vertexOffset,R.vertexCount,m.footprintTileId.canonical,e.canonical,p),ip(m.footprint,p,this.footprintIndices.uint16,R.indexOffset,R.indexCount,-R.vertexOffset,-v)){T.flags|=hu;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,a){let c=!1;for(let p=0;p<a.footprintSegLen;p++){const m=this.footprintSegments[a.footprintSegIdx+p];let v=0;for(const T of m.ringIndices){for(let E=v,R=T+v-1;E<T+v;R=E++){const D=this.footprintVertices.int16[2*(E+m.vertexOffset)+0],P=this.footprintVertices.int16[2*(E+m.vertexOffset)+1],j=this.footprintVertices.int16[2*(R+m.vertexOffset)+1];P>i!=j>i&&e<(this.footprintVertices.int16[2*(R+m.vertexOffset)+0]-D)*(i-P)/(j-P)+D&&(c=!c)}v=T}}return c}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,c=!0;const p=4*(e+Kt)*Kt+(i+Kt);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&hu)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||i>m.max.y||m.min.y>i||this.footprintContainsPoint(e,i,m)&&m&&m.height>a&&(a=m.height,this.partLookup[p]=m,c=!!(m.flags&hu));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.partLookup[p]=void 0}}function rp(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function P0(n,e,i,a){const c=e.sub(n)._perp()._unit(),p=i.sub(e)._perp()._unit();return f_(n,e,i,rp(c,p),a)}function f_(n,e,i,a,c){const p=Math.sqrt(1-a*a);return Math.min(n.dist(e)/3,e.dist(i)/3,c*p/a)}function sp(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function p_(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function Gy(n,e,i){if(n.x<0||n.x>=Kt||e.x<0||e.x>=Kt||i.x<0||i.x>=Kt)return!1;const a=i.sub(e),c=a.perp(),p=n.sub(e);return(a.x*p.x+a.y*p.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(p.x*p.x+p.y*p.y))>-.866&&c.x*p.x+c.y*p.y<0}function cm(n,e,i){const a=e?2|n:-3&n;return i?1|a:-2&a}function um(){const n=Math.PI/32,e=Math.tan(n),i=J;return i*Math.sqrt(1+2*e*e)-i}function m_(n,e,i){const a=1<<i.z,c=Ne(i.x/a),p=Ne((i.x+1)/a),m=Ke(i.y/a),v=Ke((i.y+1)/a);return function(T,E,R,D,P=0,j){const G=[];if(!T.length||!R||!D)return G;const Z=(de,be)=>{for(const Fe of de)G.push({polygon:Fe,bounds:be})},K=Math.ceil(Math.log2(R)),te=Math.ceil(Math.log2(D)),ce=K-te,he=[];for(let de=0;de<Math.abs(ce);de++)he.push(ce>0?0:1);for(let de=0;de<Math.min(K,te);de++)he.push(0),he.push(1);let Y=T;if(Y=ig(Y,E[0].y-P,E[1].y+P,1),Y=ig(Y,E[0].x-P,E[1].x+P,0),!Y.length)return G;const le=[];for(he.length?le.push({polygons:Y,bounds:E,depth:0}):Z(Y,E);le.length;){const de=le.pop(),be=de.depth,Fe=he[be],ze=de.bounds[0],Be=de.bounds[1],We=Fe===0?ze.x:ze.y,dt=Fe===0?Be.x:Be.y,Bt=j?j(Fe,We,dt):.5*(We+dt),St=ig(de.polygons,We-P,Bt+P,Fe),Nt=ig(de.polygons,Bt-P,dt+P,Fe);if(St.length){const Gt=[ze,new Qt(Fe===0?Bt:Be.x,Fe===1?Bt:Be.y)];he.length>be+1?le.push({polygons:St,bounds:Gt,depth:be+1}):Z(St,Gt)}if(Nt.length){const Gt=[new Qt(Fe===0?Bt:ze.x,Fe===1?Bt:ze.y),Be];he.length>be+1?le.push({polygons:Nt,bounds:Gt,depth:be+1}):Z(Nt,Gt)}}return G}(n,e,Math.ceil((p-c)/11.25),Math.ceil((m-v)/11.25),1,(T,E,R)=>{if(T===0)return .5*(E+R);{const D=Ke((i.y+E/Kt)/a);return(Ae(.5*(Ke((i.y+R/Kt)/a)+D))*a-i.y)*Kt}})}function hm(n,e,i,a,c,p){const m=Math.pow(2,a.z-c.z);for(let v=0;v<i;v++){let T=n.int16[2*(v+e)+0],E=n.int16[2*(v+e)+1];T=(T+c.x*Kt)*m-a.x*Kt,E=(E+c.y*Kt)*m-a.y*Kt,p.push(new Qt(T,E))}}let ug,dm;mi(lm,"FillExtrusionBucket",{omit:["layers","features"]}),mi(Zu,"PartData"),mi($u,"FootprintSegment"),mi(Wu,"BorderCentroidData"),mi(Uy,"GroundEffect");class $h extends Qt{constructor(e,i,a){super(e,i),this.z=a}}class Hy extends $h{constructor(e,i,a,c){super(e,i,a),this.w=c}}function fm(n,e,i,a){const c=i==="x"?"y":"x",p=(a-n[i])/(e[i]-n[i]);n[c]=Math.round(n[c]+(e[c]-n[c])*p),n[i]=a,n.hasOwnProperty("z")&&(n.z=zi(n.z,e.z,p)),n.hasOwnProperty("w")&&(n.w=zi(n.w,e.w,p))}function o(n,e,i,a){const c=i,p=a;for(const m of["x","y"]){let v=n,T=e;v[m]>=T[m]&&(v=e,T=n),v[m]<c&&T[m]>c&&fm(v,T,m,c),v[m]<p&&T[m]>p&&fm(T,v,m,p)}}function d(n,e,i,a,c,p){const m=[];for(let v=0;v<n.length;v++){const T=n[v];let E;const R=m.length;let D=0;for(let P=0;P<T.length-1;P++){let j=T[P],G=T[P+1],Z=0;const K=D;let te,ce;p&&(Z=Math.hypot(G.x-j.x,G.y-j.y),D+=Z,te=j,ce=G),j.x<e&&G.x<e||(j.x<e?j=new Qt(e,j.y+(e-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x<e&&(G=new Qt(e,j.y+(e-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y<i&&G.y<i||(j.y<i?j=new Qt(j.x+(i-j.y)/(G.y-j.y)*(G.x-j.x),i)._round():G.y<i&&(G=new Qt(j.x+(i-j.y)/(G.y-j.y)*(G.x-j.x),i)._round()),j.x>=a&&G.x>=a||(j.x>=a?j=new Qt(a,j.y+(a-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x>=a&&(G=new Qt(a,j.y+(a-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y>=c&&G.y>=c||(j.y>=c?j=new Qt(j.x+(c-j.y)/(G.y-j.y)*(G.x-j.x),c)._round():G.y>=c&&(G=new Qt(j.x+(c-j.y)/(G.y-j.y)*(G.x-j.x),c)._round()),E&&j.equals(E[E.length-1])||(E=[j],m.push(E),p&&p.push({progress:{min:K+M(te,ce,j)*Z,max:1},parentIndex:v,prevPoint:te,nextPoint:ce})),E.push(G),p&&(p[p.length-1].progress.max=K+M(te,ce,G)*Z,p[p.length-1].nextPoint=ce)))))}if(p&&D>0)for(let P=R;P<m.length;P++)p[P].progress.min/=D,p[P].progress.max/=D}return m}function x(n,e,i,a,c){if(n.length<2)return void a.push(n);const p=[];for(;e.valid();){const[E,R]=e.get();for(let D=0;D<n.length-1;D++){const P=n[D],j=n[D+1],G=sc(P,j,E,R);if(G){const[Z]=G,K=new Qt(zi(P.x,j.x,Z),zi(P.y,j.y,Z));p.push({t:D+Z,distance:0,point:K})}}e.next()}if(p.length===0)return void a.push(n);p.sort((E,R)=>E.t-R.t);let m=0,v=0,T=[];for(a.push(T);m!==n.length;){if(v===p.length){for(;m!==n.length;)T.length!==0&&T[T.length-1].equals(n[m])||T.push(n[m]),m++;break}p[v].t<=m?(T.length!==0&&T[T.length-1].equals(p[v].point)||T.push(p[v].point),Math.trunc(p[v].t),v++):(T.length!==0&&T[T.length-1].equals(n[m])||T.push(n[m]),m++)}}function M(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function z(n,e){return n.x*e.x+n.y*e.y}function q(n,e){if(n.length===1){let i=0;const a=e[i++];let c;for(;!c||a.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const p=e[i],m=n[0],v=c.sub(a),T=p.sub(a),E=m.sub(a),R=z(v,v),D=z(v,T),P=z(T,T),j=z(E,v),G=z(E,T),Z=R*P-D*D,K=(P*j-D*G)/Z,te=(R*G-D*j)/Z,ce=a.z*(1-K-te)+c.z*K+p.z*te;if(isFinite(ce))return ce}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function ue(n,e,i,a,c,p,m,v){const T=m*c.getElevationAt(n,e,!0,!0),E=p[0]!==0,R=E?p[1]===0?m*(p[0]/7-450):m*function(D,P,j){const G=Math.floor(P[0]/8),Z=Math.floor(P[1]/8),K=10*(P[0]-8*G),te=10*(P[1]-8*Z),ce=D.getElevationAt(G,Z,!0,!0),he=D.getMeterToDEM(j),Y=Math.floor(.5*(K*he-1)),le=Math.floor(.5*(te*he-1)),de=D.tileCoordToPixel(G,Z),be=2*Y+1,Fe=2*le+1,ze=function(Nt,Gt,pt,Ot,ut){return[Nt.getElevationAtPixel(Gt,pt,!0),Nt.getElevationAtPixel(Gt+ut,pt,!0),Nt.getElevationAtPixel(Gt,pt+ut,!0),Nt.getElevationAtPixel(Gt+Ot,pt+ut,!0)]}(D,de.x-Y,de.y-le,be,Fe),Be=Math.abs(ze[0]-ze[1]),We=Math.abs(ze[2]-ze[3]),dt=Math.abs(ze[0]-ze[2])+Math.abs(ze[1]-ze[3]),Bt=Math.min(.25,.5*he*(Be+We)/be),St=Math.min(.25,.5*he*dt/Fe);return ce+Math.max(Bt*K,St*te)}(c,p,v):T;return{base:T+(i===0?-1:i),top:E?Math.max(R+a,T+i+2):T+a}}class Oe{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class it{constructor(){this.tasks={},this.taskQueue=[],pi(["process"],this),this.invoker=new Oe(this.process),this.nextId=0}add(e,i){const a=this.nextId++,c=function({type:p,isSymbolTile:m,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-v:p==="maybePrepare"&&m?400-v:500:200-v:100-v}(i);if(c===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:i,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const p=this.tasks[this.taskQueue[c]];p.priority<i&&(i=p.priority,e=c)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class Ft{constructor(e,i,a){this.target=e,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},pi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new it}send(e,i,a,c,p=!1,m){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=m,this.callbacks[v]=a);const T=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!a,targetMapId:c,mustQueue:p,sourceMapId:this.mapId,data:ql(i,T)},T),{cancel:()=>{a&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(i.mustQueue||Mn(self)){const c=this.callbacks[a],p=this.scheduler.add(()=>this.processTask(a,i),c&&c.metadata||{type:"message"});p&&(this.cancelCallbacks[a]=p)}else this.processTask(a,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(i.error?a($l(i.error)):a(null,$l(i.data)))}else{const a=new Set,c=i.hasCallback?(m,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?ql(m):null,data:ql(v,a)},a)}:()=>{},p=$l(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,p,c);else if(this.parent.getWorkerSource){const m=i.type.split("."),{source:v,scope:T}=p;this.parent.getWorkerSource(i.sourceMapId,m[0],v,T)[m[1]](p,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var ui={workerUrl:"",workerClass:null,workerParams:void 0};const xi="mapboxgl_preloaded_worker_pool";class jt{constructor(){this.active={}}acquire(e,i=jt.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(ui.workerClass!=null?new ui.workerClass:new self.Worker(ui.workerUrl,ui.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[xi]}numActive(){return Object.keys(this.active).length}}jt.workerCount=2;class qt{constructor(e,i,a="Worker",c=jt.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=rt();const p=this.workerPool.acquire(this.id,c);for(let m=0;m<p.length;m++){const v=new qt.Actor(p[m],i,this.id);v.name=`${a} ${m}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,a){Ue(this.actors,(c,p)=>{c.send(e,i,p)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let zn,Dn;function Yr(){return zn||(zn=new jt),zn}qt.Actor=Ft;class Mt{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,a/i.BYTES_PER_ELEMENT),a}createFloatArray(e){const i=new Float32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,a/i.BYTES_PER_ELEMENT),a}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let a=0;a<e.length;++a)this.module.heapU8[i+a]=e.charCodeAt(a);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,a=e.facadeGlazingColorRgb,c=e.roofColorRgb,p=e.wallColorRgb,m=e.normalScale;this.module.setStyle(i[0],i[1],i[2],a[0],a[1],a[2],c[0],c[1],c[2],p[0],p[1],p[2],m[0],m[1],m[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setFacadeOptions(e,i,a){this.module.setFacadeOptions(e,i,a)}generateMesh(e,i){for(const v of e){const T=this.createStringBuffer(v.roofType),E=[0],R=[];for(const j of v.coordinates)if(Array.isArray(j)){for(const G of j)R.push(G.x),R.push(G.y);E.push(R.length)}const D=this.createIntArray(E),P=this.createFloatArray(R);this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,T,v.roofType.length,P,D,E.length-1),this.module.free(T),this.module.free(D),this.module.free(P)}for(const v of i){let T;T=v.entrances?JSON.parse(v.entrances):[];const E=this.createFloatArray(T),R=[];for(const P of v.coordinates)R.push(P.x),R.push(P.y);const D=this.createFloatArray(R);this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,E,T.length,D,R.length),this.module.free(E),this.module.free(D)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const a=this.module.getMeshCount(),c=new Array(a);for(let v=0;v<a;v++){const T=this.module.getPositionsPtr(v),E=this.module.getPositionsLength(v),R=new Float32Array(this.module.heapF32.buffer,T,E),D=this.module.getNormalsPtr(v),P=this.module.getNormalsLength(v),j=new Float32Array(this.module.heapF32.buffer,D,P),G=this.module.getColorsPtr(v),Z=this.module.getColorsLength(v),K=new Uint8Array(this.module.heapU8.buffer,G,Z),te=this.module.getAOPtr(v),ce=this.module.getAOLength(v),he=new Float32Array(this.module.heapF32.buffer,te,ce),Y=this.module.getIndicesPtr(v),le=this.module.getIndicesLength(v),de=new Int32Array(this.module.heap32.buffer,Y,le),be=this.module.getBuildingPart(v),Fe=this.readStringBuffer(be);c[v]={positions:R,normals:j,colors:K,ao:he,indices:de,buildingPart:Fe}}const p=this.module.getRingCount(),m=[];for(let v=0;v<p;v++){const T=this.module.getRingPtr(v),E=this.module.getRingLength(v),R=new Float32Array(this.module.heapF32.buffer,T,E);m.push(R)}return{meshes:c,modifiedPolygonRings:m}}}let _t,zt,ci,tn,mr,dn=null,Cn=null,Oa=null,Vr=null;function Xu(){return Mn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:zt||hs.DRACO_URL}function qy(){if(Mn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(tn)return tn;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return tn=WebAssembly.validate(n)?hs.MESHOPT_SIMD_URL:hs.MESHOPT_URL,tn}const $y={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lM={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},g_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function N1(n,e,i){const a=i.json.bufferViews.length,c=i.buffers.length;e.bufferView=a,i.json.bufferViews[a]={buffer:c,byteLength:n.byteLength},i.buffers[c]=n}const O0="KHR_draco_mesh_compression";function cM(n,e){const i=n.extensions&&n.extensions[O0];if(!i)return;const a=new ci.Decoder,c=V1(e,i.bufferView),p=new ci.Mesh;if(!a.DecodeArrayToMesh(c,c.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[n.indices],v=$y[m.componentType],T=m.count*v.BYTES_PER_ELEMENT,E=ci._malloc(T);v===Uint16Array?a.GetTrianglesUInt16Array(p,T,E):a.GetTrianglesUInt32Array(p,T,E),N1(ci.memory.buffer.slice(E,E+T),m,e),ci._free(E);for(const R of Object.keys(i.attributes)){const D=a.GetAttributeByUniqueId(p,i.attributes[R]),P=e.json.accessors[n.attributes[R]],j=lM[P.componentType],G=P.count*g_[P.type]*$y[P.componentType].BYTES_PER_ELEMENT,Z=ci._malloc(G);a.GetAttributeDataArrayForAllPoints(p,D,ci[j],G,Z),N1(ci.memory.buffer.slice(Z,Z+G),P,e),ci._free(Z)}a.destroy(),p.destroy(),delete n.extensions[O0]}const Zy="EXT_meshopt_compression";function uM(n,e){if(!n.extensions||!n.extensions[Zy])return;const i=n.extensions[Zy],a=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),c=new Uint8Array(i.count*i.byteStride);mr.decodeGltfBuffer(c,i.count,i.byteStride,a,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=c.buffer,delete n.extensions[Zy]}const F1=1179937895,B1=new TextDecoder("utf8");function j1(n,e){return new URL(n,e).href}function hM(n,e,i,a){return fetch(j1(n.uri,a)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[i]=c})}function V1(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function dM(n,e,i,a){if(n.uri){const c=j1(n.uri,a);return fetch(c).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{e.images[i]=p})}if(n.bufferView!==void 0){const c=V1(e,n.bufferView),p=new Blob([c],{type:n.mimeType});return createImageBitmap(p).then(m=>{e.images[i]=m})}}function U1(n,e=0,i){const a={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===F1){const R=new Uint32Array(n,e);let D=2;const P=(R[D++]>>2)-3,j=R[D++]>>2;if(D++,a.json=JSON.parse(B1.decode(R.subarray(D,D+j))),D+=j,D<P){const G=R[D++];D++;const Z=e+(D<<2);a.buffers[0]=n.slice(Z,Z+G)}}else a.json=JSON.parse(B1.decode(new Uint8Array(n,e)));const{buffers:c,images:p,meshes:m,extensionsUsed:v,bufferViews:T}=a.json;let E=Promise.resolve();if(c){const R=[];for(let D=0;D<c.length;D++){const P=c[D];P.uri?R.push(hM(P,a,D,i)):a.buffers[D]||(a.buffers[D]=null)}E=Promise.all(R)}return E.then(()=>{const R=[],D=v&&v.includes(O0),P=v&&v.includes(Zy);if(D&&R.push(function(){if(!ci)return _t??(_t=function(j){let G,Z=null;function K(){G=new Uint8Array(Z.buffer)}function te(){throw new Error("Unexpected Draco error.")}const ce={a:{a:te,d:function(he,Y,le){return G.copyWithin(he,Y,Y+le)},c:function(he){const Y=G.length,le=Math.max(he>>>0,Math.ceil(1.2*Y)),de=Math.ceil((le-Y)/65536);try{return Z.grow(de),K(),!0}catch{return!1}},b:te}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(j,ce):j.then(he=>he.arrayBuffer()).then(he=>WebAssembly.instantiate(he,ce))).then(he=>{const{Rb:Y,Qb:le,P:de,T:be,X:Fe,Ja:ze,La:Be,Qa:We,Va:dt,Wa:Bt,eb:St,jb:Nt,f:Gt,e:pt,yb:Ot,zb:ut,Ab:ft,Bb:Zt,Db:Yt,Gb:ki}=he.instance.exports;Z=pt;const Ti=(()=>{let ai=0,$t=0,Xi=0,wi=0;return Ei=>{Xi&&(Y(wi),Y(ai),$t+=Xi,Xi=ai=0),ai||($t+=128,ai=le($t));const Hi=Ei.length+7&-8;let sn=ai;Hi>=$t&&(Xi=Hi,sn=wi=le(Hi));for(let nn=0;nn<Ei.length;nn++)G[sn+nn]=Ei[nn];return sn}})();return K(),Gt(),{memory:pt,_free:Y,_malloc:le,Mesh:class{constructor(){this.ptr=de()}destroy(){be(this.ptr)}},Decoder:class{constructor(){this.ptr=ze()}destroy(){Nt(this.ptr)}DecodeArrayToMesh(ai,$t,Xi){const wi=Ti(ai),Ei=Be(this.ptr,wi,$t,Xi.ptr);return!!Fe(Ei)}GetAttributeByUniqueId(ai,$t){return{ptr:We(this.ptr,ai.ptr,$t)}}GetTrianglesUInt16Array(ai,$t,Xi){dt(this.ptr,ai.ptr,$t,Xi)}GetTrianglesUInt32Array(ai,$t,Xi){Bt(this.ptr,ai.ptr,$t,Xi)}GetAttributeDataArrayForAllPoints(ai,$t,Xi,wi,Ei){St(this.ptr,ai.ptr,$t.ptr,Xi,wi,Ei)}},DT_INT8:Ot(),DT_UINT8:ut(),DT_INT16:ft(),DT_UINT16:Zt(),DT_UINT32:Yt(),DT_FLOAT32:ki()}})}(fetch(Xu())),_t.then(j=>{ci=j,_t=void 0}))}()),P&&R.push(function(){if(mr)return;const j=function(G){let Z;const K=WebAssembly.instantiateStreaming(G,{}).then(he=>{Z=he.instance,Z.exports.__wasm_call_ctors()}),te={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ce={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:K,supported:!0,decodeGltfBuffer(he,Y,le,de,be,Fe){(function(ze,Be,We,dt,Bt,St,Nt){const Gt=ze.exports.sbrk,pt=dt+3&-4,Ot=Gt(pt*Bt),ut=Gt(St.length),ft=new Uint8Array(ze.exports.memory.buffer);ft.set(St,ut);const Zt=Be(Ot,dt,Bt,ut,St.length);if(Zt===0&&Nt&&Nt(Ot,pt,Bt),We.set(ft.subarray(Ot,Ot+dt*Bt)),Gt(Ot-Gt(0)),Zt!==0)throw new Error(`Malformed buffer data: ${Zt}`)})(Z,Z.exports[ce[be]],he,Y,le,de,Z.exports[te[Fe]])}}}(fetch(qy()));return j.ready.then(()=>{mr=j})}()),p)for(let j=0;j<p.length;j++)R.push(dM(p[j],a,j,i));return(R.length?Promise.all(R):Promise.resolve()).then(()=>{if(D&&m)for(const{primitives:j}of m)for(const G of j)cM(G,a);if(P&&m&&T)for(const j of T)uM(j,a);return a})})}class G1{constructor(e){this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.hasPattern=!1,this.worldview=e.worldview}updateFootprints(e,i){}prepare(){return function(){if(Vr!=null||Oa!=null)return null;if(Cn!=null)return Cn;const e=fetch(hs.BUILDING_GEN_URL);return Cn=function(i){let a,c,p,m;function v(){a=new Uint8Array(m.buffer),c=new Int32Array(m.buffer),p=new Float32Array(m.buffer)}function T(){throw new Error("Unexpected BuildingGen error.")}const E=()=>{},R={a:{a:T,f:function(D){const P=a.length,j=Math.max(D>>>0,Math.ceil(1.2*P)),G=Math.ceil((j-P)/65536);try{return m.grow(G),v(),!0}catch{return!1}},g:T,b:E,c:E,d:E,e:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,R):i.then(D=>D.arrayBuffer()).then(D=>WebAssembly.instantiate(D,R))).then(D=>{const P=D.instance.exports;return(0,P.g)(),m=P.f,v(),new Mt({setStyle:P.h,setAOOptions:P.i,setMetricOptions:P.j,setFacadeOptions:P.k,addFeature:P.l,addFacade:P.m,generateMesh:P.n,getLastError:P.o,getMeshCount:P.p,getPositionsPtr:P.q,getPositionsLength:P.r,getNormalsPtr:P.s,getNormalsLength:P.t,getColorsPtr:P.u,getColorsLength:P.v,getAOPtr:P.w,getAOLength:P.x,getIndicesPtr:P.y,getIndicesLength:P.z,getBuildingPart:P.A,getRingCount:P.B,getRingPtr:P.C,getRingLength:P.D,free:P.E,malloc:P.F,heapU8:a,heap32:c,heapF32:p})})}(e).then(i=>(Cn=null,Vr=i,Vr)).catch(i=>{Yi("Could not load building-gen"),Cn=null,Oa=i}),Cn}()}populate(e,i,a,c){}update(e,i,a,c,p,m,v){}isEmpty(){return!1}uploadPending(){return!1}upload(e){}destroy(){}getHeightAtTileCoord(e,i){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let H1,q1;mi(G1,"BuildingBucket",{omit:["layers"]});const fM=En([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),pM=En([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:mM}=fM,gM=En([{name:"a_packed",components:3,type:"Float32"}]),{members:_M}=gM,yM=En([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:vM}=yM;class $1{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Cl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=Xt(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const c=[];let p=e.length%2==1?-e[e.length-1]*a:0,m=e[0]*a,v=!0;c.push({left:p,right:m,isDash:v,zeroLength:e[0]===0});let T=e[0];for(let E=1;E<e.length;E++){v=!v;const R=e[E];p=T*a,T+=R,m=T*a,c.push({left:p,right:m,isDash:v,zeroLength:R===0})}return c}addRoundDash(e,i,a){const c=i/2;for(let p=-a;p<=a;p++){const m=this.width*(this.nextRow+a+p);let v=0,T=e[v];for(let E=0;E<this.width;E++){E/T.right>1&&(T=e[++v]);const R=Math.abs(E-T.left),D=Math.abs(E-T.right),P=Math.min(R,D);let j;const G=p/a*(c+1);if(T.isDash){const Z=c-Math.abs(G);j=Math.sqrt(P*P+Z*Z)}else j=c-Math.sqrt(P*P+G*G);this.image.data[m+E]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e,i){for(let T=e.length-1;T>=0;--T){const E=e[T],R=e[T+1];E.zeroLength?e.splice(T,1):R&&R.isDash===E.isDash&&(R.left=E.left,e.splice(T,1))}const a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const p=this.width*this.nextRow;let m=0,v=e[m];for(let T=0;T<this.width;T++){T/v.right>1&&(v=e[++m]);const E=Math.abs(T-v.left),R=Math.abs(T-v.right),D=Math.min(E,R);this.image.data[p+T]=Math.max(0,Math.min(255,(v.isDash?D:-D)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const c=i==="round",p=c?7:0,m=2*p+1;if(this.nextRow+m>this.height)return Yi("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let R=0;R<e.length;R++)e[R]<0&&(Yi("Negative value is found in line dasharray, replacing values with 0"),e[R]=0),v+=e[R];if(v!==0){const R=this.width/v,D=this.getDashRanges(e,this.width,R);c?this.addRoundDash(D,R,p):this.addRegularDash(D,i==="square"?.5*R:0)}const T=this.nextRow+p;this.nextRow+=m;const E={tl:[T,p],br:[v,0]};return this.positions[a]=E,E}}mi($1,"LineAtlas");const xM=Wi.VectorTileFeature.types,bM=Math.cos(Math.PI/180*37.5),wM=Math.cos(Math.PI/180*5);class L0{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new nu,this.layoutVertexArray2=new So,this.patternVertexArray=new So,this.indexArray=new ls,this.programConfigurations=new u(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new kr,this.maxLineLength=0,this.zOffsetVertexArray=new So,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Kt/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,c){this.hasPattern=tg("line",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=lt(a);const m=this.layers[0].layout.get("line-elevation-reference");if(m==="hd-road-markup")this.elevationType="road";else{const P=this.layers[0].layout.get("line-z-offset"),j=P.isConstant()&&!P.constantOr(0);this.elevationType=m!=="sea"&&m!=="ground"&&j?"none":"offset",this.elevationType==="offset"&&m==="none"&&Yi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const T=[];for(const{feature:P,id:j,index:G,sourceLayerIndex:Z}of e){const K=this.layers[0]._featureFilter.needGeometry,te=hi(P,K);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom,{worldview:this.worldview}),te,a))continue;const ce=p?p.evaluate(te,{},a):void 0,he={id:j,properties:P.properties,type:P.type,sourceLayerIndex:Z,index:G,geometry:K?te.geometry:di(P,a,c),patterns:{},sortKey:ce};T.push(he)}p&&T.sort((P,j)=>P.sortKey-j.sortKey);const{lineAtlas:E,featureIndex:R}=i,D=this.addConstantDashes(E);for(const P of T){const{geometry:j,index:G,sourceLayerIndex:Z}=P;if(D&&this.addFeatureDashes(P,E),this.hasPattern){const K=Qf("line",this.layers,P,this.zoom,this.pixelRatio,i);this.patternFeatures.push(K)}else this.addFeature(P,j,G,a,E.positions,i.availableImages,i.brightness,i.elevationFeatures);R.insert(e[G].feature,j,G,Z,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,p=a.layout.get("line-cap").value;if(c.kind!=="constant"||p.kind!=="constant")i=!0;else{const m=p.value,v=c.value;if(!v)continue;e.addDash(v,m)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let v,T;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:a},e);T=m.kind==="constant"?m.value:m.evaluate({zoom:a},e),i.addDash(v,T),e.patterns[c.id]=[i.getKey(v,T)]}}update(e,i,a,c,p,m,v,T){this.programConfigurations.updatePaintArrays(e,i,p,a,c,m,v,T)}addFeatures(e,i,a,c,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,a,c,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,_M)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,vM)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,pM.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mM),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,a,c,p,m,v,T){const E=this.layers[0].layout,R=E.get("line-join").evaluate(e,{}),D=E.get("line-cap").evaluate(e,{}),P=E.get("line-miter-limit"),j=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=E.get("line-z-offset").value;const G=this.layers[0].paint.get("line-width").value;if(G.kind!=="constant"&&G.isLineProgressConstant===!1&&(this.variableWidthValue=G),this.elevationType==="road"){const Z=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,c,T,R,D,P,j)){const[K,te]=this.clipRuntimeLinesToTile(i,1);for(let ce=0;ce<K.length;ce++){const he=K[ce],Y=te[ce],le={progress:{min:Y.progress.min,max:Y.progress.max},nextDir:this.computeSegNextDir(Y,he),prevDir:this.computeSegPrevDir(Y,he)};this.addLine(he,e,c,R,D,P,j,le)}this.fillNonElevatedRoadSegment(Z)}}else for(const Z of i)this.addLine(Z,e,c,R,D,P,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,m,c,v,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return d(e,-i,-i,Kt+i,Kt+i)}clipRuntimeLinesToTile(e,i){const a=[];return[d(e,-i,-i,Kt+i,Kt+i,a),a]}addElevatedRoadFeature(e,i,a,c,p,m,v,T){const E=[],R=uo.getElevationFeature(e,c);if(R){const D=this.clipLinesToTile(i,1),P=this.prepareElevatedLines(D,R,a);for(const j of P)E.push({geometry:j,elevation:R,elevationTileID:a,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(E.length===0)return!1;for(const D of E){const P=this.layoutVertexArray.length;this.addLine(D.geometry,e,a,p,m,v,T);const j=new rl(a,D.elevationTileID);if(D.elevation)for(let G=P;G<this.layoutVertexArray.length;G++){const Z=new Qt(this.layoutVertexArray.int16[6*G]>>1,this.layoutVertexArray.int16[6*G+1]>>1),K=j.pointElevation(Z,D.elevation,.05);this.updateHeightRange(K),this.zOffsetVertexArray.emplaceBack(K,0,0)}else this.fillNonElevatedRoadSegment(P)}return!0}prepareElevatedLines(e,i,a){if(i.constantHeight!=null)return e;const c=[],p=1/lt(a);for(const m of e)x(m,new na(i,p),0,c);return c}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,a,c,p,m,v,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const E=c==="none";this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const R=T&&T.progress.min>0,D=T&&T.progress.max<1;if(this.lineClips){let Fe={min:this.lineClips.start,max:this.lineClips.end},ze=1;if(T){const dt=this.lineClips.end-this.lineClips.start;Fe=function(Bt,St,Nt){return{min:Ba(Bt.min,St,Nt),max:Ba(Bt.max,St,Nt)}}(T.progress,{min:0,max:1},Fe),dt>0&&(ze=(Fe.max-Fe.min)/dt)}const Be=+i.properties.mapbox_clip_feature_len,We=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Be)||Number.isNaN(We)){for(let Bt=0;Bt<e.length-1;Bt++)this.totalDistance+=e[Bt].dist(e[Bt+1]);const dt=this.totalDistance/(Fe.max-Fe.min);this.totalFeatureLength=Number.isFinite(dt)?dt:0,this.lineClips.start=Fe.min,this.lineClips.end=Fe.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Be,this.distance=We*ze,this.lineClips.start=Fe.min,this.lineClips.end=Fe.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const P=xM[i.type]==="Polygon";let j=e.length;for(;j>=2&&e[j-1].equals(e[j-2]);)j--;let G=0;for(;G<j-1&&e[G].equals(e[G+1]);)G++;if(j<(P?3:2))return;c==="bevel"&&(m=1.05);const Z=this.segments.prepareSegment(10*j,this.layoutVertexArray,this.indexArray);let K,te,ce,he,Y,le,de,be;T&&T.prevDir&&(le=T.prevDir.perp()),T&&T.nextDir&&(de=T.nextDir.perp()),this.e1=this.e2=-1,P&&(K=e[j-2],Y=e[G].sub(K)._unit()._perp());for(let Fe=G;Fe<j;Fe++){if(ce=Fe===j-1?P?e[G+1]:void 0:e[Fe+1],ce&&e[Fe].equals(ce))continue;Y&&(he=Y),K&&(te=K),K=e[Fe],be=this.evaluateLineProgressFeatures(te?te.dist(K):0),Y=ce?ce.sub(K)._unit()._perp():he,he=he||Y;const ze=te&&ce;let Be=ze?c:P||E?"butt":p;const We=he.x*Y.x+he.y*Y.y;if(E){const ut=function(ft){if(ft.patternJoinNone){const Zt=ft.segmentPoints.length/2,Yt=ft.lineSoFar-ft.segmentStart;for(let ki=0;ki<Zt;++ki){const Ti=ft.segmentPoints[2*ki+1],ai=Math.round(ft.segmentPoints[2*ki])+.5+.25*Ti;ft.patternVertexArray.emplaceBack(ai,Yt,ft.segmentStart),ft.patternVertexArray.emplaceBack(ai,Yt,ft.segmentStart)}ft.segmentPoints.length=0}ft.e1=ft.e2=-1};if(ze&&We<wM){this.updateDistance(te,K),this.addCurrentVertex(K,he,1,1,Z,be),ut(this),this.addCurrentVertex(K,Y,-1,-1,Z,be);continue}if(te){if(!ce){this.updateDistance(te,K),this.addCurrentVertex(K,he,1,1,Z,be),ut(this);continue}Be="miter"}}let dt=he.add(Y);dt.x===0&&dt.y===0||dt._unit();const Bt=dt.x*Y.x+dt.y*Y.y,St=Bt!==0?1/Bt:1/0,Nt=2*Math.sqrt(2-2*Bt),Gt=Bt<bM&&te&&ce,pt=he.x*Y.y-he.y*Y.x>0,Ot=this.overscaling<=16?15*Kt/(512*this.overscaling):0;if(ze&&Be==="round"){if(St<v)Be="miter";else if(St<=2){const ut=z0(K,-10,Kt+10);Be=this.elevationType==="offset"&&(ut||this.hasCrossSlope)?"miter":"fakeround"}}if(Be==="miter"&&St>m&&(Be="bevel"),Be==="bevel"&&(St>2&&(Be="flipbevel"),St<m&&(Be="miter")),te&&!(Be==="miter"&&Gt)&&this.updateDistance(te,K),Be==="miter")if(Gt){const ut=K.dist(te);if(ut>2*Ot){const Zt=K.sub(K.sub(te)._mult(Ot/ut)._round());this.updateDistance(te,Zt),this.addCurrentVertex(Zt,he,0,0,Z,be),te=Zt}this.updateDistance(te,K),dt._mult(St),this.addCurrentVertex(K,dt,0,0,Z,be);const ft=K.dist(ce);if(ft>2*Ot){const Zt=K.add(ce.sub(K)._mult(Ot/ft)._round());this.updateDistance(K,Zt),this.addCurrentVertex(Zt,Y,0,0,Z,be),K=Zt}}else dt._mult(St),this.addCurrentVertex(K,dt,0,0,Z,be);else if(Be==="flipbevel"){if(St>100)dt=Y.mult(-1);else{const ut=St*he.add(Y).mag()/he.sub(Y).mag();dt._perp()._mult(ut*(pt?-1:1))}this.addCurrentVertex(K,dt,0,0,Z,be),this.addCurrentVertex(K,dt.mult(-1),0,0,Z,be)}else if(Be==="bevel"||Be==="fakeround"){be!=null&&te&&this.addCurrentVertex(K,de||he,-1,-1,Z,be);const ut=K.dist(te)<=2*Ot&&Be!=="bevel",ft=dt.mult(pt?1:-1);ft._mult(St);const Zt=Y.mult(pt?-1:1),Yt=he.mult(pt?-1:1),ki=this.evaluateLineProgressFeatures(this.distance);if(be==null&&(this.addHalfVertex(K,ft.x,ft.y,!1,!pt,0,Z,ki),ut||this.addHalfVertex(K,ft.x+2*Yt.x,ft.y+2*Yt.y,!1,pt,0,Z,ki)),Be==="fakeround"){const Ti=Math.round(180*Nt/Math.PI/20);this.addHalfVertex(K,Yt.x,Yt.y,!1,pt,0,Z,ki);for(let ai=0;ai<Ti;ai++){let $t=ai/Ti;if($t!==.5){const wi=$t-.5;$t+=$t*wi*($t-1)*((1.0904+We*(We*(3.55645-1.43519*We)-3.2452))*wi*wi+(.848013+We*(.215638*We-1.06021)))}const Xi=Zt.sub(Yt)._mult($t)._add(Yt)._unit();this.addHalfVertex(K,Xi.x,Xi.y,!1,pt,0,Z,ki)}this.addHalfVertex(K,Zt.x,Zt.y,!1,pt,0,Z,ki)}ut||be!=null||this.addHalfVertex(K,ft.x+2*Zt.x,ft.y+2*Zt.y,!1,pt,0,Z,ki),be!=null&&ce&&this.addCurrentVertex(K,le||Y,1,1,Z,be)}else if(Be==="butt")this.addCurrentVertex(K,dt,0,0,Z,be);else if(Be==="square"){if(!te){const ut=R?0:-1;this.addCurrentVertex(K,dt,ut,ut,Z,be)}if(this.addCurrentVertex(K,dt,0,0,Z,be),te){const ut=D?0:1;this.addCurrentVertex(K,dt,ut,ut,Z,be)}}else if(Be==="round"){if(te){const ut=!ze&&de?de:he;this.addCurrentVertex(K,ut,0,0,Z,be),!ze&&D||this.addCurrentVertex(K,ut,1,1,Z,be,!0)}if(ce){const ut=!ze&&le?le:Y;!ze&&R||this.addCurrentVertex(K,ut,-1,-1,Z,be,!0),this.addCurrentVertex(K,ut,0,0,Z,be)}}}}addVerticesTo(e,i,a,c,p,m,v,T,E,R){const D=(i.w-e.w)/this.tessellationStep|0;let P=0;const j=this.scaledDistance;if(D>1){this.lineSoFar=e.w;const Z=(i.x-e.x)/D,K=(i.y-e.y)/D,te=(i.z-e.z)/D,ce=(i.w-e.w)/D;for(let he=1;he<D;++he){e.x+=Z,e.y+=K,e.z+=te,this.lineSoFar+=ce,P+=ce;const Y=this.evaluateLineProgressFeatures(this.prevDistance+P);this.scaledDistance=(this.prevDistance+P)/this.totalDistance,this.addHalfVertex(e,a,c,R,!1,v,E,Y),this.addHalfVertex(e,p,m,R,!0,-T,E,Y)}}this.lineSoFar=i.w,this.scaledDistance=j;const G=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,a,c,R,!1,v,E,G),this.addHalfVertex(i,p,m,R,!0,-T,E,G)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Yi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,a,c,p,m,v=!1){const T=i.x+i.y*a,E=i.y-i.x*a,R=i.y*c-i.x,D=-i.y-i.x*c;if(m!=null){const P=this.elevationType==="offset",j=-10,G=Kt+10,Z=m.zOffset,K=new Hy(e.x,e.y,Z,this.lineSoFar),te=!!P&&z0(e,j,G),ce=this.lineSoFar,he=this.distance;if(this.currentVertex)if(te){const Y=this.currentVertexIsOutside,le=this.currentVertex,de=new Hy(e.x,e.y,Z,this.lineSoFar);if(o(le,de,j,G),!z0(de,j,G)){if(Y){this.e1=this.e2=-1,this.distance-=le.dist(K),this.lineSoFar=le.w;const be=this.evaluateLineProgressFeatures(le.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(le,T,E,v,!1,a,p,be),this.addHalfVertex(le,R,D,v,!0,-c,p,be),this.prevDistance=this.distance}this.distance=this.prevDistance+le.dist(de),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(le,de,T,E,R,D,a,c,p,v),this.distance=he,this.scaledDistance=this.distance/this.totalDistance}}else{const Y=this.currentVertex;if(this.currentVertexIsOutside){o(Y,K,j,G),this.e1=this.e2=-1,this.distance-=Y.dist(K),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Y.w;const le=this.evaluateLineProgressFeatures(Y.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Y,T,E,v,!1,a,p,le),this.addHalfVertex(Y,R,D,v,!0,-c,p,le),this.prevDistance=this.distance,this.distance=he,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Y,K,T,E,R,D,a,c,p,v)}else te||(this.addHalfVertex(e,T,E,v,!1,a,p,m),this.addHalfVertex(e,R,D,v,!0,-c,p,m));this.currentVertex=K,this.currentVertexIsOutside=te,this.lineSoFar=ce}else this.addHalfVertex(e,T,E,v,!1,a,p,m),this.addHalfVertex(e,R,D,v,!0,-c,p,m)}addHalfVertex({x:e,y:i},a,c,p,m,v,T,E){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const D=zi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,D)}const R=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),T.primitiveLength++),m?this.e2=R:this.e1=R,E!=null&&this.zOffsetVertexArray.emplaceBack(E.zOffset,E.variableWidth,E.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function z0(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let Z1,W1;function X1(n,e,i){return e*(Kt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}mi(L0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Y1=(n,e,i)=>(1-i)*n+i*e;function K1(n,e){return 1/X1(n,1,e.tileZoom)}function Q1(n,e,i,a){return n.translatePosMatrix(a||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const J1=n=>{const e=[];ew(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=n.layout.get("line-join").constantOr("miter")==="none",c=!!n.paint.get("line-pattern").constantOr(1);return a&&c&&e.push("LINE_JOIN_NONE"),e};function ew(n){const e=n.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let k0;const tw=()=>k0||(k0={layout:Z1||(Z1=new zr({"line-cap":new ni(Ye.layout_line["line-cap"]),"line-join":new ni(Ye.layout_line["line-join"]),"line-miter-limit":new Ut(Ye.layout_line["line-miter-limit"]),"line-round-limit":new Ut(Ye.layout_line["line-round-limit"]),"line-sort-key":new ni(Ye.layout_line["line-sort-key"]),"line-z-offset":new ni(Ye.layout_line["line-z-offset"]),"line-elevation-reference":new Ut(Ye.layout_line["line-elevation-reference"]),"line-cross-slope":new Ut(Ye.layout_line["line-cross-slope"]),visibility:new Ut(Ye.layout_line.visibility),"line-width-unit":new Ut(Ye.layout_line["line-width-unit"])})),paint:W1||(W1=new zr({"line-opacity":new ni(Ye.paint_line["line-opacity"]),"line-color":new ni(Ye.paint_line["line-color"]),"line-translate":new Ut(Ye.paint_line["line-translate"]),"line-translate-anchor":new Ut(Ye.paint_line["line-translate-anchor"]),"line-width":new ni(Ye.paint_line["line-width"]),"line-gap-width":new ni(Ye.paint_line["line-gap-width"]),"line-offset":new ni(Ye.paint_line["line-offset"]),"line-blur":new ni(Ye.paint_line["line-blur"]),"line-dasharray":new ni(Ye.paint_line["line-dasharray"]),"line-pattern":new ni(Ye.paint_line["line-pattern"]),"line-pattern-cross-fade":new Ut(Ye.paint_line["line-pattern-cross-fade"]),"line-gradient":new Yl(Ye.paint_line["line-gradient"]),"line-trim-offset":new Ut(Ye.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ut(Ye.paint_line["line-trim-fade-range"]),"line-trim-color":new Ut(Ye.paint_line["line-trim-color"]),"line-emissive-strength":new Ut(Ye.paint_line["line-emissive-strength"]),"line-border-width":new ni(Ye.paint_line["line-border-width"]),"line-border-color":new ni(Ye.paint_line["line-border-color"]),"line-occlusion-opacity":new Ut(Ye.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},k0);class TM extends ni{possiblyEvaluate(e,i){return i=new Kn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,a,c){return i=tt({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,a,c)}}let __;function iw(n,e){return e>0?e+2*n:n}const SM=En([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),EM=En([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),AM=En([{name:"a_projected_pos",components:4,type:"Float32"}],4);En([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const CM=En([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),MM=En([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),IM=En([{name:"a_texb",components:2,type:"Uint16"}]),RM=En([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),DM=En([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);En([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const nw=En([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),PM=En([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);En([{name:"triangle",components:3,type:"Uint16"}]),En([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),En([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),En([{type:"Float32",name:"offsetX"}]),En([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var pa=24;function OM(n,e,i){return n.sections.forEach(a=>{a.text=function(c,p,m){const v=p.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?c=c.toLocaleUpperCase():v==="lowercase"&&(c=c.toLocaleLowerCase()),Wl.applyArabicShaping&&(c=Wl.applyArabicShaping(c)),c}(a.text,e,i)}),n}const y_={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function LM(n){return n==="︶"||n==="﹈"||n==="︸"||n==="﹄"||n==="﹂"||n==="︾"||n==="︼"||n==="︺"||n==="︘"||n==="﹀"||n==="︐"||n==="︓"||n==="︔"||n==="｀"||n==="￣"||n==="︑"||n==="︒"}function zM(n){return n==="︵"||n==="﹇"||n==="︷"||n==="﹃"||n==="﹁"||n==="︽"||n==="︻"||n==="︹"||n==="︗"||n==="︿"}var rw,N0,sw,F0={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function kM(){return rw||(rw=1,F0.read=function(n,e,i,a,c){var p,m,v=8*c-a-1,T=(1<<v)-1,E=T>>1,R=-7,D=i?c-1:0,P=i?-1:1,j=n[e+D];for(D+=P,p=j&(1<<-R)-1,j>>=-R,R+=v;R>0;p=256*p+n[e+D],D+=P,R-=8);for(m=p&(1<<-R)-1,p>>=-R,R+=a;R>0;m=256*m+n[e+D],D+=P,R-=8);if(p===0)p=1-E;else{if(p===T)return m?NaN:1/0*(j?-1:1);m+=Math.pow(2,a),p-=E}return(j?-1:1)*m*Math.pow(2,p-a)},F0.write=function(n,e,i,a,c,p){var m,v,T,E=8*p-c-1,R=(1<<E)-1,D=R>>1,P=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=a?0:p-1,G=a?1:-1,Z=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,m=R):(m=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-m))<1&&(m--,T*=2),(e+=m+D>=1?P/T:P*Math.pow(2,1-D))*T>=2&&(m++,T/=2),m+D>=R?(v=0,m=R):m+D>=1?(v=(e*T-1)*Math.pow(2,c),m+=D):(v=e*Math.pow(2,D-1)*Math.pow(2,c),m=0));c>=8;n[i+j]=255&v,j+=G,v/=256,c-=8);for(m=m<<c|v,E+=c;E>0;n[i+j]=255&m,j+=G,m/=256,E-=8);n[i+j-G]|=128*Z}),F0}function aw(){if(sw)return N0;sw=1,N0=e;var n=kM();function e(Y){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Y)?Y:new Uint8Array(Y||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,a=1/i,c=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function p(Y){return Y.type===e.Bytes?Y.readVarint()+Y.pos:Y.pos+1}function m(Y,le,de){return de?4294967296*le+(Y>>>0):4294967296*(le>>>0)+(Y>>>0)}function v(Y,le,de){var be=le<=16383?1:le<=2097151?2:le<=268435455?3:Math.floor(Math.log(le)/(7*Math.LN2));de.realloc(be);for(var Fe=de.pos-1;Fe>=Y;Fe--)de.buf[Fe+be]=de.buf[Fe]}function T(Y,le){for(var de=0;de<Y.length;de++)le.writeVarint(Y[de])}function E(Y,le){for(var de=0;de<Y.length;de++)le.writeSVarint(Y[de])}function R(Y,le){for(var de=0;de<Y.length;de++)le.writeFloat(Y[de])}function D(Y,le){for(var de=0;de<Y.length;de++)le.writeDouble(Y[de])}function P(Y,le){for(var de=0;de<Y.length;de++)le.writeBoolean(Y[de])}function j(Y,le){for(var de=0;de<Y.length;de++)le.writeFixed32(Y[de])}function G(Y,le){for(var de=0;de<Y.length;de++)le.writeSFixed32(Y[de])}function Z(Y,le){for(var de=0;de<Y.length;de++)le.writeFixed64(Y[de])}function K(Y,le){for(var de=0;de<Y.length;de++)le.writeSFixed64(Y[de])}function te(Y,le){return(Y[le]|Y[le+1]<<8|Y[le+2]<<16)+16777216*Y[le+3]}function ce(Y,le,de){Y[de]=le,Y[de+1]=le>>>8,Y[de+2]=le>>>16,Y[de+3]=le>>>24}function he(Y,le){return(Y[le]|Y[le+1]<<8|Y[le+2]<<16)+(Y[le+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(Y,le,de){for(de=de||this.length;this.pos<de;){var be=this.readVarint(),Fe=be>>3,ze=this.pos;this.type=7&be,Y(Fe,le,this),this.pos===ze&&this.skip(be)}return le},readMessage:function(Y,le){return this.readFields(Y,le,this.readVarint()+this.pos)},readFixed32:function(){var Y=te(this.buf,this.pos);return this.pos+=4,Y},readSFixed32:function(){var Y=he(this.buf,this.pos);return this.pos+=4,Y},readFixed64:function(){var Y=te(this.buf,this.pos)+te(this.buf,this.pos+4)*i;return this.pos+=8,Y},readSFixed64:function(){var Y=te(this.buf,this.pos)+he(this.buf,this.pos+4)*i;return this.pos+=8,Y},readFloat:function(){var Y=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Y},readDouble:function(){var Y=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Y},readVarint:function(Y){var le,de,be=this.buf;return le=127&(de=be[this.pos++]),de<128?le:(le|=(127&(de=be[this.pos++]))<<7,de<128?le:(le|=(127&(de=be[this.pos++]))<<14,de<128?le:(le|=(127&(de=be[this.pos++]))<<21,de<128?le:function(Fe,ze,Be){var We,dt,Bt=Be.buf;if(We=(112&(dt=Bt[Be.pos++]))>>4,dt<128||(We|=(127&(dt=Bt[Be.pos++]))<<3,dt<128)||(We|=(127&(dt=Bt[Be.pos++]))<<10,dt<128)||(We|=(127&(dt=Bt[Be.pos++]))<<17,dt<128)||(We|=(127&(dt=Bt[Be.pos++]))<<24,dt<128)||(We|=(1&(dt=Bt[Be.pos++]))<<31,dt<128))return m(Fe,We,ze);throw new Error("Expected varint not more than 10 bytes")}(le|=(15&(de=be[this.pos]))<<28,Y,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Y=this.readVarint();return Y%2==1?(Y+1)/-2:Y/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Y=this.readVarint()+this.pos,le=this.pos;return this.pos=Y,Y-le>=12&&c?function(de,be,Fe){return c.decode(de.subarray(be,Fe))}(this.buf,le,Y):function(de,be,Fe){for(var ze="",Be=be;Be<Fe;){var We,dt,Bt,St=de[Be],Nt=null,Gt=St>239?4:St>223?3:St>191?2:1;if(Be+Gt>Fe)break;Gt===1?St<128&&(Nt=St):Gt===2?(192&(We=de[Be+1]))==128&&(Nt=(31&St)<<6|63&We)<=127&&(Nt=null):Gt===3?(dt=de[Be+2],(192&(We=de[Be+1]))==128&&(192&dt)==128&&((Nt=(15&St)<<12|(63&We)<<6|63&dt)<=2047||Nt>=55296&&Nt<=57343)&&(Nt=null)):Gt===4&&(dt=de[Be+2],Bt=de[Be+3],(192&(We=de[Be+1]))==128&&(192&dt)==128&&(192&Bt)==128&&((Nt=(15&St)<<18|(63&We)<<12|(63&dt)<<6|63&Bt)<=65535||Nt>=1114112)&&(Nt=null)),Nt===null?(Nt=65533,Gt=1):Nt>65535&&(Nt-=65536,ze+=String.fromCharCode(Nt>>>10&1023|55296),Nt=56320|1023&Nt),ze+=String.fromCharCode(Nt),Be+=Gt}return ze}(this.buf,le,Y)},readBytes:function(){var Y=this.readVarint()+this.pos,le=this.buf.subarray(this.pos,Y);return this.pos=Y,le},readPackedVarint:function(Y,le){if(this.type!==e.Bytes)return Y.push(this.readVarint(le));var de=p(this);for(Y=Y||[];this.pos<de;)Y.push(this.readVarint(le));return Y},readPackedSVarint:function(Y){if(this.type!==e.Bytes)return Y.push(this.readSVarint());var le=p(this);for(Y=Y||[];this.pos<le;)Y.push(this.readSVarint());return Y},readPackedBoolean:function(Y){if(this.type!==e.Bytes)return Y.push(this.readBoolean());var le=p(this);for(Y=Y||[];this.pos<le;)Y.push(this.readBoolean());return Y},readPackedFloat:function(Y){if(this.type!==e.Bytes)return Y.push(this.readFloat());var le=p(this);for(Y=Y||[];this.pos<le;)Y.push(this.readFloat());return Y},readPackedDouble:function(Y){if(this.type!==e.Bytes)return Y.push(this.readDouble());var le=p(this);for(Y=Y||[];this.pos<le;)Y.push(this.readDouble());return Y},readPackedFixed32:function(Y){if(this.type!==e.Bytes)return Y.push(this.readFixed32());var le=p(this);for(Y=Y||[];this.pos<le;)Y.push(this.readFixed32());return Y},readPackedSFixed32:function(Y){if(this.type!==e.Bytes)return Y.push(this.readSFixed32());var le=p(this);for(Y=Y||[];this.pos<le;)Y.push(this.readSFixed32());return Y},readPackedFixed64:function(Y){if(this.type!==e.Bytes)return Y.push(this.readFixed64());var le=p(this);for(Y=Y||[];this.pos<le;)Y.push(this.readFixed64());return Y},readPackedSFixed64:function(Y){if(this.type!==e.Bytes)return Y.push(this.readSFixed64());var le=p(this);for(Y=Y||[];this.pos<le;)Y.push(this.readSFixed64());return Y},skip:function(Y){var le=7&Y;if(le===e.Varint)for(;this.buf[this.pos++]>127;);else if(le===e.Bytes)this.pos=this.readVarint()+this.pos;else if(le===e.Fixed32)this.pos+=4;else{if(le!==e.Fixed64)throw new Error("Unimplemented type: "+le);this.pos+=8}},writeTag:function(Y,le){this.writeVarint(Y<<3|le)},realloc:function(Y){for(var le=this.length||16;le<this.pos+Y;)le*=2;if(le!==this.length){var de=new Uint8Array(le);de.set(this.buf),this.buf=de,this.length=le}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Y){this.realloc(4),ce(this.buf,Y,this.pos),this.pos+=4},writeSFixed32:function(Y){this.realloc(4),ce(this.buf,Y,this.pos),this.pos+=4},writeFixed64:function(Y){this.realloc(8),ce(this.buf,-1&Y,this.pos),ce(this.buf,Math.floor(Y*a),this.pos+4),this.pos+=8},writeSFixed64:function(Y){this.realloc(8),ce(this.buf,-1&Y,this.pos),ce(this.buf,Math.floor(Y*a),this.pos+4),this.pos+=8},writeVarint:function(Y){(Y=+Y||0)>268435455||Y<0?function(le,de){var be,Fe;if(le>=0?(be=le%4294967296|0,Fe=le/4294967296|0):(Fe=~(-le/4294967296),4294967295^(be=~(-le%4294967296))?be=be+1|0:(be=0,Fe=Fe+1|0)),le>=18446744073709552e3||le<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");de.realloc(10),function(ze,Be,We){We.buf[We.pos++]=127&ze|128,ze>>>=7,We.buf[We.pos++]=127&ze|128,ze>>>=7,We.buf[We.pos++]=127&ze|128,ze>>>=7,We.buf[We.pos++]=127&ze|128,We.buf[We.pos]=127&(ze>>>=7)}(be,0,de),function(ze,Be){var We=(7&ze)<<4;Be.buf[Be.pos++]|=We|((ze>>>=3)?128:0),ze&&(Be.buf[Be.pos++]=127&ze|((ze>>>=7)?128:0),ze&&(Be.buf[Be.pos++]=127&ze|((ze>>>=7)?128:0),ze&&(Be.buf[Be.pos++]=127&ze|((ze>>>=7)?128:0),ze&&(Be.buf[Be.pos++]=127&ze|((ze>>>=7)?128:0),ze&&(Be.buf[Be.pos++]=127&ze)))))}(Fe,de)}(Y,this):(this.realloc(4),this.buf[this.pos++]=127&Y|(Y>127?128:0),Y<=127||(this.buf[this.pos++]=127&(Y>>>=7)|(Y>127?128:0),Y<=127||(this.buf[this.pos++]=127&(Y>>>=7)|(Y>127?128:0),Y<=127||(this.buf[this.pos++]=Y>>>7&127))))},writeSVarint:function(Y){this.writeVarint(Y<0?2*-Y-1:2*Y)},writeBoolean:function(Y){this.writeVarint(!!Y)},writeString:function(Y){Y=String(Y),this.realloc(4*Y.length),this.pos++;var le=this.pos;this.pos=function(be,Fe,ze){for(var Be,We,dt=0;dt<Fe.length;dt++){if((Be=Fe.charCodeAt(dt))>55295&&Be<57344){if(!We){Be>56319||dt+1===Fe.length?(be[ze++]=239,be[ze++]=191,be[ze++]=189):We=Be;continue}if(Be<56320){be[ze++]=239,be[ze++]=191,be[ze++]=189,We=Be;continue}Be=We-55296<<10|Be-56320|65536,We=null}else We&&(be[ze++]=239,be[ze++]=191,be[ze++]=189,We=null);Be<128?be[ze++]=Be:(Be<2048?be[ze++]=Be>>6|192:(Be<65536?be[ze++]=Be>>12|224:(be[ze++]=Be>>18|240,be[ze++]=Be>>12&63|128),be[ze++]=Be>>6&63|128),be[ze++]=63&Be|128)}return ze}(this.buf,Y,this.pos);var de=this.pos-le;de>=128&&v(le,de,this),this.pos=le-1,this.writeVarint(de),this.pos+=de},writeFloat:function(Y){this.realloc(4),n.write(this.buf,Y,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Y){this.realloc(8),n.write(this.buf,Y,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Y){var le=Y.length;this.writeVarint(le),this.realloc(le);for(var de=0;de<le;de++)this.buf[this.pos++]=Y[de]},writeRawMessage:function(Y,le){this.pos++;var de=this.pos;Y(le,this);var be=this.pos-de;be>=128&&v(de,be,this),this.pos=de-1,this.writeVarint(be),this.pos+=be},writeMessage:function(Y,le,de){this.writeTag(Y,e.Bytes),this.writeRawMessage(le,de)},writePackedVarint:function(Y,le){le.length&&this.writeMessage(Y,T,le)},writePackedSVarint:function(Y,le){le.length&&this.writeMessage(Y,E,le)},writePackedBoolean:function(Y,le){le.length&&this.writeMessage(Y,P,le)},writePackedFloat:function(Y,le){le.length&&this.writeMessage(Y,R,le)},writePackedDouble:function(Y,le){le.length&&this.writeMessage(Y,D,le)},writePackedFixed32:function(Y,le){le.length&&this.writeMessage(Y,j,le)},writePackedSFixed32:function(Y,le){le.length&&this.writeMessage(Y,G,le)},writePackedFixed64:function(Y,le){le.length&&this.writeMessage(Y,Z,le)},writePackedSFixed64:function(Y,le){le.length&&this.writeMessage(Y,K,le)},writeBytesField:function(Y,le){this.writeTag(Y,e.Bytes),this.writeBytes(le)},writeFixed32Field:function(Y,le){this.writeTag(Y,e.Fixed32),this.writeFixed32(le)},writeSFixed32Field:function(Y,le){this.writeTag(Y,e.Fixed32),this.writeSFixed32(le)},writeFixed64Field:function(Y,le){this.writeTag(Y,e.Fixed64),this.writeFixed64(le)},writeSFixed64Field:function(Y,le){this.writeTag(Y,e.Fixed64),this.writeSFixed64(le)},writeVarintField:function(Y,le){this.writeTag(Y,e.Varint),this.writeVarint(le)},writeSVarintField:function(Y,le){this.writeTag(Y,e.Varint),this.writeSVarint(le)},writeStringField:function(Y,le){this.writeTag(Y,e.Bytes),this.writeString(le)},writeFloatField:function(Y,le){this.writeTag(Y,e.Fixed32),this.writeFloat(le)},writeDoubleField:function(Y,le){this.writeTag(Y,e.Fixed64),this.writeDouble(le)},writeBooleanField:function(Y,le){this.writeVarintField(Y,!!le)}},N0}var Wy=ya(aw());const B0=3;function NM(n,e,i){e.glyphs=[],n===1&&i.readMessage(FM,e)}function FM(n,e,i){if(n===3){const{id:a,bitmap:c,width:p,height:m,left:v,top:T,advance:E}=i.readMessage(BM,{});e.glyphs.push({id:a,bitmap:new Cl({width:p+2*B0,height:m+2*B0},c),metrics:{width:p,height:m,left:v,top:T,advance:E}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function BM(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const jM=B0,Il={horizontal:1,vertical:2,horizontalOnly:3};class v_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const a=new v_;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new v_;return i.image=e,i}}class hg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,a){const c=new hg;for(let p=0;p<e.sections.length;p++){const m=e.sections[p];m.image?c.addImageSection(m,a):c.addTextSection(m,i)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,a){let c="";for(let p=0;p<i.length;p++){const m=i.charCodeAt(p+1)||null,v=i.charCodeAt(p-1)||null;c+=!a&&(m&&Mf(m)&&!y_[i[p+1]]||v&&Mf(v)&&!y_[i[p-1]])||!y_[i[p]]?i[p]:y_[i[p]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&Xy[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Xy[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new hg;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(v_.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e,i){const a=e.image?e.image.getPrimary():null;if(!a)return void Yi("Can't add FormattedSection with an empty image.");a.scaleSelf(i);const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(v_.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Yi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function j0(n,e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z=1){const K=hg.fromFeature(n,c,Z);D===Il.vertical&&K.verticalizePunctuation(P);let te=[];const ce=function(be,Fe,ze,Be,We,dt){if(!be)return[];const Bt=[],St=function(Ot,ut,ft,Zt,Yt,ki){let Ti=0;for(let ai=0;ai<Ot.length();ai++){const $t=Ot.getSection(ai);Ti+=ow(Ot.getCodePoint(ai),$t,Zt,Yt,ut,ki)}return Ti/Math.max(1,Math.ceil(Ti/ft))}(be,Fe,ze,Be,We,dt),Nt=be.text.indexOf("​")>=0;let Gt=0;for(let Ot=0;Ot<be.length();Ot++){const ut=be.getSection(Ot),ft=be.getCodePoint(Ot);if(Xy[ft]||(Gt+=ow(ft,ut,Be,We,Fe,dt)),Ot<be.length()-1){const Zt=!((pt=ft)<11904||!(Ii["Bopomofo Extended"](pt)||Ii.Bopomofo(pt)||Ii["CJK Compatibility Forms"](pt)||Ii["CJK Compatibility Ideographs"](pt)||Ii["CJK Compatibility"](pt)||Ii["CJK Radicals Supplement"](pt)||Ii["CJK Strokes"](pt)||Ii["CJK Symbols and Punctuation"](pt)||Ii["CJK Unified Ideographs Extension A"](pt)||Ii["CJK Unified Ideographs"](pt)||Ii["Enclosed CJK Letters and Months"](pt)||Ii["Halfwidth and Fullwidth Forms"](pt)||Ii.Hiragana(pt)||Ii["Ideographic Description Characters"](pt)||Ii["Kangxi Radicals"](pt)||Ii["Katakana Phonetic Extensions"](pt)||Ii.Katakana(pt)||Ii["Vertical Forms"](pt)||Ii["Yi Radicals"](pt)||Ii["Yi Syllables"](pt)));(VM[ft]||Zt||ut.image)&&Bt.push(cw(Ot+1,Gt,St,Bt,UM(ft,be.getCodePoint(Ot+1),Zt&&Nt),!1))}}var pt;return uw(cw(be.length(),Gt,St,Bt,0,!0))}(K,E,p,e,a,j),{processBidirectionalText:he,processStyledBidirectionalText:Y}=Wl;if(he&&K.sections.length===1){const be=he(K.toString(),ce);for(const Fe of be){const ze=new hg;ze.text=Fe,ze.sections=K.sections;for(let Be=0;Be<Fe.length;Be++)ze.sectionIndex.push(0);te.push(ze)}}else if(Y){const be=Y(K.text,K.sectionIndex,ce);for(const Fe of be){const ze=new hg;ze.text=Fe[0],ze.sectionIndex=Fe[1],ze.sections=K.sections,te.push(ze)}}else te=function(be,Fe){const ze=[],Be=be.text;let We=0;for(const dt of Fe)ze.push(be.substring(We,dt)),We=dt;return We<Be.length&&ze.push(be.substring(We,Be.length)),ze}(K,ce);const le=[],de={positionedLines:le,text:K.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(be,Fe,ze,Be,We,dt,Bt,St,Nt,Gt,pt,Ot){let ut=0,ft=0,Zt=0;const Yt=St==="right"?1:St==="left"?0:.5;let ki=!1;for(const Ei of We){const Hi=Ei.getSections();for(const sn of Hi){if(sn.image)continue;const nn=Fe[sn.fontStack];if(nn&&(ki=nn.ascender!==void 0&&nn.descender!==void 0,!ki))break}if(!ki)break}let Ti=0;for(const Ei of We){Ei.trim();const Hi=Ei.getMaxScale(),sn=(Hi-1)*pa,nn={positionedGlyphs:[],lineOffset:0};be.positionedLines[Ti]=nn;const fn=nn.positionedGlyphs;let an=0;if(!Ei.length()){ft+=dt,++Ti;continue}let pn=0,Jn=0;for(let ye=0;ye<Ei.length();ye++){const Ee=Ei.getSection(ye),yt=Ei.getSectionIndex(ye),Jt=Ei.getCodePoint(ye);let oi=Ee.scale,ri=null,bi=null,Gi=null,vn=pa,xn=0;Nt===Il.vertical&&((ai=Jt)===12312||ai===12313||ai===12316||ai===12540||ai===12448)&&(Nt=Il.horizontal);const on=!(Nt===Il.horizontal||!pt&&!Th(Jt)||pt&&(Xy[Jt]||Mc(Jt)));if(Ee.image){const tr=Be.get(Ee.image.toString());if(!tr)continue;Gi=Ee.image,be.iconsInText=be.iconsInText||!0,bi=tr.paddedRect;const yr=tr.displaySize;oi=oi*pa/Ot,ri={width:yr[0],height:yr[1],left:0,top:-3,advance:on?yr[1]:yr[0],localGlyph:!1},xn=ki?-ri.height*oi:Hi*pa-17-yr[1]*oi,vn=ri.advance;const bn=(on?yr[0]:yr[1])*oi-pa*Hi;bn>0&&bn>an&&(an=bn)}else{const tr=ze[Ee.fontStack];if(!tr)continue;tr[Jt]&&(bi=tr[Jt]);const yr=Fe[Ee.fontStack];if(!yr)continue;const bn=yr.glyphs[Jt];if(!bn)continue;if(ri=bn.metrics,vn=Jt!==8203?pa:0,ki){const qr=yr.ascender!==void 0?Math.abs(yr.ascender):0,Tr=yr.descender!==void 0?Math.abs(yr.descender):0,er=(qr+Tr)*oi;pn<er&&(pn=er,Jn=(qr-Tr)/2*oi),xn=-qr*oi}else xn=(Hi-oi)*pa-17}on?(be.verticalizable=!0,fn.push({glyph:Jt,image:Gi,x:ut,y:ft+xn,vertical:on,scale:oi,localGlyph:ri.localGlyph,fontStack:Ee.fontStack,sectionIndex:yt,metrics:ri,rect:bi}),ut+=vn*oi+Gt):(fn.push({glyph:Jt,image:Gi,x:ut,y:ft+xn,vertical:on,scale:oi,localGlyph:ri.localGlyph,fontStack:Ee.fontStack,sectionIndex:yt,metrics:ri,rect:bi}),ut+=ri.advance*oi+Gt)}fn.length!==0&&(Zt=Math.max(ut-Gt,Zt),ki?hw(fn,Yt,an,Jn,dt*Hi/2):hw(fn,Yt,an,0,dt/2)),ut=0;const wr=dt*Hi+an;nn.lineOffset=Math.max(an,sn),ft+=wr,++Ti}var ai;const $t=ft,{horizontalAlign:Xi,verticalAlign:wi}=V0(Bt);(function(Ei,Hi,sn,nn,fn,an){const pn=(Hi-sn)*fn,Jn=-an*nn;for(const wr of Ei)for(const ye of wr.positionedGlyphs)ye.x+=pn,ye.y+=Jn})(be.positionedLines,Yt,Xi,wi,Zt,$t),be.top+=-wi*$t,be.bottom=be.top+$t,be.left+=-Xi*Zt,be.right=be.left+Zt,be.hasBaseline=ki}(de,e,i,a,te,m,v,T,D,E,P,G),!function(be){for(const Fe of be)if(Fe.positionedGlyphs.length!==0)return!1;return!0}(le))return de}const Xy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},VM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ow(n,e,i,a,c,p){if(e.image){const m=a.get(e.image.toString());return m?m.displaySize[0]*e.scale*pa/p+c:0}{const m=i[e.fontStack],v=m&&m.glyphs[n];return v?v.metrics.advance*e.scale+c:0}}function lw(n,e,i,a){const c=Math.pow(n-e,2);return a?n<e?c/2:2*c:c+Math.abs(i)*i}function UM(n,e,i){let a=0;return n===10&&(a-=1e4),i&&(a+=150),n!==40&&n!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function cw(n,e,i,a,c,p){let m=null,v=lw(e,i,c,p);for(const T of a){const E=lw(e-T.x,i,c,p)+T.badness;E<=v&&(m=T,v=E)}return{index:n,x:e,priorBreak:m,badness:v}}function uw(n){return n?uw(n.priorBreak).concat(n.index):[]}function V0(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function hw(n,e,i,a,c){if(!(e||i||a||c))return;const p=n.length-1,m=n[p],v=(m.x+m.metrics.advance*m.scale)*e;for(let T=0;T<=p;T++)n[T].x-=v,n[T].y+=i+a+c}function dw(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function GM(n,e,i,a){const{horizontalAlign:c,verticalAlign:p}=V0(a),m=i[0]-n.displaySize[0]*c,v=i[1]-n.displaySize[1]*p;return{imagePrimary:n,imageSecondary:e,top:v,bottom:v+n.displaySize[1],left:m,right:m+n.displaySize[0]}}function fw(n,e,i,a,c,p){const m=n.imagePrimary;let v;if(m.content){const K=m.content,te=m.pixelRatio||1;v=[K[0]/te,K[1]/te,m.displaySize[0]-K[2]/te,m.displaySize[1]-K[3]/te]}const T=e.left*p,E=e.right*p;let R,D,P,j;i==="width"||i==="both"?(j=c[0]+T-a[3],D=c[0]+E+a[1]):(j=c[0]+(T+E-m.displaySize[0])/2,D=j+m.displaySize[0]);const G=e.top*p,Z=e.bottom*p;return i==="height"||i==="both"?(R=c[1]+G-a[0],P=c[1]+Z+a[2]):(R=c[1]+(G+Z-m.displaySize[1])/2,P=R+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:R,right:D,bottom:P,left:j,collisionPadding:v}}function pw(n){return!n.imagePrimary.stretchX}function mw(n){return!n.imagePrimary.stretchY}function gw(n){return{width:n.right-n.left,height:n.bottom-n.top}}const Zh=128;function _w(n,e,i){const{expression:a}=e;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new Kn(n+1,{worldview:i}))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=a;let m=0;for(;m<c.length&&c[m]<=n;)m++;m=Math.max(0,m-1);let v=m;for(;v<c.length&&c[v]<n+1;)v++;v=Math.min(c.length-1,v);const T=c[m],E=c[v];return a.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:T,maxZoom:E,minSize:a.evaluate(new Kn(T,{worldview:i})),maxSize:a.evaluate(new Kn(E,{worldview:i})),interpolationType:p}}}function U0(n,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:c}){return n.kind==="source"?a/Zh:n.kind==="composite"?zi(a/Zh,c/Zh,i):e}function x_(n,e,i=1){let a=0,c=0;if(n.kind==="constant")c=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:p,minZoom:m,maxZoom:v}=n,T=p?Me(Gr.interpolationFactor(p,e,m,v),0,1):0;n.kind==="camera"?c=zi(n.minSize,n.maxSize,T)*i:a=T*i}return{uSizeT:a,uSize:c}}class tf extends Qt{constructor(e,i,a,c,p){super(e,i),this.angle=c,this.z=a,p!==void 0&&(this.segment=p)}clone(){return new tf(this.x,this.y,this.z,this.angle,this.segment)}}function yw(n,e,i,a,c){if(e.segment===void 0)return!0;let p=e,m=e.segment+1,v=0;for(;v>-i/2;){if(m--,m<0)return!1;v-=n[m].dist(p),p=n[m]}v+=n[m].dist(n[m+1]),m++;const T=[];let E=0;for(;v<i/2;){const R=n[m],D=n[m+1];if(!D)return!1;let P=n[m-1].angleTo(R)-R.angleTo(D);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:v,angleDelta:P}),E+=P;v-T[0].distance>a;)E-=T.shift().angleDelta;if(E>c)return!1;m++,v+=R.dist(D)}return!0}function vw(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function xw(n,e,i){return n?.6*e*i:0}function bw(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function HM(n,e,i,a,c,p){const m=xw(i,c,p),v=bw(i,a)*p;let T=0;const E=vw(n)/2;for(let R=0;R<n.length-1;R++){const D=n[R],P=n[R+1],j=D.dist(P);if(T+j>E){const G=(E-T)/j,Z=zi(D.x,P.x,G),K=zi(D.y,P.y,G),te=new tf(Z,K,0,P.angleTo(D),R);return!m||yw(n,te,v,m,e)?te:void 0}T+=j}}function qM(n,e,i,a,c,p,m,v,T){const E=xw(a,p,m),R=bw(a,c),D=R*m,P=n[0].x===0||n[0].x===T||n[0].y===0||n[0].y===T;return e-D<e/4&&(e=D+e/4),ww(n,P?e/2*v%e:(R/2+2*p)*m*v%e,e,E,i,D,P,!1,T)}function ww(n,e,i,a,c,p,m,v,T){const E=p/2,R=vw(n);let D=0,P=e-i,j=[];for(let G=0;G<n.length-1;G++){const Z=n[G],K=n[G+1],te=Z.dist(K),ce=K.angleTo(Z);for(;P+i<D+te;){P+=i;const he=(P-D)/te,Y=zi(Z.x,K.x,he),le=zi(Z.y,K.y,he);if(Y>=0&&Y<T&&le>=0&&le<T&&P-E>=0&&P+E<=R){const de=new tf(Y,le,0,ce,G);a&&!yw(n,de,p,a,c)||j.push(de)}}D+=te}return v||j.length||m||(j=ww(n,D/2,i,a,c,p,m,!0,T)),j}function Tw(n){let e=0,i=0;for(const m of n)e+=m.w*m.h,i=Math.max(i,m.w);n.sort((m,v)=>v.h-m.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,p=0;for(const m of n)for(let v=a.length-1;v>=0;v--){const T=a[v];if(!(m.w>T.w||m.h>T.h)){if(m.x=T.x,m.y=T.y,p=Math.max(p,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===T.w&&m.h===T.h){const E=a.pop();v<a.length&&(a[v]=E)}else m.h===T.h?(T.x+=m.w,T.w-=m.w):m.w===T.w?(T.y+=m.h,T.h-=m.h):(a.push({x:T.x+m.w,y:T.y,w:T.w-m.w,h:m.h}),T.y+=m.h,T.h-=m.h);break}}return{w:c,h:p,fill:e/(c*p)||0}}mi(tf,"Anchor");const pm=1;class b_{static getImagePositionScale(e,i,a){if(i&&e&&e.options&&e.options.transform){const c=e.options.transform;return{x:c.a,y:c.d}}return{x:a,y:a}}constructor(e,i,a,c){this.paddedRect=e;const{pixelRatio:p,version:m,stretchX:v,stretchY:T,content:E,sdf:R,usvg:D}=i;this.pixelRatio=p,this.stretchX=v,this.stretchY=T,this.content=E,this.version=m,this.padding=a,this.sdf=R,this.usvg=D,this.scale=b_.getImagePositionScale(c,D,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function G0(n,e,i){const a=Ll.parse(n),c=function(p,m,v=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*v[0])+2*m,h:(p.data?p.data.height:p.height*v[1])+2*m}}(e,i,[a.options.transform.a,a.options.transform.d]);return{bin:c,imagePosition:new b_(c,e,i,a),imageVariant:a}}class Sw{constructor(e,i,a){const c=new Map,p=new Map;this.haveRenderCallbacks=[];const m=[];this.addImages(e,c,pm,m),this.addImages(i,p,2,m);const{w:v,h:T}=Tw(m),E=new ra({width:v||1,height:T||1});for(const[R,D]of e.entries()){const P=c.get(R).paddedRect;ra.copy(D.data,E,{x:0,y:0},{x:P.x+pm,y:P.y+pm},D.data,a,D.sdf)}for(const[R,D]of i.entries()){const P=p.get(R),j=P.paddedRect;let G=P.padding;const Z=j.x+G,K=j.y+G,te=D.data.width,ce=D.data.height;G=G>1?G-1:G,ra.copy(D.data,E,{x:0,y:0},{x:Z,y:K},D.data,a),ra.copy(D.data,E,{x:0,y:ce-G},{x:Z,y:K-G},{width:te,height:G},a),ra.copy(D.data,E,{x:0,y:0},{x:Z,y:K+ce},{width:te,height:G},a),ra.copy(D.data,E,{x:te-G,y:0},{x:Z-G,y:K},{width:G,height:ce},a),ra.copy(D.data,E,{x:0,y:0},{x:Z+te,y:K},{width:G,height:ce},a),ra.copy(D.data,E,{x:te-G,y:ce-G},{x:Z-G,y:K-G},{width:G,height:G},a),ra.copy(D.data,E,{x:0,y:ce-G},{x:Z+te,y:K-G},{width:G,height:G},a),ra.copy(D.data,E,{x:0,y:0},{x:Z+te,y:K+ce},{width:G,height:G},a),ra.copy(D.data,E,{x:te-G,y:0},{x:Z-G,y:K+ce},{width:G,height:G},a)}this.lut=a,this.image=E,this.iconPositions=c,this.patternPositions=p}addImages(e,i,a,c){for(const[p,m]of e.entries()){const{bin:v,imagePosition:T,imageVariant:E}=G0(p,m,a);i.set(p,T),c.push(v),m.hasRenderCallback&&this.haveRenderCallbacks.push(E.id)}}patchUpdatedImages(e,i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const c of e.getUpdatedImages(a)){for(const p of this.iconPositions.keys()){const m=Ll.parse(p);if(Br.isEqual(m.id,c)){const v=e.getImage(c,a);this.patchUpdatedImage(this.iconPositions.get(p),v,i)}}for(const p of this.patternPositions.keys()){const m=Ll.parse(p);if(Br.isEqual(m.id,c)){const v=e.getImage(c,a);this.patchUpdatedImage(this.patternPositions.get(p),v,i)}}}}patchUpdatedImage(e,i,a){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,p]=e.tl,m=e.sdf;if(this.lut||m){const v={width:i.data.width,height:i.data.height},T=new ra(v);ra.copy(i.data,T,{x:0,y:0},{x:0,y:0},v,this.lut,m),a.update(T,{position:{x:c,y:p}})}else a.update(i.data,{position:{x:c,y:p}})}}mi(b_,"ImagePosition"),mi(Sw,"ImageAtlas");const Yy=1e20;function Ew(n,e,i,a,c,p,m,v,T){for(let E=e;E<e+a;E++)Aw(n,i*p+E,p,c,m,v,T);for(let E=i;E<i+c;E++)Aw(n,E*p+e,1,a,m,v,T)}function Aw(n,e,i,a,c,p,m){p[0]=0,m[0]=-1e20,m[1]=Yy,c[0]=n[e];for(let v=1,T=0,E=0;v<a;v++){c[v]=n[e+v*i];const R=v*v;do{const D=p[T];E=(c[v]-c[D]+R-D*D)/(v-D)/2}while(E<=m[T]&&--T>-1);T++,p[T]=v,m[T]=E,m[T+1]=Yy}for(let v=0,T=0;v<a;v++){for(;m[T+1]<v;)T++;const E=p[T],R=v-E;n[e+v*i]=c[E]+R*R}}const Yu=2,H0={none:0,ideographs:1,all:2};class dg{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,a){const c=[],p=this.urls[i]||hs.GLYPHS_URL;for(const m in e)for(const v of e[m])c.push({stack:m,id:v});Ue(c,({stack:m,id:v},T)=>{let E=this.entries[m];E||(E=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let R=E.glyphs[v];if(R!==void 0)return void T(null,{stack:m,id:v,glyph:R});if(R=this._tinySDF(E,m,v),R)return E.glyphs[v]=R,void T(null,{stack:m,id:v,glyph:R});const D=Math.floor(v/256);if(256*D>65535)return Yi("glyphs > 65535 not supported"),void T(null,{stack:m,id:v,glyph:R});if(E.ranges[D])return void T(null,{stack:m,id:v,glyph:R});let P=E.requests[D];P||(P=E.requests[D]=[],dg.loadGlyphRange(m,D,p,this.requestManager,(j,G)=>{if(G){E.ascender=G.ascender,E.descender=G.descender;for(const Z in G.glyphs)this._doesCharSupportLocalGlyph(+Z)||(E.glyphs[+Z]=G.glyphs[+Z]);E.ranges[D]=!0}for(const Z of P)Z(j,G);delete E.requests[D]})),P.push((j,G)=>{j?T(j):G&&T(null,{stack:m,id:v,glyph:G.glyphs[v]||null})})},(m,v)=>{if(m)a(m);else if(v){const T={};for(const{stack:E,id:R,glyph:D}of v)T[E]===void 0&&(T[E]={}),T[E].glyphs===void 0&&(T[E].glyphs={}),T[E].glyphs[R]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},T[E].ascender=this.entries[E].ascender,T[E].descender=this.entries[E].descender;a(null,T)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==H0.none&&(this.localGlyphMode===H0.all?!!this.localFontFamily:!!this.localFontFamily&&(Ii["CJK Unified Ideographs"](e)||Ii["Hangul Syllables"](e)||Ii.Hiragana(e)||Ii.Katakana(e)||Ii["CJK Symbols and Punctuation"](e)||Ii["CJK Unified Ideographs Extension A"](e)||Ii["CJK Unified Ideographs Extension B"](e)||Ii.Osage(e)))}_tinySDF(e,i,a){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let p=e.tinySDF;if(!p){let Z="400";/bold/i.test(i)?Z="900":/medium/i.test(i)?Z="500":/light/i.test(i)&&(Z="200"),p=e.tinySDF=new dg.TinySDF({fontFamily:c,fontWeight:Z,fontSize:24*Yu,buffer:3*Yu,radius:8*Yu}),p.fontWeight=Z}if(this.localGlyphs[p.fontWeight][a])return this.localGlyphs[p.fontWeight][a];const m=String.fromCodePoint(a),{data:v,width:T,height:E,glyphWidth:R,glyphHeight:D,glyphLeft:P,glyphTop:j,glyphAdvance:G}=p.draw(m);return this.localGlyphs[p.fontWeight][a]={id:a,bitmap:new Cl({width:T,height:E},v),metrics:{width:R/Yu,height:D/Yu,left:P/Yu,top:j/Yu-27,advance:G/Yu,localGlyph:!0}}}}dg.loadGlyphRange=function(n,e,i,a,c){const p=256*e,m=p+255,v=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${p}-${m}`),Er.Glyphs);ds(v,(T,E)=>{if(T)c(T);else if(E){const R={},D=function(P){return new Wy(P).readFields(NM,{})}(E);for(const P of D.glyphs)R[P.id]=P;c(null,{glyphs:R,ascender:D.ascender,descender:D.descender})}})},dg.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=i;const v=this.size=n+4*e,T=this._createCanvas(v),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${m} ${p} ${n}px ${c}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(n),m=Math.ceil(i),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),T=Math.min(this.size-this.buffer,m+Math.ceil(a)),E=v+2*this.buffer,R=T+2*this.buffer,D=Math.max(E*R,0),P=new Uint8ClampedArray(D),j={data:P,width:E,height:R,glyphWidth:v,glyphHeight:T,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(v===0||T===0)return j;const{ctx:G,buffer:Z,gridInner:K,gridOuter:te}=this;G.clearRect(Z,Z,v,T),G.fillText(n,Z,Z+m);const ce=G.getImageData(Z,Z,v,T);te.fill(Yy,0,D),K.fill(0,0,D);for(let he=0;he<T;he++)for(let Y=0;Y<v;Y++){const le=ce.data[4*(he*v+Y)+3]/255;if(le===0)continue;const de=(he+Z)*E+Y+Z;if(le===1)te[de]=0,K[de]=Yy;else{const be=.5-le;te[de]=be>0?be*be:0,K[de]=be<0?be*be:0}}Ew(te,0,0,E,R,E,this.f,this.v,this.z),Ew(K,Z,Z,v,T,E,this.f,this.v,this.z);for(let he=0;he<D;he++){const Y=Math.sqrt(te[he])-Math.sqrt(K[he]);P[he]=Math.round(255-255*(Y/this.radius+this.cutoff))}return j}};const mm=pm;function Cw(n,e){return n+e[1]-e[0]}function Mw(n,e,i,a,c=1){const p=[],m=n.imagePrimary,v=m.pixelRatio,T=m.paddedRect.w-2*mm,E=m.paddedRect.h-2*mm,R=(n.right-n.left)*c,D=(n.bottom-n.top)*c,P=m.stretchX||[[0,T]],j=m.stretchY||[[0,E]],G=P.reduce(Cw,0),Z=j.reduce(Cw,0),K=T-G,te=E-Z;let ce=0,he=G,Y=0,le=Z,de=0,be=K,Fe=0,ze=te;if(m.content&&a){const We=m.content;ce=Ky(P,0,We[0]),Y=Ky(j,0,We[1]),he=Ky(P,We[0],We[2]),le=Ky(j,We[1],We[3]),de=We[0]-ce,Fe=We[1]-Y,be=We[2]-We[0]-he,ze=We[3]-We[1]-le}const Be=(We,dt,Bt,St)=>{const Nt=Qy(We.stretch-ce,he,R,n.left*c),Gt=Jy(We.fixed-de,be,We.stretch,G),pt=Qy(dt.stretch-Y,le,D,n.top*c),Ot=Jy(dt.fixed-Fe,ze,dt.stretch,Z),ut=Qy(Bt.stretch-ce,he,R,n.left*c),ft=Jy(Bt.fixed-de,be,Bt.stretch,G),Zt=Qy(St.stretch-Y,le,D,n.top*c),Yt=Jy(St.fixed-Fe,ze,St.stretch,Z),ki=new Qt(Nt,pt),Ti=new Qt(ut,pt),ai=new Qt(ut,Zt),$t=new Qt(Nt,Zt),Xi=new Qt(Gt/v,Ot/v),wi=new Qt(ft/v,Yt/v),Ei=e*Math.PI/180;if(Ei){const pn=Math.sin(Ei),Jn=Math.cos(Ei),wr=[Jn,-pn,pn,Jn];ki._matMult(wr),Ti._matMult(wr),$t._matMult(wr),ai._matMult(wr)}const Hi=We.stretch+We.fixed,sn=Bt.stretch+Bt.fixed,nn=dt.stretch+dt.fixed,fn=St.stretch+St.fixed,an=n.imageSecondary;return{tl:ki,tr:Ti,bl:$t,br:ai,texPrimary:{x:m.paddedRect.x+mm+Hi,y:m.paddedRect.y+mm+nn,w:sn-Hi,h:fn-nn},texSecondary:an?{x:an.paddedRect.x+mm+Hi,y:an.paddedRect.y+mm+nn,w:sn-Hi,h:fn-nn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xi,pixelOffsetBR:wi,minFontScaleX:be/v/R,minFontScaleY:ze/v/D,isSDF:i}};if(a&&(m.stretchX||m.stretchY)){const We=Iw(P,K,G),dt=Iw(j,te,Z);for(let Bt=0;Bt<We.length-1;Bt++){const St=We[Bt],Nt=We[Bt+1];for(let Gt=0;Gt<dt.length-1;Gt++)p.push(Be(St,dt[Gt],Nt,dt[Gt+1]))}}else p.push(Be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:E+1}));return p}function Ky(n,e,i){let a=0;for(const c of n)a+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return a}function Iw(n,e,i){const a=[{fixed:-1,stretch:0}];for(const[c,p]of n){const m=a[a.length-1];a.push({fixed:c-m.stretch,stretch:m.stretch}),a.push({fixed:c-m.stretch,stretch:m.stretch+(p-c)})}return a.push({fixed:e+mm,stretch:i}),a}function Qy(n,e,i,a){return n/e*i+a}function Jy(n,e,i,a){return n-e*i/a}function $M(n,e,i,a){const c=e+n.positionedLines[a].lineOffset;return a===0?i+c/2:i+(c+(e+n.positionedLines[a-1].lineOffset))/2}function ZM(n,e=1,i=!1){let a=1/0,c=1/0,p=-1/0,m=-1/0;const v=n[0];for(let j=0;j<v.length;j++){const G=v[j];(!j||G.x<a)&&(a=G.x),(!j||G.y<c)&&(c=G.y),(!j||G.x>p)&&(p=G.x),(!j||G.y>m)&&(m=G.y)}const T=Math.min(p-a,m-c);let E=T/2;const R=new dd([],WM);if(T===0)return new Qt(a,c);for(let j=a;j<p;j+=T)for(let G=c;G<m;G+=T)R.push(new fg(j+E,G+E,E,n));let D=function(j){let G=0,Z=0,K=0;const te=j[0];for(let ce=0,he=te.length,Y=he-1;ce<he;Y=ce++){const le=te[ce],de=te[Y],be=le.x*de.y-de.x*le.y;Z+=(le.x+de.x)*be,K+=(le.y+de.y)*be,G+=3*be}return new fg(Z/G,K/G,0,j)}(n),P=R.length;for(;R.length;){const j=R.pop();(j.d>D.d||!D.d)&&(D=j,i&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,P)),j.max-D.d<=e||(E=j.h/2,R.push(new fg(j.p.x-E,j.p.y-E,E,n)),R.push(new fg(j.p.x+E,j.p.y-E,E,n)),R.push(new fg(j.p.x-E,j.p.y+E,E,n)),R.push(new fg(j.p.x+E,j.p.y+E,E,n)),P+=4)}return i&&(console.log(`num probes: ${P}`),console.log(`best distance: ${D.d}`)),D.p}function WM(n,e){return e.max-n.max}class fg{constructor(e,i,a,c){this.p=new Qt(e,i),this.h=a,this.d=function(p,m){let v=!1,T=1/0;for(let E=0;E<m.length;E++){const R=m[E];for(let D=0,P=R.length,j=P-1;D<P;j=D++){const G=R[D],Z=R[j];G.y>p.y!=Z.y>p.y&&p.x<(Z.x-G.x)*(p.y-G.y)/(Z.y-G.y)+G.x&&(v=!v),T=Math.min(T,Bh(p,G,Z))}}return(v?1:-1)*Math.sqrt(T)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const XM=Object.keys,q0=Number.POSITIVE_INFINITY,YM=Math.sqrt(2);function Rw(n,[e,i]){let a=0,c=0;if(i===q0){e<0&&(e=0);const p=e/YM;switch(n){case"top-right":case"top-left":c=p-7;break;case"bottom-right":case"bottom-left":c=7-p;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(n){case"top-right":case"bottom-right":a=-p;break;case"top-left":case"bottom-left":a=p;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":c=i-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-i}switch(n){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function ev(n,e,i,a,c,p,m,v,T){if(!e||!e.usvg)return;const E=gw(a),R=gw(c),D=p!=="both"&&p!=="width"||!pw(a)?1:R.width/E.width,P=p!=="both"&&p!=="height"||!mw(a)?1:R.height/E.height;i.scaleSelf(D,P);const j=i.toString();m.set(j,i),v.set(j,e);const{imagePosition:G}=G0(j,e,pm);T.set(j,G)}function Dw(n,e,i,a,c,p,m,v,T){if(!n)return;const E=function(R,D,P,j,G,Z){if(R.kind==="camera")return R.maxSize;if(R.kind==="composite"){const K=D.possiblyEvaluate(new Kn(R.maxZoom,{worldview:Z}),P).evaluate(G,{},P),te=D.possiblyEvaluate(new Kn(R.minZoom,{worldview:Z}),P).evaluate(G,{},P);return Math.max(K,te)}return D.possiblyEvaluate(new Kn(j,{worldview:Z})).evaluate(G,{},P)}(e,i,a,c,p,T);return n.scaleSelf(E*v*m)}function Pw(n,e,i,a,c,p,m,v,T){return{iconPrimary:Dw(n.getPrimary(),e,i,a,c,p,m,v,T),iconSecondary:Dw(n.getSecondary(),e,i,a,c,p,m,v,T)}}function KM(n,e,i){if(!e)return;const a=i.get(n.toString()),c=i.get(e.toString());c&&(a.paddedRect.w===c.paddedRect.w&&a.paddedRect.h===c.paddedRect.h||Yi(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),a.usvg!==c.usvg&&Yi(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function Ow(n,e,i,a){if(!n)return;const c=e.get(i.toString());if(n.imagePrimary=c,a){const p=e.get(a.toString());n.imageSecondary=p}}function QM(n,e){for(const i in n.horizontal)Lw(n.horizontal[i],e);Lw(n.vertical,e)}function Lw(n,e){if(n){for(const i of n.positionedLines)for(const a of i.positionedGlyphs)if(a.image!==null){const c=a.image.toString();a.rect=e.get(c).paddedRect}}}function $0(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function JM(n,e,i,a,c,p,m,v,T){const E=Z0(p.horizontal)||p.vertical,R=i.get("icon-text-fit-padding").evaluate(a,{},c);let D,P=e;return e&&T!=="none"&&(n.allowVerticalPlacement&&p.vertical&&(D=fw(e,p.vertical,T,R,v,m)),E&&(P=fw(e,E,T,R,v,m))),{defaultShapedIcon:P,verticallyShapedIcon:D}}function eI(n,e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z,K,te,ce,he){let Y=m.textMaxSize.evaluate(e,{},P);Y===void 0?Y=v*m.textScaleFactor:Y*=m.textScaleFactor;const le=n.layers[0].layout,de=Z0(i.horizontal)||i.vertical,be=j.name==="globe",Fe=pa,ze=n.tilePixelRatio*Y/Fe,Be=(Gt=n.overscaling,n.zoom>18&&Gt>2&&(Gt>>=1),Math.max(Kt/(512*Gt),1)*le.get("symbol-spacing")),We=le.get("text-padding")*n.tilePixelRatio,dt=le.get("icon-padding")*n.tilePixelRatio,Bt=wn(le.get("text-max-angle")),St=le.get("icon-rotation-alignment")==="map"&&he!=="point",Nt=Be/2;var Gt;n.hasAnyIconTextFit===!1&&K!=="none"&&(n.hasAnyIconTextFit=!0);const pt=e.properties?+e.properties[Ui]:null,Ot=pt&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(pt):65535,ut=(ft,Zt,Yt)=>{if(Zt.x<0||Zt.x>=Kt||Zt.y<0||Zt.y>=Kt)return;let ki=null;if(be){const{x:Ti,y:ai,z:$t}=j.projectTilePoint(Zt.x,Zt.y,Yt);ki={anchor:new tf(Ti,ai,$t,0,void 0),up:j.upVector(Yt,Zt.x,Zt.y)}}(function(Ti,ai,$t,Xi,wi,Ei,Hi,sn,nn,fn,an,pn,Jn,wr,ye,Ee,yt,Jt,oi,ri,bi,Gi,vn,xn,on,tr,yr,bn,qr){const Tr=Ti.addToLineVertexArray(ai,Xi);let er,ns,Mr,vr,Sr,rr,un,lr=0,$r=0,ji=0,kn=0,Ir=-1,Kr=-1;const Pr={};let zs=vi("");const hr=$t?$t.anchor:ai,Ps=bn!=="none";let al=0,Xa=0;if(nn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const ks=nn.layout.get("text-offset").evaluate(bi,{},on);al=ks[0]*pa,Xa=ks[1]*pa}else al=nn.layout.get("text-radial-offset").evaluate(bi,{},on)*pa,Xa=q0;if(Ti.allowVerticalPlacement&&wi.vertical){const ks=wi.vertical;if(ye)rr=W0(ks),sn&&(un=W0(sn));else{const Zs=nn.layout.get("text-rotate").evaluate(bi,{},on)+90;Mr=tv(fn,hr,ai,an,pn,Jn,ks,wr,Zs,Ee),sn&&(vr=tv(fn,hr,ai,an,pn,Jn,sn,Jt,Zs))}}if(Ei){const ks=Ti.iconSizeData,Zs=nn.layout.get("icon-rotate").evaluate(bi,{},on),Ya=Mw(Ei,Zs,vn,Ps,Gi.iconScaleFactor),Eo=sn?Mw(sn,Zs,vn,Ps,Gi.iconScaleFactor):void 0;ns=tv(fn,hr,ai,an,pn,Jn,Ei,Jt,Zs,null),lr=4*Ya.length;let ho=null;ks.kind==="source"?(ho=[Zh*nn.layout.get("icon-size").evaluate(bi,{},on)*Gi.iconScaleFactor],ho[0]>ap&&Yi(`${Ti.layerIds[0]}: Value for "icon-size" is >= ${w_}. Reduce your "icon-size".`)):ks.kind==="composite"&&(ho=[Zh*Gi.compositeIconSizes[0].evaluate(bi,{},on)*Gi.iconScaleFactor,Zh*Gi.compositeIconSizes[1].evaluate(bi,{},on)*Gi.iconScaleFactor],(ho[0]>ap||ho[1]>ap)&&Yi(`${Ti.layerIds[0]}: Value for "icon-size" is >= ${w_}. Reduce your "icon-size".`)),Ti.addSymbols(Ti.icon,Ya,ho,ri,oi,bi,void 0,$t,ai,Tr.lineStartIndex,Tr.lineLength,-1,xn,on,tr,yr),Ir=Ti.icon.placedSymbolArray.length-1,Eo&&($r=4*Eo.length,Ti.addSymbols(Ti.icon,Eo,ho,ri,oi,bi,Il.vertical,$t,ai,Tr.lineStartIndex,Tr.lineLength,-1,xn,on,tr,yr),Kr=Ti.icon.placedSymbolArray.length-1)}for(const ks in wi.horizontal){const Zs=ks,Ya=wi.horizontal[Zs];er||(zs=vi(Ya.text),ye?Sr=W0(Ya):er=tv(fn,hr,ai,an,pn,Jn,Ya,wr,nn.layout.get("text-rotate").evaluate(bi,{},on),Ee));const Eo=Ya.positionedLines.length===1;if(ji+=zw(Ti,$t,ai,Ya,Hi,nn,ye,bi,Ee,Tr,wi.vertical?Il.horizontal:Il.horizontalOnly,Eo?XM(wi.horizontal):[Zs],Pr,Ir,Gi,xn,on,tr),Eo)break}wi.vertical&&(kn+=zw(Ti,$t,ai,wi.vertical,Hi,nn,ye,bi,Ee,Tr,Il.vertical,["vertical"],Pr,Kr,Gi,xn,on,tr));let La=-1;const ol=(ks,Zs)=>ks?Math.max(ks,Zs):Zs;La=ol(Sr,La),La=ol(rr,La),La=ol(un,La);const Wh=La>-1?1:0;Ti.glyphOffsetArray.length>=65535&&Yi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bi.sortKey!==void 0&&Ti.addToSortKeyRanges(Ti.symbolInstances.length,bi.sortKey),Ti.symbolInstances.emplaceBack(ai.x,ai.y,hr.x,hr.y,hr.z,Pr.right>=0?Pr.right:-1,Pr.center>=0?Pr.center:-1,Pr.left>=0?Pr.left:-1,Pr.vertical>=0?Pr.vertical:-1,Ir,Kr,zs,er!==void 0?er:Ti.collisionBoxArray.length,er!==void 0?er+1:Ti.collisionBoxArray.length,Mr!==void 0?Mr:Ti.collisionBoxArray.length,Mr!==void 0?Mr+1:Ti.collisionBoxArray.length,ns!==void 0?ns:Ti.collisionBoxArray.length,ns!==void 0?ns+1:Ti.collisionBoxArray.length,vr||Ti.collisionBoxArray.length,vr?vr+1:Ti.collisionBoxArray.length,an,ji,kn,lr,$r,Wh,0,al,Xa,La,0,Ps?1:0,qr)})(n,Zt,ki,ft,i,a,p,c,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,We,ce,E,0,dt,St,te,e,m,R,D,P,G,Z,K,Ot)};if(he==="line")for(const ft of d(e.geometry,0,0,Kt,Kt)){const Zt=qM(ft,Be,Bt,i.vertical||de,a,Fe,ze,n.overscaling,Kt);for(const Yt of Zt)de&&tI(n,de.text,Nt,Yt)||ut(ft,Yt,P)}else if(he==="line-center"){for(const ft of e.geometry)if(ft.length>1){const Zt=HM(ft,Bt,i.vertical||de,a,Fe,ze);Zt&&ut(ft,Zt,P)}}else if(e.type==="Polygon")for(const ft of im(e.geometry,0)){const Zt=ZM(ft,16);ut(ft[0],new tf(Zt.x,Zt.y,0,0,void 0),P)}else if(e.type==="LineString")for(const ft of e.geometry)ut(ft,new tf(ft[0].x,ft[0].y,0,0,void 0),P);else if(e.type==="Point")for(const ft of e.geometry)for(const Zt of ft)ut([Zt],new tf(Zt.x,Zt.y,0,0,void 0),P)}const w_=255,ap=w_*Zh;function zw(n,e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z,K,te){const ce=function(le,de,be,Fe,ze,Be,We,dt){const Bt=[];if(de.positionedLines.length===0)return Bt;const St=Fe.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,Nt=function(ft){const Zt=ft[0],Yt=ft[1],ki=Zt*Yt;return ki>0?[Zt,-Yt]:ki<0?[-Zt,Yt]:Zt===0?[Yt,Zt]:[Yt,-Zt]}(be);let Gt=Math.abs(de.top-de.bottom);for(const ft of de.positionedLines)Gt-=ft.lineOffset;const pt=de.positionedLines.length,Ot=Gt/pt;let ut=de.top-be[1];for(let ft=0;ft<pt;++ft){const Zt=de.positionedLines[ft];ut=$M(de,Ot,ut,ft);for(const Yt of Zt.positionedGlyphs){if(!Yt.rect)continue;const ki=Yt.rect||{};let Ti=jM+1,ai=!0,$t=1,Xi=0;if(Yt.image){const bi=We.get(Yt.image.toString());if(!bi)continue;if(bi.sdf){Yi("SDF images are not supported in formatted text and will be ignored.");continue}ai=!1,$t=bi.pixelRatio,Ti=pm/$t}const wi=(ze||dt)&&Yt.vertical,Ei=Yt.metrics.advance*Yt.scale/2,Hi=Yt.metrics,sn=Yt.rect;if(sn===null)continue;dt&&de.verticalizable&&(Xi=Yt.image?Ei-Yt.metrics.width*Yt.scale/2:0);const nn=ze?[Yt.x+Ei,Yt.y]:[0,0];let fn=[0,0],an=[0,0],pn=!1;ze||(wi?(an=[Yt.x+Ei+Nt[0],Yt.y+Nt[1]-Xi],pn=!0):fn=[Yt.x+Ei+be[0],Yt.y+be[1]-Xi]);const Jn=sn.w*Yt.scale/($t*(Yt.localGlyph?Yu:1)),wr=sn.h*Yt.scale/($t*(Yt.localGlyph?Yu:1));let ye,Ee,yt,Jt;if(wi){const bi=Yt.y-ut,Gi=new Qt(-Ei,Ei-bi),vn=-Math.PI/2,xn=new Qt(...an);ye=new Qt(-Ei+fn[0],fn[1]),ye._rotateAround(vn,Gi)._add(xn),ye.x+=-bi+Ei,ye.y-=(Hi.left-Ti)*Yt.scale;const on=Yt.image?Hi.advance*Yt.scale:pa*Yt.scale,tr=String.fromCodePoint(Yt.glyph);LM(tr)?ye.x+=(1-Ti)*Yt.scale:zM(tr)?ye.x+=on-Hi.height*Yt.scale+(-Ti-1)*Yt.scale:ye.x+=Yt.image||Hi.width+2*Ti===sn.w&&Hi.height+2*Ti===sn.h?(on-wr)/2:(on-(Hi.height+2*Ti)*Yt.scale)/2,Ee=new Qt(ye.x,ye.y-Jn),yt=new Qt(ye.x+wr,ye.y),Jt=new Qt(ye.x+wr,ye.y-Jn)}else{const bi=(Hi.left-Ti)*Yt.scale-Ei+fn[0],Gi=(-Hi.top-Ti)*Yt.scale+fn[1],vn=bi+Jn,xn=Gi+wr;ye=new Qt(bi,Gi),Ee=new Qt(vn,Gi),yt=new Qt(bi,xn),Jt=new Qt(vn,xn)}if(St){let bi;bi=ze?new Qt(0,0):pn?new Qt(Nt[0],Nt[1]):new Qt(be[0],be[1]),ye._rotateAround(St,bi),Ee._rotateAround(St,bi),yt._rotateAround(St,bi),Jt._rotateAround(St,bi)}const oi=new Qt(0,0),ri=new Qt(0,0);Bt.push({tl:ye,tr:Ee,bl:yt,br:Jt,texPrimary:ki,texSecondary:void 0,writingMode:de.writingMode,glyphOffset:nn,sectionIndex:Yt.sectionIndex,isSDF:ai,pixelOffsetTL:oi,pixelOffsetBR:ri,minFontScaleX:0,minFontScaleY:0})}}return Bt}(0,a,T,p,m,v,c,n.allowVerticalPlacement),he=n.textSizeData;let Y=null;he.kind==="source"?(Y=[Zh*p.layout.get("text-size").evaluate(v,{},K)*G.textScaleFactor],Y[0]>ap&&Yi(`${n.layerIds[0]}: Value for "text-size" is >= ${w_}. Reduce your "text-size".`)):he.kind==="composite"&&(Y=[Zh*G.compositeTextSizes[0].evaluate(v,{},K)*G.textScaleFactor,Zh*G.compositeTextSizes[1].evaluate(v,{},K)*G.textScaleFactor],(Y[0]>ap||Y[1]>ap)&&Yi(`${n.layerIds[0]}: Value for "text-size" is >= ${w_}. Reduce your "text-size".`)),n.addSymbols(n.text,ce,Y,T,m,v,R,e,i,E.lineStartIndex,E.lineLength,j,Z,K,te,!1);for(const le of D)P[le]=n.text.placedSymbolArray.length-1;return 4*ce.length}function Z0(n){for(const e in n)return n[e];return null}function tv(n,e,i,a,c,p,m,v,T,E){let R=m.top,D=m.bottom,P=m.left,j=m.right;if(dw(m)&&m.collisionPadding){const G=m.collisionPadding;P-=G[0],R-=G[1],j+=G[2],D+=G[3]}if(T){const G=new Qt(P,R),Z=new Qt(j,R),K=new Qt(P,D),te=new Qt(j,D),ce=wn(T);let he=new Qt(0,0);E&&(he=new Qt(E[0],E[1])),G._rotateAround(ce,he),Z._rotateAround(ce,he),K._rotateAround(ce,he),te._rotateAround(ce,he),P=Math.min(G.x,Z.x,K.x,te.x),j=Math.max(G.x,Z.x,K.x,te.x),R=Math.min(G.y,Z.y,K.y,te.y),D=Math.max(G.y,Z.y,K.y,te.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,P,R,j,D,v,a,c,p),n.length-1}function W0(n){dw(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function tI(n,e,i,a){const c=n.compareText;if(e in c){const p=c[e];for(let m=p.length-1;m>=0;m--)if(a.dist(p[m])<i)return!0}else c[e]=[];return c[e].push(a),!1}function kw(n,e){const i=n.fovAboveCenter,a=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,c=(n._camera.position[2]*n.worldSize-a)/Math.cos(n._pitch),p=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let m=Math.sin(n._pitch)*p+c;const v=c*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let T=Math.max(n.zoom-17,0);n.isOrthographic&&(T/=10),m*=1+T}return Math.min(1.01*m,v)}function T_(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),a=n.x*i,c=(n.x+1)*i,p=n.y*i,m=(n.y+1)*i,v=Ne(a),T=Ne(c),E=Ke(p),R=Ke(m),D=e.project(v,E),P=e.project(T,E),j=e.project(T,R),G=e.project(v,R);let Z=Math.min(D.x,P.x,j.x,G.x),K=Math.min(D.y,P.y,j.y,G.y),te=Math.max(D.x,P.x,j.x,G.x),ce=Math.max(D.y,P.y,j.y,G.y);const he=i/16;function Y(de,be,Fe,ze,Be,We){const dt=(Fe+Be)/2,Bt=(ze+We)/2,St=e.project(Ne(dt),Ke(Bt)),Nt=Math.max(0,Z-St.x,K-St.y,St.x-te,St.y-ce);Z=Math.min(Z,St.x),te=Math.max(te,St.x),K=Math.min(K,St.y),ce=Math.max(ce,St.y),Nt>he&&(Y(de,St,Fe,ze,dt,Bt),Y(St,be,dt,Bt,Be,We))}Y(D,P,a,p,c,p),Y(P,j,c,p,c,m),Y(j,G,c,m,a,m),Y(G,D,a,m,a,p),Z-=he,K-=he,te+=he,ce+=he;const le=1/Math.max(te-Z,ce-K);return{scale:le,x:Z*le,y:K*le,x2:te*le,y2:ce*le,projection:e}}function Nw(n,{x:e,y:i},a=0){return new Qt(((e-a)*n.scale-n.x)*Kt,(i*n.scale-n.y)*Kt)}const iI=me(new Float32Array(16));class op{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new oe(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a,c=!0){return e._coordinatePoint(e.locationCoordinate(i,a),c)}pixelsPerMeter(e,i){return Pe(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return kw(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,c){const p=e.horizonLineFromTop(!1),m=new Qt(i,Math.max(p,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,c))}pointCoordinate3D(e,i,a){const c=new Qt(i,a);if(e.elevation)return e.elevation.pointCoordinate(c);{const p=this.pointCoordinate(e,c.x,c.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return iI}createTileMatrix(e,i,a){let c,p,m;const v=a.canonical,T=me(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=T_(v,this);c=1,p=E.x+a.wrap*E.scale,m=E.y,se(T,T,[c/E.scale,c/E.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*a.wrap)*c,m=v.y*c;return fe(T,T,[p,m,0]),se(T,T,[c/Kt,c/Kt,1]),T}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class nI extends op{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(wn(i));this.n=(c+Math.sin(wn(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c,r0:p}=this,m=wn(e-this.center[0]),v=wn(i),T=Math.sqrt(c-2*a*Math.sin(v))/a;return{x:T*Math.sin(m*a),y:T*Math.cos(m*a)-p,z:0}}unproject(e,i){const{n:a,c,r0:p}=this,m=p+i;let v=Math.atan2(e,Math.abs(m))*Math.sign(m);m*a<0&&(v-=Math.PI*Math.sign(e)*Math.sign(m));const T=wn(this.center[0])*a;v=et(v,-Math.PI-T,Math.PI-T);const E=Me(nt(v/a)+this.center[0],-180,180),R=Math.asin(Me((c-(e*e+m*m)*a*a)/(2*a),-1,1)),D=Me(nt(R),-85.051129,mt);return new oe(E,D)}}const S_=1.340264,E_=-.081106,A_=893e-6,C_=.003796,iv=Math.sqrt(3)/2;class rI extends op{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(iv*Math.sin(i)),c=a*a,p=c*c*c;return{x:.5*(e*Math.cos(a)/(iv*(S_+3*E_*c+p*(7*A_+9*C_*c)))/Math.PI+.5),y:1-.5*(a*(S_+E_*c+p*(A_+C_*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,c=a*a,p=c*c*c;for(let R,D,P,j=0;j<12&&(D=a*(S_+E_*c+p*(A_+C_*c))-i,P=S_+3*E_*c+p*(7*A_+9*C_*c),R=D/P,a=Me(a-R,-Math.PI/3,Math.PI/3),c=a*a,p=c*c*c,!(Math.abs(R)<1e-12));++j);const m=iv*e*(S_+3*E_*c+p*(7*A_+9*C_*c))/Math.cos(a),v=Math.asin(Math.sin(a)/iv),T=Me(180*m/Math.PI,-180,180),E=Me(180*v/Math.PI,-85.051129,mt);return new oe(T,E)}}class sI extends op{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),c=Me(360*(.5-i),-85.051129,mt);return new oe(a,c)}}const pg=Math.PI/2;function nv(n){return Math.tan((pg+n)/2)}class aI extends op{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let c=wn(i),p=wn(a);this.southernCenter=c+p<0,this.southernCenter&&(c=-c,p=-p);const m=Math.cos(c),v=nv(c);this.n=c===p?Math.sin(c):Math.log(m/Math.cos(p))/Math.log(nv(p)/v),this.f=m*Math.pow(nv(c),this.n)/this.n}project(e,i){i=wn(i),this.southernCenter&&(i=-i),e=wn(e-this.center[0]);const a=1e-6,{n:c,f:p}=this;p>0?i<-pg+a&&(i=-pg+a):i>pg-a&&(i=pg-a);const m=p/Math.pow(nv(i),c);let v=m*Math.sin(c*e),T=p-m*Math.cos(c*e);return v=.5*(v/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:v,y:this.southernCenter?T:1-T,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:c}=this,p=c-i,m=Math.sign(p),v=Math.sign(a)*Math.sqrt(e*e+p*p);let T=Math.atan2(e,Math.abs(p))*m;p*a<0&&(T-=Math.PI*Math.sign(e)*m);const E=Me(nt(T/a)+this.center[0],-180,180),R=Me(nt(2*Math.atan(Math.pow(c/v,1/a))-pg),-85.051129,mt);return new oe(E,this.southernCenter?-R:R)}}class Fw extends op{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Ce(e),y:Ae(i),z:0}}unproject(e,i){const a=Ne(e),c=Ke(i);return new oe(a,c)}}const Bw=wn(mt);class oI extends op{project(e,i){const a=(i=wn(i))*i,c=a*a;return{x:.5*((e=wn(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,c=25,p=0,m=a*a;do{m=a*a;const E=m*m;p=(a*(1.007226+m*(.015085+E*(.028874*m-.044475-.005916*E)))-i)/(1.007226+m*(.045255+E*(.259866*m-.311325-.005916*11*E))),a=Me(a-p,-Bw,Bw)}while(Math.abs(p)>1e-6&&--c>0);m=a*a;const v=Me(nt(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),T=nt(a);return new oe(v,T)}}const jw=wn(mt);class lI extends op{project(e,i){i=wn(i),e=wn(e);const a=Math.cos(i),c=2/Math.PI,p=Math.acos(a*Math.cos(e/2)),m=Math.sin(p)/p,v=.5*(e*c+2*a*Math.sin(e/2)/m)||0,T=.5*(i+Math.sin(i)/m)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,p=25;const m=1e-6;let v=0,T=0;do{const E=Math.cos(c),R=Math.sin(c),D=2*R*E,P=R*R,j=E*E,G=Math.cos(a/2),Z=Math.sin(a/2),K=2*G*Z,te=Z*Z,ce=1-j*G*G,he=ce?1/ce:0,Y=ce?Math.acos(E*G)*Math.sqrt(1/ce):0,le=.5*(2*Y*E*Z+2*a/Math.PI)-e,de=.5*(Y*R+c)-i,be=.5*he*(j*te+Y*E*G*P)+1/Math.PI,Fe=he*(K*D/4-Y*R*Z),ze=.125*he*(D*Z-Y*R*j*K),Be=.5*he*(P*G+Y*te*E)+.5,We=Fe*ze-Be*be;v=(de*Fe-le*Be)/We,T=(le*ze-de*be)/We,a=Me(a-v,-Math.PI,Math.PI),c=Me(c-T,-jw,jw)}while((Math.abs(v)>m||Math.abs(T)>m)&&--p>0);return new oe(nt(a),nt(c))}}class Vw extends op{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(wn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:c}=this;return{x:wn(e)*c*a+.5,y:-Math.sin(wn(i))/c*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:c}=this,p=-(i-.5)/a,m=Me(nt((e-.5)/a)/c,-180,180),v=Math.asin(Me(p*c,-1,1)),T=Me(nt(v),-85.051129,mt);return new oe(m,T)}}class cI extends Fw{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){const c=Gd(e,i,a);return ei(c,c,Vh(lu(a))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,i,a){const c=X(i.lat,i.lng),p=at([],c),m=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Dt(c,c,p,Pe(1,0)*Kt*m);const v=me(new Float64Array(16));return pe(v,e.pixelMatrix,e.globeMatrix),ei(c,c,v),new Qt(c[0],c[1])}pixelsPerMeter(e,i){return Pe(1,0)*i}pixelSpaceConversion(e,i,a){const c=Pe(1,e)*i,p=zi(Pe(1,45)*i,c,a);return this.pixelsPerMeter(e,i)/p}createTileMatrix(e,i,a){const c=Xg(lu(a.canonical));return pe(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:a}=e,c=Vh(lu(i));return we(c,c,wn(a.lng)),De(c,c,wn(a.lat)),se(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,i,a,c){return vy(e,i,a,!0)||new Ge(0,0)}pointCoordinate3D(e,i,a){const c=this.pointCoordinate(e,i,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!vy(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(c,p){const m=c.cameraToCenterDistance,v=c._centerAltitude*p,T=c._camera,E=c._camera.forward(),R=Et([],Ve([],E,-m),[0,0,v]),D=c.worldSize/(2*Math.PI),P=[0,0,-D],j=c.width/c.height,G=Math.tan(c.fovAboveCenter),Z=Ve([],T.up(),G),K=Ve([],T.right(),G*j),te=at([],Et([],Et([],E,Z),K)),ce=[];let he;if(new ur(R,te).closestPointOnSphere(P,D,ce)){const Y=Et([],ce,P),le=Qi([],Y,R);he=Math.cos(c.fovAboveCenter)*Lt(le)}else{const Y=Qi([],R,P),le=Qi([],P,R);at(le,le);const de=Lt(Y)-D;he=Math.sqrt(de*(de+2*D));const be=Math.acos(he/(D+de))-Math.acos(Rt(E,le));he*=Math.cos(be)}return 1.01*he}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=qu(e.zoom);if(a>0){const c=kw(e,Pe(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return zi(i,c+p*(1-Math.cos(m)),Math.pow(a,10))}return i}upVector(e,i,a){return Gd(i,a,e,1)}upVectorScale(e){return{metersToTile:ts(cu(lu(e)))}}}function Uw(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new Fw(n);case"equirectangular":return new sI(n);case"naturalEarth":return new oI(n);case"equalEarth":return new rI(n);case"winkelTripel":return new lI(n);case"albers":return i?new Vw(n):new nI(n);case"lambertConformalConic":return i?new Vw(n):new aI(n);case"globe":return new cI(n)}throw new Error(`Invalid projection name: ${n.name}`)}const uI=Wi.VectorTileFeature.types,hI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function rv(n,e,i,a,c,p,m,v,T,E,R,D,P){const j=v?Math.min(ap,Math.round(v[0])):0,G=v?Math.min(ap,Math.round(v[1])):0;n.emplaceBack(e,i,Math.round(32*a),Math.round(32*c),p,m,(j<<1)+(T?1:0),G,16*E,16*R,256*D,256*P)}function sv(n,e,i){n.emplaceBack(e,i)}function av(n,e,i,a,c,p,m){n.emplaceBack(e,i,a,c,p,m)}const ov=(n,e,i,a)=>{for(let c=0;c<e;c++)n.emplaceBack(i[0],i[1],i[2],a[0],a[1],a[2])};function lv(n,e,i,a,c){n.emplaceBack(e,i,a,c),n.emplaceBack(e,i,a,c),n.emplaceBack(e,i,a,c),n.emplaceBack(e,i,a,c)}function dI(n){for(const e of n.sections)if(Lp(e.text))return!0;return!1}class X0{constructor(e){this.layoutVertexArray=new Fu,this.indexArray=new ls,this.programConfigurations=e,this.segments=new kr,this.dynamicLayoutVertexArray=new Es,this.opacityVertexArray=new ju,this.placedSymbolArray=new Gp,this.iconTransitioningVertexArray=new ta,this.globeExtVertexArray=new Bu,this.zOffsetVertexArray=new Tl,this.orientationVertexArray=new Pd}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,a,c,p){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,SM.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,AM.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,hI,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,IM.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,EM.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,CM.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,MM.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}mi(X0,"SymbolBuffers");class Y0{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new kr,this.collisionVertexArray=new el,this.collisionVertexArrayExt=new Es}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,RM.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,DM.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}mi(Y0,"CollisionBuffers");class cv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=me([]),this.placementViewportMatrix=me([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=_w(this.zoom,i["text-size"],this.worldview),this.iconSizeData=_w(this.zoom,i["icon-size"],this.worldview);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),p=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(m=>Il[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new X0(new u(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new X0(new u(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Ff,this.lineVertexArray=new Hp,this.symbolInstances=new fa}calculateGlyphDependencies(e,i,a,c,p){for(const m of e){const v=m.codePointAt(0);if(v===void 0)break;if(i[v]=!0,c&&p&&v<=65535){const T=y_[m];T&&(i[T.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!tp(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,i,a,c){const p=this.layers[0],m=p.layout,v=this.projection.name==="globe",T=m.get("text-font"),E=m.get("text-field"),R=m.get("icon-image"),[D,P]=m.get("icon-size-scale-range"),j=Me(i.scaleFactor||1,D,P),G=(E.value.kind!=="constant"||E.value.value instanceof Ea&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),Z=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,K=m.get("symbol-sort-key");if(this.features=[],!G&&!Z)return;const te=i.iconDependencies,ce=i.glyphDependencies,he=i.availableImages,Y=new Kn(this.zoom,{worldview:this.worldview});for(const{feature:le,id:de,index:be,sourceLayerIndex:Fe}of e){const ze=p._featureFilter.needGeometry,Be=hi(le,ze);if(!p._featureFilter.filter(Y,Be,a))continue;if(ze||(Be.geometry=di(le,a,c)),v&&le.type!==1&&a.z<=5){const Nt=Be.geometry,Gt=.98078528056,pt=(Ot,ut)=>Rt(Gd(Ot.x,Ot.y,a,1),Gd(ut.x,ut.y,a,1))<Gt;for(let Ot=0;Ot<Nt.length;Ot++)Nt[Ot]=Wt(Nt[Ot],pt)}let We,dt;if(G){const Nt=p.getValueAndResolveTokens("text-field",Be,a,he),Gt=Ea.factory(Nt);dI(Gt)&&(this.hasRTLText=!0),(!this.hasRTLText||Pu()==="unavailable"||this.hasRTLText&&Wl.isParsed())&&(We=OM(Gt,p,Be))}if(Z){const Nt=p.getValueAndResolveTokens("icon-image",Be,a,he);dt=typeof Nt=="string"?Hs.build(Nt):Nt}if(!We&&!dt)continue;const Bt=this.sortFeaturesByKey?K.evaluate(Be,{},a):void 0,St={id:de,text:We,icon:dt,index:be,sourceLayerIndex:Fe,geometry:Be.geometry,properties:le.properties,type:uI[le.type],sortKey:Bt};if(this.features.push(St),dt){const Nt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Gt,iconSecondary:pt}=Pw(dt,this.iconSizeData,Nt["icon-size"],a,this.zoom,St,this.pixelRatio,j,this.worldview),Ot=Gt.id.toString();if(te.has(Ot)?te.get(Ot).push(Gt):te.set(Ot,[Gt]),pt){const ut=pt.id.toString();te.has(ut)?te.get(ut).push(pt):te.set(ut,[pt])}}if(We){const Nt=T.evaluate(Be,{},a).join(","),Gt=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Il.vertical)>=0;for(const pt of We.sections)if(pt.image){const Ot=pt.image.getPrimary().scaleSelf(this.pixelRatio),ut=Ot.id.toString(),ft=te.get(ut)||[];ft.push(Ot),te.set(ut,ft)}else{const Ot=Ss(We.toString()),ut=pt.fontStack||Nt,ft=ce[ut]=ce[ut]||{};this.calculateGlyphDependencies(pt.text,ft,Gt,this.allowVerticalPlacement,Ot)}}}if(m.get("symbol-placement")==="line"&&(this.features=function(le){const de={},be={},Fe=[];let ze=0;function Be(St){Fe.push(le[St]),ze++}function We(St,Nt,Gt){const pt=be[St];return delete be[St],be[Nt]=pt,Fe[pt].geometry[0].pop(),Fe[pt].geometry[0]=Fe[pt].geometry[0].concat(Gt[0]),pt}function dt(St,Nt,Gt){const pt=de[Nt];return delete de[Nt],de[St]=pt,Fe[pt].geometry[0].shift(),Fe[pt].geometry[0]=Gt[0].concat(Fe[pt].geometry[0]),pt}function Bt(St,Nt,Gt){const pt=Gt?Nt[0][Nt[0].length-1]:Nt[0][0];return`${St}:${pt.x}:${pt.y}`}for(let St=0;St<le.length;St++){const Nt=le[St],Gt=Nt.geometry,pt=Nt.text?Nt.text.toString():null;if(!pt){Be(St);continue}const Ot=Bt(pt,Gt),ut=Bt(pt,Gt,!0);if(Ot in be&&ut in de&&be[Ot]!==de[ut]){const ft=dt(Ot,ut,Gt),Zt=We(Ot,ut,Fe[ft].geometry);delete de[Ot],delete be[ut],be[Bt(pt,Fe[Zt].geometry,!0)]=Zt,Fe[ft].geometry=null}else Ot in be?We(Ot,ut,Gt):ut in de?dt(Ot,ut,Gt):(Be(St),de[Ot]=ze-1,be[ut]=ze-1)}return Fe.filter(St=>St.geometry)}(this.features)),m.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const le of i.elevationFeatures)this.elevationFeatureIdToIndex.set(le.id,this.elevationFeatures.length),this.elevationFeatures.push(le)}}else m.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((le,de)=>le.sortKey-de.sortKey)}update(e,i,a,c,p,m,v){this.text.programConfigurations.updatePaintArrays(e,i,p,a,c,m,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,p,a,c,m,v,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const a=lt(e),c=1/a;let p=!1,m=!1;for(let v=0;v<this.symbolInstances.length;v++){const T=this.symbolInstances.get(v),E=ct(1,0,0),R=ct(0,1,0),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:P,numIconVertices:j,numVerticalIconVertices:G}=T,Z=D>0||P>0,K=j>0,te=this.elevationFeatures[T.elevationFeatureIndex];if(te){const ce=new Qt(T.tileAnchorX,T.tileAnchorY),he=.075+te.pointElevation(ce);T.zOffset!==he&&(i=!0,T.zOffset=he);const Y=te.computeSlopeNormal(ce,c),le=Dl(Nr(),ct(0,0,1),Y);In(E,E,le),In(R,R,le),E[2]*=a,R[2]*=a,E[0]===1&&E[1]===0&&E[2]===0&&R[0]===0&&R[1]===1&&R[2]===0||(p=p||Z,m=m||K)}if(Z&&(ov(this.text.orientationVertexArray,D,E,R),ov(this.text.orientationVertexArray,P,E,R)),K){const{placedIconSymbolIndex:ce,verticalPlacedIconSymbolIndex:he}=T;ce>=0&&ov(this.icon.orientationVertexArray,j,E,R),he>=0&&ov(this.icon.orientationVertexArray,G,E,R)}}p||(this.text.orientationVertexArray=void 0),m||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(p,m,v)=>{a+=m,a>p.length&&p.resize(a);for(let T=-m;T<0;T++)p.emplace(T+a,v)},i=(p,m,v)=>{c+=m,c>p.length&&p.resize(c);for(let T=-m;T<0;T++)p.emplace(T+c,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,c=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:T,numIconVertices:E}=m,R=m.zOffset,D=E>0;if((v>0||T>0)&&(e(this.text.zOffsetVertexArray,v,R),e(this.text.zOffsetVertexArray,T,R)),D){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:j}=m;P>=0&&i(this.icon.zOffsetVertexArray,E,R),j>=0&&i(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,R)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Uw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:p}of i)this.lineVertexArray.emplaceBack(c,p);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z,K){const te=e.indexArray,ce=e.layoutVertexArray,he=e.globeExtVertexArray,Y=e.segments.prepareSegment(4*i.length,ce,te,this.canOverlap?m.sortKey:void 0),le=this.glyphOffsetArray.length,de=Y.vertexLength,be=this.allowVerticalPlacement&&v===Il.vertical?Math.PI/2:0,Fe=m.text&&m.text.sections;for(let Be=0;Be<i.length;Be++){const{tl:We,tr:dt,bl:Bt,br:St,texPrimary:Nt,texSecondary:Gt,pixelOffsetTL:pt,pixelOffsetBR:Ot,minFontScaleX:ut,minFontScaleY:ft,glyphOffset:Zt,isSDF:Yt,sectionIndex:ki}=i[Be],Ti=Y.vertexLength,ai=Zt[1];if(rv(ce,E.x,E.y,We.x,ai+We.y,Nt.x,Nt.y,a,Yt,pt.x,pt.y,ut,ft),rv(ce,E.x,E.y,dt.x,ai+dt.y,Nt.x+Nt.w,Nt.y,a,Yt,Ot.x,pt.y,ut,ft),rv(ce,E.x,E.y,Bt.x,ai+Bt.y,Nt.x,Nt.y+Nt.h,a,Yt,pt.x,Ot.y,ut,ft),rv(ce,E.x,E.y,St.x,ai+St.y,Nt.x+Nt.w,Nt.y+Nt.h,a,Yt,Ot.x,Ot.y,ut,ft),T){const{x:$t,y:Xi,z:wi}=T.anchor,[Ei,Hi,sn]=T.up;av(he,$t,Xi,wi,Ei,Hi,sn),av(he,$t,Xi,wi,Ei,Hi,sn),av(he,$t,Xi,wi,Ei,Hi,sn),av(he,$t,Xi,wi,Ei,Hi,sn),lv(e.dynamicLayoutVertexArray,$t,Xi,wi,be)}else lv(e.dynamicLayoutVertexArray,E.x,E.y,E.z,be);if(K){const $t=Gt||Nt;sv(e.iconTransitioningVertexArray,$t.x,$t.y),sv(e.iconTransitioningVertexArray,$t.x+$t.w,$t.y),sv(e.iconTransitioningVertexArray,$t.x,$t.y+$t.h),sv(e.iconTransitioningVertexArray,$t.x+$t.w,$t.y+$t.h)}te.emplaceBack(Ti,Ti+1,Ti+2),te.emplaceBack(Ti+1,Ti+2,Ti+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Zt[0]),Be!==i.length-1&&ki===i[Be+1].sectionIndex||e.programConfigurations.populatePaintArrays(ce.length,m,m.index,{},j,G,Z,Fe&&Fe[ki],this.worldview)}const ze=T?T.anchor:E;e.placedSymbolArray.emplaceBack(ze.x,ze.y,ze.z,E.x,E.y,le,this.glyphOffsetArray.length-le,de,R,D,E.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],v,0,0,0,P,0)}_commitLayoutVertex(e,i,a,c,p,m,v){e.emplaceBack(i,a,c,p,m,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,i,a,c,p,m,v){const T=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),E=T.vertexLength,R=v.tileAnchorX,D=v.tileAnchorY;for(let j=0;j<4;j++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,i,e.padding,v.zOffset),this._commitLayoutVertex(a.layoutVertexArray,c,p,m,R,D,new Qt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,p,m,R,D,new Qt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,p,m,R,D,new Qt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,p,m,R,D,new Qt(e.x1,e.y2)),T.vertexLength+=4;const P=a.indexArray;P.emplaceBack(E,E+1),P.emplaceBack(E+1,E+2),P.emplaceBack(E+2,E+3),P.emplaceBack(E+3,E),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,c,p,m){for(let v=c;v<p;v++){const T=a.get(v),E=this.getSymbolInstanceTextSize(e,m,i,v);this._addCollisionDebugVertices(T,E,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,i,a,c,p,m){for(let v=c;v<p;v++){const T=a.get(v),E=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._addCollisionDebugVertices(T,E,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Y0(El,nw.members,ta),this.iconCollisionBox=new Y0(El,nw.members,ta);const c=x_(this.iconSizeData,e),p=x_(this.textSizeData,e,a);for(let m=0;m<this.symbolInstances.length;m++){const v=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(p,e,i,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(p,e,i,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,e,i,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,e,i,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,i,a,c){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),m=U0(this.textSizeData,e,p)/pa;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,i,a){const c=this.icon.placedSymbolArray.get(a),p=U0(this.iconSizeData,e,c);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,a,c){e.emplaceBack(i,-a,-a,c),e.emplaceBack(i,a,-a,c),e.emplaceBack(i,a,a,c),e.emplaceBack(i,-a,a,c)}_updateTextDebugCollisionBoxes(e,i,a,c,p,m,v){for(let T=c;T<p;T++){const E=a.get(T),R=this.getSymbolInstanceTextSize(e,m,i,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,E.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,i,a,c,p,m,v){for(let T=c;T<p;T++){const E=a.get(T),R=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,E.padding,m.zOffset)}}updateCollisionDebugBuffers(e,i,a,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=x_(this.iconSizeData,e,c),m=x_(this.textSizeData,e,a);for(let v=0;v<this.symbolInstances.length;v++){const T=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(m,e,i,T.textBoxStartIndex,T.textBoxEndIndex,T,a),this._updateTextDebugCollisionBoxes(m,e,i,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,a),this._updateIconDebugCollisionBoxes(p,e,i,T.iconBoxStartIndex,T.iconBoxEndIndex,T,c),this._updateIconDebugCollisionBoxes(p,e,i,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,c)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,c,p,m,v,T,E){const R={};if(i<a){const{x1:D,y1:P,x2:j,y2:G,padding:Z,projectedAnchorX:K,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:Y,featureIndex:le}=e.get(i);R.textBox={x1:D,y1:P,x2:j,y2:G,padding:Z,projectedAnchorX:K,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:Y},R.textFeatureIndex=le}if(c<p){const{x1:D,y1:P,x2:j,y2:G,padding:Z,projectedAnchorX:K,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:Y,featureIndex:le}=e.get(c);R.verticalTextBox={x1:D,y1:P,x2:j,y2:G,padding:Z,projectedAnchorX:K,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:Y},R.verticalTextFeatureIndex=le}if(m<v){const{x1:D,y1:P,x2:j,y2:G,padding:Z,projectedAnchorX:K,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:Y,featureIndex:le}=e.get(m);R.iconBox={x1:D,y1:P,x2:j,y2:G,padding:Z,projectedAnchorX:K,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:Y},R.iconFeatureIndex=le}if(T<E){const{x1:D,y1:P,x2:j,y2:G,padding:Z,projectedAnchorX:K,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:Y,featureIndex:le}=e.get(T);R.verticalIconBox={x1:D,y1:P,x2:j,y2:G,padding:Z,projectedAnchorX:K,projectedAnchorY:te,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:Y},R.verticalIconFeatureIndex=le}return R}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),c=a.vertexStartIndex+4*a.numGlyphs;for(let p=a.vertexStartIndex;p<c;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),c=[],p=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const T=this.symbolInstances.get(v);c.push(0|Math.round(i*T.tileAnchorX+a*T.tileAnchorY)),p.push(T.featureIndex)}return m.sort((v,T)=>c[v]-c[T]||p[T]-p[v]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:E}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),p>=0&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==c&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Gw,Hw,K0;mi(cv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),cv.addDynamicAttributes=lv;class qw{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:nh,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mi(qw,"FormatSectionOverride",{omit:["defaultValue"]});const Q0=()=>K0||(K0={layout:Gw||(Gw=new zr({"symbol-placement":new Ut(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Ut(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ut(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ni(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ut(Ye.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ut(Ye.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ut(Ye.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ut(Ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ut(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ut(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ut(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new ni(Ye.layout_symbol["icon-size"]),"icon-size-scale-range":new Ut(Ye.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new ni(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ni(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new ni(Ye.layout_symbol["icon-image"]),"icon-rotate":new ni(Ye.layout_symbol["icon-rotate"]),"icon-padding":new Ut(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Ut(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new ni(Ye.layout_symbol["icon-offset"]),"icon-anchor":new ni(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ut(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ut(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ut(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new ni(Ye.layout_symbol["text-field"]),"text-font":new ni(Ye.layout_symbol["text-font"]),"text-size":new ni(Ye.layout_symbol["text-size"]),"text-size-scale-range":new Ut(Ye.layout_symbol["text-size-scale-range"]),"text-max-width":new ni(Ye.layout_symbol["text-max-width"]),"text-line-height":new ni(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new ni(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new ni(Ye.layout_symbol["text-justify"]),"text-radial-offset":new ni(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ut(Ye.layout_symbol["text-variable-anchor"]),"text-anchor":new ni(Ye.layout_symbol["text-anchor"]),"text-max-angle":new Ut(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Ut(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new ni(Ye.layout_symbol["text-rotate"]),"text-padding":new Ut(Ye.layout_symbol["text-padding"]),"text-keep-upright":new Ut(Ye.layout_symbol["text-keep-upright"]),"text-transform":new ni(Ye.layout_symbol["text-transform"]),"text-offset":new ni(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new Ut(Ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ut(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new Ut(Ye.layout_symbol["text-optional"]),visibility:new Ut(Ye.layout_symbol.visibility)})),paint:Hw||(Hw=new zr({"icon-opacity":new ni(Ye.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ni(Ye.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ni(Ye.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ni(Ye.paint_symbol["text-emissive-strength"]),"icon-color":new ni(Ye.paint_symbol["icon-color"]),"icon-halo-color":new ni(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new ni(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ni(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Ut(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ut(Ye.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ut(Ye.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ni(Ye.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ni(Ye.paint_symbol["text-occlusion-opacity"]),"text-color":new ni(Ye.paint_symbol["text-color"],{runtimeType:_o,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new ni(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new ni(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new ni(Ye.paint_symbol["text-halo-blur"]),"text-translate":new Ut(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new Ut(Ye.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ut(Ye.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ut(Ye.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ut(Ye.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ut(Ye.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new ni(Ye.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},K0);class uv extends da{constructor(e,i,a,c){super(e,Q0(),i,a,c),this._colorAdjustmentMatrix=me([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const p of a)c.indexOf(p)<0&&c.push(p);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,a,c){return this._saturation===e&&this._contrast===i&&this._brightnessMin===a&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(p,m,v,T){p=As(p),m=Bs(m);const E=_e(),R=p/3,D=1-2*R,P=[D,R,R,0,R,D,R,0,R,R,D,0,0,0,0,1],j=.5-.5*m,G=T-v;return pe(E,[G,0,0,0,0,G,0,0,0,0,G,0,v,v,v,1],[m,0,0,0,0,m,0,0,0,0,m,0,j,j,j,1]),pe(E,E,P),E}(e,i,a,c),this._saturation=e,this._contrast=i,this._brightnessMin=a,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,a,c){const p=this.layout.get(e).evaluate(i,{},a,c),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Is(m.value)||!p?p:function(v,T){return T.replace(/{([^{}]+)}/g,(E,R)=>R in v?String(v[R]):"")}(i.properties,p)}createBucket(e){return new cv(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Q0().paint.overridableProperties){if(!uv.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new qw(i),c=new Lr(a,i.property.specification,this.scope,this.options);let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new Ul("source",c):new xl("composite",c,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Ou(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&uv.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),c=Q0().paint.properties[i];let p=!1;const m=v=>{for(const T of v)if(c.overrides&&c.overrides.hasOverride(T))return void(p=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Ea)m(a.value.value.sections);else if(a.value.kind==="source"){const v=E=>{p||(E instanceof qi&&yi(E.value)===rd?m(E.value.sections):E instanceof pc?m(E.sections):E.eachChild(v))},T=a.value;T._styleExpression&&v(T._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,a){return{config:new co(this,{zoom:i,lut:a}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let $w,Zw,Ww,Xw;var J0=En([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function ex(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function tx(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class ix{constructor(e,i,a,c){this.context=e,this.format=a,this.useMipmap=c&&c.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:c&&c.premultiply})}update(e,i){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,c=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:p}=this,{gl:m}=p,{x:v,y:T}=i&&i.position?i.position:{x:0,y:0},E=v+a,R=T+c;!this.size||this.size[0]===E&&this.size[1]===R||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!i||i.premultiply!==!1));const D=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&E>0&&R>0){const P=this.useMipmap?Math.floor(Math.log2(Math.max(E,R)))+1:1;m.texStorage2D(m.TEXTURE_2D,P,this.format,E,R),this.size=[E,R]}if(this.size)if(D)m.texSubImage2D(m.TEXTURE_2D,0,v,T,ex(this.format),tx(this.format),e);else{const P=e.data;P&&m.texSubImage2D(m.TEXTURE_2D,0,v,T,a,c,ex(this.format),tx(this.format),P)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,i,a=!1){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,a,c,p){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),i!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?e===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,a),this.wrapS=a),c!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,c),this.wrapT=c),p!==this.compareMode&&(p?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,p)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class hv{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}}function dv(n,e,i,a,c,p,m,v){const T=[n,e,1,i,a,1,c,p,1],E=[m,v,1],R=re([],T),[D,P,j]=hn(E,E,R);return Te(T,T,[D,0,0,0,P,0,0,0,j])}function Yw(n,e,i,a,c,p,m,v){const T=function(E,R,D,P,j,G,Z,K){const te=dv(0,0,1,0,1,1,0,1),ce=dv(E,R,D,P,j,G,Z,K);return Te(ce,ce,re([],te))}(n,e,i,a,c,p,m,v);return[T[2]/T[8]/Kt,T[5]/T[8]/Kt]}function fv(n){return[n[0],Math.min(Math.max(n[1],-85.051129),mt)]}class Kw extends fs{constructor(e,i,a,c){super(),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Zi("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=jo(this.map._requestManager.transformRequest(this.url,Er.Image),(a,c)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Rr(a)):c&&(this.image=c instanceof HTMLImageElement?ba.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new hv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Zi("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof hv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],a=e[0][1];for(const p of e)p[1]>a&&(a=p[1]),p[1]<i&&(i=p[1]);const c=(a+i)/2;if(c>mt?this.onNorthPole=!0:c<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map(Ge.fromLngLat);this.tileID=function(m){let v=1/0,T=1/0,E=-1/0,R=-1/0;for(const Z of m)v=Math.min(v,Z.x),T=Math.min(T,Z.y),E=Math.max(E,Z.x),R=Math.max(R,Z.y);const D=Math.max(E-v,R-T),P=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),j=Math.pow(2,P);let G=Math.floor((v+E)/2*j);return G>1&&(G-=1),new jh(P,G,Math.floor((T+R)/2*j))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Zi("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const te in this.tiles){const ce=this.tiles[te];ce.state!=="loaded"&&(ce.state="loaded",ce.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=T_(new jh(0,0,0),this.map.transform.projection),a=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(te){const ce=te[1].x-te[0].x,he=te[1].y-te[0].y,Y=te[2].x-te[1].x,le=te[2].y-te[1].y,de=te[3].x-te[2].x,be=te[3].y-te[2].y,Fe=te[0].x-te[3].x,ze=te[0].y-te[3].y,Be=ce*le-Y*he,We=Y*be-de*le,dt=de*ze-Fe*be,Bt=Fe*he-ce*ze;return Be>0&&We>0&&dt>0&&Bt>0||Be<0&&We<0&&dt<0&&Bt<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=T_(this.tileID,this.map.transform.projection),[p,m,v,T]=this.coordinates.map(te=>{const ce=c.projection.project(te[0],te[1]);return Nw(c,ce)._round()});this.perspectiveTransform=Yw(p.x,p.y,m.x,m.y,v.x,v.y,T.x,T.y);const E=this._boundsArray=new ku;E.emplaceBack(p.x,p.y,0,0),E.emplaceBack(m.x,m.y,Kt,0),E.emplaceBack(T.x,T.y,0,Kt),E.emplaceBack(v.x,v.y,Kt,Kt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(E,J0.members),this.boundsSegments=kr.simpleSegment(0,0,4,2);const R=[],D=[fv((P=this.coordinates)[0]),fv(P[1]),fv(P[2]),fv(P[3])];var P;const[j,G,Z,K]=function(te){let ce=te[0][0],he=ce,Y=te[0][1],le=Y;for(let de=1;de<te.length;de++)te[de][0]<ce?ce=te[de][0]:te[de][0]>he&&(he=te[de][0]),te[de][1]<Y?Y=te[de][1]:te[de][1]>le&&(le=te[de][1]);return[ce,Y,he-ce,le-Y]}(D);{const te=new ku,[ce,he,Y,le]=function(pt){let Ot=pt[0].x,ut=Ot,ft=pt[0].y,Zt=ft;for(let Yt=1;Yt<pt.length;Yt++)pt[Yt].x<Ot?Ot=pt[Yt].x:pt[Yt].x>ut&&(ut=pt[Yt].x),pt[Yt].y<ft?ft=pt[Yt].y:pt[Yt].y>Zt&&(Zt=pt[Yt].y);return[Ot,ft,ut-Ot,Zt-ft]}(a),de=pt=>[(pt.x-ce)/Y,(pt.y-he)/le],[be,Fe,ze,Be]=a.map(de),We=function(pt,Ot,ut,ft,Zt,Yt,ki,Ti){const ai=dv(0,0,1,0,1,1,0,1);return Te(ai,ai,re([],dv(pt,Ot,ut,ft,Zt,Yt,ki,Ti)))}(be[0],be[1],Fe[0],Fe[1],ze[0],ze[1],Be[0],Be[1]);this.elevatedGlobePerspectiveTransform=Yw(be[0],be[1],Fe[0],Fe[1],ze[0],ze[1],Be[0],Be[1]);const dt=(pt,Ot)=>{R.push(pt.lng);const ut=Math.round((pt.lng-j)/Z*Kt),ft=Math.round((pt.lat-G)/K*Kt),Zt=de(Ot),Yt=hn([],[Zt[0],Zt[1],1],We),ki=Math.round(Yt[0]/Yt[2]*Kt),Ti=Math.round(Yt[1]/Yt[2]*Kt);te.emplaceBack(ut,ft,ki,Ti)},Bt=a[3].x-a[0].x,St=a[3].y-a[0].y,Nt=a[2].x-a[1].x,Gt=a[2].y-a[1].y;for(let pt=0;pt<65;pt++){const Ot=pt/64,ut=[a[0].x+Ot*Bt,a[0].y+Ot*St],ft=[a[1].x+Ot*Nt,a[1].y+Ot*Gt],Zt=ft[0]-ut[0],Yt=ft[1]-ut[1];for(let ki=0;ki<65;ki++){const Ti=ki/64,ai={x:ut[0]+Zt*Ti,y:ut[1]+Yt*Ti};dt(i.projection.unproject(ai.x,ai.y),ai)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(te,J0.members)}{this.maxLongitudeTriangleSize=0;let te=[],ce=new ls;const he=(Y,le,de)=>{ce.emplaceBack(Y,le,de);const be=R[Y],Fe=R[le],ze=R[de],Be=Math.min(Math.min(be,Fe),ze),We=Math.max(Math.max(be,Fe),ze)-Be;We>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=We),te.push(Be+We/2)};for(let Y=0;Y<64;Y++)for(let le=0;le<64;le++){const de=65*Y+le,be=de+1,Fe=de+65,ze=Fe+1;he(de,Fe,be),he(be,Fe,ze)}[te,ce]=function(Y,le){const de=Array.from({length:Y.length},(ze,Be)=>Be);de.sort((ze,Be)=>Y[ze]-Y[Be]);const be=[],Fe=new ls;for(let ze=0;ze<de.length;ze++){const Be=de[ze];be.push(Y[Be]);const We=3*Be,dt=We+1;Fe.emplaceBack(le.uint16[We],le.uint16[dt],le.uint16[dt+1])}return[be,Fe]}(te,ce),this.elevatedGlobeTrianglesCenterLongitudes=te,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ce)}this.elevatedGlobeSegments=kr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Z/Kt,0,K/Kt,0,0,G,j,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,a=i.gl;!this._dirty||this.texture instanceof hv||(this.texture?this.texture.update(this.image):(this.texture=new ix(i,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let c=(p=e+180)+360*Math.round((a[0]-p)/360);var p;const m=new kr,v=(D,P)=>{m.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:i.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-c)<=T){const D=Fr(a,0,a.length,c+T);return D===a.length||v(D,fr(a,D+1,a.length,c+360-T)-D),m}c<a[0]&&(c+=360);const E=fr(a,0,a.length,c-T);if(E===a.length)return v(0,a.length),m;v(0,E-0);const R=Fr(a,E+1,a.length,c+T);return R!==a.length&&v(R,a.length-R),m}}const fI=(Math.pow(256,2)-1)/16907520;class Qw extends da{constructor(e,i,a,c){super(e,{layout:Ww||(Ww=new zr({visibility:new Ut(Ye.layout_raster.visibility)})),paint:Xw||(Xw=new zr({"raster-opacity":new Ut(Ye.paint_raster["raster-opacity"]),"raster-color":new Yl(Ye.paint_raster["raster-color"]),"raster-color-mix":new Ut(Ye.paint_raster["raster-color-mix"]),"raster-color-range":new Ut(Ye.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ut(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ut(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ut(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Ut(Ye.paint_raster["raster-saturation"]),"raster-contrast":new Ut(Ye.paint_raster["raster-contrast"]),"raster-resampling":new Ut(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Ut(Ye.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ut(Ye.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ut(Ye.paint_raster["raster-array-band"]),"raster-elevation":new Ut(Ye.paint_raster["raster-elevation"]),"raster-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},i,a,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Kw&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[a,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(c)||a===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=em({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,c])}}let Jw,eT,tT,iT,nT;class rT extends da{constructor(e,i,a,c){super(e,{layout:Jw||(Jw=new zr({visibility:new Ut(Ye["layout_raster-particle"].visibility)})),paint:eT||(eT=new zr({"raster-particle-array-band":new Ut(Ye["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ut(Ye["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Yl(Ye["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ut(Ye["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ut(Ye["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ut(Ye["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ut(Ye["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ut(Ye["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},i,a,c),this._updateColorRamp(),this.lastInvalidatedAt=ba.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=em({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ba.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class pI extends da{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function nx(n,e,i){const a=[0,0,1],c=Jr([]);return Ja(c,c,i?-wn(n)+Math.PI:wn(n)),Ao(c,c,-wn(e)),In(a,a,c),at(a,a)}function sT(n,e){const i=pv(n.projection,n.zoom,n.width,n.height),a=function(p,m,v,T,E){const R=new oe(v.lng-180*lp,v.lat),D=new oe(v.lng+180*lp,v.lat),P=p.project(R.lng,R.lat),j=p.project(D.lng,D.lat),G=-Math.atan2(j.y-P.y,j.x-P.x),Z=Ge.fromLngLat(v);Z.y=Me(Z.y,-1+lp,1-lp);const K=Z.toLngLat(),te=p.project(K.lng,K.lat),ce=Ge.fromLngLat(K);ce.x+=lp;const he=ce.toLngLat(),Y=p.project(he.lng,he.lat),le=oT(Y.x-te.x,Y.y-te.y,G),de=Ge.fromLngLat(K);de.y+=lp;const be=de.toLngLat(),Fe=p.project(be.lng,be.lat),ze=oT(Fe.x-te.x,Fe.y-te.y,G),Be=Math.abs(le.x)/Math.abs(ze.y),We=me([]);ht(We,We,-G*(1-(E?0:T)));const dt=me([]);return se(dt,dt,[1,1-(1-Be)*T,1]),dt[4]=-ze.x/ze.y*T,ht(dt,dt,G),pe(dt,We,dt),dt}(n.projection,0,n.center,i,e),c=aT(n);return se(a,a,[c,c,1]),a}function aT(n){const e=n.projection,i=pv(n.projection,n.zoom,n.width,n.height),a=rx(e,n.center),c=rx(e,oe.convert(e.center));return Math.pow(2,a*i+(1-i)*c)}function pv(n,e,i,a,c=1/0){const p=n.range;if(!p)return 0;const m=Math.min(c,Math.max(i,a)),v=Math.log(m/1024)/Math.LN2;return He(p[0]+v,p[1]+v,e)}const lp=1/4e4;function rx(n,e){const i=Me(e.lat,-85.051129,mt),a=new oe(e.lng-180*lp,i),c=new oe(e.lng+180*lp,i),p=n.project(a.lng,i),m=n.project(c.lng,i),v=Ge.fromLngLat(a),T=Ge.fromLngLat(c),E=m.x-p.x,R=m.y-p.y,D=T.x-v.x,P=T.y-v.y,j=Math.sqrt((D*D+P*P)/(E*E+R*R));return Math.log(j)/Math.LN2}function oT(n,e,i){const a=Math.cos(i),c=Math.sin(i);return{x:n*a-e*c,y:n*c+e*a}}function lT(n,e,i){me(n),ht(n,n,wn(e[2])),De(n,n,wn(e[0])),we(n,n,wn(e[1])),se(n,n,i),pe(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function mv(n,e,i,a,c,p,m,v){const T=[i[0]-e[0],i[1]-e[1],0],E=[a[0]-e[0],a[1]-e[1],0];if(Lt(T)<1e-12||Lt(E)<1e-12)return Jr(n);const R=_i([],T,E);at(R,R),Qe(E,a,e),T[2]=(p-c)*v,E[2]=(m-c)*v;const D=T;return _i(D,T,E),at(D,D),Dl(n,R,D)}function sx(n,e,i=!1){const a=qu(e.zoom),c=function(p,m,v){const T=m.worldSize,E=[p[12],p[13],p[14]],R=Ke(E[1]/T),D=Ne(E[0]/T),P=me([]),j=Pe(1,R)*T,G=Pe(1,0)*T*Pt(R,m.zoom),Z=1/Gm(T);let K=G*Z;if(v){const Y=pv(m.projection,m.zoom,m.width,m.height,1024);K=Z*m.projection.pixelSpaceConversion(m.center.lat,T,Y)}const te=X(R,D);Et(te,te,Ve([],at([],te),j*K*E[2]));const ce=function(Y){const le=[Y[0],Y[1],Y[2]];let de=[0,1,0];const be=_i([],de,le);return _i(de,le,be),li(de)===0&&(de=[0,1,0],_i(be,le,de)),at(be,be),at(de,de),at(le,le),[be[0],be[1],be[2],0,de[0],de[1],de[2],0,le[0],le[1],le[2],0,Y[0],Y[1],Y[2],1]}(te);se(P,P,[K,K,K*j]),fe(P,P,[-E[0],-E[1],-E[2]]);const he=pe([],m.globeMatrix,ce);return pe(he,he,P),pe(he,he,p),he}(n,e,i);if(a>0){const p=function(m,v){const T=v.worldSize,E=Pe(1,0)*T*Pt(v.center.lat,v.zoom)/Gm(T),R=Pe(1,v.center.lat)*T,D=me([]);return we(D,D,wn(v.center.lng)),De(D,D,wn(v.center.lat)),fe(D,D,[0,0,b]),se(D,D,[E,E,E*R]),fe(D,D,[v.point.x-.5*T,v.point.y-.5*T,0]),pe(D,D,m),pe(D,v.globeMatrix,D)}(n,e);return function(m,v,T){const E=(G,Z,K)=>{const te=Lt(G),ce=Lt(Z),he=Hu(G,Z,K);return Ve(he,he,1/Lt(he)*zi(te,ce,K))},R=E([m[0],m[1],m[2]],[v[0],v[1],v[2]],T),D=E([m[4],m[5],m[6]],[v[4],v[5],v[6]],T),P=E([m[8],m[9],m[10]],[v[8],v[9],v[10]],T),j=Hu([m[12],m[13],m[14]],[v[12],v[13],v[14]],T);return[R[0],R[1],R[2],0,D[0],D[1],D[2],0,P[0],P[1],P[2],0,j[0],j[1],j[2],1]}(c,p,a)}return c}function cT(n,e,i,a){const c=An.projectAabbCorners(a,i);let p=Number.MAX_VALUE,m=-1;for(let E=0;E<c.length;++E){const R=c[E];R[0]=(.5*R[0]+.5)*e.width,R[1]=(.5-.5*R[1])*e.height,R[2]<p&&(m=E,p=R[2])}const v=E=>new Qt(c[E][0],c[E][1]);let T;switch(m){case 0:case 6:T=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:T=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:T=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:T=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(Ra(n,T))return p}const mI=En([{name:"a_pos_3f",components:3,type:"Float32"}]),gI=En([{name:"a_color_3f",components:3,type:"Float32"}]),_I=En([{name:"a_color_4f",components:4,type:"Float32"}]),yI=En([{name:"a_uv_2f",components:2,type:"Float32"}]),vI=En([{name:"a_normal_3f",components:3,type:"Float32"}]),xI=En([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),bI=En([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),uT={None:0,Model:1,Symbol:2,FillExtrusion:4};class gv{constructor(e,i,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function ax(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class hT{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class dT{constructor(){this.instancedDataArray=new Vu,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class ox{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,a,c){this.tileToMeter=lt(a);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:v,index:T,sourceLayerIndex:E}of e){const R=v??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),D=hi(m,p);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom,{worldview:this.worldview}),D,a))continue;const P={id:R,sourceLayerIndex:E,index:T,geometry:p?D.geometry:di(m,a,c),properties:m.properties,type:m.type,patterns:{}},j=this.addFeature(P,P.geometry,D);j&&i.featureIndex.insert(m,P.geometry,T,E,this.index,this.instancesPerModel[j].instancedDataArray.length,Kt/32)}this.lookup=null}update(e,i,a,c){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const v in e)m.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(m.features[m.idToFeaturesIndex[v]],e[v],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];for(const c of a.features){const p=this.layers[0],m=c.feature,v=this.canonical,T=p.paint.get("model-rotation").evaluate(m,{},v),E=p.paint.get("model-scale").evaluate(m,{},v),R=p.paint.get("model-translation").evaluate(m,{},v);Rn(c.rotation,T)&&Rn(c.scale,E)&&Rn(c.translation,R)||(this.evaluate(c,c.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,i,a,c){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const p=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(tp(this.activeReplacements,p))return!1;this.activeReplacements=p;let m=!1;for(const v in this.instancesPerModel){const T=this.instancesPerModel[v],E=T.instancedDataArray;for(const R of T.features){const D=R.instancedDataOffset,P=R.instancedDataCount;for(let j=0;j<P;j++){const G=16*(j+D);let Z=E.float32[G+0];const K=Z>Kt;Z=K?Z-Kt:Z;const te=Math.floor(Z),ce=E.float32[G+1];let he=!1;for(const Y of this.activeReplacements)if(!Fy(Y,a,uT.Model,c)&&!(Y.min.x>te||te>Y.max.x||Y.min.y>ce||ce>Y.max.y)&&(he=h_(u_(te,ce,e.canonical,Y.footprintTileId.canonical),Y.footprint),he))break;E.float32[G]=he?Z+Kt:Z,m=m||he!==K}}}return m}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,xI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,a){const c=this.layers[0],p=c.layout.get("model-id").evaluate(a,{},this.canonical);if(!p)return Yi(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),p;(ax(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new dT);const m=this.instancesPerModel[p],v=m.instancedDataArray,T=new hT(a,v.length);for(const E of i)for(const R of E){if(R.x<0||R.x>=Kt||R.y<0||R.y>=Kt)continue;const D=(this.lookupDim-1)/Kt,P=this.lookupDim*(R.y*D|0)+R.x*D|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}this.instanceCount++;const j=v.length;v.resize(j+1),m.instancesEvaluatedElevation.push(0),v.float32[16*j]=R.x,v.float32[16*j+1]=R.y}return T.instancedDataCount=m.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(T),this.evaluate(T,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(e,i,a,c){const p=this.layers[0],m=e.feature,v=this.canonical,T=e.rotation=p.paint.get("model-rotation").evaluate(m,i,v),E=e.scale=p.paint.get("model-scale").evaluate(m,i,v),R=e.translation=p.paint.get("model-translation").evaluate(m,i,v),D=p.paint.get("model-color").evaluate(m,i,v);D.a=p.paint.get("model-color-mix-intensity").evaluate(m,i,v);const P=[];this.maxVerticalOffset<R[2]&&(this.maxVerticalOffset=R[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),lT(P,T,E);const j=Math.round(100*D.a)+D.b/1.05;for(let G=0;G<e.instancedDataCount;++G){const Z=e.instancedDataOffset+G,K=16*Z,te=a.instancedDataArray.float32;let ce=0;c&&(ce=te[K+6]-a.instancesEvaluatedElevation[Z]);const he=0|te[K+1];te[K]=(0|te[K])+D.r/1.05,te[K+1]=he+D.g/1.05,te[K+2]=j,te[K+3]=1/(v.z>10?this.tileToMeter:lt(v,he)),te[K+4]=R[0],te[K+5]=R[1],te[K+6]=R[2]+ce,te[K+7]=P[0],te[K+8]=P[1],te[K+9]=P[2],te[K+10]=P[4],te[K+11]=P[5],te[K+12]=P[6],te[K+13]=P[8],te[K+14]=P[9],te[K+15]=P[10],a.instancesEvaluatedElevation[Z]=R[2]}}}let fT,pT;mi(ox,"ModelBucket",{omit:["layers"]}),mi(dT,"PerModelAttributes"),mi(hT,"ModelFeature");const gm=64,mg={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function mT(n,e,i,a,c,p,m,v,T,E=!1){const R=i.zoom,D=i.project(a),P=Pt(a.lat,R),j=1/P;me(n),fe(n,n,[D.x+m[0]*j,D.y+m[1]*j,m[2]]);let G=1,Z=1;const K=i.worldSize;if(E){if(i.projection.name==="mercator"){let Y=0;i.elevation&&(Y=i.elevation.getAtPointOrZero(new Ge(D.x/K,D.y/K),0));const le=Or([],[D.x,D.y,Y,1],i.projMatrix)[3]/i.cameraToCenterDistance;G=le,Z=le*Pt(i.center.lat,R)}else if(i.projection.name==="globe"){const Y=sx(n,i),le=[0,0,0,1];Or(le,le,pe([],i.projMatrix,Y));const de=le[3]/i.cameraToCenterDistance,be=qu(R),Fe=i.projection.pixelsPerMeter(a.lat,K)*Pt(a.lat,R),ze=i.projection.pixelsPerMeter(i.center.lat,K)*Pt(i.center.lat,R);G=de/zi(Fe,xt(i.center.lat),be),Z=de*P/Fe,G*=ze,Z*=ze}}else G=j;se(n,n,[G,G,Z]);const te=[...n],ce=e.orientation,he=[];if(lT(he,[ce[0]+c[0],ce[1]+c[1],ce[2]+c[2]],p),pe(n,te,he),v&&i.elevation){let Y=0;const le=[];if(T&&i.elevation){Y=function(be,Fe,ze,Be,We){const dt=Fe.elevation;if(!dt)return 0;const Bt=An.projectAabbCorners(ze,Be),St=Pe(1,We.lat)*Fe.worldSize,Nt=function($t,Xi){const wi=[0,0,1],Ei=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Hi of Ei){const sn=$t[Hi.corners[0]],nn=$t[Hi.corners[1]],fn=$t[Hi.corners[2]],an=[nn[0]-sn[0],nn[1]-sn[1],Xi*(nn[2]-sn[2])],pn=_i(an,an,[fn[0]-sn[0],fn[1]-sn[1],Xi*(fn[2]-sn[2])]);at(pn,pn),Hi.dotProductWithUp=Rt(pn,wi)}return Ei.sort((Hi,sn)=>Hi.dotProductWithUp-sn.dotProductWithUp),Ei[0].corners}(Bt,St),Gt=Bt[Nt[0]],pt=Bt[Nt[1]],Ot=Bt[Nt[2]],ut=Bt[Nt[3]],ft=dt.getAtPointOrZero(new Ge(Gt[0]/Fe.worldSize,Gt[1]/Fe.worldSize),0),Zt=dt.getAtPointOrZero(new Ge(pt[0]/Fe.worldSize,pt[1]/Fe.worldSize),0),Yt=dt.getAtPointOrZero(new Ge(Ot[0]/Fe.worldSize,Ot[1]/Fe.worldSize),0),ki=dt.getAtPointOrZero(new Ge(ut[0]/Fe.worldSize,ut[1]/Fe.worldSize),0),Ti=(ft+ki)/2,ai=(Zt+Yt)/2;return Ti>ai?Zt<Yt?mv(be,pt,ut,Gt,Zt,ki,ft,St):mv(be,Ot,Gt,ut,Yt,ft,ki,St):ft<ki?mv(be,Gt,pt,Ot,ft,Zt,Yt,St):mv(be,ut,Ot,pt,ki,Yt,Zt,St),Math.max(Ti,ai)}(le,i,e.aabb,n,a);const de=pe([],Xe([],le),he);pe(n,te,de)}else Y=i.elevation.getAtPointOrZero(new Ge(D.x/K,D.y/K),0);Y!==0&&(n[14]+=Y)}}function M_(n,e,i=!1){n.uploaded||(n.gfxTexture=new ix(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function wI(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,mI.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,vI.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,yI.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?gI:_I).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,bI.members,!0)),n.segments=kr.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const a=n.material;a.pbrMetallicRoughness.baseColorTexture&&M_(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&M_(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&M_(a.normalTexture,e),a.occlusionTexture&&M_(a.occlusionTexture,e,i),a.emissionTexture&&M_(a.emissionTexture,e)}function lx(n,e,i){if(n.meshes)for(const a of n.meshes)wI(a,e,i);if(n.children)for(const a of n.children)lx(a,e,i)}function _v(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)_v(e)}function cx(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)cx(i)}class gg{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const c=a||e.findDEMTileFor(i);if(!c||!c.dem)return;const p=c.dem,m=c.tileID,v=1<<i.canonical.z-m.canonical.z;return new gg(c,p.dim/Kt/v,[(i.canonical.x/v-m.canonical.x)*p.dim,(i.canonical.y/v-m.canonical.y)*p.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(a);return new Qt(c,p)}getElevationAt(e,i,a,c){const p=e*this._scale+this._offset[0],m=i*this._scale+this._offset[1],v=Math.floor(p),T=Math.floor(m),E=this._dem;return c=!!c,a?zi(zi(E.get(v,T,c),E.get(v,T+1,c),m-T),zi(E.get(v+1,T,c),E.get(v+1,T+1,c),m-T),p-v):E.get(v,T,c)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Pe(1,e)*this._dem.stride}}const ux=new Float32Array(262144),_m=new Uint8Array(262144);function gT(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,gT(i));return e}function _T(n,e,i){if(n.meshes)for(const a of n.meshes){if(a.aabb.min[0]===1/0)continue;const c=An.applyTransform(a.aabb,n.matrix);i.insert(e,c.min[0],c.min[1],c.max[0],c.max[1])}if(n.children)for(const a of n.children)_T(a,e,i)}const yT=["","wall","door","roof","window","lamp","logo"];class vT{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:gT(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=An.applyTransformFast(a.aabb,this.node.matrix),i.encapsulate(a.transformedAabb)),e++;this.aabb=i}return this.aabb}}class yv{constructor(e,i,a,c,p,m,v,T){this.id=a,this.layers=e,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=mg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=mg.HasMapboxMeshFeatures),p&&(this.modelTraits|=mg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.worldview=T,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const E of i)this.nodesInfo.push(new vT(E)),_T(E,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const a of this.getNodesInfo()){const c=a.node;c.footprint&&i.push({footprint:c.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const a=i?this.stateDependentLayers:this.layers;if(!io(e,this.states))for(const c of a)this.evaluate(c,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const a of i){const c=a.node;this.uploaded?this.updatePbrBuffer(c):lx(c,e,!0)}for(const a of i)_v(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),i=!0);return i}needsReEvaluation(e,i,a){const c=e.transform.projectionOptions,p=e.style.getBrightness(),m=this.brightness!==p;if(!this.uploaded||this.dirty||c.name!==this.projection.name||I_(a.paint.get("model-color").value,m)||I_(a.paint.get("model-color-mix-intensity").value,m)||I_(a.paint.get("model-roughness").value,m)||I_(a.paint.get("model-emissive-strength").value,m)||I_(a.paint.get("model-height-based-emissive-strength-multiplier").value,m)){this.projection=c,this.brightness=p;const v=this.getNodesInfo();for(const T of v)T.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),c=this.id.canonical;for(const p of a){const m=p.feature;p.evaluatedTranslation=i.paint.get("model-translation").evaluate(m,{},c),p.evaluatedScale=i.paint.get("model-scale").evaluate(m,{},c)}}evaluate(e,i){const a=this.getNodesInfo();for(const c of a){if(!c.node.meshes)continue;const p=c.feature,m=i&&i[p.id];if(io(m,c.state))continue;c.state=structuredClone(m);const v=c.node.meshes&&c.node.meshes[0].featureData,T=c.evaluatedColor[2],E=c.evaluatedRMEA[2],R=this.id.canonical;if(c.hasTranslucentParts=!1,v){for(let D=0;D<yT.length;D++){const P=yT[D];P.length&&(p.properties.part=P);const j=e.paint.get("model-color").evaluate(p,m,R).toPremultipliedRenderColor(null),G=e.paint.get("model-color-mix-intensity").evaluate(p,m,R);c.evaluatedColor[D]=[j.r,j.g,j.b,G],c.evaluatedRMEA[D][0]=e.paint.get("model-roughness").evaluate(p,m,R),c.evaluatedRMEA[D][2]=e.paint.get("model-emissive-strength").evaluate(p,m,R),c.evaluatedRMEA[D][3]=j.a,c.emissionHeightBasedParams[D]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,m,R),!c.hasTranslucentParts&&j.a<1&&(c.hasTranslucentParts=!0)}delete p.properties.part,SI(c,T!==c.evaluatedColor[2]||E!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,m,R);c.evaluatedTranslation=e.paint.get("model-translation").evaluate(p,m,R),c.evaluatedScale=e.paint.get("model-scale").evaluate(p,m,R),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,a,c){const p=e.findDEMTileFor(a);if(p&&(p.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=gg.create(e,a,p);if(!m)return;this.modelTraits&mg.HasMapboxMeshFeatures&&this.updateDEM(e,m,a,c);for(const v of this.getNodesInfo()){const T=v.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const E=T.footprint.vertices;let R=m.getElevationAt(E[0].x,E[0].y,!0,!0);for(let D=1;D<E.length;D++)R=Math.min(R,m.getElevationAt(E[D].x,E[D].y,!0,!0));T.elevation=R}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,a,c){let p=i._dem._modifiedForSources[c];if(p===void 0&&(i._dem._modifiedForSources[c]=[],p=i._dem._modifiedForSources[c]),p.includes(a.canonical))return;const m=i._dem.dim;p.push(a.canonical);let v=!1;for(const T of this.getNodesInfo()){const E=T.node;if(!E.footprint||!E.footprint.grid)continue;const R=E.footprint.grid,D=i.tileCoordToPixel(R.min.x,R.min.y),P=i.tileCoordToPixel(R.max.x,R.max.y),j=Math.min(Math.min(m-P.y,D.x),Math.min(D.y,m-P.x));if(j<0)continue;const G=Me(j,2,5);let Z=Math.max(0,D.x-G),K=Math.max(0,D.y-G),te=Math.min(P.x+G,m-1),ce=Math.min(P.y+G,m-1);for(let de=K;de<=ce;++de)for(let be=Z;be<=te;++be)_m[de*m+be]=255;let he=0,Y=0;for(let de=0;de<R.cellsY;++de)for(let be=0;be<R.cellsX;++be){if(!R.cells[de*R.cellsX+be])continue;const Fe=i.tileCoordToPixel(R.min.x+be/R.xScale,R.min.y+de/R.yScale),ze=i.tileCoordToPixel(R.min.x+(be+1)/R.xScale,R.min.y+(de+1)/R.yScale);for(let Be=Fe.y;Be<=Math.min(ze.y+1,m-1);++Be)for(let We=Fe.x;We<=Math.min(ze.x+1,m-1);++We)_m[Be*m+We]===255&&(_m[Be*m+We]=0,he+=i.getElevationAtPixel(We,Be),Y++)}const le=he/Y;Z=Math.max(1,D.x-G),K=Math.max(1,D.y-G),te=Math.min(P.x+G,m-2),ce=Math.min(P.y+G,m-2),v=!0;for(let de=K;de<=ce;++de)for(let be=Z;be<=te;++be)_m[de*m+be]===0&&(ux[de*m+be]=i._dem.set(be,de,le));for(let de=1;de<G;++de){Z=Math.max(1,D.x-de),K=Math.max(1,D.y-de),te=Math.min(P.x+de,m-2),ce=Math.min(P.y+de,m-2);for(let be=K;be<=ce;++be)for(let Fe=Z;Fe<=te;++Fe){const ze=be*m+Fe;if(_m[ze]===255){let Be=0,We=0,dt=-1,Bt=-1;for(let St=-1;St<=1;++St)for(let Nt=-1;Nt<=1;++Nt){const Gt=(be+St)*m+Fe+Nt;if(_m[Gt]>=de)continue;const pt=ux[Gt],Ot=Math.abs(pt);Ot>We&&(Be=pt,We=Ot,dt=Nt,Bt=St)}if(We>.1){const St=1-(de+.5*Math.abs(dt*Bt))/G;let Nt=i._dem.get(Fe,be)+Be*St;const Gt=i._dem.get(Fe+dt,be+Bt),pt=i._dem.get(Fe-dt,be-Bt,!0);(Nt-Gt)*(Nt-pt)>0&&(Nt=(Gt+pt)/2),ux[ze]=i._dem.set(Fe,be,Nt),_m[ze]=de}}}}}v&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ba.now())}setFilter(e){this.filter=e?Rf(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Kn(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)_v(i.node),cx(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());for(const c of this.getNodesInfo()){const p=c.node.footprint;c.hiddenByReplacement=!!p&&!a.find(m=>m.footprint===p)}}getHeightAtTileCoord(e,i){const a=[],c=[0,0,0],p=me([]);for(const m of this.getNodesInfo()){const v=m.node.meshes[0],T=v.transformedAabb;if(e<T.min[0]||i<T.min[1]||e>T.max[0]||i>T.max[1])continue;if(m.node.hidden===!0)return{height:1/0,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};ge(p,m.node.matrix),c[0]=e,c[1]=i,ei(c,c,p);const E=(c[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*gm|0,R=Math.min(63,(c[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*gm|0)*gm+Math.min(63,E),D=v.heightmap[R];if(!(D<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:D,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new Qt(e,i),new Qt(e,i),a),a.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function I_(n,e){return n instanceof Ul&&!n.isLightConstant&&e}function TI(n,e,i,a,c,p,m,v){let T=(61440&e|(61440&e)>>4)>>8,E=(3840&e|(3840&e)>>4)>>4,R=240&e|(240&e)>>4;i[3]>0&&(T=zi(T,255*i[0],i[3]),E=zi(E,255*i[1],i[3]),R=zi(R,255*i[2],i[3]));const D=T<<8|E,P=R<<8|Math.floor(255*a[3]),j=function(de){const be=Me(de,0,2);return Math.min(Math.round(.5*be*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],G=Me(c[0],0,1),Z=Me(c[1],0,1),K=Me(c[2],0,1),te=Me(c[3],0,1);let ce,he,Y,le;if(G!==Z&&m!==p&&Z!==G){const de=m-p;he=1/(de*(Z-G)),Y=-(p+de*G)/(de*(Z-G));const be=Me(c[4],-1,1);le=Math.pow(10,be),ce=255*K<<8|255*te}else ce=65535,he=0,Y=1,le=1;if(n.emplaceBack(D,P,j,ce,he,Y,le),v){const de=v.length;v.clear();for(let be=0;be<de;be++)v.emplaceBack(D,P,j,ce,he,Y,le)}}function SI(n,e,i){const a=n.node;let c=0;const p=i&mg.HasMeshoptCompression;for(const m of a.meshes){if(a.lights&&a.lightMeshIndex===c||!m.featureData)continue;m.featureArray=new ru,m.featureArray.reserve(m.featureData.length);let v=e;for(const T of m.featureData){const E=p?65535&T:T>>16&65535,R=p?T>>16&65535:65535&T,D=(15&R)<8?15&R:0,P=n.evaluatedRMEA[D],j=n.evaluatedColor[D],G=n.emissionHeightBasedParams[D];let Z;if(v&&D===2&&a.lights&&(Z=new ru,Z.resize(10*a.lights.length)),TI(m.featureArray,E,j,P,G,m.aabb.min[2],m.aabb.max[2],Z),Z&&v){v=!1;const K=a.meshes[a.lightMeshIndex];K.featureArray=Z,K.featureArray._trim()}}m.featureArray._trim(),c++}}function xT(n,e,i,a){const c=1<<n.z;e.lat=Ke((a/Kt+n.y)/c),e.lng=Ne((i/Kt+n.x)/c)}function EI(n,e,i,a){const c=n.getNodesInfo()[e];if(!c||c.hiddenByReplacement||!c.node.meshes)return;let p=Number.MAX_VALUE;const m=c.node,v=i.tile,T=a.calculatePosMatrix(v.tileID.toUnwrapped(),a.worldSize),E=c.evaluatedScale;let R=0;a.elevation&&m.elevation&&(R=m.elevation*a.elevation.exaggeration()),fe(T,T,[(m.anchor?m.anchor[0]:0)*(E[0]-1),(m.anchor?m.anchor[1]:0)*(E[1]-1),R]),se(T,T,E);const D=i.queryGeometry,P=D.isPointQuery()?D.screenBounds:D.screenGeometry,j=function(Z){const K=pe([],T,Z.matrix);pe(K,a.expandedFarZProjMatrix,K);for(let te=0;te<Z.meshes.length;++te){const ce=Z.meshes[te];if(te===Z.lightMeshIndex)continue;const he=cT(P,a,K,ce.aabb);he!=null&&(p=Math.min(he,p))}if(Z.children)for(const te of Z.children)j(te)};if(j(m),p===Number.MAX_VALUE)return;const G=new oe(0,0);return xT(v.tileID.canonical,G,c.node.anchor[0],c.node.anchor[1]),{intersectionZ:p,position:G,feature:c.feature}}mi(yv,"Tiled3dModelBucket",{omit:["layers"]}),mi(vT,"Tiled3dModelFeature");const AI={circle:class extends da{constructor(n,e,i,a){super(n,{layout:Hg||(Hg=new zr({"circle-sort-key":new ni(Ye.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ut(Ye.layout_circle["circle-elevation-reference"]),visibility:new Ut(Ye.layout_circle.visibility)})),paint:Bd||(Bd=new zr({"circle-radius":new ni(Ye.paint_circle["circle-radius"]),"circle-color":new ni(Ye.paint_circle["circle-color"]),"circle-blur":new ni(Ye.paint_circle["circle-blur"]),"circle-opacity":new ni(Ye.paint_circle["circle-opacity"]),"circle-translate":new Ut(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Ut(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ut(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ut(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ni(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ni(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ni(Ye.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ut(Ye.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}createBucket(n){return new Za(n)}queryRadius(n){const e=n;return $f("circle-radius",this,e)+$f("circle-stroke-width",this,e)+Um(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,a,c,p,m,v){const T=Gg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Ty(n,a,p,m,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const a=Hm(this);return{config:new co(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends da{createBucket(n){return new br(n)}constructor(n,e,i,a){super(n,{layout:qm||(qm=new zr({visibility:new Ut(Ye.layout_heatmap.visibility)})),paint:Jp||(Jp=new zr({"heatmap-radius":new ni(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ni(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ut(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yl(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ut(Ye.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=em({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return $f("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,a,c,p,m,v){const T=this.paint.get("heatmap-radius").evaluate(e,i);return Ty(n,a,p,m,v,!0,!0,new Qt(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new co(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends da{constructor(n,e,i,a){super(n,{layout:$m||($m=new zr({visibility:new Ut(Ye.layout_hillshade.visibility)})),paint:e_||(e_=new zr({"hillshade-illumination-direction":new Ut(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ut(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ut(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ut(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ut(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ut(Ye.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ut(Ye.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends da{constructor(n,e,i,a){super(n,{layout:Jf||(Jf=new zr({"fill-sort-key":new ni(Ye.layout_fill["fill-sort-key"]),visibility:new Ut(Ye.layout_fill.visibility),"fill-elevation-reference":new Ut(Ye.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new ni(Ye.layout_fill["fill-construct-bridge-guard-rail"])})),paint:o_||(o_=new zr({"fill-antialias":new Ut(Ye.paint_fill["fill-antialias"]),"fill-opacity":new ni(Ye.paint_fill["fill-opacity"]),"fill-color":new ni(Ye.paint_fill["fill-color"]),"fill-outline-color":new ni(Ye.paint_fill["fill-outline-color"]),"fill-translate":new Ut(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Ut(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new ni(Ye.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Ut(Ye.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Ut(Ye.paint_fill["fill-emissive-strength"]),"fill-z-offset":new ni(Ye.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new ni(Ye.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new ni(Ye.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new co(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Uh(n)}queryRadius(){return Um(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,a,c,p){return!n.queryGeometry.isAboveHorizon&&sl(my(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends da{constructor(n,e,i,a){super(n,{layout:ug||(ug=new zr({visibility:new Ut(Ye["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ut(Ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:dm||(dm=new zr({"fill-extrusion-opacity":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ni(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ni(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new ni(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ni(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ni(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ni(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ni(Ye["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ni(Ye["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ut(Ye["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new lm(n)}queryRadius(){return Um(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,a,c,p,m,v,T){const E=Gg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(e,i),D=this.paint.get("fill-extrusion-base").evaluate(e,i),P=[0,0],j=v&&p.elevation,G=p.elevation?p.elevation.exaggeration():1,Z=n.tile.getBucket(this);if(j&&Z instanceof lm){const Y=Z.centroidVertexArray,le=T+1;le<Y.length&&(P[0]=Y.geta_centroid_pos0(le),P[1]=Y.geta_centroid_pos1(le))}if(P[0]===0&&P[1]===1)return!1;p.projection.name==="globe"&&(a=m_([a],[new Qt(0,0),new Qt(Kt,Kt)],n.tileID.canonical).map(Y=>Y.polygon).flat());const K=j?v:null,[te,ce]=function(Y,le,de,be,Fe,ze,Be,We,dt,Bt,St){return Y.projection.name==="globe"?function(Nt,Gt,pt,Ot,ut,ft,Zt,Yt,ki,Ti,ai){const $t=[],Xi=[],wi=Nt.projection.upVectorScale(ai,Nt.center.lat,Nt.worldSize).metersToTile,Ei=[0,0,0,1],Hi=[0,0,0,1],sn=(fn,an,pn,Jn)=>{fn[0]=an,fn[1]=pn,fn[2]=Jn,fn[3]=1},nn=um();pt>0&&(pt+=nn),Ot+=nn;for(const fn of Gt){const an=[],pn=[];for(const Jn of fn){const wr=Jn.x+ut.x,ye=Jn.y+ut.y,Ee=Nt.projection.projectTilePoint(wr,ye,ai),yt=Nt.projection.upVector(ai,Jn.x,Jn.y);let Jt=pt,oi=Ot;if(Zt){const ri=ue(wr,ye,pt,Ot,Zt,Yt,ki,Ti);Jt+=ri.base,oi+=ri.top}pt!==0?sn(Ei,Ee.x+yt[0]*wi*Jt,Ee.y+yt[1]*wi*Jt,Ee.z+yt[2]*wi*Jt):sn(Ei,Ee.x,Ee.y,Ee.z),sn(Hi,Ee.x+yt[0]*wi*oi,Ee.y+yt[1]*wi*oi,Ee.z+yt[2]*wi*oi),ei(Ei,Ei,ft),ei(Hi,Hi,ft),an.push(new $h(Ei[0],Ei[1],Ei[2])),pn.push(new $h(Hi[0],Hi[1],Hi[2]))}$t.push(an),Xi.push(pn)}return[$t,Xi]}(Y,le,de,be,Fe,ze,Be,We,dt,Bt,St):Be?function(Nt,Gt,pt,Ot,ut,ft,Zt,Yt,ki){const Ti=[],ai=[],$t=[0,0,0,1];for(const Xi of Nt){const wi=[],Ei=[];for(const Hi of Xi){const sn=Hi.x+Ot.x,nn=Hi.y+Ot.y,fn=ue(sn,nn,Gt,pt,ft,Zt,Yt,ki);$t[0]=sn,$t[1]=nn,$t[2]=fn.base,$t[3]=1,Or($t,$t,ut),$t[3]=Math.max($t[3],1e-5);const an=new $h($t[0]/$t[3],$t[1]/$t[3],$t[2]/$t[3]);$t[0]=sn,$t[1]=nn,$t[2]=fn.top,$t[3]=1,Or($t,$t,ut),$t[3]=Math.max($t[3],1e-5);const pn=new $h($t[0]/$t[3],$t[1]/$t[3],$t[2]/$t[3]);wi.push(an),Ei.push(pn)}Ti.push(wi),ai.push(Ei)}return[Ti,ai]}(le,de,be,Fe,ze,Be,We,dt,Bt):function(Nt,Gt,pt,Ot,ut){const ft=[],Zt=[],Yt=ut[8]*Gt,ki=ut[9]*Gt,Ti=ut[10]*Gt,ai=ut[11]*Gt,$t=ut[8]*pt,Xi=ut[9]*pt,wi=ut[10]*pt,Ei=ut[11]*pt;for(const Hi of Nt){const sn=[],nn=[];for(const fn of Hi){const an=fn.x+Ot.x,pn=fn.y+Ot.y,Jn=ut[0]*an+ut[4]*pn+ut[12],wr=ut[1]*an+ut[5]*pn+ut[13],ye=ut[2]*an+ut[6]*pn+ut[14],Ee=ut[3]*an+ut[7]*pn+ut[15],yt=Jn+Yt,Jt=wr+ki,oi=ye+Ti,ri=Math.max(Ee+ai,1e-5),bi=Jn+$t,Gi=wr+Xi,vn=ye+wi,xn=Math.max(Ee+Ei,1e-5);sn.push(new $h(yt/ri,Jt/ri,oi/ri)),nn.push(new $h(bi/xn,Gi/xn,vn/xn))}ft.push(sn),Zt.push(nn)}return[ft,Zt]}(le,de,be,Fe,ze)}(p,a,D,R,E,m,K,P,G,p.center.lat,n.tileID.canonical),he=n.queryGeometry;return function(Y,le,de){let be=1/0;sl(de,le)&&(be=q(de,le[0]));for(let Fe=0;Fe<le.length;Fe++){const ze=le[Fe],Be=Y[Fe];for(let We=0;We<ze.length-1;We++){const dt=ze[We],Bt=[dt,ze[We+1],Be[We+1],Be[We],dt];Ra(de,Bt)&&(be=Math.min(be,q(de,Bt)))}}return be!==1/0&&be}(te,ce,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},building:class extends da{constructor(n,e,i,a){super(n,{layout:H1||(H1=new zr({visibility:new Ut(Ye.layout_building.visibility),"building-roof-shape":new ni(Ye.layout_building["building-roof-shape"]),"building-height":new ni(Ye.layout_building["building-height"]),"building-base":new ni(Ye.layout_building["building-base"])})),paint:q1||(q1=new zr({"building-opacity":new Ut(Ye.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new Ut(Ye.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new Ut(Ye.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Ut(Ye.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Ut(Ye.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Ut(Ye.paint_building["building-vertical-scale"]),"building-cast-shadows":new Ut(Ye.paint_building["building-cast-shadows"]),"building-color":new ni(Ye.paint_building["building-color"]),"building-emissive-strength":new ni(Ye.paint_building["building-emissive-strength"]),"building-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new G1(n)}},line:class extends da{constructor(n,e,i,a){const c=tw();super(n,c,e,i,a),c.layout&&(this.layout=new Lu(c.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof wc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(__)return __;const i=tw();return __=new TM(i.paint.properties["line-width"].specification),__.useIntegerZoom=!0,__})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new L0(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const a=J1(this);return{config:new co(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}queryRadius(n){const e=n,i=iw($f("line-width",this,e),$f("line-gap-width",this,e)),a=$f("line-offset",this,e);return i/2+Math.abs(a)+Um(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,a,c,p){if(n.queryGeometry.isAboveHorizon)return!1;const m=my(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),v=n.pixelToTileUnitsFactor/2*iw(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),T=this.paint.get("line-offset").evaluate(e,i);return T&&(a=function(E,R){const D=[],P=new Qt(0,0);for(let j=0;j<E.length;j++){const G=E[j],Z=[];for(let K=0;K<G.length;K++){const te=G[K],ce=G[K+1],he=K===0?P:te.sub(G[K-1])._unit()._perp(),Y=K===G.length-1?P:ce.sub(te)._unit()._perp(),le=he._add(Y)._unit();le._mult(1/(le.x*Y.x+le.y*Y.y)),Z.push(le._mult(R)._add(te))}D.push(Z)}return D}(a,T*n.pixelToTileUnitsFactor)),function(E,R,D){for(let P=0;P<R.length;P++){const j=R[P];if(E.length>=3){for(let G=0;G<j.length;G++)if(Al(E,j[G]))return!0}if($s(E,j,D))return!0}return!1}(m,a,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:uv,background:class extends da{constructor(n,e,i,a){super(n,{layout:$w||($w=new zr({visibility:new Ut(Ye.layout_background.visibility)})),paint:Zw||(Zw=new zr({"background-pitch-alignment":new Ut(Ye.paint_background["background-pitch-alignment"]),"background-color":new Ut(Ye.paint_background["background-color"]),"background-pattern":new Ut(Ye.paint_background["background-pattern"]),"background-opacity":new Ut(Ye.paint_background["background-opacity"]),"background-emissive-strength":new Ut(Ye.paint_background["background-emissive-strength"]),"background-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Qw,"raster-particle":rT,sky:class extends da{constructor(n,e,i,a){super(n,{layout:tT||(tT=new zr({visibility:new Ut(Ye.layout_sky.visibility)})),paint:iT||(iT=new zr({"sky-type":new Ut(Ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ut(Ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ut(Ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ut(Ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ut(Ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new Yl(Ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ut(Ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ut(Ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ut(Ye.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=em({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),c=!a,p=n.style.light,m=p.properties.get("position");return c&&p.properties.get("anchor")==="viewport"&&Yi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?nx(m.azimuthal,90-m.polar,e):nx(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return nx(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends da{constructor(n,e,i,a){super(n,{paint:nT||(nT=new zr({}))},e,null)}},model:class extends da{constructor(n,e,i,a){super(n,{layout:fT||(fT=new zr({visibility:new Ut(Ye.layout_model.visibility),"model-id":new ni(Ye.layout_model["model-id"])})),paint:pT||(pT=new zr({"model-opacity":new ni(Ye.paint_model["model-opacity"]),"model-rotation":new ni(Ye.paint_model["model-rotation"]),"model-scale":new ni(Ye.paint_model["model-scale"]),"model-translation":new ni(Ye.paint_model["model-translation"]),"model-color":new ni(Ye.paint_model["model-color"]),"model-color-mix-intensity":new ni(Ye.paint_model["model-color-mix-intensity"]),"model-type":new Ut(Ye.paint_model["model-type"]),"model-cast-shadows":new Ut(Ye.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ut(Ye.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ut(Ye.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ni(Ye.paint_model["model-emissive-strength"]),"model-roughness":new ni(Ye.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ni(Ye.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ut(Ye.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ut(Ye.paint_model["model-front-cutoff"]),"model-color-use-theme":new ni({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new ox(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof yv?Kt-1:0}queryIntersectsFeature(n,e,i,a,c,p){if(!this.modelManager)return!1;const m=this.modelManager,v=n.tile.getBucket(this);if(!(v&&v instanceof ox))return!1;for(const T in v.instancesPerModel){const E=v.instancesPerModel[T],R=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(R)){const D=E.features[E.idToFeaturesIndex[R]],P=m.getModel(T,this.scope);if(!P)return!1;let j=_e();const G=new oe(0,0),Z=v.canonical;let K=Number.MAX_VALUE;for(let te=0;te<D.instancedDataCount;++te){const ce=16*(D.instancedDataOffset+te),he=E.instancedDataArray.float32,Y=[he[ce+4],he[ce+5],he[ce+6]];xT(Z,G,he[ce],0|he[ce+1]),mT(j,P,p,G,D.rotation,D.scale,Y,!1,!1,!1),p.projection.name==="globe"&&(j=sx(j,p));const le=pe([],p.projMatrix,j),de=n.queryGeometry,be=cT(de.isPointQuery()?de.screenBounds:de.screenGeometry,p,le,P.aabb);be!=null&&(K=Math.min(be,K))}return K!==Number.MAX_VALUE&&K}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof xl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends da{constructor(n,e,i,a){super(n,{layout:Ly||(Ly=new zr({"clip-layer-types":new Ut(Ye.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ut(Ye.layout_clip["clip-layer-scope"])})),paint:Kd||(Kd=new zr({}))},e,i,a)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new rm(n)}is3D(n){return!0}}},hx=new ln(0,0,0),dx={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},fx={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},vv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},CI={PAINT_ORDER_FILL_AND_STROKE:1},R_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},bT={MASK_TYPE_LUMINANCE:1};function MI(n,e,i){n===1&&e.icons.push(function(a,c){return function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:m}=p;if(m.content_area){const{content_area:v}=m;v.top==null&&(v.top=v.left),v.width==null&&(v.width=p.usvg_tree.width),v.height==null&&(v.height=v.width)}return m.stretch_x&&m.stretch_x.length&&wT(m,"x"),m.stretch_y&&m.stretch_y.length&&wT(m,"y"),p}(a.readFields(II,{name:void 0},c))}(i,i.readVarint()+i.pos))}function wT(n,e){const i=[],a=n[`stretch_${e}`];let c=null;for(let p=0;p<a.length;p++)c===null?c=i.length===0?a[0]:i[i.length-1][1]+a[p]:(i.push([c,c+a[p]]),c=null);n[`stretch_${e}_areas`]=i}function II(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=function(a,c){return a.readFields(RI,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},c)}(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=function(a,c){return a.readFields(OI,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},c)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function RI(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=function(a,c){return a.readFields(DI,{left:0},c)}(i,i.readVarint()+i.pos):n===4&&e.variables.push(function(a,c){return a.readFields(PI,{name:void 0},c)}(i,i.readVarint()+i.pos))}function DI(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function PI(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=wv(i.readVarint()),e.value="rgb_color")}function OI(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(xv(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push(function(a,c){return a.readFields(jI,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},c)}(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push(function(a,c){return a.readFields(UI,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},c)}(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push(function(a,c){return a.readFields(GI,{children:[]},c)}(i,i.readVarint()+i.pos)):n===8&&e.masks.push(function(a,c){const p=a.readFields(HI,{left:0,width:20,mask_type:bT.MASK_TYPE_LUMINANCE,children:[]},c);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p}(i,i.readVarint()+i.pos))}function xv(n,e){return n.readFields(LI,{},e)}function LI(n,e,i){n===1?(e.group=function(a,c){return a.readFields(zI,{opacity:255,children:[]},c)}(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=function(a,c){return a.readFields(NI,{paint_order:1,commands:[],step:1,diffs:[],rule:dx.PATH_RULE_NON_ZERO},c)}(i,i.readVarint()+i.pos),e.node="path")}function zI(n,e,i){n===1?e.transform=bv(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(xv(i,i.readVarint()+i.pos))}function bv(n,e){return n.readFields(kI,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function kI(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function NI(n,e,i){n===1?e.fill=function(a,c){return a.readFields(FI,{rgb_color:hx,paint:"rgb_color",opacity:255},c)}(i,i.readVarint()+i.pos):n===2?e.stroke=function(a,c){return a.readFields(BI,{rgb_color:hx,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},c)}(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function FI(n,e,i){n===1?(e.rgb_color=wv(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function wv(n){return new ln((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function BI(n,e,i){n===1?(e.rgb_color=wv(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function jI(n,e,i){n===1?e.transform=bv(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(TT(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function TT(n,e){return n.readFields(VI,{offset:0,opacity:255,rgb_color:hx},e)}function VI(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=wv(i.readVarint()))}function UI(n,e,i){n===1?e.transform=bv(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(TT(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function GI(n,e,i){n===1?e.transform=bv(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(xv(i,i.readVarint()+i.pos))}function HI(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(xv(i,i.readVarint()+i.pos))}class qI{static calculate(e={},i=[]){const a=new Map,c=new Map;if(Object.keys(e).length===0)return a;i.forEach(p=>{c.set(p.name,p.rgb_color||new ln(0,0,0))});for(const[p,m]of Object.entries(e))c.has(p)?a.set(c.get(p).toString(),m):console.warn(`Ignoring unknown image variable "${p}"`);return a}}function _g(n,e=255,i){const a=e/255,c=n.toString(),p=i.has(c)?i.get(c).clone():n.clone();return p.a*=a,p.toString()}function D_(n,e){if(!ja()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function $I(n,e){const i=qI.calculate(e.params,n.metadata?n.metadata.variables:[]),a=n.usvg_tree,c=a.width,p=a.height,m=e.transform?e.transform:new DOMMatrix,v=Math.max(1,Math.round(c*m.a)),T=Math.max(1,Math.round(p*m.d)),E=new DOMMatrix([v/c,0,0,T/p,0,0]),R=D_(v,T).getContext("2d");return px(R,E,a,a,i),R.getImageData(0,0,v,T)}function px(n,e,i,a,c){for(const p of a.children)ST(n,e,i,p,c)}function ST(n,e,i,a,c){a.group?(n.save(),function(p,m,v,T,E){const R=T.mask_idx!=null?v.masks[T.mask_idx]:null,D=T.clip_path_idx!=null?v.clip_paths[T.clip_path_idx]:null;if(T.transform&&(m=yg(T.transform).preMultiplySelf(m)),!function(G,Z,K){return G.opacity!==255||Z||K}(T,D!=null,R!=null))return void px(p,m,v,T,E);const P=D_(p.canvas.width,p.canvas.height),j=P.getContext("2d");px(j,m,v,T,E),D&&DT(j,m,v,D),R&&PT(j,m,v,R,E),p.globalAlpha=T.opacity/255,p.drawImage(P,0,0)}(n,e,i,a.group,c),n.restore()):a.path&&(n.save(),function(p,m,v,T,E){p.setTransform(m),T.paint_order===CI.PAINT_ORDER_FILL_AND_STROKE?(ET(p,v,T,E),CT(p,v,T,E)):(CT(p,v,T,E),ET(p,v,T,E))}(n,e,i,a.path,c),n.restore())}function ET(n,e,i,a){const c=i.fill;if(!c)return;const p=c.opacity/255;switch(n.save(),n.beginPath(),OT(i,n),c.paint){case"rgb_color":n.fillStyle=_g(c.rgb_color,c.opacity,a);break;case"linear_gradient_idx":{const m=e.linear_gradients[c.linear_gradient_idx];m.transform&&n.setTransform(yg(m.transform).preMultiplySelf(n.getTransform())),n.fillStyle=MT(n,m,p,a);break}case"radial_gradient_idx":{const m=e.radial_gradients[c.radial_gradient_idx];m.transform&&n.setTransform(yg(m.transform).preMultiplySelf(n.getTransform())),n.fillStyle=IT(n,m,p,a)}}n.fill(AT(i)),n.restore()}function AT(n){return n.rule===dx.PATH_RULE_NON_ZERO?"nonzero":n.rule===dx.PATH_RULE_EVEN_ODD?"evenodd":void 0}function CT(n,e,i,a){const c=i.stroke;if(!c)return;const p=LT(i);n.lineWidth=c.width,n.miterLimit=c.miterlimit,n.setLineDash(c.dasharray),n.lineDashOffset=c.dashoffset;const m=c.opacity/255;switch(c.paint){case"rgb_color":n.strokeStyle=_g(c.rgb_color,c.opacity,a);break;case"linear_gradient_idx":n.strokeStyle=MT(n,e.linear_gradients[c.linear_gradient_idx],m,a,!0);break;case"radial_gradient_idx":n.strokeStyle=IT(n,e.radial_gradients[c.radial_gradient_idx],m,a,!0)}switch(c.linejoin){case vv.LINE_JOIN_MITER_CLIP:case vv.LINE_JOIN_MITER:n.lineJoin="miter";break;case vv.LINE_JOIN_ROUND:n.lineJoin="round";break;case vv.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(c.linecap){case fx.LINE_CAP_BUTT:n.lineCap="butt";break;case fx.LINE_CAP_ROUND:n.lineCap="round";break;case fx.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(p)}function MT(n,e,i,a,c=!1){if(e.stops.length===1){const P=e.stops[0];return _g(P.rgb_color,P.opacity*i,a)}const{x1:p,y1:m,x2:v,y2:T}=e;let E=new DOMPoint(p,m),R=new DOMPoint(v,T);if(c){const P=yg(e.transform);E=P.transformPoint(E),R=P.transformPoint(R)}const D=n.createLinearGradient(E.x,E.y,R.x,R.y);for(const P of e.stops)D.addColorStop(P.offset,_g(P.rgb_color,P.opacity*i,a));return D}function IT(n,e,i,a,c=!1){if(e.stops.length===1){const te=e.stops[0];return _g(te.rgb_color,te.opacity*i,a)}const p=yg(e.transform),{fx:m,fy:v,fr:T,cx:E,cy:R,r:D}=e;let P=new DOMPoint(m,v),j=new DOMPoint(E,R),G=T,Z=D;if(c){P=p.transformPoint(P),j=p.transformPoint(j);const te=(p.a+p.d)/2;G=T*te,Z=e.r*te}const K=n.createRadialGradient(P.x,P.y,G,j.x,j.y,Z);for(const te of e.stops)K.addColorStop(te.offset,_g(te.rgb_color,te.opacity*i,a));return K}function RT(n,e,i,a){const c=a.transform?yg(a.transform).preMultiplySelf(e):e,p=D_(n.canvas.width,n.canvas.height),m=p.getContext("2d");for(const T of a.children)if(T.group)RT(m,c,i,T.group);else if(T.path){const E=T.path,R=new Path2D;R.addPath(LT(E),c),m.fill(R,AT(E))}const v=a.clip_path_idx!=null?i.clip_paths[a.clip_path_idx]:null;v&&DT(m,c,i,v),n.globalCompositeOperation="source-over",n.drawImage(p,0,0)}function DT(n,e,i,a){const c=D_(n.canvas.width,n.canvas.height);RT(c.getContext("2d"),e,i,a),n.globalCompositeOperation="destination-in",n.drawImage(c,0,0)}function PT(n,e,i,a,c){if(a.children.length===0)return;const p=a.mask_idx!=null?i.masks[a.mask_idx]:null;p&&PT(n,e,i,p,c);const m=n.canvas.width,v=n.canvas.height,T=D_(m,v),E=T.getContext("2d"),R=a.width,D=a.height,P=a.left,j=a.top,G=new Path2D,Z=new Path2D;Z.rect(P,j,R,D),G.addPath(Z,e),E.clip(G);for(const ce of a.children)ST(E,e,i,ce,c);const K=E.getImageData(0,0,m,v),te=K.data;if(a.mask_type===bT.MASK_TYPE_LUMINANCE)for(let ce=0;ce<te.length;ce+=4)te[ce+3]=te[ce+3]/255*(.2126*te[ce]+.7152*te[ce+1]+.0722*te[ce+2]);E.putImageData(K,0,0),n.globalCompositeOperation="destination-in",n.drawImage(T,0,0)}function yg(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function OT(n,e){const i=n.step;let a=n.diffs[0]*i,c=n.diffs[1]*i;e.moveTo(a,c);for(let p=0,m=2;p<n.commands.length;p++)switch(n.commands[p]){case R_.PATH_COMMAND_MOVE:a+=n.diffs[m++]*i,c+=n.diffs[m++]*i,e.moveTo(a,c);break;case R_.PATH_COMMAND_LINE:a+=n.diffs[m++]*i,c+=n.diffs[m++]*i,e.lineTo(a,c);break;case R_.PATH_COMMAND_QUAD:{const v=a+n.diffs[m++]*i,T=c+n.diffs[m++]*i;a=v+n.diffs[m++]*i,c=T+n.diffs[m++]*i,e.quadraticCurveTo(v,T,a,c);break}case R_.PATH_COMMAND_CUBIC:{const v=a+n.diffs[m++]*i,T=c+n.diffs[m++]*i,E=v+n.diffs[m++]*i,R=T+n.diffs[m++]*i;a=E+n.diffs[m++]*i,c=R+n.diffs[m++]*i,e.bezierCurveTo(v,T,E,R,a,c);break}case R_.PATH_COMMAND_CLOSE:e.closePath()}return e}function LT(n){return OT(n,new Path2D)}class Tv{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}mi(Tv,"LRUCache");class mx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new ra(e,e.data)}getFromCache(e,i,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new Tv(150)),this.cacheMap.get(a).get(iu(e.toString(),i))}setInCache(e,i,a,c){this.cacheDependenciesMap.has(c)||this.cacheDependenciesMap.set(c,new Map),this.cacheMap.has(c)||this.cacheMap.set(c,new Tv(150));const p=this.cacheDependenciesMap.get(c),m=iu(e.id.toString(),a);p.get(m)||p.set(m,new Set);const v=this.cacheMap.get(c),T=e.toString();p.get(m).add(T),v.put(iu(e.toString(),a),i)}removeImagesFromCacheByIds(e,i,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const c=this.cacheMap.get(a),p=this.cacheDependenciesMap.get(a);for(const m of e){const v=iu(m.toString(),i);if(p.has(v)){for(const T of p.get(v))c.delete(T);p.delete(v)}}}rasterize(e,i,a,c,p=$I){const m=this.getFromCache(e,a,c);if(m)return m.clone();const v=p(i.icon,e.options),T=mx._getImage(v);return this.setInCache(e,T,a,c),T.clone()}}class zT{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function kT(n,e,i,a){let c=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(a[m])<1e-15){if(i[m]<n[m]||i[m]>e[m])return null}else{const v=1/a[m];let T=(n[m]-i[m])*v,E=(e[m]-i[m])*v;if(T>E){const R=T;T=E,E=R}if(T>c&&(c=T),E<p&&(p=E),c>p)return null}return c}function NT(n,e,i,a,c,p,m,v,T,E,R){const D=a-n,P=c-e,j=p-i,G=m-n,Z=v-e,K=T-i,te=R[1]*K-R[2]*Z,ce=R[2]*G-R[0]*K,he=R[0]*Z-R[1]*G,Y=D*te+P*ce+j*he;if(Math.abs(Y)<1e-15)return null;const le=1/Y,de=E[0]-n,be=E[1]-e,Fe=E[2]-i,ze=(de*te+be*ce+Fe*he)*le;if(ze<0||ze>1)return null;const Be=be*j-Fe*P,We=Fe*D-de*j,dt=de*P-be*D,Bt=(R[0]*Be+R[1]*We+R[2]*dt)*le;return Bt<0||ze+Bt>1?null:(G*Be+Z*We+K*dt)*le}function FT(n,e,i){return(n-e)/(i-e)}function BT(n,e,i,a,c,p,m,v,T){const E=1<<i,R=p-a,D=m-c,P=(n+1)/E*R+a,j=(e+0)/E*D+c,G=(e+1)/E*D+c;v[0]=(n+0)/E*R+a,v[1]=j,T[0]=P,T[1]=G}class jT{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(p){const m=Math.ceil(Math.log2(p.dim/8)),v=[];let T=Math.ceil(Math.pow(2,m));const E=1/T,R=(j,G,Z,K,te)=>{const ce=K?1:0,he=(j+1)*Z-ce,Y=G*Z,le=(G+1)*Z-ce;te[0]=j*Z,te[1]=Y,te[2]=he,te[3]=le};let D=new zT(T);const P=[];for(let j=0;j<T*T;j++){R(j%T,Math.floor(j/T),E,!1,P);const G=cp(P[0],P[1],p),Z=cp(P[2],P[1],p),K=cp(P[2],P[3],p),te=cp(P[0],P[3],p);D.minimums.push(Math.min(G,Z,K,te)),D.maximums.push(Math.max(G,Z,K,te)),D.leaves.push(1)}for(v.push(D),T/=2;T>=1;T/=2){const j=v[v.length-1];D=new zT(T);for(let G=0;G<T*T;G++){R(G%T,Math.floor(G/T),2,!0,P);const Z=j.getElevation(P[0],P[1]),K=j.getElevation(P[2],P[1]),te=j.getElevation(P[2],P[3]),ce=j.getElevation(P[0],P[3]),he=j.isLeaf(P[0],P[1]),Y=j.isLeaf(P[2],P[1]),le=j.isLeaf(P[2],P[3]),de=j.isLeaf(P[0],P[3]),be=Math.min(Z.min,K.min,te.min,ce.min),Fe=Math.max(Z.max,K.max,te.max,ce.max),ze=he&&Y&&le&&de;D.maximums.push(Fe),D.minimums.push(be),D.leaves.push(Fe-be<=5&&ze?1:0)}v.push(D)}return v}(this.dem),a=i.length-1,c=i[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,c,p,m,v=1){return kT([e,i,-100],[a,c,this.maximums[0]*v],p,m)}raycast(e,i,a,c,p,m,v=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,i,a,c,p,m,v);if(T==null)return null;const E=[],R=[],D=[],P=[],j=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;j.length>0;){const{idx:G,t:Z,nodex:K,nodey:te,depth:ce}=j.pop();if(this.leaves[G]){BT(K,te,ce,e,i,a,c,D,P);const Y=1<<ce,le=(K+0)/Y,de=(K+1)/Y,be=(te+0)/Y,Fe=(te+1)/Y,ze=cp(le,be,this.dem)*v,Be=cp(de,be,this.dem)*v,We=cp(de,Fe,this.dem)*v,dt=cp(le,Fe,this.dem)*v,Bt=NT(D[0],D[1],ze,P[0],D[1],Be,P[0],P[1],We,p,m),St=NT(P[0],P[1],We,D[0],P[1],dt,D[0],D[1],ze,p,m),Nt=Math.min(Bt!==null?Bt:Number.MAX_VALUE,St!==null?St:Number.MAX_VALUE);if(Nt!==Number.MAX_VALUE)return Nt;{const Gt=Dt([],p,m,Z);if(VT(ze,Be,dt,We,FT(Gt[0],D[0],P[0]),FT(Gt[1],D[1],P[1]))>=Gt[2])return Z}continue}let he=0;for(let Y=0;Y<this._siblingOffset.length;Y++){BT((K<<1)+this._siblingOffset[Y][0],(te<<1)+this._siblingOffset[Y][1],ce+1,e,i,a,c,D,P),D[2]=-100,P[2]=this.maximums[this.childOffsets[G]+Y]*v;const le=kT(D,P,p,m);if(le!=null){const de=le;E[Y]=de;let be=!1;for(let Fe=0;Fe<he&&!be;Fe++)de>=E[R[Fe]]&&(R.splice(Fe,0,Y),be=!0);be||(R[he]=Y),he++}}for(let Y=0;Y<he;Y++){const le=R[Y];j.push({idx:this.childOffsets[G]+le,t:E[le],nodex:(K<<1)+this._siblingOffset[le][0],nodey:(te<<1)+this._siblingOffset[le][1],depth:ce+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,c,p){if(e[c].isLeaf(i,a)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=c-1,v=e[m];let T=0,E=0;for(let R=0;R<this._siblingOffset.length;R++){const D=2*i+this._siblingOffset[R][0],P=2*a+this._siblingOffset[R][1],j=v.getElevation(D,P),G=v.isLeaf(D,P),Z=this._addNode(j.min,j.max,G);G&&(T|=1<<R),E||(E=Z)}for(let R=0;R<this._siblingOffset.length;R++)T&1<<R||this._construct(e,2*i+this._siblingOffset[R][0],2*a+this._siblingOffset[R][1],m,E+R)}}function VT(n,e,i,a,c,p){return zi(zi(n,i,p),zi(e,a,p),c)}function cp(n,e,i){const a=i.dim,c=Me(n*a-.5,0,a-1),p=Me(e*a-.5,0,a-1),m=Math.floor(c),v=Math.floor(p),T=Math.min(m+1,a-1),E=Math.min(v+1,a-1);return VT(i.get(m,v),i.get(T,v),i.get(m,E),i.get(T,E),c-m,p-v)}const ZI={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function WI(n,e,i){return(256*n*256+256*e+i)/10-1e4}function XI(n,e,i){return 256*n+e+i/256-32768}class Sv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void Yi(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const p=this.dim=i.height-2,m=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let T=0;T<p;T++)m[this._idx(-1,T)]=m[this._idx(0,T)],m[this._idx(p,T)]=m[this._idx(p-1,T)],m[this._idx(T,-1)]=m[this._idx(T,0)],m[this._idx(T,p)]=m[this._idx(T,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const v=a==="terrarium"?XI:WI;for(let T=0;T<m.length;++T){const E=4*T;this.floatView[T]=v(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=ba.now()}_buildQuadTree(){this._tree=new jT(this)}get(e,i,a=!1){a&&(e=Me(e,-1,this.dim),i=Me(i,-1,this.dim));const c=this._idx(e,i);return this.floatView[c]}set(e,i,a){const c=this._idx(e,i),p=this.floatView[c];return this.floatView[c]=a,a-p}static getUnpackVector(e){return ZI[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const a=[0,0,0,0],c=Sv.getUnpackVector(i);let p=Math.floor((e+c[3])/c[2]);return a[2]=p%256,p=Math.floor(p/256),a[1]=p%256,p=Math.floor(p/256),a[0]=p,a}getPixels(){return new Ey({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,p=i*this.dim+this.dim,m=a*this.dim,v=a*this.dim+this.dim;switch(i){case-1:c=p-1;break;case 1:p=c+1}switch(a){case-1:m=v-1;break;case 1:v=m+1}const T=-i*this.dim,E=-a*this.dim;for(let R=m;R<v;R++)for(let D=c;D<p;D++){const P=4*this._idx(D,R),j=4*this._idx(D+T,R+E);this.pixels[P+0]=e.pixels[j+0],this.pixels[P+1]=e.pixels[j+1],this.pixels[P+2]=e.pixels[j+2],this.pixels[P+3]=e.pixels[j+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function YI(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push(function(a,c){return a.readFields(tR,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},c)}(i,i.readVarint()+i.pos))}function KI(n,e,i){n===1?(e.delta_filter=function(a,c){return a.readFields(QI,{blockSize:0},c)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function QI(n,e,i){n===1&&(e.blockSize=i.readVarint())}function JI(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function eR(n,e,i){let a=0,c=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push(function(p,m){return p.readFields(KI,{},m)}(i,i.readVarint()+i.pos)):n===4?e.codec=function(p,m){return p.readFields(JI,{},m)}(i,i.readVarint()+i.pos):n===5?c=i.readFloat():n===6?a=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=c),e.scale===0&&(e.scale=a)}function tR(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push(function(a,c){return a.readFields(eR,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},c)}(i,i.readVarint()+i.pos))}function iR(n,e,i){if(n===2)(function(a,c,p){a.readFields(nR,p,c)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function nR(n,e,i){if(n===1){let a=0;const c=i.readVarint()+i.pos;for(;i.pos<c;)e[a++]=i.readVarint()}}function rR(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let a=2;a>=1;a--){const c=a===1?1:0,p=a===2?1:0;for(let m=0;m<e[0];m++){const v=e[1]*m;for(let T=c;T<e[1];T++){const E=e[2]*(T+v);for(let R=p;R<e[2];R++){const D=e[3]*(R+E);for(let P=0;P<e[3];P++){const j=D+P;n[j]+=n[j-i]}}}}i*=e[a]}return n}function sR(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function aR(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const a=n[i],c=n[i+1];n[i]=(240&a)>>4|(61440&a)>>8|(240&c)<<4|61440&c,n[i+1]=15&a|(3840&a)>>4|(15&c)<<8|(3840&c)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const a=n[i],c=n[i+1],p=n[i+2],m=n[i+3];n[i+0]=(192&a)>>6|(192&c)>>4|(192&p)>>2|192&m,n[i+1]=(48&a)>>4|(48&c)>>2|48&p|(48&m)<<2,n[i+2]=(12&a)>>2|12&c|(12&p)<<2|(12&m)<<4,n[i+3]=3&a|(3&c)<<2|(3&p)<<4|(3&m)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}mi(Sv,"DEMData"),mi(jT,"DemMinMaxQuadTree",{omit:["dem"]});var zc=Uint8Array,P_=Uint16Array,oR=Int32Array,UT=new zc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),GT=new zc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),lR=new zc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),HT=function(n,e){for(var i=new P_(31),a=0;a<31;++a)i[a]=e+=1<<n[a-1];var c=new oR(i[30]);for(a=1;a<30;++a)for(var p=i[a];p<i[a+1];++p)c[p]=p-i[a]<<5|a;return{b:i,r:c}},qT=HT(UT,2),$T=qT.b,cR=qT.r;$T[28]=258,cR[258]=28;for(var uR=HT(GT,0).b,ZT=new P_(32768),Us=0;Us<32768;++Us){var vg=(43690&Us)>>1|(21845&Us)<<1;ZT[Us]=((65280&(vg=(61680&(vg=(52428&vg)>>2|(13107&vg)<<2))>>4|(3855&vg)<<4))>>8|(255&vg)<<8)>>1}var O_=function(n,e,i){for(var a=n.length,c=0,p=new P_(e);c<a;++c)n[c]&&++p[n[c]-1];var m,v=new P_(e);for(c=1;c<e;++c)v[c]=v[c-1]+p[c-1]<<1;m=new P_(1<<e);var T=15-e;for(c=0;c<a;++c)if(n[c])for(var E=c<<4|n[c],R=e-n[c],D=v[n[c]-1]++<<R,P=D|(1<<R)-1;D<=P;++D)m[ZT[D]>>T]=E;return m},L_=new zc(288);for(Us=0;Us<144;++Us)L_[Us]=8;for(Us=144;Us<256;++Us)L_[Us]=9;for(Us=256;Us<280;++Us)L_[Us]=7;for(Us=280;Us<288;++Us)L_[Us]=8;var WT=new zc(32);for(Us=0;Us<32;++Us)WT[Us]=5;var hR=O_(L_,9),dR=O_(WT,5),gx=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},Ku=function(n,e,i){var a=e/8|0;return(n[a]|n[a+1]<<8)>>(7&e)&i},_x=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},fR=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Qu=function(n,e,i){var a=new Error(e||fR[n]);if(a.code=n,Error.captureStackTrace&&Error.captureStackTrace(a,Qu),!i)throw a;return a},pR=new zc(0),mR=typeof TextDecoder<"u"&&new TextDecoder;try{mR.decode(pR,{stream:!0})}catch{}const gR={gzip_data:"gzip"};class du extends Error{constructor(e){super(e),this.name="MRTError"}}const _R={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},XT={uint32:1,uint16:2,uint8:4},yR={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let yx;class Ev{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new du(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),a=new DataView(e);if(i[0]!==13)throw new du("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),a=this.getHeaderLength(e);if(i.length<a)throw new du(`Expected header with length >= ${a} but got buffer of length ${i.length}`);const c=function(p,m){return p.readFields(YI,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new yx(i.subarray(0,a)));if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new du(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const p of c.layers)this.layers[p.name]=new YT(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],a=this.getLayer(e.layerName);for(let c of e.blockIndices){const p=a.dataIndex[c],m=p.firstByte-e.firstByte,v=p.lastByte-e.firstByte;if(a._blocksInProgress.has(c))continue;const T={layerName:a.name,firstByte:m,lastByte:v,pixelFormat:a.pixelFormat,blockIndex:c,blockShape:[p.bands.length].concat(a.bandShape),buffer:a.buffer,codec:p.codec.codec,filters:p.filters.map(E=>E.filter)};a._blocksInProgress.add(c),i.push(T)}return new KT(i,()=>{i.forEach(c=>a._blocksInProgress.delete(c.blockIndex))},(c,p)=>{if(i.forEach(m=>a._blocksInProgress.delete(m.blockIndex)),c)throw c;p.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class YT{constructor({version:e,name:i,units:a,tileSize:c,pixelFormat:p,buffer:m,dataIndex:v},T){if(this.version=e,this.version!==1)throw new du(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=a,this.tileSize=c,this.buffer=m,this.pixelFormat=_R[p],this.dataIndex=v,this.bandShape=[c+2*m,c+2*m,XT[this.pixelFormat]],this._decodedBlocks=new Tv(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return XT[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[a,c]of this.dataIndex.entries()){for(const[p,m]of c.bands.entries())if(m===e)return{bandIndex:i+p,blockIndex:a,blockBandIndex:p};i+=c.bands.length}break;case"number":for(const[a,c]of this.dataIndex.entries()){if(e>=i&&e<i+c.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-i};i+=c.bands.length}break;default:throw new du(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,a=-1/0;const c=[],p=new Set;for(const m of e){const{blockIndex:v}=this.getBlockForBand(m);if(v<0)throw new du(`Invalid band: ${JSON.stringify(m)}`);const T=this.dataIndex[v];c.includes(v)||c.push(v),p.add(v),i=Math.min(i,T.firstByte),a=Math.max(a,T.lastByte)}if(p.size>this.cacheSize)throw new du(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:a,blockIndices:c}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:a}=this.getBlockForBand(e);if(i<0)throw new du(`Band not found: ${JSON.stringify(e)}`);const c=this._decodedBlocks.get(i.toString());if(!c)throw new du(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[i],m=this.bandShape.reduce((E,R)=>E*R,1),v=a*m,T=c.subarray(v,v+m);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}Ev.setPbf=function(n){yx=n};class KT{constructor(e,i,a){this.tasks=e,this._onCancel=i,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}function ym(n,e){const i=n.json.bufferViews[e.bufferView],a=$y[e.componentType];return new a(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==g_[e.type]*a.BYTES_PER_ELEMENT?i.byteStride/a.BYTES_PER_ELEMENT:g_[e.type]))}function vx(n,e,i,a){const c=$y[e.componentType],p=function(R){switch(R){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),m=n.json.bufferViews[e.bufferView],v=m.byteStride?m.byteStride/c.BYTES_PER_ELEMENT:g_[e.type],T=i.float32,E=T.length/i.capacity;for(let R=0,D=0;R<e.count*v;R+=v,D+=E)for(let P=0;P<E;P++)T[D+P]=a[R+P]*p;i._trim()}function vR(n,e,i){const a=n.indices,c=n.attributes,p={};p.indexArray=new ls;const m=e.json.accessors[a],v=m.count/3;p.indexArray.reserve(v);const T=ym(e,m);for(let P=0;P<v;P++)p.indexArray.emplaceBack(T[3*P],T[3*P+1],T[3*P+2]);p.indexArray._trim(),p.vertexArray=new So;const E=e.json.accessors[c.POSITION];p.vertexArray.reserve(E.count);const R=ym(e,E);for(let P=0;P<E.count;P++)p.vertexArray.emplaceBack(R[3*P],R[3*P+1],R[3*P+2]);if(p.vertexArray._trim(),p.aabb=new An(E.min,E.max),p.centroid=function(P,j){const G=[0,0,0],Z=P.length;if(Z>0){for(let K=0;K<Z;K++){const te=3*P[K];G[0]+=j[te],G[1]+=j[te+1],G[2]+=j[te+2]}G[0]/=Z,G[1]/=Z,G[2]/=Z}return G}(T,R),c.COLOR_0!==void 0){const P=e.json.accessors[c.COLOR_0],j=g_[P.type],G=ym(e,P);p.colorArray=j===3?new So:new Es,p.colorArray.resize(P.count),vx(e,P,p.colorArray,G)}if(c.NORMAL!==void 0){p.normalArray=new So;const P=e.json.accessors[c.NORMAL];p.normalArray.resize(P.count);const j=ym(e,P);vx(e,P,p.normalArray,j)}if(c.TEXCOORD_0!==void 0&&i.length>0){p.texcoordArray=new Jl;const P=e.json.accessors[c.TEXCOORD_0];p.texcoordArray.resize(P.count);const j=ym(e,P);vx(e,P,p.texcoordArray,j)}if(c._FEATURE_ID_RGBA4444!==void 0){const P=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=ym(e,P))}c._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(ym(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const D=n.material;return p.material=function(P,j){const{emissiveFactor:G=[0,0,0],alphaMode:Z="OPAQUE",alphaCutoff:K=.5,normalTexture:te,occlusionTexture:ce,emissiveTexture:he,doubleSided:Y}=P,{baseColorFactor:le=[1,1,1,1],metallicFactor:de=1,roughnessFactor:be=1,baseColorTexture:Fe,metallicRoughnessTexture:ze}=P.pbrMetallicRoughness||{},Be=ce?j[ce.index]:void 0;if(ce&&ce.extensions&&ce.extensions.KHR_texture_transform&&Be){const We=ce.extensions.KHR_texture_transform;Be.offsetScale=[We.offset[0],We.offset[1],We.scale[0],We.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new ln(...le),metallicFactor:de,roughnessFactor:be,baseColorTexture:Fe?j[Fe.index]:void 0,metallicRoughnessTexture:ze?j[ze.index]:void 0},doubleSided:Y,emissiveFactor:new ln(...G),alphaMode:Z,alphaCutoff:K,normalTexture:te?j[te.index]:void 0,occlusionTexture:Be,emissionTexture:he?j[he.index]:void 0,defined:P.defined===void 0}}(D!==void 0?e.json.materials[D]:{defined:!1},i),p}function QT(n,e,i){const{matrix:a,rotation:c,translation:p,scale:m,mesh:v,extras:T,children:E}=n,R={};if(R.matrix=a||function(D,P,j,G){var Z=P[0],K=P[1],te=P[2],ce=P[3],he=Z+Z,Y=K+K,le=te+te,de=Z*he,be=Z*Y,Fe=Z*le,ze=K*Y,Be=K*le,We=te*le,dt=ce*he,Bt=ce*Y,St=ce*le,Nt=G[0],Gt=G[1],pt=G[2];return D[0]=(1-(ze+We))*Nt,D[1]=(be+St)*Nt,D[2]=(Fe-Bt)*Nt,D[3]=0,D[4]=(be-St)*Gt,D[5]=(1-(de+We))*Gt,D[6]=(Be+dt)*Gt,D[7]=0,D[8]=(Fe+Bt)*pt,D[9]=(Be-dt)*pt,D[10]=(1-(de+ze))*pt,D[11]=0,D[12]=j[0],D[13]=j[1],D[14]=j[2],D[15]=1,D}([],c||[0,0,0,1],p||[0,0,0],m||[1,1,1]),v!==void 0){R.meshes=i[v];const D=R.anchor=[0,0];for(const P of R.meshes){const{min:j,max:G}=P.aabb;D[0]+=j[0]+G[0],D[1]+=j[1]+G[1]}D[0]=Math.floor(D[0]/R.meshes.length/2),D[1]=Math.floor(D[1]/R.meshes.length/2)}if(T&&(T.id&&(R.id=T.id),T.lights&&(R.lights=function(D){if(!D.length)return[];const P=function(te){const ce=atob(te),he=new Uint8Array(ce.length);for(let Y=0;Y<ce.length;Y++)he[Y]=ce.codePointAt(Y);return he}(D),j=[],G=P.length/24,Z=new Uint16Array(P.buffer),K=new Float32Array(P.buffer);for(let te=0;te<G;te++){const ce=Z[2*te*6]/30,he=Z[2*te*6+1]/30,Y=Z[2*te*6+10]/100,le=K[6*te+1],de=K[6*te+2],be=K[6*te+3],Fe=K[6*te+4],ze=be-le,Be=Fe-de,We=Math.hypot(ze,Be);j.push({pos:[le+.5*ze,de+.5*Be,he],normal:[Be/We,-ze/We,0],width:We,height:ce,depth:Y,points:[le,de,be,Fe]})}return j}(T.lights))),E){const D=[];for(const P of E)D.push(QT(e.json.nodes[P],e,i));R.children=D}return R}function xR(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new Qd(n.vertices,n.indices,8,256),[i,a]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:a}}function bR(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const a=[];for(const m of i){if(!Array.isArray(m)||m.length!==2)continue;const v=m[0],T=m[1];typeof v=="number"&&typeof T=="number"&&a.push(new Qt(v,T))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let c=0;for(let m=0;m<a.length;m++){const v=a[m],T=a[(m+1)%a.length],E=a[(m+2)%a.length];c+=(v.x-T.x)*(E.y-T.y)-(E.x-T.x)*(v.y-T.y)}c>0&&a.reverse();const p=Hd(a.flatMap(m=>[m.x,m.y]),[]);return p.length===0?null:{vertices:a,indices:p}}function wR(n,e){const i=[],a=[];let c=0;const p=[];for(const m of n){c=i.length;const v=m.vertexArray.float32,T=m.indexArray.uint16;for(let E=0;E<m.vertexArray.length;E++)p[0]=v[3*E+0],p[1]=v[3*E+1],p[2]=v[3*E+2],ei(p,p,e),i.push(new Qt(p[0],p[1]));for(let E=0;E<3*m.indexArray.length;E++)a.push(T[E]+c)}if(a.length%3!=0)return null;for(let m=0;m<a.length;m+=3){const v=i[a[m+0]],T=i[a[m+1]],E=i[a[m+2]];(v.x-T.x)*(E.y-T.y)-(E.x-T.x)*(v.y-T.y)>0&&([a[m+1],a[m+2]]=[a[m+2],a[m+1]])}return{vertices:i,indices:a}}function JT(n){const e=function(T,E){const R=[],D=WebGL2RenderingContext;if(T.json.textures)for(const P of T.json.textures){const j={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};P.sampler!==void 0&&Object.assign(j,T.json.samplers[P.sampler]),R.push({image:E[P.source],sampler:j,uploaded:!1})}return R}(n,n.images),i=function(T,E){const R=[];for(const D of T.json.meshes){const P=[];for(const j of D.primitives)P.push(vR(j,T,E));R.push(P)}return R}(n,e),{scenes:a,scene:c,nodes:p}=n.json,m=a?a[c||0].nodes:p,v=[];for(const T of m)v.push(QT(p[T],n,i));return function(T,E,R){const D={},P=new Set;for(let j=0;j<T.length;j++){const G=R[E[j]];if(!G.extras)continue;const Z=G.extras["mapbox:footprint:version"],K=G.extras["mapbox:footprint:id"];(Z||K)&&P.add(j),Z==="1.0.0"&&K&&(D[K]=j)}for(let j=0;j<T.length;j++){if(P.has(j))continue;const G=T[j],Z=R[E[j]];if(!Z.extras)continue;let K=null;G.id in D&&(K=wR(T[D[G.id]].meshes,G.matrix)),K||(K=bR(Z)),K&&(G.footprint=xR(K))}if(P.size>0){const j=Array.from(P.values()).sort((G,Z)=>G-Z);for(let G=j.length-1;G>=0;G--)T.splice(j[G],1)}}(v,m,n.json.nodes),v}function TR(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,a=n.aabb.min[1]-1,c=gm/(n.aabb.max[0]-i+2),p=gm/(n.aabb.max[1]-a+2);for(let m=0;m<e.length;m+=3){const v=e[m+2],T=(e[m+0]-i)*c|0,E=(e[m+1]-a)*p|0;v>n.heightmap[E*gm+T]&&(n.heightmap[E*gm+T]=v)}}function SR(n,e){const i={};i.indexArray=new ls,i.indexArray.reserve(4*n.length),i.vertexArray=new So,i.vertexArray.reserve(10*n.length),i.colorArray=new Es,i.vertexArray.reserve(10*n.length);let a=0;for(const m of n){const v=Math.min(10,Math.max(4,1.3*m.height))*e,T=[-m.normal[1],m.normal[0],0],E=Math.min(.29,.1*m.width/m.depth),R=m.width-2*m.depth*e*(E+.01),D=Dt([],m.pos,T,R/2),P=Dt([],m.pos,T,-R/2),j=[D[0],D[1],D[2]+m.height],G=[P[0],P[1],P[2]+m.height],Z=Dt([],m.normal,T,E);Ve(Z,Z,v);const K=Dt([],m.normal,T,-E);Ve(K,K,v),Et(Z,D,Z),Et(K,P,K),D[2]+=.1,P[2]+=.1,i.vertexArray.emplaceBack(Z[0],Z[1],Z[2]),i.vertexArray.emplaceBack(K[0],K[1],K[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(j[0],j[1],j[2]),i.vertexArray.emplaceBack(G[0],G[1],G[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(Z[0],Z[1],Z[2]),i.vertexArray.emplaceBack(K[0],K[1],K[2]);const te=R/v/2;i.colorArray.emplaceBack(-te-E,-1,te,.8),i.colorArray.emplaceBack(te+E,-1,te,.8),i.colorArray.emplaceBack(-te,0,te,1.3),i.colorArray.emplaceBack(te,0,te,1.3),i.colorArray.emplaceBack(te+E,-.8,te,.7),i.colorArray.emplaceBack(te+E,-.8,te,.7),i.colorArray.emplaceBack(0,0,te,1.3),i.colorArray.emplaceBack(0,0,te,1.3),i.colorArray.emplaceBack(te+E,-1.2,te,.8),i.colorArray.emplaceBack(te+E,-1.2,te,.8),i.indexArray.emplaceBack(6+a,4+a,8+a),i.indexArray.emplaceBack(7+a,9+a,5+a),i.indexArray.emplaceBack(0+a,1+a,2+a),i.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const c={defined:!0};c.emissiveFactor=ln.black;const p={};return p.baseColorFactor=ln.white,c.pbrMetallicRoughness=p,i.material=c,i.aabb=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}Ev.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map(a=>{const{layerName:c,firstByte:p,lastByte:m,pixelFormat:v,blockShape:T,blockIndex:E,filters:R,codec:D}=a,P=i.subarray(p,m+1),j=new Uint32Array(T[0]*T[1]*T[2]);let G;if(D!=="gzip_data")throw new du(`Unhandled codec: ${D}`);return G=function(Z,K){if(!globalThis.DecompressionStream&&K==="gzip_data")return Promise.resolve(((Y=function(be){be[0]==31&&be[1]==139&&be[2]==8||Qu(6,"invalid gzip data");var Fe=be[3],ze=10;4&Fe&&(ze+=2+(be[10]|be[11]<<8));for(var Be=(Fe>>3&1)+(Fe>>4&1);Be>0;Be-=!be[ze++]);return ze+(2&Fe)}(he=Z))+8>he.length&&Qu(6,"invalid gzip data"),function(be,Fe,ze,Be){var We=be.length;if(!We||Fe.f&&!Fe.l)return ze||new zc(0);var dt=!ze,Bt=dt||Fe.i!=2,St=Fe.i;dt&&(ze=new zc(3*We));var Nt,Gt,pt=function(ns){var Mr=ze.length;if(ns>Mr){var vr=new zc(Math.max(2*Mr,ns));vr.set(ze),ze=vr}},Ot=Fe.f||0,ut=Fe.p||0,ft=Fe.b||0,Zt=Fe.l,Yt=Fe.d,ki=Fe.m,Ti=Fe.n,ai=8*We;do{if(!Zt){Ot=Ku(be,ut,1);var $t=Ku(be,ut+1,3);if(ut+=3,!$t){var Xi=be[(ye=4+((ut+7)/8|0))-4]|be[ye-3]<<8,wi=ye+Xi;if(wi>We){St&&Qu(0);break}Bt&&pt(ft+Xi),ze.set(be.subarray(ye,wi),ft),Fe.b=ft+=Xi,Fe.p=ut=8*wi,Fe.f=Ot;continue}if($t==1)Zt=hR,Yt=dR,ki=9,Ti=5;else if($t==2){var Ei=Ku(be,ut,31)+257,Hi=Ku(be,ut+10,15)+4,sn=Ei+Ku(be,ut+5,31)+1;ut+=14;for(var nn=new zc(sn),fn=new zc(19),an=0;an<Hi;++an)fn[lR[an]]=Ku(be,ut+3*an,7);ut+=3*Hi;var pn=gx(fn),Jn=(1<<pn)-1,wr=O_(fn,pn);for(an=0;an<sn;){var ye,Ee=wr[Ku(be,ut,Jn)];if(ut+=15&Ee,(ye=Ee>>4)<16)nn[an++]=ye;else{var yt=0,Jt=0;for(ye==16?(Jt=3+Ku(be,ut,3),ut+=2,yt=nn[an-1]):ye==17?(Jt=3+Ku(be,ut,7),ut+=3):ye==18&&(Jt=11+Ku(be,ut,127),ut+=7);Jt--;)nn[an++]=yt}}var oi=nn.subarray(0,Ei),ri=nn.subarray(Ei);ki=gx(oi),Ti=gx(ri),Zt=O_(oi,ki),Yt=O_(ri,Ti)}else Qu(1);if(ut>ai){St&&Qu(0);break}}Bt&&pt(ft+131072);for(var bi=(1<<ki)-1,Gi=(1<<Ti)-1,vn=ut;;vn=ut){var xn=(yt=Zt[_x(be,ut)&bi])>>4;if((ut+=15&yt)>ai){St&&Qu(0);break}if(yt||Qu(2),xn<256)ze[ft++]=xn;else{if(xn==256){vn=ut,Zt=null;break}var on=xn-254;xn>264&&(on=Ku(be,ut,(1<<(bn=UT[an=xn-257]))-1)+$T[an],ut+=bn);var tr=Yt[_x(be,ut)&Gi],yr=tr>>4;if(tr||Qu(3),ut+=15&tr,ri=uR[yr],yr>3){var bn=GT[yr];ri+=_x(be,ut)&(1<<bn)-1,ut+=bn}if(ut>ai){St&&Qu(0);break}Bt&&pt(ft+131072);var qr=ft+on;if(ft<ri){var Tr=0-ri,er=Math.min(ri,qr);for(Tr+ft<0&&Qu(3);ft<er;++ft)ze[ft]=(void 0)[Tr+ft]}for(;ft<qr;++ft)ze[ft]=ze[ft-ri]}}Fe.l=Zt,Fe.p=vn,Fe.b=ft,Fe.f=Ot,Zt&&(Ot=1,Fe.m=ki,Fe.d=Yt,Fe.n=Ti)}while(!Ot);return ft!=ze.length&&dt?(Nt=ze,((Gt=ft)==null||Gt>Nt.length)&&(Gt=Nt.length),new zc(Nt.subarray(0,Gt))):ze.subarray(0,ft)}(he.subarray(Y,-8),{i:2},new zc(((te=he)[(ce=te.length)-4]|te[ce-3]<<8|te[ce-2]<<16|te[ce-1]<<24)>>>0))));var te,ce,he,Y;const le=gR[K];if(!le)throw new Error(`Unhandled codec: ${K}`);const de=new globalThis.DecompressionStream(le);return new Response(new Blob([Z]).stream().pipeThrough(de)).arrayBuffer().then(be=>new Uint8Array(be))}(P,D).then(Z=>(function(K,te){K.readFields(iR,te)}(new yx(Z),j),new yR[v](j.buffer))),G.then(Z=>{for(let K=R.length-1;K>=0;K--)switch(R[K]){case"delta_filter":rR(Z,T);break;case"zigzag_filter":sR(Z);break;case"bitshuffle_filter":aR(Z,v);break;default:throw new du(`Unhandled filter "${R[K]}"`)}return{layerName:c,blockIndex:E,data:Z}}).catch(Z=>{throw Z})}))},mi(KT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),mi(Ev,"MapboxRasterTile"),mi(YT,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class eS{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const ER=["id","tile","layer","source","sourceLayer","state"];class xg{constructor(e,i,a,c,p){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=c,this.properties=e.properties,this.id=p}clone(){const e=new xg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of ER)this[i]!==void 0&&(e[i]=this[i]);return e}}class tS{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new wl(Kt,16,0),this.featureIndexArray=new $p,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,a,c,p,m=0,v=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,p,m);const E=this.grid;for(let R=0;R<i.length;R++){const D=i[R],P=[1/0,1/0,-1/0,-1/0];for(let j=0;j<D.length;j++){const G=D[j];P[0]=Math.min(P[0],G.x),P[1]=Math.min(P[1],G.y),P[2]=Math.max(P[2],G.x),P[3]=Math.max(P[3],G.y)}v!==0&&(P[0]-=v,P[1]-=v,P[2]+=v,P[3]+=v),P[0]<Kt&&P[1]<Kt&&P[2]>=0&&P[3]>=0&&E.insert(T,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Wi.VectorTile(new Wy(this.rawTileData)).layers,this.sourceLayerCoder=new eS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:a,transform:c,tileTransform:p,pixelPosMatrix:m,availableImages:v,worldview:T}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const E=a.bufferedTilespaceBounds,R=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(G,Z,K,te)=>Gu(a.bufferedTilespaceGeometry,G,Z,K,te));R.sort(AR);let D=null;c.elevation&&R.length>0&&(D=gg.create(c.elevation,this.tileID));const P={};let j;for(let G=0;G<R.length;G++){const Z=R[G];if(Z===j)continue;j=Z;const K=this.featureIndexArray.get(Z);let te=null;this.is3DTile?this.loadMatchingModelFeature(P,K,e,a,c,T):this.loadMatchingFeature(P,K,e,v,T,(ce,he,Y,le=0)=>(te||(te=di(ce,this.tileID.canonical,p)),he.queryIntersectsFeature(a,ce,Y,te,this.z,c,m,D,le)))}return P}loadMatchingFeature(e,i,a,c,p,m){const{featureIndex:v,bucketIndex:T,sourceLayerIndex:E,layoutVertexArrayOffset:R}=i,D=this.bucketLayerIDs[T],P=a.layers,j=Object.keys(P);if(j.length&&!Vi(j,D))return;const G=a.sourceCache,Z=this.sourceLayerCoder.decode(E),K=this.vtLayers[Z].feature(v),te=this.getId(K,Z);for(let ce=0;ce<D.length;ce++){const he=D[ce];if(!P[he])continue;const{styleLayer:Y,targets:le}=P[he];let de={};te!==void 0&&(de=G.getFeatureState(Y.sourceLayer,te));const be=!m||m(K,Y,de,R);if(!be)continue;const Fe=new xg(K,this.z,this.x,this.y,te);Fe.tile=this.tileID.canonical,Fe.state=de;let ze=this.serializedLayersCache.get(he);ze||(ze=Y.serialize(),ze.id=he,this.serializedLayersCache.set(he,ze)),Fe.source=ze.source,Fe.sourceLayer=ze["source-layer"],Fe.layer=tt({},ze),Fe.layer.paint=iS(ze.paint,Y.paint,K,de,c),Fe.layer.layout=iS(ze.layout,Y.layout,K,de,c);let Be=!1;for(const We of le){this.updateFeatureProperties(Fe,We);const{filter:dt}=We;if(dt){if(K.properties=Fe.properties,dt.needGeometry){const Bt=hi(K,!0);if(!dt.filter(new Kn(this.tileID.overscaledZ,{worldview:p}),Bt,this.tileID.canonical))continue}else if(!dt.filter(new Kn(this.tileID.overscaledZ,{worldview:p}),K))continue}Be=!0,We.targetId&&this.addFeatureVariant(Fe,We)}Be&&this.appendToResult(e,he,v,Fe,be)}}loadMatchingModelFeature(e,i,a,c,p,m){const{featureIndex:v,bucketIndex:T}=i,E=this.bucketLayerIDs[T],R=a.layers,D=Object.keys(R);if(!D.length||Vi(D,E))for(let P=0;P<E.length;P++){const j=E[P],{styleLayer:G,targets:Z}=R[j];if(G.type!=="model")continue;const K=c.tile,te=K.getBucket(G);if(!(te&&te instanceof yv))continue;const ce=EI(te,v,c,p);if(!ce)continue;const{z:he,x:Y,y:le}=K.tileID.canonical,{feature:de,intersectionZ:be,position:Fe}=ce;let ze={};de.id!==void 0&&(ze=a.sourceCache.getFeatureState(G.sourceLayer,de.id));const Be=new xg({},he,Y,le,de.id);Be.tile=this.tileID.canonical,Be.state=ze,Be.properties=de.properties,Be.geometry={type:"Point",coordinates:[Fe.lng,Fe.lat]};let We=this.serializedLayersCache.get(j);We||(We=G.serialize(),We.id=j,this.serializedLayersCache.set(j,We)),Be.source=We.source,Be.sourceLayer=We["source-layer"],Be.layer=tt({},We);let dt=!1;for(const Bt of Z){this.updateFeatureProperties(Be,Bt);const{filter:St}=Bt;if(St){if(de.properties=Be.properties,St.needGeometry){if(!St.filter(new Kn(this.tileID.overscaledZ,{worldview:m}),de,this.tileID.canonical))continue}else if(!St.filter(new Kn(this.tileID.overscaledZ,{worldview:m}),de))continue}dt=!0,Bt.targetId&&this.addFeatureVariant(Be,Bt)}dt&&this.appendToResult(e,j,v,Be,be)}}updateFeatureProperties(e,i,a){if(i.properties){const c={};for(const p in i.properties){const m=i.properties[p].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);m!=null&&(c[p]=m)}e.properties=c}}addFeatureVariant(e,i,a){const c={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(c.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(c)}appendToResult(e,i,a,c,p){let m=e[i];m===void 0&&(m=e[i]=[]),m.push({featureIndex:a,feature:c,intersectionZ:p})}lookupSymbolFeatures(e,i,a,c,p,m){const v={};this.loadVTLayers();for(const T of e)this.loadMatchingFeature(v,{bucketIndex:i,sourceLayerIndex:a,featureIndex:T,layoutVertexArrayOffset:0},c,p,m);return v}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(a),p=this.vtFeatures[c];if(p[i])return p[i];const m=this.vtLayers[c].feature(i);return p[i]=m,m}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const c=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(c!=null)if(Array.isArray(c)){if(!this.promoteIdExpression){const p=Ko(c);if(p.result!=="success"){const m=p.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void Yi(`Failed to create expression for promoteId: ${m}`)}this.promoteIdExpression=p.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new sh),a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[c];typeof a=="boolean"&&(a=Number(a))}return a}}function iS(n,e,i,a,c){return si(n,(p,m)=>{const v=e instanceof Lu?e.get(m):null;return v&&v.evaluate?v.evaluate(i,a,void 0,c):v})}function AR(n,e){return e-n}mi(tS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const nS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class xx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const p=nS[15&a];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new xx(v,m,p,e)}constructor(e,i=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=nS.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=i,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return bx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:v}=this,T=[0,p.length-1,0],E=[];for(;T.length;){const R=T.pop()||0,D=T.pop()||0,P=T.pop()||0;if(D-P<=v){for(let K=P;K<=D;K++){const te=m[2*K],ce=m[2*K+1];te>=e&&te<=a&&ce>=i&&ce<=c&&E.push(p[K])}continue}const j=P+D>>1,G=m[2*j],Z=m[2*j+1];G>=e&&G<=a&&Z>=i&&Z<=c&&E.push(p[j]),(R===0?e<=G:i<=Z)&&(T.push(P),T.push(j-1),T.push(1-R)),(R===0?a>=G:c>=Z)&&(T.push(j+1),T.push(D),T.push(1-R))}return E}within(e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:p,nodeSize:m}=this,v=[0,c.length-1,0],T=[],E=a*a;for(;v.length;){const R=v.pop()||0,D=v.pop()||0,P=v.pop()||0;if(D-P<=m){for(let K=P;K<=D;K++)sS(p[2*K],p[2*K+1],e,i)<=E&&T.push(c[K]);continue}const j=P+D>>1,G=p[2*j],Z=p[2*j+1];sS(G,Z,e,i)<=E&&T.push(c[j]),(R===0?e-a<=G:i-a<=Z)&&(v.push(P),v.push(j-1),v.push(1-R)),(R===0?e+a>=G:i+a>=Z)&&(v.push(j+1),v.push(D),v.push(1-R))}return T}}function bx(n,e,i,a,c,p){if(c-a<=i)return;const m=a+c>>1;rS(n,e,m,a,c,p),bx(n,e,i,a,m-1,1-p),bx(n,e,i,m+1,c,1-p)}function rS(n,e,i,a,c,p){for(;c>a;){if(c-a>600){const E=c-a+1,R=i-a+1,D=Math.log(E),P=.5*Math.exp(2*D/3),j=.5*Math.sqrt(D*P*(E-P)/E)*(R-E/2<0?-1:1);rS(n,e,i,Math.max(a,Math.floor(i-R*P/E+j)),Math.min(c,Math.floor(i+(E-R)*P/E+j)),p)}const m=e[2*i+p];let v=a,T=c;for(z_(n,e,a,i),e[2*c+p]>m&&z_(n,e,a,c);v<T;){for(z_(n,e,v,T),v++,T--;e[2*v+p]<m;)v++;for(;e[2*T+p]>m;)T--}e[2*a+p]===m?z_(n,e,a,T):(T++,z_(n,e,T,c)),T<=i&&(a=T+1),i<=T&&(c=T-1)}}function z_(n,e,i,a){wx(n,i,a),wx(e,2*i,2*a),wx(e,2*i+1,2*a+1)}function wx(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}function sS(n,e,i,a){const c=n-i,p=e-a;return c*c+p*p}r.$=Vs,r.A=Zi,r.B=Ll,r.C=iu,r.D=qt,r.E=fs,r.F=2,r.G=b_,r.H=Tw,r.I=Br,r.J=mc,r.K=class extends gv{},r.L=Ho,r.M=lo,r.N=bh,r.O=Mu,r.P=Qt,r.Q=Ru,r.R=Er,r.S=Is,r.T=ix,r.U=Ad,r.V=gv,r.W=bd,r.X=Ko,r.Y=fh,r.Z=os,r._=Zc,r.a=function(n){return hs.API_CDN_URL_REGEX.test(n)},r.a$=rt,r.a0=ea,r.a1=Cd,r.a2=wh,r.a3=Iu,r.a4=function(n){const e=n.value;let i=[];if(!e)return i;const a=mc(e);return a!=="string"?(i=i.concat([new gv(n.key,e,`string expected, "${a}" found`)]),i):(ax(e,!0)||(i=i.concat([new gv(n.key,e,`invalid url "${e}"`)])),i)},r.a5=Ye,r.a6=zp,r.a7=zr,r.a8=Ut,r.a9=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return Vn(n.expression.evaluate(e))}interpolate(n,e,i){return{x:zi(n.x,e.x,i),y:zi(n.y,e.y,i),z:zi(n.z,e.z,i),azimuthal:zi(n.azimuthal,e.azimuthal,i),polar:zi(n.polar,e.polar,i)}}},r.aA=Or,r.aB=b,r.aC=Al,r.aD=Ce,r.aE=st,r.aF=function(n,e){const i={};for(let a=0;a<e.length;a++){const c=e[a];c in n&&(i[c]=n[c])}return i},r.aG=ve,r.aH=Ae,r.aI=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,a){const c=this.entries[n]=this.entries[n]||{callbacks:[]};if(c.result){const[p,m]=c.result;return this.scheduler?this.scheduler.add(()=>{a(p,m)},e):a(p,m),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=i((p,m)=>{c.result=[p,m];for(const v of c.callbacks)this.scheduler?this.scheduler.add(()=>{v(p,m)},e):v(p,m);setTimeout(()=>delete this.entries[n],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(p=>p!==a),c.callbacks.length||(c.cancel(),delete this.entries[n]))}}},r.aJ=function(n,e,i){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},c=>{const p=ds(n.request,(m,v,T,E)=>{m?c(m):v&&c(null,{vectorTile:i?void 0:new Wi.VectorTile(new Wy(v)),rawData:v,cacheControl:T,expires:E})});return()=>{p.cancel(),c()}},e)},r.aK=function(n){_u++,_u>Ks&&(n.getActor().send("enforceCacheSizeLimit",wa),_u=0)},r.aL=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},r.aM=Da,r.aN=Qw,r.aO=rT,r.aP=Kw,r.aQ=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<n.length;a++){const c=document.createElement("source");mo(n[a])||(i.crossOrigin="Anonymous"),c.src=n[a],i.appendChild(c)}return{cancel:()=>{}}},r.aR=hv,r.aS=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>U1(e,0,n))},r.aT=JT,r.aU=class{constructor(n,e,i,a){this.id=n,this.position=e!=null?new oe(e[0],e[1]):new oe(0,0),this.orientation=i??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(pe(n.matrix,e,n.matrix),n.meshes)for(const i of n.meshes){const a=An.applyTransformFast(i.aabb,n.matrix);this.aabb.encapsulate(a)}if(n.children)for(const i of n.children)this._applyTransformations(i,n.matrix)}computeBoundsAndApplyParent(){const n=me([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,i,a,c,p,m=!1){mT(this.matrix,this,n.transform,this.position,e,i,a,c,p,m)}upload(n){if(!this.uploaded){for(const e of this.nodes)lx(e,n);for(const e of this.nodes)_v(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)cx(n)}},r.aV=pi,r.aW=T_,r.aX=Ne,r.aY=Ke,r.aZ=ku,r.a_=ls,r.aa=Kn,r.ab=xl,r.ac=Ge,r.ad=ei,r.ae=Lt,r.af=He,r.ag=Lu,r.ah=qu,r.ai=zi,r.aj=Kt,r.ak=Go,r.al=wn,r.am=ln,r.an=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([i,a]){const c=Vn([1,i,a]);return{x:c.x,y:c.y,z:c.z}}(n.expression.evaluate(e))}interpolate(n,e,i){return{x:zi(n.x,e.x,i),y:zi(n.y,e.y,i),z:zi(n.z,e.z,i)}}},r.ao=function(n,e,i=0,a=!0){const c=new Qt(i,i),p=n.sub(c),m=e.add(c),v=[p,new Qt(m.x,p.y),m,new Qt(p.x,m.y)];return a&&v.push(p.clone()),v},r.ap=function(n,e){const i=[];for(let a=0;a<n.length;a++){const c=et(a-1,-1,n.length-1),p=et(a+1,-1,n.length-1),m=n[a],v=n[p],T=n[c].sub(m).unit(),E=v.sub(m).unit(),R=E.angleWithSep(T.x,T.y),D=T.add(E).unit().mult(-1*e/Math.sin(R/2));i.push(m.add(D))}return i},r.aq=Nw,r.ar=Gu,r.as=function(n,e,i=0){return ct(((e.x-i)*n.scale-n.x)*Kt,(e.y*n.scale-n.y)*Kt,Je(e.z,e.y))},r.at=Qi,r.au=at,r.av=ur,r.aw=X1,r.ax=function(n){let e=1/0,i=1/0,a=-1/0,c=-1/0;for(const p of n)e=Math.min(e,p.x),i=Math.min(i,p.y),a=Math.max(a,p.x),c=Math.max(c,p.y);return{min:new Qt(e,i),max:new Qt(a,c)}},r.ay=Me,r.az=pe,r.b=function(n){return hs.API_FONTS_REGEX.test(n)},r.b$=function(n,e,i){i*=.5;var a=e[0],c=e[1],p=e[2],m=e[3],v=Math.sin(i),T=Math.cos(i);return n[0]=a*T+c*v,n[1]=c*T-a*v,n[2]=p*T+m*v,n[3]=m*T-p*v,n},r.b0=Od,r.b1=cv,r.b2=function(){Wl.isLoading()||Wl.isLoaded()||Pu()!=="deferred"||zm()},r.b3=Rf,r.b4=hi,r.b5=xg,r.b6=Tn,r.b7=L0,r.b8=Uh,r.b9=di,r.bA=function(n,e){const{x:i,y:a}=n.point,c=Kg(i,a,n.worldSize/n._pixelsPerMercatorPixel,0,0);return pe(c,c,Xg(lu(e)))},r.bB=$,r.bC=function(n){return n[0]=0,n[1]=0,n[2]=0,n},r.bD=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},r.bE=Dt,r.bF=_i,r.bG=Rt,r.bH=x_,r.bI=Il,r.bJ=U0,r.bK=function(n,e,i,a,c){const p=5*e+2;n.float32[p+0]=i,n.float32[p+1]=a,n.float32[p+2]=c},r.bL=lv,r.bM=d,r.bN=Ra,r.bO=pa,r.bP=Fy,r.bQ=uT,r.bR=u_,r.bS=h_,r.bT=V0,r.bU=Rw,r.bV=$0,r.bW=xx,r.bX=et,r.bY=Ve,r.bZ=Fn,r.b_=Jr,r.ba=Qo,r.bb=Oh,r.bc=$g,r.bd=kr,r.be=Hd,r.bf=J0,r.bg=function(n,e){const i=qu(e.zoom);if(i===0)return lu(n);const a=Zf(n),c=Wf(a),p=Ce(a.getWest())*e.worldSize,m=Ce(a.getEast())*e.worldSize,v=Ae(a.getNorth())*e.worldSize,T=Ae(a.getSouth())*e.worldSize,E=[p,v,0],R=[m,v,0],D=[p,T,0],P=[m,T,0],j=ge([],e.globeMatrix);return ei(E,E,j),ei(R,R,j),ei(D,D,j),ei(P,P,j),c[0]=Hu(c[0],D,i),c[1]=Hu(c[1],P,i),c[2]=Hu(c[2],R,i),c[3]=Hu(c[3],E,i),An.fromPoints(c)},r.bh=Vh,r.bi=ge,r.bj=Gd,r.bk=Hu,r.bl=Ih,r.bm=yy,r.bn=At,r.bo=fe,r.bp=Ev,r.bq=Wy,r.br=ds,r.bs=function(n,e){const i=[];for(const a in n)a in e||i.push(a);return i},r.bt=Ue,r.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bv=io,r.bw=function(n){var e=new B(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},r.bx=me,r.by=ht,r.bz=_e,r.c=Pl,r.c$=Yr,r.c0=Ao,r.c1=dr,r.c2=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},r.c3=Xe,r.c4=function(n,e,i,a,c){var p,m=1/Math.tan(e/2);return n[0]=m/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0?(n[10]=(c+a)*(p=1/(a-c)),n[14]=2*c*a*p):(n[10]=-1,n[14]=-2*a),n},r.c5=function(n,e,i,a,c,p,m){var v=1/(e-i),T=1/(a-c),E=1/(p-m);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*T,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*E,n[11]=0,n[12]=(e+i)*v,n[13]=(c+a)*T,n[14]=(m+p)*E,n[15]=1,n},r.c6=Pe,r.c7=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},r.c8=tl,r.c9=kh,r.cA=pv,r.cB=je,r.cC=sT,r.cD=function(n){const e=sT(n,!0);return $([],[e[0],e[1],e[4],e[5]])},r.cE=se,r.cF=nr,r.cG=De,r.cH=function(n){const{x:e,y:i}=n.point,{lng:a,lat:c}=n._center;return Kg(e,i,n.worldSize,a,c)},r.cI=kt,r.cJ=nt,r.cK=jd,r.cL=C,r.cM=function(n,e,i){let a=0;for(let c=0;c<2;++c)n[c]>0&&(a+=(n[c]-0)*(n[c]-0)),e[c]<0&&(a+=(0-e[c])*(0-e[c]));return a},r.cN=function(n){return n*n*n*n*n},r.cO=Ie,r.cP=45,r.cQ=il,r.cR=function(n,e,i){const a=Math.sqrt(n*n+e*e+i*i),c=a>0?Math.acos(i/a)*xa:0;let p=n!==0||e!==0?Math.atan2(-e,-n)*xa+90:0;return p<0&&(p+=360),[a,p,c]},r.cS=ct,r.cT=Vn,r.cU=lt,r.cV=Et,r.cW=An,r.cX=Qe,r.cY=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},r.cZ=ax,r.c_=function(n,e){return n.readFields(MI,{icons:[]},e)},r.ca=Xr,r.cb=tc,r.cc=ic,r.cd=oe,r.ce=Uw,r.cf=function(){var n=new B(4);return B!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},r.cg=function(n,e,i){var a=e[0],c=e[1],p=e[2],m=e[3],v=Math.sin(i),T=Math.cos(i);return n[0]=a*T+p*v,n[1]=c*T+m*v,n[2]=a*-v+p*T,n[3]=c*-v+m*T,n},r.ch=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},r.ci=Rn,r.cj=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},r.ck=_s,r.cl=In,r.cm=qg,r.cn=Qn,r.co=aT,r.cp=jh,r.cq=Ud,r.cr=function(n,e,i,a,c,p,m,v,T){if(T.name==="globe")return Ud(n,e,new jh(i,a,c),!1);const E=T_({z:i,x:a,y:c},T);return new An([(p+E.x/E.scale)*e,e*(E.y/E.scale),m],[(p+E.x2/E.scale)*e,e*(E.y2/E.scale),v])},r.cs=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},r.ct=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},r.cu=function(n){const e=Math.round((n+45+360)%360/90)%4;return ee[e]},r.cv=mt,r.cw=gs,r.cx=I,r.cy=function(n){const e=me(new Float64Array(16));pe(e,n.pixelMatrix,n.globeMatrix);const i=[0,V,0],a=[0,H,0];return ei(i,i,e),ei(a,a,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!Qp(n,new oe(n.center.lat,90)),a[0]>0&&a[0]<=n.width&&a[1]>0&&a[1]<=n.height&&!Qp(n,new oe(n.center.lat,-90))]},r.cz=function(n,e){const{scale:i}=n.tileTransform,a=i*Kt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(c,p,m){var v=p[1],T=p[2],E=p[3],R=m[0],D=m[1];return c[0]=p[0]*R,c[1]=v*R,c[2]=T*D,c[3]=E*D,c}(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},r.d=function(n){return hs.API_TILEJSON_REGEX.test(n)},r.d$=Nf,r.d0=dg,r.d1=H0,r.d2=ss,r.d3=tu,r.d4=js,r.d5=vi,r.d6=Ni,r.d7=function(n){const e=n.indexOf(Mh);return e>=0?n.slice(0,e):n},r.d8=function(n){return n.indexOf(Mh)>=0},r.d9=function(n){const e=n.lastIndexOf(Mh);return e>=0?n.slice(e+1):""},r.dA=Yg,r.dB=Bs,r.dC=As,r.dD=256,r.dE=function(n,e){const i=[0,0,0];return ei(i,i,Vh(lu(e.canonical))),ei(i,i,n),i},r.dF=n=>({u_matrix:new ic(n),u_texsize:new tc(n),u_pixels_to_tile_units:new Fd(n),u_device_pixel_ratio:new Xr(n),u_width_scale:new Xr(n),u_floor_width_scale:new Xr(n),u_image:new tl(n),u_units_to_pixels:new tc(n),u_tile_units_to_pixels:new Xr(n),u_alpha_discard_threshold:new Xr(n),u_trim_offset:new tc(n),u_trim_fade_range:new tc(n),u_trim_color:new il(n),u_emissive_strength:new Xr(n),u_zbias_factor:new Xr(n),u_tile_to_meter:new Xr(n),u_ground_shadow_factor:new kh(n),u_pattern_transition:new Xr(n)}),r.dG=n=>({u_matrix:new ic(n),u_pixels_to_tile_units:new Fd(n),u_device_pixel_ratio:new Xr(n),u_width_scale:new Xr(n),u_floor_width_scale:new Xr(n),u_units_to_pixels:new tc(n),u_dash_image:new tl(n),u_gradient_image:new tl(n),u_image_height:new Xr(n),u_texsize:new tc(n),u_tile_units_to_pixels:new Xr(n),u_alpha_discard_threshold:new Xr(n),u_trim_offset:new tc(n),u_trim_fade_range:new tc(n),u_trim_color:new il(n),u_emissive_strength:new Xr(n),u_zbias_factor:new Xr(n),u_tile_to_meter:new Xr(n),u_ground_shadow_factor:new kh(n)}),r.dH=n=>({u_camera_to_center_distance:new Xr(n),u_extrude_scale:new Fd(n),u_device_pixel_ratio:new Xr(n),u_matrix:new ic(n),u_inv_rot_matrix:new ic(n),u_merc_center:new tc(n),u_tile_id:new kh(n),u_zoom_transition:new Xr(n),u_up_dir:new kh(n),u_emissive_strength:new Xr(n)}),r.dI=Lf,r.dJ=PM,r.dK=Hm,r.dL=(n,e,i,a,c,p)=>{const m=n.transform,v=m.projection.name==="globe";let T;if(p.paint.get("circle-pitch-alignment")==="map")if(v){const R=Yg(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;T=Float32Array.from([R,0,0,R])}else T=m.calculatePixelsToTileUnitsMatrix(i);else T=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(m.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ba.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:Jg,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(v){E.u_inv_rot_matrix=a,E.u_merc_center=c,E.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],E.u_zoom_transition=qu(m.zoom);const R=c[0]*Kt,D=c[1]*Kt;E.u_up_dir=m.projection.upVector(new jh(0,0,0),R,D)}return E},r.dM=J1,r.dN=Hs,r.dO=(n,e,i,a,c,p,m,v,T,E)=>{const R=n.transform,D=R.pitch<15?Y1(.07,.7,Me((14-R.zoom)/5,0,1)):.07,P=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Q1(n,e,i,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:R.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_width_scale:p,u_floor_width_scale:m,u_image:0,u_tile_units_to_pixels:K1(e,R),u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(P?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:lt(e.tileID.canonical,0),u_ground_shadow_factor:T,u_pattern_transition:E}},r.dP=(n,e,i,a,c,p,m,v,T,E)=>{const R=n.transform,D=R.calculatePixelsToTileUnitsMatrix(e),P=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",j=R.pitch<15?Y1(.07,.7,Me((14-R.zoom)/5,0,1)):.07;return{u_matrix:Q1(n,e,i,a),u_pixels_to_tile_units:D,u_device_pixel_ratio:p,u_width_scale:m,u_floor_width_scale:v,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:ew(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:K1(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(P?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:j,u_tile_to_meter:lt(e.tileID.canonical,0),u_ground_shadow_factor:E}},r.dQ=Xt,r.dR=em,r.dS=Je,r.dT=gy,r.dU=lm,r.dV=um,r.dW=hu,r.dX=450,r.dY=7,r.dZ=fI,r.d_=En,r.da=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.db=function(n,e,i,a){return n.type==="custom"?new pI(n,e):new AI[n.type](n,e,i,a)},r.dc=Bi,r.dd=function(n){const e=n.indexOf(Mh);return e>=0?n.slice(e+1):""},r.de=class extends xg{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},r.df=Sh,r.dg=Ga,r.dh=function(n){return n({pluginStatus:Ma,pluginURL:Zl}),Sh.on("pluginStateChange",n),n},r.di=Wp,r.dj=class extends ec{constructor(n){super(n),this.current=vs}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.dk=ae,r.dl=function(n,e,i){const a=qu(i.zoom),c=n.style.map._antialias,p=n.terrain&&n.terrain.exaggeration()>0;return a===0&&!c&&!p},r.dm=function(n){const e=n.pixelsPerMeter,i=e/Pe(1,n.center.lat),a=me(new Float64Array(16));return fe(a,a,[n.point.x,n.point.y,0]),se(a,a,[i,i,e]),Float32Array.from(a)},r.dn=Zf,r.dp=function(n){const e=mt-5;n=Me(n,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(wn(n))),3);return Math.round(i*(U.length-1))},r.dq=function(n,e,i,a){const c=e.getNorth(),p=e.getSouth(),m=e.getWest(),v=e.getEast(),T=1<<n.z,E=v-m,R=c-p,D=E/k,P=-R/U[i],j=[0,D,0,P,0,0,c,m,0];if(n.z>0){const G=180/a;Te(j,j,[G/E+1,0,0,0,G/R+1,0,-.5*G/D,.5*G/P,1])}return j[2]=T,j[5]=n.x,j[8]=n.y,j},r.dr=lu,r.ds=function(n,e,i){const a=me(new Float64Array(16)),c=(e/(1<<n)-.5)*Math.PI*2;return we(a,i.globeMatrix,c),Float32Array.from(a)},r.dt=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,c=Math.floor(n.x),p=Math.floor((n.x-c)*a),m=Math.floor(n.y*a),v=this.findDEMTileFor(new Da(i,c,i,p,m));return!(!v||!v.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||n.y<0||n.y>1)return e;const c=a.getSource().maxzoom,p=1<<c,m=Math.floor(n.x),v=n.x-m,T=new Da(c,m,c,Math.floor(v*p),Math.floor(n.y*p)),E=this.findDEMTileFor(T);if(!E||!E.dem)return e;const R=E.dem,D=1<<E.tileID.canonical.z,P=(v*D-E.tileID.canonical.x)*R.dim,j=(n.y*D-E.tileID.canonical.y)*R.dim,G=Math.floor(P),Z=Math.floor(j);return(i?this.exaggeration():1)*zi(zi(R.get(G,Z),R.get(G,Z+1),j-Z),zi(R.get(G+1,Z),R.get(G+1,Z+1),j-Z),P-G)}getAtTileOffset(n,e,i){const a=1<<n.canonical.z;return this.getAtPointOrZero(new Ge(n.wrap+(n.canonical.x+e/Kt)/a,(n.canonical.y+i/Kt)/a))}getAtTileOffsetFunc(n,e,i,a){return c=>{const p=this.getAtTileOffset(n,c.x,c.y),m=a.upVector(n.canonical,c.x,c.y);return Ve(m,m,p*a.upVectorScale(n.canonical,e,i).metersToTile),m}}getForTilePoints(n,e,i,a){if(this.isUsingMockSource())return!1;const c=gg.create(this,n,a);return!!c&&(e.forEach(p=>{p[2]=this.exaggeration()*c.getElevationAt(p[0],p[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,c=1<<n.canonical.z-a.canonical.z;let p=n.canonical.x/c-a.canonical.x,m=n.canonical.y/c-a.canonical.y,v=0;for(let T=0;T<n.canonical.z-a.canonical.z&&!i.leaves[v];T++){p*=2,m*=2;const E=2*Math.floor(m)+Math.floor(p);v=i.childOffsets[v]+E,p%=1,m%=1}return{min:this.exaggeration()*i.minimums[v],max:this.exaggeration()*i.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const c of n){const p=this.getMinMaxForTile(c.tileID);p&&(i=Math.min(i,p.min),a=Math.max(a,p.max),e=!0)}return e?{min:i,max:a}:null}},r.du=Ey,r.dv=ts,r.dw=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},r.dx=ie,r.dy=function(n,e){var i=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=i,n[2]=0,n[3]=-i,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},r.dz=hn,r.e=hs,r.e$=eS,r.e0=256,r.e1=Xg,r.e2=So,r.e3=we,r.e4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},r.e5=Kl,r.e6=Ph,r.e7=vh,r.e8=function(n,e,i,a,c){return Me((n-e)/(i-e)*(c-a)+a,a,c)},r.e9=Ja,r.eA=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},r.eB=Zr,r.eC=X,r.eD=li,r.eE=function(n,e,i,a){return n[0]=e,n[1]=i,n[2]=a,n},r.eF=function([n,e,i]){const a=Math.hypot(n,e,i),c=Math.atan2(n,i),p=.5*Math.PI-Math.acos(-e/a);return new oe(nt(c),nt(p))},r.eG=No,r.eH=rx,r.eI=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(i){if(Xn==null){const a=i.navigator?i.navigator.userAgent:null;Xn=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Xn}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.eJ=function(n,e){wa=n,Ks=e},r.eK=Qp,r.eL=by,r.eM=function(n){const e=[0,0,0],i=me(new Float64Array(16));return pe(i,n.pixelMatrix,n.globeMatrix),ei(e,e,i),new Qt(e[0],e[1])},r.eN=function(){const n=zn;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(xi),zn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.eO=function(){Yr().acquire(xi)},r.eP=Pu,r.eQ=function(n,e,i=!1){if(Ma===oo.deferred||Ma===oo.loading||Ma===oo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Zl=ba.resolveURL(n),Ma=oo.deferred,If=e,Ed(),i||zm()},r.eR=function(n){tn=ba.resolveURL(n),dn||(dn=new qt(Yr(),new fs)),dn.broadcast("setMeshoptUrl",tn)},r.eS=qy,r.eT=function(n){zt=ba.resolveURL(n),dn||(dn=new qt(Yr(),new fs)),dn.broadcast("setDracoUrl",zt)},r.eU=Xu,r.eV=ui,r.eW=function(n){const e=Va();if(!e)return;const i=e.delete(po);n&&i.then(()=>n()).catch(n)},r.eX=jt,r.eY=mi,r.eZ=Cl,r.e_=Yu,r.ea=function(n,e){var i=e[0],a=e[1],c=e[2],p=e[3],m=e[4],v=e[5],T=e[6],E=e[7],R=e[8],D=R*m-v*E,P=-R*p+v*T,j=E*p-m*T,G=i*D+a*P+c*j;return G?(n[0]=D*(G=1/G),n[1]=(-R*a+c*E)*G,n[2]=(v*a-c*m)*G,n[3]=P*G,n[4]=(R*i-c*T)*G,n[5]=(-v*i+c*p)*G,n[6]=j*G,n[7]=(-E*i+a*T)*G,n[8]=(m*i-a*p)*G,n):null},r.eb=Mi,r.ec=Pt,r.ed=sx,r.ee=function(n,e){if(n===e){var i=e[1],a=e[2],c=e[3],p=e[6],m=e[7],v=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=a,n[9]=p,n[11]=e[14],n[12]=c,n[13]=m,n[14]=v}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},r.ef=$e,r.eg=[1,1,1],r.eh=class{constructor(n,e,i,a){this.context=n,this.format=a,this.size=i,this.texture=n.gl.createTexture();const[c,p,m]=this.size,{gl:v}=n;v.bindTexture(v.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),v.texImage3D(v.TEXTURE_3D,0,this.format,c,p,m,0,ex(this.format),tx(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_3D,this.texture),n!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,n),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},r.ei=gg,r.ej=function(n,e,i,a){var c=new B(4);return c[0]=n,c[1]=e,c[2]=i,c[3]=a,c},r.ek=Qr,r.el=function(n,e,i,a){var c=e[0],p=e[1],m=e[2],v=e[3];return n[0]=c+a*(i[0]-c),n[1]=p+a*(i[1]-p),n[2]=m+a*(i[2]-m),n[3]=v+a*(i[3]-v),n},r.em=mg,r.en=ta,r.eo=Jl,r.ep=function(n,e,i,a,c,p,m,v,T,E,R,D,P,j,G,Z){var K=new B(16);return K[0]=n,K[1]=e,K[2]=i,K[3]=a,K[4]=c,K[5]=p,K[6]=m,K[7]=v,K[8]=T,K[9]=E,K[10]=R,K[11]=D,K[12]=P,K[13]=j,K[14]=G,K[15]=Z,K},r.eq=J,r.er=Ql,r.es=zf,r.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Qt(1/0,1/0),max:new Qt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=ag(new Qt(0,0),new Qt(Kt,Kt),n),a=[];if(e&&!ep(i,this._globalClipBounds))return a;for(const c of this._activeRegions){if(c.hiddenByOverlap||!ep(i,c))continue;const p=I0(c.min,c.max,n);a.push({min:p.min,max:p.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask,clipScope:c.clipScope})}return a}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const a of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(a).buckets[e.layer];c&&c.updateFootprints(a.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),a=n.getClipMask(),c=n.getClipScope();for(const p of e){if(!p.footprint)continue;const m=ag(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:i,clipMask:a,clipScope:c})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||sg(e.min,i.min)||sg(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(a,c){const p=(m,v)=>m+v;return a.length-c.length||a.reduce(p,"").localeCompare(c.reduce(p,""))}(e.clipScope,i.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],a=this._prevRegions[e];n=i.priority!==a.priority||!By(i,a)||i.order!==a.order||i.clipMask!==a.clipMask||!io(i.clipScope,a.clipScope),++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==Gh&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const a=this._activeRegions;if(i>=a.length)return i;const c=a[i].priority;for(;i<a.length&&a[i].priority===c;)++i;return i};if(this._sourceIds.length>1){let i=0,a=e(i);for(;i!==a;){let c=i;const p=i;for(;c!==a;){const m=this._activeRegions[c];m.hiddenByOverlap=!1;for(let v=0;v<p;v++){const T=this._activeRegions[v];if(!T.hiddenByOverlap&&m.order===Gh&&ep(m,T)&&(m.hiddenByOverlap=jy(m.footprint,m.tileId,T.footprint,T.tileId),m.hiddenByOverlap))break}++c}i=a,a=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},r.eu=Gh,r.ev=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new Qo,a=new ls,c=[],p=n+1+2,m=e[0]+1,v=e[0]+1+(1+e.length),T=(E,R,D)=>{let P=E===p-1?E-2:E===0?E:E-1;return P+=D?24575:0,[P,R]};for(let E=0;E<p;++E)i.emplaceBack(...T(E,0,!0));for(let E=0;E<m;++E)for(let R=0;R<p;++R)i.emplaceBack(...T(R,E,(R===0||R===p-1)&&!0));for(let E=0;E<e.length;++E){const R=e[E];for(let D=0;D<p;++D)i.emplaceBack(...T(D,R,!0))}for(let E=0;E<e.length;++E){const R=a.length,D=e[E]+1+2,P=new ls;for(let Z=0;Z<D-1;Z++){const K=Z===D-2,te=K?p*(v-e.length+E-Z):p;for(let ce=0;ce<p-1;ce++){const he=Z*p+ce;Z===0||K||ce===0||ce===p-2?(P.emplaceBack(he+1,he,he+te),P.emplaceBack(he+te,he+te+1,he+1)):(a.emplaceBack(he+1,he,he+te),a.emplaceBack(he+te,he+te+1,he+1))}}const j=kr.simpleSegment(0,R,i.length,a.length-R);for(let Z=0;Z<P.uint16.length;Z+=3)a.emplaceBack(P.uint16[Z],P.uint16[Z+1],P.uint16[Z+2]);const G=kr.simpleSegment(0,R,i.length,a.length-R);c.push({withoutSkirts:j,withSkirts:G})}return{vertices:i,indices:a,segments:c}}_createGrid(n){const e=this._fillGridMeshWithLods(k,U);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,$g.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new ls;for(let m=0;m<=k;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Kl,a=new Kl,c=new Kl,p=new Kl;this._poleSegments=[];for(let m=0,v=0;m<C;m++){const T=360/(1<<m);i.emplaceBack(0,-b,0,.5,0),a.emplaceBack(0,-b,0,.5,1),c.emplaceBack(0,-b,0,.5,.5),p.emplaceBack(0,-b,0,.5,.5);for(let E=0;E<=k;E++){let R=E/k,D=0;const P=zi(0,T,R),[j,G,Z]=Q(wy,v0,P,b);i.emplaceBack(j,G,Z,R,D),a.emplaceBack(j,G,Z,R,1-D);const K=wn(P);R=.5+.5*Math.sin(K),D=.5+.5*Math.cos(K),c.emplaceBack(j,G,Z,R,D),p.emplaceBack(j,G,Z,R,1-D)}this._poleSegments.push(kr.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Vd,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(a,Vd,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(c,Vd,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(p,Vd,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},r.ew=xe,r.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.ey=ke,r.ez=Ze,r.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},r.f0=tS,r.f1=$1,r.f2=Ui,r.f3="hd_road_elevation",r.f4=uo,r.f5=si,r.f6=Yd,r.f7=G0,r.f8=pm,r.f9=function(n,e,i,a,c,p,m,v=1,T,E,R){n.createArrays(),n.tilePixelRatio=Kt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const D=n.layers[0].layout,P=n.layers[0]._unevaluatedLayout._values,j={};j.scaleFactor=v,j.textSizeScaleRange=D.get("text-size-scale-range"),j.iconSizeScaleRange=D.get("icon-size-scale-range");const[G,Z]=j.textSizeScaleRange,[K,te]=j.iconSizeScaleRange;j.textScaleFactor=Me(j.scaleFactor,G,Z),j.iconScaleFactor=Me(j.scaleFactor,K,te);const ce=P["text-size"],he=P["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:ze,maxZoom:Be}=n.textSizeData;j.compositeTextSizes=[ce.possiblyEvaluate(new Kn(ze,{worldview:R}),p),ce.possiblyEvaluate(new Kn(Be,{worldview:R}),p)]}if(n.iconSizeData.kind==="composite"){const{minZoom:ze,maxZoom:Be}=n.iconSizeData;j.compositeIconSizes=[he.possiblyEvaluate(new Kn(ze,{worldview:R}),p),he.possiblyEvaluate(new Kn(Be,{worldview:R}),p)]}j.layoutTextSize=ce.possiblyEvaluate(new Kn(m+1,{worldview:R}),p),j.layoutIconSize=he.possiblyEvaluate(new Kn(m+1,{worldview:R}),p),j.textMaxSize=ce.possiblyEvaluate(new Kn(18,{worldview:R}),p);const Y=D.get("symbol-placement"),le=D.get("text-rotation-alignment")==="map"&&Y!=="point",de=D.get("text-size");let be=!1;const Fe=[];for(const ze of n.features){const Be=D.get("text-font").evaluate(ze,{},p).join(","),We=de.evaluate(ze,{},p)*j.textScaleFactor,dt=j.layoutTextSize.evaluate(ze,{},p)*j.textScaleFactor,Bt=j.layoutIconSize.evaluate(ze,{},p)*j.iconScaleFactor,St={horizontal:{},vertical:void 0},Nt=ze.text;let Gt,pt=[0,0];if(Nt){const Hi=Nt.toString(),sn=D.get("text-letter-spacing").evaluate(ze,{},p)*pa,nn=D.get("text-line-height").evaluate(ze,{},p)*pa,fn=Pp(Hi)?sn:0,an=D.get("text-anchor").evaluate(ze,{},p),pn=D.get("text-variable-anchor");if(!pn){const yt=D.get("text-radial-offset").evaluate(ze,{},p);if(yt)pt=Rw(an,[yt*pa,q0]);else{const Jt=D.get("text-offset").evaluate(ze,{},p);pt=[Jt[0]*pa,Jt[1]*pa]}}let Jn=le?"center":D.get("text-justify").evaluate(ze,{},p);const wr=Y==="point",ye=wr?D.get("text-max-width").evaluate(ze,{},p)*pa:1/0,Ee=yt=>{n.allowVerticalPlacement&&Ss(Hi)&&(St.vertical=j0(Nt,e,i,c,Be,ye,nn,an,yt,fn,pt,Il.vertical,!0,dt,We,T))};if(!le&&pn){const yt=Jn==="auto"?pn.map(oi=>$0(oi)):[Jn];let Jt=!1;for(let oi=0;oi<yt.length;oi++){const ri=yt[oi];if(!St.horizontal[ri])if(Jt)St.horizontal[ri]=St.horizontal[0];else{const bi=j0(Nt,e,i,c,Be,ye,nn,"center",ri,fn,pt,Il.horizontal,!1,dt,We,T);bi&&(St.horizontal[ri]=bi,Jt=bi.positionedLines.length===1)}}Ee("left")}else{if(Jn==="auto"&&(Jn=$0(an)),wr||D.get("text-writing-mode").indexOf("horizontal")>=0||!Ss(Hi)){const yt=j0(Nt,e,i,c,Be,ye,nn,an,Jn,fn,pt,Il.horizontal,!1,dt,We,T);yt&&(St.horizontal[Jn]=yt)}Ee(wr?"left":Jn)}}let Ot,ut,ft,Zt,Yt,ki,Ti=!1;const ai=D.get("icon-text-fit").evaluate(ze,{},p);if(ze.icon&&ze.icon.hasPrimary()){const Hi=Pw(ze.icon,n.iconSizeData,P["icon-size"],p,n.zoom,ze,T,j.iconScaleFactor,R);Ot=Hi.iconPrimary,ft=Hi.iconSecondary;const sn=Ot.toString();if(ut=a.get(sn),ut&&(Yt=D.get("icon-offset").evaluate(ze,{},p),ki=D.get("icon-anchor").evaluate(ze,{},p),Gt=GM(c.get(sn),ft?c.get(ft.toString()):void 0,Yt,ki),Ti=ut.sdf,n.sdfIcons===void 0?n.sdfIcons=ut.sdf:n.sdfIcons!==ut.sdf&&Yi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ut.pixelRatio!==n.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),ft){const nn=ft.toString();Zt=a.get(nn)}}be=be||!(!ze.icon||!ze.icon.hasSecondary());const $t=Z0(St.horizontal)||St.vertical;n.iconsInText||(n.iconsInText=!!$t&&$t.iconsInText);const Xi=dt*j.textScaleFactor/pa,{defaultShapedIcon:wi,verticallyShapedIcon:Ei}=JM(n,Gt,D,ze,p,St,Xi,Yt,ai);ai!=="none"&&Gt&&(pw(Gt)||mw(Gt))&&(ev(0,ut,Ot,Gt,wi,ai,E,a,c),ev(0,Zt,ft,Gt,wi,ai,E,a,c),Ei&&(ev(0,ut,Ot,Gt,Ei,ai,E,a,c),ev(0,Zt,ft,Gt,Ei,ai,E,a,c))),Gt=wi,Fe.push({feature:ze,shapedTextOrientations:St,shapedText:$t,shapedIcon:Gt,iconPrimary:Ot,iconSecondary:ft,iconOffset:Yt,iconAnchor:ki,verticallyShapedIcon:Ei,layoutTextSize:dt,layoutIconSize:Bt,textOffset:pt,isSDFIcon:Ti,iconTextFit:ai})}return{featureData:Fe,sizes:j,hasAnySecondaryIcon:be,textAlongLine:le,symbolPlacement:Y}},r.fa=Sw,r.fb=function(n,e,i,a,c,p,m,v,T,E){const{featureData:R,hasAnySecondaryIcon:D,sizes:P,textAlongLine:j,symbolPlacement:G}=e;for(const Z of R){const{shapedIcon:K,verticallyShapedIcon:te,feature:ce,shapedTextOrientations:he,shapedText:Y,layoutTextSize:le,textOffset:de,isSDFIcon:be,iconPrimary:Fe,iconSecondary:ze,iconTextFit:Be,iconOffset:We}=Z;Ow(K,E.iconPositions,Fe,ze),Ow(te,E.iconPositions,Fe,ze),QM(he,E.iconPositions),KM(Fe,ze,E.iconPositions),(Y||K)&&eI(n,ce,he,K,te,T,P,le,0,de,be,a,c,m,v,D,Be,We,j,G)}i&&n.generateCollisionDebugBuffers(p,n.collisionBoxArray,P.textScaleFactor)},r.fc=Wi,r.fd=Sv,r.fe=Fa,r.ff=Ki,r.fg=aw,r.fh=ya,r.fi=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==F1){const i=new Uint32Array(n,0,7),[,,a,c,p,m]=i;e=i.byteLength+c+p+m+p,(a!==n.byteLength||e>=n.byteLength)&&Yi("Invalid b3dm header information.")}return U1(n,e)},r.fj=function(n,e){const i=JT(n);for(const a of i){for(const c of a.meshes)TR(c);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(SR(a.lights,e)))}return i},r.fk=yv,r.fl=Mn,r.fm=Ft,r.fn=Wl,r.fo=oo,r.fp=function(n){Ua(),ro?.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-n;a++)e.delete(i[a]).catch(c=>Yi(c.message))}).catch(i=>Yi(i.message))}).catch(e=>Yi(e.message))},r.g=function(n,e){return Ga(tt(n,{method:"GET"}),e)},r.h=tt,r.i=function(n){return hs.API_STYLE_REGEX.test(n)&&!Pl(n)},r.j=function(n){return n.indexOf("mapbox:")===0},r.k=Cs,r.l=ot,r.m=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.n=function(n,e){return Ga(tt(n,{type:"json"}),e)},r.o=jo,r.p=function(n,e){return Ga(tt(n,{method:"POST"}),e)},r.q=ba,r.r=ra,r.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=ja,r.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},r.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},r.w=Yi,r.x=function(){return Dn||(Dn=new jt),Dn},r.y=mx,r.z=Rr}),L(["./shared"],function(r){function F(nt){const ee=nt?nt.url.toString():void 0;return ee?performance.getEntriesByName(ee):[]}function B(nt){if(typeof nt=="number"||typeof nt=="boolean"||typeof nt=="string"||nt==null)return JSON.stringify(nt);if(Array.isArray(nt)){let ae="[";for(const xe of nt)ae+=`${B(xe)},`;return`${ae}]`}let ee="{";for(const ae of Object.keys(nt).sort())ee+=`${ae}:${B(nt[ae])},`;return`${ee}}`}function $(nt){let ee="";for(const ae of r.bu)ee+=`/${B(nt[ae])}`;return ee}class ie{constructor(ee){this.keyCache={},this._layers={},this._layerConfigs={},ee&&this.replace(ee)}replace(ee,ae){this._layerConfigs={},this._layers={},this.update(ee,[],ae)}update(ee,ae,xe){this._options=xe;for(const Me of ee)this._layerConfigs[Me.id]=Me,(this._layers[Me.id]=r.db(Me,this.scope,null,this._options)).compileFilter(xe),this.keyCache[Me.id]&&delete this.keyCache[Me.id];for(const Me of ae)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};const ke=function(Me,He){const et={};for(let tt=0;tt<Me.length;tt++){const vt=Me[tt];let rt=He&&He[vt.id];rt||(vt.type==="symbol"?rt=vt.id:(rt=$(vt),vt.type==="line"&&vt.paint&&function pi(si){return typeof si=="string"&&si==="line-progress"||(Array.isArray(si)?si.some(pi):!(!si||typeof si!="object")&&Object.values(si).some(pi))}(vt.paint["line-width"])&&(rt+=`/${B(vt.paint["line-width"])}`))),He&&(He[vt.id]=rt);let Xt=et[rt];Xt||(Xt=et[rt]=[]),Xt.push(vt)}const Ue=[];for(const tt in et)Ue.push(et[tt]);return Ue}(Object.values(this._layerConfigs),this.keyCache);for(const Me of ke){const He=Me.map(Xt=>this._layers[Xt.id]),et=He[0];if(et.visibility==="none")continue;const Ue=et.source||"";let tt=this.familiesBySource[Ue];tt||(tt=this.familiesBySource[Ue]={});const vt=et.sourceLayer||"_geojsonTileLayer";let rt=tt[vt];rt||(rt=tt[vt]=[]),rt.push(He)}}}const re=1*r.e_;class Te{constructor(ee){const ae={},xe=[];for(const et in ee){const Ue=ee[et],tt=ae[et]={};for(const vt in Ue.glyphs){const rt=Ue.glyphs[+vt];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const Xt=rt.metrics.localGlyph?re:1,pi={x:0,y:0,w:rt.bitmap.width+2*Xt,h:rt.bitmap.height+2*Xt};xe.push(pi),tt[vt]=pi}}const{w:ke,h:Me}=r.H(xe),He=new r.eZ({width:ke||1,height:Me||1});for(const et in ee){const Ue=ee[et];for(const tt in Ue.glyphs){const vt=Ue.glyphs[+tt];if(!vt||vt.bitmap.width===0||vt.bitmap.height===0)continue;const rt=ae[et][tt],Xt=vt.metrics.localGlyph?re:1;r.eZ.copy(vt.bitmap,He,{x:0,y:0},{x:rt.x+Xt,y:rt.y+Xt},vt.bitmap)}}this.image=He,this.positions=ae}}r.eY(Te,"GlyphAtlas");class _e{constructor(ee){this.tileID=new r.aM(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.lut=ee.lut,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.scope=ee.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.request&&ee.request.collectResourceTiming,this.promoteId=ee.promoteId,this.isSymbolTile=ee.isSymbolTile,this.tileTransform=r.aW(ee.tileID.canonical,ee.projection),this.projection=ee.projection,this.worldview=ee.worldview,this.localizableLayerIds=ee.localizableLayerIds,this.brightness=ee.brightness,this.extraShadowCaster=!!ee.extraShadowCaster,this.tessellationStep=ee.tessellationStep,this.scaleFactor=ee.scaleFactor,this.worldview=ee.worldview}parse(ee,ae,xe,ke,Me,He){this.status="parsing",this.data=ee,this.collisionBoxArray=new r.b0;const et=new r.e$(Object.keys(ee.layers).sort()),Ue=new r.f0(this.tileID,this.promoteId);Ue.bucketLayerIDs=[];const tt={},vt=new r.f1(256,256),rt={featureIndex:Ue,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:vt,availableImages:xe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Xt=[],pi=ae.familiesBySource[this.source];for(const Bi in pi){const Ni=ee.layers[Bi];if(!Ni)continue;let Vi=!1,Ji=!1,Yi=!1;for(const Mn of pi[Bi])Mn[0].type==="symbol"?Vi=!0:Ji=!0,Mn[0].is3D()&&Mn[0].type!=="model"&&(Yi=!0);if(this.extraShadowCaster&&!Yi||this.isSymbolTile===!0&&!Vi||this.isSymbolTile===!1&&!Ji)continue;Ni.version===1&&r.w(`Vector tile source "${this.source}" layer "${Bi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Hn=et.encode(Bi),ir=[];let Vn=!1;for(let Mn=0,Tn=0;Mn<Ni.length;Mn++){const Xn=Ni.feature(Mn),dr=Ue.getId(Xn,Bi);if(this.localizableLayerIds&&this.localizableLayerIds.has(Bi)){const fr=Xn.properties?Xn.properties.worldview:null;if(this.worldview&&typeof fr=="string")if(fr==="all")Xn.properties.$localized=!0;else{if(!fr.split(",").includes(this.worldview))continue;Xn.properties.$localized=!0,Xn.properties.worldview=this.worldview}}!Vn&&Xn.properties&&Xn.properties.hasOwnProperty(r.f2)&&(Vn=!0),ir.push({feature:Xn,id:dr,index:Tn,sourceLayerIndex:Hn}),Tn++}Vn&&!rt.elevationFeatures&&ee.layers.hasOwnProperty(r.f3)&&(rt.elevationFeatures=r.f4.parseFrom(ee.layers[r.f3],this.canonical));for(const Mn of pi[Bi]){const Tn=Mn[0];if(this.extraShadowCaster&&(!Tn.is3D()||Tn.type==="model")||this.isSymbolTile!==void 0&&Tn.type==="symbol"!==this.isSymbolTile||Tn.minzoom&&this.zoom<Math.floor(Tn.minzoom)||Tn.maxzoom&&this.zoom>=Tn.maxzoom||Tn.visibility==="none")continue;me(Mn,this.zoom,rt.brightness,xe,this.worldview);const Xn=tt[Tn.id]=Tn.createBucket({index:Ue.bucketLayerIDs.length,layers:Mn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Hn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:ke,worldview:this.worldview});Ue.bucketLayerIDs.push(Mn.map(fr=>r.C(fr.id,fr.scope)));let dr=Xn.prepare?Xn.prepare():null;dr!=null?(dr=dr.then(()=>Xn.populate(ir,rt,this.tileID.canonical,this.tileTransform)),Xt.push(dr)):Xn.populate(ir,rt,this.tileID.canonical,this.tileTransform)}}const si=()=>{let Bi,Ni,Vi,Ji,Yi,Hn;vt.trim();const ir={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Vn=()=>{if(Bi)return this.status="done",He(Bi);if(this.extraShadowCaster)this.status="done",He(null,{buckets:Object.values(tt).filter(Tn=>!Tn.isEmpty()),featureIndex:Ue,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:rt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ni&&Vi&&Ji){const Tn=new Te(Ni),Xn=new Map;for(const[Fr,Bs]of Vi.entries()){const{imagePosition:As}=r.f7(Fr,Bs,r.f8);Xn.set(Fr,As)}const dr={};for(const Fr in tt){const Bs=tt[Fr];Bs instanceof r.b1&&(me(Bs.layers,this.zoom,rt.brightness,xe,this.worldview),dr[Fr]=r.f9(Bs,Ni,Tn.positions,Vi,Xn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Yi,this.worldview))}const fr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Me,Vi,Yi,()=>{fr.iconsPending=!1,Mn(dr,Tn,fr)}),this.rasterizeIfNeeded(Me,Ji,Hn,()=>{fr.patternsPending=!1,Mn(dr,Tn,fr)})}},Mn=(Tn,Xn,dr,fr)=>{if(dr.iconsPending||dr.patternsPending)return;const Fr=new r.fa(Vi,Ji,this.lut);for(const Bs in tt){const As=tt[Bs];if(Bs in Tn)r.fb(As,Tn[Bs],this.showCollisionBoxes,xe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Vi,Fr);else if(As.hasPattern&&(As instanceof r.b7||As instanceof r.b8||As instanceof r.dU)){me(As.layers,this.zoom,rt.brightness,xe,this.worldview);const Ba=Object.fromEntries(Fr.patternPositions);As.addFeatures(rt,this.tileID.canonical,Ba,xe,this.tileTransform,this.brightness)}}this.status="done",He(null,{buckets:Object.values(tt).filter(Bs=>!Bs.isEmpty()),featureIndex:Ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Xn.image,lineAtlas:vt,imageAtlas:Fr,brightness:rt.brightness})};if(!this.extraShadowCaster){const Tn=r.f5(rt.glyphDependencies,fr=>Object.keys(fr).map(Number));Object.keys(Tn).length?Me.send("getGlyphs",{uid:this.uid,stacks:Tn,scope:this.scope},(fr,Fr)=>{Bi||(Bi=fr,Ni=Fr,Vn())},void 0,!1,ir):Ni={};const Xn=Array.from(rt.iconDependencies.keys()).map(fr=>r.I.parse(fr));Xn.length?Me.send("getImages",{images:Xn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(fr,Fr)=>{Bi||(Bi=fr,Vi=new Map,Yi=this.updateImageMapAndGetImageTaskQueue(Vi,Fr,rt.iconDependencies),Vn())},void 0,!1,ir):(Vi=new Map,Yi=new Map);const dr=Array.from(rt.patternDependencies.keys()).map(fr=>r.I.parse(fr));dr.length?Me.send("getImages",{images:dr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(fr,Fr)=>{Bi||(Bi=fr,Ji=new Map,Hn=this.updateImageMapAndGetImageTaskQueue(Ji,Fr,rt.patternDependencies),Vn())},void 0,!1,ir):(Ji=new Map,Hn=new Map)}if(rt.elevationFeatures&&rt.elevationFeatures.length>0){const Tn=[];for(const dr of Object.values(tt))if(dr instanceof r.b8){const fr=dr.getUnevaluatedPortalGraph();fr&&Tn.push(fr)}const Xn=r.f6.evaluate(Tn);for(const dr of Object.values(tt))if(dr instanceof r.b8){const fr=ee.layers[et.decode(dr.sourceLayerIndex)];dr.setEvaluatedPortalGraph(Xn,fr,this.tileID.canonical,rt.availableImages,rt.brightness)}}Vn()};Xt.length>0?Promise.allSettled(Xt).then(si).catch(He):si()}rasterizeIfNeeded(ee,ae,xe,ke){Array.from(ae.values()).some(Me=>Me.usvg)?this.rasterize(ee,ae,xe,ke):ke()}updateImageMapAndGetImageTaskQueue(ee,ae,xe){const ke=new Map;for(const Me of ae.keys()){const He=xe.get(Me)||[];for(const et of He){const Ue=et.toString(),tt=ae.get(et.id.toString());tt.usvg?ke.has(Ue)||(ke.set(Ue,et),ee.set(Ue,Object.assign({},tt))):ee.set(Ue,tt)}}return ke}rasterize(ee,ae,xe,ke){this.rasterizeTask=ee.send("rasterizeImages",{scope:this.scope,tasks:xe},(Me,He)=>{if(!Me)for(const[et,Ue]of He.entries()){const tt=Object.assign(ae.get(et),{data:Ue});ae.set(et,tt)}ke()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function me(nt,ee,ae,xe,ke){const Me=new r.aa(ee,{brightness:ae,worldview:ke});for(const He of nt)He.recalculate(Me,xe)}class ge extends r.E{constructor(ee,ae,xe,ke,Me,He,et){super(),this.actor=ee,this.layerIndex=ae,this.availableImages=xe,this.availableModels=ke,this.loadVectorData=He||r.aJ,this.loading={},this.loaded={},this.deduped=new r.aI(ee.scheduler),this.isSpriteLoaded=Me,this.scheduler=ee.scheduler,this.brightness=et}loadTile(ee,ae){const xe=ee.uid,ke=ee&&ee.request,Me=ke&&ke.collectResourceTiming,He=this.loading[xe]=new _e(ee);He.abort=this.loadVectorData(ee,(et,Ue)=>{const tt=!this.loading[xe];if(delete this.loading[xe],He.cancelRasterize(),tt||et||!Ue)return He.status="done",tt||(this.loaded[xe]=He),ae(et);const vt=Ue.rawData,rt={};Ue.expires&&(rt.expires=Ue.expires),Ue.cacheControl&&(rt.cacheControl=Ue.cacheControl),He.vectorTile=Ue.vectorTile||new r.fc.VectorTile(new r.bq(vt));const Xt=()=>{He.parse(He.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(pi,si)=>{if(pi||!si)return ae(pi);const Bi={};if(Me){const Ni=F(ke);Ni.length>0&&(Bi.resourceTiming=JSON.parse(JSON.stringify(Ni)))}ae(null,r.h({rawTileData:vt.slice(0)},si,rt,Bi))})};this.isSpriteLoaded?Xt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Xt,{type:"parseTile",isSymbolTile:ee.isSymbolTile,zoom:ee.tileZoom}):Xt()}),this.loaded=this.loaded||{},this.loaded[xe]=He})}reloadTile(ee,ae){const xe=this.loaded,ke=ee.uid;if(xe&&xe[ke]){const Me=xe[ke];Me.scaleFactor=ee.scaleFactor,Me.showCollisionBoxes=ee.showCollisionBoxes,Me.projection=ee.projection,Me.brightness=ee.brightness,Me.tileTransform=r.aW(ee.tileID.canonical,ee.projection),Me.extraShadowCaster=ee.extraShadowCaster,Me.lut=ee.lut,Me.worldview=ee.worldview;const He=(et,Ue)=>{const tt=Me.reloadCallback;tt&&(delete Me.reloadCallback,Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,tt)),ae(et,Ue)};Me.status==="parsing"?Me.reloadCallback=He:Me.status==="done"&&(Me.vectorTile?Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,He):He())}else ae(null,void 0)}abortTile(ee,ae){const xe=ee.uid,ke=this.loading[xe];ke&&(ke.abort&&ke.abort(),delete this.loading[xe]),ae()}removeTile(ee,ae){const xe=this.loaded,ke=ee.uid;xe&&xe[ke]&&delete xe[ke],ae()}}class pe{loadTile(ee,ae){const{uid:xe,encoding:ke,rawImageData:Me,padding:He}=ee,et=ImageBitmap&&Me instanceof ImageBitmap?this.getImageData(Me,He):Me;ae(null,new r.fd(xe,et,ke,He<1))}reloadTile(ee,ae){ae(null,null)}abortTile(ee,ae){ae()}removeTile(ee,ae){ae()}getImageData(ee,ae){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);const xe=this.offscreenCanvasContext.getImageData(-ae,-ae,ee.width+2*ae,ee.height+2*ae);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),xe}}r.bp.setPbf(r.bq);class fe{constructor(ee){this._mrt=new r.bp(ee.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ee.uid,this.tileID=ee.tileID,this.source=ee.source}parse(ee,ae){const xe=this._mrt;this.status="parsing",this._entireBuffer=ee;try{xe.parseHeader(ee),this._isHeaderLoaded=!0;const ke=[];for(const Me in xe.layers){const He=xe.getLayer(Me),et=He.getDataRange(He.getBandList()),Ue=xe.createDecodingTask(et),tt=ee.slice(et.firstByte,et.lastByte+1),vt=r.bp.performDecoding(tt,Ue).then(rt=>Ue.complete(null,rt)).catch(rt=>Ue.complete(rt,null));ke.push(vt)}Promise.allSettled(ke).then(()=>ae(null,xe)).catch(Me=>ae(Me))}catch(ke){ae(ke)}}}class se{constructor(ee){this.actor=ee,this.loading={},this.loaded={}}loadTile(ee,ae){const xe=ee.uid,ke=ee.request,Me=this.loading[xe]=new fe(ee),{cancel:He}=r.br(ke,(et,Ue,tt,vt)=>{const rt=!this.loading[xe];if(delete this.loading[xe],rt||et||!Ue)return Me.status="done",rt||(this.loaded[xe]=Me),ae(et);Me.parse(Ue,(Xt,pi)=>{if(Xt||!pi)return ae(Xt);ae(null,pi,tt,vt)}),this.loaded[xe]=Me});Me.abort=He}reloadTile(ee,ae){ae(null,void 0)}abortTile(ee,ae){const xe=ee.uid,ke=this.loading[xe];ke&&(ke.abort&&ke.abort(),delete this.loading[xe]),ae()}removeTile(ee,ae){const xe=ee.uid;this.loaded[xe]&&delete this.loaded[xe],ae()}decodeRasterArray(ee,ae){r.bp.performDecoding(ee.buffer,ee.task).then(xe=>ae(null,xe)).catch(xe=>ae(xe))}}const De=r.fc.VectorTileFeature.prototype.toGeoJSON;class we{constructor(ee){this._feature=ee,this.extent=r.aj,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const ae of this._feature.geometry)ee.push([new r.P(ae[0],ae[1])]);return ee}{const ee=[];for(const ae of this._feature.geometry){const xe=[];for(const ke of ae)xe.push(new r.P(ke[0],ke[1]));ee.push(xe)}return ee}}toGeoJSON(ee,ae,xe){return De.call(this,ee,ae,xe)}}class ht{constructor(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.aj,this.length=ee.length,this._features=ee}feature(ee){return new we(this._features[ee])}}class At{constructor(ee,ae){this.name=ee,this.extent=r.aj,this.length=ae.length,this._features=ae}feature(ee){return new we(this._features[ee])}}class gt extends ht{constructor(ee){super([]),this.layers={};for(const ae in ee)this.layers[ae]=new At(ae,ee[ae])}}const Xe=64/4096,je=128;class $e{constructor(){this.features=new Map}clear(){this.features.clear()}load(ee=[],ae){for(const xe of ee){const ke=xe.id;if(ke==null)continue;let Me=this.features.get(ke);Me&&this.updateCache(Me,ae),xe.geometry?(Me=Lt(xe),this.updateCache(Me,ae),this.features.set(ke,Me)):this.features.delete(ke),this.updateCache(Me,ae)}}updateCache(ee,ae){for(const{canonical:xe,uid:ke}of Object.values(ae)){const{z:Me,x:He,y:et}=xe;It(ee,Math.pow(2,Me),He,et)&&delete ae[ke]}}getTile(ee,ae,xe){const ke=Math.pow(2,ee),Me=[];for(const He of this.features.values())It(He,ke,ae,xe)&&Me.push(kt(He,ke,ae,xe));return{features:Me}}getFeatures(){return[...this.features.values()]}}function It({minX:nt,minY:ee,maxX:ae,maxY:xe},ke,Me,He){return nt<(Me+1+Xe)/ke&&ee<(He+1+Xe)/ke&&ae>(Me-Xe)/ke&&xe>(He-Xe)/ke}function Lt(nt){const{id:ee,geometry:ae,properties:xe}=nt;if(!ae)return;if(ae.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ke,coordinates:Me}=ae,He={id:ee,type:1,geometry:[],tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},et=He.geometry;if(ke==="Point")ct(Me,et,He);else if(ke==="MultiPoint")for(const Ue of Me)ct(Ue,et,He);else if(ke==="LineString")He.type=2,Et(Me,et,He);else if(ke==="MultiLineString")He.type=2,Qe(Me,et,He);else if(ke==="Polygon")He.type=3,Qe(Me,et,He,!0);else{if(ke!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");He.type=3;for(const Ue of Me)Qe(Ue,et,He,!0)}return He}function ct([nt,ee],ae,xe){const ke=r.aD(nt);let Me=r.aH(ee);Me=Me<0?0:Me>1?1:Me,ae.push(ke,Me),xe.minX=Math.min(xe.minX,ke),xe.minY=Math.min(xe.minY,Me),xe.maxX=Math.max(xe.maxX,ke),xe.maxY=Math.max(xe.maxY,Me)}function Et(nt,ee,ae,xe=!1,ke=!1){const Me=[];for(const He of nt)ct(He,Me,ae);ee.push(Me),xe&&function(He,et){let Ue=0;for(let tt=0,vt=He.length,rt=vt-2;tt<vt;rt=tt,tt+=2)Ue+=(He[tt]-He[rt])*(He[tt+1]+He[rt+1]);if(Ue>0===et)for(let tt=0,vt=He.length;tt<vt/2;tt+=2){const rt=He[tt],Xt=He[tt+1];He[tt]=He[vt-2-tt],He[tt+1]=He[vt-1-tt],He[vt-2-tt]=rt,He[vt-1-tt]=Xt}}(Me,ke)}function Qe(nt,ee,ae,xe=!1){for(let ke=0;ke<nt.length;ke++)Et(nt[ke],ee,ae,xe,ke===0)}function kt(nt,ee,ae,xe){const{id:ke,type:Me,geometry:He,tags:et}=nt,Ue=[];if(Me===1)(function(tt,vt,rt,Xt,pi){for(let si=0;si<tt.length;si+=2){const Bi=Math.round(r.aj*(tt[si+0]*vt-rt)),Ni=Math.round(r.aj*(tt[si+1]*vt-Xt));pi.push([Bi,Ni])}})(He,ee,ae,xe,Ue);else for(const tt of He)ii(tt,ee,ae,xe,Ue);return{id:ke,type:Me,geometry:Ue,tags:et}}function ii(nt,ee,ae,xe,ke){const He=r.aj+je;let et;for(let Ue=0;Ue<nt.length-2;Ue+=2){let tt=Math.round(r.aj*(nt[Ue+0]*ee-ae)),vt=Math.round(r.aj*(nt[Ue+1]*ee-xe)),rt=Math.round(r.aj*(nt[Ue+2]*ee-ae)),Xt=Math.round(r.aj*(nt[Ue+3]*ee-xe));const pi=rt-tt,si=Xt-vt;tt<-128&&rt<-128||(tt<-128?(vt+=Math.round(si*((-128-tt)/pi)),tt=-128):rt<-128&&(Xt=vt+Math.round(si*((-128-tt)/pi)),rt=-128),vt<-128&&Xt<-128||(vt<-128?(tt+=Math.round(pi*((-128-vt)/si)),vt=-128):Xt<-128&&(rt=tt+Math.round(pi*((-128-vt)/si)),Xt=-128),tt>=He&&rt>=He||(tt>=He?(vt+=Math.round(si*((He-tt)/pi)),tt=He):rt>=He&&(Xt=vt+Math.round(si*((He-tt)/pi)),rt=He),vt>=He&&Xt>=He||(vt>=He?(tt+=Math.round(pi*((He-vt)/si)),vt=He):Xt>=He&&(rt=tt+Math.round(pi*((He-vt)/si)),Xt=He),et&&tt===et[et.length-1][0]&&vt===et[et.length-1][1]||(et=[[tt,vt]],ke.push(et)),et.push([rt,Xt])))))}}var Li,Ve,Dt,ti={exports:{}},li=function(){if(Dt)return ti.exports;Dt=1;var nt=r.fg(),ee=function(){if(Ve)return Li;Ve=1;var vt=r.fe(),rt=r.ff().VectorTileFeature;function Xt(si,Bi){this.options=Bi||{},this.features=si,this.length=si.length}function pi(si,Bi){this.id=typeof si.id=="number"?si.id:void 0,this.type=si.type,this.rawGeometry=si.type===1?[si.geometry]:si.geometry,this.properties=si.tags,this.extent=Bi||4096}return Li=Xt,Xt.prototype.feature=function(si){return new pi(this.features[si],this.options.extent)},pi.prototype.loadGeometry=function(){var si=this.rawGeometry;this.geometry=[];for(var Bi=0;Bi<si.length;Bi++){for(var Ni=si[Bi],Vi=[],Ji=0;Ji<Ni.length;Ji++)Vi.push(new vt(Ni[Ji][0],Ni[Ji][1]));this.geometry.push(Vi)}return this.geometry},pi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var si=this.geometry,Bi=1/0,Ni=-1/0,Vi=1/0,Ji=-1/0,Yi=0;Yi<si.length;Yi++)for(var Hn=si[Yi],ir=0;ir<Hn.length;ir++){var Vn=Hn[ir];Bi=Math.min(Bi,Vn.x),Ni=Math.max(Ni,Vn.x),Vi=Math.min(Vi,Vn.y),Ji=Math.max(Ji,Vn.y)}return[Bi,Vi,Ni,Ji]},pi.prototype.toGeoJSON=rt.prototype.toGeoJSON,Li}();function ae(vt){var rt=new nt;return function(Xt,pi){for(var si in Xt.layers)pi.writeMessage(3,xe,Xt.layers[si])}(vt,rt),rt.finish()}function xe(vt,rt){var Xt;rt.writeVarintField(15,vt.version||1),rt.writeStringField(1,vt.name||""),rt.writeVarintField(5,vt.extent||4096);var pi={keys:[],values:[],keycache:{},valuecache:{}};for(Xt=0;Xt<vt.length;Xt++)pi.feature=vt.feature(Xt),rt.writeMessage(2,ke,pi);var si=pi.keys;for(Xt=0;Xt<si.length;Xt++)rt.writeStringField(3,si[Xt]);var Bi=pi.values;for(Xt=0;Xt<Bi.length;Xt++)rt.writeMessage(4,tt,Bi[Xt])}function ke(vt,rt){var Xt=vt.feature;Xt.id!==void 0&&rt.writeVarintField(1,Xt.id),rt.writeMessage(2,Me,vt),rt.writeVarintField(3,Xt.type),rt.writeMessage(4,Ue,Xt)}function Me(vt,rt){var Xt=vt.feature,pi=vt.keys,si=vt.values,Bi=vt.keycache,Ni=vt.valuecache;for(var Vi in Xt.properties){var Ji=Xt.properties[Vi],Yi=Bi[Vi];if(Ji!==null){Yi===void 0&&(pi.push(Vi),Bi[Vi]=Yi=pi.length-1),rt.writeVarint(Yi);var Hn=typeof Ji;Hn!=="string"&&Hn!=="boolean"&&Hn!=="number"&&(Ji=JSON.stringify(Ji));var ir=Hn+":"+Ji,Vn=Ni[ir];Vn===void 0&&(si.push(Ji),Ni[ir]=Vn=si.length-1),rt.writeVarint(Vn)}}}function He(vt,rt){return(rt<<3)+(7&vt)}function et(vt){return vt<<1^vt>>31}function Ue(vt,rt){for(var Xt=vt.loadGeometry(),pi=vt.type,si=0,Bi=0,Ni=Xt.length,Vi=0;Vi<Ni;Vi++){var Ji=Xt[Vi],Yi=1;pi===1&&(Yi=Ji.length),rt.writeVarint(He(1,Yi));for(var Hn=pi===3?Ji.length-1:Ji.length,ir=0;ir<Hn;ir++){ir===1&&pi!==1&&rt.writeVarint(He(2,Hn-1));var Vn=Ji[ir].x-si,Mn=Ji[ir].y-Bi;rt.writeVarint(et(Vn)),rt.writeVarint(et(Mn)),si+=Vn,Bi+=Mn}pi===3&&rt.writeVarint(He(7,1))}}function tt(vt,rt){var Xt=typeof vt;Xt==="string"?rt.writeStringField(1,vt):Xt==="boolean"?rt.writeBooleanField(7,vt):Xt==="number"&&(vt%1!=0?rt.writeDoubleField(3,vt):vt<0?rt.writeSVarintField(6,vt):rt.writeVarintField(5,vt))}return ti.exports=ae,ti.exports.fromVectorTileJs=ae,ti.exports.fromGeojsonVt=function(vt,rt){rt=rt||{};var Xt={};for(var pi in vt)Xt[pi]=new ee(vt[pi].features,rt),Xt[pi].name=pi,Xt[pi].version=rt.version,Xt[pi].extent=rt.extent;return ae({layers:Xt})},ti.exports.GeoJSONWrapper=ee,ti.exports}(),Mi=r.fh(li);const at={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:nt=>nt},Rt=Math.fround||(_i=new Float32Array(1),nt=>(_i[0]=+nt,_i[0]));var _i;const Oi=3,ei=5,hn=6;class In{constructor(ee){this.options=Object.assign(Object.create(at),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:ae,minZoom:xe,maxZoom:ke}=this.options;ae&&console.time("total time");const Me=`prepare ${ee.length} points`;ae&&console.time(Me),this.points=ee;const He=[];for(let Ue=0;Ue<ee.length;Ue++){const tt=ee[Ue];if(!tt.geometry)continue;const[vt,rt]=tt.geometry.coordinates,Xt=Rt(Zr(vt)),pi=Rt(Fn(rt));He.push(Xt,pi,1/0,Ue,-1,1),this.options.reduce&&He.push(0)}let et=this.trees[ke+1]=this._createTree(He);ae&&console.timeEnd(Me);for(let Ue=ke;Ue>=xe;Ue--){const tt=+Date.now();et=this.trees[Ue]=this._createTree(this._cluster(et,Ue)),ae&&console.log("z%d: %d clusters in %dms",Ue,et.numItems,+Date.now()-tt)}return ae&&console.timeEnd("total time"),this}getClusters(ee,ae){let xe=((ee[0]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,ee[1]));let Me=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const He=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)xe=-180,Me=180;else if(xe>Me){const rt=this.getClusters([xe,ke,180,He],ae),Xt=this.getClusters([-180,ke,Me,He],ae);return rt.concat(Xt)}const et=this.trees[this._limitZoom(ae)],Ue=et.range(Zr(xe),Fn(He),Zr(Me),Fn(ke)),tt=et.data,vt=[];for(const rt of Ue){const Xt=this.stride*rt;vt.push(tt[Xt+ei]>1?Rn(tt,Xt,this.clusterProps):this.points[tt[Xt+Oi]])}return vt}getChildren(ee){const ae=this._getOriginId(ee),xe=this._getOriginZoom(ee),ke="No cluster with the specified id.",Me=this.trees[xe];if(!Me)throw new Error(ke);const He=Me.data;if(ae*this.stride>=He.length)throw new Error(ke);const et=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),Ue=Me.within(He[ae*this.stride],He[ae*this.stride+1],et),tt=[];for(const vt of Ue){const rt=vt*this.stride;He[rt+4]===ee&&tt.push(He[rt+ei]>1?Rn(He,rt,this.clusterProps):this.points[He[rt+Oi]])}if(tt.length===0)throw new Error(ke);return tt}getLeaves(ee,ae,xe){const ke=[];return this._appendLeaves(ke,ee,ae=ae||10,xe=xe||0,0),ke}getTile(ee,ae,xe){const ke=this.trees[this._limitZoom(ee)],Me=Math.pow(2,ee),{extent:He,radius:et}=this.options,Ue=et/He,tt=(xe-Ue)/Me,vt=(xe+1+Ue)/Me,rt={features:[]};return this._addTileFeatures(ke.range((ae-Ue)/Me,tt,(ae+1+Ue)/Me,vt),ke.data,ae,xe,Me,rt),ae===0&&this._addTileFeatures(ke.range(1-Ue/Me,tt,1,vt),ke.data,Me,xe,Me,rt),ae===Me-1&&this._addTileFeatures(ke.range(0,tt,Ue/Me,vt),ke.data,-1,xe,Me,rt),rt.features.length?rt:null}getClusterExpansionZoom(ee){let ae=this._getOriginZoom(ee)-1;for(;ae<=this.options.maxZoom;){const xe=this.getChildren(ee);if(ae++,xe.length!==1)break;ee=xe[0].properties.cluster_id}return ae}_appendLeaves(ee,ae,xe,ke,Me){const He=this.getChildren(ae);for(const et of He){const Ue=et.properties;if(Ue&&Ue.cluster?Me+Ue.point_count<=ke?Me+=Ue.point_count:Me=this._appendLeaves(ee,Ue.cluster_id,xe,ke,Me):Me<ke?Me++:ee.push(et),ee.length===xe)break}return Me}_createTree(ee){const ae=new r.bW(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let xe=0;xe<ee.length;xe+=this.stride)ae.add(ee[xe],ee[xe+1]);return ae.finish(),ae.data=ee,ae}_addTileFeatures(ee,ae,xe,ke,Me,He){for(const et of ee){const Ue=et*this.stride,tt=ae[Ue+ei]>1;let vt,rt,Xt;if(tt)vt=Qi(ae,Ue,this.clusterProps),rt=ae[Ue],Xt=ae[Ue+1];else{const Bi=this.points[ae[Ue+Oi]];vt=Bi.properties;const[Ni,Vi]=Bi.geometry.coordinates;rt=Zr(Ni),Xt=Fn(Vi)}const pi={type:1,geometry:[[Math.round(this.options.extent*(rt*Me-xe)),Math.round(this.options.extent*(Xt*Me-ke))]],tags:vt};let si;si=tt||this.options.generateId?ae[Ue+Oi]:this.points[ae[Ue+Oi]].id,si!==void 0&&(pi.id=si),He.features.push(pi)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,ae){const{radius:xe,extent:ke,reduce:Me,minPoints:He}=this.options,et=xe/(ke*Math.pow(2,ae)),Ue=ee.data,tt=[],vt=this.stride;for(let rt=0;rt<Ue.length;rt+=vt){if(Ue[rt+2]<=ae)continue;Ue[rt+2]=ae;const Xt=Ue[rt],pi=Ue[rt+1],si=ee.within(Ue[rt],Ue[rt+1],et),Bi=Ue[rt+ei];let Ni=Bi;for(const Vi of si){const Ji=Vi*vt;Ue[Ji+2]>ae&&(Ni+=Ue[Ji+ei])}if(Ni>Bi&&Ni>=He){let Vi,Ji=Xt*Bi,Yi=pi*Bi,Hn=-1;const ir=(rt/vt<<5)+(ae+1)+this.points.length;for(const Vn of si){const Mn=Vn*vt;if(Ue[Mn+2]<=ae)continue;Ue[Mn+2]=ae;const Tn=Ue[Mn+ei];Ji+=Ue[Mn]*Tn,Yi+=Ue[Mn+1]*Tn,Ue[Mn+4]=ir,Me&&(Vi||(Vi=this._map(Ue,rt,!0),Hn=this.clusterProps.length,this.clusterProps.push(Vi)),Me(Vi,this._map(Ue,Mn)))}Ue[rt+4]=ir,tt.push(Ji/Ni,Yi/Ni,1/0,ir,-1,Ni),Me&&tt.push(Hn)}else{for(let Vi=0;Vi<vt;Vi++)tt.push(Ue[rt+Vi]);if(Ni>1)for(const Vi of si){const Ji=Vi*vt;if(!(Ue[Ji+2]<=ae)){Ue[Ji+2]=ae;for(let Yi=0;Yi<vt;Yi++)tt.push(Ue[Ji+Yi])}}}}return tt}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,ae,xe){if(ee[ae+ei]>1){const He=this.clusterProps[ee[ae+hn]];return xe?Object.assign({},He):He}const ke=this.points[ee[ae+Oi]].properties,Me=this.options.map(ke);return xe&&Me===ke?Object.assign({},Me):Me}}function Rn(nt,ee,ae){return{type:"Feature",id:nt[ee+Oi],properties:Qi(nt,ee,ae),geometry:{type:"Point",coordinates:[(xe=nt[ee],360*(xe-.5)),Qr(nt[ee+1])]}};var xe}function Qi(nt,ee,ae){const xe=nt[ee+ei],ke=xe>=1e4?`${Math.round(xe/1e3)}k`:xe>=1e3?Math.round(xe/100)/10+"k":xe,Me=nt[ee+hn],He=Me===-1?{}:Object.assign({},ae[Me]);return Object.assign(He,{cluster:!0,cluster_id:nt[ee+Oi],point_count:xe,point_count_abbreviated:ke})}function Zr(nt){return nt/360+.5}function Fn(nt){const ee=Math.sin(nt*Math.PI/180),ae=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ae<0?0:ae>1?1:ae}function Qr(nt){const ee=(180-360*nt)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function gs(nt,ee,ae,xe){let ke=xe;const Me=ee+(ae-ee>>1);let He,et=ae-ee;const Ue=nt[ee],tt=nt[ee+1],vt=nt[ae],rt=nt[ae+1];for(let Xt=ee+3;Xt<ae;Xt+=3){const pi=No(nt[Xt],nt[Xt+1],Ue,tt,vt,rt);if(pi>ke)He=Xt,ke=pi;else if(pi===ke){const si=Math.abs(Xt-Me);si<et&&(He=Xt,et=si)}}ke>xe&&(He-ee>3&&gs(nt,ee,He,xe),nt[He+2]=ke,ae-He>3&&gs(nt,He,ae,xe))}function No(nt,ee,ae,xe,ke,Me){let He=ke-ae,et=Me-xe;if(He!==0||et!==0){const Ue=((nt-ae)*He+(ee-xe)*et)/(He*He+et*et);Ue>1?(ae=ke,xe=Me):Ue>0&&(ae+=He*Ue,xe+=et*Ue)}return He=nt-ae,et=ee-xe,He*He+et*et}function Or(nt,ee,ae,xe){const ke={id:nt??null,type:ee,geometry:ae,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")Nr(ke,ae);else if(ee==="Polygon")Nr(ke,ae[0]);else if(ee==="MultiLineString")for(const Me of ae)Nr(ke,Me);else if(ee==="MultiPolygon")for(const Me of ae)Nr(ke,Me[0]);return ke}function Nr(nt,ee){for(let ae=0;ae<ee.length;ae+=3)nt.minX=Math.min(nt.minX,ee[ae]),nt.minY=Math.min(nt.minY,ee[ae+1]),nt.maxX=Math.max(nt.maxX,ee[ae]),nt.maxY=Math.max(nt.maxY,ee[ae+1])}function Jr(nt,ee,ae,xe){if(!ee.geometry)return;const ke=ee.geometry.coordinates;if(ke&&ke.length===0)return;const Me=ee.geometry.type,He=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2);let et=[],Ue=ee.id;if(ae.promoteId?Ue=ee.properties[ae.promoteId]:ae.generateId&&(Ue=xe||0),Me==="Point")Ao(ke,et);else if(Me==="MultiPoint")for(const tt of ke)Ao(tt,et);else if(Me==="LineString")Ja(ke,et,He,!1);else if(Me==="MultiLineString"){if(ae.lineMetrics){for(const tt of ke)et=[],Ja(tt,et,He,!1),nt.push(Or(Ue,"LineString",et,ee.properties));return}Ns(ke,et,He,!1)}else if(Me==="Polygon")Ns(ke,et,He,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(const tt of ee.geometry.geometries)Jr(nt,{id:Ue,geometry:tt,properties:ee.properties},ae,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const tt of ke){const vt=[];Ns(tt,vt,He,!0),et.push(vt)}}nt.push(Or(Ue,Me,et,ee.properties))}function Ao(nt,ee){ee.push(hl(nt[0]),eo(nt[1]),0)}function Ja(nt,ee,ae,xe){let ke,Me,He=0;for(let Ue=0;Ue<nt.length;Ue++){const tt=hl(nt[Ue][0]),vt=eo(nt[Ue][1]);ee.push(tt,vt,0),Ue>0&&(He+=xe?(ke*vt-tt*Me)/2:Math.sqrt(Math.pow(tt-ke,2)+Math.pow(vt-Me,2))),ke=tt,Me=vt}const et=ee.length-3;ee[2]=1,gs(ee,0,et,ae),ee[et+2]=1,ee.size=Math.abs(He),ee.start=0,ee.end=ee.size}function Ns(nt,ee,ae,xe){for(let ke=0;ke<nt.length;ke++){const Me=[];Ja(nt[ke],Me,ae,xe),ee.push(Me)}}function hl(nt){return nt/360+.5}function eo(nt){const ee=Math.sin(nt*Math.PI/180),ae=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ae<0?0:ae>1?1:ae}function Ur(nt,ee,ae,xe,ke,Me,He,et){if(xe/=ee,Me>=(ae/=ee)&&He<xe)return nt;if(He<ae||Me>=xe)return null;const Ue=[];for(const tt of nt){const vt=tt.geometry;let rt=tt.type;const Xt=ke===0?tt.minX:tt.minY,pi=ke===0?tt.maxX:tt.maxY;if(Xt>=ae&&pi<xe){Ue.push(tt);continue}if(pi<ae||Xt>=xe)continue;let si=[];if(rt==="Point"||rt==="MultiPoint")ka(vt,si,ae,xe,ke);else if(rt==="LineString")_s(vt,si,ae,xe,ke,!1,et.lineMetrics);else if(rt==="MultiLineString")xs(vt,si,ae,xe,ke,!1);else if(rt==="Polygon")xs(vt,si,ae,xe,ke,!0);else if(rt==="MultiPolygon")for(const Bi of vt){const Ni=[];xs(Bi,Ni,ae,xe,ke,!0),Ni.length&&si.push(Ni)}if(si.length){if(et.lineMetrics&&rt==="LineString"){for(const Bi of si)Ue.push(Or(tt.id,rt,Bi,tt.tags));continue}rt!=="LineString"&&rt!=="MultiLineString"||(si.length===1?(rt="LineString",si=si[0]):rt="MultiLineString"),rt!=="Point"&&rt!=="MultiPoint"||(rt=si.length===3?"Point":"MultiPoint"),Ue.push(Or(tt.id,rt,si,tt.tags))}}return Ue.length?Ue:null}function ka(nt,ee,ae,xe,ke){for(let Me=0;Me<nt.length;Me+=3){const He=nt[Me+ke];He>=ae&&He<=xe&&aa(ee,nt[Me],nt[Me+1],nt[Me+2])}}function _s(nt,ee,ae,xe,ke,Me,He){let et=Dl(nt);const Ue=ke===0?Na:bs;let tt,vt,rt=nt.start;for(let Ni=0;Ni<nt.length-3;Ni+=3){const Vi=nt[Ni],Ji=nt[Ni+1],Yi=nt[Ni+2],Hn=nt[Ni+3],ir=nt[Ni+4],Vn=ke===0?Vi:Ji,Mn=ke===0?Hn:ir;let Tn=!1;He&&(tt=Math.sqrt(Math.pow(Vi-Hn,2)+Math.pow(Ji-ir,2))),Vn<ae?Mn>ae&&(vt=Ue(et,Vi,Ji,Hn,ir,ae),He&&(et.start=rt+tt*vt)):Vn>xe?Mn<xe&&(vt=Ue(et,Vi,Ji,Hn,ir,xe),He&&(et.start=rt+tt*vt)):aa(et,Vi,Ji,Yi),Mn<ae&&Vn>=ae&&(vt=Ue(et,Vi,Ji,Hn,ir,ae),Tn=!0),Mn>xe&&Vn<=xe&&(vt=Ue(et,Vi,Ji,Hn,ir,xe),Tn=!0),!Me&&Tn&&(He&&(et.end=rt+tt*vt),ee.push(et),et=Dl(nt)),He&&(rt+=tt)}let Xt=nt.length-3;const pi=nt[Xt],si=nt[Xt+1],Bi=ke===0?pi:si;Bi>=ae&&Bi<=xe&&aa(et,pi,si,nt[Xt+2]),Xt=et.length-3,Me&&Xt>=3&&(et[Xt]!==et[0]||et[Xt+1]!==et[1])&&aa(et,et[0],et[1],et[2]),et.length&&ee.push(et)}function Dl(nt){const ee=[];return ee.size=nt.size,ee.start=nt.start,ee.end=nt.end,ee}function xs(nt,ee,ae,xe,ke,Me){for(const He of nt)_s(He,ee,ae,xe,ke,Me,!1)}function aa(nt,ee,ae,xe){nt.push(ee,ae,xe)}function Na(nt,ee,ae,xe,ke,Me){const He=(Me-ee)/(xe-ee);return aa(nt,Me,ae+(ke-ae)*He,1),He}function bs(nt,ee,ae,xe,ke,Me){const He=(Me-ae)/(ke-ae);return aa(nt,ee+(xe-ee)*He,Me,1),He}function Os(nt,ee){const ae=[];for(let xe=0;xe<nt.length;xe++){const ke=nt[xe],Me=ke.type;let He;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")He=oa(ke.geometry,ee);else if(Me==="MultiLineString"||Me==="Polygon"){He=[];for(const et of ke.geometry)He.push(oa(et,ee))}else if(Me==="MultiPolygon"){He=[];for(const et of ke.geometry){const Ue=[];for(const tt of et)Ue.push(oa(tt,ee));He.push(Ue)}}ae.push(Or(ke.id,Me,He,ke.tags))}return ae}function oa(nt,ee){const ae=[];ae.size=nt.size,nt.start!==void 0&&(ae.start=nt.start,ae.end=nt.end);for(let xe=0;xe<nt.length;xe+=3)ae.push(nt[xe]+ee,nt[xe+1],nt[xe+2]);return ae}function _a(nt,ee){if(nt.transformed)return nt;const ae=1<<nt.z,xe=nt.x,ke=nt.y;for(const Me of nt.features){const He=Me.geometry,et=Me.type;if(Me.geometry=[],et===1)for(let Ue=0;Ue<He.length;Ue+=2)Me.geometry.push(On(He[Ue],He[Ue+1],ee,ae,xe,ke));else for(let Ue=0;Ue<He.length;Ue++){const tt=[];for(let vt=0;vt<He[Ue].length;vt+=2)tt.push(On(He[Ue][vt],He[Ue][vt+1],ee,ae,xe,ke));Me.geometry.push(tt)}}return nt.transformed=!0,nt}function On(nt,ee,ae,xe,ke,Me){return[Math.round(ae*(nt*xe-ke)),Math.round(ae*(ee*xe-Me))]}function ya(nt,ee,ae,xe,ke){const Me=ee===ke.maxZoom?0:ke.tolerance/((1<<ee)*ke.extent),He={features:[],numPoints:0,numSimplified:0,numFeatures:nt.length,source:null,x:ae,y:xe,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const et of nt)Co(He,et,Me,ke);return He}function Co(nt,ee,ae,xe){const ke=ee.geometry,Me=ee.type,He=[];if(nt.minX=Math.min(nt.minX,ee.minX),nt.minY=Math.min(nt.minY,ee.minY),nt.maxX=Math.max(nt.maxX,ee.maxX),nt.maxY=Math.max(nt.maxY,ee.maxY),Me==="Point"||Me==="MultiPoint")for(let et=0;et<ke.length;et+=3)He.push(ke[et],ke[et+1]),nt.numPoints++,nt.numSimplified++;else if(Me==="LineString")Fs(He,ke,nt,ae,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(let et=0;et<ke.length;et++)Fs(He,ke[et],nt,ae,Me==="Polygon",et===0);else if(Me==="MultiPolygon")for(let et=0;et<ke.length;et++){const Ue=ke[et];for(let tt=0;tt<Ue.length;tt++)Fs(He,Ue[tt],nt,ae,!0,tt===0)}if(He.length){let et=ee.tags||null;if(Me==="LineString"&&xe.lineMetrics){et={};for(const tt in ee.tags)et[tt]=ee.tags[tt];et.mapbox_clip_start=ke.start/ke.size,et.mapbox_clip_end=ke.end/ke.size}const Ue={geometry:He,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:et};ee.id!==null&&(Ue.id=ee.id),nt.features.push(Ue)}}function Fs(nt,ee,ae,xe,ke,Me){const He=xe*xe;if(xe>0&&ee.size<(ke?He:xe))return void(ae.numPoints+=ee.length/3);const et=[];for(let Ue=0;Ue<ee.length;Ue+=3)(xe===0||ee[Ue+2]>He)&&(ae.numSimplified++,et.push(ee[Ue],ee[Ue+1])),ae.numPoints++;ke&&function(Ue,tt){let vt=0;for(let rt=0,Xt=Ue.length,pi=Xt-2;rt<Xt;pi=rt,rt+=2)vt+=(Ue[rt]-Ue[pi])*(Ue[rt+1]+Ue[pi+1]);if(vt>0===tt)for(let rt=0,Xt=Ue.length;rt<Xt/2;rt+=2){const pi=Ue[rt],si=Ue[rt+1];Ue[rt]=Ue[Xt-2-rt],Ue[rt+1]=Ue[Xt-1-rt],Ue[Xt-2-rt]=pi,Ue[Xt-1-rt]=si}}(et,Me),nt.push(et)}const dl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class to{constructor(ee,ae){const xe=(ae=this.options=function(Me,He){for(const et in He)Me[et]=He[et];return Me}(Object.create(dl),ae)).debug;if(xe&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");let ke=function(Me,He){const et=[];if(Me.type==="FeatureCollection")for(let Ue=0;Ue<Me.features.length;Ue++)Jr(et,Me.features[Ue],He,Ue);else Jr(et,Me.type==="Feature"?Me:{geometry:Me},He);return et}(ee,ae);this.tiles={},this.tileCoords=[],xe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ke=function(Me,He){const et=He.buffer/He.extent;let Ue=Me;const tt=Ur(Me,1,-1-et,et,0,-1,2,He),vt=Ur(Me,1,1-et,2+et,0,-1,2,He);return(tt||vt)&&(Ue=Ur(Me,1,-et,1+et,0,-1,2,He)||[],tt&&(Ue=Os(tt,1).concat(Ue)),vt&&(Ue=Ue.concat(Os(vt,-1)))),Ue}(ke,ae),ke.length&&this.splitTile(ke,0,0,0),xe&&(ke.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,ae,xe,ke,Me,He,et){const Ue=[ee,ae,xe,ke],tt=this.options,vt=tt.debug;for(;Ue.length;){ke=Ue.pop(),xe=Ue.pop(),ae=Ue.pop(),ee=Ue.pop();const rt=1<<ae,Xt=Fa(ae,xe,ke);let pi=this.tiles[Xt];if(!pi&&(vt>1&&console.time("creation"),pi=this.tiles[Xt]=ya(ee,ae,xe,ke,tt),this.tileCoords.push({z:ae,x:xe,y:ke}),vt)){vt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,xe,ke,pi.numFeatures,pi.numPoints,pi.numSimplified),console.timeEnd("creation"));const Tn=`z${ae}`;this.stats[Tn]=(this.stats[Tn]||0)+1,this.total++}if(pi.source=ee,Me==null){if(ae===tt.indexMaxZoom||pi.numPoints<=tt.indexMaxPoints)continue}else{if(ae===tt.maxZoom||ae===Me)continue;if(Me!=null){const Tn=Me-ae;if(xe!==He>>Tn||ke!==et>>Tn)continue}}if(pi.source=null,ee.length===0)continue;vt>1&&console.time("clipping");const si=.5*tt.buffer/tt.extent,Bi=.5-si,Ni=.5+si,Vi=1+si;let Ji=null,Yi=null,Hn=null,ir=null,Vn=Ur(ee,rt,xe-si,xe+Ni,0,pi.minX,pi.maxX,tt),Mn=Ur(ee,rt,xe+Bi,xe+Vi,0,pi.minX,pi.maxX,tt);ee=null,Vn&&(Ji=Ur(Vn,rt,ke-si,ke+Ni,1,pi.minY,pi.maxY,tt),Yi=Ur(Vn,rt,ke+Bi,ke+Vi,1,pi.minY,pi.maxY,tt),Vn=null),Mn&&(Hn=Ur(Mn,rt,ke-si,ke+Ni,1,pi.minY,pi.maxY,tt),ir=Ur(Mn,rt,ke+Bi,ke+Vi,1,pi.minY,pi.maxY,tt),Mn=null),vt>1&&console.timeEnd("clipping"),Ue.push(Ji||[],ae+1,2*xe,2*ke),Ue.push(Yi||[],ae+1,2*xe,2*ke+1),Ue.push(Hn||[],ae+1,2*xe+1,2*ke),Ue.push(ir||[],ae+1,2*xe+1,2*ke+1)}}getTile(ee,ae,xe){ee=+ee,ae=+ae,xe=+xe;const ke=this.options,{extent:Me,debug:He}=ke;if(ee<0||ee>24)return null;const et=1<<ee,Ue=Fa(ee,ae=ae+et&et-1,xe);if(this.tiles[Ue])return _a(this.tiles[Ue],Me);He>1&&console.log("drilling down to z%d-%d-%d",ee,ae,xe);let tt,vt=ee,rt=ae,Xt=xe;for(;!tt&&vt>0;)vt--,rt>>=1,Xt>>=1,tt=this.tiles[Fa(vt,rt,Xt)];return tt&&tt.source?(He>1&&(console.log("found parent tile z%d-%d-%d",vt,rt,Xt),console.time("drilling down")),this.splitTile(tt.source,vt,rt,Xt,ee,ae,xe),He>1&&console.timeEnd("drilling down"),this.tiles[Ue]?_a(this.tiles[Ue],Me):null):null}}function Fa(nt,ee,ae){return 32*((1<<nt)*ae+ee)+nt}function Qt(nt,ee){const ae=nt.tileID.canonical;if(!this._geoJSONIndex)return void ee(null,null);const xe=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!xe)return void ee(null,null);const ke=Ue=>Ue.tags&&"3d_elevation_id"in Ue.tags&&"source"in Ue.tags&&Ue.tags.source==="elevation",Me=xe.features.filter(Ue=>ke(Ue));let He;if(Me.length>0){const Ue=xe.features.filter(tt=>!ke(tt));He=new gt({_geojsonTileLayer:Ue,hd_road_elevation:Me})}else He=new ht(xe.features);let et=Mi(He);et.byteOffset===0&&et.byteLength===et.buffer.byteLength||(et=new Uint8Array(et)),ee(null,{vectorTile:He,rawData:et.buffer})}class io extends ge{constructor(ee,ae,xe,ke,Me,He,et){super(ee,ae,xe,ke,Me,Qt,et),He&&(this.loadGeoJSON=He),this._dynamicIndex=new $e}loadData(ee,ae){const xe=ee&&ee.request,ke=xe&&xe.collectResourceTiming;this.loadGeoJSON(ee,(Me,He)=>{if(Me||!He)return ae(Me);if(typeof He!="object")return ae(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));{try{if(ee.filter){const Ue=r.X(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ue.result==="error")throw new Error(Ue.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));He.features=He.features.filter(tt=>Ue.value.evaluate({zoom:0},tt))}ee.dynamic?(He.type==="Feature"&&(He={type:"FeatureCollection",features:[He]}),ee.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(He.features,this.loaded),ee.cluster&&(He.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ee.cluster?new In(function({superclusterOptions:Ue,clusterProperties:tt}){if(!tt||!Ue)return Ue;const vt={},rt={},Xt={accumulated:null,zoom:0},pi={properties:null},si=Object.keys(tt);for(const Bi of si){const[Ni,Vi]=tt[Bi],Ji=r.X(Vi),Yi=r.X(typeof Ni=="string"?[Ni,["accumulated"],["get",Bi]]:Ni);vt[Bi]=Ji.value,rt[Bi]=Yi.value}return Ue.map=Bi=>{pi.properties=Bi;const Ni={};for(const Vi of si)Ni[Vi]=vt[Vi].evaluate(Xt,pi);return Ni},Ue.reduce=(Bi,Ni)=>{pi.properties=Ni;for(const Vi of si)Xt.accumulated=Bi[Vi],Bi[Vi]=rt[Vi].evaluate(Xt,pi)},Ue}(ee)).load(He.features):ee.dynamic?this._dynamicIndex:function(Ue,tt){return new to(Ue,tt)}(He,ee.geojsonVtOptions)}catch(Ue){return ae(Ue)}const et={};if(ke){const Ue=F(xe);Ue&&(et.resourceTiming={},et.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Ue)))}ae(null,et)}})}reloadTile(ee,ae){const xe=this.loaded;return xe&&xe[ee.uid]?ee.partial?ae(null,void 0):super.reloadTile(ee,ae):this.loadTile(ee,ae)}loadGeoJSON(ee,ae){if(ee.request)r.n(ee.request,ae);else{if(typeof ee.data!="string")return ae(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));try{return ae(null,JSON.parse(ee.data))}catch{return ae(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ee,ae){try{ae(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(xe){ae(xe)}}getClusterChildren(ee,ae){try{ae(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(xe){ae(xe)}}getClusterLeaves(ee,ae){try{ae(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(xe){ae(xe)}}}class va{constructor(ee,ae,xe){this.tileID=new r.aM(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ee.projection,this.brightness=ae,this.worldview=xe}parse(ee,ae,xe,ke){this.status="parsing";const Me=new r.aM(xe.tileID.overscaledZ,xe.tileID.wrap,xe.tileID.canonical.z,xe.tileID.canonical.x,xe.tileID.canonical.y),He=[],et=ae.familiesBySource[xe.source],Ue=new r.f0(Me,xe.promoteId);Ue.bucketLayerIDs=[],Ue.is3DTile=!0,r.fi(ee).then(tt=>{if(!tt)return ke(new Error("Could not parse tile"));const vt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("MAPBOX_mesh_features")||tt.json.asset.extras&&tt.json.asset.extras.MAPBOX_mesh_features,rt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("EXT_meshopt_compression"),Xt=new r.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const pi in et)for(const si of et[pi]){const Bi=si[0];Ue.bucketLayerIDs.push(si.map(Ji=>r.C(Ji.id,Ji.scope))),Bi.recalculate(Xt,[]);const Ni=r.fj(tt,1/r.cU(xe.tileID.canonical)),Vi=new r.fk(si,Ni,Me,vt,rt,this.brightness,Ue,this.worldview);vt||(Vi.needsUpload=!0),He.push(Vi),Vi.evaluate(Bi)}this.status="done",ke(null,{buckets:He,featureIndex:Ue,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(tt=>ke(new Error(tt.message)))}}class xa{constructor(ee,ae,xe,ke,Me,He,et,Ue){this.actor=ee,this.layerIndex=ae,this.availableImages=xe,this.availableModels=ke,this.brightness=et,this.loading={},this.loaded={},this.worldview=Ue}loadTile(ee,ae){const xe=ee.uid,ke=this.loading[xe]=new va(ee,this.brightness,this.worldview);r.br(ee.request,(Me,He)=>{const et=!this.loading[xe];return delete this.loading[xe],et||Me?(ke.status="done",et||(this.loaded[xe]=ke),ae(Me)):He&&He.byteLength!==0?void ke.parse(He,this.layerIndex,ee,(Ue,tt)=>{ke.status="done",this.loaded=this.loaded||{},this.loaded[xe]=ke,Ue||!tt?ae(Ue):ae(null,tt)}):(ke.status="done",this.loaded[xe]=ke,ae())})}reloadTile(ee,ae){const xe=this.loaded,ke=ee.uid;if(xe&&xe[ke]){const Me=xe[ke];Me.projection=ee.projection,Me.brightness=ee.brightness;const He=(et,Ue)=>{Me.reloadCallback&&(delete Me.reloadCallback,this.loadTile(ee,ae)),ae(et,Ue)};Me.status==="parsing"?Me.reloadCallback=He:Me.status==="done"&&this.loadTile(ee,ae)}}abortTile(ee,ae){const xe=ee.uid;this.loading[xe]&&delete this.loading[xe],ae()}removeTile(ee,ae){const xe=this.loaded,ke=ee.uid;xe&&xe[ke]&&delete xe[ke],ae()}}class wn{constructor(ee){this.self=ee,this.actor=new r.fm(ee,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.ce({name:"mercator"}),this.workerSourceTypes={vector:ge,geojson:io,"raster-dem":pe,"raster-array":se,"batched-model":xa},this.workerSources={},this.self.registerWorkerSource=(ae,xe)=>{if(this.workerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.workerSourceTypes[ae]=xe},this.self.registerRTLTextPlugin=ae=>{if(r.fn.isParsed())throw new Error("RTL text plugin already registered.");r.fn.setState({pluginStatus:r.fo.parsed,pluginURL:r.fn.getPluginURL()}),r.fn.applyArabicShaping=ae.applyArabicShaping,r.fn.processBidirectionalText=ae.processBidirectionalText,r.fn.processStyledBidirectionalText=ae.processStyledBidirectionalText;for(const xe of this.rtlPluginParsingListeners)xe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ee,ae,xe){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.availableModels[ee],delete this.workerSources[ee],xe()}checkIfReady(ee,ae,xe){xe()}setReferrer(ee,ae){this.referrer=ae}spriteLoaded(ee,ae){this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={});const{scope:xe,isLoaded:ke}=ae;if(this.isSpriteLoaded[ee][xe]=ke,this.workerSources[ee]&&this.workerSources[ee][xe])for(const Me in this.workerSources[ee][xe]){const He=this.workerSources[ee][xe][Me];for(const et in He){const Ue=He[et];Ue instanceof ge&&(Ue.isSpriteLoaded=ke,Ue.fire(new r.A("isSpriteLoaded")))}}}setImages(ee,ae,xe){this.availableImages[ee]||(this.availableImages[ee]={});const{scope:ke,images:Me}=ae;if(this.availableImages[ee][ke]=Me,this.workerSources[ee]&&this.workerSources[ee][ke]){for(const He in this.workerSources[ee][ke]){const et=this.workerSources[ee][ke][He];for(const Ue in et)et[Ue].availableImages=Me}xe()}else xe()}setModels(ee,{scope:ae,models:xe},ke){if(this.availableModels[ee]||(this.availableModels[ee]={}),this.availableModels[ee][ae]=xe,this.workerSources[ee]&&this.workerSources[ee][ae]){for(const Me in this.workerSources[ee][ae]){const He=this.workerSources[ee][ae][Me];for(const et in He)He[et].availableModels=xe}ke()}else ke()}setProjection(ee,ae){this.projections[ee]=r.ce(ae)}setBrightness(ee,ae,xe){this.brightness=ae,xe()}setWorldview(ee,ae,xe){this.worldview=ae,xe()}setLayers(ee,ae,xe){this.getLayerIndex(ee,ae.scope).replace(ae.layers,ae.options),xe()}updateLayers(ee,ae,xe){this.getLayerIndex(ee,ae.scope).update(ae.layers,ae.removedIds,ae.options),xe()}loadTile(ee,ae,xe){ae.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,ae.type,ae.source,ae.scope).loadTile(ae,xe)}decodeRasterArray(ee,ae,xe){this.getWorkerSource(ee,ae.type,ae.source,ae.scope).decodeRasterArray(ae,xe)}reloadTile(ee,ae,xe){ae.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,ae.type,ae.source,ae.scope).reloadTile(ae,xe)}abortTile(ee,ae,xe){this.getWorkerSource(ee,ae.type,ae.source,ae.scope).abortTile(ae,xe)}removeTile(ee,ae,xe){this.getWorkerSource(ee,ae.type,ae.source,ae.scope).removeTile(ae,xe)}removeSource(ee,ae,xe){if(!(this.workerSources[ee]&&this.workerSources[ee][ae.scope]&&this.workerSources[ee][ae.scope][ae.type]&&this.workerSources[ee][ae.scope][ae.type][ae.source]))return;const ke=this.workerSources[ee][ae.scope][ae.type][ae.source];delete this.workerSources[ee][ae.scope][ae.type][ae.source],ke.removeSource!==void 0?ke.removeSource(ae,xe):xe()}loadWorkerSource(ee,ae,xe){try{this.self.importScripts(ae.url),xe()}catch(ke){xe(ke.toString())}}syncRTLPluginState(ee,ae,xe){if(r.fn.isParsed())xe(null,!0);else if(r.fn.isParsing())this.rtlPluginParsingListeners.push(xe);else try{r.fn.setState(ae);const ke=r.fn.getPluginURL();!r.fn.isLoaded()||r.fn.isParsed()||r.fn.isParsing()||ke==null||(r.fn.setState({pluginStatus:r.fo.parsing,pluginURL:r.fn.getPluginURL()}),this.self.importScripts(ke),r.fn.isParsed()?xe(null,!0):this.rtlPluginParsingListeners.push(xe))}catch(ke){xe(ke.toString())}}setDracoUrl(ee,ae){this.dracoUrl=ae}getAvailableImages(ee,ae){this.availableImages[ee]||(this.availableImages[ee]={});let xe=this.availableImages[ee][ae];return xe||(xe=[]),xe}getAvailableModels(ee,ae){this.availableModels[ee]||(this.availableModels[ee]={});let xe=this.availableModels[ee][ae];return xe||(xe={}),xe}getLayerIndex(ee,ae){this.layerIndexes[ee]||(this.layerIndexes[ee]={});let xe=this.layerIndexes[ee][ae];return xe||(xe=this.layerIndexes[ee][ae]=new ie,xe.scope=ae),xe}getWorkerSource(ee,ae,xe,ke){const Me=this.workerSources;return Me[ee]||(Me[ee]={}),Me[ee][ke]||(Me[ee][ke]={}),Me[ee][ke][ae]||(Me[ee][ke][ae]={}),this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),Me[ee][ke][ae][xe]||(Me[ee][ke][ae][xe]=new this.workerSourceTypes[ae]({send:(He,et,Ue,tt,vt,rt)=>this.actor.send(He,et,Ue,ee,vt,rt),scheduler:this.actor.scheduler},this.getLayerIndex(ee,ke),this.getAvailableImages(ee,ke),this.getAvailableModels(ee,ke),this.isSpriteLoaded[ee][ke],void 0,this.brightness,this.worldview)),Me[ee][ke][ae][xe]}rasterizeImagesWorker(ee,ae,xe){const ke=new Map;for(const[Me,{image:He,imageVariant:et}]of ae.tasks.entries()){const Ue=this.imageRasterizer.rasterize(et,He,ae.scope,ee);ke.set(Me,Ue)}xe(void 0,ke)}removeRasterizedImages(ee,ae,xe){this.imageRasterizer.removeImagesFromCacheByIds(ae.imageIds,ae.scope,ee),xe()}enforceCacheSizeLimit(ee,ae){r.fp(ae)}getWorkerPerformanceMetrics(ee,ae,xe){xe(void 0,void 0)}}return r.fl(self)&&(self.worker=new wn(self)),wn}),L(["./shared"],function(r){var F="3.13.0";const B={create:"create",load:"load",fullLoad:"fullLoad"},$={mark(u){performance.mark(u)},measure(u,t,s){performance.measure(u,t,s)}};function ie(u){const t=u.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var re,Te={},_e=function(){if(re)return Te;function u(h){return!t(h)}function t(h){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,C=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(C);try{b=new Worker(I),y=!0}catch{y=!1}return b&&b.terminate(),URL.revokeObjectURL(I),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var C=b.getImageData(0,0,1,1);return C&&C.width===y.width}()?(s[_=h&&h.failIfMajorPerformanceCaveat]===void 0&&(s[_]=function(y){var b,C=function(I){var O=document.createElement("canvas"),k=Object.create(u.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=I,O.getContext("webgl2",k)}(y);if(!C)return!1;try{b=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!b||C.isContextLost())&&(C.shaderSource(b,"void main() {}"),C.compileShader(b),C.getShaderParameter(b,C.COMPILE_STATUS)===!0)}(_)),s[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}re=1,Te.supported=u,Te.notSupportedReason=t;var s={};return u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Te}();function me(u,t,s){const h=document.createElement(u);return t!=null&&(h.className=t),s&&s.appendChild(h),h}function ge(u,t,s){const h=document.createElementNS("http://www.w3.org/2000/svg",u);for(const _ of Object.keys(t))h.setAttributeNS(null,_,String(t[_]));return s&&s.appendChild(h),h}const pe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,fe=pe&&pe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let se;function De(){pe&&fe&&(se=pe[fe],pe[fe]="none")}function we(){pe&&fe&&(pe[fe]=se)}function ht(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",ht,!0)}function At(){window.addEventListener("click",ht,!0),window.setTimeout(()=>{window.removeEventListener("click",ht,!0)},0)}function gt(u,t){const s=u.getBoundingClientRect();return $e(u,s,t)}function Xe(u,t){const s=u.getBoundingClientRect(),h=[];for(let _=0;_<t.length;_++)h.push($e(u,s,t[_]));return h}function je(u){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&u.button===2&&u.ctrlKey?0:u.button}function $e(u,t,s){const h=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new r.P((s.clientX-t.left)*h,(s.clientY-t.top)*h)}const It="01",Lt="NO_ACCESS_TOKEN";class ct{constructor(t,s,h){this._transformRequestFn=t,this._customAccessToken=s,this._silenceAuthErrors=!!h,this._createSkuToken()}_createSkuToken(){const t=function(){let s="";for(let h=0;h<10;h++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",It,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeStyleURL(t,s){if(!r.j(t))return t;const h=Qe(t);return h.params.push(`sdk=js-${F}`),h.path=`/styles/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeGlyphsURL(t,s){if(!r.j(t))return t;const h=Qe(t);return h.path=`/fonts/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeModelURL(t,s){if(!r.j(t))return t;const h=Qe(t);return h.path=`/models/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeSourceURL(t,s,h,_){if(!r.j(t))return t;const y=Qe(t);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),h&&y.params.push(`language=${h}`),_&&y.params.push(`worldview=${_}`),this._makeAPIURL(y,this._customAccessToken||s)}normalizeIconsetURL(t,s){const h=Qe(t);return r.j(t)?(h.path=`/styles/v1${h.path}/iconset.pbf`,this._makeAPIURL(h,this._customAccessToken||s)):kt(h)}normalizeSpriteURL(t,s,h,_){const y=Qe(t);return r.j(t)?(y.path=`/styles/v1${y.path}/sprite${s}${h}`,this._makeAPIURL(y,this._customAccessToken||_)):(y.path+=`${s}${h}`,kt(y))}normalizeTileURL(t,s,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.j(t))return t;const _=Qe(t);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||h&&_.authority!=="raster"&&h===512?"@2x":""}${r.l.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${r.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${r.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${r.e.TILE_URL_VERSION}${_.path}`);const y=this._customAccessToken||function(b){for(const C of b){const I=C.match(/^access_token=(.*)$/);if(I)return I[1]}return null}(_.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,y)}canonicalizeTileURL(t,s){const h=Qe(t);if(!h.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!h.path.match(/\.[\w]+$/))return t;let _="mapbox://";h.path.match(/^\/raster\/v1\//)?_+=`raster/${h.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:h.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${h.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${h.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let y=h.params;return s&&(y=y.filter(b=>!b.match(/^access_token=/))),y.length&&(_+=`?${y.join("&")}`),_}canonicalizeTileset(t,s){const h=!!s&&r.j(s),_=[];for(const y of t.tiles||[])r.k(y)?_.push(this.canonicalizeTileURL(y,h)):_.push(y);return _}_makeAPIURL(t,s){const h="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Qe(r.e.API_URL);if(t.protocol=_.protocol,t.authority=_.authority,t.protocol==="http"){const y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(_.path!=="/"&&(t.path=`${_.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return kt(t);if(s=s||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${h}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${h}`)}return t.params=t.params.filter(y=>y.indexOf("access_token")===-1),t.params.push(`access_token=${s||""}`),kt(t)}}const Et=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Qe(u){const t=u.match(Et);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function kt(u){const t=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${t}`}const ii="mapbox.eventData";function Li(u){if(!u)return null;const t=u.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.m(t[1]))}catch{return null}}class Ve{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=Li(r.e.ACCESS_TOKEN);let h="";return h=s&&s.u?r.f(s.u):r.e.ACCESS_TOKEN||"",t?`${ii}.${t}:${h}`:`${ii}:${h}`}fetchEventData(){const t=r.s("localStorage"),s=this.getStorageKey(),h=this.getStorageKey("uuid");if(t)try{const _=localStorage.getItem(s);_&&(this.eventData=JSON.parse(_));const y=localStorage.getItem(h);y&&(this.anonId=y)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const t=r.s("localStorage"),s=this.getStorageKey(),h=this.getStorageKey("uuid"),_=this.anonId;if(t&&_)try{localStorage.setItem(h,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,h,_){if(!r.e.EVENTS_URL)return;const y=Qe(r.e.EVENTS_URL);y.params.push(`access_token=${_||r.e.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(t).toISOString()},C=s?r.h(b,s):b,I={url:kt(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=r.p(I,O=>{this.pendingRequest=null,h(O),this.saveEventData(),this.processRequests(_)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const Dt=new class extends Ve{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(u)&&u.some(s=>r.j(s)||r.k(s))&&this.queueRequest(Date.now(),t)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Li(r.e.ACCESS_TOKEN),s=t?t.u:r.e.ACCESS_TOKEN;let h=s!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),h=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),b=new Date(_),C=(_-this.eventData.lastSuccess)/864e5;h=h||C>=1||C<-1||y.getDate()!==b.getDate()}else h=!0;h?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:F,skuId:It,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=_,this.eventData.tokenU=s)},u):this.processRequests()}},ti=Dt.postTurnstileEvent.bind(Dt),li=new class extends Ve{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,t,s,h){this.skuToken=t,this.errorCb=h,r.e.EVENTS_URL&&(s||r.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},s):this.errorCb(new Error(Lt)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:F,skuId:It,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},u))}remove(){this.errorCb=null}},Mi=li.postMapLoadEvent.bind(li),at=new class extends Ve{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(u){let t=this.mapInstanceIdMap.get(u);return t||(t=r.u(),this.mapInstanceIdMap.set(u,t)),t}getEventId(u){const t=this.eventIdPerMapInstanceMap.get(u)||0;return this.eventIdPerMapInstanceMap.set(u,t+1),t}postStyleLoadEvent(u,t){const{map:s,style:h,importedStyles:_}=t;if(!r.e.EVENTS_URL||!u&&!r.e.ACCESS_TOKEN)return;const y=this.getMapInstanceId(s),b={mapInstanceId:y,eventId:this.getEventId(y),style:h};_.length&&(b.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:b},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:s}=this.queue.shift();this.postEvent(t,s,()=>{},u)}},Rt=at.postStyleLoadEvent.bind(at),_i=new class extends Ve{constructor(){super("gljs.performance")}postPerformanceEvent(u,t){r.e.EVENTS_URL&&(u||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:s}=this.queue.shift(),h=function(_){const y=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),C=function(H){const Q={};if(H){for(const X in H)if(X!=="other")for(const J of H[X]){const ne=`${X}ResolveRangeMin`,oe=`${X}ResolveRangeMax`,ve=`${X}RequestCount`,Se=`${X}RequestCachedCount`;Q[ne]=Math.min(Q[ne]||1/0,J.startTime),Q[oe]=Math.max(Q[oe]||-1/0,J.responseEnd);const Le=Ie=>{Q[Ie]===void 0&&(Q[Ie]=0),++Q[Ie]};J.transferSize!==void 0&&J.transferSize===0&&Le(Se),Le(ve)}}return Q}(function(H,Q){const X={};if(H)for(const J of H){const ne=Q(J);X[ne]===void 0&&(X[ne]=[]),X[ne].push(J)}return X}(y,ie)),I=window.devicePixelRatio,O=navigator.connection||navigator.mozConnection||navigator.webkitConnection,k=O?O.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},V=(H,Q,X)=>{X!=null&&H.push({name:Q,value:X.toString()})};for(const H in C)V(U.counters,H,C[H]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(V(U.counters,"interactionRangeMin",_.interactionRange[0]),V(U.counters,"interactionRangeMax",_.interactionRange[1])),b)for(const H of Object.keys(B)){const Q=B[H],X=b.find(J=>J.name===Q);X&&V(U.counters,Q,X.startTime)}return V(U.counters,"visibilityHidden",_.visibilityHidden),V(U.attributes,"style",function(H){if(H)for(const Q of H){const X=Q.name.split("?")[0];if(r.i(X)){const J=X.split("/").slice(-2);if(J.length===2)return`mapbox://styles/${J[0]}/${J[1]}`}}}(y)),V(U.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),V(U.attributes,"fogEnabled",_.fogEnabled?"true":"false"),V(U.attributes,"projection",_.projection),V(U.attributes,"zoom",_.zoom),V(U.metadata,"devicePixelRatio",I),V(U.metadata,"connectionEffectiveType",k),V(U.metadata,"navigatorUserAgent",navigator.userAgent),V(U.metadata,"screenWidth",window.screen.width),V(U.metadata,"screenHeight",window.screen.height),V(U.metadata,"windowWidth",window.innerWidth),V(U.metadata,"windowHeight",window.innerHeight),V(U.metadata,"mapWidth",_.width/I),V(U.metadata,"mapHeight",_.height/I),V(U.metadata,"webglRenderer",_.renderer),V(U.metadata,"webglVendor",_.vendor),V(U.metadata,"sdkVersion",F),V(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(s);for(const _ of h.metadata);for(const _ of h.counters);for(const _ of h.attributes);this.postEvent(t,h,()=>{},u)}},Oi=_i.postPerformanceEvent.bind(_i),ei=new class extends Ve{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,t,s,h){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const _=Qe(r.e.API_URL+r.e.SESSION_PATH);_.params.push(`sku=${t||""}`),_.params.push(`access_token=${h||r.e.ACCESS_TOKEN||""}`);const y={url:kt(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(y,b=>{this.pendingRequest=null,s(b),this.saveEventData(),this.processRequests(h)})}getSessionAPI(u,t,s,h){this.skuToken=t,this.errorCb=h,r.e.SESSION_PATH&&r.e.API_URL&&(s||r.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},s):this.errorCb(new Error(Lt)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},u)}remove(){this.errorCb=null}},hn=ei.getSessionAPI.bind(ei),In=new Set;function Rn(u,t){t?In.add(u):In.delete(u)}class Qi{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,s){this._updatedSourceCaches[t]=s,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const s=t.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(t.id),this.setDirty()}removeLayer(t){const s=t.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][t.id]=t,this._updatedLayers[s].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const s in this._updatedLayers)t[s]=t[s]||{},t[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)t[s]=t[s]||{},t[s].removedIds=Object.keys(this._removedLayers[s]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,s){this._updatedImages[s]=this._updatedImages[s]||new Set,this._updatedImages[s].add(r.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Zr(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class Fn extends r.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new r.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const s=this.atlasTexture.get(t);s&&(s.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,s){this.imageProviders.has(s)||this.imageProviders.set(s,new Map),this.imageProviders.get(s).set(t.id,t)}removeImageProvider(t,s){this.imageProviders.has(s)&&this.imageProviders.get(s).delete(t)}getPendingImageProviders(){const t=[];for(const s of this.imageProviders.values())for(const h of s.values())h.hasPendingRequests()&&t.push(h);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,s){if(this.loaded.get(s)!==t&&(this.loaded.set(s,t),t)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,s,_);this.requestors=[]}}hasImage(t,s){return!!this.getImage(t,s)}getImage(t,s){return this.images.get(s).get(t.toString())}addImage(t,s,h){this._validate(t,h)&&this.images.get(s).set(t.toString(),h)}_validate(t,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new r.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new r.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new r.z(new Error(`Image "${t.name}" has invalid "content" value`))),h=!1),h}_validateStretch(t,s){if(!t)return!0;let h=0;for(const _ of t){if(_[0]<h||_[1]<_[0]||s<_[1])return!1;h=_[1]}return!0}_validateContent(t,s){return t?t.length!==4||!s.usvg&&(t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,s,h){const _=this.images.get(s).get(t.toString());h.version=_.version+1,this.images.get(s).set(t.toString(),h),this.updatedImages.get(s).add(t),this.removeFromImageRasterizerCache(t,s)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,s){this.spriteFormat!=="raster"&&(r.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:s}):this.imageRasterizer.removeImagesFromCacheByIds([t],s))}removeImage(t,s){const h=this.images.get(s),_=h.get(t.toString());h.delete(t.toString()),this.patterns.get(s).delete(t.toString()),this.removeFromImageRasterizerCache(t,s),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(s=>r.I.from(s))}getImages(t,s,h){const _=[],y=[],b=this.imageProviders.get(s);for(const k of t){if(!k.iconsetId){_.push(k);continue}const U=b.get(k.iconsetId);U&&(this.getImage(k,s)?y.push(k):U.addPendingRequest(k))}if(_.length===0)return void this._notify(y,s,h);let C=!0;const I=!!this.loaded.get(s),O=this.images.get(s);if(!I)for(const k of _)O.has(k.toString())||(C=!1);I||C?this._notify(_,s,h):this.requestors.push({ids:_,scope:s,callback:h})}rasterizeImages(t,s){const h=new Map,{tasks:_,scope:y}=t;for(const[b,C]of _.entries()){const I=this.getImage(C.id,y);I&&h.set(b,{image:I,imageVariant:C})}this._rasterizeImages(y,h,s)}_rasterizeImages(t,s,h){if(r.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:s,scope:t},h);else{const _=new Map;for(const[y,{image:b,imageVariant:C}]of s.entries())_.set(y,this.imageRasterizer.rasterize(C,b,t,0));h(void 0,_)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,s,h){const _=this.images.get(s),y=new Map;for(const b of t){if(!_.get(b.toString())){if(b.iconsetId)continue;this.fire(new r.A("styleimagemissing",{id:b.name}))}const C=_.get(b.toString());if(!C){r.w(`Image "${b.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const I={data:C.usvg?null:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,usvg:C.usvg,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!!(C.userImage&&C.userImage.render)};C.usvg&&Object.assign(I,{width:C.icon.usvg_tree.width,height:C.icon.usvg_tree.height}),y.set(r.I.toString(b),I)}h(null,y)}getPixelSize(t){const{width:s,height:h}=this.atlasImage.get(t);return{width:s,height:h}}getPattern(t,s,h){const _=t.toString(),y=this.patterns.get(s),b=y.get(_),C=this.getImage(t,s);if(!C)return null;if(b){if(b.position.version===C.version)return b.position;b.position.version=C.version}else{if(C.usvg&&!C.data){const I=this.getPatternInFlightId(_,s);if(this.patternsInFlight.has(I))return null;this.patternsInFlight.add(I);const O=new r.B(t).scaleSelf(r.q.devicePixelRatio),k=new Map([[O.toString(),{image:C,imageVariant:O}]]);return this._rasterizeImages(s,k,(U,V)=>this.storePatternImage(O,s,C,h,V)),null}this.storePattern(t,s,C)}return this._updatePatternAtlas(s,h),y.get(_).position}getPatternInFlightId(t,s){return r.C(t,s)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,s,h,_,y){const b=t.toString(),C=y?y.get(b):void 0;C&&(h.data=C,this.storePattern(t.id,s,h),this._updatePatternAtlas(s,_),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),s)))}storePattern(t,s,h){const _={w:h.data.width+2*r.F,h:h.data.height+2*r.F,x:0,y:0},y=new r.G(_,h,r.F);this.patterns.get(s).set(t.toString(),{bin:_,position:y})}bind(t,s){const h=t.gl;let _=this.atlasTexture.get(s);_?this.dirty&&(_.update(this.atlasImage.get(s)),this.dirty=!1):(_=new r.T(t,this.atlasImage.get(s),h.RGBA8),this.atlasTexture.set(s,_)),_.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(t,s){const h=this.patterns.get(t),_=Array.from(h.values()).map(({bin:O})=>O),{w:y,h:b}=r.H(_),C=this.atlasImage.get(t);C.resize({width:y||1,height:b||1});const I=this.images.get(t);for(const[O,{bin:k,position:U}]of h.entries()){let V=U.padding;const H=k.x+V,Q=k.y+V,X=I.get(O).data,J=X.width,ne=X.height;V=V>1?V-1:V,r.r.copy(X,C,{x:0,y:0},{x:H,y:Q},{width:J,height:ne},s),r.r.copy(X,C,{x:0,y:ne-V},{x:H,y:Q-V},{width:J,height:V},s),r.r.copy(X,C,{x:0,y:0},{x:H,y:Q+ne},{width:J,height:V},s),r.r.copy(X,C,{x:J-V,y:0},{x:H-V,y:Q},{width:V,height:ne},s),r.r.copy(X,C,{x:0,y:0},{x:H+J,y:Q},{width:V,height:ne},s),r.r.copy(X,C,{x:J-V,y:ne-V},{x:H-V,y:Q-V},{width:V,height:V},s),r.r.copy(X,C,{x:0,y:ne-V},{x:H+J,y:Q-V},{width:V,height:V},s),r.r.copy(X,C,{x:0,y:0},{x:H+J,y:Q+ne},{width:V,height:V},s),r.r.copy(X,C,{x:J-V,y:0},{x:H-V,y:Q+ne},{width:V,height:V},s)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,s){const h=this.images.get(s);for(const _ of t){if(this.callbackDispatchedThisFrame.get(s).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(s).add(_.toString());const y=h.get(_.toString());Zr(y)&&this.updateImage(_,s,y)}}}function Qr(u){const t=u.key,s=u.value,h=u.valueSpec||{},_=u.objectElementValidators||{},y=u.style,b=u.styleSpec;let C=[];const I=r.J(s);if(I!=="object")return[new r.V(t,s,`object expected, ${I} found`)];for(const O in s){const k=O.split(".")[0];let U;_[k]?U=_[k]:h[k]?U=On:_["*"]?U=_["*"]:h["*"]&&(U=On),U?C=C.concat(U({key:(t&&`${t}.`)+O,value:s[O],valueSpec:h[k]||h["*"],style:y,styleSpec:b,object:s,objectKey:O},s)):C.push(new r.K(t,s[O],`unknown property "${O}"`))}for(const O in h)_[O]||h[O].required&&h[O].default===void 0&&s[O]===void 0&&C.push(new r.V(t,s,`missing required property "${O}"`));return C}function gs(u){const t=u.value,s=u.valueSpec,h=u.style,_=u.styleSpec,y=u.key,b=u.arrayElementValidator||On;if(r.J(t)!=="array")return[new r.V(y,t,`array expected, ${r.J(t)} found`)];if(s.length&&t.length!==s.length)return[new r.V(y,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new r.V(y,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let C={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};_.$version<7&&(C.function=s.function),r.J(s.value)==="object"&&(C=s.value);let I=[];for(let O=0;O<t.length;O++)I=I.concat(b({array:t,arrayIndex:O,value:t[O],valueSpec:C,style:h,styleSpec:_,key:`${y}[${O}]`},!0));return I}function No(u){const t=u.key,s=u.value,h=u.valueSpec;let _=r.J(s);if(_==="number"&&s!=s&&(_="NaN"),_!=="number")return[new r.V(t,s,`number expected, ${_} found`)];if("minimum"in h){let y=h.minimum;if(r.J(h.minimum)==="array"&&(y=h.minimum[u.arrayIndex]),s<y)return[new r.V(t,s,`${s} is less than the minimum value ${y}`)]}if("maximum"in h){let y=h.maximum;if(r.J(h.maximum)==="array"&&(y=h.maximum[u.arrayIndex]),s>y)return[new r.V(t,s,`${s} is greater than the maximum value ${y}`)]}return[]}function Or(u){const t=u.valueSpec,s=r.M(u.value.type);let h,_,y,b={};const C=s!=="categorical"&&u.value.property===void 0,I=!C,O=r.J(u.value.stops)==="array"&&r.J(u.value.stops[0])==="array"&&r.J(u.value.stops[0][0])==="object",k=Qr({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(H){if(s==="identity")return[new r.V(H.key,H.value,'identity function may not have a "stops" property')];let Q=[];const X=H.value;return Q=Q.concat(gs({key:H.key,value:X,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:U})),r.J(X)==="array"&&X.length===0&&Q.push(new r.V(H.key,X,"array must have at least one stop")),Q},default:function(H){return On({key:H.key,value:H.value,valueSpec:t,style:H.style,styleSpec:H.styleSpec})}}});return s==="identity"&&C&&k.push(new r.V(u.key,u.value,'missing required property "property"')),s==="identity"||u.value.stops||k.push(new r.V(u.key,u.value,'missing required property "stops"')),s==="exponential"&&u.valueSpec.expression&&!r.N(u.valueSpec)&&k.push(new r.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(I&&!r.O(u.valueSpec)?k.push(new r.V(u.key,u.value,"property functions not supported")):C&&!r.Q(u.valueSpec)&&k.push(new r.V(u.key,u.value,"zoom functions not supported"))),s!=="categorical"&&!O||u.value.property!==void 0||k.push(new r.V(u.key,u.value,'"property" property is required')),k;function U(H){let Q=[];const X=H.value,J=H.key;if(r.J(X)!=="array")return[new r.V(J,X,`array expected, ${r.J(X)} found`)];if(X.length!==2)return[new r.V(J,X,`array length 2 expected, length ${X.length} found`)];if(O){if(r.J(X[0])!=="object")return[new r.V(J,X,`object expected, ${r.J(X[0])} found`)];if(X[0].zoom===void 0)return[new r.V(J,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new r.V(J,X,"object stop key must have value")];const ne=r.M(X[0].zoom);if(typeof ne!="number")return[new r.V(J,X[0].zoom,"stop zoom values must be numbers")];if(y&&y>ne)return[new r.V(J,X[0].zoom,"stop zoom values must appear in ascending order")];ne!==y&&(y=ne,_=void 0,b={}),Q=Q.concat(Qr({key:`${J}[0]`,value:X[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:No,value:V}}))}else Q=Q.concat(V({key:`${J}[0]`,value:X[0],style:H.style,styleSpec:H.styleSpec},X));return r.S(r.U(X[1]))?Q.concat([new r.V(`${J}[1]`,X[1],"expressions are not allowed in function stops.")]):Q.concat(On({key:`${J}[1]`,value:X[1],valueSpec:t,style:H.style,styleSpec:H.styleSpec}))}function V(H,Q){const X=r.J(H.value),J=r.M(H.value),ne=H.value!==null?H.value:Q;if(h){if(X!==h)return[new r.V(H.key,ne,`${X} stop domain type must match previous stop domain type ${h}`)]}else h=X;if(X!=="number"&&X!=="string"&&X!=="boolean"&&typeof J!="number"&&typeof J!="string"&&typeof J!="boolean")return[new r.V(H.key,ne,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&s!=="categorical"){let oe=`number expected, ${X} found`;return r.O(t)&&s===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(H.key,ne,oe)]}return s!=="categorical"||X!=="number"||typeof J=="number"&&isFinite(J)&&Math.floor(J)===J?s!=="categorical"&&X==="number"&&typeof J=="number"&&typeof _=="number"&&_!==void 0&&J<_?[new r.V(H.key,ne,"stop domain values must appear in ascending order")]:(_=J,s==="categorical"&&J in b?[new r.V(H.key,ne,"stop domain values must be unique")]:(b[J]=!0,[])):[new r.V(H.key,ne,`integer expected, found ${String(J)}`)]}}function Nr(u){const t=(u.expressionContext==="property"?r.W:r.X)(r.U(u.value),u.valueSpec);if(t.result==="error")return t.value.map(h=>new r.V(`${u.key}${h.key}`,u.value,h.message));const s=t.value.expression||t.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!s.outputDefined())return[new r.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!r.Y(s))return[new r.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Jr(s,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!r.Z(s,["zoom","feature-state"]))return[new r.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!r._(s))return[new r.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jr(u,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const _ of t.valueSpec.expression.parameters)s.delete(_);if(s.size===0)return[];const h=[];return u instanceof r.$&&s.has(u.name)?[new r.V(t.key,t.value,`["${u.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(u.eachChild(_=>{h.push(...Jr(_,t))}),h)}function Ao(u){const t=u.key,s=u.value,h=u.valueSpec,_=[];return Array.isArray(h.values)?h.values.indexOf(r.M(s))===-1&&_.push(new r.V(t,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(r.M(s))===-1&&_.push(new r.V(t,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),_}function Ja(u){return r.a1(r.U(u.value))?Nr(r.L({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):Ns(u)}function Ns(u){const t=u.value,s=u.key;if(r.J(t)!=="array")return[new r.V(s,t,`array expected, ${r.J(t)} found`)];const h=u.styleSpec;let _,y=[];if(t.length<1)return[new r.V(s,t,"filter array must have at least 1 element")];switch(y=y.concat(Ao({key:`${s}[0]`,value:t[0],valueSpec:h.filter_operator,style:u.style,styleSpec:u.styleSpec})),r.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.M(t[1])==="$type"&&y.push(new r.V(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new r.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(_=r.J(t[1]),_!=="string"&&y.push(new r.V(`${s}[1]`,t[1],`string expected, ${_} found`)));for(let b=2;b<t.length;b++)_=r.J(t[b]),r.M(t[1])==="$type"?y=y.concat(Ao({key:`${s}[${b}]`,value:t[b],valueSpec:h.geometry_type,style:u.style,styleSpec:u.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&y.push(new r.V(`${s}[${b}]`,t[b],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)y=y.concat(Ns({key:`${s}[${b}]`,value:t[b],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":_=r.J(t[1]),t.length!==2?y.push(new r.V(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):_!=="string"&&y.push(new r.V(`${s}[1]`,t[1],`string expected, ${_} found`))}return y}function hl(u,t){const s=u.key,h=u.style,_=u.layer,y=u.styleSpec,b=u.value,C=u.objectKey,I=y[`${t}_${u.layerType}`];if(!I)return[];const O=C.match(/^(.*)-use-theme$/);if(t==="paint"&&O&&I[O[1]])return r.S(b)?[].concat(On({key:u.key,value:b,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:h,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:C})):On({key:s,value:b,valueSpec:{type:"string"},style:h,styleSpec:y});const k=C.match(/^(.*)-transition$/);if(t==="paint"&&k&&I[k[1]]&&I[k[1]].transition)return On({key:s,value:b,valueSpec:y.transition,style:h,styleSpec:y});const U=u.valueSpec||I[C];if(!U)return[new r.K(s,b,`unknown property "${C}"`)];let V;if(r.J(b)==="string"&&r.O(U)&&!U.tokens&&(V=/^{([^}]+)}$/.exec(b))){const Q=`\`{ "type": "identity", "property": ${V?JSON.stringify(V[1]):'"_"'} }\``;return[new r.V(s,b,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${Q}.`)]}const H=[];if(u.layerType==="symbol")C!=="text-field"||!h||h.glyphs||h.imports||H.push(new r.V(s,b,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&r.a2(r.U(b))&&r.M(b.type)==="identity"&&H.push(new r.V(s,b,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&t==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&r.O(U)&&(r.a3(U)||r.Q(U))){const Q=r.W(r.U(b),U),X=Q.value.expression||Q.value._styleExpression.expression;X&&!r.Z(X,["measure-light"])&&(C==="model-emissive-strength"&&r._(X)&&r.Y(X)||H.push(new r.V(s,b,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return H.concat(On({key:u.key,value:b,valueSpec:U,style:h,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:C}))}function eo(u){return hl(u,"paint")}function Ur(u){return hl(u,"layout")}function ka(u){let t=[];const s=u.value,h=u.key,_=u.style,y=u.styleSpec;s.type||s.ref||t.push(new r.V(h,s,'either "type" or "ref" is required'));let b=r.M(s.type);const C=r.M(s.ref);if(s.id){const I=r.M(s.id);for(let O=0;O<u.arrayIndex;O++){const k=_.layers[O];r.M(k.id)===I&&t.push(new r.V(h,s.id,`duplicate layer id "${s.id}", previously used at line ${k.id.__line__}`))}}if("ref"in s){let I;["type","source","source-layer","filter","layout"].forEach(O=>{O in s&&t.push(new r.V(h,s[O],`"${O}" is prohibited for ref layers`))}),_.layers.forEach(O=>{r.M(O.id)===C&&(I=O)}),I?I.ref?t.push(new r.V(h,s.ref,"ref cannot reference another ref layer")):b=r.M(I.type):typeof C=="string"&&t.push(new r.V(h,s.ref,`ref layer "${C}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(s.source){const I=_.sources&&_.sources[s.source],O=I&&r.M(I.type);I?O==="vector"&&b==="raster"?t.push(new r.V(h,s.source,`layer "${s.id}" requires a raster source`)):O==="raster"&&b!=="raster"?t.push(new r.V(h,s.source,`layer "${s.id}" requires a vector source`)):O!=="vector"||s["source-layer"]?O==="raster-dem"&&b!=="hillshade"?t.push(new r.V(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="raster-array"||["raster","raster-particle"].includes(b)?b==="line"&&s.paint&&(s.paint["line-gradient"]||s.paint["line-trim-offset"])&&O==="geojson"&&!I.lineMetrics?t.push(new r.V(h,s,`layer "${s.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):b==="raster-particle"&&O!=="raster-array"&&t.push(new r.V(h,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):t.push(new r.V(h,s.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(h,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new r.V(h,s.source,`source "${s.source}" not found`))}else t.push(new r.V(h,s,'missing required property "source"'));return t=t.concat(Qr({key:h,value:s,valueSpec:y.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>On({key:`${h}.type`,value:s.type,valueSpec:y.layer.type,style:u.style,styleSpec:u.styleSpec,object:s,objectKey:"type"}),filter:I=>Ja(r.L({layerType:b},I)),layout:I=>Qr({layer:s,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":O=>Ur(r.L({layerType:b},O))}}),paint:I=>Qr({layer:s,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":O=>eo(r.L({layerType:b,layer:s},O))}})}})),t}function _s(u){const t=u.value,s=u.key,h=r.J(t);return h!=="string"?[new r.V(s,t,`string expected, ${h} found`)]:[]}const Dl={promoteId:function u({key:t,value:s}){if(r.J(s)==="string")return _s({key:t,value:s});if(Array.isArray(s)){const h=[],_=r.U(s),y=r.X(_);return y.result==="error"&&y.value.forEach(b=>{h.push(new r.V(`${t}${b.key}`,null,`${b.message}`))}),r.Z(y.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||h.push(new r.V(`${t}`,null,"promoteId expression should be only feature dependent")),h}{const h=[];for(const _ in s)h.push(...u({key:`${t}.${_}`,value:s[_]}));return h}}};function xs(u){const t=u.value,s=u.key,h=u.styleSpec,_=u.style;if(!t.type)return[new r.V(s,t,'"type" is required')];const y=r.M(t.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&(t.url||t.tiles||b.push(new r.K(s,t,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(Qr({key:s,value:t,valueSpec:h[`source_${y.replace("-","_")}`],style:u.style,styleSpec:h,objectElementValidators:Dl})),b;case"geojson":if(b=Qr({key:s,value:t,valueSpec:h.source_geojson,style:_,styleSpec:h,objectElementValidators:Dl}),t.cluster)for(const C in t.clusterProperties){const[I,O]=t.clusterProperties[C],k=typeof I=="string"?[I,["accumulated"],["get",C]]:I;b.push(...Nr({key:`${s}.${C}.map`,value:O,expressionContext:"cluster-map"})),b.push(...Nr({key:`${s}.${C}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return b;case"video":return Qr({key:s,value:t,valueSpec:h.source_video,style:_,styleSpec:h});case"image":return Qr({key:s,value:t,valueSpec:h.source_image,style:_,styleSpec:h});case"canvas":return[new r.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ao({key:`${s}.type`,value:t.type,valueSpec:{values:aa(h)}})}}function aa(u){return u.source.reduce((t,s)=>{const h=u[s];return h.type.type==="enum"&&(t=t.concat(Object.keys(h.type.values))),t},[])}function Na(u){const t=u.value,s=u.styleSpec,h=s.light,_=u.style;let y=[];const b=r.J(t);if(t===void 0)return y;if(b!=="object")return y=y.concat([new r.V("light",t,`object expected, ${b} found`)]),y;for(const C in t){const I=C.match(/^(.*)-transition$/),O=C.match(/^(.*)-use-theme$/);y=y.concat(O&&h[O[1]]?On({key:C,value:t[C],valueSpec:{type:"string"},style:_,styleSpec:s}):I&&h[I[1]]&&h[I[1]].transition?On({key:C,value:t[C],valueSpec:s.transition,style:_,styleSpec:s}):h[C]?On({key:C,value:t[C],valueSpec:h[C],style:_,styleSpec:s}):[new r.V(C,t[C],`unknown property "${C}"`)])}return y}function bs(u){const t=u.value;let s=[];if(!t)return s;const h=r.J(t);if(h!=="object")return s=s.concat([new r.V("light-3d",t,`object expected, ${h} found`)]),s;const _=u.styleSpec,y=_["light-3d"],b=u.key,C=u.style,I=u.style.lights;for(const U of["type","id"])if(!(U in t))return s=s.concat([new r.V("light-3d",t,`missing property ${U} on light`)]),s;if(t.type&&I)for(let U=0;U<u.arrayIndex;U++){const V=r.M(t.type),H=I[U];r.M(H.type)===V&&s.push(new r.V(b,t.id,`duplicate light type "${t.type}", previously defined at line ${H.id.__line__}`))}const O=`properties_light_${t.type}`;if(!(O in _))return s=s.concat([new r.V("light-3d",t,`Invalid light type ${t.type}`)]),s;const k=_[O];for(const U in t)if(U==="properties"){const V=t[U],H=r.J(V);if(H!=="object")return s=s.concat([new r.V("properties",V,`object expected, ${H} found`)]),s;for(const Q in V){const X=Q.match(/^(.*)-transition$/),J=Q.match(/^(.*)-use-theme$/);s=s.concat(J&&k[J[1]]?On({key:U,value:V[Q],valueSpec:{type:"string"},style:C,styleSpec:_}):X&&k[X[1]]&&k[X[1]].transition?On({key:U,value:t[U],valueSpec:_.transition,style:C,styleSpec:_}):k[Q]?On({key:Q,value:V[Q],valueSpec:k[Q],style:C,styleSpec:_}):[new r.K(u.key,V[Q],`unknown property "${Q}"`)])}}else s=s.concat(y[U]?On({key:U,value:t[U],valueSpec:y[U],style:C,styleSpec:_}):[new r.K(U,t[U],`unknown property "${U}"`)]);return s}function Os(u){const t=u.value,s=u.key,h=u.style,_=u.styleSpec,y=_.terrain;let b=[];const C=r.J(t);if(t===void 0||C==="null")return b;if(C!=="object")return b=b.concat([new r.V("terrain",t,`object expected, ${C} found`)]),b;for(const I in t){const O=I.match(/^(.*)-transition$/),k=I.match(/^(.*)-use-theme$/);b=b.concat(k&&y[k[1]]?On({key:I,value:t[I],valueSpec:{type:"string"},style:h,styleSpec:_}):O&&y[O[1]]&&y[O[1]].transition?On({key:I,value:t[I],valueSpec:_.transition,style:h,styleSpec:_}):y[I]?On({key:I,value:t[I],valueSpec:y[I],style:h,styleSpec:_}):[new r.K(I,t[I],`unknown property "${I}"`)])}if(t.source){const I=h.sources&&h.sources[t.source],O=I&&r.M(I.type);I?O!=="raster-dem"&&b.push(new r.V(s,t.source,`terrain cannot be used with a source of type ${String(O)}, it only be used with a "raster-dem" source type`)):b.push(new r.V(s,t.source,`source "${t.source}" not found`))}else b.push(new r.V(s,t,'terrain is missing required property "source"'));return b}function oa(u){const t=u.value,s=u.style,h=u.styleSpec,_=h.fog;let y=[];const b=r.J(t);if(t===void 0)return y;if(b!=="object")return y=y.concat([new r.V("fog",t,`object expected, ${b} found`)]),y;for(const C in t){const I=C.match(/^(.*)-transition$/),O=C.match(/^(.*)-use-theme$/);y=y.concat(O&&_[O[1]]?On({key:C,value:t[C],valueSpec:{type:"string"},style:s,styleSpec:h}):I&&_[I[1]]&&_[I[1]].transition?On({key:C,value:t[C],valueSpec:h.transition,style:s,styleSpec:h}):_[C]?On({key:C,value:t[C],valueSpec:_[C],style:s,styleSpec:h}):[new r.K(C,t[C],`unknown property "${C}"`)])}return y}const _a={"*":()=>[],array:gs,boolean:function(u){const t=u.value,s=u.key,h=r.J(t);return h!=="boolean"?[new r.V(s,t,`boolean expected, ${h} found`)]:[]},number:No,color:function(u){const t=u.key,s=u.value,h=r.J(s);return h!=="string"?[new r.V(t,s,`color expected, ${h} found`)]:r.a0.parseCSSColor(s)===null?[new r.V(t,s,`color expected, "${s}" found`)]:[]},enum:Ao,filter:Ja,function:Or,layer:ka,object:Qr,source:xs,model:r.a4,light:Na,"light-3d":bs,terrain:Os,fog:oa,string:_s,formatted:function(u){return _s(u).length===0?[]:Nr(u)},resolvedImage:function(u){return _s(u).length===0?[]:Nr(u)},projection:function(u){const t=u.value,s=u.styleSpec,h=s.projection,_=u.style;let y=[];const b=r.J(t);if(b==="object")for(const C in t)y=y.concat(On({key:C,value:t[C],valueSpec:h[C],style:_,styleSpec:s}));else b!=="string"&&(y=y.concat([new r.V("projection",t,`object or string expected, ${b} found`)]));return y},import:function(u){const{value:t,styleSpec:s}=u,{data:h,..._}=t;Object.defineProperty(_,"__line__",{value:t.__line__,enumerable:!1});let y=Qr(r.L({},u,{value:_,valueSpec:s.import}));return r.M(_.id)===""&&y.push(new r.V(`${u.key}.id`,_,"import id can't be an empty string")),h&&(y=y.concat(Co(h,s,{key:`${u.key}.data`}))),y},iconset:function(u){const t=u.value,s=u.key,h=u.styleSpec,_=u.style;if(!t.type)return[new r.V(s,t,'"type" is required')];const y=r.M(t.type);let b=[];if(b=b.concat(Qr({key:s,value:t,valueSpec:h[`iconset_${y}`],style:_,styleSpec:h})),y==="source"&&t.source){const C=_.sources&&_.sources[t.source],I=C&&r.M(C.type);C?I!=="raster-array"&&b.push(new r.V(s,t.source,`iconset cannot be used with a source of type ${String(I)}, it only be used with a "raster-array" source type`)):b.push(new r.V(s,t.source,`source "${t.source}" not found`))}return b}};function On(u,t=!1){const s=u.value,h=u.valueSpec,_=u.styleSpec;if(h.expression&&r.a2(r.M(s)))return Or(u);if(h.expression&&r.S(r.U(s)))return Nr(u);if(h.type&&_a[h.type]){const y=_a[h.type](u);return t===!0&&y.length>0&&r.J(u.value)==="array"?Nr(u):y}return Qr(r.L({},u,{valueSpec:h.type?_[h.type]:h}))}function ya(u){const t=u.value,s=u.key,h=_s(u);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new r.V(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new r.V(s,t,'"glyphs" url must include a "{range}" token'))),h}function Co(u,t=r.a5,s={}){return On({key:s.key||"",value:u,valueSpec:t.$root,styleSpec:t,style:u,objectElementValidators:{glyphs:ya,"*":()=>[]}})}function Fs(u,t=r.a5){return ke(Co(u,t))}const dl=u=>ke(xs(u)),to=u=>ke(Na(u)),Fa=u=>ke(bs(u)),Qt=u=>ke(Os(u)),io=u=>ke(oa(u)),va=u=>ke(function(t){const s=t.value,h=t.style,_=t.styleSpec,y=_.snow;let b=[];const C=r.J(s);if(s===void 0)return b;if(C!=="object")return b=b.concat([new r.V("snow",s,`object expected, ${C} found`)]),b;for(const I in s){const O=I.match(/^(.*)-transition$/);b=b.concat(O&&y[O[1]]&&y[O[1]].transition?On({key:I,value:s[I],valueSpec:_.transition,style:h,styleSpec:_}):y[I]?On({key:I,value:s[I],valueSpec:y[I],style:h,styleSpec:_}):[new r.K(I,s[I],`unknown property "${I}"`)])}return b}(u)),xa=u=>ke(function(t){const s=t.value,h=t.style,_=t.styleSpec,y=_.rain;let b=[];const C=r.J(s);if(s===void 0)return b;if(C!=="object")return b=b.concat([new r.V("rain",s,`object expected, ${C} found`)]),b;for(const I in s){const O=I.match(/^(.*)-transition$/);b=b.concat(O&&y[O[1]]&&y[O[1]].transition?On({key:I,value:s[I],valueSpec:_.transition,style:h,styleSpec:_}):y[I]?On({key:I,value:s[I],valueSpec:y[I],style:h,styleSpec:_}):[new r.K(I,s[I],`unknown property "${I}"`)])}return b}(u)),wn=u=>ke(ka(u)),nt=u=>ke(Ja(u)),ee=u=>ke(eo(u)),ae=u=>ke(Ur(u)),xe=u=>ke(r.a4(u));function ke(u){return u.slice().sort((t,s)=>t.line&&s.line?t.line-s.line:0)}function Me(u,t){let s=!1;if(t&&t.length)for(const h of t)h instanceof r.K?r.w(h.message):(u.fire(new r.z(new Error(h.message))),s=!0);return s}let He;class et extends r.E{constructor(t,s="flat"){super(),this._transitionable=new r.a6(He||(He=new r.a7({anchor:new r.a8(r.a5.light.anchor),position:new r.a9(r.a5.light.position),color:new r.a8(r.a5.light.color),intensity:new r.a8(r.a5.light.intensity)}))),this.setLight(t,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s,h={}){this._validate(to,t,h)||(this._transitionable.setTransitionOrValue(t),this.id=s)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&Me(this,t.call(Fs,r.h({value:s,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}}let Ue=class extends r.E{constructor(u,t,s,h,_){super(),this.scope=s,this._transitionable=new r.a6(new r.a7({source:new r.a8(r.a5.terrain.source),exaggeration:new r.a8(r.a5.terrain.exaggeration)}),s,h),this._transitionable.setTransitionOrValue(u,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=_}get(){return this._transitionable.serialize()}set(u,t){this._transitionable.setTransitionOrValue(u,t)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new r.aa(u,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const u=this._transitionable._values.exaggeration;if(!u)return null;const t=u.value.expression;if(!t)return null;let s=-1,h=-1,_=1;for(const y of t.zoomStops)_=t.evaluate(new r.aa(y,{worldview:this.worldview})),_>.01?(s=y,h=-1):h=y;return _<.01&&s>0&&h>s?[s,h]:null}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof r.ab}};const tt=45,vt=65,rt=.05;function Xt(u,t,s,h){const _=r.af(tt,vt,s),[y,b]=pi(u,h);let C=1-Math.min(1,Math.exp((t-y)/(b-y)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*_*u.alpha}function pi(u,t){const s=.5/Math.tan(.5*t);return[u.range[0]+s,u.range[1]+s]}function si(u,t,s,h,_){const y=r.ad([],[t,s,h],_.mercatorFogMatrix);return Xt(u,r.ae(y),_.pitch,_._fov)}function Bi(u,t,s,h,_,y,b){const C=[[s,h,0],[_,h,0],[_,y,0],[s,y,0]];let I=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(const k of C){const U=r.ad([],k,t),V=r.ae(U);I=Math.min(I,V),O=Math.max(O,V)}return[Xt(u,I,b.pitch,b._fov),Xt(u,O,b.pitch,b._fov)]}class Ni extends r.E{constructor(t,s,h,_){super();const y=new r.a7({range:new r.a8(r.a5.fog.range),color:new r.a8(r.a5.fog.color),"color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a8(r.a5.fog["high-color"]),"high-color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a8(r.a5.fog["space-color"]),"space-color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a8(r.a5.fog["horizon-blend"]),"star-intensity":new r.a8(r.a5.fog["star-intensity"]),"vertical-range":new r.a8(r.a5.fog["vertical-range"])});this._transitionable=new r.a6(y,h,new Map(_)),this.set(t,_),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new r.ag(y),this.scope=h}get state(){const t=this._transform,s=t.projection.name==="globe",h=r.ah(t.zoom),_=this.properties.get("range"),y=[.5,3];return{range:s?[r.ai(y[0],_[0],h),r.ai(y[1],_[1],h)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s,h={}){if(this._validate(io,t,h))return;const _=r.h({},t);for(const y of Object.keys(r.a5.fog))_[y]===void 0&&(_[y]=r.a5.fog[y].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.af(tt,vt,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?function(h,_,y){const b=r.ac.fromLngLat(_),C=y.elevation?y.elevation.getAtPointOrZero(b):0;return si(h,b.x,b.y,C,y)}(this.state,t,s):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Bi(this.state,s,0,0,r.aj,r.aj,this._transform)}getOpacityForBounds(t,s,h,_,y){return this._transform.projection.supportsFog?Bi(this.state,t,s,h,_,y,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?pi(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const h of s){const _=t.points[h];let y;if(_[2]>=0)y=_;else{const b=t.points[h-4];y=r.ak(b,_,b[2]/(b[2]-_[2]))}if(si(this.state,y[0],y[1],0,this._transform)>=rt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&Me(this,t.call(Fs,r.h({value:s,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}}let Vi,Ji,Yi,Hn,ir=class extends r.E{constructor(u,t,s,h){super();const _=Vi||(Vi=new r.a7({density:new r.a8(r.a5.snow.density),intensity:new r.a8(r.a5.snow.intensity),color:new r.a8(r.a5.snow.color),opacity:new r.a8(r.a5.snow.opacity),vignette:new r.a8(r.a5.snow.vignette),"vignette-color":new r.a8(r.a5.snow["vignette-color"]),"center-thinning":new r.a8(r.a5.snow["center-thinning"]),direction:new r.a8(r.a5.snow.direction),"flake-size":new r.a8(r.a5.snow["flake-size"])}));this._transitionable=new r.a6(_,s,new Map(h)),this.set(u,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ag(_),this.scope=s}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),h=r.al(s[0]),_=-Math.max(r.al(s[1]),.01),y=[Math.cos(h)*Math.cos(_),Math.sin(h)*Math.cos(_),Math.sin(_)],b=this.properties.get("vignette"),C=this.properties.get("vignette-color");return C.a=b,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.am(t.r,t.g,t.b,t.a*u),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(u,t,s={}){if(this._validate(va,u,s))return;const h=r.h({},u);for(const _ of Object.keys(r.a5.snow))h[_]===void 0&&(h[_]=r.a5.snow[_].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,s){return(!s||s.validate!==!1)&&Me(this,u.call(Fs,r.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}},Vn=class extends r.E{constructor(u,t,s,h){super();const _=Ji||(Ji=new r.a7({density:new r.a8(r.a5.rain.density),intensity:new r.a8(r.a5.rain.intensity),color:new r.a8(r.a5.rain.color),opacity:new r.a8(r.a5.rain.opacity),vignette:new r.a8(r.a5.rain.vignette),"vignette-color":new r.a8(r.a5.rain["vignette-color"]),"center-thinning":new r.a8(r.a5.rain["center-thinning"]),direction:new r.a8(r.a5.rain.direction),"droplet-size":new r.a8(r.a5.rain["droplet-size"]),"distortion-strength":new r.a8(r.a5.rain["distortion-strength"])}));this._transitionable=new r.a6(_,s,new Map(h)),this.set(u,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ag(_),this.scope=s}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),h=r.al(s[0]),_=-Math.max(r.al(s[1]),.01),y=[Math.cos(h)*Math.cos(_),Math.sin(h)*Math.cos(_),Math.sin(_)],b=this.properties.get("vignette-color");return b.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.am(t.r,t.g,t.b,t.a*u),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(u,t,s={}){if(this._validate(xa,u,s))return;const h=r.h({},u);for(const _ of Object.keys(r.a5.rain))h[_]===void 0&&(h[_]=r.a5.rain[_].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,s){return(!s||s.validate!==!1)&&Me(this,u.call(Fs,r.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}};class Mn extends r.E{constructor(t,s,h,_){super(),this.scope=h,this._options=t,this.properties=new r.ag(s),this._transitionable=new r.a6(s,h,new Map(_)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,s){this._options=t,this._transitionable.setTransitionOrValue(t.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Tn{constructor(t,s,h,_){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(t,s){let h,_;if(t instanceof r.P||typeof t[0]=="number"){const y=r.P.convert(t);h=[y],_=s.isPointAboveHorizon(y)}else{const y=r.P.convert(t[0]),b=r.P.convert(t[1]),C=y.add(b)._div(2);h=[y,b],_=r.ao(y,b).every(I=>s.isPointAboveHorizon(I))&&s.isPointAboveHorizon(C)}return new Tn(h,s.getCameraPoint(),_,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.ao(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?_[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(_[3]=this.cameraPoint)),r.ap(_,t)}bufferedCameraGeometryGlobe(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.ao(s,h,t),y=this.cameraPoint.clone();switch(3*((y.y>s.y)+(y.y>h.y))+((y.x>s.x)+(y.x>h.x))){case 0:_[0]=y,_[4]=y.clone();break;case 1:_.splice(1,0,y);break;case 2:_[1]=y;break;case 3:_.splice(4,0,y);break;case 5:_.splice(2,0,y);break;case 6:_[3]=y;break;case 7:_.splice(3,0,y);break;case 8:_[2]=y}return _}containsTile(t,s,h,_=0){const y=t.queryPadding/s._pixelsPerMercatorPixel+1,b=h?this._bufferedCameraMercator(y,s):this._bufferedScreenMercator(y,s);let C=t.tileID.wrap+(b.unwrapped?_:0);const I=b.polygon.map(J=>r.aq(t.tileTransform,J,C));if(!r.ar(I,0,0,r.aj,r.aj))return;C=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const O=this.screenGeometryMercator.polygon.map(J=>r.as(t.tileTransform,J,C)),k=O.map(J=>new r.P(J[0],J[1])),U=s.getFreeCameraOptions().position||new r.ac(0,0,0),V=r.as(t.tileTransform,U,C),H=O.map(J=>{const ne=r.at(J,J,V);return r.au(ne,ne),new r.av(V,ne)}),Q=r.aw(t,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:H,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(X=r.ax(I),X.min.x=r.ay(X.min.x,0,r.aj),X.min.y=r.ay(X.min.y,0,r.aj),X.max.x=r.ay(X.max.x,0,r.aj),X.max.y=r.ay(X.max.y,0,r.aj),X),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Q};var X}_bufferedScreenMercator(t,s){const h=fr(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let _;return _=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map(y=>s.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[h]=_,_}}_bufferedCameraMercator(t,s){const h=fr(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let _;return _=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map(y=>s.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[h]=_,_}}_projectAndResample(t,s){const h=function(y,b){const C=r.az([],b.pixelMatrix,b.globeMatrix),I=[0,-r.aB,0,1],O=[0,r.aB,0,1],k=[0,0,0,1];r.aA(I,I,C),r.aA(O,O,C),r.aA(k,k,C);const U=new r.P(I[0]/I[3],I[1]/I[3]),V=new r.P(O[0]/O[3],O[1]/O[3]),H=r.aC(y,U)&&I[3]<k[3],Q=r.aC(y,V)&&O[3]<k[3];if(!H&&!Q)return null;const X=function(Ce,Ae,Pe){for(let Ne=1;Ne<Ce.length;Ne++){const Ke=dr(Ae.pointCoordinate3D(Ce[Ne-1]).x),Je=dr(Ae.pointCoordinate3D(Ce[Ne]).x);if(Pe<0){if(Ke<Je)return{idx:Ne,t:-Ke/(Je-1-Ke)}}else if(Je<Ke)return{idx:Ne,t:(1-Ke)/(Je+1-Ke)}}return null}(y,b,H?-1:1);if(!X)return null;const{idx:J,t:ne}=X;let oe=J>1?Xn(y.slice(0,J),b):[],ve=J<y.length?Xn(y.slice(J),b):[];oe=oe.map(Ce=>new r.P(dr(Ce.x),Ce.y)),ve=ve.map(Ce=>new r.P(dr(Ce.x),Ce.y));const Se=[...oe];Se.length===0&&Se.push(ve[ve.length-1]);const Le=r.ai(Se[Se.length-1].y,(ve.length===0?oe[0]:ve[0]).y,ne);let Ie;return Ie=H?[new r.P(0,Le),new r.P(0,0),new r.P(1,0),new r.P(1,Le)]:[new r.P(1,Le),new r.P(1,1),new r.P(0,1),new r.P(0,Le)],Se.push(...Ie),ve.length===0?Se.push(oe[0]):Se.push(...ve),{polygon:Se.map(Ce=>new r.ac(Ce.x,Ce.y)),unwrapped:!1}}(t,s);if(h)return h;const _=function(y,b){let C=!1,I=-1/0,O=0;for(let U=0;U<y.length-1;U++)y[U].x>I&&(I=y[U].x,O=U);for(let U=0;U<y.length-1;U++){const V=(O+U)%(y.length-1),H=y[V],Q=y[V+1];Math.abs(H.x-Q.x)>.5&&(H.x<Q.x?(H.x+=1,V===0&&(y[y.length-1].x+=1)):(Q.x+=1,V+1===y.length-1&&(y[0].x+=1)),C=!0)}const k=r.aD(b.center.lng);return C&&k<Math.abs(k-1)&&y.forEach(U=>{U.x-=1}),{polygon:y,unwrapped:C}}(Xn(t,s).map(y=>new r.P(dr(y.x),y.y)),s);return{polygon:_.polygon.map(y=>new r.ac(y.x,y.y)),unwrapped:_.unwrapped}}}function Xn(u,t){return r.aE(u,s=>{const h=t.pointCoordinate3D(s);s.x=h.x,s.y=h.y},1/256)}function dr(u){return u<0?1+u%1:u%1}function fr(u){return 100*u|0}function Fr(u,t,s,h,_){const y=function(C,I){if(C)return _(C);if(I){if(u.url&&I.tiles&&u.tiles&&delete u.tiles,I.variants){if(!Array.isArray(I.variants))return _(new Error("variants must be an array"));for(const k of I.variants){if(k==null||typeof k!="object"||k.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(k.capabilities))return _(new Error("capabilities must be an array"));if(k.capabilities.length===1&&k.capabilities[0]==="meshopt"){I=r.h(I,k);break}}}const O=r.aF(r.h({},I,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);O.tiles=t.canonicalizeTileset(O,u.url),_(null,O)}},b=function(C,I,O){if(!C)return null;if(!I&&!O)return C;O=O||C.worldview_default;const k=Object.values(C.language||{});if(k.length===0)return null;const U=Object.values(C.worldview||{});if(U.length===0)return null;const V=k.every(Q=>Q===I),H=U.every(Q=>Q===O);return V&&H?C:I in(C.language_options||{})||O in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(u.data,s,h);return b?r.q.frame(()=>y(null,b)):u.url?r.n(t.transformRequest(t.normalizeSourceURL(u.url,null,s,h),r.R.Source),y):r.q.frame(()=>{const{data:C,...I}=u;y(null,I)})}function Bs(u,t){const s=Math.pow(2,t.z),h=Math.floor(r.aD(u.getWest())*s),_=Math.floor(r.aH(u.getNorth())*s),y=Math.ceil(r.aD(u.getEast())*s),b=Math.ceil(r.aH(u.getSouth())*s);return t.x>=h&&t.x<y&&t.y>=_&&t.y<b}class As{constructor(t,s,h){this.bounds=t?r.aG.convert(this.validateBounds(t)):null,this.minzoom=s||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const s of t)this.extraBounds.push(r.aG.convert(this.validateBounds(s)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Bs(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const s of this.extraBounds)if(Bs(s,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const s=new As(t.bounds,t.minzoom,t.maxzoom);return s.addExtraBounds(t.extra_bounds),s}}class Ba extends r.E{constructor(t,s,h,_){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.h(this,r.aF(s,["url","scheme","tileSize","promoteId"])),this._options=r.h({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new r.aI}load(t){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=Fr(this._options,this.map._requestManager,s,h,(_,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new r.z(_));else if(y){if(r.h(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const b of y.vector_layers)this.vectorLayerIds.push(b.id),y.worldview&&y.worldview[b.source]&&this.localizableLayerIds.add(b.id)}this.tileBounds=As.fromTileJSON(y),ti(y.tiles,this.map._requestManager._customAccessToken),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(_)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.h({},this._options)}loadTile(t,s){const h=t.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(h),y=this.map._requestManager.transformRequest(_,r.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,C=b?{image:b.image.clone()}:null,I={request:y,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:C,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&r.j(h)&&(I.localizableLayerIds=this.localizableLayerIds),I.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",I,O.bind(this));else if(t.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",I,O.bind(this),void 0,!0);else{const k=r.aJ.call({deduped:this._deduped},I,(U,V)=>{U||!V?O.call(this,U):(I.data={cacheControl:V.cacheControl,expires:V.expires,rawData:V.rawData.slice(0)},t.actor&&t.actor.send("loadTile",I,O.bind(this),void 0,!0))},!0);t.request={cancel:k}}function O(k,U){return delete t.request,t.aborted?s(null):k&&k.status!==404?s(k):(U&&U.resourceTiming&&(t.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&t.setExpiryData(U),t.loadVectorData(U,this.map.painter),r.aK(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class hs extends r.E{constructor(t,s,h,_){super(),this.id=t,this.dispatcher=h,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.h({type:"raster"},s),r.h(this,r.aF(s,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"}));const s=this.map.getWorldview();this._tileJSONRequest=Fr(this._options,this.map._requestManager,null,s,(h,_)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new r.z(h)):_&&(r.h(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=As.fromTileJSON(_),ti(_.tiles),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(h)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.h({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const h=r.q.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=r.o(this.map._requestManager.transformRequest(_,r.R.Tile),(y,b,C,I)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):y?(t.state="errored",s(y)):b?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:C,expires:I}),t.setTexture(b,this.map.painter),t.state="loaded",r.aK(this.dispatcher),void s(null)):s(null)))}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s&&s()}unloadTile(t,s){t.texture&&t.texture instanceof r.T?(t.destroy(!0),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Cs extends hs{constructor(t,s,h,_){super(t,s,h,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=r.h({type:"raster-array"},s)}triggerRepaint(t){const s=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);s&&s.enabled&&h&&s._clearRenderCacheForTile(h.id,t.tileID),this.map.triggerRepaint()}loadTile(t,s){const h=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(h,r.R.Tile),y={request:_,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=_,t.actor||(t.actor=this.dispatcher.getActor());const b=(C,I,O,k)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(C)return C.name==="AbortError"?void 0:(t.state="errored",s(C));if(this.map._refreshExpiredTiles&&I&&t.setExpiryData({cacheControl:O,expires:k}),this.partial)t.state="empty";else{if(!I)return s(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=I}s(null)};t.request=this.partial?t.fetchHeader(void 0,b.bind(this)):t.actor.send("loadTile",y,b.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){const h=t.texture;h&&h instanceof r.T?(t.destroy(!0),this.map.painter.saveTileTexture(h)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,s,h){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(s,h,(_,y)=>{if(_)return t.state="errored",this.fire(new r.z(_)),void this.triggerRepaint(t);y&&(t._isHeaderLoaded=!0,t.setTexture(y,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:y})=>y===t),h=s&&s.fields,_=h&&h.bands&&h.bands;return _?_[0]:0}getTextureDescriptor(t,s,h){if(!t)return;const _=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let y=null;s instanceof r.aN?y=s.paint.get("raster-array-band"):s instanceof r.aO&&(y=s.paint.get("raster-particle-array-band"));const b=y||this.getInitialBand(_);if(b!=null)if(t.textureDescriptor){if(!t.updateNeeded(_,b)||h)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,_,b)}getImages(t,s){const h=new Map;for(const _ of t)for(const y of s){const[b,C]=y.split("/"),I=_.getLayer(b);if(!I||!I.hasBand(C)||!I.hasDataForBand(C))continue;const{bytes:O,tileSize:k,buffer:U}=I.getBandView(C),V=k+2*U,H={data:new r.r({width:V,height:V},O),pixelRatio:2,sdf:!1,usvg:!1,version:0};h.set(y,H)}return h}}const Pl={vector:Ba,raster:hs,"raster-dem":class extends hs{constructor(u,t,s,h){super(u,t,s,h),this.type="raster-dem",this.maxzoom=22,this._options=r.h({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(_,y){_&&(u.state="errored",t(_)),y&&(u.dem=y,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=r.o(this.map._requestManager.transformRequest(s,r.R.Tile),(function(_,y,b,C){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(_)u.state="errored",t(_);else if(y){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:b,expires:C});const I=ImageBitmap&&y instanceof ImageBitmap&&r.t(),O=1-(y.width-r.aL(y.width))/2;O<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const k=I?y:r.q.getImageData(y,O),U={uid:u.uid,tileID:u.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:O};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadTile",U,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const t=u.canonical,s=Math.pow(2,t.z),h=(t.x-1+s)%s,_=t.x===0?u.wrap-1:u.wrap,y=(t.x+1+s)%s,b=t.x+1===s?u.wrap+1:u.wrap,C={};return C[new r.aM(u.overscaledZ,_,t.z,h,t.y).key]={backfilled:!1},C[new r.aM(u.overscaledZ,b,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(C[new r.aM(u.overscaledZ,_,t.z,h,t.y-1).key]={backfilled:!1},C[new r.aM(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},C[new r.aM(u.overscaledZ,b,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<s&&(C[new r.aM(u.overscaledZ,_,t.z,h,t.y+1).key]={backfilled:!1},C[new r.aM(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},C[new r.aM(u.overscaledZ,b,t.z,y,t.y+1).key]={backfilled:!1}),C}},"raster-array":Cs,geojson:class extends r.E{constructor(u,t,s,h){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=t.data,this._options=r.h({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const _=r.aj/this.tileSize;this.workerOptions=r.h({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*_,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*_,extent:r.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*_,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){if(!this._options.dynamic)return this.fire(new r.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection"))return this.fire(new r.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const s of this._data.features)t.set(s.id,s);for(const s of u.features)t.set(s.id,s);this._data.features=[...t.values()]}else this._data=u;return this._updateWorkerData(!0),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterLeaves(u,t,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:t,offset:s},h),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=r.h({append:u},this.workerOptions);t.scope=this.scope;const s=this._data;typeof s=="string"?(t.request=this.map._requestManager.transformRequest(r.q.resolveURL(s),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new r.z(h));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(y.resourceTiming=_.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new r.A("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const u=r.C(this.id,this.scope);this.map.style.clearSource(u),this._updateWorkerData()}loadTile(u,t){const s=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const h=this.map.style?this.map.style.getLut(this.scope):null,_=h?{image:h.image.clone()}:null,y=this._partialReload,b={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:u.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview()};u.request=this.actor.send(s,b,(C,I)=>y&&!I?(u.state="loaded",t(null)):(delete u.request,u.destroy(),u.aborted?t(null):C?t(C):(u.loadVectorData(I,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,t){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aP{constructor(u,t,s,h){super(u,t,s,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aQ(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new r.z(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new r.z(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(u,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aP,model:class extends r.E{constructor(u,t,s,h){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const u=[];for(const t in this._options.models){const s=this._options.models[t],h=r.aS(this.map._requestManager.transformRequest(s.uri,r.R.Model).url).then(_=>{if(!_)return;const y=r.aT(_),b=new r.aU(t,s.position,s.orientation,y);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(_=>{this.fire(new r.z(new Error(`Could not load model ${t} from ${s.uri}: ${_.message}`)))});u.push(h)}Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new r.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,t){}serialize(){return this._options}},"batched-model":class extends r.E{constructor(u,t,s,h){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(u){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=Fr(this._options,this.map._requestManager,t,s,(h,_)=>{this._tileJSONRequest=null,this._loaded=!0,h?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new r.z(h))):_&&(r.h(this,_),_.bounds&&(this.tileBounds=new As(_.bounds,this.minzoom,this.maxzoom)),ti(_.tiles,this.map._requestManager._customAccessToken),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))),u&&u(h)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,t){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,r.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.q.devicePixelRatio,promoteId:this.promoteId};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=t;else{if(u.buckets){const y=Object.values(u.buckets);for(const b of y)b.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",h,_.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",h,_.bind(this),void 0,!0);function _(y,b){return u.aborted?t(null):y&&y.status!==404?t(y):(this.map._refreshExpiredTiles&&b&&u.setExpiryData(b),u.loadModelData(b,this.map.painter),u.state="loaded",void t(null))}}serialize(){return r.h({},this._options)}},canvas:class extends r.aP{constructor(u,t,s,h){super(u,t,s,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new r.z(new r.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.z(new r.V(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.z(new r.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.z(new r.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.z(new r.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof r.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends r.E{constructor(u,t,s,h){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new As(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),r.h(this,r.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:t,y:s,z:h}=u.canonical;return this._implementation.hasTile({x:t,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,t){const{x:s,y:h,z:_}=u.tileID.canonical,y=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:s,y:h,z:_},{signal:y.signal})).then((function(b){return delete u.request,u.aborted?(u.state="unloaded",t(null)):b===void 0?(u.state="errored",t(null)):b===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(b)?(this.loadTileData(u,b),u.state="loaded",void t(null)):(u.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.name!=="AbortError"&&(u.state="errored",t(b))}),u.request.cancel=()=>y.abort()}loadTileData(u,t){u.setTexture(t,this.map.painter)}unloadTile(u,t){if(u.texture&&u.texture instanceof r.T?(u.destroy(!0),u.texture&&u.texture instanceof r.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:s,y:h,z:_}=u.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:_})}t&&t()}abortTile(u,t){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=r.C(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}}},fl=function(u,t,s,h){const _=new Pl[t.type](u,t,s,h);if(_.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${_.id}`);return r.aV(["load","abort","unload","serialize","prepare"],_),_};function Fo(u,t,s=""){return`${s}:${t.id||""}:${t.layer.id}:${function(h){if("layerId"in h)return`layer:${h.layerId}`;{const{featuresetId:_,importId:y}=h;return`featureset:${_}${y?`:import:${y}`:""}`}}(u.target)}`}function Ol(u,t,s,h=""){if(u.uniqueFeatureID){const _=Fo(u,t,h);if(s.has(_))return!0;s.add(_)}return!1}function no(u,t,s,h,_=!1){const y=t.sourceCache.transform,b=t.sourceCache.tilesIn(u,t.has3DLayers,_);b.sort(ja);const C=[];for(const I of b){const O=I.tile.queryRenderedFeatures(t,I,s,h,y,_);Object.keys(O).length&&C.push({wrappedTileID:I.tile.tileID.wrapped().key,queryResults:O})}return C.length===0?{}:function(I){const O={},k={};for(const U of I){const V=U.queryResults,H=U.wrappedTileID,Q=k[H]=k[H]||{};for(const X in V){const J=V[X],ne=Q[X]=Q[X]||{},oe=O[X]=O[X]||[];for(const ve of J)ne[ve.featureIndex]||(ne[ve.featureIndex]=!0,oe.push(ve))}}return O}(C)}function Bo(u,t,s,h,_,y){const b={},C=h.queryRenderedSymbols(u),I=[];for(const O of Object.keys(C).map(Number))I.push(_[O]);I.sort(ja);for(const O of I){const k=O.featureIndex.lookupSymbolFeatures(C[O.bucketInstanceId],O.bucketIndex,O.sourceLayerIndex,t,s,y);for(const U in k){const V=b[U]=b[U]||[],H=k[U];H.sort((Q,X)=>{const J=O.featureSortOrder;if(J){const ne=J.indexOf(Q.featureIndex);return J.indexOf(X.featureIndex)-ne}return X.featureIndex-Q.featureIndex});for(const Q of H)V.push(Q)}}return b}function rs(u,t){const s=u.getRenderableIds().map(y=>u.getTileByID(y)),h=[],_={};for(let y=0;y<s.length;y++){const b=s[y],C=b.tileID.canonical.key;_[C]||(_[C]=!0,b.querySourceFeatures(h,t))}return h}function ja(u,t){const s=u.tileID,h=t.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function ba(u,t){const s={};if(!t)return s;for(const h of u){const _=h.layerIds.map(y=>t.getLayer(y)).filter(Boolean);if(_.length!==0){h.layers=_,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(y=>_.filter(b=>b.id===y)[0]));for(const y of _)s[y.fqid]=h}}return s}const Ys=32,js=33,po=new Uint16Array(8184);for(let u=0;u<2046;u++){let t=u+2,s=0,h=0,_=0,y=0,b=0,C=0;for(1&t?_=y=b=Ys:s=h=C=Ys;(t>>=1)>1;){const O=s+_>>1,k=h+y>>1;1&t?(_=s,y=h,s=b,h=C):(s=_,h=y,_=b,y=C),b=O,C=k}const I=4*u;po[I+0]=s,po[I+1]=h,po[I+2]=_,po[I+3]=y}const wa=new Uint16Array(2178),Ks=new Uint8Array(1089),hc=new Uint16Array(1089);function ro(u){return u===0?-.03125:u===32?.03125:0}const pl={type:2,extent:r.aj,loadGeometry:()=>[[new r.P(0,0),new r.P(r.aj+1,0),new r.P(r.aj+1,r.aj+1),new r.P(0,r.aj+1),new r.P(0,0)]]};class Va{constructor(t,s,h,_,y,b){this.tileID=t,this.uid=r.a$(),this.uses=0,this.tileSize=s,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection),this.worldview=b}registerFadeDuration(t){const s=t+this.timeAdded;s<r.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,h){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=ba(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const y=this.buckets[_];if(y instanceof r.b1){if(this.hasSymbolBuckets=!0,!h)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const y=this.buckets[_];if(y instanceof r.b1&&y.hasRTLText){this.hasRTLText=!0,r.b2();break}}this.queryPadding=0;for(const _ in this.buckets){const y=this.buckets[_],b=s.style.getOwnLayer(_);if(!b)continue;const C=b.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,C)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,s,h){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,ba(t.buckets,s.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const _ in this.buckets){const y=this.buckets[_];y.uploadPending()&&y.upload(t)}const s=t.gl,h=this.imageAtlas;h&&!h.uploaded&&(this.imageAtlasTexture=new r.T(t,h.image,s.RGBA8,{useMipmap:!!h.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(t,s,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,h),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=s.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}queryRenderedFeatures(t,s,h,_,y,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const C=function(I,O){const k=r.bn([],[.5*I.width,.5*-I.height,1]);return r.bo(k,k,[1,-1,0]),r.az(k,k,I.calculateProjMatrix(O.toUnwrapped())),Float32Array.from(k)}(y,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:s,pixelPosMatrix:C,transform:_,availableImages:h,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,s){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const _=h.loadVTLayers(),y=s?s.sourceLayer:"",b=_._geojsonTileLayer||_[y];if(!b)return;const C=r.b3(s&&s.filter),{z:I,x:O,y:k}=this.tileID.canonical,U={z:I,x:O,y:k};for(let V=0;V<b.length;V++){const H=b.feature(V);if(C.needGeometry){const J=r.b4(H,!0);if(!C.filter(new r.aa(this.tileID.overscaledZ,{worldview:this.worldview}),J,this.tileID.canonical))continue}else if(!C.filter(new r.aa(this.tileID.overscaledZ,{worldview:this.worldview}),H))continue;const Q=h.getId(H,y),X=new r.b5(H,I,O,k,Q);X.tile=U,t.push(X)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const h=r.b6(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let _=!1;if(this.expirationTime>h)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{const y=this.expirationTime-s;y?this.expirationTime=h+Math.max(y,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,s){if(!this.latestFeatureIndex||!t.style)return;const h=this.latestFeatureIndex.loadVTLayers(),_=t.style.listImages(),y=t.style.getBrightness();for(const b in this.buckets){if(!t.style.hasLayer(b))continue;const C=this.buckets[b],I=C.layers[0],O=I.sourceLayer||"_geojsonTileLayer",k=h[O],U=t.style.getLayerSourceCache(I);let V={};U&&(V=U._state.getState(O,void 0));const H=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Q=Object.keys(V).length>0&&!s;Q&&!C.stateDependentLayers.length&&!s||C.update(V,k,_,H,Q?C.stateDependentLayers:C.layers,s,y),(C instanceof r.b7||C instanceof r.b8)&&t._terrain&&t._terrain.enabled&&U&&C.uploadPending()&&t._terrain._clearRenderCacheForTile(U.id,this.tileID);const X=t&&t.style&&t.style.getOwnLayer(b);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.q.now()+t}setTexture(t,s){const h=s.context,_=h.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(h,t,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(t,s){const h={};for(const _ of s)h[_]=!0;this.dependencies[t]=h}hasDependency(t,s){for(const h of t){const _=this.dependencies[h];if(_){for(const y of s)if(_[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const h=r.b9(pl,this.tileID.canonical,this.tileTransform)[0],_=new r.ba,y=new r.bb;for(let b=0;b<h.length;b++){const{x:C,y:I}=h[b];_.emplaceBack(C,I),y.emplaceBack(b)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(_,r.bc.members),this._tileDebugSegments=r.bd.simpleSegment(0,0,_.length,y.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const h=r.b9(pl,this.tileID.canonical,this.tileTransform)[0];let _,y;if(this.isRaster){const b=function(C,I){const O=r.aW(C,I),k=Math.pow(2,C.z);for(let J=0;J<js;J++)for(let ne=0;ne<js;ne++){const oe=r.aX((C.x+(ne+ro(ne))/Ys)/k),ve=r.aY((C.y+(J+ro(J))/Ys)/k),Se=I.project(oe,ve),Le=J*js+ne;wa[2*Le+0]=Math.round((Se.x*O.scale-O.x)*r.aj),wa[2*Le+1]=Math.round((Se.y*O.scale-O.y)*r.aj)}Ks.fill(0),hc.fill(0);for(let J=2045;J>=0;J--){const ne=4*J,oe=po[ne+0],ve=po[ne+1],Se=po[ne+2],Le=po[ne+3],Ie=oe+Se>>1,Ce=ve+Le>>1,Ae=Ie+Ce-ve,Pe=Ce+oe-Ie,Ne=ve*js+oe,Ke=Le*js+Se,Je=Ce*js+Ie,mt=Math.hypot((wa[2*Ne+0]+wa[2*Ke+0])/2-wa[2*Je+0],(wa[2*Ne+1]+wa[2*Ke+1])/2-wa[2*Je+1])>=16;Ks[Je]=Ks[Je]||(mt?1:0),J<1022&&(Ks[Je]=Ks[Je]||Ks[(ve+Pe>>1)*js+(oe+Ae>>1)]||Ks[(Le+Pe>>1)*js+(Se+Ae>>1)])}const U=new r.aZ,V=new r.a_;let H=0;function Q(J,ne){const oe=ne*js+J;return hc[oe]===0&&(U.emplaceBack(wa[2*oe+0],wa[2*oe+1],J*r.aj/Ys,ne*r.aj/Ys),hc[oe]=++H),hc[oe]-1}function X(J,ne,oe,ve,Se,Le){const Ie=J+oe>>1,Ce=ne+ve>>1;if(Math.abs(J-Se)+Math.abs(ne-Le)>1&&Ks[Ce*js+Ie])X(Se,Le,J,ne,Ie,Ce),X(oe,ve,Se,Le,Ie,Ce);else{const Ae=Q(J,ne),Pe=Q(oe,ve),Ne=Q(Se,Le);V.emplaceBack(Ae,Pe,Ne)}}return X(0,0,Ys,Ys,Ys,0),X(Ys,Ys,0,0,0,Ys),{vertices:U,indices:V}}(this.tileID.canonical,s);_=b.vertices,y=b.indices}else{_=new r.aZ,y=new r.a_;for(const{x:C,y:I}of h)_.emplaceBack(C,I,0,0);const b=r.be(_.int16.subarray(0,4*_.length),void 0,4);for(let C=0;C<b.length;C+=3)y.emplaceBack(b[C],b[C+1],b[C+2])}this._tileBoundsBuffer=t.createVertexBuffer(_,r.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=r.bd.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugBuffers(t,s){const h=s.projection;if(!h||h.name!=="globe"||s.freezeTileCoverage)return;const _=this.tileID.canonical,y=r.bg(_,s),b=r.bh(y),C=r.ah(s.zoom);let I;C>0&&(I=r.bi(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,_,s,b,I,C),this._makeGlobeTileDebugTextBuffer(t,_,s,b,I,C)}_globePoint(t,s,h,_,y,b,C){let I=r.bj(t,s,h);if(b){const O=1<<h.z,k=r.aD(_.center.lng),U=r.aH(_.center.lat),V=(h.x+.5)/O-k;let H=0;V>.5?H=-1:V<-.5&&(H=1);let Q=(t/r.aj+h.x)/O+H,X=(s/r.aj+h.y)/O;Q=(Q-k)*_._pixelsPerMercatorPixel+k,X=(X-U)*_._pixelsPerMercatorPixel+U;const J=[Q*_.worldSize,X*_.worldSize,0];r.ad(J,J,b),I=r.bk(I,J,C)}return r.ad(I,I,y)}_makeGlobeTileDebugBorderBuffer(t,s,h,_,y,b){const C=new r.ba,I=new r.bb,O=new r.bl,k=(V,H,Q,X,J)=>{const ne=(Q-V)/(J-1),oe=(X-H)/(J-1),ve=C.length;for(let Se=0;Se<J;Se++){const Le=V+Se*ne,Ie=H+Se*oe;C.emplaceBack(Le,Ie);const Ce=this._globePoint(Le,Ie,s,h,_,y,b);O.emplaceBack(Ce[0],Ce[1],Ce[2]),I.emplaceBack(ve+Se)}},U=r.aj;k(0,0,U,0,16),k(U,0,U,U,16),k(U,U,0,U,16),k(0,U,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(I),this._tileDebugBuffer=t.createVertexBuffer(C,r.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(O,r.bm.members),this._tileDebugSegments=r.bd.simpleSegment(0,0,C.length,I.length)}_makeGlobeTileDebugTextBuffer(t,s,h,_,y,b){const C=r.aj/4,I=new r.ba,O=new r.a_,k=new r.bl,U=25;O.reserve(32),I.reserve(U),k.reserve(U);const V=(H,Q)=>U*H+Q;for(let H=0;H<U;H++){const Q=H*C;for(let X=0;X<U;X++){const J=X*C;I.emplaceBack(J,Q);const ne=this._globePoint(J,Q,s,h,_,y,b);k.emplaceBack(ne[0],ne[1],ne[2])}}for(let H=0;H<4;H++)for(let Q=0;Q<4;Q++){const X=V(H,Q),J=V(H,Q+1),ne=V(H+1,Q),oe=V(H+1,Q+1);O.emplaceBack(X,J,ne),O.emplaceBack(ne,J,oe)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(O),this._tileDebugTextBuffer=t.createVertexBuffer(I,r.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(k,r.bm.members),this._tileDebugTextSegments=r.bd.simpleSegment(0,0,U,32)}destroy(t=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bp.setPbf(r.bq);class Ua extends Va{constructor(t,s,h,_,y){super(t,s,h,_,y),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,s){const h=s.context,_=h.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t,{premultiply:!1}):this.texture=new r.T(h,t,_.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,s){const h=this._mrt=new r.bp(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.br(_,(y,b,C,I)=>{if(y)s(y);else try{const O=h.getHeaderLength(b);if(O>t)return void(this.request=this.fetchHeader(O,s));h.parseHeader(b),this._isHeaderLoaded=!0;let k=0;for(const U of Object.values(h.layers))k=Math.max(k,U.dataIndex[U.dataIndex.length-1].lastByte);b.byteLength>=k&&(this.entireBuffer=b),s(null,this.entireBuffer||b,C,I)}catch(O){s(O)}}),this.request}fetchBand(t,s,h){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void h(new Error("Tile header is not ready"));const y=this.actor;if(!y)return void h(new Error("Can't fetch tile band without an actor"));let b;const C=(U,V)=>{b.complete(U,V),U?h(U):(this.updateTextureDescriptor(t,s),h(null,this.textureDescriptor&&this.textureDescriptor.img))},I=(U,V)=>{if(U)return h(U);const H=y.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:V,task:b},C,void 0,!0);this._workQueue.push(()=>{H&&H.cancel(),b.cancel()})},O=_.getLayer(t);if(!O)return void h(new Error(`Unknown sourceLayer "${t}"`));if(O.hasDataForBand(s))return this.updateTextureDescriptor(t,s),void h(null,this.textureDescriptor?this.textureDescriptor.img:null);const k=O.getDataRange([s]);if(b=_.createDecodingTask(k),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)I(null,this.entireBuffer.slice(k.firstByte,k.lastByte+1));else{const U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${k.firstByte}-${k.lastByte}`}}),V=r.br(U,I);this._fetchQueue.push(()=>{V.cancel(),b.cancel()})}else h(null)}updateNeeded(t,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,s){if(!this._mrt)return;const h=this._mrt.getLayer(t);if(!h||!h.hasBand(s)||!h.hasDataForBand(s))return;const{bytes:_,tileSize:y,buffer:b,offset:C,scale:I}=h.getBandView(s),O=y+2*b,k=new r.r({width:O,height:O},_),U=this.texture;U&&U instanceof r.T&&U.update(k,{premultiply:!1}),this.textureDescriptor={layer:t,band:s,img:k,buffer:b,offset:C,tileSize:y,format:h.pixelFormat,mix:[I,256*I,65536*I,16777216*I]}}}class _u{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,h){const _=t.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const y={value:s,timeout:void 0};if(h!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},h)),this.data[_].push(y),this.order.push(_),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const h=t.wrapped().key,_=s===void 0?0:this.data[h].indexOf(s),y=this.data[h][_];return this.data[h].splice(_,1),y.timeout&&clearTimeout(y.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(y.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const h in this.data)for(const _ of this.data[h])t(_.value)||s.push(_);for(const h of s)this.remove(h.value.tileID,h)}}class ot{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,h){const _=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][_]=this.stateChanges[t][_]||{},r.h(this.stateChanges[t][_],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==_&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][_]===null){this.deletedStates[t][_]={};for(const y in this.state[t][_])h[y]||(this.deletedStates[t][_][y]=null)}else for(const y in h)this.deletedStates[t]&&this.deletedStates[t][_]&&this.deletedStates[t][_][y]===null&&delete this.deletedStates[t][_][y]}removeFeatureState(t,s,h){if(this.deletedStates[t]===null)return;const _=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&s!==void 0)this.deletedStates[t][_]!==null&&(this.deletedStates[t][_]=this.deletedStates[t][_]||{},this.deletedStates[t][_][h]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][_])for(h in this.deletedStates[t][_]={},this.stateChanges[t][_])this.deletedStates[t][_][h]=null;else this.deletedStates[t][_]=null;else this.deletedStates[t]=null}getState(t,s){const h=this.state[t]||{},_=this.stateChanges[t]||{},y=this.deletedStates[t];if(y===null)return{};if(s!==void 0){const C=String(s),I=r.h({},h[C],_[C]);if(y){const O=y[s];if(O===null)return{};for(const k in O)delete I[k]}return I}const b=r.h({},h,_);if(y)for(const C in y)delete b[C];return b}initializeTileState(t,s){t.refreshFeatureState(s)}coalesceChanges(t,s){const h={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const y={};for(const b in this.stateChanges[_])this.state[_][b]||(this.state[_][b]={}),r.h(this.state[_][b],this.stateChanges[_][b]),y[b]=this.state[_][b];h[_]=y}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const y={};if(this.deletedStates[_]===null)for(const b in this.state[_])y[b]={},this.state[_][b]={};else for(const b in this.deletedStates[_]){if(this.deletedStates[_][b]===null)this.state[_][b]={};else if(this.state[_][b])for(const C of Object.keys(this.deletedStates[_][b]))delete this.state[_][b][C];y[b]=this.state[_][b]}h[_]=h[_]||{},r.h(h[_],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const _ in t)t[_].refreshFeatureState(s)}}class Ht extends r.E{constructor(t,s,h){super(),this.id=t,this._onlySymbols=h,s.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new _u(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new ot,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const h=this._tiles[s];h.upload(t),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Si).map(t=>t.key)}getRenderableIds(t,s){const h=[];for(const _ in this._tiles)this._isIdRenderable(+_,t,s)&&h.push(this._tiles[_]);return t?h.sort((_,y)=>{const b=_.tileID,C=y.tileID,I=new r.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),O=new r.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-C.overscaledZ||O.y-I.y||O.x-I.x}).map(_=>_.tileID.key):h.map(_=>_.tileID).sort(Si).map(_=>_.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s,h){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())&&(h||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=s),this._loadTile(h,this._tileLoaded.bind(this,h,t,s)))}_tileLoaded(t,s,h,_){if(_)if(t.state="errored",_.status!==404)this._source.fire(new r.z(_,{tile:t}));else{if(this._source.fire(new r.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=r.q.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new r.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let _=0;_<s.length;_++){const y=s[_];if(t.neighboringTiles&&t.neighboringTiles[y]){const b=this.getTileByID(y);h(t,b),h(b,t)}}function h(_,y){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let b=y.tileID.canonical.x-_.tileID.canonical.x;const C=y.tileID.canonical.y-_.tileID.canonical.y,I=Math.pow(2,_.tileID.canonical.z),O=y.tileID.key;b===0&&C===0||Math.abs(C)>1||(Math.abs(b)>1&&(Math.abs(b+I)===1?b+=I:Math.abs(b-I)===1&&(b-=I)),y.dem&&_.dem&&(_.dem.backfillBorder(y.dem,b,C),_.neighboringTiles&&_.neighboringTiles[O]&&(_.neighboringTiles[O].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,h,_){for(const y in this._tiles){let b=this._tiles[y];if(_[y]||!b.hasData()||b.tileID.overscaledZ<=s||b.tileID.overscaledZ>h)continue;let C=b.tileID;for(;b&&b.tileID.overscaledZ>s+1;){const O=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[O.key],b&&b.hasData()&&(C=O)}let I=C;for(;I.overscaledZ>s;)if(I=I.scaledTo(I.overscaledZ-1),t[I.key]){_[C.key]=C;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=s?h:null}for(let h=t.overscaledZ-1;h>=s;h--){const _=t.scaledTo(h),y=this._getLoadedTile(_);if(y)return y}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const h=Math.ceil(t.width/s)+1,_=Math.ceil(t.height/s)+1,y=Math.floor(h*_*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(C)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const h={};for(const _ in this._tiles){const y=this._tiles[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+s),h[y.tileID.key]=y}this._tiles=h;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(t,s,h,_,y){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let C,I=this._source.maxzoom;const O=this.map&&this.map.painter?this.map.painter._terrain:null;if(O&&O.sourceCache===this&&O.attenuationRange()){const V=O.attenuationRange()[0],H=Math.floor(V)-Math.log2(O.getDemUpscale());I>H&&(I=H)}if(this.used||this.usedForTerrain){if(this._source.tileID)C=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new r.aM(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y));else if(this.tileCoverLift!==0){const V=t.clone();V.tileCoverLift=this.tileCoverLift,C=V.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&t.projection.name==="globe"&&(C.push(new r.aM(1,0,1,0,0)),C.push(new r.aM(1,0,1,1,0)),C.push(new r.aM(1,0,1,0,1)),C.push(new r.aM(1,0,1,1,1)))}else if(C=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const V=this._source.hasTile.bind(this._source);C=C.filter(H=>V(H))}}else C=[];if(C.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Sn(this._source.type)){const V=t.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),H=Math.min(V,this._source.maxzoom);if(b){const Q=t.extendTileCover(C,H);for(const X of Q)C.push(X)}else if(y){const Q=t.extendTileCover(C,H,this.transform._camera.forward());for(const X of Q)C.push(X)}else if(this.castsShadows&&_){const Q=t.extendTileCover(C,H,_);for(const X of Q)this._shadowCasterTiles[X.key]=!0,C.push(X)}}const k=this._updateRetainedTiles(C);if(Sn(this._source.type)&&C.length!==0){const V={},H={},Q=Object.keys(k);for(const J of Q){const ne=k[J],oe=this._tiles[J];if(!oe||oe.fadeEndTime&&oe.fadeEndTime<=r.q.now())continue;const ve=this.findLoadedParent(ne,Math.max(ne.overscaledZ-Ht.maxOverzooming,this._source.minzoom));ve&&(this._addTile(ve.tileID),V[ve.tileID.key]=ve.tileID),H[J]=ne}const X=C[C.length-1].overscaledZ;for(const J in this._tiles){const ne=this._tiles[J];if(k[J]||!ne.hasData())continue;let oe=ne.tileID;for(;oe.overscaledZ>X;){oe=oe.scaledTo(oe.overscaledZ-1);const ve=this._tiles[oe.key];if(ve&&ve.hasData()&&H[oe.key]){k[J]=ne.tileID;break}}}for(const J in V)k[J]||(this._coveredTiles[J]=!0,k[J]=V[J])}for(const V in k)this._tiles[V].clearFadeHold();const U=r.bs(this._tiles,k);for(const V of U){const H=this._tiles[V];H.hasSymbolBuckets&&!H.holdingForFade()?H.setHoldDuration(this.map._fadeDuration):H.hasSymbolBuckets&&!H.symbolFadeFinished()||this._removeTile(+V)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const h={},_=t.reduce((O,k)=>Math.min(O,k.overscaledZ),1/0),y=t[0].overscaledZ,b=Math.max(y-Ht.maxOverzooming,this._source.minzoom),C=Math.max(y+Ht.maxUnderzooming,this._source.minzoom),I={};for(const O of t){const k=this._addTile(O);s[O.key]=O,k.hasData()||_<this._source.maxzoom&&(I[O.key]=O)}this._retainLoadedChildren(I,_,C,s);for(const O of t){let k=this._tiles[O.key];if(k.hasData())continue;if(O.canonical.z>=this._source.maxzoom){const V=O.children(this._source.maxzoom)[0],H=this.getTile(V);if(H&&H.hasData()){s[V.key]=V;continue}}else{const V=O.children(this._source.maxzoom);if(s[V[0].key]&&s[V[1].key]&&s[V[2].key]&&s[V[3].key])continue}let U=k.wasRequested();for(let V=O.overscaledZ-1;V>=b;--V){const H=O.scaledTo(V);if(h[H.key]||(h[H.key]=!0,k=this.getTile(H),!k&&U&&(k=this._addTile(H)),k&&(s[H.key]=H,U=k.wasRequested(),k.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let h,_=this._tiles[t].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){h=this._loadedParentTiles[_.key];break}s.push(_.key);const y=_.scaledTo(_.overscaledZ-1);if(h=this._getLoadedTile(y),h)break;_=y}for(const y of s)this._loadedParentTiles[y]=h}}_addTile(t){let s=this._tiles[t.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const h=!!s;if(!h){const _=this.map?this.map.painter:null,y=this._source.tileSize*t.overscaleFactor();s=this._source.type==="raster-array"?new Ua(t,y,this.transform.tileZoom,_,this._isRaster):new Va(t,y,this.transform.tileZoom,_,this._isRaster,this._source.worldview),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s.uses++,this._tiles[t.key]=s,h||this._source.fire(new r.A("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=s.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,h){const _=[],y=this.transform;if(!y)return _;const b=y.projection.name==="globe",C=r.aD(y.center.lng);for(const I in this._tiles){const O=this._tiles[I];if(h&&O.clearQueryDebugViz(),O.holdingForFade())continue;let k;if(b){const U=O.tileID.canonical;if(U.z===0){const V=[Math.abs(r.ay(C,...qn(U,-1))-C),Math.abs(r.ay(C,...qn(U,1))-C)];k=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(r.ay(C,...qn(U,-1))-C),Math.abs(r.ay(C,...qn(U,0))-C),Math.abs(r.ay(C,...qn(U,1))-C)];k=[V.indexOf(Math.min(...V))-1]}}else k=[0];for(const U of k){const V=t.containsTile(O,y,s,U);V&&_.push(V)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,s){const h=this.getRenderableIds(t,s).map(y=>this._tiles[y].tileID),_=this.transform.projection.name==="globe";for(const y of h)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=_?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return h}sortCoordinatesByDistance(t){const s=t.slice(),h=this.transform._camera.position,_=this.transform._camera.forward(),y={};for(const b of s){const C=1/(1<<b.canonical.z);y[b.key]=((b.canonical.x+.5)*C+b.wrap-h[0])*_[0]+((b.canonical.y+.5)*C-h[1])*_[1]-h[2]*_[2]}return s.sort((b,C)=>y[b.key]-y[C.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(Sn(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(t,s,h){this._state.updateState(t=t||"_geojsonTileLayer",s,h)}removeFeatureState(t,s,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,h)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,h){const _=this._tiles[t];_&&_.setDependencies(s,h)}reloadTilesForDependencies(t,s){for(const h in this._tiles)this._tiles[h].hasDependency(t,s)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(t,s))}_preloadTiles(t,s){if(!this._sourceLoaded){const I=()=>{this._sourceLoaded&&(this._source.off("data",I),this._preloadTiles(t,s))};return void this._source.on("data",I)}const h=new Map,_=Array.isArray(t)?t:[t],y=this.map.painter.terrain,b=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const I of _){const O=I.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of O)h.set(k.key,k);this.usedForTerrain&&I.updateElevation(!1)}const C=Array.from(h.values());r.bt(C,(I,O)=>{const k=new Va(I,this._source.tileSize*I.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(k,U=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),O(U,k)})},s)}}function Si(u,t){const s=Math.abs(2*u.wrap)-+(u.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||h-s||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function Sn(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function qn(u,t){const s=1<<u.z;return[u.x/s+t,(u.x+1)/s+t]}Ht.maxOverzooming=10,Ht.maxUnderzooming=3;class ys{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,s=!1;for(const h in this.style._mergedLayers){const _=this.style._mergedLayers[h];if(_.type==="fill-extrusion"||_.type==="building")this.layers.push({layer:_,visible:t,visibilityChanged:s});else if(_.type==="model"){const y=this.style.getLayerSource(_);y&&y.type==="batched-model"&&this.layers.push({layer:_,visible:t,visibilityChanged:s})}}}onNewFrame(t){this.layersGotHidden=!1;for(const s of this.layers){const h=s.layer;let _=!1;h.type==="fill-extrusion"?_=!h.isHidden(t)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="building"?_=!h.isHidden(t)&&h.paint.get("building-opacity")>0:h.type==="model"&&(_=!h.isHidden(t)&&h.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&s.visible,s.visible=_}}updateZOffset(t,s){this.currentBuildingBuckets=[];for(const _ of this.layers){const y=_.layer,b=this.style.getLayerSourceCache(y);let C=1;y.type==="fill-extrusion"?C=_.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(C=_.visible?y.paint.get("building-vertical-scale"):0);let I=b?b.getTile(s):null;if(!I&&b&&s.canonical.z>b.getSource().minzoom){let O=s.scaledTo(Math.min(b.getSource().maxzoom,s.overscaledZ-1));for(;O.overscaledZ>=b.getSource().minzoom&&(I=b.getTile(O),!I&&O.overscaledZ!==0);)O=O.scaledTo(O.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:I?I.getBucket(y):null,tileID:I?I.tileID:s,verticalScale:C})}t.hasAnyZOffset=!1;let h=!1;for(let _=0;_<t.symbolInstances.length;_++){const y=t.symbolInstances.get(_),b=y.zOffset,C=this._getHeightAtTileOffset(s,y.tileAnchorX,y.tileAnchorY);y.zOffset=C!==Number.NEGATIVE_INFINITY?C:b,h||b===y.zOffset||(h=!0),t.hasAnyZOffset||y.zOffset===0||(t.hasAnyZOffset=!0)}h&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,s,h,_){let y=s,b=h;if(t.canonical.z!==_.canonical.z){const C=_.canonical,I=1/(1<<t.canonical.z-C.z);y=(s+t.canonical.x*r.aj)*I-C.x*r.aj|0,b=(h+t.canonical.y*r.aj)*I-C.y*r.aj|0}return{tileX:y,tileY:b}}_getHeightAtTileOffset(t,s,h){let _,y;for(let b=0;b<this.layers.length;++b){const C=this.layers[b].layer;if(C.type!=="fill-extrusion"&&C.type!=="building")continue;const{bucket:I,tileID:O,verticalScale:k}=this.currentBuildingBuckets[b];if(!I)continue;const{tileX:U,tileY:V}=this._mapCoordToOverlappingTile(t,s,h,O),H=I.getHeightAtTileCoord(U,V);H&&H.height!==void 0&&(H.hidden?_=H.height:y=Math.max(H.height*k,y||0))}if(y!==void 0)return y;for(let b=0;b<this.layers.length;++b){const C=this.layers[b];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:I,tileID:O}=this.currentBuildingBuckets[b];if(!I)continue;const{tileX:k,tileY:U}=this._mapCoordToOverlappingTile(t,s,h,O),V=I.getHeightAtTileCoord(k,U);if(V&&!V.hidden)return V.height===void 0&&_!==void 0?Math.min(V.maxHeight,_)*V.verticalScale:V.height?V.height*V.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Qs(u,t){const s={};for(const h in u)h!=="ref"&&(s[h]=u[h]);return r.bu.forEach(h=>{h in t&&(s[h]=t[h])}),s}function Er(u){u=u.slice();const t=Object.create(null);for(let s=0;s<u.length;s++)t[u[s].id]=u[s];for(let s=0;s<u.length;s++)"ref"in u[s]&&(u[s]=Qs(u[s],t[u[s].ref]));return u}const en={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function ss(u,t,s){s.push({command:en.addSource,args:[u,t[u]]})}function Ga(u,t,s){t.push({command:en.removeSource,args:[u]}),s[u]=!0}function ds(u,t,s,h){Ga(u,s,h),ss(u,t,s)}function mo(u,t,s){let h;for(h in u[s])if(u[s].hasOwnProperty(h)&&h!=="data"&&!r.bv(u[s][h],t[s][h]))return!1;for(h in t[s])if(t[s].hasOwnProperty(h)&&h!=="data"&&!r.bv(u[s][h],t[s][h]))return!1;return!0}function ml(u,t,s,h,_,y){let b;for(b in t=t||{},u=u||{})u.hasOwnProperty(b)&&(r.bv(u[b],t[b])||s.push({command:y,args:[h,b,t[b],_]}));for(b in t)t.hasOwnProperty(b)&&!u.hasOwnProperty(b)&&(r.bv(u[b],t[b])||s.push({command:y,args:[h,b,t[b],_]}))}function Ta(u){return u.id}function Sa(u,t){return u[t.id]=t,u}class jo{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.ay(t,0,1);let s=1,h=this._distances[s];const _=t*this.paddedLength+this.padding;for(;h<_&&s<this._distances.length;)h=this._distances[++s];const y=s-1,b=this._distances[y],C=h-b,I=C>0?(_-b)/C:0;return this.points[y].mult(1-I).add(this.points[s].mult(I))}}class so{constructor(t,s,h){const _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(s/h);for(let b=0;b<this.xCellCount*this.yCellCount;b++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,h,_,y){this._forEachCell(s,h,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(t,s,h,_){this._forEachCell(s-_,h-_,s+_,h+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(h),this.circles.push(_)}_insertBoxCell(t,s,h,_,y,b){this.boxCells[y].push(b)}_insertCircleCell(t,s,h,_,y,b){this.circleCells[y].push(b)}_query(t,s,h,_,y,b){if(h<0||t>this.width||_<0||s>this.height)return!y&&[];const C=[];if(t<=0&&s<=0&&this.width<=h&&this.height<=_){if(y)return!0;for(let I=0;I<this.boxKeys.length;I++)C.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const O=this.circles[3*I],k=this.circles[3*I+1],U=this.circles[3*I+2];C.push({key:this.circleKeys[I],x1:O-U,y1:k-U,x2:O+U,y2:k+U})}return b?C.filter(b):C}return this._forEachCell(t,s,h,_,this._queryCell,C,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?C.length>0:C}_queryCircle(t,s,h,_,y){const b=t-h,C=t+h,I=s-h,O=s+h;if(C<0||b>this.width||O<0||I>this.height)return!_&&[];const k=[];return this._forEachCell(b,I,C,O,this._queryCellCircle,k,{hitTest:_,circle:{x:t,y:s,radius:h},seenUids:{box:{},circle:{}}},y),_?k.length>0:k}query(t,s,h,_,y){return this._query(t,s,h,_,!1,y)}hitTest(t,s,h,_,y){return this._query(t,s,h,_,!0,y)}hitTestCircle(t,s,h,_){return this._queryCircle(t,s,h,!0,_)}_queryCell(t,s,h,_,y,b,C,I){const O=C.seenUids,k=this.boxCells[y];if(k!==null){const V=this.bboxes;for(const H of k)if(!O.box[H]){O.box[H]=!0;const Q=4*H;if(t<=V[Q+2]&&s<=V[Q+3]&&h>=V[Q+0]&&_>=V[Q+1]&&(!I||I(this.boxKeys[H]))){if(C.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[H],x1:V[Q],y1:V[Q+1],x2:V[Q+2],y2:V[Q+3]})}}}const U=this.circleCells[y];if(U!==null){const V=this.circles;for(const H of U)if(!O.circle[H]){O.circle[H]=!0;const Q=3*H;if(this._circleAndRectCollide(V[Q],V[Q+1],V[Q+2],t,s,h,_)&&(!I||I(this.circleKeys[H]))){if(C.hitTest)return b.push(!0),!0;{const X=V[Q],J=V[Q+1],ne=V[Q+2];b.push({key:this.circleKeys[H],x1:X-ne,y1:J-ne,x2:X+ne,y2:J+ne})}}}}}_queryCellCircle(t,s,h,_,y,b,C,I){const O=C.circle,k=C.seenUids,U=this.boxCells[y];if(U!==null){const H=this.bboxes;for(const Q of U)if(!k.box[Q]){k.box[Q]=!0;const X=4*Q;if(this._circleAndRectCollide(O.x,O.y,O.radius,H[X+0],H[X+1],H[X+2],H[X+3])&&(!I||I(this.boxKeys[Q])))return b.push(!0),!0}}const V=this.circleCells[y];if(V!==null){const H=this.circles;for(const Q of V)if(!k.circle[Q]){k.circle[Q]=!0;const X=3*Q;if(this._circlesCollide(H[X],H[X+1],H[X+2],O.x,O.y,O.radius)&&(!I||I(this.circleKeys[Q])))return b.push(!0),!0}}}_forEachCell(t,s,h,_,y,b,C,I){const O=this._convertToXCellCoord(t),k=this._convertToYCellCoord(s),U=this._convertToXCellCoord(h),V=this._convertToYCellCoord(_);for(let H=O;H<=U;H++)for(let Q=k;Q<=V;Q++)if(y.call(this,t,s,h,_,this.xCellCount*Q+H,b,C,I))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,h,_,y,b){const C=_-t,I=y-s,O=h+b;return O*O>C*C+I*I}_circleAndRectCollide(t,s,h,_,y,b,C){const I=(b-_)/2,O=Math.abs(t-(_+I));if(O>I+h)return!1;const k=(C-y)/2,U=Math.abs(s-(y+k));if(U>k+h)return!1;if(O<=I||U<=k)return!0;const V=O-I,H=U-k;return V*V+H*H<=h*h}}const Ha={unknown:0,flipRequired:1,flipNotRequired:2},Js=Math.tan(85*Math.PI/180);function Gs(u,t,s,h,_,y,b){const C=r.bz();if(s)if(y.name==="globe"){const I=r.bA(_,t);r.az(C,C,I)}else{const I=r.bB([],b);C[0]=I[0],C[1]=I[1],C[4]=I[2],C[5]=I[3],h||r.by(C,C,_.angle)}else r.az(C,_.labelPlaneMatrix,u);return C}function Vo(u,t,s,h,_,y,b){const C=Gs(u,t,s,h,_,y,b);return y.name==="globe"&&s||(C[2]=C[6]=C[10]=C[14]=0),C}function qe(u,t,s,h,_,y,b){if(s){if(y.name==="globe"){const C=Gs(u,t,s,h,_,y,b);return r.bi(C,C),r.az(C,u,C),C}{const C=r.bw(u),I=r.bx([]);return I[0]=b[0],I[1]=b[1],I[4]=b[2],I[5]=b[3],r.az(C,C,I),h||r.by(C,C,-_.angle),C}}return _.glCoordMatrix}function Tt(u,t,s,h){const _=[u,t,s,1];s?r.aA(_,_,h):ln(_,_,h);const y=_[3];return _[0]/=y,_[1]/=y,_[2]/=y,_}function vi(u,t){return Math.min(.5+u/t*.5,1.5)}function Zi(u,t){const s=u[0]/u[3],h=u[1]/u[3];return s>=-t[0]&&s<=t[0]&&h>=-t[1]&&h<=t[1]}function Rr(u,t,s,h,_,y,b,C,I,O){const k=s.transform,U=h?u.textSizeData:u.iconSizeData,V=r.bH(U,s.transform.zoom),H=k.projection.name==="globe",Q=[256/s.width*2+1,256/s.height*2+1],X=h?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;X.clear();let J=null;H&&(J=h?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const ne=u.lineVertexArray,oe=h?u.text.placedSymbolArray:u.icon.placedSymbolArray,ve=s.transform.width/s.transform.height;let Se,Le=!1;for(let Ie=0;Ie<oe.length;Ie++){const Ce=oe.get(Ie),{numGlyphs:Ae,writingMode:Pe}=Ce;if(Pe!==r.bI.vertical||Le||Se===r.bI.horizontal||(Le=!0),Se=Pe,(Ce.hidden||Pe===r.bI.vertical)&&!Le){ea(Ae,X);continue}Le=!1;const Ne=new r.P(Ce.tileAnchorX,Ce.tileAnchorY);let{x:Ke,y:Je,z:mt}=k.projection.projectTilePoint(Ne.x,Ne.y,O.canonical);if(I){const[gi,di,hi]=I(Ne);Ke+=gi,Je+=di,mt+=hi}const xt=[Ke,Je,mt,1];if(r.aA(xt,xt,t),!Zi(xt,Q)){ea(Ae,X);continue}const Pt=xt[3],Ze=vi(s.transform.getCameraToCenterDistance(k.projection),Pt),lt=r.bJ(U,V,Ce),Ge=b?lt/Ze:lt*Ze,bt=Tt(Ke,Je,mt,_);if(bt[3]<=0){ea(Ae,X);continue}let st={};const Ct=r.al(u.layers[0].layout.get("text-max-angle")),Wt=Math.cos(Ct),wt=b?null:I,Vt=fs(Ce,Ge,!1,C,t,_,y,u.glyphOffsetArray,ne,X,J,bt,Ne,st,ve,wt,k.projection,O,b,Wt);Le=Vt.useVertical,wt&&Vt.needsFlipping&&(st={}),(Vt.notEnoughRoom||Le||Vt.needsFlipping&&fs(Ce,Ge,!0,C,t,_,y,u.glyphOffsetArray,ne,X,J,bt,Ne,st,ve,wt,k.projection,O,b,Wt).notEnoughRoom)&&ea(Ae,X)}h?(u.text.dynamicLayoutVertexBuffer.updateData(X),J&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(J)):(u.icon.dynamicLayoutVertexBuffer.updateData(X),J&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(J))}function Bn(u,t,s,h,_,y,b,C,I,O,k,U,V,H,Q,X,J){const{lineStartIndex:ne,glyphStartIndex:oe,segment:ve}=C,Se=oe+C.numGlyphs,Le=ne+C.lineLength,Ie=t.getoffsetX(oe),Ce=t.getoffsetX(Se-1),Ae=Ls(u*Ie,s,h,_,y,b,ve,ne,Le,I,O,k,U,V,!0,H,Q,X,J);if(!Ae)return null;const Pe=Ls(u*Ce,s,h,_,y,b,ve,ne,Le,I,O,k,U,V,!0,H,Q,X,J);return Pe?{first:Ae,last:Pe}:null}function es(u,t,s,h){return u===r.bI.horizontal&&Math.abs(h)>Math.abs(s)?{useVertical:!0}:u===r.bI.vertical?h>0?{needsFlipping:!0}:null:t!==Ha.unknown&&function(_,y){return _===0||Math.abs(y/_)>Js}(s,h)?t===Ha.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function fs(u,t,s,h,_,y,b,C,I,O,k,U,V,H,Q,X,J,ne,oe,ve){const Se=t/24,Le=u.lineOffsetX*Se,Ie=u.lineOffsetY*Se,{lineStartIndex:Ce,glyphStartIndex:Ae,numGlyphs:Pe,segment:Ne,writingMode:Ke,flipState:Je}=u,mt=Ce+u.lineLength,xt=Pt=>{if(k){const[bt,st,Ct]=Pt.up,Wt=O.length;r.bK(k,Wt+0,bt,st,Ct),r.bK(k,Wt+1,bt,st,Ct),r.bK(k,Wt+2,bt,st,Ct),r.bK(k,Wt+3,bt,st,Ct)}const[Ze,lt,Ge]=Pt.point;r.bL(O,Ze,lt,Ge,Pt.angle)};if(Pe>1){const Pt=Bn(Se,C,Le,Ie,s,U,V,u,I,y,H,X,!1,J,ne,oe,ve);if(!Pt)return{notEnoughRoom:!0};if(h&&!s){let[Ze,lt,Ge]=Pt.first.point,[bt,st,Ct]=Pt.last.point;[Ze,lt]=Tt(Ze,lt,Ge,b),[bt,st]=Tt(bt,st,Ct,b);const Wt=es(Ke,Je,(bt-Ze)*Q,st-lt);if(u.flipState=Wt&&Wt.needsFlipping?Ha.flipRequired:Ha.flipNotRequired,Wt)return Wt}xt(Pt.first);for(let Ze=Ae+1;Ze<Ae+Pe-1;Ze++){const lt=Ls(Se*C.getoffsetX(Ze),Le,Ie,s,U,V,Ne,Ce,mt,I,y,H,X,!1,!1,J,ne,oe,ve);if(!lt)return O.length-=4*(Ze-Ae),{notEnoughRoom:!0};xt(lt)}xt(Pt.last)}else{if(h&&!s){const Ze=Tt(V.x,V.y,0,_),lt=Ce+Ne+1,Ge=new r.P(I.getx(lt),I.gety(lt)),bt=Tt(Ge.x,Ge.y,0,_),st=bt[3]>0?bt:as(V,Ge,Ze,1,_,void 0,J,ne.canonical),Ct=es(Ke,Je,(st[0]-Ze[0])*Q,st[1]-Ze[1]);if(u.flipState=Ct&&Ct.needsFlipping?Ha.flipRequired:Ha.flipNotRequired,Ct)return Ct}const Pt=Ls(Se*C.getoffsetX(Ae),Le,Ie,s,U,V,Ne,Ce,mt,I,y,H,X,!1,!1,J,ne,oe,ve);if(!Pt)return{notEnoughRoom:!0};xt(Pt)}return{}}function Br(u,t,s,h,_){const{x:y,y:b,z:C}=h.projectTilePoint(u.x,u.y,t);if(!_)return Tt(y,b,C,s);const[I,O,k]=_(u);return Tt(y+I,b+O,C+k,s)}function as(u,t,s,h,_,y,b,C){const I=Br(u.sub(t)._unit()._add(u),C,_,b,y);return r.at(I,s,I),r.au(I,I),r.bE(I,s,I,h)}function Ls(u,t,s,h,_,y,b,C,I,O,k,U,V,H,Q,X,J,ne,oe){const ve=h?u-t:u+t;let Se=ve>0?1:-1,Le=0;h&&(Se*=-1,Le=Math.PI),Se<0&&(Le+=Math.PI);let Ie=C+b+(Se>0?0:1)|0,Ce=_,Ae=_,Pe=0,Ne=0;const Ke=Math.abs(ve),Je=[],mt=[];let xt=y,Pt=xt,Ze=r.bC([]);const lt=()=>as(Pt,xt,Ae,Ke-Pe+1,k,V,X,J.canonical);for(;Pe+Ne<=Ke;){if(Ie+=Se,Ie<C||Ie>=I)return null;if(Ae=Ce,Pt=xt,Je.push(Ae),H&&mt.push(Pt),xt=new r.P(O.getx(Ie),O.gety(Ie)),Ce=U[Ie],!Ce){const hi=Br(xt,J.canonical,k,X,V);Ce=hi[3]>0?U[Ie]=hi:lt()}Pe+=Ne;const gi=r.at([],Ce,Ae),di=r.bD(Ae,Ce);if(s&&di>0&&Ne>0&&r.bG(Ze,gi)/(Ne*di)<oe)return null;Ne=di,Ze=gi}Q&&V&&(U[Ie]&&(Ce=lt(),Ne=r.bD(Ae,Ce),Ze=r.at([],Ce,Ae)),U[Ie]=Ce);const Ge=(Ke-Pe)/Ne,bt=xt.sub(Pt)._mult(Ge)._add(Pt),st=r.bE([],Ae,Ze,Ge);let Ct=[0,0,1],Wt=Ze[0],wt=Ze[1];if(ne&&(Ct=X.upVector(J.canonical,bt.x,bt.y),Ct[0]!==0||Ct[1]!==0||Ct[2]!==1)){const gi=[Ct[2],0,-Ct[0]],di=r.bF([],Ct,gi);r.au(gi,gi),r.au(di,di),Wt=r.bG(Ze,gi),wt=r.bG(Ze,di)}if(s){const gi=r.bF([],Ct,Ze);r.au(gi,gi),r.bE(st,st,gi,s*Se)}const Vt=Le+Math.atan2(wt,Wt);return Je.push(st),H&&mt.push(bt),{point:st,angle:Vt,path:Je,tilePath:mt,up:Ct}}function ea(u,t){const s=t.length,h=s+4*u;t.resize(h),t.float32.fill(-1/0,4*s,4*h)}function ln(u,t,s){const h=t[0],_=t[1];return u[0]=s[0]*h+s[4]*_+s[12],u[1]=s[1]*h+s[5]*_+s[13],u[3]=s[3]*h+s[7]*_+s[15],u}const ws=100;class go{constructor(t,s,h=new so(t.width+200,t.height+200,25),_=new so(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=_,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ws,this.screenBottomBoundary=t.height+ws,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,h,_,y,b,C,I){let O=h.projectedAnchorX,k=h.projectedAnchorY,U=h.projectedAnchorZ;const V=h.elevation,H=h.tileID,Q=t.getProjection();if(V&&H){const[Ie,Ce,Ae]=Q.upVector(H.canonical,h.tileAnchorX,h.tileAnchorY),Pe=Q.upVectorScale(H.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=Ie*V*Pe,k+=Ce*V*Pe,U+=Ae*V*Pe}const X=this.projectAndGetPerspectiveRatio(C,O,k,U,h.tileID,Q.name==="globe"||!!V||this.transform.pitch>0,Q),J=b*X.perspectiveRatio,ne=(h.x1*s+_.x-h.padding)*J+X.point.x,oe=(h.y1*s+_.y-h.padding)*J+X.point.y,ve=(h.x2*s+_.x+h.padding)*J+X.point.x,Se=(h.y2*s+_.y+h.padding)*J+X.point.y,Le=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(ne,oe,ve,Se)||!y&&this.grid.hitTest(ne,oe,ve,Se,I)||Le?{box:[],offscreen:!1,occluded:X.occluded}:{box:[ne,oe,ve,Se],offscreen:this.isOffscreen(ne,oe,ve,Se),occluded:!1}}placeCollisionCircles(t,s,h,_,y,b,C,I,O,k,U,V,H,Q,X){const J=[],ne=this.transform.elevation,oe=t.getProjection(),ve=ne?ne.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,oe):null,Se=new r.P(h.tileAnchorX,h.tileAnchorY);let{x:Le,y:Ie,z:Ce}=oe.projectTilePoint(Se.x,Se.y,X.canonical);if(ve){const[Ct,Wt,wt]=ve(Se);Le+=Ct,Ie+=Wt,Ce+=wt}const Ae=oe.name==="globe",Pe=this.projectAndGetPerspectiveRatio(C,Le,Ie,Ce,X,Ae||!!ne||this.transform.pitch>0,oe),{perspectiveRatio:Ne}=Pe,Ke=(U?b/Ne:b*Ne)/r.bO,Je=Tt(Le,Ie,Ce,I),mt=h.lineOffsetX*Ke,xt=h.lineOffsetY*Ke,Pt=r.al(t.layers[0].layout.get("text-max-angle")),Ze=Math.cos(Pt),lt=Pe.signedDistanceFromCamera>0?Bn(Ke,y,mt,xt,!1,Je,Se,h,_,I,{},ne&&!U?ve:null,U&&!!ne,oe,X,U,Ze):null;let Ge=!1,bt=!1,st=!0;if(lt&&!Pe.occluded){const Ct=.5*H*Ne+Q,Wt=new r.P(-100,-100),wt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Vt=new jo,{first:gi,last:di}=lt,hi=gi.path.length;let Ai=[];for(let Ci=hi-1;Ci>=1;Ci--)Ai.push(gi.path[Ci]);for(let Ci=1;Ci<di.path.length;Ci++)Ai.push(di.path[Ci]);const Pi=2.5*Ct;O&&(Ai=Ai.map(([Ci,Ri,$i],rn)=>(ve&&!Ae&&($i=ve(rn<hi-1?gi.tilePath[hi-1-rn]:di.tilePath[rn-hi+2])[2]),Tt(Ci,Ri,$i,O))),Ai.some(Ci=>Ci[3]<=0)&&(Ai=[]));let fi=[];if(Ai.length>0){let Ci=1/0,Ri=-1/0,$i=1/0,rn=-1/0;for(const _n of Ai)Ci=Math.min(Ci,_n[0]),$i=Math.min($i,_n[1]),Ri=Math.max(Ri,_n[0]),rn=Math.max(rn,_n[1]);Ri>=Wt.x&&Ci<=wt.x&&rn>=Wt.y&&$i<=wt.y&&(fi=[Ai.map(_n=>new r.P(_n[0],_n[1]))],(Ci<Wt.x||Ri>wt.x||$i<Wt.y||rn>wt.y)&&(fi=r.bM(fi,Wt.x,Wt.y,wt.x,wt.y)))}for(const Ci of fi){Vt.reset(Ci,.25*Ct);let Ri=0;Ri=Vt.length<=.5*Ct?1:Math.ceil(Vt.paddedLength/Pi)+1;for(let $i=0;$i<Ri;$i++){const rn=$i/Math.max(Ri-1,1),_n=Vt.lerp(rn),Ln=_n.x+ws,Ar=_n.y+ws;J.push(Ln,Ar,Ct,0);const Ki=Ln-Ct,Wi=Ar-Ct,Ui=Ln+Ct,Zn=Ar+Ct;if(st=st&&this.isOffscreen(Ki,Wi,Ui,Zn),bt=bt||this.isInsideGrid(Ki,Wi,Ui,Zn),!s&&this.grid.hitTestCircle(Ln,Ar,Ct,V)&&(Ge=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Ge,occluded:!1}}}}return{circles:!k&&Ge||!bt?[]:J,offscreen:st,collisionDetected:Ge,occluded:Pe.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,_=1/0,y=-1/0,b=-1/0;for(const k of t){const U=new r.P(k.x+ws,k.y+ws);h=Math.min(h,U.x),_=Math.min(_,U.y),y=Math.max(y,U.x),b=Math.max(b,U.y),s.push(U)}const C=this.grid.query(h,_,y,b).concat(this.ignoredGrid.query(h,_,y,b)),I={},O={};for(const k of C){const U=k.key;if(I[U.bucketInstanceId]===void 0&&(I[U.bucketInstanceId]={}),I[U.bucketInstanceId][U.featureIndex])continue;const V=[new r.P(k.x1,k.y1),new r.P(k.x2,k.y1),new r.P(k.x2,k.y2),new r.P(k.x1,k.y2)];r.bN(s,V)&&(I[U.bucketInstanceId][U.featureIndex]=!0,O[U.bucketInstanceId]===void 0&&(O[U.bucketInstanceId]=[]),O[U.bucketInstanceId].push(U.featureIndex))}return O}insertCollisionBox(t,s,h,_,y){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:_,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,h,_,y){const b=s?this.ignoredGrid:this.grid,C={bucketInstanceId:h,featureIndex:_,collisionGroupID:y};for(let I=0;I<t.length;I+=4)b.insertCircle(C,t[I],t[I+1],t[I+2])}projectAndGetPerspectiveRatio(t,s,h,_,y,b,C){const I=[s,h,_,1];let O=!1;_||this.transform.pitch>0?(r.aA(I,I,t),this.fogState&&y&&C.name!=="globe"&&(O=function(V,H,Q,X,J,ne){const oe=ne.calculateFogTileMatrix(J),ve=[H,Q,X];return r.ad(ve,ve,oe),Xt(V,r.ae(ve),ne.pitch,ne._fov)}(this.fogState,s,h,_,y.toUnwrapped(),this.transform)>.9)):ln(I,I,t);const k=I[3];return{point:new r.P((I[0]/k+1)/2*this.transform.width+ws,(-I[1]/k+1)/2*this.transform.height+ws),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/k*.5,1.5),signedDistanceFromCamera:k,occluded:b&&I[2]>k||O}}isOffscreen(t,s,h,_){return h<ws||t>=this.screenRightBoundary||_<ws||s>this.screenBottomBoundary}isInsideGrid(t,s,h,_){return h>=0&&t<this.gridRightBoundary&&_>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=r.bx([]);return r.bo(t,t,[-100,-100,0]),t}}function Uo(u,t,s){const h=t.createTileMatrix(u,u.worldSize,s.toUnwrapped());return r.az(new Float32Array(16),u.projMatrix,h)}function zi(u,t,s){if(t.projection.name===s.projection.name)return u.projMatrix;const h=s.clone();return h.setProjection(t.projection),Uo(h,t.getProjection(),u)}function Go(u,t,s){return t.name===s.projection.name?u.projMatrix:Uo(s,t,u)}class Fc{constructor(t,s,h,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):_&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Ho{constructor(t,s,h,_,y,b=!1){this.text=new Fc(t?t.text:null,s,h,y),this.icon=new Fc(t?t.icon:null,s,_,y),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class la{constructor(t,s,h,_=!1){this.text=t,this.icon=s,this.skipFade=h,this.clipped=_}}class nd{constructor(){this.invProjMatrix=r.bz(),this.viewportMatrix=r.bz(),this.circles=[]}}class nh{constructor(t,s,h,_,y){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=_,this.tileID=y}}class Di{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[t]}}function Yn(u,t,s,h,_){const{horizontalAlign:y,verticalAlign:b}=r.bT(u),C=-(y-.5)*t,I=-(b-.5)*s,O=r.bU(u,h);return new r.P(C+O[0]*_,I+O[1]*_)}function Un(u,t,s,h,_){const y=new r.P(u,t);return s&&y._rotate(h?_:-_),y}class _o{constructor(t,s,h,_,y,b){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new go(this.transform,y),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Di(h),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,h,_,y=1){const b=h.getBucket(s),C=h.latestFeatureIndex;if(!b||!C||s.fqid!==b.layerIds[0])return;const I=b.layers[0].layout,O=b.layers[0].paint,k=h.collisionBoxArray,U=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),V=h.tileSize/r.aj,H=h.tileID.toUnwrapped();this.transform.setProjection(b.projection);const Q=(X=h.tileID,J=b.getProjection(),ne=this.transform,J.name===this.projection?ne.calculateProjMatrix(X.toUnwrapped()):Uo(ne,J,X));var X,J,ne;const oe=I.get("text-pitch-alignment")==="map",ve=I.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const Se=s.dynamicFilter(),Le=s.dynamicFilterNeedsFeature(),Ie=this.transform.calculatePixelsToTileUnitsMatrix(h),Ce=Vo(Q,h.tileID.canonical,oe,ve,this.transform,b.getProjection(),Ie);let Ae=null;if(oe){const lt=qe(Q,h.tileID.canonical,oe,ve,this.transform,b.getProjection(),Ie);Ae=r.az([],this.transform.labelPlaneMatrix,lt)}let Pe=null;Se&&h.latestFeatureIndex&&(Pe={unwrappedTileID:H,dynamicFilter:Se,dynamicFilterNeedsFeature:Le}),this.retainedQueryData[b.bucketInstanceId]=new nh(b.bucketInstanceId,C,b.sourceLayerIndex,b.index,h.tileID);const[Ne,Ke]=b.layers[0].layout.get("text-size-scale-range"),Je=r.ay(y,Ne,Ke),[mt,xt]=I.get("icon-size-scale-range"),Pt=r.ay(y,mt,xt),Ze={bucket:b,layout:I,paint:O,posMatrix:Q,textLabelPlaneMatrix:Ce,labelToScreenMatrix:Ae,clippingData:Pe,scale:U,textPixelRatio:V,holdingForFade:h.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:r.bH(b.textSizeData,this.transform.zoom,Je),partiallyEvaluatedIconSize:r.bH(b.iconSizeData,this.transform.zoom,Pt),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:h.latestFeatureIndex};if(_)for(const lt of b.sortKeyRanges){const{sortKey:Ge,symbolInstanceStart:bt,symbolInstanceEnd:st}=lt;t.push({sortKey:Ge,symbolInstanceStart:bt,symbolInstanceEnd:st,parameters:Ze})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ze})}attemptAnchorPlacement(t,s,h,_,y,b,C,I,O,k,U,V,H,Q,X,J,ne,oe){const{textOffset0:ve,textOffset1:Se,crossTileID:Le}=V,Ie=[ve,Se],Ce=Yn(t,h,_,Ie,y),Ae=this.collisionIndex.placeCollisionBox(Q,y,s,Un(Ce.x,Ce.y,b,C,this.transform.angle),U,I,O,k.predicate);if(J){const Pe=Q.getSymbolInstanceIconSize(oe,this.transform.zoom,V.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Q,Pe,J,Un(Ce.x,Ce.y,b,C,this.transform.angle),U,I,O,k.predicate).box.length===0)return}if(Ae.box.length>0){let Pe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Le]&&this.prevPlacement.placements[Le]&&this.prevPlacement.placements[Le].text&&(Pe=this.prevPlacement.variableOffsets[Le].anchor),this.variableOffsets[Le]={textOffset:Ie,width:h,height:_,anchor:t,textScale:y,prevAnchor:Pe},this.markUsedJustification(Q,t,V,X),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,X,V),this.placedOrientations[Le]=X),{shift:Ce,placedGlyphBoxes:Ae}}}placeLayerBucketPart(t,s,h,_,y=1){const{bucket:b,layout:C,paint:I,posMatrix:O,textLabelPlaneMatrix:k,labelToScreenMatrix:U,clippingData:V,textPixelRatio:H,holdingForFade:Q,collisionBoxArray:X,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:ne,collisionGroup:oe,latestFeatureIndex:ve}=t.parameters,Se=C.get("text-optional"),Le=C.get("icon-optional"),Ie=C.get("text-allow-overlap"),Ce=C.get("icon-allow-overlap"),Ae=C.get("text-rotation-alignment")==="map",Pe=C.get("text-pitch-alignment")==="map",Ne=I.get("symbol-z-offset"),Ke=C.get("symbol-elevation-reference")==="sea",[Je,mt]=C.get("text-size-scale-range"),[xt,Pt]=C.get("icon-size-scale-range"),Ze=r.ay(y,Je,mt),lt=r.ay(y,xt,Pt);this.transform.setProjection(b.projection);let Ge=Ie&&(Ce||!b.hasIconData()||Le),bt=Ce&&(Ie||!b.hasTextData()||Se);const st=!Ne.isConstant();!b.collisionArrays&&X&&b.deserializeCollisionBoxes(X),h&&_&&b.updateCollisionDebugBuffers(this.transform.zoom,X,Ze,lt);const Ct=(wt,Vt,gi)=>{const{crossTileID:di,numVerticalGlyphVertices:hi}=wt;let Ai=null;if(V&&V.dynamicFilterNeedsFeature||st){const nr=this.retainedQueryData[b.bucketInstanceId];Ai=ve.loadFeature({featureIndex:wt.featureIndex,bucketIndex:nr.bucketIndex,sourceLayerIndex:nr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(V&&!(0,V.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Ai,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new r.P(wt.tileAnchorX,wt.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[di]=new la(!1,!1,!1,!0),void s.add(di);const Pi=Ne.evaluate(Ai,{});if(s.has(di))return;if(Q)return void(this.placements[di]=new la(!1,!1,!1));let fi=!1,Ci=!1,Ri=!0,$i=!1,rn=!1,_n=null,Ln={box:null,offscreen:null,occluded:null},Ar={box:null},Ki=null,Wi=null,Ui=null,Zn=0,Hr=0,sr=0;gi.textFeatureIndex?Zn=gi.textFeatureIndex:wt.useRuntimeCollisionCircles&&(Zn=wt.featureIndex),gi.verticalTextFeatureIndex&&(Hr=gi.verticalTextFeatureIndex);const gn=nr=>{nr.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const or=this.transform.elevation;nr.elevation=Ke?Pi:Pi+(or?or.getAtTileOffset(nr.tileID,nr.tileAnchorX,nr.tileAnchorY):0),nr.elevation+=wt.zOffset},_r=gi.textBox;if(_r){gn(_r);const nr=Nn=>{let pr=r.bI.horizontal;if(b.allowVerticalPlacement&&!Nn&&this.prevPlacement){const Cr=this.prevPlacement.placedOrientations[di];Cr&&(this.placedOrientations[di]=Cr,pr=Cr,this.markUsedOrientation(b,pr,wt))}return pr},or=(Nn,pr)=>{if(b.allowVerticalPlacement&&hi>0&&gi.verticalTextBox){for(const Cr of b.writingModes)if(Cr===r.bI.vertical?(Ln=pr(),Ar=Ln):Ln=Nn(),Ln&&Ln.box&&Ln.box.length)break}else Ln=Nn()};if(C.get("text-variable-anchor")){let Nn=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[di]){const Qn=this.prevPlacement.variableOffsets[di];Nn.indexOf(Qn.anchor)>0&&(Nn=Nn.filter(An=>An!==Qn.anchor),Nn.unshift(Qn.anchor))}const pr=(Qn,An,na)=>{const Ia=b.getSymbolInstanceTextSize(J,wt,this.transform.zoom,Vt),uo=(Qn.x2-Qn.x1)*Ia+2*Qn.padding,rl=(Qn.y2-Qn.y1)*Ia+2*Qn.padding,Za=wt.hasIconTextFit&&!Ce?An:null;Za&&gn(Za);let Ra={box:[],offscreen:!1,occluded:!1};const qs=Ie?2*Nn.length:Nn.length;for(let sl=0;sl<qs;++sl){const $s=this.attemptAnchorPlacement(Nn[sl%Nn.length],Qn,uo,rl,Ia,Ae,Pe,H,O,oe,sl>=Nn.length,wt,Vt,b,na,Za,J,ne);if($s&&(Ra=$s.placedGlyphBoxes,Ra&&Ra.box&&Ra.box.length)){fi=!0,_n=$s.shift;break}}return Ra};or(()=>pr(_r,gi.iconBox,r.bI.horizontal),()=>{const Qn=gi.verticalTextBox;return Qn&&gn(Qn),b.allowVerticalPlacement&&!(Ln&&Ln.box&&Ln.box.length)&&hi>0&&Qn?pr(Qn,gi.verticalIconBox,r.bI.vertical):{box:null,offscreen:null,occluded:null}}),Ln&&(fi=Ln.box,Ri=Ln.offscreen,$i=Ln.occluded);const Cr=nr(!(!Ln||!Ln.box));if(!fi&&this.prevPlacement){const Qn=this.prevPlacement.variableOffsets[di];Qn&&(this.variableOffsets[di]=Qn,this.markUsedJustification(b,Qn.anchor,wt,Cr))}}else{const Nn=(pr,Cr)=>{const Qn=b.getSymbolInstanceTextSize(J,wt,this.transform.zoom,Vt,y),An=this.collisionIndex.placeCollisionBox(b,Qn,pr,new r.P(0,0),Ie,H,O,oe.predicate);return An&&An.box&&An.box.length&&(this.markUsedOrientation(b,Cr,wt),this.placedOrientations[di]=Cr),An};or(()=>Nn(_r,r.bI.horizontal),()=>{const pr=gi.verticalTextBox;return b.allowVerticalPlacement&&hi>0&&pr?(gn(pr),Nn(pr,r.bI.vertical)):{box:null,offscreen:null,occluded:null}}),nr(!!(Ln&&Ln.box&&Ln.box.length))}}if(Ki=Ln,fi=Ki&&Ki.box&&Ki.box.length>0,Ri=Ki&&Ki.offscreen,$i=Ki&&Ki.occluded,wt.useRuntimeCollisionCircles){const nr=b.text.placedSymbolArray.get(wt.centerJustifiedTextSymbolIndex>=0?wt.centerJustifiedTextSymbolIndex:wt.verticalPlacedTextSymbolIndex),or=r.bJ(b.textSizeData,J,nr),Nn=C.get("text-padding");Wi=this.collisionIndex.placeCollisionCircles(b,Ie,nr,b.lineVertexArray,b.glyphOffsetArray,or,O,k,U,h,Pe,oe.predicate,wt.collisionCircleDiameter*or/r.bO,Nn,this.retainedQueryData[b.bucketInstanceId].tileID),fi=Ie||Wi.circles.length>0&&!Wi.collisionDetected,Ri=Ri&&Wi.offscreen,$i=Wi.occluded}if(gi.iconFeatureIndex&&(sr=gi.iconFeatureIndex),gi.iconBox){const nr=or=>{gn(or);const Nn=wt.hasIconTextFit&&_n?Un(_n.x,_n.y,Ae,Pe,this.transform.angle):new r.P(0,0),pr=b.getSymbolInstanceIconSize(ne,this.transform.zoom,wt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,pr,or,Nn,Ce,H,O,oe.predicate)};Ar&&Ar.box&&Ar.box.length&&gi.verticalIconBox?(Ui=nr(gi.verticalIconBox),Ci=Ui.box.length>0):(Ui=nr(gi.iconBox),Ci=Ui.box.length>0),Ri=Ri&&Ui.offscreen,rn=Ui.occluded}const yn=Se||wt.numHorizontalGlyphVertices===0&&hi===0,ar=Le||wt.numIconVertices===0;if(yn||ar?ar?yn||(Ci=Ci&&fi):fi=Ci&&fi:Ci=fi=Ci&&fi,fi&&Ki&&Ki.box&&this.collisionIndex.insertCollisionBox(Ki.box,C.get("text-ignore-placement"),b.bucketInstanceId,Ar&&Ar.box&&Hr?Hr:Zn,oe.ID),Ci&&Ui&&this.collisionIndex.insertCollisionBox(Ui.box,C.get("icon-ignore-placement"),b.bucketInstanceId,sr,oe.ID),Wi&&(fi&&this.collisionIndex.insertCollisionCircles(Wi.circles,C.get("text-ignore-placement"),b.bucketInstanceId,Zn,oe.ID),h)){const nr=b.bucketInstanceId;let or=this.collisionCircleArrays[nr];or===void 0&&(or=this.collisionCircleArrays[nr]=new nd);for(let Nn=0;Nn<Wi.circles.length;Nn+=4)or.circles.push(Wi.circles[Nn+0]),or.circles.push(Wi.circles[Nn+1]),or.circles.push(Wi.circles[Nn+2]),or.circles.push(Wi.collisionDetected?1:0)}const ur=b.projection.name!=="globe";Ge=Ge&&(ur||!$i),bt=bt&&(ur||!rn),this.placements[di]=new la(fi||Ge,Ci||bt,Ri||b.justReloaded),s.add(di)},Wt=this.retainedQueryData[b.bucketInstanceId].tileID;if(b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,Wt),b.elevationType==="road"&&b.updateRoadElevation(Wt.canonical),b.updateZOffset(),b.sortFeaturesByY){const wt=b.getSortedSymbolIndexes(this.transform.angle);for(let Vt=wt.length-1;Vt>=0;--Vt){const gi=wt[Vt];Ct(b.symbolInstances.get(gi),gi,b.collisionArrays[gi])}b.hasAnyZOffset&&r.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){const wt=b.getSortedIndexesByZOffset();for(let Vt=0;Vt<wt.length;++Vt){const gi=wt[Vt];Ct(b.symbolInstances.get(gi),gi,b.collisionArrays[gi])}}else for(let wt=t.symbolInstanceStart;wt<t.symbolInstanceEnd;wt++)Ct(b.symbolInstances.get(wt),wt,b.collisionArrays[wt]);if(h&&b.bucketInstanceId in this.collisionCircleArrays){const wt=this.collisionCircleArrays[b.bucketInstanceId];r.bi(wt.invProjMatrix,O),wt.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(t,s,h,_){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:I,crossTileID:O}=h,k=r.bV(s),U=_===r.bI.vertical?I:k==="left"?y:k==="center"?b:k==="right"?C:-1;y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=U>=0&&y!==U?0:O),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=U>=0&&b!==U?0:O),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:O),I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=U>=0&&I!==U?0:O)}markUsedOrientation(t,s,h){const _=s===r.bI.horizontal||s===r.bI.horizontalOnly?s:0,y=s===r.bI.vertical?s:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:O}=h,k=t.text.placedSymbolArray;b>=0&&(k.get(b).placedOrientation=_),C>=0&&(k.get(C).placedOrientation=_),I>=0&&(k.get(I).placedOrientation=_),O>=0&&(k.get(O).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const _=s?s.symbolFadeChange(t):1,y=s?s.opacities:{},b=s?s.variableOffsets:{},C=s?s.placedOrientations:{};for(const I in this.placements){const O=this.placements[I],k=y[I];k?(this.opacities[I]=new Ho(k,_,O.text,O.icon,null,O.clipped),h=h||O.text!==k.text.placed||O.icon!==k.icon.placed):(this.opacities[I]=new Ho(null,_,O.text,O.icon,O.skipFade,O.clipped),h=h||O.text||O.icon)}for(const I in y){const O=y[I];if(!this.opacities[I]){const k=new Ho(O,_,!1,!1);k.isHidden()||(this.opacities[I]=k,h=h||O.text.placed||O.icon.placed)}}for(const I in b)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=b[I]);for(const I in C)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=C[I]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s,h,_){const y=new Set;for(const b of s){const C=b.getBucket(t);C&&b.latestFeatureIndex&&t.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,y,b,b.collisionBoxArray,h,_,b.tileID,t.scope),C.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(C,b.tileID),C.elevationType==="road"&&C.updateRoadElevation(b.tileID.canonical),C.updateZOffset())}}updateBucketOpacities(t,s,h,_,y,b,C,I){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const O=t.layers[0].layout,k=t.layers[0].paint,U=!!t.layers[0].dynamicFilter(),V=new Ho(null,0,!1,!1,!0),H=O.get("text-allow-overlap"),Q=O.get("icon-allow-overlap"),X=O.get("text-variable-anchor"),J=O.get("text-rotation-alignment")==="map",ne=O.get("text-pitch-alignment")==="map",oe=k.get("symbol-z-offset"),ve=O.get("symbol-elevation-reference")==="sea",Se=!oe.isConstant(),Le=new Ho(null,0,H&&(Q||!t.hasIconData()||O.get("icon-optional")),Q&&(H||!t.hasTextData()||O.get("text-optional")),!0);!t.collisionArrays&&_&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(_);const Ie=(Ae,Pe,Ne)=>{for(let Ke=0;Ke<Pe/4;Ke++)Ae.opacityVertexArray.emplaceBack(Ne)};let Ce=0;b&&t.updateReplacement(C,b);for(let Ae=0;Ae<t.symbolInstances.length;Ae++){const Pe=t.symbolInstances.get(Ae),{numHorizontalGlyphVertices:Ne,numVerticalGlyphVertices:Ke,crossTileID:Je,numIconVertices:mt,tileAnchorX:xt,tileAnchorY:Pt}=Pe;let Ze=null;const lt=this.retainedQueryData[t.bucketInstanceId];Se&&Pe&&lt&&(Ze=h.latestFeatureIndex.loadFeature({featureIndex:Pe.featureIndex,bucketIndex:lt.bucketIndex,sourceLayerIndex:lt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ge=oe.evaluate(Ze,{}),bt=s.has(Je);let st=this.opacities[Je];bt?st=V:st||(st=Le,this.opacities[Je]=st),s.add(Je);const Ct=Ne>0||Ke>0,Wt=mt>0,wt=this.placedOrientations[Je],Vt=wt===r.bI.vertical,gi=wt===r.bI.horizontal||wt===r.bI.horizontalOnly;!Ct&&!Wt||st.isHidden()||Ce++;let di=!1;if((Ct||Wt)&&b)for(const hi of t.activeReplacements){if(r.bP(hi,y,r.bQ.Symbol,I)||hi.min.x>xt||xt>hi.max.x||hi.min.y>Pt||Pt>hi.max.y)continue;const Ai=r.bR(xt,Pt,C.canonical,hi.footprintTileId.canonical);if(di=r.bS(Ai,hi.footprint),di)break}if(Ct){const hi=di?qo:Bc(st.text);Ie(t.text,Ne,Vt?qo:hi),Ie(t.text,Ke,gi?qo:hi);const Ai=st.text.isHidden(),{leftJustifiedTextSymbolIndex:Pi,centerJustifiedTextSymbolIndex:fi,rightJustifiedTextSymbolIndex:Ci,verticalPlacedTextSymbolIndex:Ri}=Pe,$i=t.text.placedSymbolArray,rn=Ai||Vt?1:0;Pi>=0&&($i.get(Pi).hidden=rn),fi>=0&&($i.get(fi).hidden=rn),Ci>=0&&($i.get(Ci).hidden=rn),Ri>=0&&($i.get(Ri).hidden=Ai||gi?1:0);const _n=this.variableOffsets[Je];_n&&this.markUsedJustification(t,_n.anchor,Pe,wt);const Ln=this.placedOrientations[Je];Ln&&(this.markUsedJustification(t,"left",Pe,Ln),this.markUsedOrientation(t,Ln,Pe))}if(Wt){const hi=di?qo:Bc(st.icon),{placedIconSymbolIndex:Ai,verticalPlacedIconSymbolIndex:Pi}=Pe,fi=t.icon.placedSymbolArray,Ci=st.icon.isHidden()?1:0;Ai>=0&&(Ie(t.icon,mt,Vt?qo:hi),fi.get(Ai).hidden=Ci),Pi>=0&&(Ie(t.icon,Pe.numVerticalIconVertices,gi?qo:hi),fi.get(Pi).hidden=Ci)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const hi=t.collisionArrays[Ae];if(hi){let Ai=new r.P(0,0),Pi=!0;if(hi.textBox||hi.verticalTextBox){if(X){const Ci=this.variableOffsets[Je];Ci?(Ai=Yn(Ci.anchor,Ci.width,Ci.height,Ci.textOffset,Ci.textScale),J&&Ai._rotate(ne?this.transform.angle:-this.transform.angle)):Pi=!1}U&&(Pi=!st.clipped),hi.textBox&&dc(t.textCollisionBox.collisionVertexArray,st.text.placed,!Pi||Vt,Ge,ve,Ai.x,Ai.y),hi.verticalTextBox&&dc(t.textCollisionBox.collisionVertexArray,st.text.placed,!Pi||gi,Ge,ve,Ai.x,Ai.y)}const fi=Pi&&!!(!gi&&hi.verticalIconBox);hi.iconBox&&dc(t.iconCollisionBox.collisionVertexArray,st.icon.placed,fi,Ge,ve,Pe.hasIconTextFit?Ai.x:0,Pe.hasIconTextFit?Ai.y:0),hi.verticalIconBox&&dc(t.iconCollisionBox.collisionVertexArray,st.icon.placed,!fi,Ge,ve,Pe.hasIconTextFit?Ai.x:0,Pe.hasIconTextFit?Ai.y:0)}}}if(t.fullyClipped=Ce===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Ae.invProjMatrix,t.placementViewportMatrix=Ae.viewportMatrix,t.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function dc(u,t,s,h,_,y,b){u.emplaceBack(t?1:0,s?1:0,y||0,b||0,h,_?1:0),u.emplaceBack(t?1:0,s?1:0,y||0,b||0,h,_?1:0),u.emplaceBack(t?1:0,s?1:0,y||0,b||0,h,_?1:0),u.emplaceBack(t?1:0,s?1:0,y||0,b||0,h,_?1:0)}const $n=Math.pow(2,25),df=Math.pow(2,24),rd=Math.pow(2,17),sd=Math.pow(2,16),qa=Math.pow(2,9),Ts=Math.pow(2,8),Bg=Math.pow(2,1);function Bc(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,s=Math.floor(127*u.opacity);return s*$n+t*df+s*rd+t*sd+s*qa+t*Ts+s*Bg+t}const qo=0;class ad{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,s,h,_,y,b){const C=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(C,_,t[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((I,O)=>I.sortKey-O.sortKey));this._currentPartIndex<C.length;){const I=C[this._currentPartIndex];if(s.placeLayerBucketPart(I,this._seenCrossTileIDs,h,I.symbolInstanceStart===0,b),this._currentPartIndex++,y())return!0}return!1}}class od{constructor(t,s,h,_,y,b,C,I,O){this.placement=new _o(t,y,b,C,I,O),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,s,h,_,y){const b=r.q.now(),C=()=>{const I=r.q.now()-b;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=s[t[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=O)&&(!I.maxzoom||I.maxzoom>O)){const k=I,U=k.layout.get("symbol-z-elevate"),V=k.layout.get("symbol-sort-key").constantOr(1)!==void 0,H=k.layout.get("symbol-z-order"),Q=H==="viewport-y"||H==="auto"&&!(H!=="viewport-y"&&V),X=k.layout.get("text-allow-overlap")||k.layout.get("icon-allow-overlap")||k.layout.get("text-ignore-placement")||k.layout.get("icon-ignore-placement"),J=Q&&X,ne=this._inProgressLayer=this._inProgressLayer||new ad(k),oe=r.C(I.source,I.scope);if(ne.continuePlacement(U||J?_[oe]:h[oe],this.placement,this._showCollisionBoxes,I,C,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const rh=512/r.aj/2;class ld{constructor(t,s,h){this.tileID=t,this.bucketInstanceId=h,this.index=new r.bW(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=t.canonical.x*r.aj,y=t.canonical.y*r.aj;for(let b=0;b<s.length;b++){const{key:C,crossTileID:I,tileAnchorX:O,tileAnchorY:k}=s.get(b),U=Math.floor((_+O)*rh),V=Math.floor((y+k)*rh);this.index.add(U,V),this.keys.push(C),this.crossTileIDs.push(I)}this.index.finish()}findMatches(t,s,h){const _=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),y=rh/Math.pow(2,s.canonical.z-this.tileID.canonical.z),b=s.canonical.x*r.aj,C=s.canonical.y*r.aj;for(let I=0;I<t.length;I++){const O=t.get(I);if(O.crossTileID)continue;const{key:k,tileAnchorX:U,tileAnchorY:V}=O,H=Math.floor((b+U)*y),Q=Math.floor((C+V)*y),X=this.index.range(H-_,Q-_,H+_,Q+_).sort((J,ne)=>J-ne);for(const J of X){const ne=this.crossTileIDs[J];if(this.keys[J]===k&&!h.has(ne)){h.add(ne),O.crossTileID=ne;break}}}}}class Ea{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ll{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const h in this.indexes){const _=this.indexes[h],y={};for(const b in _){const C=_[b];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+s),y[C.tileID.key]=C}this.indexes[h]=y}this.lng=t}addBucket(t,s,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<s.symbolInstances.length;y++)s.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const _=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>t.overscaledZ)for(const C in b){const I=b[C];I.tileID.isChildOf(t)&&I.findMatches(s.symbolInstances,t,_)}else{const C=b[t.scaledTo(Number(y)).key];C&&C.findMatches(s.symbolInstances,t,_)}}for(let y=0;y<s.symbolInstances.length;y++){const b=s.symbolInstances.get(y);b.crossTileID||(b.crossTileID=h.generate(),_.add(b.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ld(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const h of s.crossTileIDs)this.usedCrossTileIDs[t].delete(h)}removeStaleBuckets(t){let s=!1;for(const h in this.indexes){const _=this.indexes[h];for(const y in _)t[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,_[y]),delete _[y],s=!0)}return s}}class Hs{constructor(){this.layerIndexes={},this.crossTileIDs=new Ea,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,h,_){let y=this.layerIndexes[t.fqid];y===void 0&&(y=this.layerIndexes[t.fqid]=new Ll);let b=!1;const C={};_.name!=="globe"&&y.handleWrapJump(h);for(const I of s){const O=I.getBucket(t);O&&t.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(I.tileID,O,this.crossTileIDs)&&(b=!0),C[O.bucketInstanceId]=!0)}return y.removeStaleBuckets(C)&&(b=!0),b}pruneUnusedLayers(t){const s={};t.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const yu=771;class cn{constructor(t,s,h,_){this.blendFunction=t,this.blendColor=s.toNonPremultipliedRenderColor(null),this.mask=h,this.blendEquation=_}}cn.Replace=[1,0,1,0],cn.disabled=new cn(cn.Replace,r.am.transparent,[!1,!1,!1,!1]),cn.unblended=new cn(cn.Replace,r.am.transparent,[!0,!0,!0,!0]),cn.alphaBlended=new cn([1,yu,1,yu],r.am.transparent,[!0,!0,!0,!0]),cn.alphaBlendedNonPremultiplied=new cn([770,yu,770,yu],r.am.transparent,[!0,!0,!0,!0]),cn.multiply=new cn([774,0,774,0],r.am.transparent,[!0,!0,!0,!0]);class yi{constructor(t,s,h){this.func=t,this.mask=s,this.range=h}}yi.ReadOnly=!1,yi.ReadWrite=!0,yi.disabled=new yi(519,yi.ReadOnly,[0,1]);const Mo=7680;class qi{constructor(t,s,h,_,y,b){this.test=t,this.ref=s,this.mask=h,this.fail=_,this.depthFail=y,this.pass=b}}qi.disabled=new qi({func:519,mask:0},0,0,Mo,Mo,Mo);const Wr=1029,fc=2305;class Fi{constructor(t,s,h){this.enable=t,this.mode=s,this.frontFace=h}}function pc(u,t){const s=r.c1(u,3);r.c3(u,t),r.c7(u,3,s)}function vu(u,t){const s=r.b_([]);return r.b$(s,s,-t),r.c0(s,s,-u),s}function mc(u,t){const s=[u[0],u[1],0],h=[t[0],t[1],0];if(r.ae(s)>=1e-15){const b=r.au([],s);r.bY(h,b,r.bG(h,b)),t[0]=h[0],t[1]=h[1]}const _=r.bF([],t,u);if(r.bZ(_)<1e-15)return null;const y=Math.atan2(-_[1],_[0]);return vu(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),y)}Fi.disabled=new Fi(!1,Wr,fc),Fi.backCCW=new Fi(!0,Wr,fc),Fi.backCW=new Fi(!0,Wr,2304),Fi.frontCW=new Fi(!0,1028,2304),Fi.frontCCW=new Fi(!0,1028,fc);class ff{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof r.ac?t:new r.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=r.bX(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const h=this.position,_=this._elevation?this._elevation.getAtPointOrZero(r.ac.fromLngLat(t)):0,y=r.ac.fromLngLat(t,_),b=[y.x-h.x,y.y-h.y,y.z-h.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=mc(b,s)}setPitchBearing(t,s){this.orientation=vu(r.al(t),r.al(-s))}}class yo{constructor(t,s){this._transform=r.bx([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new r.ac(t[0],t[1],t[2])}get position(){const t=r.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&r.c7(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.b_([]),t&&pc(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=vu(t,s),pc(this._transform,this._orientation)}forward(){const t=r.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const h=new Float64Array(16);return r.bi(h,this.getWorldToCamera(t,s)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,s,h){const _=this.position;r.bY(_,_,-t);const y=new Float64Array(16);return r.bn(y,[h,h,h]),r.bo(y,y,_),y[10]*=s,y}getWorldToCamera(t,s){const h=new Float64Array(16),_=new Float64Array(4),y=this.position;return r.c2(_,this._orientation),r.bY(y,y,-t),r.c3(h,_),r.bo(h,h,y),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(t,s,h,_){const y=new Float64Array(16);return r.c4(y,t,s,h,_),y}getCameraToClipOrthographic(t,s,h,_,y,b){const C=new Float64Array(16);return r.c5(C,t,s,h,_,y,b),C}getDistanceToElevation(t,s=!1){const h=t===0?0:r.c6(t,s?r.aY(this.position[1]):this.position[1]),_=this.forward();return(h-this.position[2])/_[2]}clone(){return new yo([...this.position],[...this.orientation])}}const Aa={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class sh{constructor(t=0,s=0,h=0,_=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=h,this.right=_}interpolate(t,s,h){return s.top!=null&&t.top!=null&&(this.top=r.ai(t.top,s.top,h)),s.bottom!=null&&t.bottom!=null&&(this.bottom=r.ai(t.bottom,s.bottom,h)),s.left!=null&&t.left!=null&&(this.left=r.ai(t.left,s.left,h)),s.right!=null&&t.right!=null&&(this.right=r.ai(t.right,s.right,h)),this}getCenter(t,s){const h=r.ay((this.left+t-this.right)/2,0,t),_=r.ay((this.top+s-this.bottom)/2,0,s);return new r.P(h,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new sh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Vs=15;class _p{constructor(t,s,h,_,y,b,C){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=h??0,this._maxPitch=_??60,this.setProjection(b),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new r.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new sh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new yo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new _p(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Vs}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,s=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(t||h)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return r.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=r.ce(this.projectionOptions);const h=this.getProjection(),_=!r.bv(s,h);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.ce({name:"mercator"});const s=t!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=r.cf(),r.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=r.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let _=0,y=0;for(let b=0;b<s.length;b++){const C=new r.P(s[b][0]*this.width,h+s[b][1]*(this.height-h)),I=t.pointCoordinate(C);if(!I)continue;const O=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);_+=I[3]*O,y+=O}return y===0?NaN:_/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,_=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),b=Math.max(_-h,y);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let h;h=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const _=r.ae(r.at([],this._camera.position,h));return r.ay(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!r.ch(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const h=[t.position.x,t.position.y,t.position.z];r.ci(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new ff;return s.position=new r.ac(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!r.cj(t))return!1;r.ck(t,t);const s=r.cl([],[0,0,-1],t),h=r.cl([],[0,-1,0],t);if(h[2]<0)return!1;const _=mc(s,h);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;t[2]=r.ay(t[2],_/h,_/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,h){this._unmodified=!1,this._edgeInsets.interpolate(t,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new r.cm(0,t)];if(this.renderWorldCopies){const h=this.pointCoordinate(new r.P(0,0)),_=this.pointCoordinate(new r.P(this.width,0)),y=this.pointCoordinate(new r.P(this.width,this.height)),b=this.pointCoordinate(new r.P(0,this.height)),C=Math.floor(Math.min(h.x,_.x,y.x,b.x)),I=Math.floor(Math.max(h.x,_.x,y.x,b.x)),O=1;for(let k=C-O;k<=I+O;k++)k!==0&&s.push(new r.cm(k,t))}return s}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,s,h){let _=[];const y=h!=null,b=!y;if(b&&this.zoom<s||y&&h[0]===0&&h[1]===0)return _;const C=new Set,I=(k,U,V,H,Q)=>{const X=r.cK(U,k,V,H,Q);C.has(X)||(_.push(new r.aM(k,U,V,H,Q)),C.add(X))};for(let k=0;k<t.length;k++){const U=t[k];if(b&&U.canonical.z!==s)continue;const V=U.canonical,H=U.overscaledZ,Q=U.wrap,X=1<<V.z,J=V.x+1<X,ne=V.x>0,oe=V.y+1<X,ve=V.y>0,Se=U.wrap-(ne?0:1),Le=U.wrap+(J?0:1),Ie=ne?V.x-1:X-1,Ce=J?V.x+1:0;if(y)h[0]<0?(I(H,Le,V.z,Ce,V.y),h[1]<0&&oe&&(I(H,Q,V.z,V.x,V.y+1),I(H,Le,V.z,Ce,V.y+1)),h[1]>0&&ve&&(I(H,Q,V.z,V.x,V.y-1),I(H,Le,V.z,Ce,V.y-1))):h[0]>0?(I(H,Se,V.z,Ie,V.y),h[1]<0&&oe&&(I(H,Q,V.z,V.x,V.y+1),I(H,Se,V.z,Ie,V.y+1)),h[1]>0&&ve&&(I(H,Q,V.z,V.x,V.y-1),I(H,Se,V.z,Ie,V.y-1))):h[1]<0&&oe?I(H,Q,V.z,V.x,V.y+1):ve&&I(H,Q,V.z,V.x,V.y-1);else{const Ae=U.visibleQuadrants;1&Ae&&(I(H,Se,V.z,Ie,V.y),ve&&(I(H,Q,V.z,V.x,V.y-1),I(H,Se,V.z,Ie,V.y-1))),2&Ae&&(I(H,Le,V.z,Ce,V.y),ve&&(I(H,Q,V.z,V.x,V.y-1),I(H,Le,V.z,Ce,V.y-1))),4&Ae&&(I(H,Se,V.z,Ie,V.y),oe&&(I(H,Q,V.z,V.x,V.y+1),I(H,Se,V.z,Ie,V.y+1))),8&Ae&&(I(H,Le,V.z,Ce,V.y),oe&&(I(H,Q,V.z,V.x,V.y+1),I(H,Le,V.z,Ce,V.y+1)))}}const O=[];for(const k of _)_.some(U=>k.isChildOf(U))||O.push(k);if(_=O.filter(k=>!t.some(U=>!!(k.overscaledZ<s&&U.isChildOf(k))||k.equals(U)||k.isChildOf(U))),b){const k=1<<s,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=[k*U.x,k*U.y],H=4,Q=H*H;_=_.filter(X=>{const J=X.canonical.x+.5-V[0],ne=X.canonical.y+.5-V[1];return J*J+ne*ne<Q})}return _}coveringTiles(t){let s=this.coveringZoomLevel(t);const h=s,_=this.elevation&&this.elevation.exaggeration(),y=_&&!t.isTerrainDEM,b=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const C=this.locationCoordinate(this.center),I=this.center.lat,O=1<<s,k=[O*C.x,O*C.y,0],U=this.projection.name==="globe",V=!U,H=r.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,V),Q=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=O*r.c6(1,this.center.lat),J=this._camera.position[2]/r.c6(1,this.center.lat),ne=[O*Q.x,O*Q.y,J*(V?1:X)],oe=U||_,ve=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),Se=this.isLODDisabled(!0)?s:0;let Le;if(this._elevation&&t.isTerrainDEM)Le=1e4*this._elevation.exaggeration();else if(this._elevation){const Ge=this._elevation.getMinMaxForVisibleTiles();Le=Ge?Ge.max:this._centerAltitude}else Le=this._centerAltitude;const Ie=t.isTerrainDEM?-Le:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ce=this.projection.isReprojectedInTileSpace?r.co(this):1,Ae=Ge=>{const st=new r.ac(Ge.x+25e-6,Ge.y,Ge.z),Ct=new r.ac(Ge.x,Ge.y+25e-6,Ge.z),Wt=Ge.toLngLat(),wt=st.toLngLat(),Vt=Ct.toLngLat(),gi=this.locationCoordinate(Wt),di=this.locationCoordinate(wt),hi=this.locationCoordinate(Vt),Ai=Math.hypot(di.x-gi.x,di.y-gi.y),Pi=Math.hypot(hi.x-gi.x,hi.y-gi.y);return Math.sqrt(Ai*Pi)*Ce/25e-6},Pe=Ge=>{const bt=Le,st=Ie;return{aabb:r.cr(this,O,0,0,0,Ge,st,bt,this.projection),zoom:0,x:0,y:0,minZ:st,maxZ:bt,wrap:Ge,fullyVisible:!1}},Ne=[];let Ke=[];const Je=s,mt=t.reparseOverscaled?h:s,xt=(J-this._centerAltitude)*X,Pt=Ge=>{if(!this._elevation||!Ge.tileID||!b)return;const bt=this._elevation.getMinMaxForTile(Ge.tileID),st=Ge.aabb;bt?(st.min[2]=bt.min,st.max[2]=bt.max,st.center[2]=(st.min[2]+st.max[2])/2):(Ge.shouldSplit=lt(Ge),Ge.shouldSplit||(st.min[2]=st.max[2]=st.center[2]=this._centerAltitude))},Ze=(Ge,bt)=>{if(.707*bt<Ge)return 1;const st=bt/Ge;return st/(1.4144271570014144+(Math.pow(1.1,st-1.4144271570014144+1)-1)/(1.1-1)-1)},lt=Ge=>{if(Ge.zoom<Se)return!0;if(Ge.zoom===Je)return!1;if(Ge.shouldSplit!=null)return Ge.shouldSplit;const bt=Ge.aabb.distanceX(ne),st=Ge.aabb.distanceY(ne);let Ct=xt,Wt=1;if(U){Ct=Ge.aabb.distanceZ(ne);const Pi=Math.pow(2,Ge.zoom),fi=r.aY((Ge.y+1)/Pi),Ci=r.aY(Ge.y/Pi),Ri=Math.min(Math.max(I,fi),Ci),$i=r.cO(Ri)/r.cO(I);if(Wt=Ri===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,$i/this._mercatorScaleRatio),this.zoom<=r.cL&&Ge.zoom===Je-1&&$i>=.9)return!0}else if(y&&(Ct=Ge.aabb.distanceZ(ne)*X),this.projection.isReprojectedInTileSpace&&h<=5){const Pi=Math.pow(2,Ge.zoom),fi=Ae(new r.ac((Ge.x+.5)/Pi,(Ge.y+.5)/Pi));Wt=fi>.85?1:fi}if(!b){const Pi=Math.sqrt(bt*bt+st*st+Ct*Ct);let fi=(1<<Je-Ge.zoom)*ve*Wt;return fi*=Ze(Math.max(Ct,xt),Pi),Pi<fi}let wt=Number.MAX_VALUE,Vt=0;const gi=Ge.aabb.getCorners(),di=[];for(const Pi of gi){r.at(di,Pi,ne),U||(y?di[2]*=X:di[2]=xt);const fi=r.bG(di,this._camera.forward());fi<wt&&(wt=fi,Vt=Math.abs(di[2]))}let hi=(1<<Je-Ge.zoom)*ve*Wt;if(hi*=Ze(Math.max(Vt,xt),wt),wt<hi)return!0;const Ai=Ge.aabb.closestPoint(k);return Ai[0]===k[0]&&Ai[1]===k[1]};if(this.renderWorldCopies)for(let Ge=1;Ge<=3;Ge++)Ne.push(Pe(-Ge)),Ne.push(Pe(Ge));for(Ne.push(Pe(0));Ne.length>0;){const Ge=Ne.pop(),bt=Ge.x,st=Ge.y;let Ct=Ge.fullyVisible;const Wt=()=>this.projection.name==="globe"&&(Ge.y===0||Ge.y===(1<<Ge.zoom)-1);if(!Ct){let wt=oe?Ge.aabb.intersects(H):Ge.aabb.intersectsFlat(H);if(wt===0&&Wt()){const Vt=new r.cp(Ge.zoom,bt,st);wt=r.cq(this,O,Vt,!0).intersects(H)}if(wt===0)continue;Ct=wt===2}if(Ge.zoom!==Je&&lt(Ge))for(let wt=0;wt<4;wt++){const Vt=(bt<<1)+wt%2,gi=(st<<1)+(wt>>1),di={aabb:b?Ge.aabb.quadrant(wt):r.cr(this,O,Ge.zoom+1,Vt,gi,Ge.wrap,Ge.minZ,Ge.maxZ,this.projection),zoom:Ge.zoom+1,x:Vt,y:gi,wrap:Ge.wrap,fullyVisible:Ct,tileID:void 0,shouldSplit:void 0,minZ:Ge.minZ,maxZ:Ge.maxZ};y&&!U&&(di.tileID=new r.aM(Ge.zoom+1===Je?mt:Ge.zoom+1,Ge.wrap,Ge.zoom+1,Vt,gi),Pt(di)),Ne.push(di)}else{const wt=Ge.zoom===Je?mt:Ge.zoom;if(t.minzoom&&t.minzoom>wt)continue;let Vt=0;if(!Ct){let Ai=oe?Ge.aabb.intersectsPrecise(H):Ge.aabb.intersectsPreciseFlat(H);if(Ai===0&&Wt()){const Pi=new r.cp(Ge.zoom,bt,st);Ai=r.cq(this,O,Pi,!0).intersectsPrecise(H)}if(Ai===0)continue;if(t.calculateQuadrantVisibility)if(H.containsPoint(Ge.aabb.center))Vt=15;else for(let Pi=0;Pi<4;Pi++)Ge.aabb.quadrant(Pi).intersects(H)!==0&&(Vt|=1<<Pi)}const gi=k[0]-(.5+bt+(Ge.wrap<<Ge.zoom))*(1<<s-Ge.zoom),di=k[1]-.5-st,hi=Ge.tileID?Ge.tileID:new r.aM(wt,Ge.wrap,Ge.zoom,bt,st);t.calculateQuadrantVisibility&&(hi.visibleQuadrants=Vt),Ke.push({tileID:hi,distanceSq:gi*gi+di*di})}}if(this.fogCullDistSq){const Ge=this.fogCullDistSq,bt=this.horizonLineFromTop();Ke=Ke.filter(st=>{const Ct=[0,0,0,1],Wt=[r.aj,r.aj,0,1],wt=this.calculateFogTileMatrix(st.tileID.toUnwrapped());r.aA(Ct,Ct,wt),r.aA(Wt,Wt,wt);const Vt=r.cs([],Ct,Wt),gi=r.ct([],Ct,Wt),di=r.cM(Vt,gi);if(di===0)return!0;let hi=!1;const Ai=this._elevation;if(Ai&&di>Ge&&bt!==0){const Pi=this.calculateProjMatrix(st.tileID.toUnwrapped());let fi;t.isTerrainDEM||(fi=Ai.getMinMaxForTile(st.tileID)),fi||(fi={min:Ie,max:Le});const Ci=r.cu(this.rotation),Ri=[Ci[0]*r.aj,Ci[1]*r.aj,fi.max];r.ad(Ri,Ri,Pi),hi=(1-Ri[1])*this.height*.5<bt}return di<Ge||hi})}return Ke.sort((Ge,bt)=>Ge.distanceSq-bt.distanceSq).map(Ge=>Ge.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=r.ay(t.lat,-85.051129,r.cv),h=this.projection.project(t.lng,s);return new r.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,s){let h,_;const y=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;h=(s.x-y.x)/C,_=(s.y-y.y)/C}else{const C=this.pointCoordinate(s),I=this.pointCoordinate(y);h=C.x-I.x,_=C.y-I.y}const b=this.locationCoordinate(t);this.setLocation(new r.ac(b.x-h,b.y-_))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,s){return this.projection.locationPoint(this,t,s)}locationPoint3D(t,s){return this.projection.locationPoint(this,t,s,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,s){return this.coordinateLocation(this.pointCoordinate3D(t,s))}locationCoordinate(t,s){const h=s?r.c6(s,t.lat):void 0,_=this.projection.project(t.lng,t.lat);return new r.ac(_.x,_.y,h)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const h=s??this._centerAltitude,_=[t.x,t.y,0,1],y=[t.x,t.y,1,1];r.aA(_,_,this.pixelMatrixInverse),r.aA(y,y,this.pixelMatrixInverse);const b=y[3];r.cw(_,_,1/_[3]),r.cw(y,y,1/b);const C=_[2],I=y[2];return{p0:_,p1:y,t:C===I?0:(h-C)/(I-C)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return r.aA(s,s,this.pixelMatrixInverse),r.aA(h,h,this.pixelMatrixInverse),r.cw(s,s,1/s[3]),r.cw(h,h,1/h[3]),s[2]=r.c6(s[2],this._center.lat)*this.worldSize,h[2]=r.c6(h[2],this._center.lat)*this.worldSize,r.cw(s,s,1/this.worldSize),r.cw(h,h,1/this.worldSize),new r.av([s[0],s[1],s[2]],r.au([],r.at([],h,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:h,t:_}=t,y=r.c6(s[2],this._center.lat),b=r.c6(h[2],this._center.lat);return new r.ac(r.ai(s[0],h[0],_)/this.worldSize,r.ai(s[1],h[1],_)/this.worldSize,r.ai(y,b,_))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t,s){if(!this.elevation)return this.pointCoordinate(t,s);let h=this.projection.pointCoordinate3D(this,t.x,t.y);if(h)return new r.ac(h[0],h[1],h[2]);let _=0,y=this.horizonLineFromTop();if(t.y>y)return this.pointCoordinate(t,s);const b=.02*y,C=t.clone();for(let I=0;I<10&&y-_>b;I++){C.y=r.ai(_,y,.66);const O=this.projection.pointCoordinate3D(this,C.x,C.y);O?(y=C.y,h=O):_=C.y}return h?new r.ac(h[0],h[1],h[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.cx)return!this.isPointAboveHorizon(t);const s=this.pointCoordinate(t);return s.y>=0&&s.y<=1}_coordinatePoint(t,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,_=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return r.aA(_,_,this.pixelMatrix),_[3]>0?new r.P(_[0]/_[3],_[1]/_[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:s}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,y=this.pointLocation3D(new r.P(s,t)),b=this.pointLocation3D(new r.P(_,t)),C=this.pointLocation3D(new r.P(_,h)),I=this.pointLocation3D(new r.P(s,h));let O=Math.min(y.lng,b.lng,C.lng,I.lng),k=Math.max(y.lng,b.lng,C.lng,I.lng),U=Math.min(y.lat,b.lat,C.lat,I.lat),V=Math.max(y.lat,b.lat,C.lat,I.lat);const H=Math.pow(2,-this.zoom)/16*270,Q=this.projection.name==="globe"?1:4,X=(J,ne,oe,ve,Se)=>{const Le=(J+oe)/2,Ie=(ne+ve)/2,Ce=new r.P(Le,Ie),{lng:Ae,lat:Pe}=this.pointLocation3D(Ce),Ne=Math.max(0,O-Ae,U-Pe,Ae-k,Pe-V);O=Math.min(O,Ae),k=Math.max(k,Ae),U=Math.min(U,Pe),V=Math.max(V,Pe),(Se<Q||Ne>H)&&(X(J,ne,Le,Ie,Se+1),X(Le,Ie,oe,ve,Se+1))};if(X(s,t,_,t,1),X(_,t,_,h,1),X(_,h,s,h,1),X(s,h,s,t,1),this.projection.name==="globe"){const[J,ne]=r.cy(this);J?(V=90,k=180,O=-180):ne&&(U=-90,k=180,O=-180)}return new r.aG(new r.cd(O,U),new r.cd(k,V))}_getBoundsRectangular(t,s){const{top:h,left:_}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,C=new r.P(_,h),I=new r.P(b,h),O=new r.P(b,y),k=new r.P(_,y);let U=this.pointCoordinate(C,t),V=this.pointCoordinate(I,t);const H=this.pointCoordinate(O,s),Q=this.pointCoordinate(k,s),X=(J,ne)=>(ne.y-J.y)/(ne.x-J.x);return U.y>1&&V.y>=0?U=new r.ac((1-Q.y)/X(Q,U)+Q.x,1):U.y<0&&V.y<=1&&(U=new r.ac(-Q.y/X(Q,U)+Q.x,0)),V.y>1&&U.y>=0?V=new r.ac((1-H.y)/X(H,V)+H.x,1):V.y<0&&U.y<=1&&(V=new r.ac(-H.y/X(H,V)+H.x,0)),new r.aG().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(H))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=t.visibleDemTiles.reduce((h,_)=>{if(_.dem){const y=_.dem.tree;h.min=Math.min(h.min,y.minimums[0]),h.max=Math.max(h.max,y.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-85.051129,this.maxLat=r.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aD(this.minLng)*this.tileSize,this.worldMaxX=r.aD(this.maxLng)*this.tileSize,this.worldMinY=r.aH(this.maxLat)*this.tileSize,this.worldMaxY=r.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,h=this._distanceTileDataCache;if(h[s])return h[s];const _=t.canonical,y=1/this.height,b=this.cameraWorldSize,C=b/this.zoomScale(_.z),I=(_.x+Math.pow(2,_.z)*t.wrap)*C,O=_.y*C,k=this.point;k.x*=b/this.worldSize,k.y*=b/this.worldSize;const U=this.angle,V=Math.sin(-U),H=-Math.cos(-U);return h[s]={bearing:[V,H],center:[(k.x-I)*y,(k.y-O)*y],scale:C/r.aj*y},h[s]}calculateFogTileMatrix(t){const s=t.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.az(_,this.worldToFogMatrix,_),h[s]=new Float32Array(_),h[s]}calculateProjMatrix(t,s=!1,h=!1){const _=t.key;let y;if(y=h?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,y[_])return y[_];const b=this.calculatePosMatrix(t,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,r.az(b,C,b),y[_]=new Float32Array(b),y[_]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const _=r.cz(t,this);return h[s]=_,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,s=r.bn([],[t,t,t]);return r.az(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const s=r.c6(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),_=this._camera.forward(),y=r.c6(1,this._center.lat);h[2]/=y,_[2]/=y,r.au(_,_);const b=t.raycast(h,_,t.exaggeration());if(b){const C=r.bE([],h,_,b),I=new r.ac(C[0],C[1],r.c6(C[2],r.aY(C[1]))),O=(I.z+r.ae([I.x-h[0],I.y-h[1],I.z-h[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const s=this._elevation,h=r.c6(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),y=s.getAtPointOrZero(new r.ac(..._)),b=this.pixelsPerMeter/this.worldSize*y,C=this._minimumHeightOverTerrain(),I=_[2]-b;if(I<=C)if(I<0||t){const O=this.locationCoordinate(this._center,this._centerAltitude),k=[_[0],_[1],O.z-_[2]],U=r.ae(k);k[2]-=(C-I)/this._pixelsPerMercatorPixel;const V=r.ae(k);if(V===0)return;r.bY(k,k,U/V*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],O.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const V=this.center;return V.lat=r.ay(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(V.lng=r.ay(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const s=this._unmodified,{x:h,y:_}=this.point;let y=0,b=h,C=_;const I=this.width/2,O=this.height/2,k=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(_-O<k&&(C=k+O),_+O>U&&(C=U-O),U-k<this.height&&(y=Math.max(y,this.height/(U-k)),C=(U+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,Q=this.worldSize/2-(V+H)/2;b=(h+Q+this.worldSize)%this.worldSize-Q,b-I<V&&(b=V+I),b+I>H&&(b=H-I),H-V<this.width&&(y=Math.max(y,this.width/(H-V)),b=(H+V)/2)}b===h&&C===_||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(b,C))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.c6(1,this.center.lat)/r.c6(1,r.cP));const _=r.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?h:1,b=this._camera.getWorldToCamera(this.worldSize,y);let C;const I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(I[8]=2*-t.x/this.width,I[9]=2*t.y/this.height,this.isOrthographic){let Pe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ne=Pe*this.aspect,Ke=-Ne,Je=-Pe;Ne-=t.x,Ke-=t.x,Pe+=t.y,Je+=t.y,C=this._camera.getCameraToClipOrthographic(Ke,Ne,Je,Pe,this._nearZ,this._farZ),((mt,xt,Pt,Ze)=>{for(let lt=0;lt<16;lt++)mt[lt]=r.ai(xt[lt],Pt[lt],Ze)})(C,C,I,r.cN(this.pitch>=Vs?1:this.pitch/Vs))}else C=I;const O=r.cB([],I,b);let k=r.cB([],C,b);if(this.projection.isReprojectedInTileSpace){const Pe=this.locationCoordinate(this.center),Ne=r.bx([]);r.bo(Ne,Ne,[Pe.x*this.worldSize,Pe.y*this.worldSize,0]),r.az(Ne,Ne,r.cC(this)),r.bo(Ne,Ne,[-Pe.x*this.worldSize,-Pe.y*this.worldSize,0]),r.az(k,k,Ne),r.az(O,O,Ne),this.inverseAdjustmentMatrix=r.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cE([],k,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=k,this.invProjMatrix=r.bi(new Float64Array(16),this.projMatrix),s){const Pe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Pe[8]=2*-t.x/this.width,Pe[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.cB([],Pe,b)}else this.expandedFarZProjMatrix=this.projMatrix;const U=r.bi([],C);this.frustumCorners=r.cF.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const V=new Float32Array(16);r.bx(V),r.cE(V,V,[1,-1,1]),r.cG(V,V,this._pitch),r.by(V,V,this.angle);const H=r.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.bw(H);const Q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-t.x/this.width,H[9]=2*(t.y+Q)/this.height,this.skyboxMatrix=r.az(V,H,V);const X=this.point,J=X.x,ne=X.y,oe=this.width%2/2,ve=this.height%2/2,Se=Math.cos(this.angle),Le=Math.sin(this.angle),Ie=J-Math.round(J)+Se*oe+Le*ve,Ce=ne-Math.round(ne)+Se*ve+Le*oe,Ae=new Float64Array(k);if(r.bo(Ae,Ae,[Ie>.5?Ie-1:Ie,Ce>.5?Ce-1:Ce,0]),this.alignedProjMatrix=Ae,k=r.bz(),r.cE(k,k,[this.width/2,-this.height/2,1]),r.bo(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=r.bz(),r.cE(k,k,[1,-1,1]),r.bo(k,k,[-1,-1,0]),r.cE(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=r.az(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},k=r.bi(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cH(this);const Pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ad(Pe,Pe,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,h=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,y=[t,t,s];r.bY(y,y,_),r.bY(h,h,-1),r.cI(h,h,y);const b=r.bz();r.bo(b,b,h),r.cE(b,b,y),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,_)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-h[0]*y,_.y/this.worldSize-h[1]*y,t/this.worldSize*this._centerAltitude-h[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],_=t[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(y=Math.min((s-h)/_,1)),this._camera.position=r.bE([],this._camera.position,t,y),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:_}=this._camera.getPitchBearing(),y=r.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.al(this._maxPitch)),C=Math.max((t[2]-y)/Math.cos(h),b),I=this._zoomFromMercatorZ(C);r.bE(t,t,s,C),this._pitch=r.ay(h,r.al(this.minPitch),r.al(this.maxPitch)),this.angle=r.bX(_,-Math.PI,Math.PI),this._setZoom(r.ay(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let s=0,h=r.cx,_=0,y=1/0;for(;h-s>1e-6&&h>s;){const b=s+.5*(h-s),C=this.tileSize*Math.pow(2,b),I=this.getCameraToCenterDistance(this.projection,b,C),O=this.scaleZoom(I/(Math.max(0,t)*this.tileSize)),k=Math.abs(b-O);k<y&&(y=k,_=b),b<O?s=b:h=b}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){const h=Math.min(t.x,s.x),_=Math.max(t.x,s.x),y=Math.min(t.y,s.y),b=Math.max(t.y,s.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new r.P(h,y),new r.P(_,b),new r.P(h,b),new r.P(_,y)],I=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const k of C){const U=this.pointRayIntersection(k);if(U.t<0)return!0;const V=this.rayIntersectionCoordinate(U);if(V.x<I||V.y<0||V.x>O||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,s){const h=r.ae(r.at([],this._camera.position,t)),_=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([s,h,_],y){const b=[s,h,_,1];r.aA(b,b,y);const C=b[3]=Math.max(b[3],1e-6);return b[0]/=C,b[1]/=C,b[2]/=C,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,s=this.zoom,h=this.worldSize){const _=r.cA(t,s,this.width,this.height,1024),y=t.pixelSpaceConversion(this.center.lat,h,_);let b=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(b=r.ai(1,b,r.cN(this.pitch>=Vs?1:this.pitch/Vs))),b}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.az(t,t,this.globeMatrix),t}getFrustum(t){return r.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const zl=(u,t)=>{if(t>0&&u.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=u.transform,h=Math.max(Math.abs(s._zoom-(u.minCutoffZoom-1)),1),_=s.isLODDisabled(!1)?r.af(60,45,s.pitch):r.af(30,15,s.pitch),y=s._farZ-s._nearZ,b=t*s.height,C=((1-(I=_))*s.cameraToCenterDistance+I*(s._farZ+b))*h;var I;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(C-s._nearZ)/y,(C-b-s._nearZ)/y]}}},Ca={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class cd{constructor(t,s){this.aabb=t,this.lastCascade=s}}class jg{add(t,s){const h=this.receivers[t.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],s.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],s.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],s.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],s.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],s.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],s.max[2])):this.receivers[t.key]=new cd(s,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,s,h){const _=r.cW.fromPoints(t.points);let y=0;for(const b in this.receivers){const C=this.receivers[b];if(!C||!_.intersectsAabb(C.aabb))continue;C.aabb.min=_.closestPoint(C.aabb.min),C.aabb.max=_.closestPoint(C.aabb.max);const I=C.aabb.getCorners();for(let O=0;O<h.length;O++){let k=!0;for(const U of I){const V=[U[0]*s,U[1]*s,U[2]];if(r.ad(V,V,h[O].matrix),V[0]<-1||V[0]>1||V[1]<-1||V[1]>1){k=!1;break}}if(C.lastCascade=O,y=Math.max(y,O),k)break}}return y+1}}class Io{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new jg,this._depthMode=new yi(t.context.gl.LEQUAL,yi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Ca,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Ca,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Ca,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,s){const h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const _=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||_<=0||(this._shadowLayerCount=h.style.order.reduce((Q,X)=>{const J=h.style._mergedLayers[X];return Q+(J.hasShadowPass()&&!J.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const y=h.context,b=Ca.shadowMapResolution,C=Ca.shadowMapResolution;if(this._cascades.length===0||Ca.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Q=0;Q<Ca.cascadeCount;++Q){const X=h._shadowMapDebug,J=y.gl,ne=y.createFramebuffer(b,C,X,"texture"),oe=new r.T(y,{width:b,height:C,data:null},J.DEPTH_COMPONENT16);if(ne.depthAttachment.set(oe.texture),X){const ve=new r.T(y,{width:b,height:C,data:null},J.RGBA8);ne.colorAttachment.set(ve.texture)}this._cascades.push({framebuffer:ne,texture:oe,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cn,scale:0})}}this.shadowDirection=xu(s);let I=0;if(t.elevation){const Q=t.elevation,X=[1e4,-1e4];Q.visibleDemTiles.filter(J=>J.dem).forEach(J=>{const ne=J.dem.tree;X[0]=Math.min(X[0],ne.minimums[0]),X[1]=Math.max(X[1],ne.maximums[0])}),X[0]!==1e4&&(I=(X[1]-X[0])*Q.exaggeration())}const O=1.5*t.cameraToCenterDistance,k=3*O,U=new Float64Array(16);for(let Q=0;Q<this._cascades.length;++Q){const X=this._cascades[Q];let J=t.height/50,ne=1;Ca.cascadeCount===1?ne=k:Q===0?ne=O:(J=O,ne=k);const[oe,ve]=bu(t,this.shadowDirection,J,ne,Ca.shadowMapResolution,I);X.scale=t.scale,X.matrix=oe,X.boundingSphereRadius=ve,r.bi(U,X.matrix),X.frustum=r.cn.fromInvProjectionMatrix(U,1,0,!0),X.far=ne}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ca.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ca.shadowMapResolution,this._uniformValues.u_shadowmap_0=Aa.ShadowMap0,this._uniformValues.u_shadowmap_1=Aa.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const H=h.transform.elevation;for(const Q of this._groundShadowTiles){let X={min:0,max:0};if(H){const J=H.getMinMaxForTile(Q);J&&(X=J)}this.addShadowReceiver(Q.toUnwrapped(),X.min,X.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,s){if(!this.enabled)return;const h=this.painter,_=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),_.viewport.set([0,0,Ca.shadowMapResolution,Ca.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){h.currentShadowCascade=y,_.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),_.clear({color:r.am.white,depth:1});for(const b of t.order){const C=t._mergedLayers[b];if(!C.hasShadowPass()||C.isHidden(h.transform.zoom))continue;const I=t.getLayerSourceCache(C),O=I?s[I.id]:void 0;(C.type==="model"||O&&O.length)&&h.renderLayer(h,I,C,O)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,s=t.style,h=t.context,_=h.gl,y=s.directionalLight,b=s.ambientLight;if(!y||!b)return;const C=[],I=zl(t,t.longestCutoffRange);I.shouldRenderCutoff&&C.push("RENDER_CUTOFF"),C.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&C.push("NORMAL_OFFSET");const O=jc(s,y,b),k=new yi(_.LEQUAL,yi.ReadOnly,t.depthRangeFor3D),U=new qi({func:_.EQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.KEEP);for(const V of this._groundShadowTiles){const H=V.toUnwrapped(),Q=t.isTileAffectedByFog(V),X=t.getOrCreateProgram("groundShadow",{defines:C,overrideFog:Q});this.setupShadows(H,X),t.uploadCommonUniforms(h,X,H,null,I);const J={u_matrix:t.transform.calculateProjMatrix(H),u_ground_shadow_factor:O};X.draw(t,_.TRIANGLES,k,U,cn.multiply,Fi.disabled,J,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?cn.unblended:cn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const s=this.painter.transform,h=s.calculatePosMatrix(t,s.worldSize);return r.az(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(t){return r.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,s,h,_=0){if(!this.enabled)return;const y=this.painter.transform,b=this.painter.context,C=b.gl,I=this._uniformValues,O=new Float64Array(16),k=y.calculatePosMatrix(t,y.worldSize);for(let U=0;U<this._cascades.length;U++)r.az(O,this._cascades[U].matrix,k),I[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),b.activeTexture.set(C.TEXTURE0+Aa.ShadowMap0+U),this._cascades[U].texture.bindExtraParam(C.LINEAR,C.LINEAR,C.CLAMP_TO_EDGE,C.CLAMP_TO_EDGE,C.GREATER);if(this.useNormalOffset=!!h,this.useNormalOffset){const U=r.cU(t.canonical),V=2/y.tileSize*r.aj/Ca.shadowMapResolution,H=V*this._cascades[0].boundingSphereRadius,Q=V*this._cascades[this._cascades.length-1].boundingSphereRadius,X=(h==="vector-tile"?1:3)/Math.pow(2,_-t.canonical.z-(1-y.zoom+Math.floor(y.zoom)));I.u_shadow_normal_offset=[U,H*X,Q*X],I.u_shadow_bias=[6e-5,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(b,I)}setupShadowsFromMatrix(t,s,h=!1){if(!this.enabled)return;const _=this.painter.context,y=_.gl,b=this._uniformValues,C=new Float64Array(16);for(let I=0;I<Ca.cascadeCount;I++)r.az(C,this._cascades[I].matrix,t),b[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),_.activeTexture.set(y.TEXTURE0+Aa.ShadowMap0+I),this._cascades[I].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);if(this.useNormalOffset=h,h){const I=Ca.normalOffset;b.u_shadow_normal_offset=[1,I,I],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(_,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,s,h,_){if(_[2]>=0)return{};const y=function(I,O,k){const U=k/(1<<I.canonical.z);return new r.cW([I.canonical.x*U+I.wrap*k,I.canonical.y*U+I.wrap*k,0],[(I.canonical.x+1)*U+I.wrap*k,(I.canonical.y+1)*U+I.wrap*k,O])}(t,s,h).getCorners(),b=s/-_[2];_[0]<0?(r.cV(y[0],y[0],[_[0]*b,0,0]),r.cV(y[3],y[3],[_[0]*b,0,0])):_[0]>0&&(r.cV(y[1],y[1],[_[0]*b,0,0]),r.cV(y[2],y[2],[_[0]*b,0,0])),_[1]<0?(r.cV(y[0],y[0],[0,_[1]*b,0]),r.cV(y[1],y[1],[0,_[1]*b,0])):_[1]>0&&(r.cV(y[2],y[2],[0,_[1]*b,0]),r.cV(y[3],y[3],[0,_[1]*b,0]));const C={};return C.vertices=y,C.planes=[$o(y[1],y[0],y[4]),$o(y[2],y[1],y[5]),$o(y[3],y[2],y[6]),$o(y[0],y[3],y[7])],C}addShadowReceiver(t,s,h){this._receivers.add(t,r.cW.fromTileIdAndHeight(t,s,h))}getMaxCascadeForTile(t){const s=this._receivers.get(t);return s&&s.lastCascade?s.lastCascade:0}}function $o(u,t,s){const h=r.at([],s,t),_=r.at([],u,t),y=r.bF([],h,_),b=r.ae(y);return b===0?[0,0,1,0]:(r.bY(y,y,1/b),[y[0],y[1],y[2],-r.bG(y,t)])}function xu(u){const t=u.properties.get("direction"),s=r.cR(t.x,t.y,t.z);s[2]=r.ay(s[2],0,75);const h=r.cT([s[0],s[1],s[2]]);return r.cS(h.x,h.y,h.z)}function jc(u,t,s){const h=t.properties.get("color-use-theme")==="none",_=t.properties.get("color"),y=t.properties.get("intensity"),b=t.properties.get("direction"),C=[b.x,b.y,b.z],I=s.properties.get("color-use-theme")==="none",O=s.properties.get("color"),k=s.properties.get("intensity"),U=Math.max(r.bG([0,0,1],C),0),V=[0,0,0];r.bY(V,O.toPremultipliedRenderColor(I?null:u.getLut(t.scope)).toArray01Linear().slice(0,3),k);const H=[0,0,0];return r.bY(H,_.toPremultipliedRenderColor(h?null:u.getLut(s.scope)).toArray01Linear().slice(0,3),U*y),r.cY([V[0]>0?V[0]/(V[0]+H[0]):0,V[1]>0?V[1]/(V[1]+H[1]):0,V[2]>0?V[2]/(V[2]+H[2]):0])}function bu(u,t,s,h,_,y){const b=u.zoom,C=u.scale,I=u.worldSize,O=1/I,k=u.aspect,U=Math.sqrt(1+k*k)*Math.tan(.5*u.fovX),V=U*U,H=h-s,Q=h+s;let X,J;V>H/Q?(X=h,J=h*U):(X=.5*Q*(1+V),J=.5*Math.sqrt(H*H+2*(h*h+s*s)*V+Q*Q*V*V));const ne=u.projection.pixelsPerMeter(u.center.lat,I),oe=u._camera.getCameraToWorldMercator(),ve=[0,0,-X*O];r.ad(ve,ve,oe);let Se=J*O;const Le=u._edgeInsets;if(!(Le.left===0&&Le.top===0&&Le.right===0&&Le.bottom===0||Le.left===Le.right&&Le.top===Le.bottom)){const Ct=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?ne:1),Wt=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,s,h);Wt[8]=2*-u.centerOffset.x/u.width,Wt[9]=2*u.centerOffset.y/u.height;const wt=new Float64Array(16);r.cB(wt,Wt,Ct);const Vt=new Float64Array(16);r.bi(Vt,wt);const gi=r.cn.fromInvProjectionMatrix(Vt,I,b,!0);for(const di of gi.points){const hi=((Ie=di)[0]/=C,Ie[1]/=C,Ie[2]=r.c6(Ie[2],u._center.lat),Ie);Se=Math.max(Se,r.bZ(r.cX([],ve,hi)))}}var Ie;Se*=_/(_-1);const Ce=Math.acos(t[2]),Ae=Math.atan2(-t[0],-t[1]),Pe=new yo;Pe.position=ve,Pe.setPitchBearing(Ce,Ae);const Ne=Pe.getWorldToCamera(I,ne),Ke=Se*I,Je=Math.min(u._mercatorZfromZoom(17)*I*-2,-2*Ke),mt=Pe.getCameraToClipOrthographic(-Ke,Ke,-Ke,Ke,Je,(Ke+y*ne)/t[2]),xt=new Float64Array(16);r.az(xt,mt,Ne);const Pt=r.cS(Math.floor(1e6*ve[0])/1e6*I,Math.floor(1e6*ve[1])/1e6*I,0),Ze=.5*_,lt=[0,0,0];r.ad(lt,Pt,xt),r.bY(lt,lt,Ze);const Ge=[Math.floor(lt[0]),Math.floor(lt[1]),Math.floor(lt[2])],bt=[0,0,0];r.at(bt,lt,Ge),r.bY(bt,bt,-1/Ze);const st=new Float64Array(16);return r.bx(st),r.bo(st,st,bt),r.az(xt,st,xt),[xt,Ke]}class yp extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,s){return r.aS(this.requestManager.transformRequest(s,r.R.Model).url).then(h=>{if(!h)return;const _=r.aT(h),y=new r.aU(t,void 0,void 0,_);return y.computeBoundsAndApplyParent(),y}).catch(h=>{if(h&&h.status===404)return null;this.fire(new r.z(new Error(`Could not load model ${t} from ${s}: ${h.message}`)))})}load(t,s,h={forceReload:!1}){this.models[s]||(this.models[s]={});const _=Object.keys(t),y=[],b=[];for(const C of _){const I=t[C];this.hasURLBeenRequested(I)&&!h.forceReload||(this.modelByURL[I]={modelId:C,scope:s},y.push(this.loadModel(C,I)),b.push(C)),this.models[s][C]||(this.models[s][C]={model:null,numReferences:1})}this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+b.length,Promise.allSettled(y).then(C=>{for(let I=0;I<C.length;I++){const{status:O}=C[I];if(O==="rejected")continue;const{value:k}=C[I];this.models[s][b[I]]||(this.models[s][b[I]]={model:null,numReferences:1}),this.models[s][b[I]].model=k}this.numModelsLoading[s]-=b.length,this.fire(new r.A("data",{dataType:"style"}))}).catch(C=>{this.fire(new r.z(new Error(`Could not load models: ${C.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,s,h={exactIdMatch:!1}){return!!(h.exactIdMatch?this.getModel(t,s):this.getModelByURL(this.modelUris[s][t]))}getModel(t,s){return this.models[s]||(this.models[s]={}),this.models[s][t]?this.models[s][t].model:void 0}getModelByURL(t){if(!t)return null;const s=this.modelByURL[t];return s?this.models[s.scope][s.modelId].model:null}hasModelBeenAdded(t,s){return this.models[s]&&this.models[s][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,s,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const _=this.requestManager.normalizeModelURL(s);if((this.hasModel(t,h,{exactIdMatch:!0})||this.hasModelBeenAdded(t,h))&&this.modelUris[h][t]===_)this.models[h][t].numReferences++;else if(this.hasURLBeenRequested(_)){const{scope:y,modelId:b}=this.modelByURL[_];this.models[y][b].numReferences++}else this.modelUris[h][t]=_,this.load({[t]:this.modelUris[h][t]},h)}addModelURLs(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const h=this.modelUris[s];for(const _ in t)h[_]=this.requestManager.normalizeModelURL(t[_])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const h={};for(const _ of t)this.hasModel(_,s,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[s][_].numReferences++:this.modelUris[s][_]&&!this.hasURLBeenRequested(_)?h[_]=this.modelUris[s][_]:!this.hasURLBeenRequested(_)&&r.cZ(_,!1)&&(this.modelUris[s][_]=this.requestManager.normalizeModelURL(_),h[_]=this.modelUris[s][_]);this.load(h,s)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,s,h=!1){if(this.models[s]&&this.models[s][t]&&(this.models[s][t].numReferences--,this.models[s][t].numReferences===0)){const _=this.modelUris[s][t];h||delete this.modelUris[s][t],delete this.modelByURL[_];const y=this.models[s][t].model;if(!y)return;delete this.models[s][t],y.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const s of Object.keys(this.models[t])){const h=this.models[t][s].model;delete this.models[t][s],h&&h.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,s){this.models[s]||(this.models[s]={});for(const h in this.models[s])this.models[s][h].model&&this.models[s][h].model.upload(t.context)}}const ah=new r.a7({data:new r.a8(r.a5.colorTheme.data)}),vp={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function vo(u){return u=u||{},Object.assign(u,vp)}class xp extends r.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},r.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const t=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.A("floorplangone"))};if(this._map.transform.zoom<13)return void t();const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=this._map.transform.width,_=this._map.transform.height,y=h*(2/3),b=_*(2/3),C=.5*(h-y),I=.5*(_-b),O=[new r.P(C,I),new r.P(C+y,I+b)],k=this._map.queryRenderedFeatures(O,s);k.length>0?this._selectedFloorplan&&k[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=k[0],this._floorplanSelected()):t()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const t=this._floorplanStates[this._indoorData.id].selectedBuilding,s=t?this._indoorData.buildings.find(C=>C.id===t):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,h=this._floorplanStates[this._indoorData.id].selectedLevel,_=this._indoorData.levels.find(C=>C.id===h),y=this._indoorData.levels.find(C=>!(!s||!s.levels)&&Number(C.levelOrder)===0&&s.levels.includes(C.id)),b=_?_.id:y?y.id:void 0;this.fire(new r.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:b})),s&&this._buildingSelected(s,!1),b&&this._levelSelected(b)}_buildingSelected(t,s){if(!t||!t.id)return void console.warn("IndoorManager: Building or building id is undefined");s&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const h=this._indoorData.levels.filter(_=>t.levels.includes(_.id));this.fire(new r.A("buildingselected",{buildingId:t.id,levels:h}))}_levelSelected(t){const s=this._indoorData.levels.find(h=>h.id===t);s?(this._updateLevels(s,!0),this.fire(new r.A("levelselected",{levelId:s.id}))):console.warn(`IndoorManager: Level with ID ${t} not found in the current floorplan.`)}_updateLevels(t,s){if(!t||!t.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function h(O){const k=O.indexOf("/floor/");if(k===-1)return O;const U=k+7,V=O.indexOf("/",U);return V===-1?O.slice(U):O.slice(U,V)}this._floorplanStates[this._indoorData.id].selectedLevel=t.id;const _=[],y={},b={},C={},I={};for(const O of this._indoorData.levels){if(_.push(O.id),y[O.id]=O.levelOrder>=0?3*Math.abs(O.levelOrder+1):3*Math.abs(O.levelOrder),b[O.id]=O.levelOrder>=0?3*O.levelOrder:0,this.mergeFloors){const k=h(t.id),U=h(O.id);C[O.id]=U===k?"true":"false"}else C[O.id]=O.id===t.id?"true":"false";I[O.id]=O.levelOrder<t.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",C]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",I]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",t.levelOrder<0)}selectFloorplan(t){const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],_=this._map.queryRenderedFeatures(h,s);if(_.length>0){for(const y of _)if(JSON.parse(y.properties["indoor-data"]).id===t){this._selectedFloorplan=y,this._floorplanSelected();break}}}selectBuilding(t){const s=this._indoorData.buildings.find(h=>h.id===t);this._buildingSelected(s,!0)}selectLevel(t){this._levelSelected(t)}}function ud(u){if(!u.metadata||!u.metadata.content_area)return;const t=r.q.devicePixelRatio,{left:s,top:h,width:_,height:y}=u.metadata.content_area,b=s*t,C=h*t;return[b,C,b+_*t,C+y*t]}function pf(u){if(u)return u.map(([t,s])=>[t*r.q.devicePixelRatio,s*r.q.devicePixelRatio])}class bp{constructor(t,s,h){this.id=t,this.scope=s,this.sourceCache=h,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const s=this.sourceCache.getVisibleCoordinates();if(s.length===0)return t;const h=this.sourceCache.getSource();if(!(h instanceof Cs))return t;const _=s.map(b=>this.sourceCache.getTile(b)),y=h.getImages(_,Array.from(this.pendingRequests));for(const[b,C]of y)t.set(r.I.from({name:b,iconsetId:this.id}),C),this.pendingRequests.delete(b);for(const b of this.pendingRequests)this.missingRequests.add(b);return this.pendingRequests.clear(),t}}const Ro=(u,t)=>Me(u,t&&t.filter(s=>s.identifier!=="source.canvas")),Vc=r.aF(en,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),mf=r.aF(en,["setCenter","setZoom","setBearing","setPitch"]),hd=new Set(["background","sky","slot","custom"]),gc={version:8,layers:[],sources:{}},gf={duration:300,delay:0};class ca extends r.E{constructor(t,s={}){super(),this.map=t,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=r.h({},gf),this._buildingIndex=new ys(this),this.crossTileSymbolIndex=new Hs,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new Qi,this.dispatcher=s.dispatcher?s.dispatcher:new r.D(r.c$(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Fn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new r.d0(t._requestManager,s.localFontFamily?r.d1.all:s.localIdeographFontFamily?r.d1.ideographs:r.d1.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new yp(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",r.d2());const h=this;this._rtlTextPluginCallback=ca.registerForPluginStateChange(_=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,b)=>{if(r.d3(y),b&&b.every(C=>C))for(const C in h._sourceCaches){const I=h._sourceCaches[C],O=I.getSource().type;O!=="vector"&&O!=="geojson"||I.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.getOwnSource(_.sourceId);if(y&&y.vectorLayerIds)for(const b in this._layers){const C=this._layers[b];C.source===y.id&&this._validateLayer(C)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.j(t))return t;const s=r.d4(t);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${r.d5(JSON.stringify(t))}`}_diffStyle(t,s,h){this.globalId=this._getGlobalId(t);const _=(y,b)=>{try{b(null,this.setState(y,h))}catch(C){b(C,!1)}};if(typeof t=="string"){const y=this.map._requestManager.normalizeStyleURL(t),b=this.map._requestManager.transformRequest(y,r.R.Style);r.n(b,(C,I)=>{C?this.fire(new r.z(C)):I&&_(I,s)})}else typeof t=="object"&&_(t,s)}loadURL(t,s={}){this.fire(new r.A("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!r.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,s.accessToken),this.resolvedImports.add(t);const _=this.importsCache.get(t);if(_)return this._load(_,h);const y=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.n(y,(b,C)=>{if(this._request=null,b)this.fire(new r.z(b));else if(C)return this.importsCache.set(t,C),this._load(C,h)})}loadJSON(t,s={}){this.fire(new r.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.q.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new r.A("dataloading",{dataType:"style"})),this._load(gc,!1)}_loadImports(t,s,h){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const y of t){const b=this._createFragmentStyle(y),C=new Promise(k=>{b.once("style.import.load",k),b.once("error",k)}).then(()=>this.mergeAll());if(_.push(C),this.resolvedImports.has(y.url)){b.loadEmpty();continue}const I=y.data||this.importsCache.get(y.url);I?(b.loadJSON(I,{validate:s}),this._isInternalStyle(I)&&(b.globalId=null)):y.url?b.loadURL(y.url,{validate:s}):b.loadEmpty();const O={style:b,id:y.id,config:y.config};if(h){const k=this.fragments.findIndex(({id:U})=>U===h);this.fragments=this.fragments.slice(0,k).concat(O).concat(this.fragments.slice(k))}else this.fragments.push(O)}return Promise.allSettled(_)}getImportGlobalIds(t=this,s=new Set){for(const h of t.fragments)h.style.globalId&&s.add(h.style.globalId),this.getImportGlobalIds(h.style,s);return[...s.values()]}_createFragmentStyle(t){const s=this.scope?r.C(t.id,this.scope):t.id;let h;const _=this._initialConfig&&this._initialConfig[s];(t.config||_)&&(h=r.h({},t.config,_));const y=new ca(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:h,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,s){const h=t.indoor?vo(t.schema):t.schema;if(this._isInternalStyle(t)){const b=r.h({},gc,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(b,s)}if(this.updateConfig(this._config,h),s&&Ro(this,Fs(t)))return;this._loaded=!0,this.stylesheet=r.d6(t);const _=()=>{for(const O in t.sources)this.addSource(O,t.sources[O],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const O in t.iconsets)this.addIconset(O,t.iconsets[O]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const b=Er(this.stylesheet.layers);if(this._order=b.map(O=>O.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const O=this.stylesheet.lights[0];this.light=new et(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new et(this.stylesheet.light)),this._layers={};for(const O of b){const k=r.db(O,this.scope,this._styleColorTheme.lut,this.options);k.configDependencies.size!==0&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k;const U=this.getOwnLayerSourceCache(k),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&k.canCastShadows()&&V&&(U.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.A("data",{dataType:"style"}));const I=this.isRootStyle();t.imports?this._loadImports(t.imports,s).then(()=>{this._reloadImports(),this.fire(new r.A(I?"style.load":"style.import.load"))}).catch(O=>{this.fire(new r.z(new Error("Failed to load imports",O))),this.fire(new r.A(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.A(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const b=this._evaluateColorThemeData(y);this._loadColorTheme(b).then(()=>{_()}).catch(C=>{r.w(`Couldn't load color theme from the stylesheet: ${C}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,s,h,_,y,b,C,I,O,k;const U={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(V=>{if(V.stylesheet){if(V.light!=null&&(t=V.light),V.stylesheet.lights)for(const H of V.stylesheet.lights)H.type==="ambient"&&V.ambientLight!=null&&(s=V.ambientLight),H.type==="directional"&&V.directionalLight!=null&&(h=V.directionalLight);_=this._prioritizeTerrain(_,V.terrain,V.stylesheet.terrain),V.stylesheet.fog&&V.fog!=null&&(y=V.fog),V.stylesheet.snow&&V.snow!=null&&(b=V.snow),V.stylesheet.rain&&V.rain!=null&&(C=V.rain),V.stylesheet.camera!=null&&(k=V.stylesheet.camera),V.stylesheet.projection!=null&&(I=V.stylesheet.projection),V.stylesheet.transition!=null&&(O=V.stylesheet.transition),U[V.scope]=V._styleColorTheme}}),this.light=t,this.ambientLight=s,this.directionalLight=h,this.fog=y,this.snow=b,this.rain=C,this._styleColorThemeForScope=U,_===null?delete this.terrain:this.terrain=_,this.camera=k||{"camera-projection":"perspective"},this.projection=I||{name:"mercator"},this.transition=r.h({},gf,O),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const s=h=>{for(const _ of h.fragments)s(_.style);t(h)};s(this)}_prioritizeTerrain(t,s,h){const _=t&&t.drapeRenderMode===0;return h===null?s&&s.drapeRenderMode===0?s:_?t:null:s!=null&&(!t||_||s&&s.drapeRenderMode===1)?s:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{t=this._prioritizeTerrain(t,s.terrain,s.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(t=s.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},s={},h={};this.forEachFragmentStyle(_=>{for(const y in _._sourceCaches){const b=r.C(y,_.scope);t[b]=_._sourceCaches[y]}for(const y in _._otherSourceCaches){const b=r.C(y,_.scope);s[b]=_._otherSourceCaches[y]}for(const y in _._symbolSourceCaches){const b=r.C(y,_.scope);h[b]=_._symbolSourceCaches[y]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=h}mergeLayers(){const t={},s=[],h={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(y=>{for(const b of y._order){const C=y._layers[b];if(C.type==="slot"){const I=r.d7(b);if(t[I])continue;t[I]=[]}C.slot&&t[C.slot]?t[C.slot].push(C):s.push(C)}}),this._mergedOrder=[];const _=(y=[])=>{for(const b of y)if(b.type==="slot"){const C=r.d7(b.id);t[C]&&_(t[C]),this._mergedSlots.push(C)}else{const C=r.C(b.id,b.scope);this._mergedOrder.push(C),h[C]=b,b.is3D(!!this.terrain)&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0),b.type==="clip"&&(this._clipLayerPresent=!0)}};_(s),this._mergedOrder.sort((y,b)=>{const C=h[y],I=h[b];return C.hasInitialOcclusionOpacityProperties?I.is3D(!!this.terrain)?1:0:C.is3D(!!this.terrain)&&I.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=r.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(s,h,_,y){const b=r.h({},h);for(const I of Object.keys(r.a5.colorTheme))b[I]===void 0&&(b[I]=r.a5.colorTheme[I].default);const C=new r.a6(ah,s,new Map(_));return C.setTransitionOrValue(b,_),C.untransitioned().possiblyEvaluate(new r.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((h,_)=>{const y="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();let b=t;b.startsWith(y)||(b=y+b);const C=r.I.from("mapbox-reserved-lut"),I=new Image;I.src=b,I.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},I.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void h();this._styleColorTheme.lutLoading=!1;const{width:O,height:k,data:U}=r.q.getImageData(I);if(k>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(O!==k*k)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new r.r({width:O,height:k},U),pixelRatio:1,sdf:!1,usvg:!1,version:0});const V=this.imageManager.getImage(C,this.scope);V?(this._styleColorTheme.lut={image:V.data,data:t},h()):_(new Error("Missing LUT image."))}})}getLut(t){const s=this._styleColorThemeForScope[t];return s?s.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(s,h,_){let y,b,C;const I=r.q.devicePixelRatio>1?"@2x":"";let O=r.n(h.transformRequest(h.normalizeSpriteURL(s,I,".json"),r.R.SpriteJSON),(V,H)=>{O=null,C||(C=V,y=H,U())}),k=r.o(h.transformRequest(h.normalizeSpriteURL(s,I,".png"),r.R.SpriteImage),(V,H)=>{k=null,C||(C=V,b=H,U())});function U(){if(C)_(C);else if(y&&b){const V=r.q.getImageData(b),H={};for(const Q in y){const{width:X,height:J,x:ne,y:oe,sdf:ve,pixelRatio:Se,stretchX:Le,stretchY:Ie,content:Ce}=y[Q],Ae=new r.r({width:X,height:J});r.r.copy(V,Ae,{x:ne,y:oe},{x:0,y:0},{width:X,height:J},null),H[Q]={data:Ae,pixelRatio:Se,sdf:ve,stretchX:Le,stretchY:Ie,content:Ce,usvg:!1}}_(null,H)}}return{cancel(){O&&(O.cancel(),O=null),k&&(k.cancel(),k=null)}}}(t,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new r.z(s));else if(h){const _=new Map;for(const y in h)_.set(r.I.from(y),h[y]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.A("data",{dataType:"style"}))})}addIconset(t,s){if(s.type==="sprite")return void this._loadSprite(s.url);const h=this.getOwnSourceCache(s.source);if(!h)return void this.fire(new r.z(new Error(`Source "${s.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const _=h.getSource();if(_.type!=="raster-array")return void this.fire(new r.z(new Error(`Source "${s.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;const y=new bp(t,this.scope,h);this.imageManager.addImageProvider(y,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!r.j(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const s=this.map._spriteFormat==="auto";var h,_;this._spriteRequest=(_=(y,b)=>{if(this._spriteRequest=null,y)s?this._loadSprite(t):this.fire(new r.z(y));else if(b){const C=new Map;for(const I in b)C.set(r.I.from(I),b[I]);this.addImages(C)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.A("data",{dataType:"style"}))},r.br((h=this.map._requestManager).transformRequest(h.normalizeIconsetURL(t),r.R.Iconset),(y,b)=>{if(y)return void _(y);const C={},I=r.c_(new r.bq(b));for(const O of I.icons){const k={version:1,pixelRatio:r.q.devicePixelRatio,content:ud(O),stretchX:O.metadata?pf(O.metadata.stretch_x_areas):void 0,stretchY:O.metadata?pf(O.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:O};C[O.name]=k}_(null,C)}))}_validateLayer(t){const s=this.getOwnSource(t.source);if(!s)return;const h=t.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new r.z(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,s)=>{const h=this.fragments[s];return h&&h.style&&(t.data=h.style.serialize()),t})}_serializeSources(){const t={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();t[h.id]||(t[h.id]=h.serialize())}return t}_serializeLayers(t){const s=[];for(const h of t){const _=this._layers[h];_&&_.type!=="custom"&&s.push(_.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const s=this.getOwnLayer(t);if(s)return s;this.fire(new r.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const s=this.getOwnSource(t);if(s)return s;this.fire(new r.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,s){const h=this.map.painter;if(h)for(let _=t.minzoom||0;_<(t.maxzoom||25.5);_++){const y=t.getProgramIds();if(y)for(const b of y){const C=t.getDefaultProgramParams(b,s.zoom,this._styleColorTheme.lut);C&&(h.style=this,this.fog&&(h._fogVisible=!0,C.overrideFog=!0,h.getOrCreateProgram(b,C)),h._fogVisible=!1,C.overrideFog=!1,h.getOrCreateProgram(b,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,h.getOrCreateProgram(b,C)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const s=this.calculateLightsBrightness();t.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const h=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const C=this._changes.getLayerUpdatesByScope();for(const I in C){const{updatedIds:O,removedIds:k}=C[I];(O||k)&&(this._updateWorkerLayers(I,O,k),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const y={};for(const C in this._mergedSourceCaches){const I=this._mergedSourceCaches[C];y[C]=I.used,I.used=!1,I.tileCoverLift=0}for(const C of this._mergedOrder){const I=this._mergedLayers[C];if(I.recalculate(t,this._availableImages),!I.isHidden(t.zoom)){const O=this.getLayerSourceCache(I);O&&(O.used=!0,O.tileCoverLift=Math.max(O.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,t)}):this.precompilePrograms(I,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();const b=this.imageManager.getPendingImageProviders();for(const C of b)C.sourceCache.used=!0;for(const C in y){const I=this._mergedSourceCaches[C];y[C]!==I.used&&I.getSource().fire(new r.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),h&&this.fire(new r.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const s of t){const h=s.resolvePendingRequests(),_=this.getFragmentStyle(s.scope);_&&_.addImages(h)}}_updateTilesForChangedImages(){const t={};for(const s in this._mergedSourceCaches){const h=this._mergedSourceCaches[s].getSource().scope;t[h]=t[h]||this._changes.getUpdatedImages(h),t[h].length!==0&&this._mergedSourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t[h])}for(const s in t)this._changes.resetUpdatedImages(s)}_updateWorkerLayers(t,s,h){const _=this.getFragmentStyle(t);_&&this.dispatcher.broadcast("updateLayers",{layers:s?_._serializeLayers(s):[],scope:t,removedIds:h||[],options:_.options})}setState(t,s){if(this._checkLoaded(),Ro(this,Fs(t)))return!1;(t=r.d6(t)).layers=Er(t.layers);const h=function(b,C){if(!b)return[{command:en.setStyle,args:[C]}];let I=[];try{if(!r.bv(b.version,C.version))return[{command:en.setStyle,args:[C]}];if(r.bv(b.center,C.center)||I.push({command:en.setCenter,args:[C.center]}),r.bv(b.zoom,C.zoom)||I.push({command:en.setZoom,args:[C.zoom]}),r.bv(b.bearing,C.bearing)||I.push({command:en.setBearing,args:[C.bearing]}),r.bv(b.pitch,C.pitch)||I.push({command:en.setPitch,args:[C.pitch]}),r.bv(b.sprite,C.sprite)||I.push({command:en.setSprite,args:[C.sprite]}),r.bv(b.glyphs,C.glyphs)||I.push({command:en.setGlyphs,args:[C.glyphs]}),r.bv(b.imports,C.imports)||function(H=[],Q=[],X){Q=Q||[];const J=(H=H||[]).map(Ta),ne=Q.map(Ta),oe=H.reduce(Sa,{}),ve=Q.reduce(Sa,{}),Se=J.slice();let Le,Ie,Ce,Ae;for(Le=0,Ie=0;Le<J.length;Le++)Ce=J[Le],ve.hasOwnProperty(Ce)?Ie++:(X.push({command:en.removeImport,args:[Ce]}),Se.splice(Se.indexOf(Ce,Ie),1));for(Le=0,Ie=0;Le<ne.length;Le++)Ce=ne[ne.length-1-Le],Se[Se.length-1-Le]!==Ce&&(oe.hasOwnProperty(Ce)?(X.push({command:en.removeImport,args:[Ce]}),Se.splice(Se.lastIndexOf(Ce,Se.length-Ie),1)):Ie++,Ae=Se[Se.length-Le],X.push({command:en.addImport,args:[ve[Ce],Ae]}),Se.splice(Se.length-Le,0,Ce));for(const Pe of Q){const Ne=oe[Pe.id];Ne&&(delete Ne.data,r.bv(Ne,Pe)||X.push({command:en.updateImport,args:[Pe.id,Pe]}))}}(b.imports,C.imports,I),r.bv(b.transition,C.transition)||I.push({command:en.setTransition,args:[C.transition]}),r.bv(b.light,C.light)||I.push({command:en.setLight,args:[C.light]}),r.bv(b.fog,C.fog)||I.push({command:en.setFog,args:[C.fog]}),r.bv(b.snow,C.snow)||I.push({command:en.setSnow,args:[C.snow]}),r.bv(b.rain,C.rain)||I.push({command:en.setRain,args:[C.rain]}),r.bv(b.projection,C.projection)||I.push({command:en.setProjection,args:[C.projection]}),r.bv(b.lights,C.lights)||I.push({command:en.setLights,args:[C.lights]}),r.bv(b.camera,C.camera)||I.push({command:en.setCamera,args:[C.camera]}),r.bv(b.iconsets,C.iconsets)||function(H,Q,X){let J;for(J in Q=Q||{},H=H||{})H.hasOwnProperty(J)&&(Q.hasOwnProperty(J)||X.push({command:en.removeIconset,args:[J]}));for(J in Q){if(!Q.hasOwnProperty(J))continue;const ne=Q[J];H.hasOwnProperty(J)?r.bv(H[J],ne)||(X.push({command:en.removeIconset,args:[J]}),X.push({command:en.addIconset,args:[J,ne]})):X.push({command:en.addIconset,args:[J,ne]})}}(b.iconsets,C.iconsets,I),!r.bv(b["color-theme"],C["color-theme"]))return[{command:en.setStyle,args:[C]}];const O={},k=[];(function(H,Q,X,J){let ne;for(ne in Q=Q||{},H=H||{})H.hasOwnProperty(ne)&&(Q.hasOwnProperty(ne)||Ga(ne,X,J));for(ne in Q){if(!Q.hasOwnProperty(ne))continue;const oe=Q[ne];H.hasOwnProperty(ne)?r.bv(H[ne],oe)||(H[ne].type==="geojson"&&oe.type==="geojson"&&mo(H,Q,ne)?X.push({command:en.setGeoJSONSourceData,args:[ne,oe.data]}):ds(ne,Q,X,J)):ss(ne,Q,X)}})(b.sources,C.sources,k,O);const U=[];b.layers&&b.layers.forEach(H=>{H.source&&O[H.source]?I.push({command:en.removeLayer,args:[H.id]}):U.push(H)});let V=b.terrain;V&&O[V.source]&&(I.push({command:en.setTerrain,args:[void 0]}),V=void 0),I=I.concat(k),r.bv(V,C.terrain)||I.push({command:en.setTerrain,args:[C.terrain]}),function(H,Q,X){Q=Q||[];const J=(H=H||[]).map(Ta),ne=Q.map(Ta),oe=H.reduce(Sa,{}),ve=Q.reduce(Sa,{}),Se=J.slice(),Le=Object.create(null);let Ie,Ce,Ae,Pe,Ne,Ke,Je;for(Ie=0,Ce=0;Ie<J.length;Ie++)Ae=J[Ie],ve.hasOwnProperty(Ae)?Ce++:(X.push({command:en.removeLayer,args:[Ae]}),Se.splice(Se.indexOf(Ae,Ce),1));for(Ie=0,Ce=0;Ie<ne.length;Ie++)Ae=ne[ne.length-1-Ie],Se[Se.length-1-Ie]!==Ae&&(oe.hasOwnProperty(Ae)?(X.push({command:en.removeLayer,args:[Ae]}),Se.splice(Se.lastIndexOf(Ae,Se.length-Ce),1)):Ce++,Ke=Se[Se.length-Ie],X.push({command:en.addLayer,args:[ve[Ae],Ke]}),Se.splice(Se.length-Ie,0,Ae),Le[Ae]=!0);for(Ie=0;Ie<ne.length;Ie++)if(Ae=ne[Ie],Pe=oe[Ae],Ne=ve[Ae],!Le[Ae]&&!r.bv(Pe,Ne))if(r.bv(Pe.source,Ne.source)&&r.bv(Pe["source-layer"],Ne["source-layer"])&&r.bv(Pe.type,Ne.type)){for(Je in ml(Pe.layout,Ne.layout,X,Ae,null,en.setLayoutProperty),ml(Pe.paint,Ne.paint,X,Ae,null,en.setPaintProperty),r.bv(Pe.slot,Ne.slot)||X.push({command:en.setSlot,args:[Ae,Ne.slot]}),r.bv(Pe.filter,Ne.filter)||X.push({command:en.setFilter,args:[Ae,Ne.filter]}),r.bv(Pe.minzoom,Ne.minzoom)&&r.bv(Pe.maxzoom,Ne.maxzoom)||X.push({command:en.setLayerZoomRange,args:[Ae,Ne.minzoom,Ne.maxzoom]}),Pe)Pe.hasOwnProperty(Je)&&Je!=="layout"&&Je!=="paint"&&Je!=="filter"&&Je!=="metadata"&&Je!=="minzoom"&&Je!=="maxzoom"&&Je!=="slot"&&(Je.indexOf("paint.")===0?ml(Pe[Je],Ne[Je],X,Ae,Je.slice(6),en.setPaintProperty):r.bv(Pe[Je],Ne[Je])||X.push({command:en.setLayerProperty,args:[Ae,Je,Ne[Je]]}));for(Je in Ne)Ne.hasOwnProperty(Je)&&!Pe.hasOwnProperty(Je)&&Je!=="layout"&&Je!=="paint"&&Je!=="filter"&&Je!=="metadata"&&Je!=="minzoom"&&Je!=="maxzoom"&&Je!=="slot"&&(Je.indexOf("paint.")===0?ml(Pe[Je],Ne[Je],X,Ae,Je.slice(6),en.setPaintProperty):r.bv(Pe[Je],Ne[Je])||X.push({command:en.setLayerProperty,args:[Ae,Je,Ne[Je]]}))}else X.push({command:en.removeLayer,args:[Ae]}),Ke=Se[Se.lastIndexOf(Ae)+1],X.push({command:en.addLayer,args:[Ne,Ke]})}(U,C.layers,I)}catch(O){console.warn("Unable to compute style diff:",O),I=[{command:en.setStyle,args:[C]}]}return I}(this.serialize(),t).filter(b=>!(b.command in mf));if(h.length===0)return!1;const _=h.filter(b=>!(b.command in Vc));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);const y=[];return h.forEach(b=>{y.push(this[b.command](...b.args))}),s&&Promise.all(y).then(s).catch(s),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[s,h]of t.entries()){if(this.getImage(s))return this.fire(new r.z(new Error(`An image with the name "${s.name}" already exists.`)));this.imageManager.addImage(s,this.scope,h),this._changes.updateImage(s,this.scope)}return this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this}addImage(t,s){return this.getImage(t)?this.fire(new r.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,s),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this)}updateImage(t,s,h=!1){this.imageManager.updateImage(t,this.scope,s),h&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this):this.fire(new r.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new r.A("data",{dataType:"style"})),this}addModel(t,s,h={}){return this._checkLoaded(),this._validate(xe,`models.${t}`,s,null,h)||(this.modelManager.addModel(t,s,this.scope),this.fire(new r.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new r.A("data",{dataType:"style"})),this):this.fire(new r.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,s,h={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(dl,`sources.${t}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const _=fl(t,s,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const y=b=>{const C=(b?"symbol:":"other:")+_.id,I=r.C(C,this.scope),O=this._sourceCaches[C]=new Ht(I,_,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=O,O.onAdd(this.map)};y(!1),s.type!=="vector"&&s.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const s=this.getOwnSource(t);if(!s)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new r.z(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const _=Object.entries(this.stylesheet.iconsets).find(([y,b])=>b.type==="source"&&b.source===t);if(_)return this.fire(new r.z(new Error(`Source "${t}" cannot be removed while iconset "${_[0]}" is using it.`)))}const h=this.getOwnSourceCaches(t);for(const _ of h){const y=r.d7(_.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(_.id),_.fire(new r.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getOwnSource(t).setData(s),this._changes.setDirty()}getOwnSource(t){const s=this.getOwnSourceCache(t);return s&&s.getSource()}getOwnSources(){const t=[];for(const s in this._otherSourceCaches){const h=this.getOwnSourceCache(s);h&&t.push(h.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const s in t){const h=t[s]._tiles;for(const _ in h){const y=h[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const y of t){if(this._validate(Fa,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(y),b.updateTransitions(s)}else this.ambientLight=new Mn(y,Yi||(Yi=new r.a7({color:new r.a8(r.a5.properties_light_ambient.color),"color-use-theme":new r.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a8(r.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(y),b.updateTransitions(s)}else this.directionalLight=new Mn(y,Hn||(Hn=new r.a7({direction:new r.an(r.a5.properties_light_directional.direction),color:new r.a8(r.a5.properties_light_directional.color),"color-use-theme":new r.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a8(r.a5.properties_light_directional.intensity),"cast-shadows":new r.a8(r.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a8(r.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a8(r.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const h=Object.assign(s,{worldview:this.map.getWorldview()}),_=new r.aa(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,s=this.ambientLight;if(!t||!s)return;const h=V=>.2126*(V[0]<=.03928?V[0]/12.92:Math.pow((V[0]+.055)/1.055,2.4))+.7152*(V[1]<=.03928?V[1]/12.92:Math.pow((V[1]+.055)/1.055,2.4))+.0722*(V[2]<=.03928?V[2]/12.92:Math.pow((V[2]+.055)/1.055,2.4)),_=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=t.properties.get("intensity"),b=t.properties.get("direction"),C=1-r.cR(b.x,b.y,b.z)[2]/90,I=h(_)*y*C,O=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),k=s.properties.get("intensity"),U=h(O)*k;return Number(((I+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(r.d8(t)){const s=r.d9(t),h=this.fragments.find(({id:y})=>y===s);if(!h)return;const _=r.d7(t);return h.style.getFragmentStyle(_)}{const s=this.fragments.find(({id:h})=>h===t);return s?s.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const s={},h=(_,y="")=>`${_}::${y}`;this._featuresetSelectors={};for(const _ in t){const y=this._featuresetSelectors[_]=[];for(const b of t[_].selectors){if(b.featureNamespace){const I=this.getOwnLayer(b.layer);if(!I){r.w(`Layer is undefined for selector: ${b.layer}`);continue}const O=h(I.source,I.sourceLayer);if(O in s&&s[O]!==b.featureNamespace){r.w(`"featureNamespace ${b.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}s[O]=b.featureNamespace}let C;if(b.properties)for(const I in b.properties){const O=r.X(b.properties[I]);O.result==="success"&&(C=C||{},C[I]=O.value)}y.push({layerId:b.layer,namespace:b.featureNamespace,properties:C,uniqueFeatureID:b._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const s=this.getFragmentStyle(t);if(!s||!s.stylesheet.featuresets)return[];const h=[];for(const _ in s.stylesheet.featuresets)h.push({featuresetId:_,importId:s.scope?s.scope:void 0});return h}getFeaturesetLayers(t,s){const h=this.getFragmentStyle(s),_=h.stylesheet.featuresets;if(!_||!_[t])return this.fire(new r.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const y=[];for(const b of _[t].selectors){const C=h.getOwnLayer(b.layer);C&&y.push(C)}return y}getConfigProperty(t,s){const h=this.getFragmentStyle(t);if(!h)return null;const _=r.C(s,h.scope),y=h.options.get(_),b=y?y.value||y.default:null;return b?b.serialize():null}setConfigProperty(t,s,h){const _=this.getFragmentStyle(t);if(!_)return;const y=_.stylesheet.indoor?vo(_.stylesheet.schema):_.stylesheet.schema;if(!y||!y[s])return;const b=r.X(h);if(b.result!=="success")return void Ro(this,b.value);const C=b.value.expression,I=r.C(s,_.scope),O=_.options.get(I);if(!O)return;let k;const{minValue:U,maxValue:V,stepValue:H,type:Q,values:X}=y[s],J=r.X(y[s].default);J.result==="success"&&(k=J.value.expression),k?(this.options.set(I,Object.assign({},O,{value:C,default:k,minValue:U,maxValue:V,stepValue:H,type:Q,values:X})),this.updateConfigDependencies(s)):this.fire(new r.z(new Error(`No schema defined for the config option "${s}" in the "${t}" fragment.`)))}getConfig(t){const s=this.getFragmentStyle(t);if(!s)return null;const h=s.stylesheet.schema;if(!h)return null;const _={};for(const y in h){const b=r.C(y,s.scope),C=s.options.get(b),I=C?C.value||C.default:null;_[y]=I?I.serialize():null}return _}setConfig(t,s){const h=this.getFragmentStyle(t);h&&(h.updateConfig(s,h.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const s=this.getFragmentStyle(t);return s?s.stylesheet.schema:null}setSchema(t,s){const h=this.getFragmentStyle(t);h&&(h.stylesheet.schema=s,h.updateConfig(h._config,s),this.updateConfigDependencies())}updateConfig(t,s){if(this._config=t,t||s)if(s)for(const h in s){let _,y;const b=r.X(s[h].default);if(b.result==="success"&&(_=b.value.expression),t&&t[h]!==void 0){const V=r.X(t[h]);V.result==="success"&&(y=V.value.expression)}const{minValue:C,maxValue:I,stepValue:O,type:k,values:U}=s[h];if(_){const V=r.C(h,this.scope);this.options.set(V,{default:_,value:y,minValue:C,maxValue:I,stepValue:O,type:k,values:U})}else this.fire(new r.z(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new r.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const s of this._configDependentLayers){const h=this.getLayer(s);if(h){if(t&&!h.configDependencies.has(t))continue;h.possiblyEvaluateVisibility(),this._updateLayer(h)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(s=>{const h=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(h){const _=s._evaluateColorThemeData(h);(!s._styleColorTheme.lut&&_!==""||s._styleColorTheme.lut&&_!==s._styleColorTheme.lut.data)&&s.setColorTheme(h)}}),this._changes.setDirty()}addLayer(t,s,h={}){this._checkLoaded();const _=t.id;if(this._layers[_])return void this.fire(new r.z(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(t.type==="custom"){if(Ro(this,r.da(t)))return;y=r.db(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(_,t.source),t=r.d6(t),t=r.h(t,{source:_})),this._validate(wn,`layers.${_}`,t,{arrayIndex:-1},h))return;y=r.db(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let b=this._order.length;if(s){const k=this._order.indexOf(s);if(k===-1)return void this.fire(new r.z(new Error(`Layer with id "${s}" does not exist on this map.`)));y.slot===this._layers[s].slot?b=k:r.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,_),this._layerOrderChanged=!0,this._layers[_]=y;const C=this.getOwnLayerSourceCache(y),I=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&y.canCastShadows()&&I&&(C.castsShadows=!0);const O=this._changes.getRemovedLayer(y);if(O&&y.source&&C&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const k=r.C(y.source,y.scope);O.type!==y.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),C.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(t,s){this._checkLoaded();const h=this._checkLayer(t);if(!h||t===s)return;const _=this._order.indexOf(t);this._order.splice(_,1);let y=this._order.length;if(s){const b=this._order.indexOf(s);if(b===-1)return void this.fire(new r.z(new Error(`Layer with id "${s}" does not exist on this map.`)));h.slot===this._layers[s].slot?y=b:r.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;s.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const _=this.getOwnLayerSourceCache(s);if(_&&_.castsShadows){let y=!1;for(const b in this._layers)if(this._layers[b].source===s.source&&this._layers[b].canCastShadows()){y=!0;break}_.castsShadows=y}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,h){this._checkLoaded();const _=this._checkLayer(t);_&&(_.minzoom===s&&_.maxzoom===h||(s!=null&&(_.minzoom=s),h!=null&&(_.maxzoom=h),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,s){this._checkLoaded();const h=this._checkLayer(t);h&&h.slot!==s&&(h.slot=s,this._updateLayer(h))}setFilter(t,s,h={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!r.bv(_.filter,s))return s==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(nt,`layers.${_.id}.filter`,s,{layerType:_.type},h)||(_.filter=r.d6(s),this._updateLayer(_)))}getFilter(t){const s=this._checkLayer(t);if(s)return r.d6(s.filter)}setLayoutProperty(t,s,h,_={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!r.bv(y.getLayoutProperty(s),h)){if(h!=null&&(!_||_.validate!==!1)&&Ro(y,ae.call(Fs,{key:`layers.${t}.layout.${s}`,layerType:y.type,objectKey:s,value:h,styleSpec:r.a5,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(s,h),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(t,s){const h=this._checkLayer(t);if(h)return h.getLayoutProperty(s)}setPaintProperty(t,s,h,_={}){this._checkLoaded();const y=this._checkLayer(t);if(!y||r.bv(y.getPaintProperty(s),h)||h!=null&&(!_||_.validate!==!1)&&Ro(y,ee.call(Fs,{key:`layers.${t}.paint.${s}`,layerType:y.type,objectKey:s,value:h,styleSpec:r.a5})))return;const b=y.setPaintProperty(s,h);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),b&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(t,s){const h=this._checkLayer(t);if(h)return h.getPaintProperty(s)}setFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:I,importId:O}=t.target,k=this.getFragmentStyle(O),U=k.getFeaturesetLayers(I);for(const{source:V,sourceLayer:H}of U)k.setFeatureState({id:t.id,source:V,sourceLayer:H},s)}else if("layerId"in t.target){const{layerId:I}=t.target,O=this.getLayer(I);this.setFeatureState({id:t.id,source:O.source,sourceLayer:O.sourceLayer},s)}return}const h=t.source,_=t.sourceLayer,y=this._checkSource(h);if(!y)return;const b=y.type;if(b==="geojson"&&_)return void this.fire(new r.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!_)return void this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.z(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(h);for(const I of C)I.setFeatureState(_,t.id,s)}removeFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:I,importId:O}=t.target,k=this.getFragmentStyle(O),U=k.getFeaturesetLayers(I);for(const{source:V,sourceLayer:H}of U)k.removeFeatureState({id:t.id,source:V,sourceLayer:H},s)}else if("layerId"in t.target){const{layerId:I}=t.target,O=this.getLayer(I);this.removeFeatureState({id:t.id,source:O.source,sourceLayer:O.sourceLayer},s)}return}const h=t.source,_=this._checkSource(h);if(!_)return;const y=_.type,b=y==="vector"?t.sourceLayer:void 0;if(y==="vector"&&!b)return void this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.z(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(h);for(const I of C)I.removeFeatureState(b,t.id,s)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let y;if("featuresetId"in t.target){const{featuresetId:b,importId:C}=t.target,I=this.getFragmentStyle(C),O=I.getFeaturesetLayers(b);for(const{source:k,sourceLayer:U}of O){const V=I.getFeatureState({id:t.id,source:k,sourceLayer:U});if(V&&!y)y=V;else if(!r.bv(y,V))return void this.fire(new r.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:b}=t.target,C=this.getLayer(b);y=this.getFeatureState({id:t.id,source:C.source,sourceLayer:C.sourceLayer})}return y}const s=t.source,h=t.sourceLayer,_=this._checkSource(s);if(_){if(_.type!=="vector"||h)return t.id===void 0&&this.fire(new r.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(h,t.id);this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=r.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return r.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),s=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateFilteredLayers(t){for(const s of Object.values(this._mergedLayers))t(s)&&this._updateLayer(s)}_updateLayer(t){this._changes.updateLayer(t);const s=this.getLayerSourceCache(t),h=r.C(t.source,t.scope),_=this._changes.getUpdatedSourceCaches();t.source&&!_[h]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),s.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=C=>this._mergedLayers[C].is3D(!!this.terrain),h=this.order,_={},y=[];for(let C=h.length-1;C>=0;C--){const I=h[C];if(s(I)){_[I]=C;for(const O of t){const k=O[I];if(k)for(const U of k)y.push(U)}}}y.sort((C,I)=>I.intersectionZ-C.intersectionZ);const b=[];for(let C=h.length-1;C>=0;C--){const I=h[C];if(s(I))for(let O=y.length-1;O>=0;O--){const k=y[O].feature;if(k.layer&&_[k.layer.id]<C)break;b.push(k),y.pop()}else for(const O of t){const k=O[I];if(k)for(const U of k)b.push(U.feature)}}return b}queryRenderedFeatures(t,s,h){let _;s&&!Array.isArray(s)&&s.filter&&(this._validate(nt,"queryRenderedFeatures.filter",s.filter,null,s),_=r.b3(s.filter));const y={},b=k=>{if(hd.has(k.type))return;const U=this.getOwnLayerSourceCache(k),V=y[U.id]=y[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};k.is3D(!!this.terrain)&&(V.has3DLayers=!0),V.layers[k.fqid]=V.layers[k.fqid]||{styleLayer:k,targets:[]},V.layers[k.fqid].targets.push({filter:_})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new r.z(new Error("parameters.layers must be an Array."))),[];for(const k of s.layers){const U=this._layers[k];if(!U)return this.fire(new r.z(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];b(U)}}else for(const k in this._layers)b(this._layers[k]);const C=this._queryRenderedFeatures(t,y,h),I=this._flattenAndSortRenderedFeatures(C),O=[];for(const k of I)r.dd(k.layer.id)===this.scope&&O.push(k);return O}queryRenderedFeatureset(t,s,h){let _;s&&!Array.isArray(s)&&s.filter&&(this._validate(nt,"queryRenderedFeatures.filter",s.filter,null,s),_=r.b3(s.filter));const y="mock",b=[];if(s&&s.target)b.push(Object.assign({},s,{targetId:y,filter:_}));else{const k=this.getFeaturesetDescriptors();for(const U of k)b.push({targetId:y,filter:_,target:U});for(const{style:U}of this.fragments){const V=U.getFeaturesetDescriptors();for(const H of V)b.push({targetId:y,filter:_,target:H})}}const C=this.queryRenderedTargets(t,b,h),I=[],O=new Set;for(const k of C)for(const U of k.variants[y])Ol(U,k,O)||I.push(new r.de(k,U));return I}queryRenderedTargets(t,s,h){const _={},y=(C,I,O,k)=>{const U=_[I.id]=_[I.id]||{sourceCache:I,layers:{},has3DLayers:!1};if(U.layers[C.fqid]=U.layers[C.fqid]||{styleLayer:C,targets:[]},C.is3D(!!this.terrain)&&(U.has3DLayers=!0),!k)return O.uniqueFeatureID=!1,void U.layers[C.fqid].targets.push(O);U.layers[C.fqid].targets.push(Object.assign({},O,{namespace:k.namespace,properties:k.properties,uniqueFeatureID:k.uniqueFeatureID}))};for(const C of s)if("featuresetId"in C.target){const{featuresetId:I,importId:O}=C.target,k=this.getFragmentStyle(O);if(!k||!k._featuresetSelectors)continue;const U=k._featuresetSelectors[I];if(!U){this.fire(new r.z(new Error(`The featureset '${I}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const V of U){const H=k.getOwnLayer(V.layerId);H&&!hd.has(H.type)&&y(H,k.getOwnLayerSourceCache(H),C,V)}}else if("layerId"in C.target){const{layerId:I}=C.target,O=this.getLayer(I);if(!O||hd.has(O.type))continue;y(O,this.getLayerSourceCache(O),C)}const b=this._queryRenderedFeatures(t,_,h);return this._flattenAndSortRenderedFeatures(b)}_queryRenderedFeatures(t,s,h){const _=[],y=!!this.map._showQueryGeometry,b=Tn.createFromScreenPoints(t,h);for(const C in s){const I=no(b,s[C],this._availableImages,h,y);Object.keys(I).length&&_.push(I)}if(this.placement)for(const C in s){if(!s[C].sourceCache._onlySymbols)continue;const I=Bo(b.screenGeometry,s[C],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(I).length&&_.push(I)}return _}querySourceFeatures(t,s){const h=s&&s.filter;h&&this._validate(nt,"querySourceFeatures.filter",h,null,s);let _=[];const y=this.getOwnSourceCaches(t);for(const b of y)_=_.concat(rs(b,s));return _}addSourceType(t,s,h){return ca.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(ca.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,s,h={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const C in t)if(!r.bv(t[C],_[C])){y=!0;break}if(!y)return;const b=this._getTransitionParameters();this.light.setLight(t,s,h),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,s=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let h=t;const _=t.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof h.source=="object"){const C="terrain-dem-src";this.addSource(C,h.source),h=r.d6(h),h=r.h(h,{source:C})}const y=r.h({},h),b={};if(this.terrain&&_){y.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(b.style=C.serialize())}if(this._validate(Qt,"terrain",y,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&s!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,s),this.fire(new r.A("data",{dataType:"style"}))}else{const y=this.terrain,b=y.get();for(const C of Object.keys(r.a5.terrain))!h.hasOwnProperty(C)&&r.a5.terrain[C].default&&(h[C]=r.a5.terrain[C].default);for(const C in t)if(!r.bv(t[C],b[C])){y.set(t,this.options),this.stylesheet.terrain=t;const I=this._getTransitionParameters({duration:0});y.updateTransitions(I),this.fire(new r.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Ni(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_createSnow(t){const s=this.snow=new ir(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_createRain(t){const s=this.rain=new Vn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!r.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!r.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.snow=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!r.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.rain=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void t();const h=this._evaluateColorThemeData(s);this._loadColorTheme(h).then(()=>{this.fire(new r.A("colorthemeset")),t()}).catch(_=>{r.w(`Couldn't set color theme: ${_}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,s){const h=this.getFragmentStyle(t);h&&(h._styleColorTheme.colorThemeOverride=s,h._reloadColorTheme())}_getTransitionParameters(t){return{now:r.q.now(),transition:r.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],s=[];for(const h of this._mergedOrder)this.isLayerDraped(this._mergedLayers[h])?t.push(h):s.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const h=this.terrain=new Ue(t,s,this.scope,this.options,this.map.getWorldview());s===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});h.updateTransitions(_)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,h,_,y={}){if(y&&y.validate===!1)return!1;const b=r.h({},this.serialize());return Ro(this,t.call(Fs,r.h({key:s,style:b,value:h,styleSpec:r.a5},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const s=this.getSourceCaches(t);for(const h of s)h.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const s=this.getSourceCaches(t);for(const h of s)h.resume(),h.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let s;this.directionalLight&&(s=xu(this.directionalLight));const h=new Set;for(const _ in this._mergedLayers){const y=this._mergedLayers[_];y.hasElevation()&&!h.has(y.source)&&h.add(y.source)}for(const _ in this._mergedSourceCaches){const y=this._mergedSourceCaches[_],b=h.has(y._source.id);y.update(t,void 0,void 0,s,b)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,h,_,y,b,C=!1){let I=!1,O=!1;const k={},U={};for(const V of this._mergedOrder){const H=this._mergedLayers[V];if(H.type!=="symbol")continue;const Q=r.C(H.source,H.scope);let X=k[Q];if(!X){const ne=this.getLayerSourceCache(H);if(!ne)continue;const oe=ne.getRenderableIds(!0).map(ve=>ne.getTileByID(ve));U[Q]=oe.slice(),X=k[Q]=oe.sort((ve,Se)=>Se.tileID.overscaledZ-ve.tileID.overscaledZ||(ve.tileID.isLessThan(Se.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer(H,X,s.center.lng,s.projection);I=I||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new r.A("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),s.zoom))&&(this.pauseablePlacement=new od(s,this._mergedOrder,C,h,_,y,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),O=!0),I&&this.pauseablePlacement.placement.setStale()),O||I){this._buildingIndex.onNewFrame(s.zoom);for(let V=0;V<this._mergedOrder.length;V++){const H=this._mergedLayers[this._mergedOrder[V]];if(H.type!=="symbol")continue;const Q=this.isLayerClipped(H);this.placement.updateLayerOpacities(H,k[r.C(H.source,H.scope)],V,Q?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,s){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:y})=>y===t.id)!==-1)return void this.fire(new r.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!s)return h.push(t),this._loadImports([t],!0);const _=h.findIndex(({id:y})=>y===s);return _===-1&&this.fire(new r.z(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=h.slice(0,_).concat(t).concat(h.slice(_)),this._loadImports([t],!0,s)}updateImport(t,s){this._checkLoaded();const h=this.stylesheet.imports||[],_=this.getImportIndex(t);return _===-1?this:typeof s=="string"?(this.setImportUrl(t,s),this):(s.url&&s.url!==h[_].url&&this.setImportUrl(t,s.url),r.bv(s.config,h[_].config)||this.setImportConfig(t,s.config,s.data.schema),r.bv(s.data,h[_].data)||this.setImportData(t,s.data),this)}moveImport(t,s){this._checkLoaded();let h=this.stylesheet.imports||[];const _=this.getImportIndex(t);if(_===-1)return this;const y=this.getImportIndex(s);if(y===-1)return this;const b=h[_],C=this.fragments[_];return h=h.filter(({id:I})=>I!==t),this.fragments=this.fragments.filter(({id:I})=>I!==t),this.stylesheet.imports=h.slice(0,y).concat(b).concat(h.slice(y)),this.fragments=this.fragments.slice(0,y).concat(C).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(t,s){this._checkLoaded();const h=this.stylesheet.imports||[],_=this.getImportIndex(t);if(_===-1)return this;h[_].url=s;const y=this.fragments[_];return y.style=this._createFragmentStyle(h[_]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(s),this}setImportData(t,s){this._checkLoaded();const h=this.getImportIndex(t),_=this.stylesheet.imports||[];return h===-1?this:s?(this.fragments[h].style.setState(s),this._reloadImports(),this):(delete _[h].data,this.setImportUrl(t,_[h].url))}setImportConfig(t,s,h){this._checkLoaded();const _=this.getImportIndex(t),y=this.stylesheet.imports||[];if(_===-1)return this;s?y[_].config=s:delete y[_].config;const b=this.fragments[_];h&&b.style.stylesheet&&(b.style.stylesheet.schema=h);const C=b.style.stylesheet&&b.style.stylesheet.schema;return b.config=s,b.style.updateConfig(s,C),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const s=this.stylesheet.imports||[],h=this.getImportIndex(t);h!==-1&&(s.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports())}getImportIndex(t){const s=(this.stylesheet.imports||[]).findIndex(h=>h.id===t);return s===-1&&this.fire(new r.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),s}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const s in this._mergedOtherSourceCaches){const h=this._mergedOtherSourceCaches[s];h&&t.push(h.getSource())}return t}getSource(t,s){const h=this.getSourceCache(t,s);return h&&h.getSource()}getLayerSource(t){const s=this.getLayerSourceCache(t);return s&&s.getSource()}getSourceCache(t,s){const h=r.C(t,s);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(t){const s=r.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[t]&&s.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&s.push(this._mergedSymbolSourceCaches[t]),s}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const s in t){const h=t[s];h==="reload"?this.reloadSource(s):h==="clear"&&this.clearSource(s)}}updateLayers(t){const s=this._changes.getUpdatedPaintProperties();for(const h of s){const _=this.getLayer(h);_&&_.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,s,h){this.imageManager.getImages(s.images,s.scope,h),this._updateTilesForChangedImages();const _=b=>{if(b){const C=s.images.map(I=>r.I.toString(I));b.setDependencies(s.tileID.key,s.type,C)}},y=r.C(s.source,s.scope);_(this._mergedOtherSourceCaches[y]),_(this._mergedSymbolSourceCaches[y])}rasterizeImages(t,s,h){this.imageManager.rasterizeImages(s,h)}getGlyphs(t,s,h){this.glyphManager.getGlyphs(s.stacks,s.scope,h)}getResource(t,s,h){return r.dg(s,h)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this.getOwnSourceCaches(t);return s.length===0?(this.fire(new r.z(new Error(`There is no source with ID '${t}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,s){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const h=t.type==="fill-extrusion"&&t.sourceLayer==="building",_=t.type==="building";if(t.is3D(!!this.terrain)){if(h||_||s&&s.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ca.getSourceType=function(u){return Pl[u]},ca.setSourceType=function(u,t){Pl[u]=t},ca.registerForPluginStateChange=r.dh;var oh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,wp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Tp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,lh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",wu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,_f=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ch=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ms=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,dd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Kt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,xo=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const gl=[];Do(oh,gl),Do(Tp,gl),Do(wp,gl);const Uc={"_prelude_fog.vertex.glsl":_f,"_prelude_terrain.vertex.glsl":wu,"_prelude_shadow.vertex.glsl":Kt,"_prelude_fog.fragment.glsl":ch,"_prelude_shadow.fragment.glsl":xo,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ms,"_prelude_raster_particle.glsl":dd},Gc={};mn("",wu),mn(ch,_f),mn(xo,Kt),mn(Ms,""),mn(dd,"");const Hc=mn(wp,Tp),Zo=oh;var _c={background:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:mn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:mn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:mn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:mn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:mn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:mn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:mn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:mn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:mn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:mn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:mn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:mn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:mn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:mn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:mn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:mn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:mn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:mn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,lh),skyboxGradient:mn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,lh),skyboxCapture:mn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:mn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:mn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:mn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:mn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:mn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:mn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:mn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:mn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Do(u,t){const s=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of s)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=h.split(" ");for(const y of _)t.includes(y)||t.push(y)}}function mn(u,t){const s=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(O=>{const k=O.split(" ");return k[k.length-1]}),_=[...new Set(_)]);const y={},b=[],C=[];if(u=u.replace(s,(O,k)=>(C.push(k),"")),(t=t.replace(s,(O,k)=>(b.push(k),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let I=[...gl];Do(u,I),Do(t,I);for(const O of[...b,...C])Uc[O]||console.error(`Undefined include: ${O}`),Gc[O]||(Gc[O]=[],Do(Uc[O],Gc[O])),I=[...I,...Gc[O]];return{fragmentSource:u=u.replace(h,(O,k,U,V,H)=>(y[H]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${U} ${V} ${H};
#else
uniform ${U} ${V} u_${H};
#endif
`:k==="initialize"?`
#ifdef HAS_UNIFORM_u_${H}
    ${U} ${V} ${H} = u_${H};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${U} ${V} ${H};
#endif
`:k==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(h,(O,k,U,V,H)=>{const Q=V==="float"?"vec2":V,X=H.match(/color/)?"color":Q;return k==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${H}
in ${U} ${V} a_${H};
#endif
`:y[H]?k==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${U} ${Q} a_${H};
out ${U} ${V} ${H};
#else
uniform ${U} ${V} u_${H};
#endif
`:k==="initialize"?X==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${U} ${V} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${X}(a_${H}, u_${H}_t);
#else
    ${U} ${V} ${H} = u_${H};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${U} ${V} a_${H};
    out ${U} ${V} ${H};
#endif
`:k==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${H} = a_${H};
#endif
`:void 0:k==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${U} ${Q} a_${H};
#else
uniform ${U} ${V} u_${H};
#endif
`:k==="define-instanced"?X==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${H}0;
in vec4 a_${H}1;
in vec4 a_${H}2;
in vec4 a_${H}3;
#else
uniform ${U} ${V} u_${H};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${Q} a_${H};
#else
uniform ${U} ${V} u_${H};
#endif
`:k==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${U} ${V} ${H} = a_${H};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${U} ${V} ${H} = a_${H};
#else
    ${U} ${V} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${U} ${V} ${H} = unpack_mix_${X}(a_${H}, u_${H}_t);
#else
    ${U} ${V} ${H} = u_${H};
#endif
`}),staticAttributes:_,usedDefines:I,vertexIncludes:b,fragmentIncludes:C}}class _l{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,s,h,_,y,b,C,I){this.context=t;let O=this.boundPaintVertexBuffers.length!==_.length;for(let U=0;!O&&U<_.length;U++)this.boundPaintVertexBuffers[U]!==_[U]&&(O=!0);let k=this.boundDynamicVertexBuffers.length!==C.length;for(let U=0;!k&&U<C.length;U++)this.boundDynamicVertexBuffers[U]!==C[U]&&(k=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==h||O||k||this.boundIndexBuffer!==y||this.boundVertexOffset!==b)this.freshBind(s,h,_,y,b,C,I);else{t.bindVertexArrayOES.set(this.vao);for(const U of C)U&&(U.bind(),I&&U.instanceCount&&U.setVertexAttribDivisor(t.gl,s,I));y&&y.dynamicDraw&&y.bind()}}freshBind(t,s,h,_,y,b,C){const I=t.numAttributes,O=this.context,k=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=b,s.enableAttributes(k,t),s.bind(),s.setVertexAttribPointers(k,t,y);for(const U of h)U.enableAttributes(k,t),U.bind(),U.setVertexAttribPointers(k,t,y);for(const U of b)U&&(U.enableAttributes(k,t),U.bind(),U.setVertexAttribPointers(k,t,y),C&&U.instanceCount&&U.setVertexAttribDivisor(k,t,C));_&&_.bind(),O.currentNumAttributes=I}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Vg(u,t){const s=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new r.ac(0,h/s).toLngLat().lat,new r.ac(0,(h+1)/s).toLngLat().lat]}function Po(u,t,s,h,_,y,b){const C=u.context,I=C.gl,O=s.hillshadeFBO;if(!O)return;u.prepareDrawTile();const k=u.isTileAffectedByFog(t),U=u.getOrCreateProgram("hillshade",{overrideFog:k});C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,O.colorAttachment.get());const V=((J,ne,oe,ve)=>{const Se=oe.paint.get("hillshade-shadow-color"),Le=oe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ie=oe.paint.get("hillshade-highlight-color"),Ce=oe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Ae=oe.paint.get("hillshade-accent-color"),Pe=oe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ne=oe.paint.get("hillshade-emissive-strength");let Ke=r.al(oe.paint.get("hillshade-illumination-direction"));if(oe.paint.get("hillshade-illumination-anchor")==="viewport")Ke-=J.transform.angle;else if(J.style&&J.style.enable3dLights()&&J.style.directionalLight){const mt=J.style.directionalLight.properties.get("direction"),xt=r.cR(mt.x,mt.y,mt.z);Ke=r.al(xt[1])}const Je=!J.options.moving;return{u_matrix:ve||J.transform.calculateProjMatrix(ne.tileID.toUnwrapped(),Je),u_image:0,u_latrange:Vg(0,ne.tileID),u_light:[oe.paint.get("hillshade-exaggeration"),Ke],u_shadow:Se.toPremultipliedRenderColor(Le?null:oe.lut),u_highlight:Ie.toPremultipliedRenderColor(Ce?null:oe.lut),u_emissive_strength:Ne,u_accent:Ae.toPremultipliedRenderColor(Pe?null:oe.lut)}})(u,s,h,u.terrain?t.projMatrix:null);u.uploadCommonUniforms(C,U,t.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:Q,tileBoundsSegments:X}=u.getTileBoundsBuffers(s);U.draw(u,I.TRIANGLES,_,y,b,Fi.disabled,V,h.id,H,Q,X)}function uh(u,t,s){if(!t.needsDEMTextureUpload)return;const h=u.context,_=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(s.stride);const y=s.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new r.T(h,y,_.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function yc(u,t,s){const h=u.context,_=h.gl;if(!t.dem)return;const y=t.dem;if(h.activeTexture.set(_.TEXTURE1),uh(u,t,y),!t.demTexture)return;t.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const b=y.dim;h.activeTexture.set(_.TEXTURE0);let C=t.hillshadeFBO;if(!C){const V=new r.T(h,{width:b,height:b,data:null},_.RGBA8);V.bind(_.LINEAR,_.CLAMP_TO_EDGE),C=t.hillshadeFBO=h.createFramebuffer(b,b,!0,"renderbuffer"),C.colorAttachment.set(V.texture)}h.bindFramebuffer.set(C.framebuffer),h.viewport.set([0,0,b,b]);const{tileBoundsBuffer:I,tileBoundsIndexBuffer:O,tileBoundsSegments:k}=u.getMercatorTileBoundsBuffers(),U=[];u.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(u,_.TRIANGLES,yi.disabled,qi.disabled,cn.unblended,Fi.disabled,((V,H)=>{const Q=H.stride,X=r.bz();return r.c5(X,0,r.aj,-8192,0,0,1),r.bo(X,X,[0,-8192,0]),{u_matrix:X,u_image:1,u_dimension:[Q,Q],u_zoom:V.overscaledZ}})(t.tileID,y),s.id,I,O,k),t.needsHillshadePrepare=!1}class Dr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fd extends Dr{getDefault(){return r.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class vc extends Dr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Sp extends Dr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ep extends Dr{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hh extends Dr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class dh extends Dr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class pd extends Dr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class yf extends Dr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ao extends Dr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Wo extends Dr{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class qc extends Dr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class yl extends Dr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Xo extends Dr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class xc extends Dr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class $c extends Dr{getDefault(){return r.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Zc extends Dr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class fh extends Dr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class ua extends Dr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class os extends Dr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let jr=class extends Dr{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class bc extends Dr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class vl extends Dr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Wc extends Dr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class kl extends Dr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class md extends Dr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class vf extends Dr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Xc extends Dr{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class wc extends Dr{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Ap extends Dr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ph extends Dr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class xf extends Dr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class bo extends Dr{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Nl extends bo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Tc extends bo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Sc extends bo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Cp extends Tc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const gd=(u,t,s)=>({u_matrix:u,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:s}),Yc=(u,t,s,h,_,y,b,C,I,O,k,U,V,H,Q,X)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:s,u_zoom_transition:_,u_merc_center:y,u_image0:0,u_frustum_tl:b,u_frustum_tr:C,u_frustum_br:I,u_frustum_bl:O,u_globe_pos:k,u_globe_radius:U,u_viewport:V,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:H,u_far_z_cutoff:Q});function Tu(u,t){return u!=null&&t!=null&&!(!u.hasData()||!t.hasData())&&u.demTexture!=null&&t.demTexture!=null&&u.tileID.key!==t.tileID.key}const wo=new class{constructor(){this.operations={}}newMorphing(u,t,s,h,_){if(u in this.operations){const y=this.operations[u];y.to.tileID.key!==s.tileID.key&&(y.queued=s)}else this.operations[u]={startTime:h,phase:0,duration:_,from:t,to:s,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const s=this.operations[t];for(s.phase=(u-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},ha={0:null,1:"TERRAIN_VERTEX_MORPHING"};function mh(u,t,s){if(t===0)return 0;const h=t<1&&s===514?.25/t:1;return 6*Math.pow(1.5,22-u)*Math.max(t,1)*h}function Rm(u,t){const s=1<<u.z;return!t&&(u.x===0||u.x===s-1)||u.y===0||u.y===s-1}const Su=u=>({u_matrix:u});function Eu(u,t,s,h,_){if(_>0){const y=r.q.now(),b=(y-u.timeAdded)/_,C=t?(y-t.timeAdded)/_:-1,I=s.getSource(),O=h.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),k=!t||Math.abs(t.tileID.overscaledZ-O)>Math.abs(u.tileID.overscaledZ-O),U=k&&u.refreshedUponExpiration?1:r.ay(k?b:1-C,0,1);return u.refreshedUponExpiration&&b>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class Dm extends Ht{constructor(t){const s={type:"raster-dem",maxzoom:t.transform.maxZoom},h=new r.D(r.c$(),null),_=fl("mock-dem",s,h,t.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class Gr extends Ht{constructor(t){const s=fl("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new r.D(r.c$(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,h){if(t.freezeTileCoverage)return;this.transform=t;const _=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,b)=>{if(y[b.key]="",!this._tiles[b.key]){const C=new Va(b,this._source.tileSize*b.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);C.state="loaded",this._tiles[b.key]=C}return y},{});for(const y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class gh extends r.aM{constructor(t,s,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class Ec extends r.dt{constructor(t,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,_,y]=function(I){const O=new r.ba,k=new r.a_,U=131;O.reserve(17161),k.reserve(33800);const V=r.aj/128,H=r.aj+V/2,Q=H+V;for(let J=-64;J<Q;J+=V)for(let ne=-64;ne<Q;ne+=V){const oe=ne<0||ne>H||J<0||J>H?24575:0,ve=r.ay(Math.round(ne),0,r.aj),Se=r.ay(Math.round(J),0,r.aj);O.emplaceBack(ve+oe,Se)}const X=(J,ne)=>{const oe=ne*U+J;k.emplaceBack(oe+1,oe,oe+U),k.emplaceBack(oe+U,oe+U+1,oe+1)};for(let J=1;J<129;J++)for(let ne=1;ne<129;ne++)X(ne,J);return[0,129].forEach(J=>{for(let ne=0;ne<130;ne++)X(ne,J),X(J,ne)}),[O,k,32768]}(),b=t.context;this.gridBuffer=b.createVertexBuffer(h,r.bc.members),this.gridIndexBuffer=b.createIndexBuffer(_),this.gridSegments=r.bd.simpleSegment(0,0,h.length,_.length),this.gridNoSkirtSegments=r.bd.simpleSegment(0,0,h.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Gr(s.map),this.orthoMatrix=r.bz(),r.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.aj,0,r.aj,0,1);const C=b.gl;this._overlapStencilMode=new qi({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Dm(s.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,s,h){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const _=t.terrain.properties,y=t.terrain.drapeRenderMode===0,b=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const C=t.terrain&&t.terrain.scope,I=_.get("source"),O=y?this._mockSourceCache:t.getSourceCache(I,C);if(!O)return void r.w(`Couldn't find terrain source "${I}".`);if(this.sourceCache=O,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(s):_.get("exaggeration"),!s.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;const k=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(s,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),s.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const s=this._previousCameraAltitude,h=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=h;const _=s!=null?h-s:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const y=t.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(y);let C=y-this._previousZoom;const I=this._previousUpdateTimestamp;let O=y;this._evaluationZoom!=null&&(O=this._evaluationZoom,Math.abs(y-O)>.5&&(C=.5*(y-O+C)),C*_<0&&(O+=C)),this._evaluationZoom=O;const k=b.getExaggeration(O),U=k===b.getExaggeration(Math.max(0,O-.1));if(U&&Math.abs(k-this._exaggeration)<.01)return k;let V=Math.min(.1,.00375*(this._updateTimestamp-I));return(U||k<.1||Math.abs(C)<1e-4)&&(V=Math.min(.2,4*V)),r.ai(this._exaggeration,k,V)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(r.ac.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=s.getIds().map(I=>{const O=s.getTileByID(I).tileID;return O.projMatrix=h.calculateProjMatrix(O.toUnwrapped()),O});(function(I,O){const k=O.transform.pointCoordinate(O.transform.getCameraPoint()),U=new r.P(k.x,k.y);I.sort((V,H)=>{if(H.overscaledZ-V.overscaledZ)return H.overscaledZ-V.overscaledZ;const Q=new r.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),X=new r.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),J=U.mult(1<<V.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(Q)-J.distSqr(X)})})(_,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},_.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const I in b){const O=b[I];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,t[I],y),O.usedForTerrain))continue;const k=t[I];O.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[s.id]=_.map(I=>new gh(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const O=this.terrainTileForTile[I.key];if(!O)continue;const k=O.tileID.key;k in C||(this._visibleDemTiles.push(O),C[k]=k)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const h in this.terrainTileForTile){const _=this.terrainTileForTile[h],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),uh(this.painter,_,y))}}_prepareDemTileUniforms(t,s,h,_){if(!s||s.demTexture==null)return!1;const y=t.tileID.canonical,b=Math.pow(2,s.tileID.canonical.z-y.z),C=_||"";return h[`u_dem_tl${C}`]=[y.x*b%1,y.y*b%1],h[`u_dem_scale${C}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const s=this._visibleDemTiles.reduce((h,_)=>{if(!_.dem)return h;const y=_.dem.tree.minimums[0];return y>0&&t++,h+y},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),_=new r.du({width:1,height:1},new Float32Array([h]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(_,{premultiply:!1}):y=this._emptyDEMTexture=new r.T(t,_,s.R32F,{premultiply:!1}),y}setupElevationDraw(t,s,h){const _=this.painter.context,y=_.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let C=null,I=null,O=1;if(h&&h.morphing&&this._useVertexMorphing){const H=h.morphing.srcDemTile,Q=h.morphing.dstDemTile;O=h.morphing.phase,H&&Q&&(this._prepareDemTileUniforms(t,H,b,"_prev")&&(I=H),this._prepareDemTileUniforms(t,Q,b)&&(C=Q))}const k=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST;let U=null;var V;if(this.enabled?I&&C?(U=C.demTexture,_.activeTexture.set(y.TEXTURE4),I.demTexture.bind(k(I),y.CLAMP_TO_EDGE),b.u_dem_lerp=O):(C=this.terrainTileForTile[t.tileID.key],U=this._prepareDemTileUniforms(t,C,b)?C.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,_.activeTexture.set(y.TEXTURE2),U&&(b.u_dem_size=(V=U).size[0]===1?1:V.size[0]-2,U.bind(k(C),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(h&&h.useDepthForOcclusion,s,b),h&&h.useMeterToDem&&C){const H=(1<<C.tileID.canonical.z)*r.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=H}if(h&&h.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(_,b),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,t.tileID.canonical,h&&h.useDenormalizedUpVectorScale);s.setGlobeUniformValues(_,H)}}globeUniformValues(t,s,h){const _=t.projection;return{u_tile_tl_up:_.upVector(s,0,0),u_tile_tr_up:_.upVector(s,r.aj,0),u_tile_br_up:_.upVector(s,r.aj,r.aj),u_tile_bl_up:_.upVector(s,0,r.aj),u_tile_up_scale:h?r.dv(1):_.upVectorScale(s,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const s=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,y,b,C,I){if(_.transform.projection.name==="globe")(function(O,k,U,V,H){const Q=O.context,X=Q.gl;let J,ne;const oe=O.transform,ve=r.dl(O,Q,oe),Se=(mt,xt)=>{if(ne===xt)return;const Pt=[ha[xt],"PROJECTION_GLOBE_VIEW"];ve&&Pt.push("CUSTOM_ANTIALIASING");const Ze=O.isTileAffectedByFog(mt);J=O.getOrCreateProgram("globeRaster",{defines:Pt,overrideFog:Ze}),ne=xt},Le=O.colorModeForRenderPass(),Ie=new yi(X.LEQUAL,yi.ReadWrite,O.depthRangeFor3D);wo.update(H);const Ce=r.dm(oe),Ae=[r.aD(oe.center.lng),r.aH(oe.center.lat)],Pe=O.globeSharedBuffers,Ne=[oe.width*r.q.devicePixelRatio,oe.height*r.q.devicePixelRatio],Ke=Float32Array.from(oe.globeMatrix),Je={useDenormalizedUpVectorScale:!0};{const mt=O.transform,xt=mh(mt.zoom,k.exaggeration(),k.sourceCache._source.tileSize);ne=-1;const Pt=X.TRIANGLES;for(const Ze of V){const lt=U.getTile(Ze),Ge=qi.disabled,bt=k.prevTerrainTileForTile[Ze.key],st=k.terrainTileForTile[Ze.key];Tu(bt,st)&&wo.newMorphing(Ze.key,bt,st,H,250),Q.activeTexture.set(X.TEXTURE0),lt.texture&&lt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const Ct=wo.getMorphValuesForProxy(Ze.key),Wt=Ct?1:0;Ct&&r.L(Je,{morphing:{srcDemTile:Ct.from,dstDemTile:Ct.to,phase:r.dk(Ct.phase)}});const wt=r.dn(Ze.canonical),Vt=r.dp(wt.getCenter().lat),gi=r.dq(Ze.canonical,wt,Vt,mt.worldSize/mt._pixelsPerMercatorPixel),di=r.bh(r.dr(Ze.canonical)),hi=Yc(mt.expandedFarZProjMatrix,Ke,Ce,di,r.ah(mt.zoom),Ae,mt.frustumCorners.TL,mt.frustumCorners.TR,mt.frustumCorners.BR,mt.frustumCorners.BL,mt.globeCenterInViewSpace,mt.globeRadius,Ne,xt,mt._farZ,gi);if(Se(Ze,Wt),J&&(k.setupElevationDraw(lt,J,Je),O.uploadCommonUniforms(Q,J,Ze.toUnwrapped()),Pe)){const[Ai,Pi,fi]=Pe.getGridBuffers(Vt,xt!==0);J.draw(O,Pt,Ie,Ge,Le,Fi.backCCW,hi,"globe_raster",Ai,Pi,fi)}}}if(Pe&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){const mt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ve&&mt.push("CUSTOM_ANTIALIASING"),J=O.getOrCreateProgram("globeRaster",{defines:mt});for(const xt of V){const{x:Pt,y:Ze,z:lt}=xt.canonical,Ge=Ze===0,bt=Ze===(1<<lt)-1,[st,Ct,Wt,wt]=Pe.getPoleBuffers(lt,!1);if(wt&&(Ge||bt)){const Vt=U.getTile(xt);Q.activeTexture.set(X.TEXTURE0),Vt.texture&&Vt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let gi=r.ds(lt,Pt,oe);const di=r.bh(r.dr(xt.canonical)),hi=(Ai,Pi)=>Ai.draw(O,X.TRIANGLES,Ie,qi.disabled,Le,Fi.disabled,Yc(oe.expandedFarZProjMatrix,gi,gi,di,0,Ae,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,Ne,0,oe._farZ),"globe_pole_raster",Pi,Wt,wt);k.setupElevationDraw(Vt,J,Je),O.uploadCommonUniforms(Q,J,xt.toUnwrapped()),Ge&&O.renderDefaultNorthPole&&hi(J,st),bt&&O.renderDefaultSouthPole&&(gi=r.cE(r.bz(),gi,[1,-1,1]),hi(J,Ct))}}}})(_,y,b,C,I);else{const O=_.context,k=O.gl;let U,V;const H=_.shadowRenderer,Q=zl(_,_.longestCutoffRange),X=Le=>{if(V===Le)return;const Ie=[];Ie.push(ha[Le]),Q.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF"),H&&(Ie.push("RENDER_SHADOWS","DEPTH_TEXTURE"),H.useNormalOffset&&Ie.push("NORMAL_OFFSET")),U=_.getOrCreateProgram("terrainRaster",{defines:Ie}),V=Le},J=_.colorModeForRenderPass(),ne=new yi(k.LEQUAL,yi.ReadWrite,_.depthRangeFor3D);wo.update(I);const oe=_.transform,ve=mh(oe.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let Se=[0,0,0];if(H){const Le=_.style.directionalLight,Ie=_.style.ambientLight;Le&&Ie&&(Se=jc(_.style,Le,Ie))}{V=-1;const Le=k.TRIANGLES,[Ie,Ce]=[y.gridIndexBuffer,y.gridSegments];for(const Ae of C){const Pe=b.getTile(Ae),Ne=qi.disabled,Ke=y.prevTerrainTileForTile[Ae.key],Je=y.terrainTileForTile[Ae.key];Tu(Ke,Je)&&wo.newMorphing(Ae.key,Ke,Je,I,250),O.activeTexture.set(k.TEXTURE0),Pe.texture&&Pe.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const mt=wo.getMorphValuesForProxy(Ae.key),xt=mt?1:0;let Pt;mt&&(Pt={morphing:{srcDemTile:mt.from,dstDemTile:mt.to,phase:r.dk(mt.phase)}});const Ze=gd(Ae.projMatrix,Rm(Ae.canonical,oe.renderWorldCopies)?ve/10:ve,Se);if(X(xt),!U)continue;y.setupElevationDraw(Pe,U,Pt);const lt=Ae.toUnwrapped();H&&H.setupShadows(lt,U),_.uploadCommonUniforms(O,U,lt,null,Q),U.draw(_,Le,ne,Ne,J,Fi.backCCW,Ze,"terrain_raster",y.gridBuffer,Ie,Ce)}}}}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],b=this._drapedRenderBatches.shift(),C=s.style.order,I=[];let O=0;for(const k of y){const U=_.getTileByID(k.proxyTileKey),V=_.proxyCachedFBO[k.key]?_.proxyCachedFBO[k.key][t]:void 0,H=V!==void 0?_.renderCache[V]:this.pool[O++],Q=V!==void 0;if(U.texture=H.tex,Q&&!H.dirty){I.push(U.tileID);continue}let X;h.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(h.clear({color:r.am.transparent,stencil:0}),H.dirty=!1);for(let J=b.start;J<=b.end;++J){const ne=s.style._mergedLayers[C[J]];if(ne.isHidden(s.transform.zoom))continue;const oe=s.style.getLayerSourceCache(ne),ve=oe?this.proxyToSource[k.key][oe.id]:[k];if(!ve)continue;const Se=ve;h.viewport.set([0,0,H.fb.width,H.fb.height]),X!==(oe?oe.id:null)&&(this._setupStencil(H,ve,ne,oe),X=oe?oe.id:null),s.renderLayer(s,oe,ne,Se)}if(this._drapedRenderBatches.length===0)for(const J of this._pendingGroundEffectLayers){const ne=s.style._mergedLayers[C[J]];if(ne.isHidden(s.transform.zoom))continue;const oe=s.style.getLayerSourceCache(ne),ve=oe?this.proxyToSource[k.key][oe.id]:[k];if(!ve)continue;const Se=ve;h.viewport.set([0,0,H.fb.width,H.fb.height]),X!==(oe?oe.id:null)&&(this._setupStencil(H,ve,ne,oe),X=oe?oe.id:null),s.renderLayer(s,oe,ne,Se)}this.renderedToTile?(H.dirty=!0,I.push(U.tileID)):Q||--O,O===5&&(O=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),b.end+1}postRender(){}isLayerOrderingCorrect(t){const s=t.order.length;let h=-1,_=s;for(let y=0;y<s;++y)this._style.isLayerDraped(t._mergedLayers[t.order[y]])?h=Math.max(h,y):_=Math.min(_,y);return _>h}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,h){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const b=y.tileID,C=1<<b.overscaledZ,{x:I,y:O}=b.canonical,k=I/C,U=(I+1)/C,V=O/C,H=(O+1)/C;return{minx:k,miny:V,maxx:U,maxy:H,t:y.dem.tree.raycastRoot(k,V,U,H,t,s,h),tile:y}});_.sort((y,b)=>(y.t!==null?y.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const y of _){if(y.t==null)return null;const b=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,s,h);if(b!=null)return b}return null}_createFBO(){const t=this.painter.context,s=t.gl,h=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const _=new r.T(t,{width:h[0],height:h[1],data:null},s.RGBA8);_.bind(s.LINEAR,s.CLAMP_TO_EDGE);const y=t.createFramebuffer(h[0],h[1],!0,null);return y.colorAttachment.set(_.texture),y.depthAttachment=new Cp(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._mergedLayers[t],h=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!h&&s.shouldRedrape():!h&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const h of this._style.getSources())if(h instanceof Ba){t=!0;break}if(!t)return;const s={};for(let h=0;h<this._style.order.length;++h){const _=this._style._mergedLayers[this._style.order[h]],y=this._style.getLayerSourceCache(_);if(y&&!s[y.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof r.ab){s[y.id]=!0;for(const b of this.proxyCoords){const C=this.proxyToSource[b.key][y.id];if(C)for(const I of C)this._clearRenderCacheForTile(y.id,I)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof hs){t=!0;break}if(!t)return;const s={};for(let h=0;h<this._style.order.length;++h){const _=this._style._mergedLayers[this._style.order[h]],y=this._style.getLayerSourceCache(_);if(!y||s[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const b=_.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const I=this.proxyToSource[C.key][y.id];if(I)for(const O of I){const k=Eu(y.getTile(O),y.findLoadedParent(O,0),y,this.painter.transform,b);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(y.id,O)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,s=t.length;if(s===0)return;const h=[];this._pendingGroundEffectLayers=[];let _,y=0,b=this._style._mergedLayers[t[y]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++y<s;)b=this._style._mergedLayers[t[y]];for(;y<s;++y){const C=this._style._mergedLayers[t[y]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?_===void 0&&(_=y):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),_!==void 0&&(h.push({start:_,end:y-1}),_=void 0)))}if(_!==void 0&&h.push({start:_,end:y-1}),h.length!==0){const C=h[h.length-1];this._pendingGroundEffectLayers.every(I=>I>C.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const b=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let C=0;C<b.length;++C){const I=Object.values(b[C]);s.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,_=this._tilesDirty;for(let b=h.length-1;b>=0;b--){const C=h[b];if(s.getTileByID(C.key),s.proxyCachedFBO[C.key]!==void 0){const I=t[C.key],O=this.proxyToSource[C.key];let k=0;for(const U in O){const V=O[U],H=I[U];if(!H||H.length!==V.length||V.some((Q,X)=>Q!==H[X]||_[U]&&_[U].hasOwnProperty(Q.key))){k=-1;break}++k}for(const U in s.proxyCachedFBO[C.key])s.renderCache[s.proxyCachedFBO[C.key][U]].dirty=k<0||k!==Object.values(I).length}}const y=[...this._drapedRenderBatches];y.sort((b,C)=>C.end-C.start-(b.end-b.start));for(const b of y)for(const C of h){if(s.proxyCachedFBO[C.key])continue;let I=s.renderCachePool.pop();I===void 0&&s.renderCache.length<50&&(I=s.renderCache.length,s.renderCache.push(this._createFBO())),I!==void 0&&(s.proxyCachedFBO[C.key]={},s.proxyCachedFBO[C.key][b.start]=I,s.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,h,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,b=y.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let C;if(h.isTileClipped())C=s.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):qi.disabled}_renderTileClippingMasks(t,s){const h=this.painter,_=this.painter.context,y=_.gl;h._tileClippingMaskIDs={},_.setColorMode(cn.disabled),_.setDepthMode(yi.disabled);const b=h.getOrCreateProgram("clippingMask");for(const C of t){const I=h._tileClippingMaskIDs[C.key]=--s;b.draw(h,y.TRIANGLES,yi.disabled,new qi({func:y.ALWAYS,mask:0},I,255,y.KEEP,y.KEEP,y.REPLACE),cn.disabled,Fi.disabled,Su(C.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const h=[t.x,t.y,1,1];r.aA(h,h,s.pixelMatrixInverse),r.cw(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const _=s._camera.position,y=r.c6(1,s.center.lat),b=[_[0],_[1],_[2]/y,0],C=r.cX([],h.slice(0,3),b);r.au(C,C);const I=this.raycast(b,C,this._exaggeration);return I!==null&&I?(r.bE(b,b,C,I),b[3]=b[2],b[2]*=y,b):null}_setupProxiedCoordsForOrtho(t,s,h){if(t.getSource()instanceof r.aP)return this._setupProxiedCoordsForImageSource(t,s,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const _=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let I=0;I<y.length;I++){const O=y[I],k=this._findTileCoveringTileID(O,t);if(k){const U=this._createProxiedId(O,k,h[O.key]&&h[O.key][t.id]);_.push(U),this.proxyToSource[O.key][t.id]=[U]}}let b=!1;const C=new Set;for(let I=0;I<s.length;I++){const O=t.getTile(s[I]);if(!O||!O.hasData())continue;const k=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==O.tileID.canonical.z){const U=this.proxyToSource[k.tileID.key][t.id],V=this._createProxiedId(k.tileID,O,h[k.tileID.key]&&h[k.tileID.key][t.id]);U?U.splice(U.length-1,0,V):this.proxyToSource[k.tileID.key][t.id]=[V];const H=this.proxyToSource[k.tileID.key][t.id];C.has(H)||C.add(H),_.push(V),b=!0}}if(this._sourceTilesOverlap[t.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const I of C)I.sort((O,k)=>k.overscaledZ-O.overscaledZ)}_setupProxiedCoordsForImageSource(t,s,h){if(!t.getSource().loaded())return;const _=this.proxiedCoords[t.id]=[],y=this.proxyCoords,b=t.getSource(),C=b.tileID;if(!C)return;const I=new r.P(C.x,C.y)._div(1<<C.z),O=b.coordinates.map(r.ac.fromLngLat).reduce((U,V)=>(U.min.x=Math.min(U.min.x,V.x-I.x),U.min.y=Math.min(U.min.y,V.y-I.y),U.max.x=Math.max(U.max.x,V.x-I.x),U.max.y=Math.max(U.max.y,V.y-I.y),U),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(U,V)=>{const H=U.wrap+U.canonical.x/(1<<U.canonical.z),Q=U.canonical.y/(1<<U.canonical.z),X=r.aj/(1<<U.canonical.z),J=V.wrap+V.canonical.x/(1<<V.canonical.z),ne=V.canonical.y/(1<<V.canonical.z);return H+X<J+O.min.x||H>J+O.max.x||Q+X<ne+O.min.y||Q>ne+O.max.y};for(let U=0;U<y.length;U++){const V=y[U];for(let H=0;H<s.length;H++){const Q=t.getTile(s[H]);if(!Q||!Q.hasData()||k(V,Q.tileID))continue;const X=this._createProxiedId(V,Q,h[V.key]&&h[V.key][t.id]),J=this.proxyToSource[V.key][t.id];J?J.push(X):this.proxyToSource[V.key][t.id]=[X],_.push(X)}}}_createProxiedId(t,s,h){let _=this.orthoMatrix;if(h){const y=h.find(b=>b.key===s.tileID.key);if(y)return y}if(s.tileID.key!==t.key){const y=t.canonical.z-s.tileID.canonical.z;let b,C,I;_=r.bz();const O=s.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(b=r.aj>>y,C=b*((s.tileID.canonical.x<<y)-t.canonical.x+O),I=b*((s.tileID.canonical.y<<y)-t.canonical.y)):(b=r.aj<<-y,C=r.aj*(s.tileID.canonical.x-(t.canonical.x+O<<-y)),I=r.aj*(s.tileID.canonical.y-(t.canonical.y<<-y))),r.c5(_,0,b,0,b,0,1),r.bo(_,_,[C,I,0])}return new gh(s.tileID,t.key,_)}_findTileCoveringTileID(t,s){let h=s.getTile(t);if(h&&h.hasData())return h;const _=this._findCoveringTileCache[s.id],y=_[t.key];if(h=y?s.getTileByID(y):null,h&&h.hasData()||y===null)return h;let b=h?h.tileID:t,C=b.overscaledZ;const I=s.getSource().minzoom,O=[];if(!y){const U=s.getSource().maxzoom;if(t.canonical.z>=U){const V=t.canonical.z-U;s.getSource().reparseOverscaled?(C=Math.max(t.canonical.z+2,s.transform.tileZoom),b=new r.aM(C,t.wrap,U,t.canonical.x>>V,t.canonical.y>>V)):V!==0&&(C=U,b=new r.aM(C,t.wrap,U,t.canonical.x>>V,t.canonical.y>>V))}b.key!==t.key&&(O.push(b.key),h=s.getTile(b))}const k=U=>{O.forEach(V=>{_[V]=U}),O.length=0};for(C-=1;C>=I&&(!h||!h.hasData());C--){h&&k(h.tileID.key);const U=b.calculateScaledKey(C);if(h=s.getTileByID(U),h&&h.hasData())break;const V=_[U];if(V===null)break;V===void 0?O.push(U):h=s.getTileByID(V)}return k(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[s.key]=!0}}function Kc(u,t,s){const h=function(C,I,O){const k=r.bG(I,C),U=r.bG(O,[.2126,.7152,.0722]),V=(Q,X,J)=>(1-J)*Q+J*X,H=V(1-.3*Math.min(U,1),1,Math.min(k+1,1));return V(.92,1,Math.asin(r.ay(I[2],-1,1))/Math.PI+.5)*H}(u,[0,0,1],t),_=[0,0,0];r.bY(_,s.slice(0,3),h);const y=[0,0,0];r.bY(y,t.slice(0,3),u[2]);const b=[0,0,0];return r.cV(b,_,y),r.cY(b)}const _d=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Qc=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Ac{static cacheKey(t,s,h,_){let y=`${s}${_?_.cacheKey:""}`;for(const b of h)t.usedDefines.includes(b)&&(y+=`/${b}`);return y}constructor(t,s,h,_,y,b){const C=t.gl;this.program=C.createProgram(),this.configuration=_,this.name=s,this.fixedDefines=[...b];const I=_?_.getBinderAttributes():[],O=(h.staticAttributes||[]).concat(I);let k=_?_.defines():[];k=k.concat(b.map(J=>`#define ${J}`));const U=`#version 300 es
`;let V=U+k.concat("precision mediump float;",Zo,Hc.fragmentSource).join(`
`);for(const J of h.fragmentIncludes)V+=`
${Uc[J]}`;V+=`
${h.fragmentSource}`;let H=U+k.concat("precision highp float;",Zo,Hc.vertexSource).join(`
`);for(const J of h.vertexIncludes)H+=`
${Uc[J]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&h.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(H+=`
uniform int u_instanceID;
`),H+=`
${h.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(H=H.replaceAll("gl_InstanceID","u_instanceID"));const Q=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Q,V),C.compileShader(Q),C.attachShader(this.program,Q);const X=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(X,H),C.compileShader(X),C.attachShader(this.program,X),this.attributes={},this.numAttributes=O.length;for(let J=0;J<this.numAttributes;J++)if(O[J]){const ne=O[J].startsWith("a_")?O[J]:`a_${O[J]}`;C.bindAttribLocation(this.program,J,ne),this.attributes[ne]=J}C.linkProgram(this.program),C.deleteShader(X),C.deleteShader(Q),this.fixedUniforms=y(t),this.binderUniforms=_?_.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(J=>({u_instanceID:new r.c8(J)}))(t)),(b.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(J=>({u_dem:new r.c8(J),u_dem_prev:new r.c8(J),u_dem_tl:new r.cb(J),u_dem_scale:new r.ca(J),u_dem_tl_prev:new r.cb(J),u_dem_scale_prev:new r.ca(J),u_dem_size:new r.ca(J),u_dem_lerp:new r.ca(J),u_exaggeration:new r.ca(J),u_depth:new r.c8(J),u_depth_size_inv:new r.cb(J),u_depth_range_unpack:new r.cb(J),u_occluder_half_size:new r.ca(J),u_occlusion_depth_offset:new r.ca(J),u_meter_to_dem:new r.ca(J),u_label_plane_matrix_inv:new r.cc(J)}))(t)),b.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new r.c9(J),u_tile_tr_up:new r.c9(J),u_tile_br_up:new r.c9(J),u_tile_bl_up:new r.c9(J),u_tile_up_scale:new r.ca(J)}))(t)),b.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new r.cc(J),u_fog_range:new r.cb(J),u_fog_color:new r.cQ(J),u_fog_horizon_blend:new r.ca(J),u_fog_vertical_limit:new r.cb(J),u_fog_temporal_offset:new r.ca(J),u_frustum_tl:new r.c9(J),u_frustum_tr:new r.c9(J),u_frustum_br:new r.c9(J),u_frustum_bl:new r.c9(J),u_globe_pos:new r.c9(J),u_globe_radius:new r.ca(J),u_globe_transition:new r.ca(J),u_is_globe:new r.c8(J),u_viewport:new r.cb(J)}))(t)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(J=>({u_cutoff_params:new r.cQ(J)}))(t)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(J=>({u_lighting_ambient_color:new r.c9(J),u_lighting_directional_dir:new r.c9(J),u_lighting_directional_color:new r.c9(J),u_ground_radiance:new r.c9(J)}))(t)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(J=>({u_light_matrix_0:new r.cc(J),u_light_matrix_1:new r.cc(J),u_fade_range:new r.cb(J),u_shadow_normal_offset:new r.c9(J),u_shadow_intensity:new r.ca(J),u_shadow_texel_size:new r.ca(J),u_shadow_map_resolution:new r.ca(J),u_shadow_direction:new r.c9(J),u_shadow_bias:new r.c9(J),u_shadowmap_0:new r.c8(J),u_shadowmap_1:new r.c8(J)}))(t))}}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)h[_]&&h[_].set(this.program,_,s[_])}}setGlobeUniformValues(t,s){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)h[_]&&h[_].set(this.program,_,s[_])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)h[_].set(this.program,_,s[_])}}setCutoffUniformValues(t,s){if(!this.cutoffUniforms)return;const h=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)h[_].set(this.program,_,s[_])}}setLightsUniformValues(t,s){if(!this.lightsUniforms)return;const h=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)h[_].set(this.program,_,s[_])}}setShadowUniformValues(t,s){if(this.failedToCreate||!this.shadowUniforms)return;const h=this.shadowUniforms;t.program.set(this.program);for(const _ in s)h[_].set(this.program,_,s[_])}_drawDebugWireframe(t,s,h,_,y,b,C,I,O,k){const U=t.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const V=t.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||t._terrain&&t._terrain.renderingToTexture||!_d.includes(this.name))||!(!U.layers3D||!Qc.includes(this.name))))return;const H=V.gl,Q=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,y,V);if(!Q)return;const X=[...this.fixedDefines];X.push("DEBUG_WIREFRAME");const J=t.getOrCreateProgram(this.name,{config:this.configuration,defines:X});V.program.set(J.program);const ne=(Se,Le,Ie)=>{if(Le[Se]&&Ie[Se])for(const Ce in Le[Se])Ie[Se][Ce]&&Ie[Se][Ce].set(Ie.program,Ce,Le[Se][Ce].current)};O&&O.setUniforms(J.program,V,J.binderUniforms,C,{zoom:I}),ne("fixedUniforms",this,J),ne("terrainUniforms",this,J),ne("globeUniforms",this,J),ne("fogUniforms",this,J),ne("lightsUniforms",this,J),ne("shadowUniforms",this,J),Q.bind(),V.setColorMode(new cn([H.ONE,H.ONE_MINUS_SRC_ALPHA,H.ZERO,H.ONE],r.am.transparent,[!0,!0,!0,!1])),V.setDepthMode(new yi(s.func===H.LESS?H.LEQUAL:s.func,yi.ReadOnly,s.range)),V.setStencilMode(qi.disabled);const oe=3*b.primitiveLength*2,ve=3*b.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Se=k||1;for(let Le=0;Le<Se;++Le)J.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Le),H.drawElements(H.LINES,oe,H.UNSIGNED_SHORT,ve)}else k&&k>1?H.drawElementsInstanced(H.LINES,oe,H.UNSIGNED_SHORT,ve,k):H.drawElements(H.LINES,oe,H.UNSIGNED_SHORT,ve);y.bind(),V.program.set(this.program),V.setDepthMode(s),V.setStencilMode(h),V.setColorMode(_)}checkUniforms(t,s,h){if(this.fixedDefines.includes(s)){for(const _ of Object.keys(h))if(!h[_].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${_} not set but required by ${s} being defined`)}}draw(t,s,h,_,y,b,C,I,O,k,U,V,H,Q,X,J){const ne=t.context,oe=ne.gl;if(this.failedToCreate)return;ne.program.set(this.program),ne.setDepthMode(h),ne.setStencilMode(_),ne.setColorMode(y),ne.setCullFace(b);for(const Le of Object.keys(this.fixedUniforms))this.fixedUniforms[Le].set(this.program,Le,C[Le]);Q&&Q.setUniforms(this.program,ne,this.binderUniforms,V,{zoom:H});const ve={[oe.POINTS]:1,[oe.LINES]:2,[oe.TRIANGLES]:3,[oe.LINE_STRIP]:1}[s];this.checkUniforms(I,"RENDER_SHADOWS",this.shadowUniforms);const Se=J&&J>0?1:void 0;for(const Le of U.get()){const Ie=Le.vaos||(Le.vaos={});if((Ie[I]||(Ie[I]=new _l)).bind(ne,this,O,Q?Q.getPaintVertexBuffers():[],k,Le.vertexOffset,X||[],Se),this.forceManualRenderingForInstanceIDShaders){const Ce=J||1;for(let Ae=0;Ae<Ce;++Ae)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ae),k?oe.drawElements(s,Le.primitiveLength*ve,oe.UNSIGNED_SHORT,Le.primitiveOffset*ve*2):oe.drawArrays(s,Le.vertexOffset,Le.vertexLength)}else J&&J>1?oe.drawElementsInstanced(s,Le.primitiveLength*ve,oe.UNSIGNED_SHORT,Le.primitiveOffset*ve*2,J):k?oe.drawElements(s,Le.primitiveLength*ve,oe.UNSIGNED_SHORT,Le.primitiveOffset*ve*2):oe.drawArrays(s,Le.vertexOffset,Le.vertexLength);s===oe.TRIANGLES&&k&&this._drawDebugWireframe(t,h,_,y,k,Le,V,H,Q,J)}}}function yd(u,t,s=0){const h=Math.pow(2,t.tileID.overscaledZ),_=t.tileSize*Math.pow(2,u.transform.tileZoom)/h,y=_*(t.tileID.canonical.x+t.tileID.wrap*h),b=_*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.aw(t,1,u.transform.tileZoom),u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b],u_pattern_transition:s}}const Au={terrain:0,flat:1},Mp=r.bz(),_h=(u,t,s,h,_,y,b,C,I,O,k,U,V,H,Q,X,J,ne)=>{const oe=t.style.light,ve=oe.properties.get("position"),Se=[ve.x,ve.y,ve.z],Le=r.dx();oe.properties.get("anchor")==="viewport"&&(r.dy(Le,-t.transform.angle),r.dz(Se,Se,Le));const Ie=oe.properties.get("color").toPremultipliedRenderColor(null),Ce=t.transform,Ae={u_matrix:u,u_lightpos:Se,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[Ie.r,Ie.g,Ie.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Au[O],u_base_type:Au[k],u_ao:_,u_edge_radius:y,u_width_scale:b,u_flood_light_color:Q,u_vertical_scale:X,u_flood_light_intensity:J,u_ground_shadow_factor:ne};return Ce.projection.name==="globe"&&(Ae.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],Ae.u_zoom_transition=U,Ae.u_inv_rot_matrix=H,Ae.u_merc_center=V,Ae.u_up_dir=Ce.projection.upVector(new r.cp(0,0,0),V[0]*r.aj,V[1]*r.aj),Ae.u_height_lift=I),Ae},Jc=(u,t,s,h,_,y)=>({u_matrix:u,u_edge_radius:t,u_width_scale:s,u_vertical_scale:h,u_height_type:Au[_],u_base_type:Au[y]}),bf=(u,t,s,h,_,y,b,C,I,O,k,U,V,H,Q,X,J,ne)=>{const oe=_h(u,t,s,h,_,y,b,C,O,k,U,V,H,Q,X,J,1,[0,0,0]),ve={u_height_factor:-Math.pow(2,C.overscaledZ)/I.tileSize/8};return r.h(oe,yd(t,I,ne),ve)},Fl=(u,t,s)=>({u_matrix:u,u_emissive_strength:t,u_ground_shadow_factor:s}),Ip=(u,t,s,h,_,y=0)=>r.h(Fl(u,t,_),yd(s,h,y)),vd=(u,t,s,h)=>({u_matrix:u,u_world:s,u_emissive_strength:t,u_ground_shadow_factor:h}),Pm=(u,t,s,h,_,y,b=0)=>r.h(Ip(u,t,s,h,y,b),{u_world:_}),wf=(u,t)=>({u_matrix:u,u_ground_shadow_factor:t}),yh=(u,t,s,h,_)=>({u_matrix:u,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:s,u_height_scale:h,u_reset_depth:_}),Om=(u,t,s,h)=>{const _=r.aj/s.tileSize;return{u_matrix:u,u_camera_to_center_distance:t.getCameraToCenterDistance(h),u_extrude_scale:[t.pixelsToGLUnits[0]/_,t.pixelsToGLUnits[1]/_]}},Cu=(u,t,s=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:s}),Tf=r.bz(),vh=(u,t,s,h,_,y,b)=>{const C=u.transform,I=C.projection.name==="globe",O=I?r.dA(C.zoom,t.canonical)*C._pixelsPerMercatorPixel:r.aw(s,1,y),k={u_matrix:t.projMatrix,u_extrude_scale:O,u_intensity:b,u_inv_rot_matrix:Tf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){k.u_inv_rot_matrix=h,k.u_merc_center=_,k.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],k.u_zoom_transition=r.ah(C.zoom);const U=_[0]*r.aj,V=_[1]*r.aj;k.u_up_dir=C.projection.upVector(new r.cp(0,0,0),U,V)}return k};function eu(u,[t,s,h,_],[y,b]){if(y===b)return[0,0,0,0];const C=255*(u-1)/(u*(b-y));return[t*C,s*C,h*C,_*C]}function Sf(u,t,[s,h]){return s===h?0:.5/u+(t-s)*(u-1)/(u*(h-s))}const Bl=(u,t,s,h,_,y,b,C,I,O,k,U,V,H,Q,X,J,ne,oe,ve,Se)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:O,u_fade_t:k.mix,u_opacity:k.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:r.dC(U.paint.get("raster-saturation")),u_contrast_factor:r.dB(U.paint.get("raster-contrast")),u_spin_weights:Ef(U.paint.get("raster-hue-rotate")),u_perspective_transform:V,u_raster_elevation:H,u_zoom_transition:b,u_merc_center:C,u_cutoff_params:I,u_colorization_mix:eu(r.dD,X,ne),u_colorization_offset:Sf(r.dD,J,ne),u_color_ramp:Q,u_texture_offset:[ve/(oe+2*ve),oe/(oe+2*ve)],u_texture_res:[oe+2*ve,oe+2*ve],u_emissive_strength:Se});function Ef(u){u*=Math.PI/180;const t=Math.sin(u),s=Math.cos(u);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const jl=.05,To=(u,t,s,h,_,y,b,C,I,O,k,U)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:O,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:b,u_merc_center:C,u_cutoff_params:I}),Cc=(u,t,s,h,_,y,b,C,I,O)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_tile_offset:s,u_velocity:h,u_color_ramp:y,u_velocity_res:_,u_max_speed:b,u_uv_offset:C,u_data_scale:[255*I[0],255*I[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[jl,jl]}),Yo=(u,t,s,h,_,y,b,C,I,O)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_velocity:s,u_velocity_res:h,u_max_speed:_,u_speed_factor:y,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*I[0],255*I[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[jl,jl]}),xh=r.bz(),Mu=(u,t,s,h,_,y,b,C,I,O,k,U,V,H,Q,X,J,ne,oe,ve,Se,Le,Ie,Ce)=>{const Ae=_.transform,Pe={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Ae.getCameraToCenterDistance(oe),u_rotate_symbol:+s,u_aspect_ratio:Ae.width/Ae.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:b,u_coord_matrix:C,u_is_text:+O,u_elevation_from_sea:I?1:0,u_pitch_with_map:+h,u_texsize:k,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:xh,u_up_vector:[0,-1,0],u_color_adj_mat:Le,u_icon_transition:Ie||0,u_gamma_scale:h?_.transform.getCameraToCenterDistance(oe)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Ce||1,u_ground_shadow_factor:ve,u_inv_matrix:r.bi(r.bz(),b),u_normal_scale:Se};return oe.name==="globe"&&(Pe.u_tile_id=[H.canonical.x,H.canonical.y,1<<H.canonical.z],Pe.u_zoom_transition=Q,Pe.u_inv_rot_matrix=J,Pe.u_merc_center=X,Pe.u_camera_forward=Ae._camera.forward(),Pe.u_ecef_origin=r.dE(Ae.globeMatrix,H.toUnwrapped()),Pe.u_tile_matrix=Float32Array.from(Ae.globeMatrix),Pe.u_up_vector=ne),Pe},Iu=(u,t,s,h)=>({u_matrix:u,u_emissive_strength:t,u_opacity:s,u_color:h}),Ru=(u,t,s,h,_,y,b,C,I)=>r.h(function(O,k,U,V,H,Q){const{width:X,height:J}=V.imageManager.getPixelSize(k),ne=Math.pow(2,Q.tileID.overscaledZ),oe=Q.tileSize*Math.pow(2,V.transform.tileZoom)/ne,ve=oe*(Q.tileID.canonical.x+Q.tileID.wrap*ne),Se=oe*Q.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[X,J],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:H?[V.transform.width,-1*V.transform.height]:[1/r.aw(Q,1,V.transform.tileZoom),1/r.aw(Q,1,V.transform.tileZoom)],u_pixel_coord_upper:[ve>>16,Se>>16],u_pixel_coord_lower:[65535&ve,65535&Se]}}(0,y,b,h,C,I),{u_matrix:u,u_emissive_strength:t,u_opacity:s}),bh=new Float32Array(r.bx([])),wh=(u,t,s,h,_,y,b,C,I,O,k,U,V,H=[0,0,0],Q)=>{const X=_.style.light,J=X.properties.get("position"),ne=[-J.x,-J.y,J.z],oe=r.dx();X.properties.get("anchor")==="viewport"&&(r.dy(oe,-_.transform.angle),r.dz(ne,ne,oe));const ve=k.alphaMode==="MASK",Se=X.properties.get("color").toNonPremultipliedRenderColor(null),Le=V.paint.get("model-ambient-occlusion-intensity"),Ie=V.paint.get("model-color").constantOr(r.am.white).toNonPremultipliedRenderColor(null);return Ie.a=V.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:u,u_lighting_matrix:t,u_normal_matrix:s,u_node_matrix:h||bh,u_lightpos:ne,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[Se.r,Se.g,Se.b],u_camera_pos:H,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+ve,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:b.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:C.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:I,u_roughnessFactor:O,u_baseColorTexture:Aa.BaseColor,u_metallicRoughnessTexture:Aa.MetallicRoughness,u_normalTexture:Aa.Normal,u_occlusionTexture:Aa.Occlusion,u_emissionTexture:Aa.Emission,u_lutTexture:Aa.LUT,u_color_mix:Ie.toArray01(),u_aoIntensity:Le,u_emissive_strength:U,u_occlusionTextureTransform:Q||[0,0,0,0]}},Du=(u,t=bh,s=bh)=>({u_matrix:u,u_instance:t,u_node_matrix:s}),xd={fillExtrusion:u=>({u_matrix:new r.cc(u),u_lightpos:new r.c9(u),u_lightintensity:new r.ca(u),u_lightcolor:new r.c9(u),u_vertical_gradient:new r.ca(u),u_opacity:new r.ca(u),u_edge_radius:new r.ca(u),u_width_scale:new r.ca(u),u_ao:new r.cb(u),u_height_type:new r.c8(u),u_base_type:new r.c8(u),u_tile_id:new r.c9(u),u_zoom_transition:new r.ca(u),u_inv_rot_matrix:new r.cc(u),u_merc_center:new r.cb(u),u_up_dir:new r.c9(u),u_height_lift:new r.ca(u),u_flood_light_color:new r.c9(u),u_vertical_scale:new r.ca(u),u_flood_light_intensity:new r.ca(u),u_ground_shadow_factor:new r.c9(u)}),fillExtrusionDepth:u=>({u_matrix:new r.cc(u),u_edge_radius:new r.ca(u),u_width_scale:new r.ca(u),u_vertical_scale:new r.ca(u),u_height_type:new r.c8(u),u_base_type:new r.c8(u)}),fillExtrusionPattern:u=>({u_matrix:new r.cc(u),u_lightpos:new r.c9(u),u_lightintensity:new r.ca(u),u_lightcolor:new r.c9(u),u_vertical_gradient:new r.ca(u),u_height_factor:new r.ca(u),u_edge_radius:new r.ca(u),u_width_scale:new r.ca(u),u_ao:new r.cb(u),u_height_type:new r.c8(u),u_base_type:new r.c8(u),u_tile_id:new r.c9(u),u_zoom_transition:new r.ca(u),u_inv_rot_matrix:new r.cc(u),u_merc_center:new r.cb(u),u_up_dir:new r.c9(u),u_height_lift:new r.ca(u),u_image:new r.c8(u),u_texsize:new r.cb(u),u_pixel_coord_upper:new r.cb(u),u_pixel_coord_lower:new r.cb(u),u_tile_units_to_pixels:new r.ca(u),u_opacity:new r.ca(u),u_pattern_transition:new r.ca(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new r.cc(u),u_opacity:new r.ca(u),u_ao_pass:new r.ca(u),u_meter_to_tile:new r.ca(u),u_ao:new r.cb(u),u_flood_light_intensity:new r.ca(u),u_flood_light_color:new r.c9(u),u_attenuation:new r.ca(u),u_edge_radius:new r.ca(u),u_fb:new r.c8(u),u_fb_size:new r.ca(u),u_dynamic_offset:new r.ca(u)}),fill:u=>({u_matrix:new r.cc(u),u_emissive_strength:new r.ca(u),u_ground_shadow_factor:new r.c9(u)}),fillPattern:u=>({u_matrix:new r.cc(u),u_emissive_strength:new r.ca(u),u_image:new r.c8(u),u_texsize:new r.cb(u),u_pixel_coord_upper:new r.cb(u),u_pixel_coord_lower:new r.cb(u),u_tile_units_to_pixels:new r.ca(u),u_ground_shadow_factor:new r.c9(u),u_pattern_transition:new r.ca(u)}),fillOutline:u=>({u_matrix:new r.cc(u),u_emissive_strength:new r.ca(u),u_world:new r.cb(u),u_ground_shadow_factor:new r.c9(u)}),fillOutlinePattern:u=>({u_matrix:new r.cc(u),u_emissive_strength:new r.ca(u),u_world:new r.cb(u),u_image:new r.c8(u),u_texsize:new r.cb(u),u_pixel_coord_upper:new r.cb(u),u_pixel_coord_lower:new r.cb(u),u_tile_units_to_pixels:new r.ca(u),u_ground_shadow_factor:new r.c9(u),u_pattern_transition:new r.ca(u)}),building:u=>({u_matrix:new r.cc(u),u_normal_matrix:new r.cc(u),u_opacity:new r.ca(u)}),buildingDepth:u=>({u_matrix:new r.cc(u)}),elevatedStructuresDepth:u=>({u_matrix:new r.cc(u),u_depth_bias:new r.ca(u)}),elevatedStructures:u=>({u_matrix:new r.cc(u),u_ground_shadow_factor:new r.c9(u)}),elevatedStructuresDepthReconstruct:u=>({u_matrix:new r.cc(u),u_camera_pos:new r.c9(u),u_depth_bias:new r.ca(u),u_height_scale:new r.ca(u),u_reset_depth:new r.ca(u)}),circle:r.dH,collisionBox:u=>({u_matrix:new r.cc(u),u_camera_to_center_distance:new r.ca(u),u_extrude_scale:new r.cb(u)}),collisionCircle:u=>({u_matrix:new r.cc(u),u_inv_matrix:new r.cc(u),u_camera_to_center_distance:new r.ca(u),u_viewport_size:new r.cb(u)}),debug:u=>({u_color:new r.di(u),u_matrix:new r.cc(u),u_overlay:new r.c8(u),u_overlay_scale:new r.ca(u)}),clippingMask:u=>({u_matrix:new r.cc(u)}),heatmap:u=>({u_extrude_scale:new r.ca(u),u_intensity:new r.ca(u),u_matrix:new r.cc(u),u_inv_rot_matrix:new r.cc(u),u_merc_center:new r.cb(u),u_tile_id:new r.c9(u),u_zoom_transition:new r.ca(u),u_up_dir:new r.c9(u)}),heatmapTexture:u=>({u_image:new r.c8(u),u_color_ramp:new r.c8(u),u_opacity:new r.ca(u)}),hillshade:u=>({u_matrix:new r.cc(u),u_image:new r.c8(u),u_latrange:new r.cb(u),u_light:new r.cb(u),u_shadow:new r.di(u),u_highlight:new r.di(u),u_emissive_strength:new r.ca(u),u_accent:new r.di(u)}),hillshadePrepare:u=>({u_matrix:new r.cc(u),u_image:new r.c8(u),u_dimension:new r.cb(u),u_zoom:new r.ca(u)}),line:r.dG,linePattern:r.dF,raster:u=>({u_matrix:new r.cc(u),u_normalize_matrix:new r.cc(u),u_globe_matrix:new r.cc(u),u_merc_matrix:new r.cc(u),u_grid_matrix:new r.dj(u),u_tl_parent:new r.cb(u),u_scale_parent:new r.ca(u),u_fade_t:new r.ca(u),u_opacity:new r.ca(u),u_image0:new r.c8(u),u_image1:new r.c8(u),u_brightness_low:new r.ca(u),u_brightness_high:new r.ca(u),u_saturation_factor:new r.ca(u),u_contrast_factor:new r.ca(u),u_spin_weights:new r.c9(u),u_perspective_transform:new r.cb(u),u_raster_elevation:new r.ca(u),u_zoom_transition:new r.ca(u),u_merc_center:new r.cb(u),u_cutoff_params:new r.cQ(u),u_colorization_mix:new r.cQ(u),u_colorization_offset:new r.ca(u),u_color_ramp:new r.c8(u),u_texture_offset:new r.cb(u),u_texture_res:new r.cb(u),u_emissive_strength:new r.ca(u)}),rasterParticle:u=>({u_matrix:new r.cc(u),u_normalize_matrix:new r.cc(u),u_globe_matrix:new r.cc(u),u_merc_matrix:new r.cc(u),u_grid_matrix:new r.dj(u),u_tl_parent:new r.cb(u),u_scale_parent:new r.ca(u),u_fade_t:new r.ca(u),u_opacity:new r.ca(u),u_image0:new r.c8(u),u_image1:new r.c8(u),u_raster_elevation:new r.ca(u),u_zoom_transition:new r.ca(u),u_merc_center:new r.cb(u),u_cutoff_params:new r.cQ(u)}),rasterParticleTexture:u=>({u_texture:new r.c8(u),u_opacity:new r.ca(u)}),rasterParticleDraw:u=>({u_particle_texture:new r.c8(u),u_particle_texture_side_len:new r.ca(u),u_tile_offset:new r.cb(u),u_velocity:new r.c8(u),u_color_ramp:new r.c8(u),u_velocity_res:new r.cb(u),u_max_speed:new r.ca(u),u_uv_offset:new r.cb(u),u_data_scale:new r.cb(u),u_data_offset:new r.ca(u),u_particle_pos_scale:new r.ca(u),u_particle_pos_offset:new r.cb(u)}),rasterParticleUpdate:u=>({u_particle_texture:new r.c8(u),u_particle_texture_side_len:new r.ca(u),u_velocity:new r.c8(u),u_velocity_res:new r.cb(u),u_max_speed:new r.ca(u),u_speed_factor:new r.ca(u),u_reset_rate:new r.ca(u),u_rand_seed:new r.ca(u),u_uv_offset:new r.cb(u),u_data_scale:new r.cb(u),u_data_offset:new r.ca(u),u_particle_pos_scale:new r.ca(u),u_particle_pos_offset:new r.cb(u)}),symbol:u=>({u_is_size_zoom_constant:new r.c8(u),u_is_size_feature_constant:new r.c8(u),u_size_t:new r.ca(u),u_size:new r.ca(u),u_camera_to_center_distance:new r.ca(u),u_rotate_symbol:new r.c8(u),u_aspect_ratio:new r.ca(u),u_fade_change:new r.ca(u),u_matrix:new r.cc(u),u_label_plane_matrix:new r.cc(u),u_coord_matrix:new r.cc(u),u_is_text:new r.c8(u),u_elevation_from_sea:new r.c8(u),u_pitch_with_map:new r.c8(u),u_texsize:new r.cb(u),u_texsize_icon:new r.cb(u),u_texture:new r.c8(u),u_texture_icon:new r.c8(u),u_gamma_scale:new r.ca(u),u_device_pixel_ratio:new r.ca(u),u_tile_id:new r.c9(u),u_zoom_transition:new r.ca(u),u_inv_rot_matrix:new r.cc(u),u_merc_center:new r.cb(u),u_camera_forward:new r.c9(u),u_tile_matrix:new r.cc(u),u_up_vector:new r.c9(u),u_ecef_origin:new r.c9(u),u_is_halo:new r.c8(u),u_icon_transition:new r.ca(u),u_color_adj_mat:new r.cc(u),u_scale_factor:new r.ca(u),u_ground_shadow_factor:new r.c9(u),u_inv_matrix:new r.cc(u),u_normal_scale:new r.ca(u)}),background:u=>({u_matrix:new r.cc(u),u_emissive_strength:new r.ca(u),u_opacity:new r.ca(u),u_color:new r.di(u)}),backgroundPattern:u=>({u_matrix:new r.cc(u),u_emissive_strength:new r.ca(u),u_opacity:new r.ca(u),u_image:new r.c8(u),u_pattern_tl:new r.cb(u),u_pattern_br:new r.cb(u),u_texsize:new r.cb(u),u_pattern_size:new r.cb(u),u_pixel_coord_upper:new r.cb(u),u_pixel_coord_lower:new r.cb(u),u_pattern_units_to_pixels:new r.cb(u)}),terrainRaster:u=>({u_matrix:new r.cc(u),u_image0:new r.c8(u),u_skirt_height:new r.ca(u),u_ground_shadow_factor:new r.c9(u)}),skybox:u=>({u_matrix:new r.cc(u),u_sun_direction:new r.c9(u),u_cubemap:new r.c8(u),u_opacity:new r.ca(u),u_temporal_offset:new r.ca(u)}),skyboxGradient:u=>({u_matrix:new r.cc(u),u_color_ramp:new r.c8(u),u_center_direction:new r.c9(u),u_radius:new r.ca(u),u_opacity:new r.ca(u),u_temporal_offset:new r.ca(u)}),skyboxCapture:u=>({u_matrix_3f:new r.dj(u),u_sun_direction:new r.c9(u),u_sun_intensity:new r.ca(u),u_color_tint_r:new r.cQ(u),u_color_tint_m:new r.cQ(u),u_luminance:new r.ca(u)}),globeRaster:u=>({u_proj_matrix:new r.cc(u),u_globe_matrix:new r.cc(u),u_normalize_matrix:new r.cc(u),u_merc_matrix:new r.cc(u),u_zoom_transition:new r.ca(u),u_merc_center:new r.cb(u),u_image0:new r.c8(u),u_grid_matrix:new r.dj(u),u_skirt_height:new r.ca(u),u_far_z_cutoff:new r.ca(u),u_frustum_tl:new r.c9(u),u_frustum_tr:new r.c9(u),u_frustum_br:new r.c9(u),u_frustum_bl:new r.c9(u),u_globe_pos:new r.c9(u),u_globe_radius:new r.ca(u),u_viewport:new r.cb(u)}),globeAtmosphere:u=>({u_frustum_tl:new r.c9(u),u_frustum_tr:new r.c9(u),u_frustum_br:new r.c9(u),u_frustum_bl:new r.c9(u),u_horizon:new r.ca(u),u_transition:new r.ca(u),u_fadeout_range:new r.ca(u),u_color:new r.cQ(u),u_high_color:new r.cQ(u),u_space_color:new r.cQ(u),u_temporal_offset:new r.ca(u),u_horizon_angle:new r.ca(u)}),model:u=>({u_matrix:new r.cc(u),u_lighting_matrix:new r.cc(u),u_normal_matrix:new r.cc(u),u_node_matrix:new r.cc(u),u_lightpos:new r.c9(u),u_lightintensity:new r.ca(u),u_lightcolor:new r.c9(u),u_camera_pos:new r.c9(u),u_opacity:new r.ca(u),u_baseColorFactor:new r.cQ(u),u_emissiveFactor:new r.cQ(u),u_metallicFactor:new r.ca(u),u_roughnessFactor:new r.ca(u),u_baseTextureIsAlpha:new r.c8(u),u_alphaMask:new r.c8(u),u_alphaCutoff:new r.ca(u),u_baseColorTexture:new r.c8(u),u_metallicRoughnessTexture:new r.c8(u),u_normalTexture:new r.c8(u),u_occlusionTexture:new r.c8(u),u_emissionTexture:new r.c8(u),u_lutTexture:new r.c8(u),u_color_mix:new r.cQ(u),u_aoIntensity:new r.ca(u),u_emissive_strength:new r.ca(u),u_occlusionTextureTransform:new r.cQ(u)}),modelDepth:u=>({u_matrix:new r.cc(u),u_instance:new r.cc(u),u_node_matrix:new r.cc(u)}),groundShadow:u=>({u_matrix:new r.cc(u),u_ground_shadow_factor:new r.c9(u)}),stars:u=>({u_matrix:new r.cc(u),u_up:new r.c9(u),u_right:new r.c9(u),u_intensity_multiplier:new r.ca(u)}),snowParticle:u=>({u_modelview:new r.cc(u),u_projection:new r.cc(u),u_time:new r.ca(u),u_cam_pos:new r.c9(u),u_velocityConeAperture:new r.ca(u),u_velocity:new r.ca(u),u_horizontalOscillationRadius:new r.ca(u),u_horizontalOscillationRate:new r.ca(u),u_boxSize:new r.ca(u),u_billboardSize:new r.ca(u),u_simpleShapeParameters:new r.cb(u),u_screenSize:new r.cb(u),u_thinningCenterPos:new r.cb(u),u_thinningShape:new r.c9(u),u_thinningAffectedRatio:new r.ca(u),u_thinningParticleOffset:new r.ca(u),u_particleColor:new r.cQ(u),u_direction:new r.c9(u)}),rainParticle:u=>({u_modelview:new r.cc(u),u_projection:new r.cc(u),u_time:new r.ca(u),u_cam_pos:new r.c9(u),u_texScreen:new r.c8(u),u_velocityConeAperture:new r.ca(u),u_velocity:new r.ca(u),u_boxSize:new r.ca(u),u_rainDropletSize:new r.cb(u),u_distortionStrength:new r.ca(u),u_rainDirection:new r.c9(u),u_color:new r.cQ(u),u_screenSize:new r.cb(u),u_thinningCenterPos:new r.cb(u),u_thinningShape:new r.c9(u),u_thinningAffectedRatio:new r.ca(u),u_thinningParticleOffset:new r.ca(u),u_shapeDirectionalPower:new r.ca(u),u_shapeNormalPower:new r.ca(u),u_mode:new r.ca(u)}),vignette:u=>({u_vignetteShape:new r.c9(u),u_vignetteColor:new r.cQ(u)}),occlusion:u=>({u_matrix:new r.cc(u),u_anchorPos:new r.c9(u),u_screenSizePx:new r.cb(u),u_occluderSizePx:new r.cb(u),u_color:new r.cQ(u)})};class Oo{constructor(t,s,h,_){this.id=Oo.uniqueIdxCounter,Oo.uniqueIdxCounter++,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||_||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Oo.uniqueIdxCounter,Oo.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Oo.uniqueIdxCounter=0;const Rp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dp{constructor(t,s,h,_,y,b){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=_,this.instanceCount=b,this.context=t;const C=t.gl;this.buffer=C.createBuffer(),t.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||y||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let h=0;h<this.attributes.length;h++){const _=s.attributes[this.attributes[h].name];_!==void 0&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,s,h){for(let _=0;_<this.attributes.length;_++){const y=this.attributes[_],b=s.attributes[y.name];b!==void 0&&t.vertexAttribPointer(b,y.components,t[Rp[y.type]],!1,this.itemSize,y.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(t,s,h){for(let _=0;_<this.attributes.length;_++){const y=s.attributes[this.attributes[_].name];y!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(y,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Vl{constructor(t,s,h,_,y){this.context=t,this.width=s,this.height=h;const b=this.framebuffer=t.gl.createFramebuffer();_&&(this.colorAttachment=new Nl(t,b)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new Tc(t,b):new Sc(t,b))}destroy(){const t=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&t.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&t.deleteTexture(s)}t.deleteFramebuffer(this.framebuffer)}}class cr{constructor(t,s){this.gl=t,this.clearColor=new fd(this),this.clearDepth=new vc(this),this.clearStencil=new Sp(this),this.colorMask=new Ep(this),this.depthMask=new hh(this),this.stencilMask=new dh(this),this.stencilFunc=new pd(this),this.stencilOp=new yf(this),this.stencilTest=new ao(this),this.depthRange=new Wo(this),this.depthTest=new qc(this),this.depthFunc=new yl(this),this.blend=new Xo(this),this.blendFunc=new xc(this),this.blendColor=new $c(this),this.blendEquation=new Zc(this),this.cullFace=new fh(this),this.cullFaceSide=new ua(this),this.frontFace=new os(this),this.program=new jr(this),this.activeTexture=new bc(this),this.viewport=new vl(this),this.bindFramebuffer=new Wc(this),this.bindRenderbuffer=new kl(this),this.bindTexture=new md(this),this.bindVertexBuffer=new vf(this),this.bindElementBuffer=new Xc(this),this.bindVertexArrayOES=new wc(this),this.pixelStoreUnpack=new Ap(this),this.pixelStoreUnpackPremultiplyAlpha=new ph(this),this.pixelStoreUnpackFlipY=new xf(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s,h){return new Oo(this,t,s,h)}createVertexBuffer(t,s,h,_,y){return new Dp(this,t,s,h,_,y)}createRenderbuffer(t,s,h){const _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,t,s,h),this.bindRenderbuffer.set(null),y}createFramebuffer(t,s,h,_){return new Vl(this,t,s,h,_)}clear({color:t,depth:s,stencil:h,colorMask:_}){const y=this.gl;let b=0;t&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(_||[!0,!0,!0,!0])),s!==void 0&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),y.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.bv(t.blendFunction,cn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Lr;function Is(u,t,s,h,_,y,b){const C=u.context,I=C.gl,O=u.transform,k=u.getOrCreateProgram("collisionBox"),U=[];let V=0,H=0;for(let Se=0;Se<h.length;Se++){const Le=h[Se],Ie=t.getTile(Le),Ce=Ie.getBucket(s);if(!Ce)continue;const Ae=zi(Le,Ce,O);let Pe=Ae;_[0]===0&&_[1]===0||(Pe=u.translatePosMatrix(Ae,Ie,_,y));const Ne=b?Ce.textCollisionBox:Ce.iconCollisionBox,Ke=Ce.collisionCircleArray;if(Ke.length>0){const Je=r.bz(),mt=Pe;r.cB(Je,Ce.placementInvProjMatrix,O.glCoordMatrix),r.cB(Je,Je,Ce.placementViewportMatrix),U.push({circleArray:Ke,circleOffset:H,transform:mt,invTransform:Je,projection:Ce.getProjection()}),V+=Ke.length/4,H=V}Ne&&(u.terrain&&u.terrain.setupElevationDraw(Ie,k),k.draw(u,I.LINES,yi.disabled,qi.disabled,u.colorModeForRenderPass(),Fi.disabled,Om(Pe,O,Ie,Ce.getProjection()),s.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,null,O.zoom,null,[Ne.collisionVertexBuffer,Ne.collisionVertexBufferExt]))}if(!b||!U.length)return;const Q=u.getOrCreateProgram("collisionCircle"),X=new r.dI;X.resize(4*V),X._trim();let J=0;for(const Se of U)for(let Le=0;Le<Se.circleArray.length/4;Le++){const Ie=4*Le,Ce=Se.circleArray[Ie+0],Ae=Se.circleArray[Ie+1],Pe=Se.circleArray[Ie+2],Ne=Se.circleArray[Ie+3];X.emplace(J++,Ce,Ae,Pe,Ne,0),X.emplace(J++,Ce,Ae,Pe,Ne,1),X.emplace(J++,Ce,Ae,Pe,Ne,2),X.emplace(J++,Ce,Ae,Pe,Ne,3)}(!Lr||Lr.length<2*V)&&(Lr=function(Se){const Le=2*Se,Ie=new r.a_;Ie.resize(Le),Ie._trim();for(let Ce=0;Ce<Le;Ce++){const Ae=6*Ce;Ie.uint16[Ae+0]=4*Ce+0,Ie.uint16[Ae+1]=4*Ce+1,Ie.uint16[Ae+2]=4*Ce+2,Ie.uint16[Ae+3]=4*Ce+2,Ie.uint16[Ae+4]=4*Ce+3,Ie.uint16[Ae+5]=4*Ce+0}return Ie}(V));const ne=C.createIndexBuffer(Lr,!0),oe=C.createVertexBuffer(X,r.dJ.members,!0);for(const Se of U){const Le={u_matrix:Se.transform,u_inv_matrix:Se.invTransform,u_camera_to_center_distance:(ve=O).getCameraToCenterDistance(Se.projection),u_viewport_size:[ve.width,ve.height]};Q.draw(u,I.TRIANGLES,yi.disabled,qi.disabled,u.colorModeForRenderPass(),Fi.disabled,Le,s.id,oe,ne,r.bd.simpleSegment(0,2*Se.circleOffset,Se.circleArray.length,Se.circleArray.length/2),null,O.zoom)}var ve;oe.destroy(),ne.destroy()}const Ko=r.bz();function Ul(u){const t=u._camera.getWorldToCamera(u.worldSize,1),s=r.az([],t,u.globeMatrix);r.bi(s,s);const h=[0,0,0],_=[0,1,0,0];return r.aA(_,_,s),h[0]=_[0],h[1]=_[1],h[2]=_[2],r.au(h,h),h}function xl({width:u,height:t,anchor:s,textOffset:h,textScale:_},y){const{horizontalAlign:b,verticalAlign:C}=r.bT(s),I=-(b-.5)*u,O=-(C-.5)*t,k=r.bU(s,h);return new r.P((I/_+k[0])*y,(O/_+k[1])*y)}function bd(u,t,s,h,_,y,b,C,I,O){const k=u.text.placedSymbolArray,U=u.text.dynamicLayoutVertexArray,V=u.icon.dynamicLayoutVertexArray,H={},Q=u.getProjection(),X=Go(b,Q,_),J=_.elevation,ne=Q.upVectorScale(b.canonical,_.center.lat,_.worldSize).metersToTile;U.clear();for(let oe=0;oe<k.length;oe++){const ve=k.get(oe),{tileAnchorX:Se,tileAnchorY:Le,numGlyphs:Ie}=ve,Ce=ve.hidden||!ve.crossTileID||u.allowVerticalPlacement&&!ve.placedOrientation?null:h[ve.crossTileID];if(Ce){let Ae=0,Pe=0,Ne=0;if(J){const bt=J?J.getAtTileOffset(b,Se,Le):0,[st,Ct,Wt]=Q.upVector(b.canonical,Se,Le);Ae=bt*st*ne,Pe=bt*Ct*ne,Ne=bt*Wt*ne}let[Ke,Je,mt,xt]=Tt(ve.projectedAnchorX+Ae,ve.projectedAnchorY+Pe,ve.projectedAnchorZ+Ne,s?X:y);const Pt=vi(_.getCameraToCenterDistance(Q),xt);let Ze=r.bJ(u.textSizeData,I,ve)*Pt/r.bO;s&&(Ze*=u.tilePixelRatio/C);const lt=xl(Ce,Ze);s?({x:Ke,y:Je,z:mt}=Q.projectTilePoint(Se+lt.x,Le+lt.y,b.canonical),[Ke,Je,mt]=Tt(Ke+Ae,Je+Pe,mt+Ne,y)):(t&&lt._rotate(-_.angle),Ke+=lt.x,Je+=lt.y,mt=0);const Ge=u.allowVerticalPlacement&&ve.placedOrientation===r.bI.vertical?Math.PI/2:0;for(let bt=0;bt<Ie;bt++)r.bL(U,Ke,Je,mt,Ge);O&&ve.associatedIconIndex>=0&&(H[ve.associatedIconIndex]={x:Ke,y:Je,z:mt,angle:Ge})}else ea(Ie,U)}if(O){V.clear();const oe=u.icon.placedSymbolArray;for(let ve=0;ve<oe.length;ve++){const Se=oe.get(ve),{numGlyphs:Le}=Se,Ie=H[ve];if(Se.hidden||!Ie)ea(Le,V);else{const{x:Ce,y:Ae,z:Pe,angle:Ne}=Ie;for(let Ke=0;Ke<Le;Ke++)r.bL(V,Ce,Ae,Pe,Ne)}}u.icon.dynamicLayoutVertexBuffer.updateData(V)}u.text.dynamicLayoutVertexBuffer.updateData(U)}function Gl(u,t,s,h,_,y,b={}){const C=s.paint.get("icon-translate"),I=s.paint.get("text-translate"),O=s.paint.get("icon-translate-anchor"),k=s.paint.get("text-translate-anchor"),U=s.layout.get("icon-rotation-alignment"),V=s.layout.get("text-rotation-alignment"),H=s.layout.get("icon-pitch-alignment"),Q=s.layout.get("text-pitch-alignment"),X=s.layout.get("icon-keep-upright"),J=s.layout.get("text-keep-upright"),ne=s.paint.get("icon-color-saturation"),oe=s.paint.get("icon-color-contrast"),ve=s.paint.get("icon-color-brightness-min"),Se=s.paint.get("icon-color-brightness-max"),Le=s.layout.get("symbol-elevation-reference")==="sea",Ie=u.context,Ce=Ie.gl,Ae=u.transform,Pe=U==="map",Ne=V==="map",Ke=H==="map",Je=Q==="map",mt=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let xt=!1;const Pt=u.depthModeForSublayer(0,yi.ReadOnly),Ze=new yi(u.context.gl.LEQUAL,yi.ReadOnly,u.depthRangeFor3D),lt=[r.aD(Ae.center.lng),r.aH(Ae.center.lat)],Ge=s.layout.get("text-variable-anchor"),bt=Ae.projection.name==="globe",st=[],Ct=[0,-1,0];for(const Wt of h){const wt=t.getTile(Wt),Vt=wt.getBucket(s);if(!Vt||Vt.projection.name==="mercator"&&bt||Vt.fullyClipped)continue;const gi=Vt.projection.name==="globe",di=gi?r.ah(Ae.zoom):0,hi=Go(Wt,Vt.getProjection(),Ae),Ai=Ae.calculatePixelsToTileUnitsMatrix(wt),Pi=Ge&&Vt.hasTextData(),fi=Vt.hasIconTextFit()&&Pi&&Vt.hasIconData(),Ci=Vt.getProjection().createInversionMatrix(Ae,Wt.canonical),Ri=(1<<wt.tileID.canonical.z)*r.aj/u.transform.worldSize,$i=sr=>{let gn=[0,0,0];if(sr){const _r=u.style.directionalLight,yn=u.style.ambientLight;_r&&yn&&(gn=jc(u.style,_r,yn))}return gn},rn=sr=>{Ae.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||u.terrain)&&(sr.push("DEPTH_D24"),sr.push("DEPTH_OCCLUSION"))},_n=()=>{const sr=Pe&&s.layout.get("symbol-placement")!=="point",gn=[];rn(gn);const _r=sr||fi,yn=Vt.elevationType==="road"&&Ke,ar=u.shadowRenderer,ur=yn&&!!ar&&ar.enabled,nr=$i(ur),or=yn?Ze:Pt,Nn=s.paint.get("icon-image-cross-fade");u.terrainRenderModeElevated()&&Ke&&gn.push("PITCH_WITH_MAP_TERRAIN"),gi&&(gn.push("PROJECTION_GLOBE_VIEW"),_r&&gn.push("PROJECTED_POS_ON_VIEWPORT")),Nn>0&&gn.push("ICON_TRANSITION"),Vt.icon.zOffsetVertexBuffer&&gn.push("Z_OFFSET"),ne===0&&oe===0&&ve===0&&Se===1||gn.push("COLOR_ADJUSTMENT"),Vt.sdfIcons&&gn.push("RENDER_SDF"),ur&&gn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),yn&&Vt.icon.orientationVertexBuffer&&gn.push("ELEVATED_ROADS");const pr=Vt.icon.programConfigurations.get(s.id),Cr=u.getOrCreateProgram("symbol",{config:pr,defines:gn}),Qn=wt.imageAtlasTexture?wt.imageAtlasTexture.size:[0,0],An=Vt.iconSizeData,na=r.bH(An,Ae.zoom),Ia=Ke||!Ae.isOrthographic,uo=Gs(hi,wt.tileID.canonical,Ke,Pe,Ae,Vt.getProjection(),Ai),rl=qe(hi,wt.tileID.canonical,Ke,Pe,Ae,Vt.getProjection(),Ai),Za=u.translatePosMatrix(rl,wt,C,O,!0),Ra=u.translatePosMatrix(hi,wt,C,O),qs=_r?Ko:uo,sl=Pe&&!Ke&&!sr;let $s=Ct;!bt&&!Ae.mercatorFromTransition||Pe||($s=Ul(Ae));const Nh=gi?$s:Ct,qf=s.getColorAdjustmentMatrix(ne,oe,ve,Se),Fh=Mu(An.kind,na,sl,Ke,u,Ra,qs,Za,Le,!1,Qn,[0,0],0,Wt,di,lt,Ci,Nh,Vt.getProjection(),nr,Ri,qf,Nn,null),sc=wt.imageAtlasTexture?wt.imageAtlasTexture:null,au=s.layout.get("icon-size").constantOr(0)!==1||Vt.iconsNeedLinear,Bh=Vt.sdfIcons||u.options.rotating||u.options.zooming||au||Ia?Ce.LINEAR:Ce.NEAREST,Pc=Vt.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,Al=u.terrain&&Ke&&sr?r.bi(r.bz(),uo):Ko;if(sr&&Vt.icon){const Gu=Ae.elevation,ou=Gu?Gu.getAtTileOffsetFunc(Wt,Ae.center.lat,Ae.worldSize,Vt.getProjection()):null,ac=Vo(hi,wt.tileID.canonical,Ke,Pe,Ae,Vt.getProjection(),Ai);Rr(Vt,hi,u,!1,ac,rl,Ke,X,ou,Wt)}return{program:Cr,buffers:Vt.icon,uniformValues:Fh,atlasTexture:sc,atlasTextureIcon:null,atlasInterpolation:Bh,atlasInterpolationIcon:null,isSDF:Vt.sdfIcons,hasHalo:Pc,depthMode:or,tile:wt,renderWithShadows:ur,labelPlaneMatrixInv:Al}},Ln=()=>{const sr=Ne&&s.layout.get("symbol-placement")!=="point",gn=[],_r=sr||Ge||fi,yn=Vt.elevationType==="road"&&Je,ar=u.shadowRenderer,ur=yn&&!!ar&&ar.enabled,nr=$i(ur),or=yn?Ze:Pt;u.terrainRenderModeElevated()&&Je&&gn.push("PITCH_WITH_MAP_TERRAIN"),gi&&(gn.push("PROJECTION_GLOBE_VIEW"),_r&&gn.push("PROJECTED_POS_ON_VIEWPORT")),Vt.text.zOffsetVertexBuffer&&gn.push("Z_OFFSET"),Vt.iconsInText&&gn.push("RENDER_TEXT_AND_SYMBOL"),gn.push("RENDER_SDF"),ur&&gn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),yn&&Vt.text.orientationVertexBuffer&&gn.push("ELEVATED_ROADS"),rn(gn);const Nn=Vt.text.programConfigurations.get(s.id),pr=u.getOrCreateProgram("symbol",{config:Nn,defines:gn});let Cr,Qn=[0,0],An=null;const na=Vt.textSizeData;Vt.iconsInText&&(Qn=wt.imageAtlasTexture?wt.imageAtlasTexture.size:[0,0],An=wt.imageAtlasTexture?wt.imageAtlasTexture:null,Cr=Je||!Ae.isOrthographic||u.options.rotating||u.options.zooming||na.kind==="composite"||na.kind==="camera"?Ce.LINEAR:Ce.NEAREST);const Ia=wt.glyphAtlasTexture?wt.glyphAtlasTexture.size:[0,0],uo=s.layout.get("text-size-scale-range"),rl=r.ay(u.scaleFactor,uo[0],uo[1]),Za=r.bH(na,Ae.zoom,rl),Ra=Gs(hi,wt.tileID.canonical,Je,Ne,Ae,Vt.getProjection(),Ai),qs=qe(hi,wt.tileID.canonical,Je,Ne,Ae,Vt.getProjection(),Ai),sl=u.translatePosMatrix(qs,wt,I,k,!0),$s=u.translatePosMatrix(hi,wt,I,k),Nh=_r?Ko:Ra,qf=Ne&&!Je&&!sr;let Fh=Ct;!bt&&!Ae.mercatorFromTransition||Ne||(Fh=Ul(Ae));const sc=Mu(na.kind,Za,qf,Je,u,$s,Nh,sl,Le,!0,Ia,Qn,0,Wt,di,lt,Ci,gi?Fh:Ct,Vt.getProjection(),nr,Ri,null,null,rl),au=wt.glyphAtlasTexture?wt.glyphAtlasTexture:null,Bh=Ce.LINEAR,Pc=s.paint.get("text-halo-width").constantOr(1)!==0,Al=u.terrain&&Je&&sr?r.bi(r.bz(),Ra):Ko;if(sr&&Vt.text){const Gu=Ae.elevation,ou=Gu?Gu.getAtTileOffsetFunc(Wt,Ae.center.lat,Ae.worldSize,Vt.getProjection()):null,ac=Vo(hi,wt.tileID.canonical,Je,Ne,Ae,Vt.getProjection(),Ai);Rr(Vt,hi,u,!0,ac,qs,Je,J,ou,Wt)}return{program:pr,buffers:Vt.text,uniformValues:sc,atlasTexture:au,atlasTextureIcon:An,atlasInterpolation:Bh,atlasInterpolationIcon:Cr,isSDF:!0,hasHalo:Pc,depthMode:or,tile:wt,renderWithShadows:ur,labelPlaneMatrixInv:Al}},Ar=Vt.icon.segments.get().length,Ki=Vt.text.segments.get().length,Wi=Ar&&!b.onlyText?_n():null,Ui=Ki&&!b.onlyIcons?Ln():null,Zn=s.paint.get("icon-opacity").constantOr(1),Hr=s.paint.get("text-opacity").constantOr(1);if(mt&&Vt.canOverlap){xt=!0;const sr=Zn&&!b.onlyText?Vt.icon.segments.get():[],gn=Hr&&!b.onlyIcons?Vt.text.segments.get():[];for(const _r of sr)st.push({segments:new r.bd([_r]),sortKey:_r.sortKey,state:Wi});for(const _r of gn)st.push({segments:new r.bd([_r]),sortKey:_r.sortKey,state:Ui})}else b.onlyText||st.push({segments:Zn?Vt.icon.segments:new r.bd([]),sortKey:0,state:Wi}),b.onlyIcons||st.push({segments:Hr?Vt.text.segments:new r.bd([]),sortKey:0,state:Ui})}xt&&st.sort((Wt,wt)=>Wt.sortKey-wt.sortKey);for(const Wt of st){const wt=Wt.state;if(wt)if(u.terrain?u.terrain.setupElevationDraw(wt.tile,wt.program,{useDepthForOcclusion:Ae.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:wt.labelPlaneMatrixInv}):u.setupDepthForOcclusion(Ae.depthOcclusionForSymbolsAndCircles,wt.program),Ie.activeTexture.set(Ce.TEXTURE0),wt.atlasTexture&&wt.atlasTexture.bind(wt.atlasInterpolation,Ce.CLAMP_TO_EDGE,!0),wt.atlasTextureIcon&&(Ie.activeTexture.set(Ce.TEXTURE1),wt.atlasTextureIcon&&wt.atlasTextureIcon.bind(wt.atlasInterpolationIcon,Ce.CLAMP_TO_EDGE,!0)),wt.renderWithShadows&&u.shadowRenderer.setupShadows(wt.tile.tileID.toUnwrapped(),wt.program,"vector-tile",wt.tile.tileID.overscaledZ),u.uploadCommonLightUniforms(u.context,wt.program),wt.hasHalo){const Vt=wt.uniformValues;Vt.u_is_halo=1,bl(wt.buffers,Wt.segments,s,u,wt.program,wt.depthMode,_,y,Vt,2),Vt.u_is_halo=0}else{if(wt.isSDF){const Vt=wt.uniformValues;wt.hasHalo&&(Vt.u_is_halo=1,bl(wt.buffers,Wt.segments,s,u,wt.program,wt.depthMode,_,y,Vt,1)),Vt.u_is_halo=0}bl(wt.buffers,Wt.segments,s,u,wt.program,wt.depthMode,_,y,wt.uniformValues,1)}}}function bl(u,t,s,h,_,y,b,C,I,O){const k=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer,u.orientationVertexBuffer];_.draw(h,h.context.gl.TRIANGLES,y,b,C,Fi.disabled,I,s.id,u.layoutVertexBuffer,u.indexBuffer,t,s.paint,h.transform.zoom,u.programConfigurations.get(s.id),k,O)}function Af(u,t){const s=1<<u.canonical.z,h=(t.x*s-u.canonical.x-u.wrap*s)*r.aj,_=(t.y*s-u.canonical.y)*r.aj,y=r.dS(t.z,t.y);return r.cS(h,_,y)}function Rs(u,t,s,h,_){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const y=u.context.gl,b=new yi(u.context.gl.LEQUAL,yi.ReadWrite,u.depthRangeFor3D),C=new yi(u.context.gl.GREATER,yi.ReadWrite,u.depthRangeFor3D),I=function(H){const Q=r.cJ(H.pitch);let X=.01;return H.isOrthographic&&(X=r.ai(1e-4,X,r.cN(Q>=Vs?1:Q/Vs))),2*X}(u.transform),O=u.transform.getFreeCameraOptions().position,k="elevatedStructuresDepthReconstruct",U=u.getOrCreateProgram(k,{defines:["DEPTH_RECONSTRUCTION"]}),V=u.getOrCreateProgram(k);for(const H of h){const Q=t.getTile(H),X=Q.getBucket(s);if(!X)continue;const J=X.elevatedStructures;if(!J)continue;const ne=X.elevationBufferData.heightRange,oe=Af(H.toUnwrapped(),O),ve=u.translatePosMatrix(H.projMatrix,Q,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));let Se,Le,Ie,Ce;if(_==="initialize"){if(!ne||ne.min>=1||J.depthSegments.segments[0].primitiveLength===0)continue;Se=yh(ve,oe,I,1,0),Le=b,Ie=J.depthSegments,Ce=U}else if(_==="reset"){if(!ne||ne.min>=0||J.maskSegments.segments[0].primitiveLength===0)continue;Se=yh(ve,oe,0,0,1),Le=C,Ie=J.maskSegments,Ce=U}else if(_==="geometry"){if(J.depthSegments.segments[0].primitiveLength===0)continue;Se=yh(ve,oe,I,1,0),Le=b,Ie=J.depthSegments,Ce=V}Ce.draw(u,y.TRIANGLES,Le,qi.disabled,cn.disabled,Fi.disabled,Se,s.id,J.vertexBuffer,J.indexBuffer,Ie,s.paint,u.transform.zoom)}}function wd(u,t,s){const{painter:h,sourceCache:_,layer:y,coords:b,colorMode:C,elevationType:I,terrainEnabled:O,pass:k}=u,U=h.context.gl,V=y.paint.get("fill-pattern"),H=y.paint.get("fill-pattern-cross-fade"),Q=V.constantOr(null);let X=I;I!=="road"||t&&!O||(X="none");const J=X==="road",ne=u.painter.shadowRenderer,oe=J&&!!ne&&ne.enabled,ve=new yi(h.context.gl.LEQUAL,yi.ReadOnly,h.depthRangeFor3D);let Se=[0,0,0];if(oe){const Ce=h.style.directionalLight,Ae=h.style.ambientLight;Ce&&Ae&&(Se=jc(h.style,Ce,Ae))}const Le=V&&V.constantOr(1),Ie=(Ce,Ae)=>{let Pe,Ne,Ke,Je,mt;Ae?(Pe=Le&&!y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ke=U.LINES):(Pe=Le?"fillPattern":"fill",Ke=U.TRIANGLES);for(const xt of b){const Pt=_.getTile(xt);if(Le&&!Pt.patternsLoaded())continue;const Ze=Pt.getBucket(y);if(!Ze)continue;const lt=t?Ze.elevationBufferData:Ze.bufferData;if(lt.isEmpty())continue;h.prepareDrawTile();const Ge=lt.programConfigurations.get(y.id),bt=h.isTileAffectedByFog(xt),st=[],Ct=[];J&&(st.push("ELEVATED_ROADS"),Ct.push(lt.elevatedLayoutVertexBuffer)),oe&&st.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Le&&(h.context.activeTexture.set(U.TEXTURE0),Pt.imageAtlasTexture&&Pt.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ge.updatePaintBuffers());let Wt=!1;if(Q&&Pt.imageAtlas){const hi=Pt.imageAtlas,Ai=r.dN.from(Q),Pi=Ai.getPrimary().scaleSelf(r.q.devicePixelRatio).toString(),fi=Ai.getSecondary(),Ci=hi.patternPositions.get(Pi),Ri=fi?hi.patternPositions.get(fi.scaleSelf(r.q.devicePixelRatio).toString()):null;Wt=!!Ci&&!!Ri,Ci&&Ge.setConstantPatternPositions(Ci,Ri)}H>0&&(Wt||Ge.getPatternTransitionVertexBuffer("fill-pattern"))&&st.push("FILL_PATTERN_TRANSITION");const wt=h.getOrCreateProgram(Pe,{config:Ge,overrideFog:bt,defines:st}),Vt=h.translatePosMatrix(xt.projMatrix,Pt,y.paint.get("fill-translate"),y.paint.get("fill-translate-anchor"));oe&&ne.setupShadows(Pt.tileID.toUnwrapped(),wt,"vector-tile",Pt.tileID.overscaledZ);const gi=y.paint.get("fill-emissive-strength");if(Ae){Je=lt.lineIndexBuffer,mt=lt.lineSegments;const hi=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];Ne=Pe==="fillOutlinePattern"&&Le?Pm(Vt,gi,h,Pt,hi,Se,H):vd(Vt,gi,hi,Se)}else Je=lt.indexBuffer,mt=lt.triangleSegments,Ne=Le?Ip(Vt,gi,h,Pt,Se,H):Fl(Vt,gi,Se);h.uploadCommonUniforms(h.context,wt,xt.toUnwrapped());let di=Ce;(I==="road"&&!O||I==="offset")&&(di=ve),wt.draw(h,Ke,di,s||h.stencilModeForClipping(xt),C,Fi.disabled,Ne,y.id,lt.layoutVertexBuffer,Je,mt,y.paint,h.transform.zoom,Ge,Ct)}};h.renderPass===k&&Ie(h.depthModeForSublayer(1,h.renderPass==="opaque"?yi.ReadWrite:yi.ReadOnly),!1),X==="none"&&h.renderPass==="translucent"&&y.paint.get("fill-antialias")&&Ie(h.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,yi.ReadOnly),!0)}function wl(u,t,s,h,_,y,b,C){s.resetLayerRenderingStats(u);const I=u.context,O=I.gl,k=u.transform,U=s.paint.get("fill-extrusion-pattern"),V=s.paint.get("fill-extrusion-pattern-cross-fade"),H=U.constantOr(null),Q=U.constantOr(1),X=s.paint.get("fill-extrusion-opacity"),J=u.style.enable3dLights(),ne=s.paint.get(J&&!Q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),oe=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),ne],ve=s.layout.get("fill-extrusion-edge-radius"),Se=ve>0&&!s.paint.get("fill-extrusion-rounded-roof"),Le=Se?0:ve,Ie=k.projection.name==="globe"?r.dV():0,Ce=k.projection.name==="globe",Ae=Ce?r.ah(k.zoom):0,Pe=[r.aD(k.center.lng),r.aH(k.center.lat)],Ne=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ke=s.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ne?null:s.lut).toArray01().slice(0,3),Je=s.paint.get("fill-extrusion-flood-light-intensity"),mt=s.paint.get("fill-extrusion-vertical-scale"),xt=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Pt=s.paint.get("fill-extrusion-height-alignment"),Ze=s.paint.get("fill-extrusion-base-alignment"),lt=zl(u,s.paint.get("fill-extrusion-cutoff-fade-range")),Ge=[];let bt;Ce&&Ge.push("PROJECTION_GLOBE_VIEW"),oe[0]>0&&Ge.push("FAUX_AO"),Se&&Ge.push("ZERO_ROOF_RADIUS"),C&&Ge.push("HAS_CENTROID"),Je>0&&Ge.push("FLOOD_LIGHT"),lt.shouldRenderCutoff&&Ge.push("RENDER_CUTOFF"),xt&&Ge.push("RENDER_WALL_MODE");const st=u.renderPass==="shadow",Ct=u.shadowRenderer,Wt=st&&!!Ct,wt=st?Fi.disabled:Fi.backCCW;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let Vt=[0,0,0];if(Ct){const hi=u.style.directionalLight,Ai=u.style.ambientLight;hi&&Ai&&(Vt=jc(u.style,hi,Ai)),st||(Ge.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ct.useNormalOffset&&Ge.push("NORMAL_OFFSET")),bt=Ge.concat(["SHADOWS_SINGLE_CASCADE"])}const gi=Wt?"fillExtrusionDepth":Q?"fillExtrusionPattern":"fillExtrusion",di=s.getLayerRenderingStats();for(const hi of h){const Ai=t.getTile(hi),Pi=Ai.getBucket(s);if(!Pi||Pi.projection.name!==k.projection.name)continue;let fi=!1;Ct&&(fi=Ct.getMaxCascadeForTile(hi.toUnwrapped())===0);const Ci=u.isTileAffectedByFog(hi),Ri=Pi.programConfigurations.get(s.id);let $i=!1;if(H&&Ai.imageAtlas){const Ui=Ai.imageAtlas,Zn=r.dN.from(H),Hr=Zn.getPrimary().scaleSelf(r.q.devicePixelRatio).toString(),sr=Zn.getSecondary(),gn=Ui.patternPositions.get(Hr),_r=sr?Ui.patternPositions.get(sr.scaleSelf(r.q.devicePixelRatio).toString()):null;$i=!!gn&&!!_r,gn&&Ri.setConstantPatternPositions(gn,_r)}V>0&&($i||Ri.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ge.push("FILL_EXTRUSION_PATTERN_TRANSITION");const rn=u.getOrCreateProgram(gi,{config:Ri,defines:fi?bt:Ge,overrideFog:Ci});if(u.terrain&&u.terrain.setupElevationDraw(Ai,rn,{useMeterToDem:!0}),!Pi.centroidVertexBuffer){const Ui=rn.attributes.a_centroid_pos;Ui!==void 0&&O.vertexAttrib2f(Ui,0,0)}!st&&Ct&&Ct.setupShadows(Ai.tileID.toUnwrapped(),rn,"vector-tile",Ai.tileID.overscaledZ),Q&&(u.context.activeTexture.set(O.TEXTURE0),Ai.imageAtlasTexture&&Ai.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ri.updatePaintBuffers());const _n=s.paint.get("fill-extrusion-vertical-gradient"),Ln=1/Pi.tileToMeter;let Ar;if(st&&Ct){if($l(Ai.tileID,Pi,u))continue;const Ui=Ct.calculateShadowPassMatrixFromTile(Ai.tileID.toUnwrapped());Ar=Jc(Ui,Le,Ln,mt,Pt,Ze)}else{const Ui=u.translatePosMatrix(hi.expandedProjMatrix,Ai,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Zn=k.projection.createInversionMatrix(k,hi.canonical);Ar=Q?bf(Ui,u,_n,X,oe,Le,Ln,hi,Ai,Ie,Pt,Ze,Ae,Pe,Zn,Ke,mt,V):_h(Ui,u,_n,X,oe,Le,Ln,hi,Ie,Pt,Ze,Ae,Pe,Zn,Ke,mt,Je,Vt)}u.uploadCommonUniforms(I,rn,hi.toUnwrapped(),null,lt);let Ki=Pi.segments;if(k.projection.name==="mercator"&&!st&&(Ki=Pi.getVisibleSegments(Ai.tileID,u.terrain,u.transform.getFrustum(0)),!Ki.get().length))continue;if(di)if(st)for(const Ui of Ki.get())di.numRenderedVerticesInShadowPass+=Ui.primitiveLength;else for(const Ui of Ki.get())di.numRenderedVerticesInTransparentPass+=Ui.primitiveLength;const Wi=[];(u.terrain||C)&&Wi.push(Pi.centroidVertexBuffer),Ce&&Wi.push(Pi.layoutVertexExtBuffer),xt&&Wi.push(Pi.wallVertexBuffer),rn.draw(u,I.gl.TRIANGLES,_,y,b,wt,Ar,s.id,Pi.layoutVertexBuffer,Pi.indexBuffer,Ki,s.paint,u.transform.zoom,Ri,Wi)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function Hl(u,t,s,h,_,y,b,C,I,O,k,U,V,H,Q,X,J,ne,oe){const ve=u.context,Se=ve.gl,Le=u.transform,Ie=u.transform.zoom,Ce=[],Ae=zl(u,s.paint.get("fill-extrusion-cutoff-fade-range"));O==="clear"?(Ce.push("CLEAR_SUBPASS"),oe&&(Ce.push("CLEAR_FROM_TEXTURE"),ve.activeTexture.set(Se.TEXTURE0),oe.bind(Se.LINEAR,Se.CLAMP_TO_EDGE))):O==="sdf"&&Ce.push("SDF_SUBPASS"),J&&Ce.push("HAS_CENTROID"),Ae.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF");const Pe=s.layout.get("fill-extrusion-edge-radius"),Ne=(Ke,Je,mt,xt,Pt)=>{const Ze=Je.programConfigurations.get(s.id),lt=u.isTileAffectedByFog(Ke),Ge=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ze,defines:Ce,overrideFog:lt}),bt=((Ct,Wt,wt,Vt,gi,di,hi,Ai,Pi,fi,Ci)=>({u_matrix:Wt,u_opacity:wt,u_ao_pass:Vt?1:0,u_meter_to_tile:gi,u_ao:di,u_flood_light_intensity:hi,u_flood_light_color:Ai,u_attenuation:Pi,u_edge_radius:fi,u_fb:0,u_fb_size:Ci,u_dynamic_offset:1}))(0,xt,k,I,Pt,[U,V*Pt],H,Q,X,Ie>=17?0:Pe*Pt,oe?oe.size[0]:0),st=[];J&&st.push(Je.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(ve,Ge,Ke.toUnwrapped(),null,Ae),Ge.draw(u,ve.gl.TRIANGLES,_,y,b,C,bt,s.id,Je.vertexBuffer,Je.indexBuffer,mt,s.paint,Ie,Ze,st)};for(const Ke of h){const Je=t.getTile(Ke),mt=Je.getBucket(s);if(!mt||mt.projection.name!==Le.projection.name||!mt.groundEffect||mt.groundEffect&&!mt.groundEffect.hasData())continue;const xt=mt.groundEffect,Pt=1/mt.tileToMeter;{const Ze=u.translatePosMatrix(Ke.projMatrix,Je,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),lt=xt.getDefaultSegment();Ne(Ke,xt,lt,Ze,Pt)}if(ne)for(let Ze=0;Ze<4;Ze++){const lt=r.dT[Ze](Ke),Ge=t.getTile(lt);if(!Ge)continue;const bt=Ge.getBucket(s);if(!bt||bt.projection.name!==Le.projection.name||!bt.groundEffect||bt.groundEffect&&!bt.groundEffect.hasData())continue;const st=bt.groundEffect;let Ct,Wt;Ze===0?(Ct=[-8192,0,0],Wt=1):Ze===1?(Ct=[r.aj,0,0],Wt=0):Ze===2?(Ct=[0,-8192,0],Wt=3):(Ct=[0,r.aj,0],Wt=2);const wt=st.regionSegments[Wt];if(!wt)continue;const Vt=new Float32Array(16);r.bo(Vt,Ke.projMatrix,Ct),Ne(Ke,st,wt,u.translatePosMatrix(Vt,Je,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Pt)}}}function mi(u,t,s,h,_,y,b){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();const C=y?y.findDEMTileFor(s):null;if(!(C&&C.dem||b))return;y&&C&&C.dem&&h.selfDEMTileTimestamp!==C.dem._timestamp&&(h.borderDoneWithNeighborZ=[-1,-1,-1,-1],h.selfDEMTileTimestamp=C.dem._timestamp);const I=ne=>new r.P(Math.ceil((ne+r.dX)*r.dY),0),O=ne=>{const oe=t.getSource().minzoom,ve=Le=>{const Ie=t.getTileByID(Le);if(Ie&&Ie.hasData())return Ie.getBucket(_)},Se=[0,-1,1];for(const Le of Se){if(ne.overscaledZ+Le<oe)continue;const Ie=ve(ne.calculateScaledKey(ne.overscaledZ+Le));if(Ie)return Ie}},k=[0,0,0],U=(ne,oe)=>(k[0]=Math.min(ne.min.y,oe.min.y),k[1]=Math.max(ne.max.y,oe.max.y),k[2]=r.aj-oe.min.x>ne.max.x?oe.min.x-r.aj:ne.max.x,k),V=(ne,oe)=>(k[0]=Math.min(ne.min.x,oe.min.x),k[1]=Math.max(ne.max.x,oe.max.x),k[2]=r.aj-oe.min.y>ne.max.y?oe.min.y-r.aj:ne.max.y,k),H=[(ne,oe)=>U(ne,oe),(ne,oe)=>U(oe,ne),(ne,oe)=>V(ne,oe),(ne,oe)=>V(oe,ne)],Q=(ne,oe,ve,Se,Le,Ie,Ce)=>{if(!y)return 0;const Ae=[[Ie?ve:ne,Ie?ne:ve,0],[Ie?ve:oe,Ie?oe:ve,0]],Pe=Ce<0?r.aj+Ce:Ce,Ne=[Ie?Pe:(ne+oe)/2,Ie?(ne+oe)/2:Pe,0];return ve===0&&Ce<0||ve!==0&&Ce>0?y.getForTilePoints(Le,[Ne],!0,Se):Ae.push(Ne),y.getForTilePoints(s,Ae,!0,C),Math.max(Ae[0][2],Ae[1][2],Ne[2])/y.exaggeration()};for(let ne=0;ne<4;ne++){const oe=h.borderFeatureIndices[ne];if(oe.length===0)continue;const ve=r.dT[ne](s),Se=O(ve);if(!(Se&&Se instanceof r.dU))continue;const Le=y?y.findDEMTileFor(ve):null;if(!(Le&&Le.dem||b)||(y&&Le&&Le.dem&&h.borderDEMTileTimestamp[ne]!==Le.dem._timestamp&&(h.borderDoneWithNeighborZ[ne]=-1,h.borderDEMTileTimestamp[ne]=Le.dem._timestamp),h.borderDoneWithNeighborZ[ne]===Se.canonical.z))continue;Se.centroidVertexArray.length===0&&Se.createCentroidsBuffer();const Ie=(ne<2?1:5)-ne,Ce=Se.borderDoneWithNeighborZ[Ie]!==h.canonical.z,Ae=Se.borderFeatureIndices[Ie];let Pe=0;if(h.canonical.z!==Se.canonical.z){for(const Ne of oe)h.showCentroid(h.featuresOnBorder[Ne]);if(Ce)for(const Ne of Ae)Se.showCentroid(Se.featuresOnBorder[Ne]);h.borderDoneWithNeighborZ[ne]=Se.canonical.z,Se.borderDoneWithNeighborZ[Ie]=h.canonical.z}for(const Ne of oe){const Ke=h.featuresOnBorder[Ne],Je=h.centroidData[Ke.centroidDataIndex],mt=Ke.borders[ne];let xt;for(;Pe<Ae.length;){xt=Se.featuresOnBorder[Ae[Pe]];const Pt=xt.borders[Ie];if(Pt[1]>mt[0]+3||Pt[0]>mt[0]-3)break;Se.showCentroid(xt),Pe++}if(xt&&Pe<Ae.length){const Pt=Pe;let Ze=0;for(;!(xt.borders[Ie][0]>mt[1]-3)&&(Ze++,++Pe!==Ae.length);)xt=Se.featuresOnBorder[Ae[Pe]];xt=Se.featuresOnBorder[Ae[Pt]];let lt=!1;if(Ze>=1){const st=xt.borders[Ie];Math.abs(mt[0]-st[0])<3&&Math.abs(mt[1]-st[1])<3&&(Ze=1,lt=!0,Pe=Pt+1)}else if(Ze===0){h.showCentroid(Ke);continue}const Ge=Se.centroidData[xt.centroidDataIndex];b&&lt&&(((X=Je).flags|(J=Ge).flags)&r.dW?(X.flags|=r.dW,J.flags|=r.dW):(X.flags&=2147483647,J.flags&=2147483647));const bt=Ke.intersectsCount()>1||xt.intersectsCount()>1;if(Ze>1)Pe=Pt,Je.centroidXY=Ge.centroidXY=new r.P(0,0);else if(Le&&Le.dem&&!bt){const st=H[ne](Je,Ge),Ct=ne%2?r.aj-1:0,Wt=Q(st[0],Math.min(r.aj-1,st[1]),Ct,Le,ve,ne<2,st[2]);Je.centroidXY=Ge.centroidXY=I(Wt)}else bt?Je.centroidXY=Ge.centroidXY=new r.P(0,0):(Je.centroidXY=h.encodeBorderCentroid(Ke),Ge.centroidXY=Se.encodeBorderCentroid(xt));h.writeCentroidToBuffer(Je),Se.writeCentroidToBuffer(Ge)}else h.showCentroid(Ke)}h.borderDoneWithNeighborZ[ne]=Se.canonical.z,Se.borderDoneWithNeighborZ[Ie]=h.canonical.z}var X,J;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(u)}const Lm=[1,0,0],Cf=[0,1,0],ql=[0,0,1];function $l(u,t,s){const h=s.transform,_=s.shadowRenderer;if(!_)return!0;const y=u.toUnwrapped(),b=h.tileSize*_._cascades[s.currentShadowCascade].scale;let C=t.maxHeight;if(h.elevation){const X=h.elevation.getMinMaxForTile(u);X&&(C+=X.max)}const I=[..._.shadowDirection];I[2]=-I[2];const O=_.computeSimplifiedTileShadowVolume(y,C,b,I);if(!O)return!1;const k=[Lm,Cf,ql,I,[I[0],0,I[2]],[0,I[1],I[2]]],U=h.projection.name==="globe",V=h.scaleZoom(b),H=r.cn.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,V,!U),Q=_.getCurrentCascadeFrustum();return H.intersectsPrecise(O.vertices,O.planes,k)===0||Q.intersectsPrecise(O.vertices,O.planes,k)===0}function Ii(u){return[u[0]*r.dZ,u[1]*r.dZ,u[2]*r.dZ,0]}function Ss(u,t,s,h,_,y,b,C,I){const O=h.getSource(),k=s.globeSharedBuffers;if(!k)return;let U,V,H;if(t&&(U=h.getTile(t)),O instanceof r.aP?(V=O.texture,H=r.ds(0,0,s.transform)):U&&t&&(V=U.texture,H=r.ds(t.canonical.z,t.canonical.x,s.transform)),!V||!H)return;u||(H=r.cE(r.bz(),H,[1,-1,1]));const Q=s.context,X=Q.gl,J=_.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR,ne=s.colorModeForDrapableLayerRenderPass(y),oe=b.defines;oe.push("GLOBE_POLES");const ve=new yi(X.LEQUAL,yi.ReadWrite,s.depthRangeFor3D),Se=Float32Array.from(s.transform.expandedFarZProjMatrix),Le=Float32Array.from(r.bh(r.dr(new r.cp(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),Q.activeTexture.set(X.TEXTURE0),V.bind(J,X.CLAMP_TO_EDGE),Q.activeTexture.set(X.TEXTURE1),V.bind(J,X.CLAMP_TO_EDGE),"useMipmap"in V&&Q.extTextureFilterAnisotropic&&s.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,Q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Q.extTextureFilterAnisotropicMax);const[Ie,Ce,Ae,Pe]=t?k.getPoleBuffers(t.canonical.z,!1):k.getPoleBuffers(0,!0),Ne=_.paint.get("raster-elevation");let Ke;u?(Ke=Ie,s.renderDefaultNorthPole=Ne!==0):(Ke=Ce,s.renderDefaultSouthPole=Ne!==0);const Je=Ii(b.mix),mt=((Pt,Ze,lt,Ge,bt,st,Ct,Wt,wt,Vt,gi,di,hi)=>Bl(Pt,Ze,lt,new Float32Array(16),new Float32Array(9),[0,0],Ge,[0,0],[0,0,0,0],1,{opacity:1,mix:0},st,[0,0],Wt,2,Vt,gi,di,1,0,hi))(Se,Le,H,r.ah(s.transform.zoom),0,_,0,Ne,0,Je,b.offset,b.range,y),xt=s.getOrCreateProgram("raster",{defines:oe});s.uploadCommonUniforms(Q,xt,null),xt.draw(s,X.TRIANGLES,ve,I,ne,C,mt,_.id,Ke,Ae,Pe)}function Pp(u){const t=u._nearZ,s=u.projection.farthestPixelDistance(u),h=s-t,_=.2*u.height,y=t+_;return[t,s,(y-_-t)/h,(y-t)/h]}function Td(u,t,s,h){if(u)return t instanceof Cs&&u instanceof Ua?t.getTextureDescriptor(u,s,!0):{texture:u.texture,mix:Ii(h.mix),offset:h.offset,buffer:0,tileSize:1}}var Th=r.d_([{name:"a_index",type:"Int16",components:1}]);class Mf{constructor(t,s,h,_){const y={width:h[0],height:h[1],data:null},b=t.gl;this.targetColorTexture=new r.T(t,y,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,y,b.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(s,_),this.lastInvalidatedAt=0}updateParticleTexture(t,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const h=this.context.gl,_=s.width*s.height;this.particleTexture0=new r.T(this.context,s,h.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,s,h.RGBA8,{premultiply:!1,useMipmap:!1});const y=new r.d$;y.reserve(_);for(let b=0;b<_;b++)y.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(y,Th.members,!0),this.particleSegment=r.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Mc(u,t,s){if(!u)return null;const h=t.getTextureDescriptor(u,s,!0);if(!h)return null;let{texture:_,mix:y,offset:b,tileSize:C,buffer:I,format:O}=h;if(!_||!O)return null;let k=!1;return O==="uint32"&&(k=!0,y[3]=0,y=eu(r.e0,y,[0,s.paint.get("raster-particle-max-speed")]),b=Sf(r.e0,b,[0,s.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[I/(C+2*I),C/(C+2*I)],tileSize:C,scalarData:k,scale:y,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[O]]}}function Sd(u){const t=u._nearZ,s=u.projection.farthestPixelDistance(u),h=s-t,_=.2*u.height,y=t+_;return[t,s,(y-_-t)/h,(y-t)/h]}const Op=new r.am(1,0,0,1),Lp=new r.am(0,1,0,1),oo=new r.am(0,0,1,1),If=new r.am(1,0,1,1),Ma=new r.am(0,1,1,1);function Zl(u,t,s,h,_,y){for(let b=0;b<s.length;b++)if(_){const O=new r.am(h.r*.8,h.g*.8,h.b*.8,1);tu(u,t,s[b],h,-1,-1,y),tu(u,t,s[b],h,-1,1,y),tu(u,t,s[b],h,1,1,y),tu(u,t,s[b],h,1,-1,y),tu(u,t,s[b],O,0,0,y)}else tu(u,t,s[b],h,0,0,y)}function tu(u,t,s,h,_,y,b){const C=u.context,I=u.transform,O=C.gl,k=I.projection.name==="globe",U=k?["PROJECTION_GLOBE_VIEW"]:[];let V=r.bw(s.projMatrix);if(k&&r.ah(I.zoom)>0){const Je=r.bg(s.canonical,I),mt=r.e1(Je);V=r.az(new Float32Array(16),I.globeMatrix,mt),r.az(V,I.projMatrix,V)}const H=r.bz();H[12]+=2*_/(r.q.devicePixelRatio*I.width),H[13]+=2*y/(r.q.devicePixelRatio*I.height),r.az(V,H,V);const Q=u.getOrCreateProgram("debug",{defines:U}),X=t.getTileByID(s.key);u.terrain&&u.terrain.setupElevationDraw(X,Q);const J=yi.disabled,ne=qi.disabled,oe=u.colorModeForRenderPass(),ve="$debug";C.activeTexture.set(O.TEXTURE0),u.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),k?X._makeGlobeTileDebugBuffers(u.context,I):X._makeDebugTileBoundsBuffers(u.context,I.projection);const Se=X._tileDebugBuffer||u.debugBuffer,Le=X._tileDebugIndexBuffer||u.debugIndexBuffer,Ie=X._tileDebugSegments||u.debugSegments;if(Q.draw(u,O.LINE_STRIP,J,ne,oe,Fi.disabled,Cu(V,h.toPremultipliedRenderColor(null)),ve,Se,Le,Ie,null,null,null,[X._globeTileDebugBorderBuffer]),b){const Je=X.latestRawTileData,mt=Math.floor((Je&&Je.byteLength||0)/1024);let xt=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(xt+=` => ${s.overscaledZ}`),xt+=` ${X.state}`,xt+=` ${mt}kb`,function(Pt,Ze){Pt.initDebugOverlayCanvas();const lt=Pt.debugOverlayCanvas,Ge=Pt.context.gl,bt=Pt.debugOverlayCanvas.getContext("2d");bt.clearRect(0,0,lt.width,lt.height),bt.shadowColor="white",bt.shadowBlur=2,bt.lineWidth=1.5,bt.strokeStyle="white",bt.textBaseline="top",bt.font="bold 36px Open Sans, sans-serif",bt.fillText(Ze,5,5),bt.strokeText(Ze,5,5),Pt.debugOverlayTexture.update(lt),Pt.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(u,xt)}const Ce=t.getTile(s).tileSize,Ae=512/Math.min(Ce,512)*(s.overscaledZ/I.zoom)*.5,Pe=X._tileDebugTextBuffer||u.debugBuffer,Ne=X._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Ke=X._tileDebugTextSegments||u.debugSegments;Q.draw(u,O.TRIANGLES,J,ne,cn.alphaBlended,Fi.disabled,Cu(V,r.am.transparent.toPremultipliedRenderColor(null),Ae),ve,Pe,Ne,Ke,null,null,null,[X._globeTileDebugTextBuffer])}function Ed(u,t,s,h){Pu(u,0,t+s/2,u.transform.width,s,h)}function Sh(u,t,s,h){Pu(u,t-s/2,0,s,u.transform.height,h)}function Pu(u,t,s,h,_,y){const b=u.context,C=b.gl;C.enable(C.SCISSOR_TEST),C.scissor(t*r.q.devicePixelRatio,s*r.q.devicePixelRatio,h*r.q.devicePixelRatio,_*r.q.devicePixelRatio),b.clear({color:y}),C.disable(C.SCISSOR_TEST)}const zm=r.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Wl}=zm;function Kn(u,t,s,h){u.emplaceBack(t,s,h)}class Eh{constructor(t){this.vertexArray=new r.e2,this.indices=new r.a_,Kn(this.vertexArray,-1,-1,1),Kn(this.vertexArray,1,-1,1),Kn(this.vertexArray,-1,1,1),Kn(this.vertexArray,1,1,1),Kn(this.vertexArray,-1,-1,-1),Kn(this.vertexArray,1,-1,-1),Kn(this.vertexArray,-1,1,-1),Kn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Wl),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.bd.simpleSegment(0,0,36,12)}}function Xl(u,t,s,h,_,y){const b=u.context.gl,C=t.paint.get("sky-atmosphere-color"),I=t.paint.get("sky-atmosphere-halo-color"),O=t.paint.get("sky-atmosphere-sun-intensity"),k=((U,V,H,Q,X)=>({u_matrix_3f:U,u_sun_direction:V,u_sun_intensity:H,u_color_tint_r:[Q.r,Q.g,Q.b,Q.a],u_color_tint_m:[X.r,X.g,X.b,X.a],u_luminance:5e-5}))(r.e4(r.dx(),h),_,O,C.toPremultipliedRenderColor(null),I.toPremultipliedRenderColor(null));b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),s.draw(u,b.TRIANGLES,yi.disabled,qi.disabled,cn.unblended,Fi.frontCW,k,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const zp=r.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class kp{constructor(t){const s=new r.e5;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const h=new r.a_;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,zp.members),this.indexBuffer=t.createIndexBuffer(h),this.segments=r.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Np=r.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class km{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ou{constructor(t){this.colorModeAlphaBlendedWriteRGB=new cn([1,yu,1,yu],r.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new cn([1,0,1,0],r.am.transparent,[!1,!1,!1,!0]),this.params=new km,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const s=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new kp(s);const h=this.params.sizeRange,_=this.params.intensityRange,y=function(k){const U=r.e7(30),V=[];for(let H=0;H<k;++H){const Q=2*Math.PI*U(),X=Math.acos(1-2*U())-.5*Math.PI;V.push(r.cS(Math.cos(X)*Math.cos(Q),Math.cos(X)*Math.sin(Q),Math.sin(X)))}return V}(this.params.starsCount),b=r.e7(300),C=new r.e6,I=new r.a_;let O=0;for(let k=0;k<y.length;++k){const U=r.bY([],y[k],200),V=Math.max(0,1+.01*h*(1*b()-.5)),H=Math.max(0,1+.01*_*(1*b()-.5));C.emplaceBack(U[0],U[1],U[2],-1,-1,V,H),C.emplaceBack(U[0],U[1],U[2],1,-1,V,H),C.emplaceBack(U[0],U[1],U[2],1,1,V,H),C.emplaceBack(U[0],U[1],U[2],-1,1,V,H),I.emplaceBack(O+0,O+1,O+2),I.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=s.createVertexBuffer(C,Np.members),this.starsIdx=s.createIndexBuffer(I),this.starsSegments=r.bd.simpleSegment(0,0,C.length,I.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,s){const h=t.context,_=h.gl,y=t.transform,b=new yi(_.LEQUAL,yi.ReadOnly,[0,1]),C=r.ah(y.zoom),I=t.style.getLut(s.scope),O=s.properties.get("color-use-theme")==="none",k=s.properties.get("color").toNonPremultipliedRenderColor(O?null:I).toArray01(),U=s.properties.get("high-color-use-theme")==="none",V=s.properties.get("high-color").toNonPremultipliedRenderColor(U?null:I).toArray01(),H=s.properties.get("space-color-use-theme")==="none",Q=s.properties.get("space-color").toNonPremultipliedRenderColor(H?null:I).toArray01(),X=5e-4,J=r.e8(s.properties.get("horizon-blend"),0,1,X,.25),ne=r.dl(t,h,y)&&J===X?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,oe=t.frameCounter/1e3%1,ve=r.ae(y.globeCenterInViewSpace),Se=Math.sqrt(Math.pow(ve,2)-Math.pow(ne,2)),Le=Math.acos(Se/ve),Ie=Ce=>{const Ae=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ce&&Ae.push("ALPHA_PASS");const Pe=t.getOrCreateProgram("globeAtmosphere",{defines:Ae}),Ne=((Je,mt,xt,Pt,Ze,lt,Ge,bt,st,Ct,Wt,wt)=>({u_frustum_tl:Je,u_frustum_tr:mt,u_frustum_br:xt,u_frustum_bl:Pt,u_horizon:Ze,u_transition:lt,u_fadeout_range:Ge,u_color:bt,u_high_color:st,u_space_color:Ct,u_temporal_offset:Wt,u_horizon_angle:wt}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,C,J,k,V,Q,oe,Le);t.uploadCommonUniforms(h,Pe);const Ke=this.atmosphereBuffer;Ke&&Pe.draw(t,_.TRIANGLES,b,qi.disabled,Ce?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Fi.backCW,Ne,Ce?"atmosphere_glow_alpha":"atmosphere_glow",Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)};Ie(!1),Ie(!0)}drawStars(t,s){const h=r.ay(s.properties.get("star-intensity"),0,1);if(h===0)return;const _=t.context,y=_.gl,b=t.transform,C=t.getOrCreateProgram("stars"),I=r.b_([]);r.c0(I,I,-b._pitch),r.b$(I,I,-b.angle),r.c0(I,I,r.al(b._center.lat)),r.e9(I,I,-r.al(b._center.lng));const O=r.c3(new Float32Array(16),I),k=r.az([],b.starsProjMatrix,O),U=r.e4([],O),V=r.ea([],U),H=[0,1,0];r.dz(H,H,V),r.bY(H,H,this.params.sizeMultiplier);const Q=[1,0,0];r.dz(Q,Q,V),r.bY(Q,Q,this.params.sizeMultiplier);const X=(J=H,ne=Q,oe=h,{u_matrix:Float32Array.from(k),u_up:J,u_right:ne,u_intensity_multiplier:oe});var J,ne,oe;t.uploadCommonUniforms(_,C),this.starsVx&&this.starsIdx&&C.draw(t,y.TRIANGLES,yi.disabled,qi.disabled,this.colorModeAlphaBlendedWriteRGB,Fi.disabled,X,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Lu(u,t){const s=[...u],h=t.cameraWorldSizeForFog/t.worldSize,_=r.bx([]);return r.cE(_,_,[h,h,1]),r.az(s,_,s),r.az(s,t.worldToFogMatrix,s),s}function Ut(u,t,s,h,_){const y=s.material,b=h.context,{baseColorTexture:C,metallicRoughnessTexture:I}=y.pbrMetallicRoughness,{normalTexture:O,occlusionTexture:k,emissionTexture:U}=y;function V(Q,X,J){if(Q&&(u.push(X),b.activeTexture.set(b.gl.TEXTURE0+J),Q.gfxTexture)){const{minFilter:ne,magFilter:oe,wrapS:ve,wrapT:Se}=Q.sampler;Q.gfxTexture.bindExtraParam(ne,oe,ve,Se)}}V(C,"HAS_TEXTURE_u_baseColorTexture",Aa.BaseColor),V(I,"HAS_TEXTURE_u_metallicRoughnessTexture",Aa.MetallicRoughness),V(O,"HAS_TEXTURE_u_normalTexture",Aa.Normal),V(k,"HAS_TEXTURE_u_occlusionTexture",Aa.Occlusion),V(U,"HAS_TEXTURE_u_emissionTexture",Aa.Emission),_&&(_.texture||(_.texture=new r.eh(h.context,_.image,[_.image.height,_.image.height,_.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+Aa.LUT),_.texture&&_.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(s.texcoordBuffer)),s.colorBuffer&&(u.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(s.colorBuffer)),s.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(s.normalBuffer)),s.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(s.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||u.push("DIFFUSE_SHADED");const H=h.shadowRenderer;H&&(u.push("RENDER_SHADOWS","DEPTH_TEXTURE"),H.useNormalOffset&&u.push("NORMAL_OFFSET"))}function ni(u,t,s,h,_,y){const b=s.paint.get("model-opacity").constantOr(1),C=t.context,I=new yi(t.context.gl.LEQUAL,yi.ReadWrite,t.depthRangeFor3D),O=t.transform,k=u.mesh,U=k.material,V=U.pbrMetallicRoughness,H=t.style.fog;let Q;Q=t.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:r.az([],h.zScaleMatrix,u.nodeModelMatrix),r.az(Q,h.negCameraPosMatrix,Q);const X=r.bi([],Q);r.ee(X,X);const J=s.paint.get("model-color-use-theme").constantOr("default")==="none",ne=s.paint.get("model-emissive-strength").constantOr(0),oe=wh(new Float32Array(u.worldViewProjection),new Float32Array(Q),new Float32Array(X),null,t,b,V.baseColorFactor,U.emissiveFactor,V.metallicFactor,V.roughnessFactor,U,ne,s),ve={defines:[]},Se=[],Le=t.shadowRenderer;Le&&(Le.useNormalOffset=!1),Ut(ve.defines,Se,k,t,J?null:s.lut);let Ie=null;if(H){const Pe=Lu(u.nodeModelMatrix,t.transform);if(Ie=new Float32Array(Pe),O.projection.name!=="globe"){const Ne=k.aabb.min,Ke=k.aabb.max,[Je,mt]=H.getOpacityForBounds(Pe,Ne[0],Ne[1],Ke[0],Ke[1]);ve.overrideFog=Je>=rt||mt>=rt}}const Ce=zl(t,s.paint.get("model-cutoff-fade-range"));Ce.shouldRenderCutoff&&ve.defines.push("RENDER_CUTOFF");const Ae=t.getOrCreateProgram("model",ve);t.uploadCommonUniforms(C,Ae,null,Ie,Ce),t.renderPass!=="shadow"&&Le&&Le.setupShadowsFromMatrix(u.nodeModelMatrix,Ae),Ae.draw(t,C.gl.TRIANGLES,I,_,y,k.material.doubleSided?Fi.disabled:Fi.backCCW,oe,s.id,k.vertexBuffer,k.indexBuffer,k.segments,s.paint,t.transform.zoom,void 0,Se)}function Yl(u,t,s,h,_,y,b){let C;C=u.projection.name==="globe"?r.ed(s,u):[...s],r.az(C,C,t.matrix);const I=r.az([],h,C);if(t.meshes)for(const O of t.meshes){if(O.material.alphaMode!=="BLEND"){b.push({mesh:O,depth:0,modelIndex:_,worldViewProjection:I,nodeModelMatrix:C});continue}const k=r.ad([],O.centroid,I);!u.isOrthographic&&k[2]<=0||y.push({mesh:O,depth:k[2],modelIndex:_,worldViewProjection:I,nodeModelMatrix:C})}if(t.children)for(const O of t.children)Yl(u,O,s,h,_,y,b)}function zr(u,t,s,h){const _=s.shadowRenderer;if(!_)return;const y=_.getShadowPassDepthMode(),b=_.getShadowPassColorMode(),C=_.calculateShadowPassMatrixFromMatrix(t),I=Du(C);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,y,qi.disabled,b,Fi.backCCW,I,h.id,u.vertexBuffer,u.indexBuffer,u.segments,h.paint,s.transform.zoom,void 0,void 0)}function Ye(u,t,s){const h=t.updateZoomBasedPaintProperties(),_=function(y,b,C){let I,O,k,U=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&U>0){const V=y.terrain,H=V.findDEMTileFor(C);H&&H.dem?I=r.ei.create(V,C,H):U=0}if(U===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),U===b.validForExaggeration&&(U===0||I&&I._demTile&&I._demTile.tileID===b.validForDEMTile.id&&I._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const V in b.instancesPerModel){const H=b.instancesPerModel[V];for(let Q=0;Q<H.instancedDataArray.length;++Q){const X=(I?U*I.getElevationAt(0|H.instancedDataArray.float32[16*Q],0|H.instancedDataArray.float32[16*Q+1],!0,!0):0)+H.instancesEvaluatedElevation[Q];H.instancedDataArray.float32[16*Q+6]=X,O=O?Math.min(b.terrainElevationMin,X):X,k=k?Math.max(b.terrainElevationMax,X):X}}return b.terrainElevationMin=O||0,b.terrainElevationMax=k||0,b.validForExaggeration=U,b.validForDEMTile=I&&I._demTile?{id:I._demTile.tileID,timestamp:I._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,t,s);(h||_)&&(t.uploaded=!1,t.upload(u.context))}const lo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.cW([0,0,0],[r.aj,r.aj,0])};function Ad(u,t){const s=1<<u.canonical.z,h=t.getFreeCameraOptions().position,_=t.elevation,y=u.canonical.x/s,b=(u.canonical.x+1)/s,C=u.canonical.y/s,I=(u.canonical.y+1)/s;let O=t._centerAltitude;if(_){const H=_.getMinMaxForTile(u);H&&H.max>O&&(O=H.max)}const k=r.ay(h.x,y,b)-h.x,U=r.ay(h.y,C,I)-h.y,V=r.c6(O,t.center.lat)-h.z;return t._zoomFromMercatorZ(Math.sqrt(k*k+U*U+V*V))}function Cd(u,t,s,h,_,y,b){const C=u.context,I=u.renderPass==="shadow",O=u.shadowRenderer,k=I&&O?O.getShadowPassDepthMode():new yi(C.gl.LEQUAL,yi.ReadWrite,u.depthRangeFor3D),U=u.isTileAffectedByFog(y);if(s.meshes)for(const V of s.meshes){const H=["MODEL_POSITION_ON_GPU"],Q=[];let X,J,ne;h.instancedDataArray.length>20&&H.push("INSTANCED_ARRAYS");const oe=zl(u,t.paint.get("model-cutoff-fade-range"));if(oe.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),I&&O)X=u.getOrCreateProgram("modelDepth",{defines:H}),J=Du(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(s.matrix)),ne=O.getShadowPassColorMode();else{Ut(H,Q,V,u,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),X=u.getOrCreateProgram("model",{defines:H,overrideFog:U});const Se=V.material,Le=Se.pbrMetallicRoughness,Ie=t.paint.get("model-opacity").constantOr(1),Ce=t.paint.get("model-emissive-strength").constantOr(0);J=wh(y.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,u,Ie,Le.baseColorFactor,Se.emissiveFactor,Le.metallicFactor,Le.roughnessFactor,Se,Ce,t,_),O&&(b.shadowUniformsInitialized?X.setShadowUniformValues(C,O.getShadowUniformValues()):(O.setupShadows(y.toUnwrapped(),X,"model-tile",y.overscaledZ),b.shadowUniformsInitialized=!0)),ne=oe.shouldRenderCutoff||Ie<1||Se.alphaMode!=="OPAQUE"?cn.alphaBlended:cn.unblended}u.uploadCommonUniforms(C,X,y.toUnwrapped(),null,oe);const ve=V.material.doubleSided?Fi.disabled:Fi.backCCW;if(h.instancedDataArray.length>20)Q.push(h.instancedDataBuffer),X.draw(u,C.gl.TRIANGLES,k,qi.disabled,ne,ve,J,t.id,V.vertexBuffer,V.indexBuffer,V.segments,t.paint,u.transform.zoom,void 0,Q,h.instancedDataArray.length);else{const Se=I?"u_instance":"u_normal_matrix";for(let Le=0;Le<h.instancedDataArray.length;++Le)J[Se]=new Float32Array(h.instancedDataArray.arrayBuffer,64*Le,16),X.draw(u,C.gl.TRIANGLES,k,qi.disabled,ne,ve,J,t.id,V.vertexBuffer,V.indexBuffer,V.segments,t.paint,u.transform.zoom,void 0,Q)}}if(s.children)for(const V of s.children)Cd(u,t,V,h,_,y,b)}const Rf=[1,-1,1];function Fp(u,t,s,h){if(!s.modelManager)return!0;const _=s.modelManager;if(!s.shadowRenderer)return!0;const y=s.shadowRenderer,b=t.aabb;let C=!0,I=u.maxHeight;if(I===0){let k=0;for(const U in u.instancesPerModel){const V=_.getModel(U,h);V?k=Math.max(k,Math.max(Math.max(V.aabb.max[0],V.aabb.max[1]),V.aabb.max[2])):C=!1}I=u.maxScale*k*1.41+u.maxVerticalOffset,C&&(u.maxHeight=I)}b.max[2]=I,b.min[2]+=u.terrainElevationMin,b.max[2]+=u.terrainElevationMax,r.ad(b.min,b.min,t.tileMatrix),r.ad(b.max,b.max,t.tileMatrix);const O=b.intersects(y.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=O===2),O===0}function Bp(u,t){const s=u.uniformValues.u_cutoff_params[0],h=u.uniformValues.u_cutoff_params[1],_=u.uniformValues.u_cutoff_params[2],y=u.uniformValues.u_cutoff_params[3];return h===s||y===_?1:r.ay(((t-s)/(h-s)-_)/(y-_),0,1)}function zu(u,t,s,h){if(t.pitch<20)return 1;const _=t.getWorldToCameraMatrix();r.az(_,_,u);const y=r.ej(s.min[0],s.min[1],s.min[2],1);let b=r.aA(r.ek(),y,_),C=b,I=b;y[1]=s.max[1],b=r.aA(r.ek(),y,_),C=b[1]<C[1]?b:C,I=b[1]>I[1]?b:I,y[0]=s.max[0],b=r.aA(r.ek(),y,_),C=b[1]<C[1]?b:C,I=b[1]>I[1]?b:I,y[1]=s.min[1],b=r.aA(r.ek(),y,_),C=b[1]<C[1]?b:C,I=b[1]>I[1]?b:I;const O=r.ay(h[0],0,1),k=100*t.pixelsPerMeter*r.ay(h[1],0,1),U=r.ay(h[2],0,1),V=r.el(r.ek(),C,I,O),H=Math.tan(.5*t.fovX),Q=-V[2]*H;if(k===0)return V[1]<-Math.abs(Q)?U:1;const X=(-Math.abs(Q)-V[1])/k,J=(oe,ve,Se)=>(1-Se)*oe+Se*ve,ne=r.ay(J(1,U,X),U,1);return J(1,ne,r.ay((t.pitch-20)/20,0,1))}class jp{}class Nm{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,s,h){{const U=this._storage.get(s.id);if(U)return U.lastUsedFrameIdx=t,U.buf}const _=h.gl,y=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),b=new ArrayBuffer(y),C=new Int16Array(b);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const I=new r.en;for(let U=0;U<y/2;U+=3){const V=C[U],H=C[U+1],Q=C[U+2];I.emplaceBack(V,H),I.emplaceBack(H,Q),I.emplaceBack(Q,V)}const O=h.bindVertexArrayOES.current,k=new jp;return k.buf=new Oo(h,I),k.lastUsedFrameIdx=t,this._storage.set(s.id,k),h.bindVertexArrayOES.set(O),k.buf}update(t){for(const[s,h]of this._storage)t-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(s))}destroy(){for(const[t,s]of this._storage)s.buf.destroy(),this._storage.delete(t)}}class Vp{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Ah=r.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Df{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Pf{constructor(t,s){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...s,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...s,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Fm=r.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Ch{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,s){const h=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const b=new r.eo,C=new r.a_;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(1,1),b.emplaceBack(-1,1),C.emplaceBack(0,1,2),C.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(b,Fm.members),this.vignetteIdx=t.context.createIndexBuffer(C)}const _=r.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,h);const b={u_vignetteShape:(y={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};h.draw(t,t.context.gl.TRIANGLES,yi.disabled,qi.disabled,cn.alphaBlended,Fi.disabled,b,"vignette",this.vignetteVx,this.vignetteIdx,_)}var y}}class Mh{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,s){const h=t.getFreeCameraOptions().position,_=h.toAltitude(),y=h.toLngLat(),b=r.al(y.lng),C=r.al(y.lat),I=t.pixelsPerMeter/s,O=b*r.eq,k=r.eq*Math.log(Math.tan(Math.PI/4+C/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const U=-this._offsetYPrev+k,V=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+O)*I,this._accumulatedOffsetY+=U*I,this._accumulatedElevation+=V*I,this._offsetXPrev=O,this._offsetYPrev=k,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function iu(u,t){return[-(u[0]-Math.floor(u[0]/t)*t),-(u[1]-Math.floor(u[1]/t)*t),-(u[2]-Math.floor(u[2]/t)*t)]}function Md(u){const t=r.e7(1323123451230),s=[];for(let h=0;h<u;++h){const _=2*t()-1,y=2*t()-1,b=2*t()-1;s.push(r.cS(_,y,b))}return s}function Ic(u,t,s,h,_){const y=r.ay((_-s)/(h-s),0,1);return(1-y)*u+y*t}class da{constructor(t){this._movement=new Mh,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Ch,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,s){const h=t.transform;this._movement.update(h,this._ppmScaleFactor);const _=h.starsProjMatrix,y=r.b_([]);r.c0(y,y,r.al(90)-h._pitch),r.b$(y,y,-h.angle);const b=r.c3(new Float32Array(16),y),C=r.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),I=r.ee([],C),O=r.az([],I,b),k=Date.now()/1e3;return this._accumulatedTimeFromStart+=(k-this._prevTime)*s,this._prevTime=k,{projectionMatrix:_,modelviewMatrix:O}}}class Ug extends da{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Pf(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const h=Md(this.particlesCount),_=new r.er,y=new r.a_;let b=0;const C=r.e7(1323123451230);for(let I=0;I<h.length;++I){const O=h[I],k=[2*C()-1,C(),C(),C()];_.emplaceBack(O[0],O[1],O[2],-1,-1,...k),_.emplaceBack(O[0],O[1],O[2],1,-1,...k),_.emplaceBack(O[0],O[1],O[2],1,1,...k),_.emplaceBack(O[0],O[1],O[2],-1,1,...k),y.emplaceBack(b+0,b+1,b+2),y.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=s.createVertexBuffer(_,Ah.members),this.particlesIdx=s.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},h=t.transform.zoom;if(s.revealStart>h)return;const _=Ic(0,1,s.revealStart,s.revealStart+s.revealRange,h);if(!this.particlesVx||!this.particlesIdx)return;const y=structuredClone(this._params);let b=[-y.direction.x,y.direction.y,-100];r.au(b,b);const C=structuredClone(this._vignetteParams);C.strength*=_,y.overrideStyleParameters||(y.intensity=t.style.rain.state.density,y.timeFactor=t.style.rain.state.intensity,y.color=structuredClone(t.style.rain.state.color),b=structuredClone(t.style.rain.state.direction),y.screenThinning.intensity=t.style.rain.state.centerThinning,y.dropletSizeX=t.style.rain.state.dropletSize[0],y.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],y.distortionStrength=100*t.style.rain.state.distortionStrength,C.strength=1,C.color=structuredClone(t.style.rain.state.vignetteColor));const I=this.updateOnRender(t,y.timeFactor),O=t.context,k=O.gl,U=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(O,{width:t.width,height:t.height,data:null},k.RGBA8)),y.distortionStrength>0&&(O.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const V=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(O,V),O.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const H=[y.color.r,y.color.g,y.color.b,y.color.a],Q=(X,J)=>{const ne=iu(this._movement.getPosition(),X),oe=y.dropletSizeX,ve=y.dropletSizeX*y.dropletSizeYScale,Se=t.width/2,Le=t.height/2,Ie=Ic(0,y.screenThinning.start,0,1,y.screenThinning.intensity),Ce=Ic(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),Ae=Ic(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),Pe=(Ne={modelview:I.modelviewMatrix,projection:I.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ne,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:X,rainDropletSize:[oe,ve],distortionStrength:y.distortionStrength,rainDirection:b,color:H,screenSize:[U.width,U.height],thinningCenterPos:[Se,Le],thinningShape:[Ie,Ce,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:Ae,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:J?0:1},{u_modelview:Float32Array.from(Ne.modelview),u_projection:Float32Array.from(Ne.projection),u_time:Ne.time,u_cam_pos:Ne.camPos,u_texScreen:0,u_velocityConeAperture:Ne.velocityConeAperture,u_velocity:Ne.velocity,u_boxSize:Ne.boxSize,u_rainDropletSize:Ne.rainDropletSize,u_distortionStrength:Ne.distortionStrength,u_rainDirection:Ne.rainDirection,u_color:Ne.color,u_screenSize:Ne.screenSize,u_thinningCenterPos:Ne.thinningCenterPos,u_thinningShape:Ne.thinningShape,u_thinningAffectedRatio:Ne.thinningAffectedRatio,u_thinningParticleOffset:Ne.thinningParticleOffset,u_shapeDirectionalPower:Ne.shapeDirectionalPower,u_shapeNormalPower:Ne.shapeNormalPower,u_mode:Ne.mode});var Ne;const Ke=Math.round(y.intensity*this.particlesCount),Je=r.bd.simpleSegment(0,0,4*Ke,2*Ke);V.draw(t,k.TRIANGLES,yi.disabled,qi.disabled,cn.alphaBlended,Fi.disabled,Pe,"rain_particles",this.particlesVx,this.particlesIdx,Je)};y.distortionStrength>0&&Q(y.boxSize,!0),Q(y.boxSize,!1),this._vignette.draw(t,C)}}const Id=r.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class gr extends da{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Pf(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const h=Md(this.particlesCount),_=new r.es,y=new r.a_;let b=0;const C=r.e7(1323123451230);for(let I=0;I<h.length;++I){const O=h[I],k=C(),U=C(),V=C(),H=[I/h.length,k,U,V],Q=[C(),C()];_.emplaceBack(O[0],O[1],O[2],-1,-1,...H,...Q),_.emplaceBack(O[0],O[1],O[2],1,-1,...H,...Q),_.emplaceBack(O[0],O[1],O[2],1,1,...H,...Q),_.emplaceBack(O[0],O[1],O[2],-1,1,...H,...Q),y.emplaceBack(b+0,b+1,b+2),y.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=s.createVertexBuffer(_,Id.members),this.particlesIdx=s.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const s=structuredClone(this._params);let h=[-s.direction.x,s.direction.y,-100];r.au(h,h);const _=structuredClone(this._vignetteParams),y=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},b=t.transform.zoom;if(y.revealStart>b)return;const C=Ic(0,1,y.revealStart,y.revealStart+y.revealRange,b);_.strength*=C,s.overrideStyleParameters||(s.intensity=t.style.snow.state.density,s.timeFactor=t.style.snow.state.intensity,s.color=structuredClone(t.style.snow.state.color),h=structuredClone(t.style.snow.state.direction),s.screenThinning.intensity=t.style.snow.state.centerThinning,s.billboardSize=2.79*t.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(t.style.snow.state.vignetteColor));const I=this.updateOnRender(t,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const O=t.context,k=O.gl,U=t.transform,V=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(O,V),((H,Q,X)=>{const J=iu(this._movement.getPosition(),H),ne=U.width/2,oe=U.height/2,ve=Ic(0,X.screenThinning.start,0,1,X.screenThinning.intensity),Se=Ic(.001,X.screenThinning.range,0,1,X.screenThinning.intensity),Le=Ic(0,X.screenThinning.particleOffset,0,1,X.screenThinning.intensity),Ie=(Ce={modelview:I.modelviewMatrix,projection:I.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:X.velocityConeAperture,velocity:X.velocity,horizontalOscillationRadius:X.horizontalOscillationRadius,horizontalOscillationRate:X.horizontalOscillationRate,boxSize:H,billboardSize:1*X.billboardSize,simpleShapeParameters:[X.shapeFadeStart,X.shapeFadePower],screenSize:[U.width,U.height],thinningCenterPos:[ne,oe],thinningShape:[ve,Se,Math.pow(10,X.screenThinning.fadePower)],thinningAffectedRatio:X.screenThinning.affectedRatio,thinningParticleOffset:Le,color:[X.color.r,X.color.g,X.color.b,X.color.a],direction:h},{u_modelview:Float32Array.from(Ce.modelview),u_projection:Float32Array.from(Ce.projection),u_time:Ce.time,u_cam_pos:Ce.camPos,u_velocityConeAperture:Ce.velocityConeAperture,u_velocity:Ce.velocity,u_horizontalOscillationRadius:Ce.horizontalOscillationRadius,u_horizontalOscillationRate:Ce.horizontalOscillationRate,u_boxSize:Ce.boxSize,u_billboardSize:Ce.billboardSize,u_simpleShapeParameters:Ce.simpleShapeParameters,u_screenSize:Ce.screenSize,u_thinningCenterPos:Ce.thinningCenterPos,u_thinningShape:Ce.thinningShape,u_thinningAffectedRatio:Ce.thinningAffectedRatio,u_thinningParticleOffset:Ce.thinningParticleOffset,u_particleColor:Ce.color,u_direction:Ce.direction});var Ce;const Ae=Math.round(X.intensity*this.particlesCount),Pe=r.bd.simpleSegment(0,0,4*Ae,2*Ae);this.particlesVx&&this.particlesIdx&&V.draw(t,k.TRIANGLES,yi.disabled,qi.disabled,cn.alphaBlended,Fi.disabled,Ie,"snow_particles",this.particlesVx,this.particlesIdx,Pe)})(s.boxSize,0,s),this._vignette.draw(t,_)}}const En={symbol:function(u,t,s,h,_){if(u.renderPass!=="translucent")return;const y=qi.disabled,b=u.colorModeForRenderPass(),C=s.layout.get("text-variable-anchor"),I=s.layout.get("text-size-scale-range"),O=r.ay(u.scaleFactor,I[0],I[1]);C&&function(V,H,Q,X,J,ne,oe,ve){const Se=H.transform,Le=J==="map",Ie=ne==="map";for(const Ce of V){const Ae=X.getTile(Ce),Pe=Ae.getBucket(Q);if(!Pe||!Pe.text||!Pe.text.segments.get().length)continue;const Ne=r.bH(Pe.textSizeData,Se.zoom,ve),Ke=Go(Ce,Pe.getProjection(),Se),Je=Se.calculatePixelsToTileUnitsMatrix(Ae),mt=Gs(Ke,Ae.tileID.canonical,Ie,Le,Se,Pe.getProjection(),Je),xt=Pe.hasIconTextFit()&&Pe.hasIconData();Ne&&bd(Pe,Le,Ie,oe,Se,mt,Ce,Math.pow(2,Se.zoom-Ae.tileID.overscaledZ),Ne,xt)}}(h,u,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),_,O);const k=s.paint.get("icon-opacity").constantOr(1)!==0,U=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||U)?Gl(u,t,s,h,y,b):(k&&Gl(u,t,s,h,y,b,{onlyIcons:!0}),U&&Gl(u,t,s,h,y,b,{onlyText:!0})),t.map.showCollisionBoxes&&(Is(u,t,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Is(u,t,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,s,h){if(u.renderPass!=="translucent")return;const _=s.paint.get("circle-opacity"),y=s.paint.get("circle-stroke-width"),b=s.paint.get("circle-stroke-opacity"),C=s.layout.get("circle-sort-key").constantOr(1)!==void 0,I=s.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;const O=u.context,k=O.gl,U=u.transform,V=!(!u.terrain||!u.terrain.enabled),H=s.layout.get("circle-elevation-reference"),Q=u.depthModeForSublayer(0,yi.ReadOnly),X=new yi(u.context.gl.LEQUAL,yi.ReadOnly,u.depthRangeFor3D),J=H==="none"||V?Q:X,ne=qi.disabled,oe=u.colorModeForDrapableLayerRenderPass(I),ve=U.projection.name==="globe",Se=[r.aD(U.center.lng),r.aH(U.center.lat)],Le=[];for(let Ce=0;Ce<h.length;Ce++){const Ae=h[Ce],Pe=t.getTile(Ae),Ne=Pe.getBucket(s);if(!Ne||Ne.projection.name!==U.projection.name)continue;const Ke=Ne.programConfigurations.get(s.id),Je=Ne.layoutVertexBuffer,mt=Ne.globeExtVertexBuffer,xt=Ne.indexBuffer,Pt=r.dK(s),Ze=[mt],lt=u.isTileAffectedByFog(Ae);ve&&Pt.push("PROJECTION_GLOBE_VIEW"),Pt.push("DEPTH_D24"),u.terrain&&U.depthOcclusionForSymbolsAndCircles&&Pt.push("DEPTH_OCCLUSION"),Ne.hasElevation&&(Pt.push("ELEVATED_ROADS"),Ze.push(Ne.elevatedLayoutVertexBuffer));const Ge=u.getOrCreateProgram("circle",{config:Ke,defines:Pt,overrideFog:lt}),bt=U.projection.createInversionMatrix(U,Ae.canonical),st={programConfiguration:Ke,program:Ge,layoutVertexBuffer:Je,dynamicBuffers:Ze,indexBuffer:xt,uniformValues:r.dL(u,Ae,Pe,bt,Se,s),tile:Pe};if(C){const Ct=Ne.segments.get();for(const Wt of Ct)Le.push({segments:new r.bd([Wt]),sortKey:Wt.sortKey,state:st})}else Le.push({segments:Ne.segments,sortKey:0,state:st})}C&&Le.sort((Ce,Ae)=>Ce.sortKey-Ae.sortKey);const Ie={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const Ce of Le){const{programConfiguration:Ae,program:Pe,layoutVertexBuffer:Ne,dynamicBuffers:Ke,indexBuffer:Je,uniformValues:mt,tile:xt}=Ce.state,Pt=Ce.segments;u.terrain&&u.terrain.setupElevationDraw(xt,Pe,Ie),u.uploadCommonUniforms(O,Pe,xt.tileID.toUnwrapped()),Pe.draw(u,k.TRIANGLES,J,ne,oe,Fi.disabled,mt,s.id,Ne,Je,Pt,s.paint,U.zoom,Ae,Ke)}},heatmap:function(u,t,s,h){if(s.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const _=u.context,y=_.gl,b=qi.disabled,C=new cn([y.ONE,y.ONE,y.ONE,y.ONE],r.am.transparent,[!0,!0,!0,!0]);(function(H,Q,X,J){const ne=H.gl,oe=Q.width*J,ve=Q.height*J;H.activeTexture.set(ne.TEXTURE1),H.viewport.set([0,0,oe,ve]);let Se=X.heatmapFbo;if(!Se||Se&&(Se.width!==oe||Se.height!==ve)){Se&&Se.destroy();const Le=ne.createTexture();ne.bindTexture(ne.TEXTURE_2D,Le),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MAG_FILTER,ne.LINEAR),Se=X.heatmapFbo=H.createFramebuffer(oe,ve,!0,null),function(Ie,Ce,Ae,Pe,Ne,Ke){const Je=Ie.gl;Je.texImage2D(Je.TEXTURE_2D,0,Ie.extRenderToTextureHalfFloat?Je.RGBA16F:Je.RGBA,Ne,Ke,0,Je.RGBA,Ie.extRenderToTextureHalfFloat?Je.HALF_FLOAT:Je.UNSIGNED_BYTE,null),Pe.colorAttachment.set(Ae)}(H,0,Le,Se,oe,ve)}else ne.bindTexture(ne.TEXTURE_2D,Se.colorAttachment.get()),H.bindFramebuffer.set(Se.framebuffer)})(_,u,s,u.transform.projection.name==="globe"?.5:.25),_.clear({color:r.am.transparent});const I=u.transform,O=I.projection.name==="globe",k=O?["PROJECTION_GLOBE_VIEW"]:[],U=O?Fi.frontCCW:Fi.disabled,V=[r.aD(I.center.lng),r.aH(I.center.lat)];for(let H=0;H<h.length;H++){const Q=h[H];if(t.hasRenderableParent(Q))continue;const X=t.getTile(Q),J=X.getBucket(s);if(!J||J.projection.name!==I.projection.name)continue;const ne=u.isTileAffectedByFog(Q),oe=J.programConfigurations.get(s.id),ve=u.getOrCreateProgram("heatmap",{config:oe,defines:k,overrideFog:ne}),{zoom:Se}=u.transform;u.terrain&&u.terrain.setupElevationDraw(X,ve),u.uploadCommonUniforms(_,ve,Q.toUnwrapped());const Le=I.projection.createInversionMatrix(I,Q.canonical);ve.draw(u,y.TRIANGLES,yi.disabled,b,C,U,vh(u,Q,X,Le,V,Se,s.paint.get("heatmap-intensity")),s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,u.transform.zoom,oe,O?[J.globeExtVertexBuffer]:null)}_.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(_,y){const b=_.context,C=b.gl,I=y.heatmapFbo;if(!I)return;b.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,I.colorAttachment.get()),b.activeTexture.set(C.TEXTURE1);let O=y.colorRampTexture;O||(O=y.colorRampTexture=new r.T(b,y.colorRamp,C.RGBA8)),O.bind(C.LINEAR,C.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,C.TRIANGLES,yi.disabled,qi.disabled,_.colorModeForRenderPass(),Fi.disabled,((k,U,V,H)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)}(u,s))},line:function(u,t,s,h){if(u.renderPass!=="translucent")return;const _=s.paint.get("line-opacity"),y=s.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;const b=s.paint.get("line-emissive-strength"),C=s.paint.get("line-occlusion-opacity"),I=s.layout.get("line-elevation-reference"),O=s.layout.get("line-width-unit")==="meters",k=I==="sea",U=!(!u.terrain||!u.terrain.enabled),V=u.context,H=V.gl;if(s.hasElevatedBuckets&&u.transform.projection.name==="globe")return;const Q=s.layout.get("line-cross-slope"),X=Q!==void 0,J=Q<1,ne=u.colorModeForDrapableLayerRenderPass(b),oe=u.terrain&&u.terrain.renderingToTexture,ve=oe?1:r.q.devicePixelRatio,Se=s.paint.get("line-dasharray"),Le=Se.constantOr(1),Ie=s.layout.get("line-cap"),Ce=Se.constantOr(null),Ae=Ie.constantOr(null),Pe=s.paint.get("line-pattern"),Ne=Pe.constantOr(1),Ke=s.paint.get("line-pattern-cross-fade"),Je=Pe.constantOr(null),mt=s.paint.get("line-opacity").constantOr(1);let xt=!Ne&&mt!==1||u.depthOcclusion&&C>0&&C<1;const Pt=s.paint.get("line-gradient"),Ze=Ne?"linePattern":"line",lt=r.dM(s);let Ge;if(oe&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(xt=!1),C!==0&&u.depthOcclusion){const Wt=s.paint._values["line-opacity"];Wt&&Wt.value&&Wt.value.kind==="constant"?Ge=Wt.value:r.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&lt.push("VARIABLE_LINE_WIDTH");const bt=(Wt,wt,Vt,gi,di,hi)=>{for(const Ai of Wt){const Pi=t.getTile(Ai);if(Ne&&!Pi.patternsLoaded())continue;const fi=Pi.getBucket(s);if(!fi||fi.elevationType!=="none"&&!di||fi.elevationType==="none"&&di)continue;u.prepareDrawTile();const Ci=[...wt],Ri=u.shadowRenderer,$i=fi.elevationType==="road"&&!!Ri&&Ri.enabled;let rn=[0,0,0];if($i){const yn=u.style.directionalLight,ar=u.style.ambientLight;yn&&ar&&(rn=jc(u.style,yn,ar)),Ci.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const _n=fi.programConfigurations.get(s.id);let Ln=!1;if(Je&&Pi.imageAtlas){const yn=r.dN.from(Je),ar=yn.getPrimary().scaleSelf(ve).toString(),ur=Pi.imageAtlas.patternPositions.get(ar),nr=yn.getSecondary(),or=nr?Pi.imageAtlas.patternPositions.get(nr.scaleSelf(ve).toString()):null;Ln=!!ur&&!!or,ur&&_n.setConstantPatternPositions(ur,or)}Ke>0&&(Ln||_n.getPatternTransitionVertexBuffer("line-pattern"))&&Ci.push("LINE_PATTERN_TRANSITION");const Ar=u.isTileAffectedByFog(Ai),Ki=u.getOrCreateProgram(Ze,{config:_n,defines:Ci,overrideFog:Ar,overrideRtt:!di&&void 0});if(!Ne&&Ce&&Ae&&Pi.lineAtlas){const yn=Pi.lineAtlas.getDash(Ce,Ae);yn&&_n.setConstantPatternPositions(yn)}$i&&Ri.setupShadows(Pi.tileID.toUnwrapped(),Ki,"vector-tile",Pi.tileID.overscaledZ);let[Wi,Ui]=s.paint.get("line-trim-offset");(Ae==="round"||Ae==="square")&&Wi!==Ui&&(Wi===0&&(Wi-=1),Ui===1&&(Ui+=1));const Zn=oe?Ai.projMatrix:null,Hr=O?1/fi.tileToMeter/r.aw(Pi,1,u.transform.zoom):1,sr=O?1/fi.tileToMeter/r.aw(Pi,1,Math.floor(u.transform.zoom)):1,gn=Ne?r.dO(u,Pi,s,Zn,ve,Hr,sr,[Wi,Ui],rn,Ke):r.dP(u,Pi,s,Zn,fi.lineClipsArray.length,ve,Hr,sr,[Wi,Ui],rn);if(Pt){const yn=fi.gradients[s.id];let ar=yn.texture;if(s.gradientVersion!==yn.version){let ur=256;if(s.stepInterpolant){const nr=t.getSource().maxzoom,or=Ai.canonical.z===nr?Math.ceil(1<<u.transform.maxZoom-Ai.canonical.z):1;ur=r.ay(r.dQ(fi.maxLineLength/r.aj*1024*or),256,V.maxTextureSize)}yn.gradient=r.dR({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:ur,image:yn.gradient||void 0,clips:fi.lineClipsArray}),yn.texture?yn.texture.update(yn.gradient):yn.texture=new r.T(V,yn.gradient,H.RGBA8),yn.version=s.gradientVersion,ar=yn.texture}V.activeTexture.set(H.TEXTURE1),ar.bind(s.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}Le&&(V.activeTexture.set(H.TEXTURE0),Pi.lineAtlasTexture&&Pi.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),_n.updatePaintBuffers()),Ne&&(V.activeTexture.set(H.TEXTURE0),Pi.imageAtlasTexture&&Pi.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),_n.updatePaintBuffers()),di&&!k&&u.terrain.setupElevationDraw(Pi,Ki),u.uploadCommonUniforms(V,Ki,Ai.toUnwrapped());const _r=yn=>{Ge!=null&&(Ge.value=mt*C),Ki.draw(u,H.TRIANGLES,Vt,yn,ne,Fi.disabled,gn,s.id,fi.layoutVertexBuffer,fi.indexBuffer,fi.segments,s.paint,u.transform.zoom,_n,[fi.layoutVertexBuffer2,fi.patternVertexBuffer,fi.zOffsetVertexBuffer]),Ge!=null&&(Ge.value=mt)};if(xt&&!di){const yn=u.stencilModeForClipping(Ai).ref;yn===0&&oe&&V.clear({stencil:0});const ar={func:H.EQUAL,mask:255};gn.u_alpha_discard_threshold=.8,_r(new qi(ar,yn,255,H.KEEP,H.KEEP,H.INVERT)),gn.u_alpha_discard_threshold=0,_r(new qi(ar,yn,255,H.KEEP,H.KEEP,H.KEEP))}else gn.u_alpha_discard_threshold=xt&&di&&hi?.8:0,_r(di?gi:u.stencilModeForClipping(Ai))}};let st=u.depthModeForSublayer(0,yi.ReadOnly);const Ct=new yi(u.depthOcclusion?H.GREATER:H.LEQUAL,yi.ReadOnly,u.depthRangeFor3D);if(s.hasNonElevatedBuckets){const Wt=!oe&&u.terrain;C!==0&&Wt?r.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):Wt?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):bt(h,lt,st,qi.disabled,!1,!0)}if(s.hasElevatedBuckets){I==="hd-road-markup"?U||(st=Ct,lt.push("ELEVATED_ROADS")):(lt.push("ELEVATED"),st=Ct,X&&lt.push(J?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),k&&lt.push("ELEVATION_REFERENCE_SEA"));const Wt=xt?u.stencilModeFor3D():qi.disabled;u.forceTerrainMode=!0,bt(h,lt,st,Wt,!0,!0),xt&&bt(h,lt,st,Wt,!0,!1),u.forceTerrainMode=!1}xt&&(u.resetStencilClippingMasks(),oe&&V.clear({stencil:0})),C===0||u.depthOcclusion||oe||u.layersWithOcclusionOpacity.push(u.currentLayer)},fill:function(u,t,s,h){const _=s.paint.get("fill-color"),y=s.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const b=s.paint.get("fill-emissive-strength"),C=u.colorModeForDrapableLayerRenderPass(b),I=s.paint.get("fill-pattern"),O=u.opaquePassEnabledForLayer()&&!I.constantOr(1)&&_.constantOr(r.am.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";let k="none";s.layout.get("fill-elevation-reference")!=="none"?k="road":s.paint.get("fill-z-offset").constantOr(1)!==0&&(k="offset");const U=!(!u.terrain||!u.terrain.enabled),V={painter:u,sourceCache:t,layer:s,coords:h,colorMode:C,elevationType:k,terrainEnabled:U,pass:O};if(u.renderPass!=="shadow")if(k!=="offset"){if(wd(V,!1),k==="road"){const H=!U&&u.renderPass==="translucent";H&&Rs(u,t,s,h,"geometry"),wd(V,!0,qi.disabled),H&&function(Q){const{painter:X,sourceCache:J,layer:ne,coords:oe,colorMode:ve}=Q,Se=X.context.gl,Le=Q.painter.shadowRenderer,Ie=!!Le&&Le.enabled,Ce=new yi(X.context.gl.LEQUAL,yi.ReadOnly,X.depthRangeFor3D);let Ae=[0,0,0];if(Ie){const Ne=X.style.directionalLight,Ke=X.style.ambientLight;Ne&&Ke&&(Ae=jc(X.style,Ne,Ke))}const Pe=Ne=>{for(const Ke of oe){const Je=J.getTile(Ke),mt=Je.getBucket(ne);if(!mt)continue;const xt=mt.elevatedStructures;if(!xt)continue;let Pt,Ze;if(Ne?(Pt=xt.renderableBridgeSegments,Ze=xt.bridgeProgramConfigurations.get(ne.id)):(Pt=xt.renderableTunnelSegments,Ze=xt.tunnelProgramConfigurations.get(ne.id)),!Pt||Pt.segments[0].primitiveLength===0)continue;Ze.updatePaintBuffers(),X.prepareDrawTile();const lt=X.isTileAffectedByFog(Ke),Ge=[];Ie&&Ge.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const bt=X.getOrCreateProgram("elevatedStructures",{config:Ze,overrideFog:lt,defines:Ge}),st=X.translatePosMatrix(Ke.projMatrix,Je,ne.paint.get("fill-translate"),ne.paint.get("fill-translate-anchor"));Ie&&Le.setupShadows(Je.tileID.toUnwrapped(),bt,"vector-tile",Je.tileID.overscaledZ);const Ct=wf(st,Ae);X.uploadCommonUniforms(X.context,bt,Ke.toUnwrapped()),bt.draw(X,Se.TRIANGLES,Ce,qi.disabled,ve,Fi.backCCW,Ct,ne.id,xt.vertexBuffer,xt.indexBuffer,Pt,ne.paint,X.transform.zoom,Ze,[xt.vertexBufferNormal])}};Pe(!0),Pe(!1)}(V)}}else wd(V,!1,u.stencilModeFor3D());else u.shadowRenderer&&k==="road"&&!U&&function(H){const{painter:Q,sourceCache:X,layer:J,coords:ne}=H,oe=Q.context.gl,ve=H.painter.shadowRenderer;for(const Se of ne){const Le=X.getTile(Se),Ie=Le.getBucket(J);if(!Ie)continue;const Ce=Ie.elevatedStructures;if(!Ce||!Ce.shadowCasterSegments||Ce.shadowCasterSegments.segments[0].primitiveLength===0)continue;Q.prepareDrawTile();const Ae=Ie.bufferData.programConfigurations.get(J.id),Pe=Q.isTileAffectedByFog(Se),Ne=Q.getOrCreateProgram("elevatedStructuresDepth",{config:Ae,overrideFog:Pe}),Ke=ve.calculateShadowPassMatrixFromTile(Le.tileID.toUnwrapped());Q.uploadCommonUniforms(Q.context,Ne,Se.toUnwrapped());const Je={u_matrix:Ke,u_depth_bias:.001};Ne.draw(Q,oe.TRIANGLES,ve.getShadowPassDepthMode(),qi.disabled,ve.getShadowPassColorMode(),Fi.disabled,Je,J.id,Ce.vertexBuffer,Ce.indexBuffer,Ce.shadowCasterSegments,J.paint,Q.transform.zoom,Ae)}}(V)},"fill-extrusion":function(u,t,s,h){const _=s.paint.get("fill-extrusion-opacity"),y=u.context,b=y.gl,C=u.terrain,I=C&&C.renderingToTexture;if(_===0)return;const O=u.conflationActive&&u.style.isLayerClipped(s,t.getSource()),k=u.style.order.indexOf(s.fqid);if(O&&function(U,V,H,Q,X){for(const J of Q){const ne=V.getTile(J).getBucket(H);ne&&(ne.updateReplacement(J,U.replacementSource,X),ne.uploadCentroid(U.context))}}(u,t,s,h,k),C||O)for(const U of h){const V=t.getTile(U).getBucket(s);V&&mi(u.context,t,U,V,s,C,O)}if(u.renderPass==="shadow"&&u.shadowRenderer){const U=u.shadowRenderer;if(C&&_<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ab)return;const V=U.getShadowPassDepthMode(),H=U.getShadowPassColorMode();wl(u,t,s,h,V,qi.disabled,H,O)}else if(u.renderPass==="translucent"){const U=!s.paint.get("fill-extrusion-pattern").constantOr(1),V=s.paint.get("fill-extrusion-color").constantOr(r.am.white);if(!I&&V.a!==0){const H=new yi(u.context.gl.LEQUAL,yi.ReadWrite,u.depthRangeFor3D);_===1&&U?wl(u,t,s,h,H,qi.disabled,cn.unblended,O):(wl(u,t,s,h,H,qi.disabled,cn.disabled,O),wl(u,t,s,h,H,u.stencilModeFor3D(),u.colorModeForRenderPass(),O),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&U&&(!C&&u.transform.projection.name!=="globe"||I)){const H=s.paint.get("fill-extrusion-opacity"),Q=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),X=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),J=s.paint.get("fill-extrusion-flood-light-intensity"),ne=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",oe=s.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ne?null:s.lut).toArray01().slice(0,3),ve=Q>0&&X>0,Se=J>0,Le=(Ce,Ae,Pe)=>(1-Pe)*Ce+Pe*Ae,Ie=Ce=>{const Ae=u.depthModeForSublayer(1,yi.ReadOnly,b.LEQUAL,!0),Pe=s.paint.get(Ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=Le(.1,3,Pe),Ke=u._showOverdrawInspector;if(!Ke){const Je=new qi({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),mt=new cn([b.ONE,b.ONE,b.ONE,b.ONE],r.am.transparent,[!1,!1,!1,!0],b.MIN);Hl(u,t,s,h,Ae,Je,mt,Fi.disabled,Ce,"sdf",H,Q,X,J,oe,Ne,O,!1)}{const Je=Ke?qi.disabled:new qi({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),mt=Ke?u.colorModeForRenderPass():new cn([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],r.am.transparent,[!0,!0,!0,!0]);Hl(u,t,s,h,Ae,Je,mt,Fi.disabled,Ce,"color",H,Q,X,J,oe,Ne,O,!1)}};if(I){const Ce=(Ae,Pe,Ne)=>{const Ke=u.depthModeForSublayer(1,yi.ReadOnly,b.LEQUAL,!1),Je=s.paint.get(Ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),mt=Le(.1,3,Je);{const xt=new cn([b.ONE,b.ONE,b.ONE,b.ONE],r.am.transparent,[!1,!1,!1,!0]);Hl(u,t,s,h,Ke,qi.disabled,xt,Fi.disabled,Ae,"clear",H,Q,X,J,oe,mt,O,Pe)}{const xt=new qi({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Pt=new cn([b.ONE,b.ONE,b.ONE,b.ONE],r.am.transparent,[!1,!1,!1,!0],b.MIN);Hl(u,t,s,h,Ke,xt,Pt,Fi.disabled,Ae,"sdf",H,Q,X,J,oe,mt,O,Pe)}{const xt=Ae?b.ZERO:b.ONE_MINUS_DST_ALPHA,Pt=new qi({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Ze=new cn([xt,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],r.am.transparent,[!0,!0,!0,!0]);Hl(u,t,s,h,Ke,Pt,Ze,Fi.disabled,Ae,"color",H,Q,X,J,oe,mt,O,Pe)}{const xt=new cn([b.ONE,b.ONE,b.ONE,Ae?b.ZERO:b.ONE],r.am.transparent,[!1,!1,!1,!0],Ae?b.FUNC_ADD:b.MAX);Hl(u,t,s,h,Ke,qi.disabled,xt,Fi.disabled,Ae,"clear",H,Q,X,J,oe,mt,O,Pe,Ne)}};if(ve||Se){let Ae;if(u.prepareDrawTile(),C){const Pe=C.drapeBufferSize[0],Ne=C.drapeBufferSize[1];Ae=C.framebufferCopyTexture,Ae&&(!Ae||Ae.size[0]===Pe&&Ae.size[1]===Ne)||(Ae&&Ae.destroy(),Ae=C.framebufferCopyTexture=new r.T(y,new r.r({width:Pe,height:Ne}),b.RGBA8)),Ae.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,Pe,Ne)}ve&&Ce(!0,!1,Ae),Se&&Ce(!1,!0,Ae)}}else ve&&Ie(!0),Se&&Ie(!1),(ve||Se)&&u.resetStencilClippingMasks()}}},building:function(u,t,s,h){},hillshade:function(u,t,s,h){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const _=u.context,y=u.terrain&&u.terrain.renderingToTexture,[b,C]=u.renderPass!=="translucent"||y?[{},h]:u.stencilConfigForOverlap(h);for(const I of C){const O=t.getTile(I);if(O.needsHillshadePrepare&&u.renderPass==="offscreen")yc(u,O,s);else if(u.renderPass==="translucent"){const k=u.depthModeForSublayer(0,yi.ReadOnly),U=s.paint.get("hillshade-emissive-strength"),V=u.colorModeForDrapableLayerRenderPass(U),H=y&&u.terrain?u.terrain.stencilModeForRTTOverlap(I):b[I.overscaledZ];Po(u,I,O,s,k,H,V)}}_.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,t,s,h,_,y){if(u.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const b=u.transform.projection.name==="globe",C=s.paint.get("raster-elevation")!==0,I=C&&b;if(u.renderElevatedRasterBackface&&!I)return;const O=u.context,k=O.gl,U=t.getSource(),V=function(Ie,Ce,Ae,Pe){const Ne=Ce.paint.get("raster-color"),Ke=Ie.type==="raster-array",Je=[],mt=Ce.paint.get("raster-resampling"),xt=Ce.paint.get("raster-color-mix");let Pt=Ce.paint.get("raster-color-range");const Ze=[xt[0],xt[1],xt[2],0],lt=xt[3];let Ge=mt==="nearest"?Pe.NEAREST:Pe.LINEAR;if(Ke&&(Je.push("RASTER_ARRAY"),Ne||Je.push("RASTER_COLOR"),mt==="linear"&&Je.push("RASTER_ARRAY_LINEAR"),Ge=Pe.NEAREST,!Pt&&Ie.rasterLayers)){const bt=Ie.rasterLayers.find(({id:st})=>st===Ce.sourceLayer);bt&&bt.fields&&bt.fields.range&&(Pt=bt.fields.range)}if(Pt=Pt||[0,1],Ne){Je.push("RASTER_COLOR"),Ae.activeTexture.set(Pe.TEXTURE2),Ce.updateColorRamp(Pt);let bt=Ce.colorRampTexture;bt||(bt=Ce.colorRampTexture=new r.T(Ae,Ce.colorRamp,Pe.RGBA8)),bt.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)}return{mix:Ze,range:Pt,offset:lt,defines:Je,resampling:Ge}}(U,s,O,k);if(U instanceof r.aP&&!h.length&&!b)return;const H=s.paint.get("raster-emissive-strength"),Q=u.colorModeForDrapableLayerRenderPass(H),X=u.terrain&&u.terrain.renderingToTexture,J=!u.options.moving,ne=s.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(U instanceof r.aP&&!h.length&&(U.onNorthPole||U.onSouthPole)){const Ie=C?u.stencilModeFor3D():qi.disabled;return void Ss(!!U.onNorthPole,null,u,t,s,H,V,Fi.disabled,Ie)}if(!h.length)return;const[oe,ve]=U instanceof r.aP||X?[{},h]:u.stencilConfigForOverlap(h),Se=ve[ve.length-1].overscaledZ;I&&V.defines.push("PROJECTION_GLOBE_VIEW"),C&&V.defines.push("RENDER_CUTOFF");const Le=(Ie,Ce,Ae)=>{for(const Pe of Ie){const Ne=Pe.toUnwrapped(),Ke=t.getTile(Pe);if(X&&(!Ke||!Ke.hasData()))continue;O.activeTexture.set(k.TEXTURE0);const Je=Td(Ke,U,s,V);if(!Je||!Je.texture)continue;const{texture:mt,mix:xt,offset:Pt,tileSize:Ze,buffer:lt}=Je;let Ge,bt;X?(Ge=yi.disabled,bt=Pe.projMatrix):C?(Ge=new yi(k.LEQUAL,yi.ReadWrite,u.depthRangeFor3D),bt=b?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(Ne,J)):(Ge=u.depthModeForSublayer(Pe.overscaledZ-Se,s.paint.get("raster-opacity")===1?yi.ReadWrite:yi.ReadOnly,k.LESS),bt=u.transform.calculateProjMatrix(Ne,J));const st=u.terrain&&X?u.terrain.stencilModeForRTTOverlap(Pe):oe[Pe.overscaledZ],Ct=y?0:s.paint.get("raster-fade-duration");Ke.registerFadeDuration(Ct);const Wt=t.findLoadedParent(Pe,0),wt=Eu(Ke,Wt,t,u.transform,Ct);let Vt,gi;u.terrain&&u.terrain.prepareDrawTile(),O.activeTexture.set(k.TEXTURE0),mt.bind(ne,k.CLAMP_TO_EDGE),O.activeTexture.set(k.TEXTURE1),Wt?(Wt.texture&&Wt.texture.bind(ne,k.CLAMP_TO_EDGE),Vt=Math.pow(2,Wt.tileID.overscaledZ-Ke.tileID.overscaledZ),gi=[Ke.tileID.canonical.x*Vt%1,Ke.tileID.canonical.y*Vt%1]):mt.bind(ne,k.CLAMP_TO_EDGE),"useMipmap"in mt&&O.extTextureFilterAnisotropic&&u.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);const di=u.transform;let hi;const Ai=C?Pp(di):[0,0,0,0];let Pi,fi,Ci,Ri,$i,rn=0;if(I&&U instanceof r.aP&&U.coordinates.length>3)Pi=Float32Array.from(r.bh(r.dr(new r.cp(0,0,0)))),fi=Float32Array.from(di.globeMatrix),Ci=Float32Array.from(r.dm(di)),Ri=[r.aD(di.center.lng),r.aH(di.center.lat)],hi=U.elevatedGlobePerspectiveTransform,$i=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(I){const Ki=r.dn(Pe.canonical);rn=r.dp(Ki.getCenter().lat),Pi=Float32Array.from(r.bh(r.dr(Pe.canonical))),fi=Float32Array.from(di.globeMatrix),Ci=Float32Array.from(r.dm(di)),Ri=[r.aD(di.center.lng),r.aH(di.center.lat)],hi=[0,0],$i=Float32Array.from(r.dq(Pe.canonical,Ki,rn,di.worldSize/di._pixelsPerMercatorPixel))}else hi=U instanceof r.aP?U.perspectiveTransform:[0,0],Pi=new Float32Array(16),fi=new Float32Array(9),Ci=new Float32Array(16),Ri=[0,0],$i=new Float32Array(9);const _n=Bl(bt,Pi,fi,Ci,$i,gi||[0,0],r.ah(u.transform.zoom),Ri,Ai,Vt||1,wt,s,hi,C?s.paint.get("raster-elevation"):0,2,xt,Pt,V.range,Ze,lt,H),Ln=u.isTileAffectedByFog(Pe),Ar=u.getOrCreateProgram("raster",{defines:V.defines,overrideFog:Ln});if(u.uploadCommonUniforms(O,Ar,Ne),U instanceof r.aP){const Ki=U.elevatedGlobeVertexBuffer,Wi=U.elevatedGlobeIndexBuffer;if(X||!b)U.boundsBuffer&&U.boundsSegments&&Ar.draw(u,k.TRIANGLES,Ge,qi.disabled,Q,Fi.disabled,_n,s.id,U.boundsBuffer,u.quadTriangleIndexBuffer,U.boundsSegments);else if(Ki&&Wi){const Ui=di.zoom<=r.cL?U.elevatedGlobeSegments:U.getSegmentsForLongitude(di.center.lng);Ui&&Ar.draw(u,k.TRIANGLES,Ge,qi.disabled,Q,Ce,_n,s.id,Ki,Wi,Ui)}}else if(I){Ge=new yi(k.LEQUAL,yi.ReadOnly,u.depthRangeFor3D);const Ki=u.globeSharedBuffers;if(Ki){const[Wi,Ui,Zn]=Ki.getGridBuffers(rn,!1);Ar.draw(u,k.TRIANGLES,Ge,Ae||st,u.colorModeForRenderPass(),Ce,_n,s.id,Wi,Ui,Zn)}}else{const{tileBoundsBuffer:Ki,tileBoundsIndexBuffer:Wi,tileBoundsSegments:Ui}=u.getTileBoundsBuffers(Ke);Ar.draw(u,k.TRIANGLES,Ge,st,Q,Fi.disabled,_n,s.id,Ki,Wi,Ui)}}if(!(U instanceof r.aP)&&I)for(const Pe of Ie){const Ne=Pe.canonical.y===(1<<Pe.canonical.z)-1;Pe.canonical.y===0&&Ss(!0,Pe,u,t,s,H,V,Ce,Ae||qi.disabled),Ne&&Ss(!1,Pe,u,t,s,H,V,Ce===Fi.frontCW?Fi.backCW:Fi.frontCW,Ae||qi.disabled)}};I?Le(ve,u.renderElevatedRasterBackface?Fi.backCW:Fi.frontCW,u.stencilModeFor3D()):Le(ve,Fi.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,t,s,h,_,y){u.renderPass==="offscreen"&&function(b,C,I,O){if(!O.length)return;const k=b.context,U=k.gl,V=C.getSource();if(!(V instanceof Cs))return;const H=Math.ceil(Math.sqrt(I.paint.get("raster-particle-count")));let Q=I.particlePositionRGBAImage;if(!Q||Q.width!==H){const ve=function(Se){const Le=Se*Se,Ie=new Uint8Array(4*Le),Ce=function(Pe){return Pe|=0,Pe=Math.imul(2747636419^Pe,2654435769),Pe=Math.imul(Pe^Pe>>>16,2654435769),((Pe=Math.imul(Pe^Pe>>>16,2654435769))>>>0)/4294967296},Ae=1/1.1;for(let Pe=0;Pe<Le;Pe++){const Ne=Ae*(Ce(2*Pe+0)+jl),Ke=Ae*(Ce(2*Pe+1)+jl),Je=255*Ne%1,mt=255*Ke%1,xt=Je,Pt=Ke-mt/255,Ze=mt;Ie[4*Pe+0]=255*(Ne-Je/255),Ie[4*Pe+1]=255*xt,Ie[4*Pe+2]=255*Pt,Ie[4*Pe+3]=255*Ze}return Ie}(H);Q=I.particlePositionRGBAImage=new r.r({width:H,height:H},ve)}let X=I.particleFramebuffer;X?X.width!==H&&(X.destroy(),X=I.particleFramebuffer=k.createFramebuffer(H,H,!0,null)):X=I.particleFramebuffer=k.createFramebuffer(H,H,!0,null);const J=[];for(const ve of O){const Se=C.getTile(ve);if(!(Se instanceof Ua))continue;const Le=Mc(Se,V,I);if(!Le)continue;const Ie=[Se.tileSize,Se.tileSize];let Ce=I.tileFramebuffer;Ce||(Ce=I.tileFramebuffer=k.createFramebuffer(Ie[0],Ie[1],!0,null));let Ae=Se.rasterParticleState;Ae||(Ae=Se.rasterParticleState=new Mf(k,ve,Ie,Q));const Pe=Ae.update(I.lastInvalidatedAt);Ae.particleTextureDimension!==H&&Ae.updateParticleTexture(ve,Q);const Ne=Ae.targetColorTexture;Ae.targetColorTexture=Ae.backgroundColorTexture,Ae.backgroundColorTexture=Ne;const Ke=Ae.particleTexture0;Ae.particleTexture0=Ae.particleTexture1,Ae.particleTexture1=Ke,J.push([ve,Le,Ae,Pe])}if(J.length===0)return;const ne=r.q.now(),oe=I.previousDrawTimestamp?.001*(ne-I.previousDrawTimestamp):.0167;if(I.previousDrawTimestamp=ne,I.hasColorMap()){k.activeTexture.set(U.TEXTURE0+2);let ve=I.colorRampTexture;ve||(ve=I.colorRampTexture=new r.T(k,I.colorRamp,U.RGBA8)),ve.bind(U.LINEAR,U.CLAMP_TO_EDGE)}k.bindFramebuffer.set(I.tileFramebuffer.framebuffer),function(ve,Se,Le){const Ie=ve.context,Ce=Ie.gl,Ae=Se.tileFramebuffer;Ie.activeTexture.set(Ce.TEXTURE0);const Pe={u_texture:0,u_opacity:1.05*(Ke=Se.paint.get("raster-particle-fade-opacity-factor"))/(Ke+.05)},Ne=ve.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ke;for(const Je of Le){const[,,mt,xt]=Je;Ae.colorAttachment.set(mt.targetColorTexture.texture),Ie.viewport.set([0,0,Ae.width,Ae.height]),Ie.clear({color:r.am.transparent}),xt&&(mt.backgroundColorTexture.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE),Ne.draw(ve,Ce.TRIANGLES,yi.disabled,qi.disabled,cn.alphaBlended,Fi.disabled,Pe,Se.id,ve.viewportBuffer,ve.quadTriangleIndexBuffer,ve.viewportSegments))}}(b,I,J),function(ve,Se,Le,Ie){const Ce=ve.context,Ae=Ce.gl,Pe=Le.tileFramebuffer,Ne=ve.transform.projection.name==="globe",Ke=Le.paint.get("raster-particle-max-speed");for(const Je of Ie){const[mt,xt,Pt]=Je;Ce.activeTexture.set(Ae.TEXTURE0+0),xt.texture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Pe.colorAttachment.set(Pt.targetColorTexture.texture);const Ze=ve.getOrCreateProgram("rasterParticleDraw",{defines:xt.defines,overrideFog:!1});Ce.activeTexture.set(Ae.TEXTURE0+1);const lt=xt.scalarData?[]:[0,1,2,3].map(st=>r.dT[st](mt));lt.push(mt);const Ge=mt.canonical.x,bt=mt.canonical.y;for(const st of lt){const Ct=Se.getTile(Ne?st.wrapped():st);if(!Ct)continue;const Wt=Ct.rasterParticleState;if(!Wt)continue;const wt=st.canonical.x+(1<<st.canonical.z)*(st.wrap-mt.wrap),Vt=st.canonical.y;Wt.particleTexture0.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);const gi=Cc(1,Wt.particleTexture0.size[0],[wt-Ge,Vt-bt],0,xt.texture.size,2,Ke,xt.textureOffset,xt.scale,xt.offset);Ze.draw(ve,Ae.POINTS,yi.disabled,qi.disabled,cn.alphaBlended,Fi.disabled,gi,Le.id,Wt.particleIndexBuffer,void 0,Wt.particleSegment)}}}(b,C,I,J),k.bindFramebuffer.set(I.particleFramebuffer.framebuffer),function(ve,Se,Le,Ie){const Ce=ve.context,Ae=Ce.gl,Pe=Se.paint.get("raster-particle-max-speed"),Ne=Ie*Se.paint.get("raster-particle-speed-factor")*.15,Ke=function(mt){return Math.pow(mt,6)}(.01+1*Se.paint.get("raster-particle-reset-rate-factor")),Je=Se.particleFramebuffer;Ce.viewport.set([0,0,Je.width,Je.height]);for(const mt of Le){const[,xt,Pt]=mt;Ce.activeTexture.set(Ae.TEXTURE0+0),xt.texture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Ce.activeTexture.set(Ae.TEXTURE0+1);const Ze=Pt.particleTexture0;Ze.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);const lt=Yo(1,Ze.size[0],0,xt.texture.size,Pe,Ne,Ke,xt.textureOffset,xt.scale,xt.offset);Je.colorAttachment.set(Pt.particleTexture1.texture),Ce.clear({color:r.am.transparent}),ve.getOrCreateProgram("rasterParticleUpdate",{defines:xt.defines}).draw(ve,Ae.TRIANGLES,yi.disabled,qi.disabled,cn.unblended,Fi.disabled,lt,Se.id,ve.viewportBuffer,ve.quadTriangleIndexBuffer,ve.viewportSegments)}}(b,I,J,oe)}(u,t,s,h),u.renderPass==="translucent"&&(function(b,C,I,O,k){const U=b.context,V=U.gl,H=C.getSource().tileSize,Q=5*(1-r.af(r.cx,r.cx+1,b.transform.zoom))*H+I.paint.get("raster-particle-elevation"),X=!b.options.moving,J=b.transform.projection.name==="globe";if(!O.length)return;const[ne,oe]=b.stencilConfigForOverlap(O),ve=[];J&&ve.push("PROJECTION_GLOBE_VIEW");const Se=b.stencilModeFor3D();for(const Le of oe){const Ie=Le.toUnwrapped(),Ce=C.getTile(Le);if(!Ce.rasterParticleState)continue;const Ae=Ce.rasterParticleState,Pe=100;Ce.registerFadeDuration(Pe);const Ne=C.findLoadedParent(Le,0),Ke=Eu(Ce,Ne,C,b.transform,Pe);let Je,mt;b.terrain&&b.terrain.prepareDrawTile(),U.activeTexture.set(V.TEXTURE0),Ae.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),U.activeTexture.set(V.TEXTURE1),Ne&&Ne.rasterParticleState?(Ne.rasterParticleState.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Je=Math.pow(2,Ne.tileID.overscaledZ-Ce.tileID.overscaledZ),mt=[Ce.tileID.canonical.x*Je%1,Ce.tileID.canonical.y*Je%1]):Ae.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const xt=J?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(Ie,X),Pt=b.transform,Ze=Sd(Pt),lt=r.dn(Le.canonical),Ge=r.dp(lt.getCenter().lat);let bt,st,Ct,Wt,wt;J?(bt=Float32Array.from(r.bh(r.dr(Le.canonical))),st=Float32Array.from(Pt.globeMatrix),Ct=Float32Array.from(r.dm(Pt)),Wt=[r.aD(Pt.center.lng),r.aH(Pt.center.lat)],wt=Float32Array.from(r.dq(Le.canonical,lt,Ge,Pt.worldSize/Pt._pixelsPerMercatorPixel))):(bt=new Float32Array(16),st=new Float32Array(9),Ct=new Float32Array(16),Wt=[0,0],wt=new Float32Array(9));const Vt=To(xt,bt,st,Ct,wt,mt||[0,0],r.ah(b.transform.zoom),Wt,Ze,Je||1,Ke,Q),gi=b.isTileAffectedByFog(Le),di=b.getOrCreateProgram("rasterParticle",{defines:ve,overrideFog:gi});if(b.uploadCommonUniforms(U,di,Ie),J){const hi=new yi(V.LEQUAL,yi.ReadOnly,b.depthRangeFor3D),Ai=0,Pi=b.globeSharedBuffers;if(Pi){const[fi,Ci,Ri]=Pi.getGridBuffers(Ge,Ai!==0);di.draw(b,V.TRIANGLES,hi,Se,cn.alphaBlended,b.renderElevatedRasterBackface?Fi.frontCCW:Fi.backCCW,Vt,I.id,fi,Ci,Ri)}}else{const hi=b.depthModeForSublayer(0,yi.ReadOnly),Ai=ne[Le.overscaledZ],{tileBoundsBuffer:Pi,tileBoundsIndexBuffer:fi,tileBoundsSegments:Ci}=b.getTileBoundsBuffers(Ce);di.draw(b,V.TRIANGLES,hi,Ai,cn.alphaBlended,Fi.disabled,Vt,I.id,Pi,fi,Ci)}}b.resetStencilClippingMasks()}(u,t,s,h),u.style.map.triggerRepaint())},background:function(u,t,s,h){const _=s.paint.get("background-color"),y=s.paint.get("background-color-use-theme").constantOr("default")==="none",b=s.paint.get("background-opacity"),C=s.paint.get("background-emissive-strength"),I=s.paint.get("background-pitch-alignment")==="viewport";if(b===0)return;const O=u.context,k=O.gl,U=u.transform,V=U.tileSize,H=s.paint.get("background-pattern");let Q;if(H!==void 0&&(H===null||(Q=u.imageManager.getPattern(r.I.from(H.toString()),s.scope,u.style.getLut(s.scope)),!Q)))return;const X=!H&&_.a===1&&b===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==X)return;const J=qi.disabled,ne=u.depthModeForSublayer(0,X==="opaque"?yi.ReadWrite:yi.ReadOnly),oe=u.colorModeForDrapableLayerRenderPass(C),ve=H?"backgroundPattern":"background";let Se,Le=h;if(Le||(Se=u.getBackgroundTiles(),Le=Object.values(Se).map(Ie=>Ie.tileID)),H&&(O.activeTexture.set(k.TEXTURE0),u.imageManager.bind(u.context,s.scope)),I){const Ie=u.getOrCreateProgram(ve,{overrideFog:!1,overrideRtt:!0}),Ce=new Float32Array(r.bx([])),Ae=new r.aM(0,0,0,0,0),Pe=H?Ru(Ce,C,b,u,0,s.scope,Q,I,{tileID:Ae,tileSize:V}):Iu(Ce,C,b,_.toPremultipliedRenderColor(y?null:s.lut));Ie.draw(u,k.TRIANGLES,ne,J,oe,Fi.disabled,Pe,s.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments)}else for(const Ie of Le){const Ce=u.isTileAffectedByFog(Ie),Ae=u.getOrCreateProgram(ve,{overrideFog:Ce}),Pe=Ie.toUnwrapped(),Ne=h?Ie.projMatrix:u.transform.calculateProjMatrix(Pe);u.prepareDrawTile();const Ke=t?t.getTile(Ie):Se?Se[Ie.key]:new Va(Ie,V,U.zoom,u),Je=H?Ru(Ne,C,b,u,0,s.scope,Q,I,{tileID:Ie,tileSize:V}):Iu(Ne,C,b,_.toPremultipliedRenderColor(y?null:s.lut));u.uploadCommonUniforms(O,Ae,Pe);const{tileBoundsBuffer:mt,tileBoundsIndexBuffer:xt,tileBoundsSegments:Pt}=u.getTileBoundsBuffers(Ke);Ae.draw(u,k.TRIANGLES,ne,J,oe,Fi.disabled,Je,s.id,mt,xt,Pt)}},sky:function(u,t,s){const h=u._atmosphere?r.ah(u.transform.zoom):1,_=s.paint.get("sky-opacity")*h;if(_===0)return;const y=u.context,b=s.paint.get("sky-type"),C=new yi(y.gl.LEQUAL,yi.ReadOnly,[0,1]),I=u.frameCounter/1e3%1;b==="atmosphere"?u.renderPass==="offscreen"?s.needsSkyboxCapture(u)&&(function(O,k,U,V){const H=O.context,Q=H.gl;let X=k.skyboxFbo;if(!X){X=k.skyboxFbo=H.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new Eh(H),k.skyboxTexture=H.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,k.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let ve=0;ve<6;++ve)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+ve,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(X.framebuffer),H.viewport.set([0,0,32,32]);const J=k.getCenter(O,!0),ne=O.getOrCreateProgram("skyboxCapture"),oe=new Float64Array(16);r.bx(oe),r.e3(oe,oe,.5*-Math.PI),Xl(O,k,ne,oe,J,0),r.bx(oe),r.e3(oe,oe,.5*Math.PI),Xl(O,k,ne,oe,J,1),r.bx(oe),r.cG(oe,oe,.5*-Math.PI),Xl(O,k,ne,oe,J,2),r.bx(oe),r.cG(oe,oe,.5*Math.PI),Xl(O,k,ne,oe,J,3),r.bx(oe),Xl(O,k,ne,oe,J,4),r.bx(oe),r.e3(oe,oe,Math.PI),Xl(O,k,ne,oe,J,5),H.viewport.set([0,0,O.width,O.height])}(u,s),s.markSkyboxValid(u)):u.renderPass==="sky"&&function(O,k,U,V,H){const Q=O.context,X=Q.gl,J=O.transform,ne=O.getOrCreateProgram("skybox");Q.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,k.skyboxTexture);const oe=((ve,Se,Le,Ie,Ce)=>({u_matrix:ve,u_sun_direction:Se,u_cubemap:0,u_opacity:Ie,u_temporal_offset:Ce}))(J.skyboxMatrix,k.getCenter(O,!1),0,V,H);O.uploadCommonUniforms(Q,ne),ne.draw(O,X.TRIANGLES,U,qi.disabled,O.colorModeForRenderPass(),Fi.backCW,oe,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(u,s,C,_,I):b==="gradient"&&u.renderPass==="sky"&&function(O,k,U,V,H){const Q=O.context,X=Q.gl,J=O.transform,ne=O.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new Eh(Q)),Q.activeTexture.set(X.TEXTURE0);let oe=k.colorRampTexture;oe||(oe=k.colorRampTexture=new r.T(Q,k.colorRamp,X.RGBA8)),oe.bind(X.LINEAR,X.CLAMP_TO_EDGE);const ve=((Se,Le,Ie,Ce,Ae)=>({u_matrix:Se,u_color_ramp:0,u_center_direction:Le,u_radius:r.al(Ie),u_opacity:Ce,u_temporal_offset:Ae}))(J.skyboxMatrix,k.getCenter(O,!1),k.paint.get("sky-gradient-radius"),V,H);O.uploadCommonUniforms(Q,ne),ne.draw(O,X.TRIANGLES,U,qi.disabled,O.colorModeForRenderPass(),Fi.backCW,ve,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(u,s,C,_,I)},custom:function(u,t,s,h){const _=u.context,y=s.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&s.isDraped(t)){if(u.renderPass==="offscreen"){const b=y.prerender;if(b){if(u.setCustomLayerDefaults(),_.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const C=u.transform.pointMerc;b.call(y,_.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),r.ah(u.transform.zoom),[C.x,C.y],u.transform.pixelsPerMeterRatio)}else b.call(y,_.gl,u.transform.customLayerMatrix());_.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const C=y.renderToTile;if(C){const I=h[0].canonical,O={x:I.x+h[0].wrap*(y.wrapTileId?0:1<<I.z),y:I.y,z:I.z};_.setDepthMode(yi.disabled),_.setStencilMode(qi.disabled),_.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),C.call(y,_.gl,O),_.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),_.setColorMode(u.colorModeForRenderPass()),_.setStencilMode(qi.disabled);const b=y.renderingMode==="3d"?new yi(u.context.gl.LEQUAL,yi.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,yi.ReadOnly);if(_.setDepthMode(b),u.transform.projection.name==="globe"){const C=u.transform.pointMerc;y.render(_.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),r.ah(u.transform.zoom),[C.x,C.y],u.transform.pixelsPerMeterRatio)}else y.render(_.gl,u.transform.customLayerMatrix());_.setDirty(),u.setBaseState(),_.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,t,s,h){if(u.renderPass==="opaque")return;const _=s.paint.get("model-opacity").constantOr(1);if(_===0)return;const y=s.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!y||u.terrain&&_<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof r.ab))return;const b=u.shadowRenderer,C=s.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,C||(b.enabled=!1));const I=()=>{b&&(b.useNormalOffset=!0,C||(b.enabled=!0))},O=t.getSource();if(u.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(ne,oe,ve,Se,Le){const Ie=ne.transform;if(Ie.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${Ie.projection.name} projection is not yet implemented`);const Ce=Ie.getFreeCameraOptions().position;if(!ne.modelManager)return;const Ae=ne.modelManager;ve.modelManager=Ae;const Pe=ne.shadowRenderer;if(!ve._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ne=ve._unevaluatedLayout._values["model-id"],Ke=Object.assign({},ve.layout.get("model-id").parameters),Je=ne.style.order.indexOf(ve.fqid);for(const mt of Se){const xt=oe.getTile(mt).getBucket(ve);if(!xt||xt.projection.name!==Ie.projection.name)continue;const Pt=xt.getModelUris();Pt&&!xt.modelsRequested&&(Ae.addModelsFromBucket(Pt,Le),xt.modelsRequested=!0);const Ze=Ad(mt,Ie);Ke.zoom=Ze;const lt=Ne.possiblyEvaluate(Ke);if(Ye(ne,xt,mt),lo.shadowUniformsInitialized=!1,lo.useSingleShadowCascade=!!Pe&&Pe.getMaxCascadeForTile(mt.toUnwrapped())===0,ne.renderPass==="shadow"&&Pe){if(ne.currentShadowCascade===1&&xt.isInsideFirstShadowMapFrustum)continue;const st=Ie.calculatePosMatrix(mt.toUnwrapped(),Ie.worldSize);if(lo.tileMatrix.set(st),lo.shadowTileMatrix=Float32Array.from(Pe.calculateShadowPassMatrixFromMatrix(st)),lo.aabb.min.fill(0),lo.aabb.max[0]=lo.aabb.max[1]=r.aj,lo.aabb.max[2]=0,Fp(xt,lo,ne,ve.scope))continue}const Ge=1<<mt.canonical.z,bt=[((Ce.x-mt.wrap)*Ge-mt.canonical.x)*r.aj,(Ce.y*Ge-mt.canonical.y)*r.aj,Ce.z*Ge*r.aj];ne.conflationActive&&Object.keys(xt.instancesPerModel).length>0&&ne.style.isLayerClipped(ve,oe.getSource())&&xt.updateReplacement(mt,ne.replacementSource,Je,Le)&&(xt.uploaded=!1,xt.upload(ne.context));for(let st in xt.instancesPerModel){const Ct=xt.instancesPerModel[st];Ct.features.length>0&&(st=lt.evaluate(Ct.features[0].feature,{}));const Wt=Ae.getModel(st,Le);if(Wt||Ae.hasURLBeenRequested(st)||xt.modelUris.includes(st)||(xt.modelUris.push(st),xt.modelsRequested=!1),Wt&&Wt.uploaded)for(const wt of Wt.nodes)Cd(ne,ve,wt,Ct,bt,mt,lo)}}}(u,t,s,h,O.type==="vector"?s.scope:""),void I();if(!O.loaded())return;if(O.type==="batched-model")return function(ne,oe,ve,Se){ve.resetLayerRenderingStats(ne);const Le=ne.context,Ie=ne.transform,Ce=ne.style.fog,Ae=ne.shadowRenderer;if(Ie.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Ie.projection.name} projection is not yet implemented`);const Pe=ne.transform.getFreeCameraOptions().position,Ne=r.bY([],[Pe.x,Pe.y,Pe.z],ne.transform.worldSize),Ke=r.eb([],Ne),Je=r.bx([]),mt=r.ec(Ie.center.lat,Ie.zoom),xt=r.bn([],[1,1,1/mt]);r.bo(Je,Je,Ke);const Pt=ve.paint.get("model-opacity").constantOr(1),Ze=new yi(Le.gl.LEQUAL,yi.ReadWrite,ne.depthRangeFor3D),lt=new yi(Le.gl.LEQUAL,yi.ReadOnly,ne.depthRangeFor3D),Ge=new r.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),bt=ne.renderPass==="shadow",st=bt&&Ae?Ae.getCurrentCascadeFrustum():Ie.getFrustum(Ie.scaleZoom(Ie.worldSize)),Ct=ve.paint.get("model-front-cutoff"),Wt=Ct[2]<1,wt=zl(ne,ve.paint.get("model-cutoff-fade-range")),Vt=ve.getLayerRenderingStats();(function(gi,di,hi,Ai){const Pi=gi.terrain?gi.terrain.exaggeration():0,fi=gi.transform.zoom;for(const Ci of Ai){const Ri=di.getTile(Ci).getBucket(hi);Ri&&(Ri.setFilter(hi.filter),gi.conflationActive&&Ri.updateReplacement(Ci,gi.replacementSource),Ri.evaluateTransform(gi,hi),gi.terrain&&Pi>0&&Ri.elevationUpdate(gi.terrain,Pi,Ci,hi.source),Ri.needsReEvaluation(gi,fi,hi)&&Ri.evaluate(hi))}})(ne,oe,ve,Se),function(){let gi,di,hi;Wt?(gi=Se.length-1,di=-1,hi=-1):(gi=0,di=Se.length,hi=1);const Ai=new Float64Array(16),Pi=r.ef(),fi=new r.P(0,0);for(let Ci=gi;Ci!==di;Ci+=hi){const Ri=Se[Ci],$i=oe.getTile(Ri).getBucket(ve);if(!$i||!$i.uploaded)continue;let rn=!1;Ae&&(rn=Ae.getMaxCascadeForTile(Ri.toUnwrapped())===0);const _n=Ie.calculatePosMatrix(Ri.toUnwrapped(),Ie.worldSize),Ln=$i.modelTraits;!bt&&Wt&&(r.bi(Ai,_n),r.ad(Pi,Ne,Ai),fi.x=Pi[0],fi.y=Pi[1]);const Ar=[];$i.setFilter(ve.filter);for(const Ki of $i.getNodesInfo()){if(Ki.hiddenByReplacement||!Ki.node.meshes)continue;const Wi=Ki.node;let Ui=0;ne.terrain&&Wi.elevation&&(Ui=Wi.elevation*ne.terrain.exaggeration());const Zn=(()=>{const pr=Ki.aabb;return Ge.min=[...pr.min],Ge.max=[...pr.max],Ge.min[2]+=Ui,Ge.max[2]+=Ui,r.ad(Ge.min,Ge.min,_n),r.ad(Ge.max,Ge.max,_n),Ge})(),Hr=Ki.evaluatedScale;if(Hr[0]<=1&&Hr[1]<=1&&Hr[2]<=1&&Zn.intersects(st)===0)continue;if(!bt&&Wt){const pr=.16666666666666666;Ki.cameraCollisionOpacity=Ne[0]>Zn.min[0]&&Ne[0]<Zn.max[0]&&Ne[1]>Zn.min[1]&&Ne[1]<Zn.max[1]&&Ne[2]*mt<Zn.max[2]&&Wi.footprint&&r.bS(fi,Wi.footprint)?Math.max(Ki.cameraCollisionOpacity-pr,0):Math.min(1,Ki.cameraCollisionOpacity+pr)}const sr=[..._n],gn=1/r.cU(Ri.canonical),_r=Wi.anchor?Wi.anchor[0]:0,yn=Wi.anchor?Wi.anchor[1]:0;r.bo(sr,sr,[_r*(Hr[0]-1)+Ki.evaluatedTranslation[0]*gn,yn*(Hr[1]-1)+Ki.evaluatedTranslation[1]*gn,Ui+Ki.evaluatedTranslation[2]]),r.ci(Hr,r.eg)||r.cE(sr,sr,Hr);const ar=r.az([],sr,Wi.matrix),ur=r.az([],Ie.expandedFarZProjMatrix,ar),nr=r.az([],Ie.expandedFarZProjMatrix,sr),or=r.aA([],[_r,yn,Ui,1],ur)[2];Wi.hidden=!1;let Nn=Pt;bt||(Wt&&(Nn*=Ki.cameraCollisionOpacity,Nn*=zu(sr,Ie,Ki.aabb,Ct)),Nn*=Bp(wt,or)),Nn!==0?Ar.push({nodeInfo:Ki,depth:or,opacity:Nn,wvpForNode:ur,wvpForTile:nr,nodeModelMatrix:ar,tileModelMatrix:sr}):Wi.hidden=!0}bt||Ar.sort((Ki,Wi)=>!Wt||Ki.opacity===1&&Wi.opacity===1?Ki.depth<Wi.depth?-1:1:Ki.opacity===1?-1:Wi.opacity===1?1:Ki.depth>Wi.depth?-1:1);for(const Ki of Ar){const Wi=Ki.nodeInfo,Ui=Wi.node;let Zn=r.az([],xt,Ki.tileModelMatrix);r.az(Zn,Je,Zn);const Hr=r.bi([],Zn);r.ee(Hr,Hr),r.cE(Hr,Hr,Rf),Zn=r.az(Zn,Zn,Ui.matrix);const sr=ne.renderPass==="light-beam",gn=ve.paint.get("model-color-use-theme").constantOr("default")==="none",_r=Ln&r.em.HasMapboxMeshFeatures,yn=_r?0:Wi.evaluatedRMEA[0][2];for(let ar=0;ar<Ui.meshes.length;++ar){const ur=Ui.meshes[ar],nr=ar===Ui.lightMeshIndex;let or=Ki.wvpForNode;if(nr){if(!sr&&!ne.terrain&&ne.shadowRenderer){ne.currentLayer<ne.firstLightBeamLayer&&(ne.firstLightBeamLayer=ne.currentLayer);continue}or=Ki.wvpForTile}else if(sr)continue;const Nn={defines:[]},pr=[];if(!bt&&Ae&&(Ae.useNormalOffset=!!ur.normalBuffer),Ut(Nn.defines,pr,ur,ne,gn?null:ve.lut),_r||Nn.defines.push("DIFFUSE_SHADED"),rn&&Nn.defines.push("SHADOWS_SINGLE_CASCADE"),Vt&&(bt?Vt.numRenderedVerticesInShadowPass+=ur.vertexArray.length:Vt.numRenderedVerticesInTransparentPass+=ur.vertexArray.length),bt){zr(ur,Ki.nodeModelMatrix,ne,ve);continue}let Cr=null;if(Ce){const rl=Lu(Ki.nodeModelMatrix,ne.transform);if(Cr=new Float32Array(rl),Ie.projection.name!=="globe"){const Za=ur.aabb.min,Ra=ur.aabb.max,[qs,sl]=Ce.getOpacityForBounds(rl,Za[0],Za[1],Ra[0],Ra[1]);Nn.overrideFog=qs>=rt||sl>=rt}}const Qn=ur.material;let An;Qn.occlusionTexture&&Qn.occlusionTexture.offsetScale&&(An=Qn.occlusionTexture.offsetScale,Nn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const na=ne.getOrCreateProgram("model",Nn);!bt&&Ae&&Ae.setupShadowsFromMatrix(Ki.tileModelMatrix,na,Ae.useNormalOffset),ne.uploadCommonUniforms(Le,na,null,Cr);const Ia=Qn.pbrMetallicRoughness;Ia.metallicFactor=.9,Ia.roughnessFactor=.5;const uo=wh(new Float32Array(or),new Float32Array(Zn),new Float32Array(Hr),new Float32Array(Ui.matrix),ne,Ki.opacity,Ia.baseColorFactor,Qn.emissiveFactor,Ia.metallicFactor,Ia.roughnessFactor,Qn,yn,ve,[0,0,0],An);!nr&&(Wi.hasTranslucentParts||Ki.opacity<1)&&na.draw(ne,Le.gl.TRIANGLES,Ze,qi.disabled,cn.disabled,Fi.backCCW,uo,ve.id,ur.vertexBuffer,ur.indexBuffer,ur.segments,ve.paint,ne.transform.zoom,void 0,pr),na.draw(ne,Le.gl.TRIANGLES,nr?lt:Ze,qi.disabled,nr||Ki.opacity<1||Wi.hasTranslucentParts?cn.alphaBlended:cn.unblended,Fi.backCCW,uo,ve.id,ur.vertexBuffer,ur.indexBuffer,ur.segments,ve.paint,ne.transform.zoom,void 0,pr)}}}}()}(u,t,s,h),void I();if(O.type!=="model")return;const k=O.getModels(),U=[],V=u.transform.getFreeCameraOptions().position,H=r.bY([],[V.x,V.y,V.z],u.transform.worldSize);r.eb(H,H);const Q=[],X=[];let J=0;for(const ne of k){const oe=s.paint.get("model-rotation").constantOr(null),ve=s.paint.get("model-scale").constantOr(null),Se=s.paint.get("model-translation").constantOr(null);ne.computeModelMatrix(u,oe,ve,Se,!0,!0,!1);const Le=r.bx([]),Ie=r.ec(ne.position.lat,u.transform.zoom),Ce=r.bn([],[1,1,1/Ie]);r.bo(Le,Le,H),U.push({zScaleMatrix:Ce,negCameraPosMatrix:Le});for(const Ae of ne.nodes)Yl(u.transform,Ae,ne.matrix,u.transform.expandedFarZProjMatrix,J,Q,X);J++}if(Q.sort((ne,oe)=>oe.depth-ne.depth),u.renderPass!=="shadow"){if(_===1)for(const ne of X)ni(ne,u,s,U[ne.modelIndex],qi.disabled,u.colorModeForRenderPass());else{for(const ne of X)ni(ne,u,s,U[ne.modelIndex],qi.disabled,cn.disabled);for(const ne of X)ni(ne,u,s,U[ne.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(const ne of Q)ni(ne,u,s,U[ne.modelIndex],qi.disabled,u.colorModeForRenderPass());I()}else{for(const ne of X)zr(ne.mesh,ne.nodeModelMatrix,u,s);for(const ne of Q)zr(ne.mesh,ne.nodeModelMatrix,u,s);I()}}},Rd={line:function(u,t,s){if(u.hasElevatedBuckets=!1,u.hasNonElevatedBuckets=!1,u._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||u._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const h=t.getVisibleCoordinates();for(const _ of h){const y=t.getTile(_).getBucket(u);if(y&&(y.elevationType!=="none"?u.hasElevatedBuckets=!0:u.hasNonElevatedBuckets=!0,u.hasElevatedBuckets&&u.hasNonElevatedBuckets))break}}}else u.hasNonElevatedBuckets=!0},model:function(u,t,s){const h=t.getSource();if(!h.loaded())return;if(h.type==="vector"||h.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,h.type==="vector"?u.scope:""));if(h.type==="batched-model"||h.type!=="model")return;const _=h.getModels();for(const y of _)y.upload(s.context)},raster:function(u,t,s){const h=t.getSource();if(!(h instanceof Cs&&h.loaded()))return;const _=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!_)return;const y=u.paint.get("raster-array-band")||h.getInitialBand(_);if(y==null)return;const b=t.getIds().map(C=>t.getTileByID(C));for(const C of b)C.updateNeeded(_,y)&&h.prepareTile(C,_,y)},"raster-particle":function(u,t,s){const h=t.getSource();if(!(h instanceof Cs&&h.loaded()))return;const _=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!_)return;const y=u.paint.get("raster-particle-array-band")||h.getInitialBand(_);if(y==null)return;const b=t.getIds().map(C=>t.getTileByID(C));for(const C of b)C.updateNeeded(_,y)&&h.prepareTile(C,_,y)}},Qo={fill:Rs},Ih={fill:function(u,t,s,h){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const _=u.context.gl,y=new yi(_.LEQUAL,yi.ReadOnly,u.depthRangeFor3D),b=new qi({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),C=u.transform.getFreeCameraOptions().position,I=u.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const O of h){const k=t.getTile(O),U=k.getBucket(s);if(!U)continue;const V=U.elevatedStructures;if(!V||V.maskSegments.segments[0].primitiveLength===0)continue;const H=Af(O.toUnwrapped(),C),Q=u.translatePosMatrix(O.projMatrix,k,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),X=yh(Q,H,0,0,0);I.draw(u,_.TRIANGLES,y,b,cn.disabled,Fi.disabled,X,s.id,V.vertexBuffer,V.indexBuffer,V.maskSegments,s.paint,u.transform.zoom)}}};class ku{constructor(t,s,h,_,y,b){this.context=new cr(t,s),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const C=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const O of C)this._debugParams.enabledLayers[O]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const O of C)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],O);this.occlusionParams=new Vp(y),this.setup(),this.numSublayers=Ht.maxUnderzooming+Ht.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Io(this),this._wireframeDebugCache=new Nm,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,I,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_,this.worldview=b}updateTerrain(t,s){const h=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ec(this,t));const _=this._terrain;this.transform.elevation=h?_:null,_.update(t,this.transform,s),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(t){const s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,_]=s.getFovAdjustedRange(this.transform._fov);if(h>_)return void(this.transform.fogCullDistSq=null);const y=h+.78*(_-h);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Ec(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,s){if(this.width=t*r.q.devicePixelRatio,this.height=s*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._mergedLayers[h].resize()}setup(){const t=this.context,s=new r.ba;s.emplaceBack(0,0),s.emplaceBack(r.aj,0),s.emplaceBack(0,r.aj),s.emplaceBack(r.aj,r.aj),this.tileExtentBuffer=t.createVertexBuffer(s,r.bc.members),this.tileExtentSegments=r.bd.simpleSegment(0,0,4,2);const h=new r.ba;h.emplaceBack(0,0),h.emplaceBack(r.aj,0),h.emplaceBack(0,r.aj),h.emplaceBack(r.aj,r.aj),this.debugBuffer=t.createVertexBuffer(h,r.bc.members),this.debugSegments=r.bd.simpleSegment(0,0,4,5);const _=new r.ba;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,r.bc.members),this.viewportSegments=r.bd.simpleSegment(0,0,4,2);const y=new r.aZ;y.emplaceBack(0,0,0,0),y.emplaceBack(r.aj,0,r.aj,0),y.emplaceBack(0,r.aj,0,r.aj),y.emplaceBack(r.aj,r.aj,r.aj,r.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(y,r.bf.members),this.mercatorBoundsSegments=r.bd.simpleSegment(0,0,4,2);const b=new r.a_;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const C=new r.bb;for(const O of[0,1,3,2,0])C.emplaceBack(O);this.debugIndexBuffer=t.createIndexBuffer(C),this.emptyTexture=new r.T(t,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.bz();const I=this.context.gl;this.stencilClearMode=new qi({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,yi.disabled,this.stencilClearMode,cn.disabled,Fi.disabled,Su(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,h){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const I of h)if(this._tileClippingMaskIDs[I.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=s.id;const _=this.context,y=_.gl;this.nextStencilID+h.length>256&&this.clearStencil(),_.setColorMode(cn.disabled),_.setDepthMode(yi.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of h){const I=s.getTile(C),O=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:U,tileBoundsSegments:V}=this.getTileBoundsBuffers(I);b.draw(this,y.TRIANGLES,yi.disabled,new qi({func:y.ALWAYS,mask:0},O,255,y.KEEP,y.KEEP,y.REPLACE),cn.disabled,Fi.disabled,Su(C.projMatrix),"$clipping",k,U,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new qi({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new qi({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,h=t.sort((b,C)=>C.overscaledZ-b.overscaledZ),_=h[h.length-1].overscaledZ,y=h[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let C=0;C<y;C++)b[C+_]=new qi({func:s.GEQUAL,mask:255},C+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=y,[b,h]}return[{[_]:qi.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new cn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?cn.unblended:cn.alphaBlended}colorModeForDrapableLayerRenderPass(t){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new cn([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new r.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,s,h,_=!1){if(this.depthOcclusion)return new yi(this.context.gl.GREATER,yi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return yi.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new yi(h||this.context.gl.LEQUAL,s,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,s=Math.ceil(this.width),h=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),y=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===h||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&h!==0&&(this.depthFBO=new Vl(this.context,s,h,!1,"texture"),this.depthTexture=new r.T(this.context,{width:s,height:h,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),t.bindTexture(t.TEXTURE_2D,y),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,s,h,0,0,s,h,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,s)=>t+s/this._fpsHistory.length,0))}render(t,s){const h=r.q.now();this._dt=h-this._timeStamp,this._timeStamp=h,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=s;const _=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),b=()=>this.style._getOrder(y).filter(Ze=>{const lt=_[Ze];return!(lt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[lt.type]});let C=b(),I=!1,O=!1;for(const Ze of C){const lt=_[Ze];lt.type==="circle"&&(I=!0),lt.type==="symbol"&&(lt.hasInitialOcclusionOpacityProperties?O=!0:I=!0)}let k=C.map(Ze=>_[Ze]);const U=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let V=0,H=!1;for(const Ze in U){const lt=U[Ze];lt.used&&(lt.prepare(this.context),lt.getSource().usedInConflation&&++V)}let Q=!1;for(const Ze of k)Ze.isHidden(this.transform.zoom)||(Ze.type==="clip"&&(Q=!0),this.prepareLayer(Ze));const X={},J={},ne={},oe={},ve={};for(const Ze in U){const lt=U[Ze];X[Ze]=lt.getVisibleCoordinates(),J[Ze]=X[Ze].slice().reverse(),ne[Ze]=lt.getVisibleCoordinates(!0).reverse(),oe[Ze]=lt.getShadowCasterCoordinates(),ve[Ze]=lt.sortCoordinatesByDistance(X[Ze])}const Se=Ze=>{const lt=this.style.getLayerSourceCache(Ze);return lt&&lt.used?lt.getSource():null};if(V||Q||this._clippingActiveLastFrame){const Ze=[],lt=[];let Ge=0;for(const bt of k)this.isSourceForClippingOrConflation(bt,Se(bt))&&(Ze.push(bt),lt.push(Ge)),Ge++;if(Ze&&(Q||Ze.length>1)||this._clippingActiveLastFrame){Q=!1;const bt=[];for(let st=0;st<Ze.length;st++){const Ct=Ze[st],Wt=lt[st],wt=this.style.getLayerSourceCache(Ct);if(!wt||!wt.used||!wt.getSource().usedInConflation&&Ct.type!=="clip")continue;let Vt=r.eu,gi=r.bQ.None;const di=[];let hi=!0;if(Ct.type==="clip"){Vt=Wt;for(const Ai of Ct.layout.get("clip-layer-types"))gi|=Ai==="model"?r.bQ.Model:Ai==="symbol"?r.bQ.Symbol:r.bQ.FillExtrusion;for(const Ai of Ct.layout.get("clip-layer-scope"))di.push(Ai);Ct.isHidden(this.transform.zoom)?hi=!1:Q=!0}hi&&bt.push({layer:Ct.fqid,cache:wt,order:Vt,clipMask:gi,clipScope:di})}this.replacementSource.setSources(bt),H=!0}}this._clippingActiveLastFrame=Q,H||this.replacementSource.clear(),this.conflationActive=H,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ze=0;Ze<k.length;Ze++){const lt=k[Ze],Ge=lt.cutoffRange();if(this.longestCutoffRange=Math.max(Ge,this.longestCutoffRange),Ge>0){const bt=Se(lt);bt&&(this.minCutoffZoom=Math.max(bt.minzoom,this.minCutoffZoom)),lt.minzoom&&(this.minCutoffZoom=Math.max(lt.minzoom,this.minCutoffZoom))}lt.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ze),this._lastOcclusionLayer=Ze)}const Le=this.style&&this.style.fog;Le?(this._fogVisible=Le.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Le.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ne),this.opaquePassCutoff=0,C=b(),k=C.map(Ze=>_[Ze]));const Ie=this._shadowRenderer;if(Ie){Ie.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ze in U)for(const lt of X[Ze]){let Ge={min:0,max:0};this.terrain&&(Ge=this.terrain.getMinMaxForTile(lt)||Ge),Ie.addShadowReceiver(lt.toUnwrapped(),Ge.min,Ge.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ou(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ce=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Ae=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ce&&!this._snow&&(this._snow=new gr(this)),!Ce&&this._snow&&(this._snow.destroy(),delete this._snow),Ae&&!this._rain&&(this._rain=new Ug(this)),!Ae&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!In.has(this.context.gl))return;this.renderPass="offscreen";for(const Ze of k){const lt=t.getLayerSourceCache(Ze);if(!Ze.hasOffscreenPass()||Ze.isHidden(this.transform.zoom))continue;const Ge=lt?J[lt.id]:void 0;(Ze.type==="custom"||Ze.type==="raster"||Ze.type==="raster-particle"||Ze.isSky()||Ge&&Ge.length)&&this.renderLayer(this,lt,Ze,Ge)}this.depthRangeFor3D=[0,1-(k.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,oe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Pe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ne=(()=>{if(s.showOverdrawInspector)return r.am.black;const Ze=this.style.fog;if(Ze&&this.transform.projection.supportsFog){const lt=this.style.getLut(Ze.scope);if(!Pe){const Ge=Ze.properties.get("color-use-theme")==="none",bt=Ze.properties.get("color").toNonPremultipliedRenderColor(Ge?null:lt).toArray01();return new r.am(...bt)}if(Pe){const Ge=Ze.properties.get("space-color-use-theme")==="none",bt=Ze.properties.get("space-color").toNonPremultipliedRenderColor(Ge?null:lt).toArray01();return new r.am(...bt)}}return r.am.transparent})();if(this.context.clear({color:Ne,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Pe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const Ze=k[this.currentLayer],lt=t.getLayerSourceCache(Ze);if(Ze.isSky())continue;const Ge=lt?(Ze.is3D(y)?ve:J)[lt.id]:void 0;this._renderTileClippingMasks(Ze,lt,Ge),this.renderLayer(this,lt,Ze,Ge)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Pe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const Ze=k[this.currentLayer],lt=t.getLayerSourceCache(Ze);Ze.isSky()&&this.renderLayer(this,lt,Ze,lt?J[lt.id]:void 0)}function Ke(Ze,lt){let Ge;return lt&&(Ge=(Ze.type==="symbol"?ne:Ze.is3D(y)?ve:J)[lt.id]),Ge}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){const Ze=k[this.currentLayer];if(Ze.type==="raster"||Ze.type==="raster-particle"){const lt=t.getLayerSourceCache(Ze);this.renderLayer(this,lt,Ze,Ke(Ze,lt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Je=0;Ie&&(Je=Ie.getShadowCastingLayerCount());let mt=!1,xt=-1;for(let Ze=0;Ze<C.length;++Ze){const lt=k[Ze];lt.isHidden(this.transform.zoom)||lt.is3D(y)&&(xt=Ze)}O&&xt===-1&&(I=!0);let Pt=!1;for(;this.currentLayer<C.length;){const Ze=k[this.currentLayer],lt=t.getLayerSourceCache(Ze);if(Ze.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ze)){if(Ze.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Pt&&Ze.is3D(y)&&!y){const Ge=this.currentLayer,bt=st=>{for(this.currentLayer=0;this.currentLayer<k.length;this.currentLayer++){const Ct=k[this.currentLayer];if(Qo[Ct.type]){const Wt=this.style.getLayerSourceCache(Ct);Qo[Ct.type](this,Wt,Ct,Ke(Ct,Wt),st)}}};bt("initialize"),bt("reset"),this.currentLayer=Ge,Pt=!0}if(I&&!mt&&this.terrain&&!this.transform.isOrthographic&&(mt=!0,this.blitDepth()),O&&xt!==-1&&this.currentLayer===xt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ze,lt,lt?X[lt.id]:void 0),this.renderLayer(this,lt,Ze,Ke(Ze,lt)),!this.terrain&&Ie&&Je>0&&Ze.hasShadowPass()&&--Je==0){{this.clearStencil();const Ge=this.currentLayer;for(this.currentLayer=0;this.currentLayer<k.length;this.currentLayer++){const bt=k[this.currentLayer];if(Ih[bt.type]){const st=this.style.getLayerSourceCache(bt);Ih[bt.type](this,st,bt,Ke(bt,st))}}this.currentLayer=Ge}if(Ie.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Ge=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ge;this.currentLayer++){const bt=k[this.currentLayer];if(!bt.hasLightBeamPass())continue;const st=t.getLayerSourceCache(bt);this.renderLayer(this,st,bt,st?J[st.id]:void 0)}this.currentLayer=Ge,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ge=this.currentLayer;this.depthOcclusion=!0;for(const bt of this.layersWithOcclusionOpacity){this.currentLayer=bt;const st=k[this.currentLayer],Ct=t.getLayerSourceCache(st),Wt=Ct?J[Ct.id]:void 0;this.terrain||this._renderTileClippingMasks(st,Ct,Ct?X[Ct.id]:void 0),this.renderLayer(this,Ct,st,Wt)}this.depthOcclusion=!1,this.currentLayer=Ge,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ze=null;k.forEach(lt=>{const Ge=t.getLayerSourceCache(lt);Ge&&!lt.isHidden(this.transform.zoom)&&Ge.getVisibleCoordinates().length&&(!Ze||Ze.getSource().maxzoom<Ge.getSource().maxzoom)&&(Ze=Ge)}),Ze&&this.options.showTileBoundaries&&Zl(this,Ze,Ze.getVisibleCoordinates(),r.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Zl(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ze){const lt=Ze.transform.padding;Ed(Ze,Ze.transform.height-(lt.top||0),3,Op),Ed(Ze,lt.bottom||0,3,Lp),Sh(Ze,lt.left||0,3,oo),Sh(Ze,Ze.transform.width-(lt.right||0),3,If);const Ge=Ze.transform.centerPoint;(function(bt,st,Ct,Wt){Pu(bt,st-1,Ct-10,2,20,Wt),Pu(bt,st-10,Ct-1,20,2,Wt)})(Ze,Ge.x,Ze.transform.height-Ge.y,Ma)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),H||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:s}=this.transform.projection,h=!s||!s.includes(t.type);if(Rd[t.type]&&(h||this.terrain&&t.type==="custom")){const _=this.style.getLayerSourceCache(t);Rd[t.type](t,_,this)}this.gpuTimingEnd()}renderLayer(t,s,h,_){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||_&&_.length)&&(this.id=h.id,this.gpuTimingStart(h),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(h.type)&&(!t.terrain||h.type!=="custom")||h.type==="clip"||En[h.type](t,s,h,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,h=this.context.gl;let _=this.gpuTimers[t.id];_||(_=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:h.createQuery()}),_.calls++,h.beginQuery(s.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,s=this.context.gl,h=s.createQuery();this.deferredRenderGpuTimeQueries.push(h),s.beginQuery(t.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const s={};for(const h in t){const _=t[h],y=this.context.extTimerQuery,b=y.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(_.query),s[h]=b}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let h=0;for(const _ of t)h+=s.getQueryParameter(_,s.QUERY_RESULT)/1e6,s.deleteQuery(_);return h}translatePosMatrix(t,s,h,_,y){if(!h[0]&&!h[1])return t;const b=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(b){const O=Math.sin(b),k=Math.cos(b);h=[h[0]*k-h[1]*O,h[0]*O+h[1]*k]}const C=[y?h[0]:r.aw(s,h[0],this.transform.zoom),y?h[1]:r.aw(s,h[1],this.transform.zoom),0],I=new Float32Array(16);return r.bo(I,t,C),I}saveTileTexture(t){const s=t.size[0],h=this._tileTextures[s];h?h.push(t):this._tileTextures[s]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,s,h){const _=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,y=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||_||s!==void 0&&!s||y.push("FOG","FOG_DITHERING"),_&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(t,s){this.cache=this.cache||{};const h=s&&s.defines||[],_=s&&s.config,y=this.currentGlobalDefines(t,s&&s.overrideFog,s&&s.overrideRtt).concat(h),b=Ac.cacheKey(_c[t],t,y,_);return this.cache[b]||(this.cache[b]=new Ac(this.context,t,_c[t],_,xd[t],y)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,s){if(this.style.enable3dLights()){const h=this.style.directionalLight,_=this.style.ambientLight;if(h&&_){const y=((b,C,I)=>{const O=b.properties.get("direction"),k=b.properties.get("color-use-theme")==="none",U=b.properties.get("color").toNonPremultipliedRenderColor(k?null:I.getLut(b.scope)).toArray01(),V=b.properties.get("intensity"),H=C.properties.get("color-use-theme")==="none",Q=C.properties.get("color").toNonPremultipliedRenderColor(H?null:I.getLut(C.scope)).toArray01(),X=C.properties.get("intensity"),J=[O.x,O.y,O.z],ne=r.dw(Q,X),oe=r.dw(U,V);return{u_lighting_ambient_color:ne,u_lighting_directional_dir:J,u_lighting_directional_color:oe,u_ground_radiance:Kc(J,oe,ne)}})(h,_,this.style);s.setLightsUniformValues(t,y)}}}uploadCommonUniforms(t,s,h,_,y){if(this.uploadCommonLightUniforms(t,s),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const C=b.getOpacity(this.transform.pitch),I=((O,k,U,V,H,Q,X,J,ne,oe,ve,Se)=>{const Le=O.transform,Ie=k.properties.get("color-use-theme")==="none",Ce=k.properties.get("color").toNonPremultipliedRenderColor(Ie?null:O.style.getLut(k.scope)).toArray01();Ce[3]=V;const Ae=O.frameCounter/1e3%1,[Pe,Ne]=k.properties.get("vertical-range");return{u_fog_matrix:U?Le.calculateFogTileMatrix(U):Se||O.identityMat,u_fog_range:k.getFovAdjustedRange(Le._fov),u_fog_color:Ce,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Pe,Ne),Ne],u_fog_temporal_offset:Ae,u_frustum_tl:H,u_frustum_tr:Q,u_frustum_br:X,u_frustum_bl:J,u_globe_pos:ne,u_globe_radius:oe,u_viewport:ve,u_globe_transition:r.ah(Le.zoom),u_is_globe:+(Le.projection.name==="globe")}})(this,b,h,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],_);s.setFogUniformValues(t,I)}y&&s.setCutoffUniformValues(t,y.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const _ of h)s[_.key]=t[_.key]||new Va(_,512,this.transform.tileZoom,this,void 0,this.worldview);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,s){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[t.key];return s||(this._cachedTileFogOpacities[t.key]=s=this.style.fog.getOpacityForTile(t)),s[0]>=rt||s[1]>=rt}setupDepthForOcclusion(t,s,h){const _=this.context,y=_.gl,b=!!h;var C;h||(h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(y.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),h.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],h.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],h.u_occluder_half_size=.5*this.occlusionParams.occluderSize,h.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),_.activeTexture.set(y.TEXTURE0),b||s.setTerrainUniformValues(_,h)}}function Tl(u,t){let s=!1,h=null;const _=()=>{h=null,s&&(u(),h=setTimeout(_,t),s=!1)};return()=>(s=!0,h||_(),h)}class Of{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Tl(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const s=Dd(t);if(this._hashName){const h=this._hashName;let _=!1;const y=location.hash.slice(1).split("&").map(b=>{const C=b.split("=")[0];return C===h?(_=!0,`${C}=${s}`):b}).filter(b=>b);return _||y.push(`${h}=${s}`),`#${y.join("&")}`}return`#${s}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(Number(h)))){const h=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Dd(u,t){const s=u.getCenter(),h=Math.round(100*u.getZoom())/100,_=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),b=Math.round(s.lng*y)/y,C=Math.round(s.lat*y)/y,I=u.getBearing(),O=u.getPitch();let k=t?`/${b}/${C}/${h}`:`${h}/${C}/${b}`;return(I||O)&&(k+="/"+Math.round(10*I)/10),O&&(k+=`/${Math.round(O)}`),k}const Rh={linearity:.3,easing:r.ew(0,0,.3,1)},nu=r.h({deceleration:2500,maxSpeed:1400},Rh),So=r.h({deceleration:20,maxSpeed:1400},Rh),Sl=r.h({deceleration:1e3,maxSpeed:360},Rh),Rc=r.h({deceleration:1e3,maxSpeed:90},Rh);class Nu{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=r.q.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)s.zoom+=y.zoomDelta||0,s.bearing+=y.bearingDelta||0,s.pitch+=y.pitchDelta||0,y.panDelta&&s.pan._add(y.panDelta),y.around&&(s.around=y.around),y.pinchAround&&(s.pinchAround=y.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(s.pan.mag()){const y=Bu(s.pan.mag(),h,r.h({},nu,t||{}));_.offset=s.pan.mult(y.amount/s.pan.mag()),_.center=this._map.transform.center,Fu(_,y)}if(s.zoom){const y=Bu(s.zoom,h,So);_.zoom=this._map.transform.zoom+y.amount,Fu(_,y)}if(s.bearing){const y=Bu(s.bearing,h,Sl);_.bearing=this._map.transform.bearing+r.ay(y.amount,-179,179),Fu(_,y)}if(s.pitch){const y=Bu(s.pitch,h,Rc);_.pitch=this._map.transform.pitch+y.amount,Fu(_,y)}if(_.zoom||_.bearing){const y=s.pinchAround===void 0?s.around:s.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Fu(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function Bu(u,t,s){const{maxSpeed:h,linearity:_,deceleration:y}=s,b=r.ay(u*_/(t/1e3),-h,h),C=Math.abs(b)/(y*_);return{easing:s.easing,duration:1e3*C,amount:b*(C/2)}}class Es extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h,_={}){const y=gt(s.getCanvasContainer(),h),b=s.unproject(y);super(t,r.h({point:y,lngLat:b,originalEvent:h},_)),this._defaultPrevented=!1,this.target=s}}class ju extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h){const _=t==="touchend"?h.changedTouches:h.touches,y=Xe(s.getCanvasContainer(),_),b=y.map(I=>s.unproject(I)),C=y.reduce((I,O,k,U)=>I.add(O.div(U.length)),new r.P(0,0));super(t,{points:y,point:C,lngLats:b,lngLat:s.unproject(C),originalEvent:h}),this._defaultPrevented=!1}}class ta extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class Jo{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new ta(this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Es(t.type,this._map,t))}mouseup(t){this._map.fire(new Es(t.type,this._map,t))}preclick(t){const s=r.h({},t);s.type="preclick",this._map.fire(new Es(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Es(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Es(t.type,this._map,t))}mouseover(t){this._map.fire(new Es(t.type,this._map,t))}mouseout(t){this._map.fire(new Es(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ju(t.type,this._map,t))}touchmove(t){this._map.fire(new ju(t.type,this._map,t))}touchend(t){this._map.fire(new ju(t.type,this._map,t))}touchcancel(t){this._map.fire(new ju(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class El{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Es(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Es("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Es(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lf{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(De(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const h=s,_=this._startPos,y=this._lastPos;if(!_||!y||y.equals(h)||!this._box&&h.dist(_)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=me("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(_.x,h.x),C=Math.max(_.x,h.x),I=Math.min(_.y,h.y),O=Math.max(_.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${I}px)`,this._box.style.width=C-b+"px",this._box.style.height=O-I+"px")})}mouseupWindow(t,s){if(!this._active)return;const h=this._startPos,_=s;if(h&&t.button===0){if(this.reset(),At(),h.x!==_.x||h.y!==_.y)return this._map.fire(new r.A("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(h,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),we(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new r.A(t,{originalEvent:s}))}}function el(u,t){const s={};for(let h=0;h<u.length;h++)s[u[h].identifier]=t[h];return s}class ls{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(_){const y=new r.P(0,0);for(const b of _)y._add(b);return y.div(_.length)}(s),this.touches=el(h,s)))}touchmove(t,s,h){if(this.aborted||!this.centroid)return;const _=el(h,s);for(const y in this.touches){const b=_[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,s,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Ds{constructor(t){this.singleTap=new ls(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,h){this.singleTap.touchstart(t,s,h)}touchmove(t,s,h){this.singleTap.touchmove(t,s,h)}touchend(t,s,h){const _=this.singleTap.touchend(t,s,h);if(_){const y=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(_)<30;if(y&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Dh{constructor(){this._zoomIn=new Ds({numTouches:1,numTaps:2}),this._zoomOut=new Ds({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,h){this._zoomIn.touchstart(t,s,h),this._zoomOut.touchstart(t,s,h)}touchmove(t,s,h){this._zoomIn.touchmove(t,s,h),this._zoomOut.touchmove(t,s,h)}touchend(t,s,h){const _=this._zoomIn.touchend(t,s,h),y=this._zoomOut.touchend(t,s,h);return _?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(_)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Pd={0:1,2:2},Kl={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Ph{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const h=je(t);this._correctButton(t,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(t,s){const h=this._lastPoint;if(h){if(t.preventDefault(),this._eventButton!=null&&function(_,y){const b=Pd[y];return _.buttons===void 0||(_.buttons&b)!==b}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(t){this._lastPoint&&je(t)===this._eventButton&&(this._moved&&At(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zf extends Ph{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class Ql extends Ph{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Kl[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const h=.8*(s.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Jl extends Ph{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Kl[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const h=-.5*(s.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class kf{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),r.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,s,h){return this._calculateTransform(t,s,h)}touchmove(t,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!r.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,s,h)}}touchend(t,s,h){this._calculateTransform(t,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,h){h.length>0&&(this._active=!0);const _=el(h,s),y=new r.P(0,0),b=new r.P(0,0);let C=0;for(const O in _){const k=_[O],U=this._touches[O];U&&(y._add(k),b._add(k.sub(U)),C++,_[O]=k)}if(this._touches=_,C<this._minTouches||!b.mag())return;const I=b.div(C);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(C),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Oh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,h){return{}}touchstart(t,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,h){const _=this._firstTwoTouches;if(!_)return;t.preventDefault();const[y,b]=_,C=Vu(h,s,y),I=Vu(h,s,b);if(!C||!I)return;const O=this._aroundCenter?null:C.add(I).div(2);return this._move([C,I],O,t)}touchend(t,s,h){if(!this._firstTwoTouches)return;const[_,y]=this._firstTwoTouches,b=Vu(h,s,_),C=Vu(h,s,y);b&&C||(this._active&&At(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Vu(u,t,s){for(let h=0;h<u.length;h++)if(u[h].identifier===s)return t[h]}function ru(u,t){return Math.log(u/t)/Math.LN2}class Nf extends Oh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ru(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ru(this._distance,h),pinchAround:s}}}function Lh(u,t){return 180*u.angleWith(t)/Math.PI}class Up extends Oh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const h=this._vector;if(this._vector=t[0].sub(t[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Lh(this._vector,h),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const _=Lh(t,h);return Math.abs(_)<s}}function Od(u){return Math.abs(u.y)>Math.abs(u.x)}class Bm extends Oh{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Od(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,h){const _=this._lastPoints;if(!_)return;const y=t[0].sub(_[0]),b=t[1].sub(_[1]);return this._map._cooperativeGestures&&!r.ex()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(y,b,h.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+b.y)/2*-.5})}gestureBeginsVertically(t,s,h){if(this._valid!==void 0)return this._valid;const _=t.mag()>=2,y=s.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const b=t.y>0==s.y>0;return Od(t)&&Od(s)&&b}}const Gp={panStep:100,bearingStep:15,pitchStep:10};class ia{constructor(){const t=Gp;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,h=0,_=0,y=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(h=0,_=0),{cameraAnimation:C=>{const I=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:fa,zoom:s?Math.round(I)+s*(t.shiftKey?2:1):I,bearing:C.getBearing()+h*this._bearingStep,pitch:C.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:C.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function fa(u){return u*(2-u)}const Ff=4.000244140625,Hp=1/450;class qp{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Hp,r.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=r.q.now(),_=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%Ff==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=gt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>Ff?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&k!==0&&(k=1/k);const U=s(),V=Math.pow(2,U),H=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(H*k))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),_=this._startZoom,y=this._easing;let b,C=!1;if(this._type==="wheel"&&_&&y){const O=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),k=y(O);b=r.ai(_,h,k),O<1?this._frameId||(this._frameId=!0):C=!0}else b=h,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let I=b-s();return I*this._lastDelta<0&&(I=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:I,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=r.ey;if(this._prevEase){const h=this._prevEase,_=(r.q.now()-h.start)/h.duration,y=h.easing(_+.01)-h.easing(_),b=.27/Math.sqrt(y*y+1e-4)*.01,C=Math.sqrt(.0729-b*b);s=r.ew(b,C,.25,1)}return this._prevEase={start:r.q.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class $p{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Zp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ld{constructor(){this._tap=new Ds({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,s,h))}touchmove(t,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const _=s[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,s,h)}touchend(t,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,s,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bf{constructor(t,s,h){this._el=t,this._mousePan=s,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jm{constructor(t,s,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Vm{constructor(t,s,h,_){this._el=t,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const zd=u=>u.zoom||u.drag||u.pitch||u.rotate;class kr extends r.A{}class jf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const h=r.at([],s,t);this.radius=r.ae(h[2]<0?r.eA([],h,this.constants):[h[0],h[1],0])}projectRay(t){r.eA(t,t,this.constants),r.au(t,t),r.eB(t,t,this.constants);const s=r.bY([],t,this.radius);if(s[2]>0){const h=r.bY([],[0,0,1],r.bG(s,[0,0,1])),_=r.bY([],r.au([],[s[0],s[1],0]),this.radius),y=r.cV([],s,r.bY([],r.at([],r.cV([],_,h),s),2));s[0]=y[0],s[1]=y[1]}return s}}function zh(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Vf{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Nu(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new jf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),r.aV(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,y,b]of this._listeners){const C=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(y,C,b)}}destroy(){for(const[t,s,h]of this._listeners){const _=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(s,_,h)}}_addDefaultHandlers(t){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new Jo(s,t));const _=s.boxZoom=new Lf(s,t);this._add("boxZoom",_);const y=new Dh,b=new Zp;s.doubleClickZoom=new $p(b,y),this._add("tapZoom",y),this._add("clickZoom",b);const C=new Ld;this._add("tapDragZoom",C);const I=s.touchPitch=new Bm(s);this._add("touchPitch",I);const O=new Ql(t),k=new Jl(t);s.dragRotate=new jm(t,O,k),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const U=new zf(t),V=new kf(s,t);s.dragPan=new Bf(h,U,V),this._add("mousePan",U),this._add("touchPan",V,["touchZoom","touchRotate"]);const H=new Up,Q=new Nf;s.touchZoomRotate=new Vm(h,Q,H,C),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new El(s));const X=s.scrollZoom=new qp(s,this);this._add("scrollZoom",X,["mousePan"]);const J=s.keyboard=new ia;this._add("keyboard",J);for(const ne of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ne]&&s[ne].enable(t[ne])}_add(t,s,h){this._handlers.push({handlerName:t,handler:s,allowed:h}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!zd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,s,h){for(const _ in t)if(_!==h&&(!s||s.indexOf(_)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const h of t)this._el.contains(h.target)&&s.push(h);return s}handleEvent(t,s){this._updatingCamera=!0;const h=t.type==="renderFrame",_=h?void 0:t,y={needsRenderFrame:!1},b={},C={},I=t.touches?this._getMapTouches(t.touches):void 0,O=I?Xe(this._el,I):h?void 0:gt(this._el,t);for(const{handlerName:V,handler:H,allowed:Q}of this._handlers){if(!H.isEnabled())continue;let X;this._blockedByActive(C,Q,V)?H.reset():H[s||t.type]&&(X=H[s||t.type](t,O,I),this.mergeHandlerResult(y,b,X,V,_),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||H.isActive())&&(C[V]=H)}const k={};for(const V in this._previousActiveHandlers)C[V]||(k[V]=_);this._previousActiveHandlers=C,(Object.keys(k).length||zh(y))&&(this._changes.push([y,b,k]),this._triggerRenderFrame()),(Object.keys(C).length||zh(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=y;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(t,s,h,_,y){if(!h)return;r.h(t,h);const b={handlerName:_,originalEvent:h.originalEvent||y};h.zoomDelta!==void 0&&(s.zoom=b),h.panDelta!==void 0&&(s.drag=b),h.pitchDelta!==void 0&&(s.pitch=b),h.bearingDelta!==void 0&&(s.rotate=b)}_applyChanges(){const t={},s={},h={};for(const[_,y,b]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(t.around=_.around),_.aroundCoord!==void 0&&(t.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),r.h(s,y),r.h(h,b);this._updateMapTransform(t,s,h),this._changes=[]}_updateMapTransform(t,s,h){const _=this._map,y=_.transform,b=oe=>[oe.x,oe.y,oe.z];if((oe=>{const ve=this._eventsInProgress.drag;return ve&&!this._handlersById[ve.handlerName].isActive()})()&&!zh(t)){const oe=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),oe!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&_._stop(!0),!zh(t))return void this._fireEvents(s,h,!0);let{panDelta:C,zoomDelta:I,bearingDelta:O,pitchDelta:k,around:U,aroundCoord:V,pinchAround:H}=t;y._isCameraConstrained&&(I>0&&(I=0),y._isCameraConstrained=!1),H!==void 0&&(U=H),(I||(oe=>s[oe]&&!this._eventsInProgress[oe])("drag"))&&U&&(this._dragOrigin=b(y.pointCoordinate3D(U)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),U=U||_.transform.centerPoint,O&&(y.bearing+=O),k&&(y.pitch+=k),y._updateCameraState();const Q=[0,0,0];if(C)if(y.projection.name==="mercator"){const oe=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(U).dir),ve=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(U.sub(C)).dir);Q[0]=ve[0]-oe[0],Q[1]=ve[1]-oe[1]}else{const oe=y.pointCoordinate(U);if(y.projection.name==="globe"){C=C.rotate(-y.angle);const ve=y._pixelsPerMercatorPixel/y.worldSize;Q[0]=-C.x*r.ez(r.aY(oe.y))*ve,Q[1]=-C.y*r.ez(y.center.lat)*ve}else{const ve=y.pointCoordinate(U.sub(C));oe&&ve&&(Q[0]=ve.x-oe.x,Q[1]=ve.y-oe.y)}}const X=y.zoom,J=[0,0,0];if(I){const oe=b(V||y.pointCoordinate3D(U)),ve={dir:r.au([],r.at([],oe,y._camera.position))};if(ve.dir[2]<0){const Se=y.zoomDeltaToMovement(oe,I);r.bY(J,ve.dir,Se)}}const ne=r.cV(Q,Q,J);y._translateCameraConstrained(ne),I&&Math.abs(y.zoom-X)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,h,!0)}_fireEvents(t,s,h){const _=zd(this._eventsInProgress),y=zd(t),b={};for(const k in t){const{originalEvent:U}=t[k];this._eventsInProgress[k]||(b[`${k}start`]=U),this._eventsInProgress[k]=t[k]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(const k in b)this._fireEvent(k,b[k]);y&&this._fireEvent("move",y.originalEvent);for(const k in t){const{originalEvent:U}=t[k];this._fireEvent(k,U)}const C={};let I;for(const k in this._eventsInProgress){const{handlerName:U,originalEvent:V}=this._eventsInProgress[k];this._handlersById[U].isActive()||(delete this._eventsInProgress[k],I=s[U]||V,C[`${k}end`]=I)}for(const k in C)this._fireEvent(k,C[k]);const O=zd(this._eventsInProgress);if(h&&(_||y)&&!O){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;k?(U(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:I})):(this._map.fire(new r.A("moveend",{originalEvent:I})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new r.A(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new kr("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Uf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class su extends r.E{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,r.aV(["_renderFrameCallback"],this)}getCenter(){return new r.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,h){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,r.h({offset:t},s),h)}panTo(t,s,h){return this.easeTo(r.h({center:t},s),h)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,h){return this.easeTo(r.h({zoom:t},s),h)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,h){return this.easeTo(r.h({bearing:t},s),h)}resetNorth(t,s){return this.rotateTo(0,r.h({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(r.h({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=r.aG.convert(t);const h=s&&s.bearing||0,_=s&&s.pitch||0,y=t.getNorthWest(),b=t.getSouthEast();return this._cameraForBounds(this.transform,y,b,h,_,s)}_extendPadding(t){const s={top:0,right:0,bottom:0,left:0};return t==null?r.h({},s,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:r.h({},s,t)}_extendCameraOptions(t){return(t=r.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,s){const h=s.max[0]-s.min[0],_=s.max[1]-s.min[1];return h/_>t.aspect?h/(2*Math.tan(.5*t.fovX)*t.aspect):_/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,s,h,_,y,b){const C=t.clone(),I=this._extendCameraOptions(b);C.bearing=_,C.pitch=y;const O=r.cd.convert(s),k=r.cd.convert(h),U=.5*(O.lat+k.lat),V=.5*(O.lng+k.lng),H=r.eC(U,V),Q=r.au([],H),X=r.au([],r.bF([],Q,[0,1,0])),J=r.bF([],X,Q),ne=[X[0],X[1],X[2],0,J[0],J[1],J[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],oe=[H,r.eC(O.lat,O.lng),r.eC(k.lat,O.lng),r.eC(k.lat,k.lng),r.eC(O.lat,k.lng),r.eC(U,O.lng),r.eC(U,k.lng),r.eC(O.lat,V),r.eC(k.lat,V)];let ve=r.cW.fromPoints(oe.map(st=>[r.bG(X,st),r.bG(J,st),r.bG(Q,st)]));const Se=r.ad([],ve.center,ne);r.eD(Se)===0&&r.eE(Se,0,0,1),r.au(Se,Se),r.bY(Se,Se,r.aB),C.center=r.eF(Se);const Le=C.getWorldToCameraMatrix(),Ie=r.bi(new Float64Array(16),Le);ve=r.cW.applyTransform(ve,r.az([],Le,ne));const Ce=this._extendAABB(ve,C,I,_);if(!Ce)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ve=Ce,r.ad(Se,Se,Le);const Ae=.5*(ve.max[2]-ve.min[2]),Pe=this._minimumAABBFrustumDistance(C,ve),Ne=r.bY([],[0,0,1],Ae),Ke=r.cV(Ne,Se,Ne),Je=Pe+(C.pitch===0?0:r.bD(Se,Ke)),mt=C.globeCenterInViewSpace,xt=r.at([],Se,[mt[0],mt[1],mt[2]]);r.au(xt,xt),r.bY(xt,xt,Je);const Pt=r.cV([],Se,xt);r.ad(Pt,Pt,Ie);const Ze=r.eq/r.aB,lt=r.ae(Pt),Ge=r.c6(Math.max(lt*Ze-r.eq,Number.EPSILON),0),bt=Math.min(C.zoomFromMercatorZAdjusted(Ge),I.maxZoom);return bt>.5*(r.cL+r.cx)?(C.setProjection({name:"mercator"}),C.zoom=bt,this._cameraForBounds(C,s,h,_,y,b)):{center:C.center,zoom:bt,bearing:_,pitch:y}}_extendAABB(t,s,h,_){const y=.5*((h.padding.left||0)+(h.padding.right||0)),b=.5*((h.padding.top||0)+(h.padding.bottom||0)),C=b,I=y,O=y,k=b,U=s.width-(I+O),V=s.height-(C+k),H=r.at([],t.max,t.min),Q=Math.min(U/H[0],V/H[1]),X=Math.min(s.scaleZoom(s.scale*Q),h.maxZoom);if(isNaN(X))return null;const J=s.scale/s.zoomScale(X),ne=new r.cW([t.min[0]-I*J,t.min[1]-k*J,t.min[2]],[t.max[0]+O*J,t.max[1]+C*J,t.max[2]]),oe=(typeof h.offset.x=="number"&&typeof h.offset.y=="number"?new r.P(h.offset.x,h.offset.y):r.P.convert(h.offset)).rotate(-r.al(_));return ne.center[0]-=oe.x*J,ne.center[1]+=oe.y*J,ne}queryTerrainElevation(t,s){const h=this.transform.elevation;return h?(s=r.h({},{exaggerated:!0},s),h.getAtPoint(r.ac.fromLngLat(t),null,s.exaggerated)):null}_cameraForBounds(t,s,h,_,y,b){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,s,h,_,y,b);const C=t.clone(),I=this._extendCameraOptions(b);C.bearing=_,C.pitch=y;const O=r.cd.convert(s),k=r.cd.convert(h),U=new r.cd(O.lng,k.lat),V=new r.cd(k.lng,O.lat),H=C.project(O),Q=C.project(k),X=this.queryTerrainElevation(O),J=this.queryTerrainElevation(k),ne=this.queryTerrainElevation(U),oe=this.queryTerrainElevation(V),ve=[[H.x,H.y,Math.min(X||0,J||0,ne||0,oe||0)],[Q.x,Q.y,Math.max(X||0,J||0,ne||0,oe||0)]];let Se=r.cW.fromPoints(ve);const Le=C.getWorldToCameraMatrix(),Ie=r.bi(new Float64Array(16),Le);Se=r.cW.applyTransform(Se,Le);const Ce=this._extendAABB(Se,C,I,_);if(!Ce)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Se=Ce;const Ae=.5*r.at([],Se.max,Se.min)[2],Pe=this._minimumAABBFrustumDistance(C,Se),Ne=[0,0,1,0];r.aA(Ne,Ne,Le),r.eG(Ne,Ne);const Ke=r.bY([],Ne,Pe+Ae),Je=r.cV([],Se.center,Ke);r.ad(Se.center,Se.center,Ie),r.ad(Je,Je,Ie);const mt=C.unproject(new r.P(Se.center[0],Se.center[1])),xt=r.eH(C.projection,mt),Pt=Math.pow(2,xt),Ze=Math.min(C._zoomFromMercatorZ(Je[2]*C.pixelsPerMeter*Pt/C.worldSize),I.maxZoom);return C.mercatorFromTransition&&Ze<.5*(r.cL+r.cx)?(C.setProjection({name:"globe"}),C.zoom=Ze,this._cameraForBounds(C,s,h,_,y,b)):{center:mt,zoom:Ze,bearing:_,pitch:y}}fitBounds(t,s,h){const _=this.cameraForBounds(t,s);return this._fitInternal(_,s,h)}fitScreenCoordinates(t,s,h,_,y){const b=r.P.convert(t),C=r.P.convert(s),I=new r.P(Math.min(b.x,C.x),Math.min(b.y,C.y)),O=new r.P(Math.max(b.x,C.x),Math.max(b.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,C))return this;const k=this.transform.pointLocation3D(I),U=this.transform.pointLocation3D(O),V=this.transform.pointLocation3D(new r.P(I.x,O.y)),H=this.transform.pointLocation3D(new r.P(O.x,I.y)),Q=[Math.min(k.lng,U.lng,V.lng,H.lng),Math.min(k.lat,U.lat,V.lat,H.lat)],X=[Math.max(k.lng,U.lng,V.lng,H.lng),Math.max(k.lat,U.lat,V.lat,H.lat)],J=_&&_.pitch?_.pitch:this.getPitch(),ne=this._cameraForBounds(this.transform,Q,X,h,J,_);return this._fitInternal(ne,_,y)}_fitInternal(t,s,h){return t?(s=r.h(t,s)).linear?this.easeTo(s,h):this.flyTo(s,h):this}jumpTo(t,s){this.stop();const h=t.preloadOnly?this.transform.clone():this.transform;let _=!1,y=!1,b=!1;"zoom"in t&&h.zoom!==+t.zoom&&(_=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=r.cd.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(y=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(b=!0,h.pitch=+t.pitch);const C=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!h.isPaddingEqual(C))if(t.retainPadding===!1){const I=h.clone();I.padding=C,h.setLocationAtPoint(h.center,I.centerPoint)}else h.padding=C;return t.preloadOnly?(this._preloadTiles(h),this):(this.fire(new r.A("movestart",s)).fire(new r.A("move",s)),_&&this.fire(new r.A("zoomstart",s)).fire(new r.A("zoom",s)).fire(new r.A("zoomend",s)),y&&this.fire(new r.A("rotatestart",s)).fire(new r.A("rotate",s)).fire(new r.A("rotateend",s)),b&&this.fire(new r.A("pitchstart",s)).fire(new r.A("pitch",s)).fire(new r.A("pitchend",s)),this.fire(new r.A("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Uf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return r.w(Uf),this;this.stop();const _=h.zoom,y=h.pitch,b=h.bearing;h.setFreeCameraOptions(t);const C=_!==h.zoom,I=y!==h.pitch,O=b!==h.bearing;return this.fire(new r.A("movestart",s)).fire(new r.A("move",s)),C&&this.fire(new r.A("zoomstart",s)).fire(new r.A("zoom",s)).fire(new r.A("zoomend",s)),O&&this.fire(new r.A("rotatestart",s)).fire(new r.A("rotate",s)).fire(new r.A("rotateend",s)),I&&this.fire(new r.A("pitchstart",s)).fire(new r.A("pitch",s)).fire(new r.A("pitchend",s)),this.fire(new r.A("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=r.h({offset:[0,0],duration:500,easing:r.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const h=this.transform,_=this.getZoom(),y=this.getBearing(),b=this.getPitch(),C=this.getPadding(),I="zoom"in t?+t.zoom:_,O="bearing"in t?this._normalizeBearing(t.bearing,y):y,k="pitch"in t?+t.pitch:b,U=this._extendPadding(t.padding),V=r.P.convert(t.offset);let H,Q,X;if(h.projection.name==="globe"){const Ne=r.ac.fromLngLat(h.center),Ke=V.rotate(-h.angle);Ne.x+=Ke.x/h.worldSize,Ne.y+=Ke.y/h.worldSize;const Je=Ne.toLngLat(),mt=r.cd.convert(t.center||Je);this._normalizeCenter(mt),H=h.centerPoint.add(Ke),Q=new r.P(Ne.x,Ne.y).mult(h.worldSize),X=new r.P(r.aD(mt.lng),r.aH(mt.lat)).mult(h.worldSize).sub(Q)}else{H=h.centerPoint.add(V);const Ne=h.pointLocation(H),Ke=r.cd.convert(t.center||Ne);this._normalizeCenter(Ke),Q=h.project(Ne),X=h.project(Ke).sub(Q)}const J=h.zoomScale(I-_);let ne,oe;t.around&&(ne=r.cd.convert(t.around),oe=h.locationPoint(ne));const ve=this._zooming||I!==_,Se=this._rotating||y!==O,Le=this._pitching||k!==b,Ie=!h.isPaddingEqual(U),Ce=t.retainPadding===!1?h.clone():h,Ae=Ne=>Ke=>{if(ve&&(Ne.zoom=r.ai(_,I,Ke)),Se&&(Ne.bearing=r.ai(y,O,Ke)),Le&&(Ne.pitch=r.ai(b,k,Ke)),Ie&&(Ce.interpolatePadding(C,U,Ke),H=Ce.centerPoint.add(V)),ne)Ne.setLocationAtPoint(ne,oe);else{const Je=Ne.zoomScale(Ne.zoom-_),mt=I>_?Math.min(2,J):Math.max(.5,J),xt=Math.pow(mt,1-Ke),Pt=Ne.unproject(Q.add(X.mult(Ke*xt)).mult(Je));Ne.setLocationAtPoint(Ne.renderWorldCopies?Pt.wrap():Pt,H)}return t.preloadOnly||this._fireMoveEvents(s),Ne};if(t.preloadOnly){const Ne=this._emulate(Ae,t.duration,h);return this._preloadTiles(Ne),this}const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ve,this._rotating=Se,this._pitching=Le,this._padding=Ie,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,Pe),this._ease(Ae(h),Ne=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(s,Ne)},t),this}_prepareEase(t,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||h.moving||this.fire(new r.A("movestart",t)),this._zooming&&!h.zooming&&this.fire(new r.A("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new r.A("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new r.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.A("move",t)),this._zooming&&this.fire(new r.A("zoom",t)),this._rotating&&this.fire(new r.A("rotate",t)),this._pitching&&this.fire(new r.A("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new r.A("zoomend",t)),_&&this.fire(new r.A("rotateend",t)),y&&this.fire(new r.A("pitchend",t)),this.fire(new r.A("moveend",t))}flyTo(t,s){if(this._prefersReducedMotion(t)){const st=r.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(st,s)}this.stop(),t=r.h({offset:[0,0],speed:1.2,curve:1.42,easing:r.ey},t);const h=this.transform,_=this.getZoom(),y=this.getBearing(),b=this.getPitch(),C=this.getPadding(),I="zoom"in t?r.ay(+t.zoom,h.minZoom,h.maxZoom):_,O="bearing"in t?this._normalizeBearing(t.bearing,y):y,k="pitch"in t?+t.pitch:b,U=this._extendPadding(t.padding),V=h.zoomScale(I-_),H=r.P.convert(t.offset);let Q=h.centerPoint.add(H);const X=h.pointLocation(Q),J=r.cd.convert(t.center||X);this._normalizeCenter(J);const ne=h.project(X),oe=h.project(J).sub(ne);let ve=t.curve;const Se=Math.max(h.width,h.height),Le=Se/V,Ie=oe.mag();if("minZoom"in t){const st=r.ay(Math.min(t.minZoom,_,I),h.minZoom,h.maxZoom),Ct=Se/h.zoomScale(st-_);ve=Math.sqrt(Ct/Ie*2)}const Ce=ve*ve;function Ae(st){const Ct=(Le*Le-Se*Se+(st?-1:1)*Ce*Ce*Ie*Ie)/(2*(st?Le:Se)*Ce*Ie);return Math.log(Math.sqrt(Ct*Ct+1)-Ct)}function Pe(st){return(Math.exp(st)-Math.exp(-st))/2}function Ne(st){return(Math.exp(st)+Math.exp(-st))/2}const Ke=Ae(0);let Je=function(st){return Ne(Ke)/Ne(Ke+ve*st)},mt=function(st){return Se*((Ne(Ke)*(Pe(Ct=Ke+ve*st)/Ne(Ct))-Pe(Ke))/Ce)/Ie;var Ct},xt=(Ae(1)-Ke)/ve;if(Math.abs(Ie)<1e-6||!isFinite(xt)){if(Math.abs(Se-Le)<1e-6)return this.easeTo(t,s);const st=Le<Se?-1:1;xt=Math.abs(Math.log(Le/Se))/ve,mt=function(){return 0},Je=function(Ct){return Math.exp(st*ve*Ct)}}t.duration="duration"in t?+t.duration:1e3*xt/("screenSpeed"in t?+t.screenSpeed/ve:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Pt=y!==O,Ze=k!==b,lt=!h.isPaddingEqual(U),Ge=t.retainPadding===!1?h.clone():h,bt=st=>Ct=>{const Wt=Ct*xt,wt=1/Je(Wt);st.zoom=Ct===1?I:_+st.scaleZoom(wt),Pt&&(st.bearing=r.ai(y,O,Ct)),Ze&&(st.pitch=r.ai(b,k,Ct)),lt&&(Ge.interpolatePadding(C,U,Ct),Q=Ge.centerPoint.add(H));const Vt=Ct===1?J:st.unproject(ne.add(oe.mult(mt(Wt))).mult(wt));return st.setLocationAtPoint(st.renderWorldCopies?Vt.wrap():Vt,Q),st._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),st};if(t.preloadOnly){const st=this._emulate(bt,t.duration,h);return this._preloadTiles(st),this}return this._zooming=!0,this._rotating=Pt,this._pitching=Ze,this._padding=lt,this._prepareEase(s,!1),this._ease(bt(h),()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,s,h){h.animate===!1||h.duration===0?(t(1),s()):(this._easeStart=r.q.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=r.bX(t,-180,180);const h=Math.abs(t-s);return Math.abs(t-360-s)<h&&(t-=360),Math.abs(t+360-s)<h&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const h=t.lng-s.center.lng;t.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,s,h){const _=Math.ceil(15*s/1e3),y=[],b=t(h.clone());for(let C=0;C<=_;C++){const I=b(C/_);y.push(I.clone())}return y}_preloadTiles(t,s){}}class kd{constructor(t={}){this.options=t,r.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact,h=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=me("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",h);const _=me("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",h),this._innerContainer=me("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const h=s.reduce((_,y,b)=>(y.value&&(_+=`${y.key}=${y.value}${b<s.length-1?"&":""}`),_),"?");t.href=`${r.e.FEEDBACK_URL}/${h}#${Dd(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const s=this._map.style._mergedSourceCaches;for(const _ in s){const y=s[_];if(y.used){const b=y.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t.sort((_,y)=>_.length-y.length),t=t.filter((_,y)=>{for(let b=y+1;b<t.length;b++)if(t[b].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Nd{constructor(){r.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=me("div","mapboxgl-ctrl");const s=me("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const h=t[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Uu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const _ of h)if(_.id===t)return void(_.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class ec{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=r.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,h){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+h}}const tl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Xr extends r.A{constructor(t,s,h,_){const{point:y,lngLat:b,originalEvent:C,target:I}=t;super(t.type,{point:y,lngLat:b,originalEvent:C,target:I}),this.preventDefault=()=>{t.preventDefault()},this.id=s,this.interaction=h,this.feature=_}}class tc{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,s){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const h=s.filter;let _=s.type;h&&this.filters.set(t,r.b3(h)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");const y=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,s)):y.size===0&&this.map.on(_,this.handleType),y.size===0&&this.interactionsByType.set(_,y),y.set(t,s),this.typeById.set(t,_)}get(t){const s=this.typeById.get(t);if(!s)return;const h=this.interactionsByType.get(s);return h?h.get(t):void 0}remove(t){const s=this.typeById.get(t);if(!s)return;this.typeById.delete(t),this.filters.delete(t);const h=this.interactionsByType.get(s);h&&(h.delete(t),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):h.size===0&&this.map.off(s,this.handleType))}queryTargets(t,s){const h=[];for(const[_,y]of s)y.target&&h.push({targetId:_,target:y.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(t,h,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());s.length&&(t.type="mouseenter",this.handleType(t,s));const h=new Map;for(const[_,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||h.set(y.id,y);h.size&&(t.type="mouseleave",this.handleType(t,Array.from(h.values())))}handleOut(t){const s=Array.from(this.hoveredFeatures.values()).map(({feature:h})=>h);s.length&&(t.type="mouseleave",this.handleType(t,s)),this.hoveredFeatures.clear()}handleType(t,s){const h=t.type==="mouseenter";if(h&&!this.interactionsByType.has(t.type))return void r.w("mouseenter interaction required for mouseleave to work.");const _=Array.from(this.interactionsByType.get(t.type)).reverse(),y=!!s;s=s||this.queryTargets(t.point,_);let b=!1;const C=new Set;for(const I of s){for(const[O,k]of _){if(!k.target)continue;const U=I.variants?I.variants[O]:null;if(U){for(const V of U){if(Ol(V,I,C,O))continue;const H=new r.de(I,V),Q=Fo(V,I,O);y&&(H.state=this.map.getFeatureState(H));const X=h?this.prevHoveredFeatures.get(Q):null,J=new Xr(t,O,k,H),ne=X?X.stop:k.handler(J);if(h&&this.hoveredFeatures.set(Q,{feature:I,stop:ne}),ne!==!1){b=!0;break}}if(b)break}}if(b)break}if(!b)for(const[I,O]of _){const{handler:k,target:U}=O;if(!U&&k(new Xr(t,I,O,null))!==!1)break}}}function kh(u,t){if(Array.isArray(u)&&Array.isArray(t)){const s=new Set(u),h=new Set(t);return s.size===h.size&&u.every(_=>h.has(_))}return r.bv(u,t)}const il={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Wp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Gf{constructor(t,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Ql({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new Jl({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),De()}move(t,s){const h=this.map,_=this.mouseRotate.mousemoveWindow(t,s),y=_&&_.bearingDelta;if(y&&h.setBearing(h.getBearing()+y),this.mousePitch){const b=this.mousePitch.mousemoveWindow(t,s),C=b&&b.pitchDelta;C&&h.setPitch(h.getPitch()+C)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){we(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(r.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),gt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,gt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Xe(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Xe(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ic(u,t,s){if(u=new r.cd(u.lng,u.lat),t){const h=new r.cd(u.lng-360,u.lat),_=new r.cd(u.lng+360,u.lat),y=360*Math.ceil(Math.abs(u.lng-s.center.lng)/360),b=s.locationPoint3D(u).distSqr(t),C=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint3D(h).distSqr(t)<b&&(C||Math.abs(h.lng-s.center.lng)<y)?u=h:s.locationPoint3D(_).distSqr(t)<b&&(C||Math.abs(_.lng-s.center.lng)<y)&&(u=_)}for(;Math.abs(u.lng-s.center.lng)>180;){const h=s.locationPoint3D(u);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;u.lng>s.center.lng?u.lng-=360:u.lng+=360}return u}const vs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},nc={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Fd extends r.E{constructor(t,s){super(),(t instanceof HTMLElement||s)&&(t=r.h({element:t},s)),r.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:h="center",color:_="#3FB1CE",scale:y=1,draggable:b=!1,clickTolerance:C=0,rotation:I=nc.rotation,rotationAlignment:O=nc.rotationAlignment,pitchAlignment:k=nc.pitchAlignment,occludedOpacity:U=nc.occludedOpacity,altitude:V=nc.altitude}=t||{};this._anchor=h,this._color=_,this._scale=y,this._draggable=b,this._clickTolerance=C,this._rotation=I,this._rotationAlignment=O,this._pitchAlignment=k,this._occludedOpacity=U,this._altitude=V,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",X=>{X.preventDefault()}),this._element.addEventListener("mousedown",X=>{X.preventDefault()});const H=this._element.classList;for(const X in vs)H.remove(`mapboxgl-marker-anchor-${X}`);H.add(`mapboxgl-marker-anchor-${this._anchor}`);const Q=t&&t.className?t.className.trim().split(/\s+/):[];H.add(...Q),this._popup=null}_createDefaultMarker(){const t=me("div"),s=ge("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const h=ge("radialGradient",{id:"shadowGradient"},ge("defs",{},s));ge("stop",{offset:"10%","stop-opacity":.4},h),ge("stop",{offset:"100%","stop-opacity":.05},h),ge("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},s)}return ge("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},s),ge("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},s),ge("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},s),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||nc.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,h=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,s=this._pos;if(!t||!s)return!1;const h=t.unproject(s,this._altitude),_=t.getFreeCameraOptions();if(!_.position)return!1;const y=_.position.toLngLat();return y.distanceTo(h)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const h=t.unproject(s,this._altitude);let _;t._showingGlobe()&&r.eK(t.transform,this._lngLat)?_=0:(_=1-t._queryFogOpacity(h),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${vs[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const t=this._pos,s=this._map,h=this.getPitchAlignment();if(!s||!t||h!=="map")return"";if(!s._showingGlobe()){const I=s.getPitch();return I?`rotateX(${I}deg)`:""}const _=r.cJ(r.eL(s.transform,this._lngLat)),y=t.sub(r.eM(s.transform)),b=Math.abs(y.x)+Math.abs(y.y);if(b===0)return"";const C=_/b;return`rotateX(${-y.y*C}deg) rotateY(${y.x*C}deg)`}_calculateZTransform(){const t=this._pos,s=this._map;if(!s||!t)return"";let h=0;const _=this.getRotationAlignment();if(_==="map")if(s._showingGlobe()){const y=s.project(new r.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),b=s.project(new r.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);h=r.cJ(Math.atan2(b.y,b.x))-90}else h=-s.getBearing();else if(_==="horizon"){const y=r.af(4,6,s.getZoom()),b=r.eM(s.transform);b.y+=y*s.transform.height;const C=t.sub(b),I=r.cJ(Math.atan2(C.y,C.x));h=(I>90?I-270:I+90)*(1-y)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=ic(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const s=this._map;if(!s)return;const h=this._pointerdownPos,_=this._positionDelta;if(h&&_){if(!this._isDragging){const y=this._clickTolerance||s._clickTolerance;if(t.point.dist(h)<y)return;this._isDragging=!0}this._pos=t.point.sub(_),this._lngLat=s.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.A("dragstart"))),this.fire(new r.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.A("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map,h=this._pos;s&&h&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(h),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||nc.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||nc.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||nc.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||nc.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Hf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Dc={maxWidth:100,unit:"metric"},Lo={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},rc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},nl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $a(u=new r.P(0,0),t="bottom"){if(typeof u=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(t){case"top":return new r.P(0,u);case"top-left":return new r.P(s,s);case"top-right":return new r.P(-s,s);case"bottom":return new r.P(0,-u);case"bottom-left":return new r.P(s,-s);case"bottom-right":return new r.P(-s,-s);case"left":return new r.P(u,0);case"right":return new r.P(-u,0)}return new r.P(0,0)}return u instanceof r.P||Array.isArray(u)?r.P.convert(u):r.P.convert(u[t]||[0,0])}return{version:F,supported:_e.supported,setRTLTextPlugin:r.eQ,getRTLTextPluginStatus:r.eP,Map:class extends su{constructor(u){$.mark(B.create);const t=u;if((u=r.h({},il,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&r.eI(window)&&(u.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new _p(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies,null,null),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new Uu,this._domRenderTaskQueue=new Uu,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.a$(),this._locale=r.h({},tl,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=u.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ec(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=u.scaleFactor,this._requestManager=new ct(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?Object.assign({},u.contextCreateOptions):{},typeof u.container=="string"){const s=document.getElementById(u.container);if(!s)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=s}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._spriteFormat=u.spriteFormat,r.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Df),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Vf(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||r.e.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this.indoor=new xp(this),u.hash&&(this._hash=new Of(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const s=u.bounds;s&&(this.resize(),this.fitBounds(s,r.h({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new kd({customAttribution:u.customAttribution})),this._logoControl=new Nd,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new r.A(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new r.A(`${s.dataType}dataloading`,s))}),this._interactions=new tc(this)}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new r.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=u.onAdd(this);this._controls.push(u);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new r.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.A("movestart",u)).fire(new r.A("move",u)),this.fire(new r.A("resize",u)),t&&this.fire(new r.A("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(r.aG.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new r.A("zoomstart")).fire(new r.A("zoom")).fire(new r.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new r.A("zoomstart")).fire(new r.A("zoom")).fire(new r.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new r.A("pitchstart")).fire(new r.A("pitch")).fire(new r.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new r.A("pitchstart")).fire(new r.A("pitch")).fire(new r.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(u){return this._scaleFactor=u,this.painter.scaleFactor=u,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(t=>t==="auto"?navigator.language:t):u}setLanguage(u){const t=this._parseLanguage(u);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,t=u.projection.name;let s;t==="globe"&&u.zoom>=r.cx?(u.setMercatorFromTransition(),s=!0):t==="mercator"&&u.zoom<r.cx&&(u.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(u,t){return this._updateProjection(u||t||{name:"mercator"})}_updateProjection(u){let t;return t=u.name==="globe"&&this.transform.zoom>=r.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u,t){return this.transform.locationPoint3D(r.cd.convert(u),t)}unproject(u,t){return this.transform.pointLocation3D(r.P.convert(u),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,t,s){const h=_=>{let y=[];if(Array.isArray(t)){const b=t.filter(C=>this.getLayer(C));y=b.length?this.queryRenderedFeatures(_,{layers:b}):[]}else y=this.queryRenderedFeatures(_,{target:t});return y};if(u==="mouseenter"||u==="mouseover"){let _=!1;return{listener:s,targets:t,delegates:{mousemove:b=>{const C=h(b.point);C.length?_||(_=!0,s.call(this,new Es(u,this,b.originalEvent,{features:C}))):_=!1},mouseout:()=>{_=!1}}}}if(u==="mouseleave"||u==="mouseout"){let _=!1;return{listener:s,targets:t,delegates:{mousemove:C=>{h(C.point).length?_=!0:_&&(_=!1,s.call(this,new Es(u,this,C.originalEvent)))},mouseout:C=>{_&&(_=!1,s.call(this,new Es(u,this,C.originalEvent)))}}}}{const _=y=>{const b=h(y.point);b.length&&(y.features=b,s.call(this,y),delete y.features)};return{listener:s,targets:t,delegates:{[u]:_}}}}on(u,t,s){if(typeof t=="function"||s===void 0)return super.on(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(u,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(h);for(const _ in h.delegates)this.on(_,h.delegates[_]);return this}once(u,t,s){if(typeof t=="function"||s===void 0)return super.once(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(u,t,s);for(const _ in h.delegates)this.once(_,h.delegates[_]);return this}off(u,t,s){if(typeof t=="function"||s===void 0)return super.off(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._delegatedListeners?this._delegatedListeners[u]:void 0;return h&&(_=>{for(let y=0;y<_.length;y++){const b=_[y];if(b.listener===s&&kh(b.targets,t)){for(const C in b.delegates)this.off(C,b.delegates[C]);return _.splice(y,1),this}}})(h),this}queryRenderedFeatures(u,t){if(!this.style)return[];if(u===void 0||u instanceof r.P||Array.isArray(u)||t!==void 0||(t=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],!t){const y=this.style.queryRenderedFeatures(u,void 0,this.transform),b=this.style.queryRenderedFeatureset(u,void 0,this.transform);return y.concat(b)}let s=!0;if(t.target&&(s=this._isTargetValid(t.target),s&&!t.layers))return this.style.queryRenderedFeatureset(u,t,this.transform);let h=!0;if(t.layers&&Array.isArray(t.layers)){for(const y of t.layers)if(!this._isValidId(y)){h=!1;break}if(h&&!t.target)return this.style.queryRenderedFeatures(u,t,this.transform)}let _=[];return h&&(_=_.concat(this.style.queryRenderedFeatures(u,t,this.transform))),s&&(_=_.concat(this.style.queryRenderedFeatureset(u,t,this.transform))),_}querySourceFeatures(u,t){return!u||typeof u=="string"&&!this._isValidId(u)?[]:this.style.querySourceFeatures(u,t)}isPointOnSurface(u){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(u))}addInteraction(u,t){return this._interactions.add(u,t),this}removeInteraction(u){return this._interactions.remove(u),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(u){return this._cooperativeGestures=u,this}setStyle(u,t){return t=r.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&u&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(u,(s,h)=>{if(s){const _=typeof s=="string"?s:s instanceof Error?s.message:s.error;r.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(u,t)}else h&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){const s=r.h({},t);t&&t.config&&(s.initialConfig=t.config,delete s.config),this.style=new ca(this,s).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new r.z(new Error("IDs can't be empty."))),!1):!r.d8(u)||(this.fire(new r.z(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}_isTargetValid(u){return"featuresetId"in u?this._isValidId("importId"in u?u.importId:u.featuresetId):"layerId"in u&&this._isValidId(u.layerId)}_areTargetsValid(u){if(Array.isArray(u)){for(const t of u)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(u)}addSource(u,t){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,s)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,t,{pixelRatio:s=1,sdf:h=!1,stretchX:_,stretchY:y,content:b}={}){this._lazyInitEmptyStyle();const C=r.I.from(u);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:I,height:O,data:k}=r.q.getImageData(t);this.style.addImage(C,{data:new r.r({width:I,height:O},k),pixelRatio:s,stretchX:_,stretchY:y,content:b,sdf:h,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:O}=t,k=t;this.style.addImage(C,{data:new r.r({width:I,height:O},new Uint8Array(k.data)),pixelRatio:s,stretchX:_,stretchY:y,content:b,sdf:h,usvg:!1,version:0,userImage:k}),k.onAdd&&k.onAdd(this,u)}}updateImage(u,t){this._lazyInitEmptyStyle();const s=r.I.from(u),h=this.style.getImage(s);if(!h)return void this.fire(new r.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.q.getImageData(t):t,{width:y,height:b,data:C}=_;if(y===void 0||b===void 0)return void this.fire(new r.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(h.usvg?h.icon.usvg_tree.width:h.data.width)||b!==(h.usvg?h.icon.usvg_tree.height:h.data.height))return void this.fire(new r.z(new Error(`The width and height of the updated image (${y}, ${b})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));const I=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let O=!1;h.usvg?(h.data=new r.r({width:y,height:b},new Uint8Array(C)),h.usvg=!1,h.icon=void 0,O=!0):h.data.replace(C,I),this.style.updateImage(s,h,O)}hasImage(u){return u?!!this.style&&!!this.style.getImage(r.I.from(u)):(this.fire(new r.z(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(r.I.from(u))}loadImage(u,t){r.o(this._requestManager.transformRequest(u,r.R.Image),(s,h)=>{t(s,h instanceof HTMLImageElement?r.q.getImageData(h):h)})}listImages(){return this.style.listImages().map(u=>u.name)}addModel(u,t){this._lazyInitEmptyStyle(),this.style.addModel(u,t)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new r.z(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,t){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)):this}getSlot(u){const t=this.getLayer(u);return t&&t.slot||null}setSlot(u,t){return this.style.setSlot(u,t),this.style.mergeLayers(),this._update(!0)}addImport(u,t){return this.style.addImport(u,t).catch(s=>this.fire(new r.z(new Error("Failed to add import",s)))),this}updateImport(u,t){return typeof t!="string"&&t.id!==u?(this.removeImport(u),this.addImport(t)):(this.style.updateImport(u,t),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,t){return this.style.moveImport(u,t),this._update(!0)}moveLayer(u,t){return this._isValidId(u)?(this.style.moveLayer(u,t),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;const t=this.style.getOwnLayer(u);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,t,s){return this._isValidId(u)?(this.style.setLayerZoomRange(u,t,s),this._update(!0)):this}setFilter(u,t,s={}){return this._isValidId(u)?(this.style.setFilter(u,t,s),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,t,s,h={}){return this._isValidId(u)?(this.style.setPaintProperty(u,t,s,h),this._update(!0)):this}getPaintProperty(u,t){return this._isValidId(u)?this.style.getPaintProperty(u,t):null}setLayoutProperty(u,t,s,h={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,t,s,h),this._update(!0)):this}getLayoutProperty(u,t){return this._isValidId(u)?this.style.getLayoutProperty(u,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(u){return this.style.setGlyphsUrl(u),this._update(!0)}getSchema(u){return this.style.getSchema(u)}setSchema(u,t){return this.style.setSchema(u,t),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,t){return this.style.setConfig(u,t),this._update(!0)}getConfigProperty(u,t){return this.style.getConfigProperty(u,t)}setConfigProperty(u,t,s){return this.style.setConfigProperty(u,t,s),this._update(!0)}getFeaturesetDescriptors(u){return this.style.getFeaturesetDescriptors(u)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const t=u[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(u){return this._lazyInitEmptyStyle(),this.style.setSnow(u),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(u){return this._lazyInitEmptyStyle(),this.style.setRain(u),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setImportColorTheme(u,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(u,t),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.cd.convert(u),this.transform):0}setFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.setFeatureState(u,t),this._update())}removeFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.removeFeatureState(u,t),this._update())}getFeatureState(u){return u.source&&!this._isValidId(u.source)?null:this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,h,_,y=this._container;for(;y&&(!h||!_);){const b=window.getComputedStyle(y).transform;b&&b!=="none"&&(s=b.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(_=s[3])),y=y.parentElement}this._containerWidth=h?Math.abs(u/h):u,this._containerHeight=_?Math.abs(t/_):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=me("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=me("div","mapboxgl-canvas-container",u);this._canvas=me("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=me("div","mapboxgl-control-container",u),h=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{h[_]=me("div",`mapboxgl-ctrl-${_}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const s=r.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(u),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const t=this._popups.indexOf(u);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const u=r.h({},_e.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",u);t?(Rn(t,!0),this.painter=new ku(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.l.testSupport(t)):this.fire(new r.z(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.A("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.A("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;this.fire(new r.A("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,h=r.q.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=_.createQuery(),_.beginQuery(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,k=this.transform.pitch,U=r.q.now(),V=new r.aa(O,{now:U,fadeDuration:y,pitch:k,transition:this.style.transition,worldview:this._worldview});this.style.update(V)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(h),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(h);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,$.mark(B.load),this.fire(new r.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const O=r.q.now()-h;_.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const k=_.getQueryParameter(t,_.QUERY_RESULT)/1e6;_.deleteQuery(t),this.fire(new r.A("gpu-timing-frame",{cpuTime:O,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){const O=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(O);this.fire(new r.A("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const O=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(O);this.fire(new r.A("gpu-timing-deferred-render",{gpuTime:k}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(I||this._repaint)this.triggerRepaint();else{const O=this.idle();if(O&&(b=this._updateAverageElevation(h,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new r.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new r.A("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,$.mark(B.fullLoad),this._performanceMetricsCollection&&Oi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const t of this._markers)u&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!u||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(u,t=!1){const s=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const _=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=u;const b=Math.abs(_-y);if(b>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(y),s(y);this._averageElevation.easeTo(y,u,300)}else if(b>1e-4)return this._averageElevation.jumpTo(y),s(y)}return!!this._averageElevation.isEasing(u)&&s(this._averageElevation.getValue(u))}_authenticate(){hn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===Lt||u.status===401)){const t=this.painter.context.gl;Rn(t,!1),this._logoControl instanceof Nd&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Mi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Rt(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function _(y){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,y,0);const b=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,b),b}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(_(u),t.canvasCopies.map(_),t.timeStamps)}_canvasPixelComparison(u,t,s){let h=s[1]-s[0];const _=u.length/4;for(let y=0;y<t.length;y++){const b=t[y];let C=0;for(let I=0;I<b.length;I+=4)b[I]===u[I]&&b[I+1]===u[I+1]&&b[I+2]===u[I+2]&&b[I+3]===u[I+3]&&(C+=1);h+=(s[y+2]-s[y+1])*(1-C/_)}return h}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),In.delete(this.painter.context.gl),ei.remove(),li.remove(),this._removed=!0,this.fire(new r.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=r.q.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_preloadTiles(u){const t=this.style?this.style.getSourceCaches():[];return r.bt(t,(s,h)=>s._preloadTiles(u,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this._tp.refreshUI(),u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,this._tp.refreshUI(),u&&this._update())}_setCacheLimits(u,t){r.eJ(u,t)}get version(){return F}},NavigationControl:class{constructor(u={}){this.options=r.h({},Wp,u),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(r.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),me("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),me("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))}),this._compassIcon=me("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const t=u.getZoom(),s=t===u.getMaxZoom(),h=t===u.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Gf(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,t){const s=me("button",u,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(u,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",s),u.firstElementChild&&u.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends r.E{constructor(u={}){super();const t=navigator.geolocation;this.options=r.h({geolocation:t},Hf,u),r.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Tl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const t=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,u(s)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>t(s.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),s=u.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new r.A("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.A("geolocate",u)),this._finish()}}_updateCamera(u){const t=new r.cd(u.coords.longitude,u.coords.latitude),s=u.coords.accuracy,h=this._map.getBearing(),_=r.h({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),_,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new r.cd(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,t=r.c6(1,u._center.lat)*u.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.A("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=me("button","mapboxgl-ctrl-geolocate",this._container),me("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=me("div","mapboxgl-user-location"),this._dotElement.appendChild(me("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(me("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Fd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=me("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.A("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:kd,ScaleControl:class{constructor(u={}){this.options=r.h({},Dc,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,h=t._containerWidth/2-u/2,_=t.unproject([h,s]),y=t.unproject([h+u,s]),b=_.distanceTo(y);if(this.options.unit==="imperial"){const C=3.2808*b;C>5280?this._setScale(u,C/5280,"mile"):this._setScale(u,C,"foot")}else this.options.unit==="nautical"?this._setScale(u,b/1852,"nautical-mile"):b>=1e3?this._setScale(u,b/1e3,"kilometer"):this._setScale(u,b,"meter")}_setScale(u,t,s){this._map._requestDomTask(()=>{const h=function(y){const b=Math.pow(10,`${Math.floor(y)}`.length-1);let C=y/b;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(I){const O=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*O)/O}(C),b*C}(t),_=h/t;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(h):`${h}&nbsp;${Lo[s]}`,this._container.style.width=u*_+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:r.w("Full screen control 'container' must be a DOM element.")),r.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=me("button","mapboxgl-ctrl-fullscreen",this._controlContainer);me("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(u){super(),this.options=r.h(Object.create(rc),u),this._altitude=this.options.altitude,r.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new r.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new r.A("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=r.cd.convert(u),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(u){return this._altitude=u,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),s=document.createElement("body");let h;for(s.innerHTML=u;h=s.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=me("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(u),this.options.closeButton){const s=this._closeButton=me("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._updateClassList(),t}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,h=this._pos;if(!t||!s||!h)return"bottom";const _=s.offsetWidth,y=s.offsetHeight,b=h.x<_/2,C=h.x>t.transform.width-_/2;if(h.y+u<y)return b?"top-left":C?"top-right":"top";if(h.y>t.transform.height-y){if(b)return"bottom-left";if(C)return"bottom-right"}return b?"left":C?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),u.className=t.join(" ")}_update(u){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=me("div","mapboxgl-popup",t.getContainer()),this._tip=me("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ic(this._lngLat,this._pos,t.transform)),!this._trackPointer||u){const _=this._pos=this._trackPointer&&u instanceof r.P?u:t.project(this._lngLat,this._altitude),y=$a(this.options.offset),b=this._anchor=this._getAnchor(y.y),C=$a(this.options.offset,b),I=_.add(C).round();t._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${vs[b]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&t._showingGlobe()){const _=r.eK(t.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(nl);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:Fd,Style:ca,LngLat:r.cd,LngLatBounds:r.aG,Point:r.P,MercatorCoordinate:r.ac,FreeCameraOptions:ff,Evented:r.E,config:r.e,prewarm:r.eO,clearPrewarmedResources:r.eN,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(u){r.e.ACCESS_TOKEN=u},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(u){r.e.API_URL=u},get workerCount(){return r.eX.workerCount},set workerCount(u){r.eX.workerCount=u},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){r.e.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){r.eW(u)},get workerUrl(){return r.eV.workerUrl},set workerUrl(u){r.eV.workerUrl=u},get workerClass(){return r.eV.workerClass},set workerClass(u){r.eV.workerClass=u},get workerParams(){return r.eV.workerParams},set workerParams(u){r.eV.workerParams=u},get dracoUrl(){return r.eU()},set dracoUrl(u){r.eT(u)},get meshoptUrl(){return r.eS()},set meshoptUrl(u){r.eR(u)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var N=A;return N})}(Uv)),Uv.exports}var kz=zz();const eh=Nb(kz),IA=({initialCoords:f={lng:77.5946,lat:12.9716},onAddressSelect:g,showControls:w=!0})=>{eh.accessToken=kE;const S=Re.useRef(null),[A,L]=Re.useState(null),[N,r]=Re.useState(null),[F,B]=Re.useState(f),[$,ie]=Re.useState(""),[re,Te]=Re.useState([]);Re.useEffect(()=>{if(!S.current)return;const pe=new eh.Map({container:S.current,style:"mapbox://styles/mapbox/streets-v11",center:[F.lng,F.lat],zoom:12}),fe=new eh.Marker({draggable:!0}).setLngLat([F.lng,F.lat]).addTo(pe);return fe.on("dragend",()=>{const{lng:se,lat:De}=fe.getLngLat();_e(se,De)}),L(pe),r(fe),_e(F.lng,F.lat),()=>pe.remove()},[S.current]);const _e=async(pe,fe)=>{B({lng:pe,lat:fe});try{const De=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${pe},${fe}.json?access_token=${eh.accessToken}`)).json(),we=De.features?.[0]?.place_name||"",ht={};De.features.forEach(At=>{At.place_type.includes("region")&&(ht.state=At.text),At.place_type.includes("country")&&(ht.country=At.text)}),g?.(pe,fe,we,ht)}catch(se){console.error("Reverse geocoding error",se)}},me=()=>{navigator.geolocation.getCurrentPosition(({coords:{latitude:pe,longitude:fe}})=>{A&&A.flyTo({center:[fe,pe],zoom:14}),N&&N.setLngLat([fe,pe]),_e(fe,pe)},()=>alert("Location permission denied."))};Re.useEffect(()=>{const pe=setTimeout(async()=>{if(!$)return Te([]);const se=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent($)}.json?access_token=${eh.accessToken}&autocomplete=true&limit=5`)).json();Te(se.features||[])},300);return()=>clearTimeout(pe)},[$]);const ge=pe=>{const[fe,se]=pe.geometry.coordinates;A&&A.flyTo({center:[fe,se],zoom:14}),N&&N.setLngLat([fe,se]),_e(fe,se),ie(pe.place_name),Te([])};return W.jsxs("div",{className:"space-y-4",children:[w&&W.jsxs(W.Fragment,{children:[W.jsxs("div",{className:"relative",children:[W.jsx("input",{value:$,onChange:pe=>ie(pe.target.value),className:"w-full border px-4 py-2 rounded-lg",placeholder:"Search address..."}),re.length>0&&W.jsx("ul",{className:"absolute z-50 w-full bg-white border rounded mt-1 shadow max-h-60 overflow-y-auto",children:re.map((pe,fe)=>W.jsx("li",{className:"px-4 py-2 text-sm hover:bg-gray-100 cursor-pointer",onClick:()=>ge(pe),children:pe.place_name},fe))})]}),W.jsx("button",{onClick:me,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"📍 Use Current Location"})]}),W.jsx("div",{ref:S,className:"w-full h-80 border rounded-lg shadow"})]})},Vx=[{title:"Restaurant information",description:"Name, location and contact number"},{title:"Menu and cuisine types",description:"Select cuisine types and upload menu"},{title:"Restaurant documents",description:"Upload FSSAI, GST documents"}],xm=({name:f,placeholder:g,value:w,onChange:S,required:A=!0})=>W.jsx("input",{name:f,placeholder:g,value:w,onChange:S,required:A,className:"w-full border rounded-md p-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-400 text-sm"}),Nz=()=>{const[f,g]=Re.useState({lng:77.5946,lat:12.9716}),[w,S]=Re.useState(0),[A,L]=Re.useState(null),[N,r]=Re.useState(""),[F,B]=Re.useState({name:"",email:"",phone:"",cuisine_types:"",menu_images:[],theme_images:[],logo_images:[],documents:{fssai:null,gst:null}}),[$,ie]=Re.useState({label:"",addressLine:"",city:"",pincode:"",state:"",country:""}),re=fe=>{const{name:se,value:De}=fe.target;if(se.includes(".")){const[we,ht]=se.split(".");B(At=>({...At,[we]:{...At[we],[ht]:De}}))}else B(we=>({...we,[se]:De}))},Te=(fe,se)=>{const De=fe.target.files;B(se==="menu_images"||se==="theme_images"||se==="logo_images"?we=>({...we,[se]:Array.from(De)}):we=>({...we,documents:{...we.documents,[se]:De[0]}}))},_e=()=>{const{name:fe,email:se,phone:De,cuisine_types:we,documents:ht}=F;return w===0?fe&&se&&De&&N:w===1?we&&F.menu_images.length>0:w===2?ht.fssai&&ht.gst:!0},me=async()=>{if(!_e())return alert("Please fill all required fields.");const fe={...$,addressLine:N,location:{type:"Point",coordinates:[f.lng,f.lat]}},se=localStorage.getItem("token"),De=new FormData;Object.entries(F).forEach(([we,ht])=>{Array.isArray(ht)?ht.forEach(At=>De.append(we,At)):typeof ht=="object"&&we==="documents"?(ht.fssai&&De.append("fssai",ht.fssai),ht.gst&&De.append("gst",ht.gst)):De.append(we,ht)}),De.append("address",JSON.stringify(fe));try{const we=await fetch("/api/restaurant",{method:"POST",headers:{Authorization:`Bearer ${se}`},body:De}),ht=await we.json();if(!we.ok)return alert(ht.message||"Something went wrong");L({status:"pending"})}catch(we){alert("Failed to submit: "+we.message)}},ge=()=>{if(!_e())return alert("Please fill all required fields.");S(fe=>fe+1)},pe=()=>S(fe=>Math.max(fe-1,0));return Re.useEffect(()=>{(async()=>{const se=localStorage.getItem("token");if(se)try{const De=await fetch("/api/restaurant/dashboard",{headers:{Authorization:`Bearer ${se}`}}),we=await De.json();De.ok&&we.status&&L(we)}catch(De){console.error("Failed to fetch status:",De)}})()},[]),console.log(A),A?.status==="pending"?W.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:W.jsxs("div",{className:"bg-white shadow-lg rounded-xl p-8 text-center max-w-md w-full",children:[W.jsx("h2",{className:"text-2xl font-bold text-green-700 mb-3",children:"🎉 Registration Complete!"}),W.jsxs("p",{className:"text-lg text-gray-700",children:["Your restaurant has been registered successfully.",W.jsx("br",{}),"Current status:"," ",W.jsx("span",{className:"font-semibold text-green-800",children:A.status.toUpperCase()})]}),W.jsx("p",{className:"mt-3 text-sm text-gray-500",children:"Please wait for admin approval to go live."})]})}):A?.status==="active"?W.jsx("div",{className:"min-h-[90vh] bg-gray-50 p-6",children:W.jsx("div",{className:"max-w-7xl mx-auto",children:W.jsx(Oz,{restaurantId:A?.id,userId:A?.userID})})}):W.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:W.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col lg:flex-row gap-6",children:[W.jsx("aside",{className:"w-full lg:w-1/3",children:W.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-6 space-y-6",children:[W.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Complete your registration"}),Vx.map((fe,se)=>W.jsxs("div",{className:`flex items-start gap-3 ${se===w?"text-red-600":"text-gray-500"}`,children:[W.jsx("div",{className:`rounded-full border w-8 h-8 flex items-center justify-center text-sm font-semibold ${se===w?"bg-red-100 border-red-500 text-red-700":"bg-gray-100 border-gray-300"}`,children:se+1}),W.jsxs("div",{children:[W.jsx("div",{className:"font-medium",children:fe.title}),W.jsx("div",{className:"text-sm",children:fe.description})]})]},se))]})}),W.jsx("section",{className:"w-full lg:w-2/3",children:W.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-6 space-y-6",children:[W.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:Vx[w].title}),w===0&&W.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[W.jsx(xm,{name:"name",placeholder:"Restaurant Name",value:F.name,onChange:re}),W.jsx(xm,{name:"email",placeholder:"Email Address",value:F.email,onChange:re}),W.jsx(xm,{name:"phone",placeholder:"Phone Number",value:F.phone,onChange:re}),W.jsx(xm,{name:"label",placeholder:"Custom Address Label",value:$.label,onChange:fe=>ie({...$,label:fe.target.value})}),W.jsx(xm,{name:"city",placeholder:"City",value:$.city,onChange:fe=>ie({...$,city:fe.target.value})}),W.jsx(xm,{name:"pincode",placeholder:"Pincode",value:$.pincode,onChange:fe=>ie({...$,pincode:fe.target.value})}),W.jsxs("div",{className:"md:col-span-2",children:[W.jsx("p",{className:"text-sm text-red-600 bg-red-100 border border-red-300 px-4 py-2 rounded-md mb-2",children:"Note: Please select your exact restaurant location on the map to ensure accurate directions."}),W.jsx(IA,{initialCoords:f,onAddressSelect:(fe,se,De,we)=>{g({lng:fe,lat:se}),r(De),ie(ht=>({...ht,addressLine:De,state:we.state||ht.state,country:we.country||ht.country}))}}),W.jsxs("p",{className:"text-sm text-gray-700 pt-3 pb-3",children:[W.jsx("strong",{children:"📍 Address:"})," ",N||"Not selected"]})]})]}),w===1&&W.jsxs("div",{className:"grid gap-4",children:[W.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Cuisine Type"}),W.jsx(xm,{name:"cuisine_types",placeholder:"Cuisine Types (e.g. Indian, Chinese)",value:F.cuisine_types,onChange:re}),W.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Restaurant Logo"}),W.jsx("input",{placeholder:"dff",type:"file",multiple:!0,onChange:fe=>Te(fe,"logo_images"),required:!0,className:"w-full border rounded-md p-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-400 text-sm"}),W.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Banner Image"}),W.jsx("input",{type:"file",multiple:!0,onChange:fe=>Te(fe,"theme_images"),required:!0,className:"w-full border rounded-md p-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-400 text-sm"}),W.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Menu List Image"}),W.jsx("input",{type:"file",multiple:!0,onChange:fe=>Te(fe,"menu_images"),required:!0,className:"w-full border rounded-md p-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-400 text-sm"})]}),w===2&&W.jsx("div",{className:"grid gap-4",children:Object.keys(F.documents).map(fe=>W.jsxs("div",{children:[W.jsxs("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:[fe.toUpperCase()," Document"]}),W.jsx("input",{type:"file",required:!0,onChange:se=>Te(se,fe),className:"w-full border rounded-md p-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-400 text-sm"})]},fe))}),W.jsxs("div",{className:"flex justify-between pt-6",children:[W.jsx("button",{onClick:pe,disabled:w===0,className:`px-6 py-2 rounded-md ${w===0?"bg-gray-200 text-gray-400":"bg-gray-400 hover:bg-gray-500 text-white"}`,children:"Previous"}),w<Vx.length-1?W.jsx("button",{onClick:ge,className:"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-md",children:"Next"}):W.jsx("button",{onClick:me,className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-md",children:"Submit"})]})]})})]})})};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fz=f=>f.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Bz=f=>f.replace(/^([A-Z])|[\s-_]+(\w)/g,(g,w,S)=>S?S.toUpperCase():w.toLowerCase()),r2=f=>{const g=Bz(f);return g.charAt(0).toUpperCase()+g.slice(1)},RA=(...f)=>f.filter((g,w,S)=>!!g&&g.trim()!==""&&S.indexOf(g)===w).join(" ").trim(),jz=f=>{for(const g in f)if(g.startsWith("aria-")||g==="role"||g==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Vz={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uz=Re.forwardRef(({color:f="currentColor",size:g=24,strokeWidth:w=2,absoluteStrokeWidth:S,className:A="",children:L,iconNode:N,...r},F)=>Re.createElement("svg",{ref:F,...Vz,width:g,height:g,stroke:f,strokeWidth:S?Number(w)*24/Number(g):w,className:RA("lucide",A),...!L&&!jz(r)&&{"aria-hidden":"true"},...r},[...N.map(([B,$])=>Re.createElement(B,$)),...Array.isArray(L)?L:[L]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hf=(f,g)=>{const w=Re.forwardRef(({className:S,...A},L)=>Re.createElement(Uz,{ref:L,iconNode:g,className:RA(`lucide-${Fz(r2(f))}`,`lucide-${f}`,S),...A}));return w.displayName=r2(f),w};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gz=[["path",{d:"M11 13v4",key:"vyy2rb"}],["path",{d:"M15 5v4",key:"1gx88a"}],["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["rect",{x:"7",y:"13",width:"9",height:"4",rx:"1",key:"1iip1u"}],["rect",{x:"7",y:"5",width:"12",height:"4",rx:"1",key:"1anskk"}]],Hz=hf("chart-bar-stacked",Gz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qz=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],$z=hf("flame",qz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zz=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],Wz=hf("house",Zz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xz=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],s2=hf("layout-dashboard",Xz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yz=[["path",{d:"M17.97 9.304A8 8 0 0 0 2 10c0 4.69 4.887 9.562 7.022 11.468",key:"1fahp3"}],["path",{d:"M21.378 16.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1817ys"}],["circle",{cx:"10",cy:"10",r:"3",key:"1ns7v1"}]],Kz=hf("location-edit",Yz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qz=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Jz=hf("log-out",Qz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ek=[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]],tk=hf("menu",ek);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ik=[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],nk=hf("user-cog",ik);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rk=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],sk=hf("x",rk),ak=({isOpen:f,onClose:g})=>{const{user:w,logout:S}=Im(),A=Nc(),L=gu(),N=()=>{S(),L("/",{replace:!0}),g()},r=[{to:"/admin",icon:W.jsx(Wz,{size:20}),label:"Restaurant Management",roles:["admin"]},{to:"/food-category",icon:W.jsx(Hz,{size:20}),label:"Add Category",roles:["admin"]},{to:"/user-management",icon:W.jsx(nk,{size:20}),label:"User Management",roles:["admin"]},{to:"/restaurant-onboard",icon:W.jsx(s2,{size:20}),label:"Dashboard",roles:["restaurant"]},{to:"/user-dashboard",icon:W.jsx(s2,{size:20}),label:"Dashboard",roles:["user"]},{to:"/address-registration",icon:W.jsx(Kz,{size:20}),label:"Register Address",roles:["user"]}],F=W.jsxs("div",{className:"w-64 bg-white border-r border-gray-200 h-full flex flex-col justify-between",children:[W.jsxs("div",{className:"flex justify-between items-center p-4 md:hidden",children:[W.jsx("h1",{className:"text-xl font-bold text-red-500",children:"FOODYAH"}),W.jsx("button",{onClick:g,className:"text-gray-700",children:W.jsx(sk,{size:24})})]}),W.jsx("div",{className:"hidden md:block p-4",children:W.jsx("h1",{className:"text-xl font-bold text-red-500",children:"FOODYAH"})}),W.jsx("nav",{className:"p-4 space-y-2",children:r.filter(B=>B.roles.includes(w?.role)).map(B=>W.jsxs(lc,{to:B.to,className:`flex items-center space-x-3 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-100 ${A.pathname===B.to?"bg-gray-100 text-red-600 font-semibold":"text-gray-700"}`,onClick:g,children:[B.icon,W.jsx("span",{children:B.label})]},B.to))}),W.jsx("div",{className:"px-4 pb-6",children:W.jsxs("button",{onClick:N,className:"flex items-center space-x-2 text-sm px-4 py-2 rounded-md bg-red-100 text-red-600 hover:bg-red-200 w-full justify-center",children:[W.jsx(Jz,{size:18}),W.jsx("span",{children:"Logout"})]})})]});return W.jsxs(W.Fragment,{children:[W.jsx("div",{className:`fixed top-0 left-0 h-full z-50 bg-white transform transition-transform duration-300 md:hidden ${f?"translate-x-0":"-translate-x-full"}`,children:F}),W.jsx("div",{className:"hidden md:flex md:sticky md:top-0 md:h-screen",children:F})]})},ok=({onToggleSidebar:f})=>{const{user:g}=Im(),[w,S]=Re.useState(!1),A=Re.useRef(null);return Re.useEffect(()=>{const L=N=>{A.current&&!A.current.contains(N.target)&&S(!1)};return document.addEventListener("mousedown",L),()=>document.removeEventListener("mousedown",L)},[]),W.jsx(W.Fragment,{children:W.jsxs("header",{className:"sticky top-0 z-30 w-full bg-white border-b border-gray-200 shadow-sm h-16 flex items-center justify-between px-4 sm:px-6",children:[W.jsxs("div",{className:"flex items-center gap-4",children:[W.jsx("button",{className:"md:hidden text-gray-700",onClick:f,children:W.jsx(tk,{size:24})}),W.jsxs("h1",{className:"text-lg sm:text-xl font-bold text-gray-800",children:["FOODYAH"," ",g?.role==="admin"?W.jsx("span",{className:"text-gray-500 font-normal hidden sm:inline",children:"Admin Panel"}):W.jsx("span",{className:"text-gray-500 font-normal hidden sm:inline",children:"restaurant partner"})]})]}),W.jsxs("div",{className:"flex items-center gap-4",children:[W.jsx("a",{href:"tel:+919738383838",className:"text-sm text-blue-600 font-medium hidden sm:inline",children:"Need help? Call +91 97-38-38-38-38"}),W.jsxs("div",{className:"relative",ref:A,children:[W.jsx("img",{src:`https://ui-avatars.com/api/?name=${g?.name||"G"}`,alt:"user",className:"w-10 h-10 rounded-full cursor-pointer",onClick:()=>S(!w)}),w&&W.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white border border-gray-200 rounded-lg shadow-lg p-4 z-50",children:[W.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:g?.name||"Guest"}),g?.email&&W.jsx("p",{className:"text-sm text-gray-600",children:g.email}),g?.phone&&W.jsx("p",{className:"text-sm text-gray-600",children:g.phone}),W.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Status: Online"})]})]})]})]})})},lk=()=>W.jsx(W.Fragment,{children:W.jsxs("header",{className:"sticky top-0 z-30 w-full bg-white border-b border-gray-200 shadow-sm h-16 flex items-center justify-between px-4 sm:px-6",children:[W.jsx("div",{className:"flex items-center gap-4",children:W.jsxs("h1",{className:"text-lg sm:text-xl font-bold text-gray-800",children:[W.jsx(lc,{to:"/",children:"FOODYAH "}),W.jsx("span",{className:"text-gray-500 font-normal hidden sm:inline",children:"explore food"})]})}),W.jsx("div",{className:"flex items-center gap-4",children:W.jsx("a",{href:"tel:+919738383838",className:"text-sm text-blue-600 font-medium hidden sm:inline",children:"Need help? Call +91 97-38-38-38-38"})})]})});function ck(){const[f,g]=Re.useState(""),[w,S]=Re.useState(""),[A,L]=Re.useState(1),[N,r]=Re.useState(""),F=gu(),{login:B}=Im(),$=async()=>{const re=await $b({email:f,role:"admin"});re.newUser?r("Admin account not found."):(r(`OTP sent: ${re.otp}`),L(2))},ie=async()=>{const re=await Zb({email:f,otp:w});re.token&&re.user.role==="admin"?(localStorage.setItem("token",re.token),localStorage.setItem("role",re.user.role),B(re.user),F("/admin",{replace:!0})):r(re.user?.role!=="admin"?"Access denied.":re.msg)};return W.jsx("div",{className:"min-h-screen bg-black/80 flex items-center justify-center px-4",children:W.jsxs("div",{className:"bg-white w-full max-w-sm rounded-xl shadow-lg p-6 space-y-5 relative",children:[W.jsx("button",{className:"absolute top-4 right-4 text-xl font-semibold text-gray-400 hover:text-black",onClick:()=>F("/"),children:"×"}),W.jsx("h2",{className:"text-2xl font-semibold text-gray-800 text-center",children:"Login"}),N&&W.jsx("div",{className:"text-sm text-center text-red-600 bg-red-50 px-4 py-2 rounded",children:N}),A===1?W.jsxs(W.Fragment,{children:[W.jsx("label",{className:"text-sm text-gray-600 font-medium",children:"Admin Email"}),W.jsx("input",{type:"email",placeholder:"admin@foodyah.com",value:f,onChange:re=>g(re.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-400"}),W.jsx("button",{onClick:$,className:"w-full mt-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md font-semibold",children:"Send One Time Password"})]}):W.jsxs(W.Fragment,{children:[W.jsx("label",{className:"text-sm text-gray-600 font-medium",children:"Enter OTP"}),W.jsx("input",{type:"text",placeholder:"Enter the OTP",value:w,onChange:re=>S(re.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-400"}),W.jsx("button",{onClick:ie,className:"w-full mt-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-md font-semibold",children:"Verify & Login"})]})]})})}function Pv(f){throw new Error('Could not dynamically require "'+f+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ux={exports:{}},a2;function uk(){return a2||(a2=1,function(f,g){(function(w){f.exports=w()})(function(){return function(){function w(S,A,L){function N(B,$){if(!A[B]){if(!S[B]){var ie=typeof Pv=="function"&&Pv;if(!$&&ie)return ie(B,!0);if(r)return r(B,!0);var re=new Error("Cannot find module '"+B+"'");throw re.code="MODULE_NOT_FOUND",re}var Te=A[B]={exports:{}};S[B][0].call(Te.exports,function(_e){var me=S[B][1][_e];return N(me||_e)},Te,Te.exports,w,S,A,L)}return A[B].exports}for(var r=typeof Pv=="function"&&Pv,F=0;F<L.length;F++)N(L[F]);return N}return w}()({1:[function(w,S,A){var L=w("./toPropertyKey.js");function N(r,F,B){return F=L(F),F in r?Object.defineProperty(r,F,{value:B,enumerable:!0,configurable:!0,writable:!0}):r[F]=B,r}S.exports=N,S.exports.__esModule=!0,S.exports.default=S.exports},{"./toPropertyKey.js":4}],2:[function(w,S,A){var L=w("./defineProperty.js");function N(F,B){var $=Object.keys(F);if(Object.getOwnPropertySymbols){var ie=Object.getOwnPropertySymbols(F);B&&(ie=ie.filter(function(re){return Object.getOwnPropertyDescriptor(F,re).enumerable})),$.push.apply($,ie)}return $}function r(F){for(var B=1;B<arguments.length;B++){var $=arguments[B]!=null?arguments[B]:{};B%2?N(Object($),!0).forEach(function(ie){L(F,ie,$[ie])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors($)):N(Object($)).forEach(function(ie){Object.defineProperty(F,ie,Object.getOwnPropertyDescriptor($,ie))})}return F}S.exports=r,S.exports.__esModule=!0,S.exports.default=S.exports},{"./defineProperty.js":1}],3:[function(w,S,A){var L=w("./typeof.js").default;function N(r,F){if(L(r)!=="object"||r===null)return r;var B=r[Symbol.toPrimitive];if(B!==void 0){var $=B.call(r,F||"default");if(L($)!=="object")return $;throw new TypeError("@@toPrimitive must return a primitive value.")}return(F==="string"?String:Number)(r)}S.exports=N,S.exports.__esModule=!0,S.exports.default=S.exports},{"./typeof.js":5}],4:[function(w,S,A){var L=w("./typeof.js").default,N=w("./toPrimitive.js");function r(F){var B=N(F,"string");return L(B)==="symbol"?B:String(B)}S.exports=r,S.exports.__esModule=!0,S.exports.default=S.exports},{"./toPrimitive.js":3,"./typeof.js":5}],5:[function(w,S,A){function L(N){"@babel/helpers - typeof";return S.exports=L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},S.exports.__esModule=!0,S.exports.default=S.exports,L(N)}S.exports=L,S.exports.__esModule=!0,S.exports.default=S.exports},{}],6:[function(w,S,A){var L={};function N(B){return Math.floor(Math.abs(B)+.5)*(B>=0?1:-1)}function r(B,$,ie){B=N(B*ie),$=N($*ie);var re=B-$;re<<=1,B-$<0&&(re=~re);for(var Te="";re>=32;)Te+=String.fromCharCode((32|re&31)+63),re>>=5;return Te+=String.fromCharCode(re+63),Te}L.decode=function(B,$){for(var ie=0,re=0,Te=0,_e=[],me=0,ge=0,pe=null,fe,se,De=Math.pow(10,Number.isInteger($)?$:5);ie<B.length;){pe=null,me=0,ge=0;do pe=B.charCodeAt(ie++)-63,ge|=(pe&31)<<me,me+=5;while(pe>=32);fe=ge&1?~(ge>>1):ge>>1,me=ge=0;do pe=B.charCodeAt(ie++)-63,ge|=(pe&31)<<me,me+=5;while(pe>=32);se=ge&1?~(ge>>1):ge>>1,re+=fe,Te+=se,_e.push([re/De,Te/De])}return _e},L.encode=function(B,$){if(!B.length)return"";for(var ie=Math.pow(10,Number.isInteger($)?$:5),re=r(B[0][0],0,ie)+r(B[0][1],0,ie),Te=1;Te<B.length;Te++){var _e=B[Te],me=B[Te-1];re+=r(_e[0],me[0],ie),re+=r(_e[1],me[1],ie)}return re};function F(B){for(var $=[],ie=0;ie<B.length;ie++){var re=B[ie].slice();$.push([re[1],re[0]])}return $}L.fromGeoJSON=function(B,$){if(B&&B.type==="Feature"&&(B=B.geometry),!B||B.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return L.encode(F(B.coordinates),$)},L.toGeoJSON=function(B,$){var ie=L.decode(B,$);return{type:"LineString",coordinates:F(ie)}},typeof S=="object"&&S.exports&&(S.exports=L)},{}],7:[function(w,S,A){var L=typeof Reflect=="object"?Reflect:null,N=L&&typeof L.apply=="function"?L.apply:function(je,$e,It){return Function.prototype.apply.call(je,$e,It)},r;L&&typeof L.ownKeys=="function"?r=L.ownKeys:Object.getOwnPropertySymbols?r=function(je){return Object.getOwnPropertyNames(je).concat(Object.getOwnPropertySymbols(je))}:r=function(je){return Object.getOwnPropertyNames(je)};function F(Xe){console&&console.warn&&console.warn(Xe)}var B=Number.isNaN||function(je){return je!==je};function $(){$.init.call(this)}S.exports=$,S.exports.once=ht,$.EventEmitter=$,$.prototype._events=void 0,$.prototype._eventsCount=0,$.prototype._maxListeners=void 0;var ie=10;function re(Xe){if(typeof Xe!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Xe)}Object.defineProperty($,"defaultMaxListeners",{enumerable:!0,get:function(){return ie},set:function(Xe){if(typeof Xe!="number"||Xe<0||B(Xe))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Xe+".");ie=Xe}}),$.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},$.prototype.setMaxListeners=function(je){if(typeof je!="number"||je<0||B(je))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+je+".");return this._maxListeners=je,this};function Te(Xe){return Xe._maxListeners===void 0?$.defaultMaxListeners:Xe._maxListeners}$.prototype.getMaxListeners=function(){return Te(this)},$.prototype.emit=function(je){for(var $e=[],It=1;It<arguments.length;It++)$e.push(arguments[It]);var Lt=je==="error",ct=this._events;if(ct!==void 0)Lt=Lt&&ct.error===void 0;else if(!Lt)return!1;if(Lt){var Et;if($e.length>0&&(Et=$e[0]),Et instanceof Error)throw Et;var Qe=new Error("Unhandled error."+(Et?" ("+Et.message+")":""));throw Qe.context=Et,Qe}var kt=ct[je];if(kt===void 0)return!1;if(typeof kt=="function")N(kt,this,$e);else for(var ii=kt.length,Li=se(kt,ii),It=0;It<ii;++It)N(Li[It],this,$e);return!0};function _e(Xe,je,$e,It){var Lt,ct,Et;if(re($e),ct=Xe._events,ct===void 0?(ct=Xe._events=Object.create(null),Xe._eventsCount=0):(ct.newListener!==void 0&&(Xe.emit("newListener",je,$e.listener?$e.listener:$e),ct=Xe._events),Et=ct[je]),Et===void 0)Et=ct[je]=$e,++Xe._eventsCount;else if(typeof Et=="function"?Et=ct[je]=It?[$e,Et]:[Et,$e]:It?Et.unshift($e):Et.push($e),Lt=Te(Xe),Lt>0&&Et.length>Lt&&!Et.warned){Et.warned=!0;var Qe=new Error("Possible EventEmitter memory leak detected. "+Et.length+" "+String(je)+" listeners added. Use emitter.setMaxListeners() to increase limit");Qe.name="MaxListenersExceededWarning",Qe.emitter=Xe,Qe.type=je,Qe.count=Et.length,F(Qe)}return Xe}$.prototype.addListener=function(je,$e){return _e(this,je,$e,!1)},$.prototype.on=$.prototype.addListener,$.prototype.prependListener=function(je,$e){return _e(this,je,$e,!0)};function me(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ge(Xe,je,$e){var It={fired:!1,wrapFn:void 0,target:Xe,type:je,listener:$e},Lt=me.bind(It);return Lt.listener=$e,It.wrapFn=Lt,Lt}$.prototype.once=function(je,$e){return re($e),this.on(je,ge(this,je,$e)),this},$.prototype.prependOnceListener=function(je,$e){return re($e),this.prependListener(je,ge(this,je,$e)),this},$.prototype.removeListener=function(je,$e){var It,Lt,ct,Et,Qe;if(re($e),Lt=this._events,Lt===void 0)return this;if(It=Lt[je],It===void 0)return this;if(It===$e||It.listener===$e)--this._eventsCount===0?this._events=Object.create(null):(delete Lt[je],Lt.removeListener&&this.emit("removeListener",je,It.listener||$e));else if(typeof It!="function"){for(ct=-1,Et=It.length-1;Et>=0;Et--)if(It[Et]===$e||It[Et].listener===$e){Qe=It[Et].listener,ct=Et;break}if(ct<0)return this;ct===0?It.shift():De(It,ct),It.length===1&&(Lt[je]=It[0]),Lt.removeListener!==void 0&&this.emit("removeListener",je,Qe||$e)}return this},$.prototype.off=$.prototype.removeListener,$.prototype.removeAllListeners=function(je){var $e,It,Lt;if(It=this._events,It===void 0)return this;if(It.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):It[je]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete It[je]),this;if(arguments.length===0){var ct=Object.keys(It),Et;for(Lt=0;Lt<ct.length;++Lt)Et=ct[Lt],Et!=="removeListener"&&this.removeAllListeners(Et);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if($e=It[je],typeof $e=="function")this.removeListener(je,$e);else if($e!==void 0)for(Lt=$e.length-1;Lt>=0;Lt--)this.removeListener(je,$e[Lt]);return this};function pe(Xe,je,$e){var It=Xe._events;if(It===void 0)return[];var Lt=It[je];return Lt===void 0?[]:typeof Lt=="function"?$e?[Lt.listener||Lt]:[Lt]:$e?we(Lt):se(Lt,Lt.length)}$.prototype.listeners=function(je){return pe(this,je,!0)},$.prototype.rawListeners=function(je){return pe(this,je,!1)},$.listenerCount=function(Xe,je){return typeof Xe.listenerCount=="function"?Xe.listenerCount(je):fe.call(Xe,je)},$.prototype.listenerCount=fe;function fe(Xe){var je=this._events;if(je!==void 0){var $e=je[Xe];if(typeof $e=="function")return 1;if($e!==void 0)return $e.length}return 0}$.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function se(Xe,je){for(var $e=new Array(je),It=0;It<je;++It)$e[It]=Xe[It];return $e}function De(Xe,je){for(;je+1<Xe.length;je++)Xe[je]=Xe[je+1];Xe.pop()}function we(Xe){for(var je=new Array(Xe.length),$e=0;$e<je.length;++$e)je[$e]=Xe[$e].listener||Xe[$e];return je}function ht(Xe,je){return new Promise(function($e,It){function Lt(Et){Xe.removeListener(je,ct),It(Et)}function ct(){typeof Xe.removeListener=="function"&&Xe.removeListener("error",Lt),$e([].slice.call(arguments))}gt(Xe,je,ct,{once:!0}),je!=="error"&&At(Xe,Lt,{once:!0})})}function At(Xe,je,$e){typeof Xe.on=="function"&&gt(Xe,"error",je,$e)}function gt(Xe,je,$e,It){if(typeof Xe.on=="function")It.once?Xe.once(je,$e):Xe.on(je,$e);else if(typeof Xe.addEventListener=="function")Xe.addEventListener(je,function Lt(ct){It.once&&Xe.removeEventListener(je,Lt),$e(ct)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Xe)}},{}],8:[function(w,S,A){(function(){var L=this,N={};typeof A<"u"?S.exports=N:L.fuzzy=N,N.simpleFilter=function(r,F){return F.filter(function(B){return N.test(r,B)})},N.test=function(r,F){return N.match(r,F)!==null},N.match=function(r,F,B){B=B||{};var $=0,ie=[],re=F.length,Te=0,_e=0,me=B.pre||"",ge=B.post||"",pe=B.caseSensitive&&F||F.toLowerCase(),fe;r=B.caseSensitive&&r||r.toLowerCase();for(var se=0;se<re;se++)fe=F[se],pe[se]===r[$]?(fe=me+fe+ge,$+=1,_e+=1+_e):_e=0,Te+=_e,ie[ie.length]=fe;return $===r.length?(Te=pe===r?1/0:Te,{rendered:ie.join(""),score:Te}):null},N.filter=function(r,F,B){return!F||F.length===0?[]:typeof r!="string"?F:(B=B||{},F.reduce(function($,ie,re,Te){var _e=ie;B.extract&&(_e=B.extract(ie));var me=N.match(r,_e,B);return me!=null&&($[$.length]={string:me.rendered,score:me.score,index:re,original:ie}),$},[]).sort(function($,ie){var re=ie.score-$.score;return re||$.index-ie.index}))}})()},{}],9:[function(w,S,A){var L=/<%=([\s\S]+?)%>/g;S.exports=L},{}],10:[function(w,S,A){(function(L){(function(){var N="Expected a function",r=NaN,F="[object Symbol]",B=/^\s+|\s+$/g,$=/^[-+]0x[0-9a-f]+$/i,ie=/^0b[01]+$/i,re=/^0o[0-7]+$/i,Te=parseInt,_e=typeof L=="object"&&L&&L.Object===Object&&L,me=typeof self=="object"&&self&&self.Object===Object&&self,ge=_e||me||Function("return this")(),pe=Object.prototype,fe=pe.toString,se=Math.max,De=Math.min,we=function(){return ge.Date.now()};function ht($e,It,Lt){var ct,Et,Qe,kt,ii,Li,Ve=0,Dt=!1,ti=!1,li=!0;if(typeof $e!="function")throw new TypeError(N);It=je(It)||0,At(Lt)&&(Dt=!!Lt.leading,ti="maxWait"in Lt,Qe=ti?se(je(Lt.maxWait)||0,It):Qe,li="trailing"in Lt?!!Lt.trailing:li);function Mi(Qi){var Zr=ct,Fn=Et;return ct=Et=void 0,Ve=Qi,kt=$e.apply(Fn,Zr),kt}function at(Qi){return Ve=Qi,ii=setTimeout(Oi,It),Dt?Mi(Qi):kt}function Rt(Qi){var Zr=Qi-Li,Fn=Qi-Ve,Qr=It-Zr;return ti?De(Qr,Qe-Fn):Qr}function _i(Qi){var Zr=Qi-Li,Fn=Qi-Ve;return Li===void 0||Zr>=It||Zr<0||ti&&Fn>=Qe}function Oi(){var Qi=we();if(_i(Qi))return ei(Qi);ii=setTimeout(Oi,Rt(Qi))}function ei(Qi){return ii=void 0,li&&ct?Mi(Qi):(ct=Et=void 0,kt)}function hn(){ii!==void 0&&clearTimeout(ii),Ve=0,ct=Li=Et=ii=void 0}function In(){return ii===void 0?kt:ei(we())}function Rn(){var Qi=we(),Zr=_i(Qi);if(ct=arguments,Et=this,Li=Qi,Zr){if(ii===void 0)return at(Li);if(ti)return ii=setTimeout(Oi,It),Mi(Li)}return ii===void 0&&(ii=setTimeout(Oi,It)),kt}return Rn.cancel=hn,Rn.flush=In,Rn}function At($e){var It=typeof $e;return!!$e&&(It=="object"||It=="function")}function gt($e){return!!$e&&typeof $e=="object"}function Xe($e){return typeof $e=="symbol"||gt($e)&&fe.call($e)==F}function je($e){if(typeof $e=="number")return $e;if(Xe($e))return r;if(At($e)){var It=typeof $e.valueOf=="function"?$e.valueOf():$e;$e=At(It)?It+"":It}if(typeof $e!="string")return $e===0?$e:+$e;$e=$e.replace(B,"");var Lt=ie.test($e);return Lt||re.test($e)?Te($e.slice(2),Lt?2:8):$.test($e)?r:+$e}S.exports=ht}).call(this)}).call(this,typeof hp<"u"?hp:typeof self<"u"?self:typeof window<"u"?window:{})},{}],11:[function(w,S,A){(function(L){(function(){var N=200,r="__lodash_hash_undefined__",F=1,B=2,$=9007199254740991,ie="[object Arguments]",re="[object Array]",Te="[object AsyncFunction]",_e="[object Boolean]",me="[object Date]",ge="[object Error]",pe="[object Function]",fe="[object GeneratorFunction]",se="[object Map]",De="[object Number]",we="[object Null]",ht="[object Object]",At="[object Promise]",gt="[object Proxy]",Xe="[object RegExp]",je="[object Set]",$e="[object String]",It="[object Symbol]",Lt="[object Undefined]",ct="[object WeakMap]",Et="[object ArrayBuffer]",Qe="[object DataView]",kt="[object Float32Array]",ii="[object Float64Array]",Li="[object Int8Array]",Ve="[object Int16Array]",Dt="[object Int32Array]",ti="[object Uint8Array]",li="[object Uint8ClampedArray]",Mi="[object Uint16Array]",at="[object Uint32Array]",Rt=/[\\^$.*+?()[\]{}|]/g,_i=/^\[object .+?Constructor\]$/,Oi=/^(?:0|[1-9]\d*)$/,ei={};ei[kt]=ei[ii]=ei[Li]=ei[Ve]=ei[Dt]=ei[ti]=ei[li]=ei[Mi]=ei[at]=!0,ei[ie]=ei[re]=ei[Et]=ei[_e]=ei[Qe]=ei[me]=ei[ge]=ei[pe]=ei[se]=ei[De]=ei[ht]=ei[Xe]=ei[je]=ei[$e]=ei[ct]=!1;var hn=typeof L=="object"&&L&&L.Object===Object&&L,In=typeof self=="object"&&self&&self.Object===Object&&self,Rn=hn||In||Function("return this")(),Qi=typeof A=="object"&&A&&!A.nodeType&&A,Zr=Qi&&typeof S=="object"&&S&&!S.nodeType&&S,Fn=Zr&&Zr.exports===Qi,Qr=Fn&&hn.process,gs=function(){try{return Qr&&Qr.binding&&Qr.binding("util")}catch{}}(),No=gs&&gs.isTypedArray;function Or(qe,Tt){for(var vi=-1,Zi=qe==null?0:qe.length,Rr=0,Bn=[];++vi<Zi;){var es=qe[vi];Tt(es,vi,qe)&&(Bn[Rr++]=es)}return Bn}function Nr(qe,Tt){for(var vi=-1,Zi=Tt.length,Rr=qe.length;++vi<Zi;)qe[Rr+vi]=Tt[vi];return qe}function Jr(qe,Tt){for(var vi=-1,Zi=qe==null?0:qe.length;++vi<Zi;)if(Tt(qe[vi],vi,qe))return!0;return!1}function Ao(qe,Tt){for(var vi=-1,Zi=Array(qe);++vi<qe;)Zi[vi]=Tt(vi);return Zi}function Ja(qe){return function(Tt){return qe(Tt)}}function Ns(qe,Tt){return qe.has(Tt)}function hl(qe,Tt){return qe?.[Tt]}function eo(qe){var Tt=-1,vi=Array(qe.size);return qe.forEach(function(Zi,Rr){vi[++Tt]=[Rr,Zi]}),vi}function Ur(qe,Tt){return function(vi){return qe(Tt(vi))}}function ka(qe){var Tt=-1,vi=Array(qe.size);return qe.forEach(function(Zi){vi[++Tt]=Zi}),vi}var _s=Array.prototype,Dl=Function.prototype,xs=Object.prototype,aa=Rn["__core-js_shared__"],Na=Dl.toString,bs=xs.hasOwnProperty,Os=function(){var qe=/[^.]+$/.exec(aa&&aa.keys&&aa.keys.IE_PROTO||"");return qe?"Symbol(src)_1."+qe:""}(),oa=xs.toString,_a=RegExp("^"+Na.call(bs).replace(Rt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),On=Fn?Rn.Buffer:void 0,ya=Rn.Symbol,Co=Rn.Uint8Array,Fs=xs.propertyIsEnumerable,dl=_s.splice,to=ya?ya.toStringTag:void 0,Fa=Object.getOwnPropertySymbols,Qt=On?On.isBuffer:void 0,io=Ur(Object.keys,Object),va=Ua(Rn,"DataView"),xa=Ua(Rn,"Map"),wn=Ua(Rn,"Promise"),nt=Ua(Rn,"Set"),ee=Ua(Rn,"WeakMap"),ae=Ua(Object,"create"),xe=Er(va),ke=Er(xa),Me=Er(wn),He=Er(nt),et=Er(ee),Ue=ya?ya.prototype:void 0,tt=Ue?Ue.valueOf:void 0;function vt(qe){var Tt=-1,vi=qe==null?0:qe.length;for(this.clear();++Tt<vi;){var Zi=qe[Tt];this.set(Zi[0],Zi[1])}}function rt(){this.__data__=ae?ae(null):{},this.size=0}function Xt(qe){var Tt=this.has(qe)&&delete this.__data__[qe];return this.size-=Tt?1:0,Tt}function pi(qe){var Tt=this.__data__;if(ae){var vi=Tt[qe];return vi===r?void 0:vi}return bs.call(Tt,qe)?Tt[qe]:void 0}function si(qe){var Tt=this.__data__;return ae?Tt[qe]!==void 0:bs.call(Tt,qe)}function Bi(qe,Tt){var vi=this.__data__;return this.size+=this.has(qe)?0:1,vi[qe]=ae&&Tt===void 0?r:Tt,this}vt.prototype.clear=rt,vt.prototype.delete=Xt,vt.prototype.get=pi,vt.prototype.has=si,vt.prototype.set=Bi;function Ni(qe){var Tt=-1,vi=qe==null?0:qe.length;for(this.clear();++Tt<vi;){var Zi=qe[Tt];this.set(Zi[0],Zi[1])}}function Vi(){this.__data__=[],this.size=0}function Ji(qe){var Tt=this.__data__,vi=no(Tt,qe);if(vi<0)return!1;var Zi=Tt.length-1;return vi==Zi?Tt.pop():dl.call(Tt,vi,1),--this.size,!0}function Yi(qe){var Tt=this.__data__,vi=no(Tt,qe);return vi<0?void 0:Tt[vi][1]}function Hn(qe){return no(this.__data__,qe)>-1}function ir(qe,Tt){var vi=this.__data__,Zi=no(vi,qe);return Zi<0?(++this.size,vi.push([qe,Tt])):vi[Zi][1]=Tt,this}Ni.prototype.clear=Vi,Ni.prototype.delete=Ji,Ni.prototype.get=Yi,Ni.prototype.has=Hn,Ni.prototype.set=ir;function Vn(qe){var Tt=-1,vi=qe==null?0:qe.length;for(this.clear();++Tt<vi;){var Zi=qe[Tt];this.set(Zi[0],Zi[1])}}function Mn(){this.size=0,this.__data__={hash:new vt,map:new(xa||Ni),string:new vt}}function Tn(qe){var Tt=Va(this,qe).delete(qe);return this.size-=Tt?1:0,Tt}function Xn(qe){return Va(this,qe).get(qe)}function dr(qe){return Va(this,qe).has(qe)}function fr(qe,Tt){var vi=Va(this,qe),Zi=vi.size;return vi.set(qe,Tt),this.size+=vi.size==Zi?0:1,this}Vn.prototype.clear=Mn,Vn.prototype.delete=Tn,Vn.prototype.get=Xn,Vn.prototype.has=dr,Vn.prototype.set=fr;function Fr(qe){var Tt=-1,vi=qe==null?0:qe.length;for(this.__data__=new Vn;++Tt<vi;)this.add(qe[Tt])}function Bs(qe){return this.__data__.set(qe,r),this}function As(qe){return this.__data__.has(qe)}Fr.prototype.add=Fr.prototype.push=Bs,Fr.prototype.has=As;function Ba(qe){var Tt=this.__data__=new Ni(qe);this.size=Tt.size}function hs(){this.__data__=new Ni,this.size=0}function Cs(qe){var Tt=this.__data__,vi=Tt.delete(qe);return this.size=Tt.size,vi}function Pl(qe){return this.__data__.get(qe)}function fl(qe){return this.__data__.has(qe)}function Fo(qe,Tt){var vi=this.__data__;if(vi instanceof Ni){var Zi=vi.__data__;if(!xa||Zi.length<N-1)return Zi.push([qe,Tt]),this.size=++vi.size,this;vi=this.__data__=new Vn(Zi)}return vi.set(qe,Tt),this.size=vi.size,this}Ba.prototype.clear=hs,Ba.prototype.delete=Cs,Ba.prototype.get=Pl,Ba.prototype.has=fl,Ba.prototype.set=Fo;function Ol(qe,Tt){var vi=Ga(qe),Zi=!vi&&ss(qe),Rr=!vi&&!Zi&&mo(qe),Bn=!vi&&!Zi&&!Rr&&Ha(qe),es=vi||Zi||Rr||Bn,fs=es?Ao(qe.length,String):[],Br=fs.length;for(var as in qe)bs.call(qe,as)&&!(es&&(as=="length"||Rr&&(as=="offset"||as=="parent")||Bn&&(as=="buffer"||as=="byteLength"||as=="byteOffset")||Si(as,Br)))&&fs.push(as);return fs}function no(qe,Tt){for(var vi=qe.length;vi--;)if(en(qe[vi][0],Tt))return vi;return-1}function Bo(qe,Tt,vi){var Zi=Tt(qe);return Ga(qe)?Zi:Nr(Zi,vi(qe))}function rs(qe){return qe==null?qe===void 0?Lt:we:to&&to in Object(qe)?_u(qe):Qs(qe)}function ja(qe){return so(qe)&&rs(qe)==ie}function ba(qe,Tt,vi,Zi,Rr){return qe===Tt?!0:qe==null||Tt==null||!so(qe)&&!so(Tt)?qe!==qe&&Tt!==Tt:Ys(qe,Tt,vi,Zi,ba,Rr)}function Ys(qe,Tt,vi,Zi,Rr,Bn){var es=Ga(qe),fs=Ga(Tt),Br=es?re:Ht(qe),as=fs?re:Ht(Tt);Br=Br==ie?ht:Br,as=as==ie?ht:as;var Ls=Br==ht,ea=as==ht,ln=Br==as;if(ln&&mo(qe)){if(!mo(Tt))return!1;es=!0,Ls=!1}if(ln&&!Ls)return Bn||(Bn=new Ba),es||Ha(qe)?Ks(qe,Tt,vi,Zi,Rr,Bn):hc(qe,Tt,Br,vi,Zi,Rr,Bn);if(!(vi&F)){var ws=Ls&&bs.call(qe,"__wrapped__"),go=ea&&bs.call(Tt,"__wrapped__");if(ws||go){var Uo=ws?qe.value():qe,zi=go?Tt.value():Tt;return Bn||(Bn=new Ba),Rr(Uo,zi,vi,Zi,Bn)}}return ln?(Bn||(Bn=new Ba),ro(qe,Tt,vi,Zi,Rr,Bn)):!1}function js(qe){if(!jo(qe)||qn(qe))return!1;var Tt=Ta(qe)?_a:_i;return Tt.test(Er(qe))}function po(qe){return so(qe)&&Sa(qe.length)&&!!ei[rs(qe)]}function wa(qe){if(!ys(qe))return io(qe);var Tt=[];for(var vi in Object(qe))bs.call(qe,vi)&&vi!="constructor"&&Tt.push(vi);return Tt}function Ks(qe,Tt,vi,Zi,Rr,Bn){var es=vi&F,fs=qe.length,Br=Tt.length;if(fs!=Br&&!(es&&Br>fs))return!1;var as=Bn.get(qe);if(as&&Bn.get(Tt))return as==Tt;var Ls=-1,ea=!0,ln=vi&B?new Fr:void 0;for(Bn.set(qe,Tt),Bn.set(Tt,qe);++Ls<fs;){var ws=qe[Ls],go=Tt[Ls];if(Zi)var Uo=es?Zi(go,ws,Ls,Tt,qe,Bn):Zi(ws,go,Ls,qe,Tt,Bn);if(Uo!==void 0){if(Uo)continue;ea=!1;break}if(ln){if(!Jr(Tt,function(zi,Go){if(!Ns(ln,Go)&&(ws===zi||Rr(ws,zi,vi,Zi,Bn)))return ln.push(Go)})){ea=!1;break}}else if(!(ws===go||Rr(ws,go,vi,Zi,Bn))){ea=!1;break}}return Bn.delete(qe),Bn.delete(Tt),ea}function hc(qe,Tt,vi,Zi,Rr,Bn,es){switch(vi){case Qe:if(qe.byteLength!=Tt.byteLength||qe.byteOffset!=Tt.byteOffset)return!1;qe=qe.buffer,Tt=Tt.buffer;case Et:return!(qe.byteLength!=Tt.byteLength||!Bn(new Co(qe),new Co(Tt)));case _e:case me:case De:return en(+qe,+Tt);case ge:return qe.name==Tt.name&&qe.message==Tt.message;case Xe:case $e:return qe==Tt+"";case se:var fs=eo;case je:var Br=Zi&F;if(fs||(fs=ka),qe.size!=Tt.size&&!Br)return!1;var as=es.get(qe);if(as)return as==Tt;Zi|=B,es.set(qe,Tt);var Ls=Ks(fs(qe),fs(Tt),Zi,Rr,Bn,es);return es.delete(qe),Ls;case It:if(tt)return tt.call(qe)==tt.call(Tt)}return!1}function ro(qe,Tt,vi,Zi,Rr,Bn){var es=vi&F,fs=pl(qe),Br=fs.length,as=pl(Tt),Ls=as.length;if(Br!=Ls&&!es)return!1;for(var ea=Br;ea--;){var ln=fs[ea];if(!(es?ln in Tt:bs.call(Tt,ln)))return!1}var ws=Bn.get(qe);if(ws&&Bn.get(Tt))return ws==Tt;var go=!0;Bn.set(qe,Tt),Bn.set(Tt,qe);for(var Uo=es;++ea<Br;){ln=fs[ea];var zi=qe[ln],Go=Tt[ln];if(Zi)var Fc=es?Zi(Go,zi,ln,Tt,qe,Bn):Zi(zi,Go,ln,qe,Tt,Bn);if(!(Fc===void 0?zi===Go||Rr(zi,Go,vi,Zi,Bn):Fc)){go=!1;break}Uo||(Uo=ln=="constructor")}if(go&&!Uo){var Ho=qe.constructor,la=Tt.constructor;Ho!=la&&"constructor"in qe&&"constructor"in Tt&&!(typeof Ho=="function"&&Ho instanceof Ho&&typeof la=="function"&&la instanceof la)&&(go=!1)}return Bn.delete(qe),Bn.delete(Tt),go}function pl(qe){return Bo(qe,Js,ot)}function Va(qe,Tt){var vi=qe.__data__;return Sn(Tt)?vi[typeof Tt=="string"?"string":"hash"]:vi.map}function Ua(qe,Tt){var vi=hl(qe,Tt);return js(vi)?vi:void 0}function _u(qe){var Tt=bs.call(qe,to),vi=qe[to];try{qe[to]=void 0;var Zi=!0}catch{}var Rr=oa.call(qe);return Zi&&(Tt?qe[to]=vi:delete qe[to]),Rr}var ot=Fa?function(qe){return qe==null?[]:(qe=Object(qe),Or(Fa(qe),function(Tt){return Fs.call(qe,Tt)}))}:Gs,Ht=rs;(va&&Ht(new va(new ArrayBuffer(1)))!=Qe||xa&&Ht(new xa)!=se||wn&&Ht(wn.resolve())!=At||nt&&Ht(new nt)!=je||ee&&Ht(new ee)!=ct)&&(Ht=function(qe){var Tt=rs(qe),vi=Tt==ht?qe.constructor:void 0,Zi=vi?Er(vi):"";if(Zi)switch(Zi){case xe:return Qe;case ke:return se;case Me:return At;case He:return je;case et:return ct}return Tt});function Si(qe,Tt){return Tt=Tt??$,!!Tt&&(typeof qe=="number"||Oi.test(qe))&&qe>-1&&qe%1==0&&qe<Tt}function Sn(qe){var Tt=typeof qe;return Tt=="string"||Tt=="number"||Tt=="symbol"||Tt=="boolean"?qe!=="__proto__":qe===null}function qn(qe){return!!Os&&Os in qe}function ys(qe){var Tt=qe&&qe.constructor,vi=typeof Tt=="function"&&Tt.prototype||xs;return qe===vi}function Qs(qe){return oa.call(qe)}function Er(qe){if(qe!=null){try{return Na.call(qe)}catch{}try{return qe+""}catch{}}return""}function en(qe,Tt){return qe===Tt||qe!==qe&&Tt!==Tt}var ss=ja(function(){return arguments}())?ja:function(qe){return so(qe)&&bs.call(qe,"callee")&&!Fs.call(qe,"callee")},Ga=Array.isArray;function ds(qe){return qe!=null&&Sa(qe.length)&&!Ta(qe)}var mo=Qt||Vo;function ml(qe,Tt){return ba(qe,Tt)}function Ta(qe){if(!jo(qe))return!1;var Tt=rs(qe);return Tt==pe||Tt==fe||Tt==Te||Tt==gt}function Sa(qe){return typeof qe=="number"&&qe>-1&&qe%1==0&&qe<=$}function jo(qe){var Tt=typeof qe;return qe!=null&&(Tt=="object"||Tt=="function")}function so(qe){return qe!=null&&typeof qe=="object"}var Ha=No?Ja(No):po;function Js(qe){return ds(qe)?Ol(qe):wa(qe)}function Gs(){return[]}function Vo(){return!1}S.exports=ml}).call(this)}).call(this,typeof hp<"u"?hp:typeof self<"u"?self:typeof window<"u"?window:{})},{}],12:[function(w,S,A){(function(L){(function(){var N=w("lodash._reinterpolate"),r=w("lodash.templatesettings"),F=800,B=16,$=9007199254740991,ie="[object Arguments]",re="[object Array]",Te="[object AsyncFunction]",_e="[object Boolean]",me="[object Date]",ge="[object DOMException]",pe="[object Error]",fe="[object Function]",se="[object GeneratorFunction]",De="[object Map]",we="[object Number]",ht="[object Null]",At="[object Object]",gt="[object Proxy]",Xe="[object RegExp]",je="[object Set]",$e="[object String]",It="[object Symbol]",Lt="[object Undefined]",ct="[object WeakMap]",Et="[object ArrayBuffer]",Qe="[object DataView]",kt="[object Float32Array]",ii="[object Float64Array]",Li="[object Int8Array]",Ve="[object Int16Array]",Dt="[object Int32Array]",ti="[object Uint8Array]",li="[object Uint8ClampedArray]",Mi="[object Uint16Array]",at="[object Uint32Array]",Rt=/\b__p \+= '';/g,_i=/\b(__p \+=) '' \+/g,Oi=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ei=/[\\^$.*+?()[\]{}|]/g,hn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,In=/^\[object .+?Constructor\]$/,Rn=/^(?:0|[1-9]\d*)$/,Qi=/($^)/,Zr=/['\n\r\u2028\u2029\\]/g,Fn={};Fn[kt]=Fn[ii]=Fn[Li]=Fn[Ve]=Fn[Dt]=Fn[ti]=Fn[li]=Fn[Mi]=Fn[at]=!0,Fn[ie]=Fn[re]=Fn[Et]=Fn[_e]=Fn[Qe]=Fn[me]=Fn[pe]=Fn[fe]=Fn[De]=Fn[we]=Fn[At]=Fn[Xe]=Fn[je]=Fn[$e]=Fn[ct]=!1;var Qr={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},gs=typeof L=="object"&&L&&L.Object===Object&&L,No=typeof self=="object"&&self&&self.Object===Object&&self,Or=gs||No||Function("return this")(),Nr=typeof A=="object"&&A&&!A.nodeType&&A,Jr=Nr&&typeof S=="object"&&S&&!S.nodeType&&S,Ao=Jr&&Jr.exports===Nr,Ja=Ao&&gs.process,Ns=function(){try{var ot=Jr&&Jr.require&&Jr.require("util").types;return ot||Ja&&Ja.binding&&Ja.binding("util")}catch{}}(),hl=Ns&&Ns.isTypedArray;function eo(ot,Ht,Si){switch(Si.length){case 0:return ot.call(Ht);case 1:return ot.call(Ht,Si[0]);case 2:return ot.call(Ht,Si[0],Si[1]);case 3:return ot.call(Ht,Si[0],Si[1],Si[2])}return ot.apply(Ht,Si)}function Ur(ot,Ht){for(var Si=-1,Sn=ot==null?0:ot.length,qn=Array(Sn);++Si<Sn;)qn[Si]=Ht(ot[Si],Si,ot);return qn}function ka(ot,Ht){for(var Si=-1,Sn=Array(ot);++Si<ot;)Sn[Si]=Ht(Si);return Sn}function _s(ot){return function(Ht){return ot(Ht)}}function Dl(ot,Ht){return Ur(Ht,function(Si){return ot[Si]})}function xs(ot){return"\\"+Qr[ot]}function aa(ot,Ht){return ot?.[Ht]}function Na(ot,Ht){return function(Si){return ot(Ht(Si))}}var bs=Function.prototype,Os=Object.prototype,oa=Or["__core-js_shared__"],_a=bs.toString,On=Os.hasOwnProperty,ya=function(){var ot=/[^.]+$/.exec(oa&&oa.keys&&oa.keys.IE_PROTO||"");return ot?"Symbol(src)_1."+ot:""}(),Co=Os.toString,Fs=_a.call(Object),dl=RegExp("^"+_a.call(On).replace(ei,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),to=Ao?Or.Buffer:void 0,Fa=Or.Symbol,Qt=Na(Object.getPrototypeOf,Object),io=Os.propertyIsEnumerable,va=Fa?Fa.toStringTag:void 0,xa=function(){try{var ot=Hn(Object,"defineProperty");return ot({},"",{}),ot}catch{}}(),wn=to?to.isBuffer:void 0,nt=Na(Object.keys,Object),ee=Math.max,ae=Date.now,xe=Fa?Fa.prototype:void 0,ke=xe?xe.toString:void 0;function Me(ot,Ht){var Si=Pl(ot),Sn=!Si&&Cs(ot),qn=!Si&&!Sn&&Fo(ot),ys=!Si&&!Sn&&!qn&&js(ot),Qs=Si||Sn||qn||ys,Er=Qs?ka(ot.length,String):[],en=Er.length;for(var ss in ot)(Ht||On.call(ot,ss))&&!(Qs&&(ss=="length"||qn&&(ss=="offset"||ss=="parent")||ys&&(ss=="buffer"||ss=="byteLength"||ss=="byteOffset")||Vn(ss,en)))&&Er.push(ss);return Er}function He(ot,Ht,Si){var Sn=ot[Ht];(!(On.call(ot,Ht)&&hs(Sn,Si))||Si===void 0&&!(Ht in ot))&&et(ot,Ht,Si)}function et(ot,Ht,Si){Ht=="__proto__"&&xa?xa(ot,Ht,{configurable:!0,enumerable:!0,value:Si,writable:!0}):ot[Ht]=Si}function Ue(ot){return ot==null?ot===void 0?Lt:ht:va&&va in Object(ot)?ir(ot):fr(ot)}function tt(ot){return ja(ot)&&Ue(ot)==ie}function vt(ot){if(!rs(ot)||Tn(ot))return!1;var Ht=no(ot)?dl:In;return Ht.test(Ba(ot))}function rt(ot){return ja(ot)&&Bo(ot.length)&&!!Fn[Ue(ot)]}function Xt(ot){if(!Xn(ot))return nt(ot);var Ht=[];for(var Si in Object(ot))On.call(ot,Si)&&Si!="constructor"&&Ht.push(Si);return Ht}function pi(ot){if(!rs(ot))return dr(ot);var Ht=Xn(ot),Si=[];for(var Sn in ot)Sn=="constructor"&&(Ht||!On.call(ot,Sn))||Si.push(Sn);return Si}function si(ot,Ht){return Bs(Fr(ot,Ht,Ua),ot+"")}var Bi=xa?function(ot,Ht){return xa(ot,"toString",{configurable:!0,enumerable:!1,value:Va(Ht),writable:!0})}:Ua;function Ni(ot){if(typeof ot=="string")return ot;if(Pl(ot))return Ur(ot,Ni)+"";if(Ys(ot))return ke?ke.call(ot):"";var Ht=ot+"";return Ht=="0"&&1/ot==-1/0?"-0":Ht}function Vi(ot,Ht,Si,Sn){var qn=!Si;Si||(Si={});for(var ys=-1,Qs=Ht.length;++ys<Qs;){var Er=Ht[ys],en=Sn?Sn(Si[Er],ot[Er],Er,Si,ot):void 0;en===void 0&&(en=ot[Er]),qn?et(Si,Er,en):He(Si,Er,en)}return Si}function Ji(ot){return si(function(Ht,Si){var Sn=-1,qn=Si.length,ys=qn>1?Si[qn-1]:void 0,Qs=qn>2?Si[2]:void 0;for(ys=ot.length>3&&typeof ys=="function"?(qn--,ys):void 0,Qs&&Mn(Si[0],Si[1],Qs)&&(ys=qn<3?void 0:ys,qn=1),Ht=Object(Ht);++Sn<qn;){var Er=Si[Sn];Er&&ot(Ht,Er,Sn,ys)}return Ht})}function Yi(ot,Ht,Si,Sn){return ot===void 0||hs(ot,Os[Si])&&!On.call(Sn,Si)?Ht:ot}function Hn(ot,Ht){var Si=aa(ot,Ht);return vt(Si)?Si:void 0}function ir(ot){var Ht=On.call(ot,va),Si=ot[va];try{ot[va]=void 0;var Sn=!0}catch{}var qn=Co.call(ot);return Sn&&(Ht?ot[va]=Si:delete ot[va]),qn}function Vn(ot,Ht){var Si=typeof ot;return Ht=Ht??$,!!Ht&&(Si=="number"||Si!="symbol"&&Rn.test(ot))&&ot>-1&&ot%1==0&&ot<Ht}function Mn(ot,Ht,Si){if(!rs(Si))return!1;var Sn=typeof Ht;return(Sn=="number"?fl(Si)&&Vn(Ht,Si.length):Sn=="string"&&Ht in Si)?hs(Si[Ht],ot):!1}function Tn(ot){return!!ya&&ya in ot}function Xn(ot){var Ht=ot&&ot.constructor,Si=typeof Ht=="function"&&Ht.prototype||Os;return ot===Si}function dr(ot){var Ht=[];if(ot!=null)for(var Si in Object(ot))Ht.push(Si);return Ht}function fr(ot){return Co.call(ot)}function Fr(ot,Ht,Si){return Ht=ee(Ht===void 0?ot.length-1:Ht,0),function(){for(var Sn=arguments,qn=-1,ys=ee(Sn.length-Ht,0),Qs=Array(ys);++qn<ys;)Qs[qn]=Sn[Ht+qn];qn=-1;for(var Er=Array(Ht+1);++qn<Ht;)Er[qn]=Sn[qn];return Er[Ht]=Si(Qs),eo(ot,this,Er)}}var Bs=As(Bi);function As(ot){var Ht=0,Si=0;return function(){var Sn=ae(),qn=B-(Sn-Si);if(Si=Sn,qn>0){if(++Ht>=F)return arguments[0]}else Ht=0;return ot.apply(void 0,arguments)}}function Ba(ot){if(ot!=null){try{return _a.call(ot)}catch{}try{return ot+""}catch{}}return""}function hs(ot,Ht){return ot===Ht||ot!==ot&&Ht!==Ht}var Cs=tt(function(){return arguments}())?tt:function(ot){return ja(ot)&&On.call(ot,"callee")&&!io.call(ot,"callee")},Pl=Array.isArray;function fl(ot){return ot!=null&&Bo(ot.length)&&!no(ot)}var Fo=wn||_u;function Ol(ot){if(!ja(ot))return!1;var Ht=Ue(ot);return Ht==pe||Ht==ge||typeof ot.message=="string"&&typeof ot.name=="string"&&!ba(ot)}function no(ot){if(!rs(ot))return!1;var Ht=Ue(ot);return Ht==fe||Ht==se||Ht==Te||Ht==gt}function Bo(ot){return typeof ot=="number"&&ot>-1&&ot%1==0&&ot<=$}function rs(ot){var Ht=typeof ot;return ot!=null&&(Ht=="object"||Ht=="function")}function ja(ot){return ot!=null&&typeof ot=="object"}function ba(ot){if(!ja(ot)||Ue(ot)!=At)return!1;var Ht=Qt(ot);if(Ht===null)return!0;var Si=On.call(Ht,"constructor")&&Ht.constructor;return typeof Si=="function"&&Si instanceof Si&&_a.call(Si)==Fs}function Ys(ot){return typeof ot=="symbol"||ja(ot)&&Ue(ot)==It}var js=hl?_s(hl):rt;function po(ot){return ot==null?"":Ni(ot)}var wa=Ji(function(ot,Ht,Si,Sn){Vi(Ht,hc(Ht),ot,Sn)});function Ks(ot){return fl(ot)?Me(ot):Xt(ot)}function hc(ot){return fl(ot)?Me(ot,!0):pi(ot)}function ro(ot,Ht,Si){var Sn=r.imports._.templateSettings||r;Si&&Mn(ot,Ht,Si)&&(Ht=void 0),ot=po(ot),Ht=wa({},Ht,Sn,Yi);var qn=wa({},Ht.imports,Sn.imports,Yi),ys=Ks(qn),Qs=Dl(qn,ys),Er,en,ss=0,Ga=Ht.interpolate||Qi,ds="__p += '",mo=RegExp((Ht.escape||Qi).source+"|"+Ga.source+"|"+(Ga===N?hn:Qi).source+"|"+(Ht.evaluate||Qi).source+"|$","g"),ml=On.call(Ht,"sourceURL")?"//# sourceURL="+(Ht.sourceURL+"").replace(/[\r\n]/g," ")+`
`:"";ot.replace(mo,function(jo,so,Ha,Js,Gs,Vo){return Ha||(Ha=Js),ds+=ot.slice(ss,Vo).replace(Zr,xs),so&&(Er=!0,ds+=`' +
__e(`+so+`) +
'`),Gs&&(en=!0,ds+=`';
`+Gs+`;
__p += '`),Ha&&(ds+=`' +
((__t = (`+Ha+`)) == null ? '' : __t) +
'`),ss=Vo+jo.length,jo}),ds+=`';
`;var Ta=On.call(Ht,"variable")&&Ht.variable;Ta||(ds=`with (obj) {
`+ds+`
}
`),ds=(en?ds.replace(Rt,""):ds).replace(_i,"$1").replace(Oi,"$1;"),ds="function("+(Ta||"obj")+`) {
`+(Ta?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Er?", __e = _.escape":"")+(en?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ds+`return __p
}`;var Sa=pl(function(){return Function(ys,ml+"return "+ds).apply(void 0,Qs)});if(Sa.source=ds,Ol(Sa))throw Sa;return Sa}var pl=si(function(ot,Ht){try{return eo(ot,void 0,Ht)}catch(Si){return Ol(Si)?Si:new Error(Si)}});function Va(ot){return function(){return ot}}function Ua(ot){return ot}function _u(){return!1}S.exports=ro}).call(this)}).call(this,typeof hp<"u"?hp:typeof self<"u"?self:typeof window<"u"?window:{})},{"lodash._reinterpolate":9,"lodash.templatesettings":13}],13:[function(w,S,A){(function(L){(function(){var N=w("lodash._reinterpolate"),r="[object Symbol]",F=/[&<>"'`]/g,B=RegExp(F.source),$=/<%-([\s\S]+?)%>/g,ie=/<%([\s\S]+?)%>/g,re={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Te=typeof L=="object"&&L&&L.Object===Object&&L,_e=typeof self=="object"&&self&&self.Object===Object&&self,me=Te||_e||Function("return this")();function ge(Lt){return function(ct){return Lt?.[ct]}}var pe=ge(re),fe=Object.prototype,se=fe.toString,De=me.Symbol,we=De?De.prototype:void 0,ht=we?we.toString:void 0,At={escape:$,evaluate:ie,interpolate:N,variable:"",imports:{_:{escape:It}}};function gt(Lt){if(typeof Lt=="string")return Lt;if(je(Lt))return ht?ht.call(Lt):"";var ct=Lt+"";return ct=="0"&&1/Lt==-1/0?"-0":ct}function Xe(Lt){return!!Lt&&typeof Lt=="object"}function je(Lt){return typeof Lt=="symbol"||Xe(Lt)&&se.call(Lt)==r}function $e(Lt){return Lt==null?"":gt(Lt)}function It(Lt){return Lt=$e(Lt),Lt&&B.test(Lt)?Lt.replace(F,pe):Lt}S.exports=At}).call(this)}).call(this,typeof hp<"u"?hp:typeof self<"u"?self:typeof window<"u"?window:{})},{"lodash._reinterpolate":9}],14:[function(w,S,A){const L=w("is-plain-obj"),{hasOwnProperty:N}=Object.prototype,{propertyIsEnumerable:r}=Object,F=(fe,se,De)=>Object.defineProperty(fe,se,{value:De,writable:!0,enumerable:!0,configurable:!0}),B=this,$={concatArrays:!1,ignoreUndefined:!1},ie=fe=>{const se=[];for(const De in fe)N.call(fe,De)&&se.push(De);if(Object.getOwnPropertySymbols){const De=Object.getOwnPropertySymbols(fe);for(const we of De)r.call(fe,we)&&se.push(we)}return se};function re(fe){return Array.isArray(fe)?Te(fe):L(fe)?_e(fe):fe}function Te(fe){const se=fe.slice(0,0);return ie(fe).forEach(De=>{F(se,De,re(fe[De]))}),se}function _e(fe){const se=Object.getPrototypeOf(fe)===null?Object.create(null):{};return ie(fe).forEach(De=>{F(se,De,re(fe[De]))}),se}const me=(fe,se,De,we)=>(De.forEach(ht=>{typeof se[ht]>"u"&&we.ignoreUndefined||(ht in fe&&fe[ht]!==Object.getPrototypeOf(fe)?F(fe,ht,pe(fe[ht],se[ht],we)):F(fe,ht,re(se[ht])))}),fe),ge=(fe,se,De)=>{let we=fe.slice(0,0),ht=0;return[fe,se].forEach(At=>{const gt=[];for(let Xe=0;Xe<At.length;Xe++)N.call(At,Xe)&&(gt.push(String(Xe)),At===fe?F(we,ht++,At[Xe]):F(we,ht++,re(At[Xe])));we=me(we,At,ie(At).filter(Xe=>!gt.includes(Xe)),De)}),we};function pe(fe,se,De){return De.concatArrays&&Array.isArray(fe)&&Array.isArray(se)?ge(fe,se,De):!L(se)||!L(fe)?re(se):me(fe,se,ie(se),De)}S.exports=function(...fe){const se=pe(re($),this!==B&&this||{},$);let De={_:{}};for(const we of fe)if(we!==void 0){if(!L(we))throw new TypeError("`"+we+"` is not an Option Object");De=pe(De,{_:we},se)}return De._}},{"is-plain-obj":15}],15:[function(w,S,A){S.exports=L=>{if(Object.prototype.toString.call(L)!=="[object Object]")return!1;const N=Object.getPrototypeOf(L);return N===null||N===Object.prototype}},{}],16:[function(w,S,A){var L=S.exports={},N,r;function F(){throw new Error("setTimeout has not been defined")}function B(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?N=setTimeout:N=F}catch{N=F}try{typeof clearTimeout=="function"?r=clearTimeout:r=B}catch{r=B}})();function $(De){if(N===setTimeout)return setTimeout(De,0);if((N===F||!N)&&setTimeout)return N=setTimeout,setTimeout(De,0);try{return N(De,0)}catch{try{return N.call(null,De,0)}catch{return N.call(this,De,0)}}}function ie(De){if(r===clearTimeout)return clearTimeout(De);if((r===B||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(De);try{return r(De)}catch{try{return r.call(null,De)}catch{return r.call(this,De)}}}var re=[],Te=!1,_e,me=-1;function ge(){!Te||!_e||(Te=!1,_e.length?re=_e.concat(re):me=-1,re.length&&pe())}function pe(){if(!Te){var De=$(ge);Te=!0;for(var we=re.length;we;){for(_e=re,re=[];++me<we;)_e&&_e[me].run();me=-1,we=re.length}_e=null,Te=!1,ie(De)}}L.nextTick=function(De){var we=new Array(arguments.length-1);if(arguments.length>1)for(var ht=1;ht<arguments.length;ht++)we[ht-1]=arguments[ht];re.push(new fe(De,we)),re.length===1&&!Te&&$(pe)};function fe(De,we){this.fun=De,this.array=we}fe.prototype.run=function(){this.fun.apply(null,this.array)},L.title="browser",L.browser=!0,L.env={},L.argv=[],L.version="",L.versions={};function se(){}L.on=se,L.addListener=se,L.once=se,L.off=se,L.removeListener=se,L.removeAllListeners=se,L.emit=se,L.prependListener=se,L.prependOnceListener=se,L.listeners=function(De){return[]},L.binding=function(De){throw new Error("process.binding is not supported")},L.cwd=function(){return"/"},L.chdir=function(De){throw new Error("process.chdir is not supported")},L.umask=function(){return 0}},{}],17:[function(w,S,A){Object.defineProperty(A,"__esModule",{value:!0}),A.default=void 0;function L(F){var B=function(ie){var re=ie.dispatch,Te=ie.getState;return function(_e){return function(me){return typeof me=="function"?me(re,Te,F):_e(me)}}};return B}var N=L();N.withExtraArgument=L;var r=N;A.default=r},{}],18:[function(w,S,A){(function(L){(function(){Object.defineProperty(A,"__esModule",{value:!0});var N=w("@babel/runtime/helpers/objectSpread2");function r(ct){return ct&&typeof ct=="object"&&"default"in ct?ct:{default:ct}}var F=r(N);function B(ct){return"Minified Redux error #"+ct+"; visit https://redux.js.org/Errors?code="+ct+" for the full message or use the non-minified dev environment for full errors. "}var $=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),ie=function(){return Math.random().toString(36).substring(7).split("").join(".")},re={INIT:"@@redux/INIT"+ie(),REPLACE:"@@redux/REPLACE"+ie(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+ie()}};function Te(ct){if(typeof ct!="object"||ct===null)return!1;for(var Et=ct;Object.getPrototypeOf(Et)!==null;)Et=Object.getPrototypeOf(Et);return Object.getPrototypeOf(ct)===Et}function _e(ct){if(ct===void 0)return"undefined";if(ct===null)return"null";var Et=typeof ct;switch(Et){case"boolean":case"string":case"number":case"symbol":case"function":return Et}if(Array.isArray(ct))return"array";if(pe(ct))return"date";if(ge(ct))return"error";var Qe=me(ct);switch(Qe){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return Qe}return Et.slice(8,-1).toLowerCase().replace(/\s/g,"")}function me(ct){return typeof ct.constructor=="function"?ct.constructor.name:null}function ge(ct){return ct instanceof Error||typeof ct.message=="string"&&ct.constructor&&typeof ct.constructor.stackTraceLimit=="number"}function pe(ct){return ct instanceof Date?!0:typeof ct.toDateString=="function"&&typeof ct.getDate=="function"&&typeof ct.setDate=="function"}function fe(ct){var Et=typeof ct;return L.env.NODE_ENV!=="production"&&(Et=_e(ct)),Et}function se(ct,Et,Qe){var kt;if(typeof Et=="function"&&typeof Qe=="function"||typeof Qe=="function"&&typeof arguments[3]=="function")throw new Error(L.env.NODE_ENV==="production"?B(0):"It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.");if(typeof Et=="function"&&typeof Qe>"u"&&(Qe=Et,Et=void 0),typeof Qe<"u"){if(typeof Qe!="function")throw new Error(L.env.NODE_ENV==="production"?B(1):"Expected the enhancer to be a function. Instead, received: '"+fe(Qe)+"'");return Qe(se)(ct,Et)}if(typeof ct!="function")throw new Error(L.env.NODE_ENV==="production"?B(2):"Expected the root reducer to be a function. Instead, received: '"+fe(ct)+"'");var ii=ct,Li=Et,Ve=[],Dt=Ve,ti=!1;function li(){Dt===Ve&&(Dt=Ve.slice())}function Mi(){if(ti)throw new Error(L.env.NODE_ENV==="production"?B(3):"You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return Li}function at(ei){if(typeof ei!="function")throw new Error(L.env.NODE_ENV==="production"?B(4):"Expected the listener to be a function. Instead, received: '"+fe(ei)+"'");if(ti)throw new Error(L.env.NODE_ENV==="production"?B(5):"You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api/store#subscribelistener for more details.");var hn=!0;return li(),Dt.push(ei),function(){if(hn){if(ti)throw new Error(L.env.NODE_ENV==="production"?B(6):"You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api/store#subscribelistener for more details.");hn=!1,li();var Rn=Dt.indexOf(ei);Dt.splice(Rn,1),Ve=null}}}function Rt(ei){if(!Te(ei))throw new Error(L.env.NODE_ENV==="production"?B(7):"Actions must be plain objects. Instead, the actual type was: '"+fe(ei)+"'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.");if(typeof ei.type>"u")throw new Error(L.env.NODE_ENV==="production"?B(8):'Actions may not have an undefined "type" property. You may have misspelled an action type string constant.');if(ti)throw new Error(L.env.NODE_ENV==="production"?B(9):"Reducers may not dispatch actions.");try{ti=!0,Li=ii(Li,ei)}finally{ti=!1}for(var hn=Ve=Dt,In=0;In<hn.length;In++){var Rn=hn[In];Rn()}return ei}function _i(ei){if(typeof ei!="function")throw new Error(L.env.NODE_ENV==="production"?B(10):"Expected the nextReducer to be a function. Instead, received: '"+fe(ei));ii=ei,Rt({type:re.REPLACE})}function Oi(){var ei,hn=at;return ei={subscribe:function(Rn){if(typeof Rn!="object"||Rn===null)throw new Error(L.env.NODE_ENV==="production"?B(11):"Expected the observer to be an object. Instead, received: '"+fe(Rn)+"'");function Qi(){Rn.next&&Rn.next(Mi())}Qi();var Zr=hn(Qi);return{unsubscribe:Zr}}},ei[$]=function(){return this},ei}return Rt({type:re.INIT}),kt={dispatch:Rt,subscribe:at,getState:Mi,replaceReducer:_i},kt[$]=Oi,kt}var De=se;function we(ct){typeof console<"u"&&typeof console.error=="function"&&console.error(ct);try{throw new Error(ct)}catch{}}function ht(ct,Et,Qe,kt){var ii=Object.keys(Et),Li=Qe&&Qe.type===re.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(ii.length===0)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!Te(ct))return"The "+Li+' has unexpected type of "'+fe(ct)+'". Expected argument to be an object with the following '+('keys: "'+ii.join('", "')+'"');var Ve=Object.keys(ct).filter(function(Dt){return!Et.hasOwnProperty(Dt)&&!kt[Dt]});if(Ve.forEach(function(Dt){kt[Dt]=!0}),!(Qe&&Qe.type===re.REPLACE)&&Ve.length>0)return"Unexpected "+(Ve.length>1?"keys":"key")+" "+('"'+Ve.join('", "')+'" found in '+Li+". ")+"Expected to find one of the known reducer keys instead: "+('"'+ii.join('", "')+'". Unexpected keys will be ignored.')}function At(ct){Object.keys(ct).forEach(function(Et){var Qe=ct[Et],kt=Qe(void 0,{type:re.INIT});if(typeof kt>"u")throw new Error(L.env.NODE_ENV==="production"?B(12):'The slice reducer for key "'+Et+`" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.`);if(typeof Qe(void 0,{type:re.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(L.env.NODE_ENV==="production"?B(13):'The slice reducer for key "'+Et+'" returned undefined when probed with a random type. '+("Don't try to handle '"+re.INIT+`' or other actions in "redux/*" `)+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.")})}function gt(ct){for(var Et=Object.keys(ct),Qe={},kt=0;kt<Et.length;kt++){var ii=Et[kt];L.env.NODE_ENV!=="production"&&typeof ct[ii]>"u"&&we('No reducer provided for key "'+ii+'"'),typeof ct[ii]=="function"&&(Qe[ii]=ct[ii])}var Li=Object.keys(Qe),Ve;L.env.NODE_ENV!=="production"&&(Ve={});var Dt;try{At(Qe)}catch(ti){Dt=ti}return function(li,Mi){if(li===void 0&&(li={}),Dt)throw Dt;if(L.env.NODE_ENV!=="production"){var at=ht(li,Qe,Mi,Ve);at&&we(at)}for(var Rt=!1,_i={},Oi=0;Oi<Li.length;Oi++){var ei=Li[Oi],hn=Qe[ei],In=li[ei],Rn=hn(In,Mi);if(typeof Rn>"u"){var Qi=Mi&&Mi.type;throw new Error(L.env.NODE_ENV==="production"?B(14):"When called with an action of type "+(Qi?'"'+String(Qi)+'"':"(unknown type)")+', the slice reducer for key "'+ei+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.')}_i[ei]=Rn,Rt=Rt||Rn!==In}return Rt=Rt||Li.length!==Object.keys(li).length,Rt?_i:li}}function Xe(ct,Et){return function(){return Et(ct.apply(this,arguments))}}function je(ct,Et){if(typeof ct=="function")return Xe(ct,Et);if(typeof ct!="object"||ct===null)throw new Error(L.env.NODE_ENV==="production"?B(16):"bindActionCreators expected an object or a function, but instead received: '"+fe(ct)+`'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?`);var Qe={};for(var kt in ct){var ii=ct[kt];typeof ii=="function"&&(Qe[kt]=Xe(ii,Et))}return Qe}function $e(){for(var ct=arguments.length,Et=new Array(ct),Qe=0;Qe<ct;Qe++)Et[Qe]=arguments[Qe];return Et.length===0?function(kt){return kt}:Et.length===1?Et[0]:Et.reduce(function(kt,ii){return function(){return kt(ii.apply(void 0,arguments))}})}function It(){for(var ct=arguments.length,Et=new Array(ct),Qe=0;Qe<ct;Qe++)Et[Qe]=arguments[Qe];return function(kt){return function(){var ii=kt.apply(void 0,arguments),Li=function(){throw new Error(L.env.NODE_ENV==="production"?B(15):"Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},Ve={getState:ii.getState,dispatch:function(){return Li.apply(void 0,arguments)}},Dt=Et.map(function(ti){return ti(Ve)});return Li=$e.apply(void 0,Dt)(ii.dispatch),F.default(F.default({},ii),{},{dispatch:Li})}}}function Lt(){}L.env.NODE_ENV!=="production"&&typeof Lt.name=="string"&&Lt.name!=="isCrushed"&&we('You are currently using minified code outside of NODE_ENV === "production". This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) to ensure you have the correct code for your production build.'),A.__DO_NOT_USE__ActionTypes=re,A.applyMiddleware=It,A.bindActionCreators=je,A.combineReducers=gt,A.compose=$e,A.createStore=se,A.legacy_createStore=De}).call(this)}).call(this,w("_process"))},{"@babel/runtime/helpers/objectSpread2":2,_process:16}],19:[function(w,S,A){var L=w("./src/suggestions");S.exports=L,typeof window<"u"&&(window.Suggestions=L)},{"./src/suggestions":21}],20:[function(w,S,A){var L=function(N){return this.component=N,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,N.el.parentNode.insertBefore(this.wrapper,N.el.nextSibling),this};L.prototype.show=function(){this.element.style.display="block"},L.prototype.hide=function(){this.element.style.display="none"},L.prototype.add=function(N){this.items.push(N)},L.prototype.clear=function(){this.items=[],this.active=0},L.prototype.isEmpty=function(){return!this.items.length},L.prototype.isVisible=function(){return this.element.style.display==="block"},L.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var N=0;N<this.items.length;N++)this.drawItem(this.items[N],this.active===N);this.show()},L.prototype.drawItem=function(N,r){var F=document.createElement("li"),B=document.createElement("a");r&&(F.className+=" active"),B.innerHTML=N.string,F.appendChild(B),this.element.appendChild(F),F.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),F.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,N)}).bind(this))},L.prototype.handleMouseUp=function(N){this.selectingListItem=!1,this.component.value(N.original),this.clear(),this.draw()},L.prototype.move=function(N){this.active=N,this.draw()},L.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)},L.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},L.prototype.drawError=function(N){var r=document.createElement("li");r.innerHTML=N,this.element.appendChild(r),this.show()},S.exports=L},{}],21:[function(w,S,A){var L=w("xtend"),N=w("fuzzy"),r=w("./list"),F=function(B,$,ie){return ie=ie||{},this.options=L({minLength:2,limit:5,filter:!0,hideOnBlur:!0},ie),this.el=B,this.data=$||[],this.list=new r(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(re){this.handleKeyUp(re.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(re){this.handleKeyDown(re)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(re){this.handlePaste(re)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};F.prototype.handleKeyUp=function(B){B===40||B===38||B===27||B===13||B===9||this.handleInputChange(this.el.value)},F.prototype.handleKeyDown=function(B){switch(B.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&B.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},F.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},F.prototype.handlePaste=function(B){if(B.clipboardData)this.handleInputChange(B.clipboardData.getData("Text"));else{var $=this;setTimeout(function(){$.handleInputChange(B.target.value)},100)}},F.prototype.handleInputChange=function(B){if(this.query=this.normalize(B),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function($){for(var ie=0;ie<$.length&&(this.list.add($[ie]),ie!==this.options.limit-1);ie++);this.list.draw()}).bind(this))},F.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},F.prototype.update=function(B){this.data=B,this.handleKeyUp()},F.prototype.clear=function(){this.data=[],this.list.clear()},F.prototype.normalize=function(B){return B=B.toLowerCase(),B},F.prototype.match=function(B,$){return B.indexOf($)>-1},F.prototype.value=function(B){if(this.selected=B,this.el.value=this.getItemValue(B),document.createEvent){var $=document.createEvent("HTMLEvents");$.initEvent("change",!0,!1),this.el.dispatchEvent($)}else this.el.fireEvent("onchange")},F.prototype.getCandidates=function(B){var $={pre:"<strong>",post:"</strong>",extract:(function(re){return this.getItemValue(re)}).bind(this)},ie;this.options.filter?(ie=N.filter(this.query,this.data,$),ie=ie.map((function(re){return{original:re.original,string:this.render(re.original,re.string)}}).bind(this))):ie=this.data.map((function(re){var Te=this.render(re);return{original:re,string:Te}}).bind(this)),B(ie)},F.prototype.getItemValue=function(B){return B},F.prototype.render=function(B,$){if($)return $;for(var ie=B.original?this.getItemValue(B.original):this.getItemValue(B),re=this.normalize(ie),Te=re.lastIndexOf(this.query);Te>-1;){var _e=Te+this.query.length;ie=ie.slice(0,Te)+"<strong>"+ie.slice(Te,_e)+"</strong>"+ie.slice(_e),Te=re.slice(0,Te).lastIndexOf(this.query)}return ie},F.prototype.renderError=function(B){this.list.drawError(B)},S.exports=F},{"./list":20,fuzzy:8,xtend:24}],22:[function(w,S,A){var L=w("turf-meta").coordEach;S.exports=function(N){var r=[1/0,1/0,-1/0,-1/0];return L(N,function(F){r[0]>F[0]&&(r[0]=F[0]),r[1]>F[1]&&(r[1]=F[1]),r[2]<F[0]&&(r[2]=F[0]),r[3]<F[1]&&(r[3]=F[1])}),r}},{"turf-meta":23}],23:[function(w,S,A){function L(B,$,ie){var re,Te,_e,me,ge,pe,fe,se,De=0,we,ht=B.type==="FeatureCollection",At=B.type==="Feature",gt=ht?B.features.length:1;for(re=0;re<gt;re++)for(se=ht?B.features[re].geometry:At?B.geometry:B,we=se.type==="GeometryCollection",pe=we?se.geometries.length:1,me=0;me<pe;me++)if(ge=we?se.geometries[me]:se,fe=ge.coordinates,De=ie&&(ge.type==="Polygon"||ge.type==="MultiPolygon")?1:0,ge.type==="Point")$(fe);else if(ge.type==="LineString"||ge.type==="MultiPoint")for(Te=0;Te<fe.length;Te++)$(fe[Te]);else if(ge.type==="Polygon"||ge.type==="MultiLineString")for(Te=0;Te<fe.length;Te++)for(_e=0;_e<fe[Te].length-De;_e++)$(fe[Te][_e]);else if(ge.type==="MultiPolygon")for(Te=0;Te<fe.length;Te++)for(_e=0;_e<fe[Te].length;_e++)for(l=0;l<fe[Te][_e].length-De;l++)$(fe[Te][_e][l]);else throw new Error("Unknown Geometry Type")}S.exports.coordEach=L;function N(B,$,ie,re){return L(B,function(Te){ie=$(ie,Te)},re),ie}S.exports.coordReduce=N;function r(B,$){var ie;switch(B.type){case"FeatureCollection":for(features=B.features,ie=0;ie<B.features.length;ie++)$(B.features[ie].properties);break;case"Feature":$(B.properties);break}}S.exports.propEach=r;function F(B,$,ie){return r(B,function(re){ie=$(ie,re)}),ie}S.exports.propReduce=F},{}],24:[function(w,S,A){S.exports=N;var L=Object.prototype.hasOwnProperty;function N(){for(var r={},F=0;F<arguments.length;F++){var B=arguments[F];for(var $ in B)L.call(B,$)&&(r[$]=B[$])}return r}},{}],25:[function(w,S,A){function L(at){"@babel/helpers - typeof";return L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Rt){return typeof Rt}:function(Rt){return Rt&&typeof Symbol=="function"&&Rt.constructor===Symbol&&Rt!==Symbol.prototype?"symbol":typeof Rt},L(at)}Object.defineProperty(A,"__esModule",{value:!0}),A.addWaypoint=Ve,A.clearDestination=je,A.clearOrigin=Xe,A.createDestination=Et,A.createOrigin=ct,A.eventEmit=Mi,A.eventSubscribe=li,A.hoverMarker=It,A.queryDestination=ht,A.queryDestinationCoordinates=gt,A.queryOrigin=we,A.queryOriginCoordinates=At,A.removeWaypoint=ti,A.reverse=kt,A.setDestinationFromCoordinates=Li,A.setOptions=$e,A.setOriginFromCoordinates=ii,A.setProfile=Qe,A.setRouteIndex=Lt,A.setWaypoint=Dt;var N=$(w("../constants/action_types")),r=F(w("../utils"));function F(at){return at&&at.__esModule?at:{default:at}}function B(at){if(typeof WeakMap!="function")return null;var Rt=new WeakMap,_i=new WeakMap;return(B=function(ei){return ei?_i:Rt})(at)}function $(at,Rt){if(at&&at.__esModule)return at;if(at===null||L(at)!=="object"&&typeof at!="function")return{default:at};var _i=B(Rt);if(_i&&_i.has(at))return _i.get(at);var Oi={},ei=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var hn in at)if(hn!=="default"&&Object.prototype.hasOwnProperty.call(at,hn)){var In=ei?Object.getOwnPropertyDescriptor(at,hn):null;In&&(In.get||In.set)?Object.defineProperty(Oi,hn,In):Oi[hn]=at[hn]}return Oi.default=at,_i&&_i.set(at,Oi),Oi}function ie(at){return function(Rt){var _i=r.default.createPoint(at,{id:"origin","marker-symbol":"A"});Rt({type:N.ORIGIN,origin:_i}),Rt(Mi("origin",{feature:_i}))}}function re(at){return function(Rt){var _i=r.default.createPoint(at,{id:"destination","marker-symbol":"B"});Rt({type:N.DESTINATION,destination:_i}),Rt(Mi("destination",{feature:_i}))}}function Te(at){return function(Rt){Rt({type:N.DIRECTIONS_REQUEST_START,request:at})}}function _e(at){return function(Rt){Rt({type:N.DIRECTIONS,directions:at}),Rt(Mi("route",{route:at}))}}function me(at){return{type:N.WAYPOINTS,waypoints:at}}function ge(at){return{type:N.HOVER_MARKER,hoverMarker:at}}function pe(){return function(at,Rt){var _i=Rt(),Oi=_i.api,ei=_i.accessToken,hn=_i.routeIndex,In=_i.profile,Rn=_i.alternatives,Qi=_i.congestion,Zr=_i.destination,Fn=_i.language,Qr=_i.exclude,gs=_i.fetchDirectionsRequest;if(Zr&&Zr.geometry){gs&&gs.abort();var No=fe(Rt),Or=[];Or.push("geometries=polyline"),Rn&&Or.push("alternatives=true"),Qi&&Or.push("annotations=congestion"),Or.push("steps=true"),Or.push("overview=full"),Fn&&Or.push("language="+Fn),Qr&&Or.push("exclude="+Qr),ei&&Or.push("access_token="+ei);var Nr=new XMLHttpRequest;Nr.open("GET","".concat(Oi).concat(In,"/").concat(No,".json?").concat(Or.join("&")),!0),at(Te(Nr)),Nr.onload=function(){if(Nr.status>=200&&Nr.status<400){var Jr=JSON.parse(Nr.responseText);if(Jr.error)return at(_e([])),at(De(Jr.error));if(Jr.message==="No route found")return at(De("No route found"));at(De(null)),Jr.routes[hn]||at(Lt(0)),at(_e(Jr.routes)),at(ie(Jr.waypoints[0].location)),at(re(Jr.waypoints[Jr.waypoints.length-1].location))}else return at(_e([])),at(De(JSON.parse(Nr.responseText).message))},Nr.onerror=function(){return at(_e([])),Nr.responseText?at(De(JSON.parse(Nr.responseText).message)):at(De("Error"))},Nr.send()}}}function fe(at){var Rt=at(),_i=Rt.origin,Oi=Rt.destination,ei=Rt.waypoints,hn=[];return hn.push(_i.geometry.coordinates.join(",")),hn.push(";"),ei.length&&ei.forEach(function(In){hn.push(In.geometry.coordinates.join(",")),hn.push(";")}),hn.push(Oi.geometry.coordinates.join(",")),encodeURIComponent(hn.join(""))}function se(at){var Rt={id:"waypoint"};return Object.assign(at,{properties:at.properties?Object.assign(at.properties,Rt):Rt})}function De(at){return function(Rt){Rt({type:"ERROR",error:at}),at&&Rt(Mi("error",{error:at}))}}function we(at){return{type:N.ORIGIN_QUERY,query:at}}function ht(at){return{type:N.DESTINATION_QUERY,query:at}}function At(at){return{type:N.ORIGIN_FROM_COORDINATES,coordinates:at}}function gt(at){return{type:N.DESTINATION_FROM_COORDINATES,coordinates:at}}function Xe(){return function(at){at({type:N.ORIGIN_CLEAR}),at(Mi("clear",{type:"origin"})),at(De(null))}}function je(){return function(at,Rt){var _i=Rt(),Oi=_i.fetchDirectionsRequest;Oi&&Oi.abort(),at({type:N.DESTINATION_CLEAR}),at(Mi("clear",{type:"destination"})),at(De(null))}}function $e(at){return{type:N.SET_OPTIONS,options:at}}function It(at){return function(Rt){var _i=at?r.default.createPoint(at,{id:"hover"}):{};Rt(ge(_i))}}function Lt(at){return{type:N.ROUTE_INDEX,routeIndex:at}}function ct(at){return function(Rt,_i){var Oi=_i(),ei=Oi.destination;Rt(ie(at)),ei.geometry&&Rt(pe())}}function Et(at){return function(Rt,_i){var Oi=_i(),ei=Oi.origin;Rt(re(at)),ei.geometry&&Rt(pe())}}function Qe(at){return function(Rt,_i){var Oi=_i(),ei=Oi.origin,hn=Oi.destination;Rt({type:N.DIRECTIONS_PROFILE,profile:at}),Rt(Mi("profile",{profile:at})),ei.geometry&&hn.geometry&&Rt(pe())}}function kt(){return function(at,Rt){var _i=Rt();_i.destination.geometry&&at(ie(_i.destination.geometry.coordinates)),_i.origin.geometry&&at(re(_i.origin.geometry.coordinates)),_i.origin.geometry&&_i.destination.geometry&&at(pe());for(var Oi=document.getElementsByClassName("suggestions"),ei=0;ei<Oi.length;ei++)Oi[ei].style.visibility="hidden"}}function ii(at){return function(Rt){if(r.default.validCoords(at)||(at=[r.default.wrap(at[0]),r.default.wrap(at[1])]),isNaN(at[0])&&isNaN(at[1]))return Rt(De(new Error("Coordinates are not valid")));Rt(At(at)),Rt(ct(at))}}function Li(at){return function(Rt){if(r.default.validCoords(at)||(at=[r.default.wrap(at[0]),r.default.wrap(at[1])]),isNaN(at[0])&&isNaN(at[1]))return Rt(De(new Error("Coordinates are not valid")));Rt(Et(at)),Rt(gt(at))}}function Ve(at,Rt){return function(_i,Oi){var ei=Oi(),hn=ei.destination,In=ei.waypoints;In.splice(at,0,se(Rt)),_i(me(In)),hn.geometry&&_i(pe())}}function Dt(at,Rt){return function(_i,Oi){var ei=Oi(),hn=ei.destination,In=ei.waypoints;In[at]=se(Rt),_i(me(In)),hn.geometry&&_i(pe())}}function ti(at){return function(Rt,_i){var Oi=_i(),ei=Oi.destination,hn=Oi.waypoints;hn=hn.filter(function(In){return!r.default.coordinateMatch(In,at)}),Rt(me(hn)),ei.geometry&&Rt(pe())}}function li(at,Rt){return function(_i,Oi){var ei=Oi(),hn=ei.events;return hn[at]=hn[at]||[],hn[at].push(Rt),{type:N.EVENTS,events:hn}}}function Mi(at,Rt){var _i=this;return function(Oi,ei){var hn=ei(),In=hn.events;if(!In[at])return{type:N.EVENTS,events:In};for(var Rn=In[at].slice(),Qi=0;Qi<Rn.length;Qi++)Rn[Qi].call(_i,Rt)}}},{"../constants/action_types":26,"../utils":34}],26:[function(w,S,A){Object.defineProperty(A,"__esModule",{value:!0}),A.WAYPOINTS=A.SET_OPTIONS=A.ROUTE_INDEX=A.ORIGIN_QUERY=A.ORIGIN_FROM_COORDINATES=A.ORIGIN_CLEAR=A.ORIGIN=A.HOVER_MARKER=A.EVENTS=A.ERROR=A.DIRECTIONS_REQUEST_START=A.DIRECTIONS_PROFILE=A.DIRECTIONS=A.DESTINATION_QUERY=A.DESTINATION_FROM_COORDINATES=A.DESTINATION_CLEAR=A.DESTINATION=void 0;var L="DESTINATION";A.DESTINATION=L;var N="DESTINATION_CLEAR";A.DESTINATION_CLEAR=N;var r="DESTINATION_QUERY";A.DESTINATION_QUERY=r;var F="DESTINATION_FROM_COORDINATES";A.DESTINATION_FROM_COORDINATES=F;var B="DIRECTIONS";A.DIRECTIONS=B;var $="DIRECTIONS_REQUEST_START";A.DIRECTIONS_REQUEST_START=$;var ie="DIRECTIONS_PROFILE";A.DIRECTIONS_PROFILE=ie;var re="EVENTS";A.EVENTS=re;var Te="ERROR";A.ERROR=Te;var _e="HOVER_MARKER";A.HOVER_MARKER=_e;var me="ORIGIN";A.ORIGIN=me;var ge="ORIGIN_CLEAR";A.ORIGIN_CLEAR=ge;var pe="ORIGIN_QUERY";A.ORIGIN_QUERY=pe;var fe="ORIGIN_FROM_COORDINATES";A.ORIGIN_FROM_COORDINATES=fe;var se="ROUTE_INDEX";A.ROUTE_INDEX=se;var De="SET_OPTIONS";A.SET_OPTIONS=De;var we="WAYPOINTS";A.WAYPOINTS=we},{}],27:[function(w,S,A){Object.defineProperty(A,"__esModule",{value:!0}),A.default=void 0;var L=B(w("suggestions")),N=B(w("lodash.debounce")),r=w("events"),F=B(w("../utils"));function B(pe){return pe&&pe.__esModule?pe:{default:pe}}function $(pe){"@babel/helpers - typeof";return $=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(fe){return typeof fe}:function(fe){return fe&&typeof Symbol=="function"&&fe.constructor===Symbol&&fe!==Symbol.prototype?"symbol":typeof fe},$(pe)}function ie(pe,fe){if(!(pe instanceof fe))throw new TypeError("Cannot call a class as a function")}function re(pe,fe){for(var se=0;se<fe.length;se++){var De=fe[se];De.enumerable=De.enumerable||!1,De.configurable=!0,"value"in De&&(De.writable=!0),Object.defineProperty(pe,_e(De.key),De)}}function Te(pe,fe,se){return fe&&re(pe.prototype,fe),Object.defineProperty(pe,"prototype",{writable:!1}),pe}function _e(pe){var fe=me(pe,"string");return $(fe)==="symbol"?fe:String(fe)}function me(pe,fe){if($(pe)!=="object"||pe===null)return pe;var se=pe[Symbol.toPrimitive];if(se!==void 0){var De=se.call(pe,fe);if($(De)!=="object")return De;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(pe)}var ge=function(){function pe(fe){ie(this,pe),this._ev=new r.EventEmitter,this.options=fe,this.api=fe&&fe.api||"https://api.mapbox.com/geocoding/v5/mapbox.places/"}return Te(pe,[{key:"onAdd",value:function(se){this._map=se,this.request=new XMLHttpRequest;var De=document.createElement("div");De.className="mapboxgl-ctrl-geocoder";var we=document.createElement("span");we.className="geocoder-icon geocoder-icon-search";var ht=this._inputEl=document.createElement("input");ht.type="text",ht.placeholder=this.options.placeholder,ht.addEventListener("keydown",(0,N.default)((function(je){if(!je.target.value)return this._clearEl.classList.remove("active");je.metaKey||[9,27,37,39,13,38,40].indexOf(je.keyCode)!==-1||this._queryFromInput(je.target.value)}).bind(this)),200),ht.addEventListener("change",(function(je){je.target.value&&this._clearEl.classList.add("active");var $e=this._typeahead.selected;if($e){if(this.options.flyTo)if($e.bbox&&$e.context&&$e.context.length<=3||$e.bbox&&!$e.context){var It=$e.bbox;se.fitBounds([[It[0],It[1]],[It[2],It[3]]])}else se.flyTo({center:$e.center,zoom:this.options.zoom});this._input=$e,this.fire("result",{result:$e})}}).bind(this));var At=document.createElement("div");At.classList.add("geocoder-pin-right");var gt=this._clearEl=document.createElement("button");gt.className="geocoder-icon geocoder-icon-close",gt.addEventListener("click",this._clear.bind(this));var Xe=this._loadingEl=document.createElement("span");return Xe.className="geocoder-icon geocoder-icon-loading",At.appendChild(gt),At.appendChild(Xe),De.appendChild(we),De.appendChild(ht),De.appendChild(At),this.options.container&&(this.options.position=!1),this._typeahead=new L.default(ht,[],{filter:!1}),this._typeahead.getItemValue=function(je){return je.place_name},De}},{key:"_geocode",value:function(se,De){this._loadingEl.classList.add("active"),this.fire("loading");var we=this.options,ht=["placeholder","zoom","flyTo","accessToken","api"],At=Object.keys(this.options).filter(function(Xe){return ht.indexOf(Xe)===-1}).map(function(Xe){return Xe+"="+we[Xe]}),gt=this.options.accessToken?this.options.accessToken:mapboxgl.accessToken;At.push("access_token="+gt),this.request.abort(),this.request.open("GET",this.api+encodeURIComponent(se.trim())+".json?"+At.join("&"),!0),this.request.onload=(function(){if(this._loadingEl.classList.remove("active"),this.request.status>=200&&this.request.status<400){var Xe=JSON.parse(this.request.responseText);return Xe.features.length?this._clearEl.classList.add("active"):(this._clearEl.classList.remove("active"),this._typeahead.selected=null),this.fire("results",{results:Xe.features}),this._typeahead.update(Xe.features),De(Xe.features)}else this.fire("error",{error:JSON.parse(this.request.responseText).message})}).bind(this),this.request.onerror=(function(){this._loadingEl.classList.remove("active"),this.fire("error",{error:JSON.parse(this.request.responseText).message})}).bind(this),this.request.send()}},{key:"_queryFromInput",value:function(se){se=se.trim(),se||this._clear(),se.length>2&&this._geocode(se,(function(De){this._results=De}).bind(this))}},{key:"_change",value:function(){var se=document.createEvent("HTMLEvents");se.initEvent("change",!0,!1),this._inputEl.dispatchEvent(se)}},{key:"_query",value:function(se){se&&($(se)==="object"&&se.length&&(se=[F.default.wrap(se[0]),F.default.wrap(se[1])].join()),this._geocode(se,(function(De){if(De.length){var we=De[0];this._results=De,this._typeahead.selected=we,this._inputEl.value=we.place_name,this._change()}}).bind(this)))}},{key:"_setInput",value:function(se){se&&($(se)==="object"&&se.length&&(se=[F.default.roundWithOriginalPrecision(F.default.wrap(se[0]),se[0]),F.default.roundWithOriginalPrecision(F.default.wrap(se[1]),se[1])].join()),this._inputEl.value=se,this._input=null,this._typeahead.selected=null,this._typeahead.clear(),this._change())}},{key:"_clear",value:function(){this._input=null,this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._change(),this._inputEl.focus(),this._clearEl.classList.remove("active"),this.fire("clear")}},{key:"getResult",value:function(){return this._input}},{key:"query",value:function(se){return this._query(se),this}},{key:"setInput",value:function(se){return this._setInput(se),this}},{key:"on",value:function(se,De){return this._ev.on(se,De),this._ev.on("error",function(we){console.log(we)}),this}},{key:"fire",value:function(se,De){return this._ev.emit(se,De),this}},{key:"off",value:function(se,De){return this._ev.removeListener(se,De),this}}]),pe}();A.default=ge},{"../utils":34,events:7,"lodash.debounce":10,suggestions:19}],28:[function(w,S,A){Object.defineProperty(A,"__esModule",{value:!0}),A.default=void 0;var L=B(w("./geocoder")),N=B(w("lodash.template")),r=B(w("lodash.isequal")),F=B(w("turf-extent"));function B(fe){return fe&&fe.__esModule?fe:{default:fe}}function $(fe){"@babel/helpers - typeof";return $=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(se){return typeof se}:function(se){return se&&typeof Symbol=="function"&&se.constructor===Symbol&&se!==Symbol.prototype?"symbol":typeof se},$(fe)}function ie(fe,se){if(!(fe instanceof se))throw new TypeError("Cannot call a class as a function")}function re(fe,se){for(var De=0;De<se.length;De++){var we=se[De];we.enumerable=we.enumerable||!1,we.configurable=!0,"value"in we&&(we.writable=!0),Object.defineProperty(fe,_e(we.key),we)}}function Te(fe,se,De){return se&&re(fe.prototype,se),Object.defineProperty(fe,"prototype",{writable:!1}),fe}function _e(fe){var se=me(fe,"string");return $(se)==="symbol"?se:String(se)}function me(fe,se){if($(fe)!=="object"||fe===null)return fe;var De=fe[Symbol.toPrimitive];if(De!==void 0){var we=De.call(fe,se);if($(we)!=="object")return we;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(fe)}var ge=(0,N.default)(`<div class='mapbox-directions-component mapbox-directions-inputs'>
  <div class='mapbox-directions-component-keyline'>
    <div class='mapbox-directions-origin'>
      <label class='mapbox-form-label'>
        <span class='directions-icon directions-icon-depart'></span>
      </label>
      <div id='mapbox-directions-origin-input'></div>
    </div>

    <button
      class='directions-icon directions-icon-reverse directions-reverse js-reverse-inputs'
      title='Reverse origin &amp; destination'>
    </button>

    <div class='mapbox-directions-destination'>
      <label class='mapbox-form-label'>
        <span class='directions-icon directions-icon-arrive'></span>
      </label>
      <div id='mapbox-directions-destination-input'></div>
    </div>
  </div>

  <% if (controls.profileSwitcher) { %>
  <div class='mapbox-directions-profile mapbox-directions-component-keyline mapbox-directions-clearfix'><input
      id='mapbox-directions-profile-driving-traffic'
      type='radio'
      name='profile'
      value='mapbox/driving-traffic'
      <% if (profile === 'mapbox/driving-traffic') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-driving-traffic'>Traffic</label>
    <input
      id='mapbox-directions-profile-driving'
      type='radio'
      name='profile'
      value='mapbox/driving'
      <% if (profile === 'mapbox/driving') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-driving'>Driving</label>
    <input
      id='mapbox-directions-profile-walking'
      type='radio'
      name='profile'
      value='mapbox/walking'
      <% if (profile === 'mapbox/walking') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-walking'>Walking</label>
    <input
      id='mapbox-directions-profile-cycling'
      type='radio'
      name='profile'
      value='mapbox/cycling'
      <% if (profile === 'mapbox/cycling') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-cycling'>Cycling</label>
  </div>
  <% } %>
</div>
`),pe=function(){function fe(se,De,we,ht){ie(this,fe);var At=De.getState(),gt=At.originQuery,Xe=At.destinationQuery,je=At.profile,$e=At.controls;se.innerHTML=ge({originQuery:gt,destinationQuery:Xe,profile:je,controls:$e}),this.container=se,this.actions=we,this.store=De,this._map=ht,this.onAdd(),this.render()}return Te(fe,[{key:"animateToCoordinates",value:function(De,we){var ht=this.store.getState(),At=ht.origin,gt=ht.destination,Xe=ht.routePadding;if(At.geometry&&gt.geometry&&!(0,r.default)(At.geometry,gt.geometry)){var je=(0,F.default)({type:"FeatureCollection",features:[At,gt]});this._map.fitBounds([[je[0],je[1]],[je[2],je[3]]],{padding:Xe})}else this._map.flyTo({center:we})}},{key:"onAdd",value:function(){var De=this,we=this.actions,ht=we.clearOrigin,At=we.clearDestination,gt=we.createOrigin,Xe=we.createDestination,je=we.setProfile,$e=we.reverse,It=this.store.getState(),Lt=It.geocoder,ct=It.accessToken,Et=It.flyTo,Qe=It.placeholderOrigin,kt=It.placeholderDestination,ii=It.zoom;this.originInput=new L.default(Object.assign({},{accessToken:ct},Lt,{flyTo:Et,placeholder:Qe,zoom:ii}));var Li=this.originInput.onAdd(this._map),Ve=this.container.querySelector("#mapbox-directions-origin-input");Ve.appendChild(Li),this.destinationInput=new L.default(Object.assign({},{accessToken:ct},Lt,{flyTo:Et,placeholder:kt,zoom:ii}));var Dt=this.destinationInput.onAdd(this._map);this.container.querySelector("#mapbox-directions-destination-input").appendChild(Dt),this.originInput.on("result",function(li){var Mi=li.result.center;gt(Mi),De.animateToCoordinates("origin",Mi)}),this.originInput.on("clear",ht),this.destinationInput.on("result",function(li){var Mi=li.result.center;Xe(Mi),De.animateToCoordinates("destination",Mi)}),this.destinationInput.on("clear",At);var ti=this.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(ti,function(li){li.addEventListener("change",function(){je(li.value)})}),this.container.querySelector(".js-reverse-inputs").addEventListener("click",function(){var li=De.store.getState(),Mi=li.origin,at=li.destination;Mi&&De.actions.queryDestination(Mi.geometry.coordinates),at&&De.actions.queryOrigin(at.geometry.coordinates),$e()})}},{key:"render",value:function(){var De=this;this.store.subscribe(function(){var we=De.store.getState(),ht=we.originQuery,At=we.destinationQuery,gt=we.originQueryCoordinates,Xe=we.destinationQueryCoordinates;ht&&(De.originInput.query(ht),De.actions.queryOrigin(null)),At&&(De.destinationInput.query(At),De.actions.queryDestination(null)),gt&&(De.originInput.setInput(gt),De.animateToCoordinates("origin",gt),De.actions.queryOriginCoordinates(null)),Xe&&(De.destinationInput.setInput(Xe),De.animateToCoordinates("destination",Xe),De.actions.queryDestinationCoordinates(null))})}}]),fe}();A.default=pe},{"./geocoder":27,"lodash.isequal":11,"lodash.template":12,"turf-extent":22}],29:[function(w,S,A){Object.defineProperty(A,"__esModule",{value:!0}),A.default=void 0;var L=F(w("../utils")),N=F(w("lodash.template")),r=F(w("lodash.isequal"));function F(fe){return fe&&fe.__esModule?fe:{default:fe}}function B(fe){"@babel/helpers - typeof";return B=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(se){return typeof se}:function(se){return se&&typeof Symbol=="function"&&se.constructor===Symbol&&se!==Symbol.prototype?"symbol":typeof se},B(fe)}function $(fe,se){if(!(fe instanceof se))throw new TypeError("Cannot call a class as a function")}function ie(fe,se){for(var De=0;De<se.length;De++){var we=se[De];we.enumerable=we.enumerable||!1,we.configurable=!0,"value"in we&&(we.writable=!0),Object.defineProperty(fe,Te(we.key),we)}}function re(fe,se,De){return se&&ie(fe.prototype,se),Object.defineProperty(fe,"prototype",{writable:!1}),fe}function Te(fe){var se=_e(fe,"string");return B(se)==="symbol"?se:String(se)}function _e(fe,se){if(B(fe)!=="object"||fe===null)return fe;var De=fe[Symbol.toPrimitive];if(De!==void 0){var we=De.call(fe,se);if(B(we)!=="object")return we;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(fe)}var me=(0,N.default)(`<div class='directions-control directions-control-directions'>
  <div class='mapbox-directions-component mapbox-directions-route-summary<% if (routes > 1) { %> mapbox-directions-multiple<% } %>'>
    <% if (routes > 1) { %>
    <div class='mapbox-directions-routes mapbox-directions-clearfix'>
      <% for (var i = 0; i < routes; i++) { %>
        <input type='radio' name='routes' id='<%= i %>' <% if (i === routeIndex) { %>checked<% } %>>
        <label for='<%= i %>' class='mapbox-directions-route'><%= i + 1 %></label>
      <% } %>
    </div>
    <% } %>
    <h1><%- duration %></h1>
    <span><%- distance %></span>
  </div>

  <div class='mapbox-directions-instructions'>
    <div class='mapbox-directions-instructions-wrapper'>
      <ol class='mapbox-directions-steps'>
        <% steps.forEach(function(step) { %>
          <%
            var distance = step.distance ? format(step.distance) : false;
            var icon = step.maneuver.modifier ? step.maneuver.modifier.replace(/\\s+/g, '-').toLowerCase() : step.maneuver.type.replace(/\\s+/g, '-').toLowerCase();

            if (['arrive', 'depart', 'waypoint'].includes(step.maneuver.type)) {
              icon = step.maneuver.type;
            }

            if (step.maneuver.type === 'roundabout' || step.maneuver.type === 'rotary') {
              icon = 'roundabout';
            }

            var lng = step.maneuver.location[0];
            var lat = step.maneuver.location[1];
          %>
          <li
            data-lat='<%= lat %>'
            data-lng='<%= lng %>'
            class='mapbox-directions-step'>
            <span class='directions-icon directions-icon-<%= icon %>'></span>
            <div class='mapbox-directions-step-maneuver'>
              <%= step.maneuver.instruction %>
            </div>
            <% if (distance) { %>
              <div class='mapbox-directions-step-distance'>
                <%= distance %>
              </div>
            <% } %>
          </li>
        <% }); %>
      </ol>
    </div>
  </div>
</div>
`),ge=(0,N.default)(`<div class='directions-control directions-control-directions'>
  <div class='mapbox-directions-error'>
    <%= error %>
  </div>
</div>
`),pe=function(){function fe(se,De,we,ht){$(this,fe),this.container=se,this.actions=we,this.store=De,this._map=ht,this.directions={},this.render()}return re(fe,[{key:"render",value:function(){var De=this;this.store.subscribe(function(){var we=De.actions,ht=we.hoverMarker,At=we.setRouteIndex,gt=De.store.getState(),Xe=gt.routeIndex,je=gt.unit,$e=gt.directions,It=gt.error,Lt=gt.compile,ct=gt.instructions,Et=!(0,r.default)($e[Xe],De.directions);if(It){De.container.innerHTML=ge({error:It});return}var Qe=ct.showWaypointInstructions?void 0:function(Dt){return Dt.maneuver.type!=="waypoint"};if($e.length&&Et){var kt=De.directions=$e[Xe],ii=L.default.getAllSteps(kt,Qe);Lt&&kt.legs.forEach(function(Dt){Dt.steps.forEach(function(ti){ti.maneuver.instruction=Lt("en",ti)})}),De.container.innerHTML=me({routeIndex:Xe,routes:$e.length,steps:ii,format:L.default.format[je],duration:L.default.format.duration(kt.duration),distance:L.default.format[je](kt.distance)});var Li=De.container.querySelectorAll(".mapbox-directions-step");Array.prototype.forEach.call(Li,function(Dt){var ti=Dt.getAttribute("data-lng"),li=Dt.getAttribute("data-lat");Dt.addEventListener("mouseover",function(){ht([ti,li])}),Dt.addEventListener("mouseout",function(){ht(null)}),Dt.addEventListener("click",function(){De._map.flyTo({center:[ti,li],zoom:16})})});var Ve=De.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(Ve,function(Dt){Dt.addEventListener("change",function(ti){At(parseInt(ti.target.id,10))})})}else De.container.innerHTML&&Et&&(De.container.innerHTML="")})}}]),fe}();A.default=pe},{"../utils":34,"lodash.isequal":11,"lodash.template":12}],30:[function(w,S,A){Object.defineProperty(A,"__esModule",{value:!0}),A.default=void 0;var L=w("redux"),N=ge(w("redux-thunk")),r=w("@mapbox/polyline"),F=ge(w("./utils")),B=ge(w("./reducers")),$=me(w("./actions")),ie=ge(w("./directions_style")),re=ge(w("./controls/inputs")),Te=ge(w("./controls/instructions"));function _e(gt){if(typeof WeakMap!="function")return null;var Xe=new WeakMap,je=new WeakMap;return(_e=function(It){return It?je:Xe})(gt)}function me(gt,Xe){if(gt&&gt.__esModule)return gt;if(gt===null||pe(gt)!=="object"&&typeof gt!="function")return{default:gt};var je=_e(Xe);if(je&&je.has(gt))return je.get(gt);var $e={},It=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Lt in gt)if(Lt!=="default"&&Object.prototype.hasOwnProperty.call(gt,Lt)){var ct=It?Object.getOwnPropertyDescriptor(gt,Lt):null;ct&&(ct.get||ct.set)?Object.defineProperty($e,Lt,ct):$e[Lt]=gt[Lt]}return $e.default=gt,je&&je.set(gt,$e),$e}function ge(gt){return gt&&gt.__esModule?gt:{default:gt}}function pe(gt){"@babel/helpers - typeof";return pe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Xe){return typeof Xe}:function(Xe){return Xe&&typeof Symbol=="function"&&Xe.constructor===Symbol&&Xe!==Symbol.prototype?"symbol":typeof Xe},pe(gt)}function fe(gt,Xe){if(!(gt instanceof Xe))throw new TypeError("Cannot call a class as a function")}function se(gt,Xe){for(var je=0;je<Xe.length;je++){var $e=Xe[je];$e.enumerable=$e.enumerable||!1,$e.configurable=!0,"value"in $e&&($e.writable=!0),Object.defineProperty(gt,we($e.key),$e)}}function De(gt,Xe,je){return Xe&&se(gt.prototype,Xe),Object.defineProperty(gt,"prototype",{writable:!1}),gt}function we(gt){var Xe=ht(gt,"string");return pe(Xe)==="symbol"?Xe:String(Xe)}function ht(gt,Xe){if(pe(gt)!=="object"||gt===null)return gt;var je=gt[Symbol.toPrimitive];if(je!==void 0){var $e=je.call(gt,Xe);if(pe($e)!=="object")return $e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(gt)}var At=function(){function gt(Xe){fe(this,gt),this._directions=null,this._stateSnapshot=null,this._store=this._initStore(),this.actions=(0,L.bindActionCreators)($,this._store.dispatch),this.actions.setOptions(Xe||{}),this.options=Xe||{},this.onDragDown=this._onDragDown.bind(this),this.onDragMove=this._onDragMove.bind(this),this.onDragUp=this._onDragUp.bind(this),this.move=this._move.bind(this),this.onClick=this._clickHandler().bind(this)}return De(gt,[{key:"onAdd",value:function(je){var $e=this;this._map=je;var It=this._store.getState(),Lt=It.controls,ct=this.container=document.createElement("div");ct.className="mapboxgl-ctrl-directions mapboxgl-ctrl";var Et=document.createElement("div");Et.className="directions-control directions-control-inputs",new re.default(Et,this._store,this.actions,this._map);var Qe=document.createElement("div");return Qe.className="directions-control directions-control-instructions",new Te.default(Qe,this._store,{hoverMarker:this.actions.hoverMarker,setRouteIndex:this.actions.setRouteIndex},this._map),Lt.inputs&&ct.appendChild(Et),Lt.instructions&&ct.appendChild(Qe),this.subscribedActions(),this._map.loaded()?this.mapState():this._map.on("load",function(){return $e.mapState()}),ct}},{key:"onRemove",value:function(je){return this.container.parentNode.removeChild(this.container),this.removeRoutes(),je.off("mousedown",this.onDragDown),je.off("mousemove",this.move),je.off("touchstart",this.onDragDown),je.off("touchstart",this.move),je.off("click",this.onClick),this.storeUnsubscribe&&(this.storeUnsubscribe(),delete this.storeUnsubscribe),ie.default.forEach(function($e){je.getLayer($e.id)&&je.removeLayer($e.id)}),je.getSource("directions")&&je.removeSource("directions"),je.getSource("directions:markers")&&je.removeSource("directions:markers"),this._map=null,this}},{key:"mapState",value:function(){var je=this,$e=this._store.getState(),It=$e.profile;$e.alternatives,$e.congestion;var Lt=$e.styles,ct=$e.interactive;$e.compile,this.actions.eventEmit("profile",{profile:It});var Et={type:"geojson",data:{type:"FeatureCollection",features:[]}};this._map.addSource("directions",Et),this._map.addSource("directions:markers",Et),Lt&&Lt.length&&Lt.forEach(function(Qe){return je._map.addLayer(Qe)}),ie.default.forEach(function(Qe){je._map.getLayer(Qe.id)||je._map.addLayer(Qe)}),ct&&(this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick),this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown))}},{key:"_areMarkersChangedOnly",value:function(je){var $e=this,It=[];return this._stateSnapshot?(gt.SUBSCRIPTION_FIELDS.forEach(function(Lt){$e._stateSnapshot[Lt]!==je[Lt]&&It.push(Lt)}),It.length<=gt.MARKER_FIELDS.length&&It.every(function(Lt){return gt.MARKER_FIELDS.includes(Lt)})):!1}},{key:"subscribedActions",value:function(){var je=this;this.storeUnsubscribe=this._store.subscribe(function(){var $e=je._store.getState(),It=$e.origin,Lt=$e.destination,ct=$e.hoverMarker,Et=$e.directions,Qe=$e.routeIndex,kt=je._areMarkersChangedOnly($e);je._stateSnapshot=$e;var ii={type:"FeatureCollection",features:[It,Lt,ct].filter(function(Ve){return Ve.geometry})};if(je._map.style&&je._map.getSource("directions:markers")&&je._map.getSource("directions:markers").setData(ii),!kt){var Li={type:"FeatureCollection",features:[]};Et.length&&Et.forEach(function(Ve,Dt){var ti=[],li=(0,r.decode)(Ve.geometry,5).map(function(at){return at.reverse()}),Mi=F.default.getAllSteps(Ve);li.forEach(function(at,Rt){var _i=ti[ti.length-1],Oi=Ve.legs[0].annotation&&Ve.legs[0].annotation.congestion&&Ve.legs[0].annotation.congestion[Rt-1];if(_i&&(!Oi||_i.properties.congestion===Oi))_i.geometry.coordinates.push(at);else{var ei={geometry:{type:"LineString",coordinates:[]},properties:{"route-index":Dt,route:Dt===Qe?"selected":"alternate"}};_i&&ei.geometry.coordinates.push(_i.geometry.coordinates[_i.geometry.coordinates.length-1]),ei.geometry.coordinates.push(at),Oi&&(ei.properties.congestion=Ve.legs[0].annotation.congestion[Rt-1]),ti.push(ei)}}),Li.features=Li.features.concat(ti),Dt===Qe&&Mi.forEach(function(at){at.maneuver.type==="waypoint"&&Li.features.push({type:"Feature",geometry:{type:"Point",coordinates:at.maneuver.location},properties:{id:"waypoint"}})})}),je._map.style&&je._map.getSource("directions")&&je._map.getSource("directions").setData(Li)}})}},{key:"_initStore",value:function(){var je=(0,L.applyMiddleware)(N.default)(L.createStore);return je(B.default)}},{key:"_clickHandler",value:function(){var je=null,$e=250;return function(It){if(je)clearTimeout(je),je=null,this._map.zoomIn();else{var Lt=this._onSingleClick.bind(this);je=setTimeout(function(){Lt(It),je=null},$e)}}}},{key:"_onSingleClick",value:function(je){var $e=this,It=this._store.getState(),Lt=It.origin,ct=[je.lngLat.lng,je.lngLat.lat];if(!Lt.geometry)this.actions.setOriginFromCoordinates(ct);else{var Et=this._map.queryRenderedFeatures(je.point,{layers:["directions-origin-point","directions-destination-point","directions-waypoint-point","directions-route-line-alt"]});if(Et.length){if(Et.forEach(function(kt){kt.layer.id==="directions-waypoint-point"&&$e.actions.removeWaypoint(kt)}),Et[0].properties.route==="alternate"){var Qe=Et[0].properties["route-index"];this.actions.setRouteIndex(Qe)}}else this.actions.setDestinationFromCoordinates(ct),this._map.flyTo({center:ct})}}},{key:"_move",value:function(je){var $e=this,It=this._store.getState(),Lt=It.hoverMarker,ct=this._map.queryRenderedFeatures(je.point,{layers:["directions-route-line-alt","directions-route-line","directions-origin-point","directions-destination-point","directions-hover-point"]});this._map.getCanvas().style.cursor=ct.length?"pointer":"",ct.length?(this.isCursorOverPoint=ct[0],this._map.dragPan.disable(),ct.forEach(function(Et){Et.layer.id==="directions-route-line"?$e.actions.hoverMarker([je.lngLat.lng,je.lngLat.lat]):Lt.geometry&&$e.actions.hoverMarker(null)})):this.isCursorOverPoint&&(this.isCursorOverPoint=!1,this._map.dragPan.enable())}},{key:"_onDragDown",value:function(){this.isCursorOverPoint&&(this.isDragging=this.isCursorOverPoint,this._map.getCanvas().style.cursor="grab",this._map.on("mousemove",this.onDragMove),this._map.on("mouseup",this.onDragUp),this._map.on("touchmove",this.onDragMove),this._map.on("touchend",this.onDragUp))}},{key:"_onDragMove",value:function(je){if(this.isDragging){var $e=[je.lngLat.lng,je.lngLat.lat];switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.createOrigin($e);break;case"directions-destination-point":this.actions.createDestination($e);break;case"directions-hover-point":this.actions.hoverMarker($e);break}}}},{key:"_onDragUp",value:function(){if(this.isDragging){var je=this._store.getState(),$e=je.hoverMarker,It=je.origin,Lt=je.destination;switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.setOriginFromCoordinates(It.geometry.coordinates);break;case"directions-destination-point":this.actions.setDestinationFromCoordinates(Lt.geometry.coordinates);break;case"directions-hover-point":$e.geometry&&!F.default.coordinateMatch(this.isDragging,$e)&&this.actions.addWaypoint(0,$e);break}this.isDragging=!1,this._map.getCanvas().style.cursor="",this._map.off("touchmove",this.onDragMove),this._map.off("touchend",this.onDragUp),this._map.off("mousemove",this.onDragMove),this._map.off("mouseup",this.onDragUp)}}},{key:"interactive",value:function(je){return je?(this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown),this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick)):(this._map.off("touchstart",this.move),this._map.off("touchstart",this.onDragDown),this._map.off("mousedown",this.onDragDown),this._map.off("mousemove",this.move),this._map.off("click",this.onClick)),this}},{key:"getOrigin",value:function(){return this._store.getState().origin}},{key:"setOrigin",value:function(je){return typeof je=="string"?this.actions.queryOrigin(je):this.actions.setOriginFromCoordinates(je),this}},{key:"getDestination",value:function(){return this._store.getState().destination}},{key:"setDestination",value:function(je){return typeof je=="string"?this.actions.queryDestination(je):this.actions.setDestinationFromCoordinates(je),this}},{key:"reverse",value:function(){return this.actions.reverse(),this}},{key:"addWaypoint",value:function(je,$e){return $e.type||($e=F.default.createPoint($e,{id:"waypoint"})),this.actions.addWaypoint(je,$e),this}},{key:"setWaypoint",value:function(je,$e){return $e.type||($e=F.default.createPoint($e,{id:"waypoint"})),this.actions.setWaypoint(je,$e),this}},{key:"removeWaypoint",value:function(je){var $e=this._store.getState(),It=$e.waypoints;return this.actions.removeWaypoint(It[je]),this}},{key:"getWaypoints",value:function(){return this._store.getState().waypoints}},{key:"removeRoutes",value:function(){return this.actions.clearOrigin(),this.actions.clearDestination(),this}},{key:"on",value:function(je,$e){return this.actions.eventSubscribe(je,$e),this}}]),gt}();A.default=At,At.MARKER_FIELDS=["origin","destination","hoverMarker"],At.SUBSCRIPTION_FIELDS=["origin","destination","hovedMarker","directions","routeIndex"]},{"./actions":25,"./controls/inputs":28,"./controls/instructions":29,"./directions_style":31,"./reducers":33,"./utils":34,"@mapbox/polyline":6,redux:18,"redux-thunk":17}],31:[function(w,S,A){Object.defineProperty(A,"__esModule",{value:!0}),A.default=void 0;var L=[{id:"directions-route-line-alt",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#bbb","line-width":4},filter:["all",["in","$type","LineString"],["in","route","alternate"]]},{id:"directions-route-line-casing",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2d5f99","line-width":12},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-route-line",type:"line",source:"directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":{property:"congestion",type:"categorical",default:"#4882c5",stops:[["unknown","#4882c5"],["low","#4882c5"],["moderate","#f09a46"],["heavy","#e34341"],["severe","#8b2342"]]},"line-width":7},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-hover-point-casing",type:"circle",source:"directions:markers",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-hover-point",type:"circle",source:"directions:markers",paint:{"circle-radius":6,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-waypoint-point-casing",type:"circle",source:"directions:markers",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-waypoint-point",type:"circle",source:"directions:markers",paint:{"circle-radius":6,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-origin-point",type:"circle",source:"directions:markers",paint:{"circle-radius":18,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-origin-label",type:"symbol",source:"directions:markers",layout:{"text-field":"A","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-destination-point",type:"circle",source:"directions:markers",paint:{"circle-radius":18,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]},{id:"directions-destination-label",type:"symbol",source:"directions:markers",layout:{"text-field":"B","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]}],N=L;A.default=N},{}],32:[function(w,S,A){var L=N(w("./directions"));function N(r){return r&&r.__esModule?r:{default:r}}S.exports=L.default},{"./directions":30}],33:[function(w,S,A){function L(_e){"@babel/helpers - typeof";return L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(me){return typeof me}:function(me){return me&&typeof Symbol=="function"&&me.constructor===Symbol&&me!==Symbol.prototype?"symbol":typeof me},L(_e)}Object.defineProperty(A,"__esModule",{value:!0}),A.default=void 0;var N=$(w("../constants/action_types.js")),r=F(w("merge-options"));function F(_e){return _e&&_e.__esModule?_e:{default:_e}}function B(_e){if(typeof WeakMap!="function")return null;var me=new WeakMap,ge=new WeakMap;return(B=function(fe){return fe?ge:me})(_e)}function $(_e,me){if(_e&&_e.__esModule)return _e;if(_e===null||L(_e)!=="object"&&typeof _e!="function")return{default:_e};var ge=B(me);if(ge&&ge.has(_e))return ge.get(_e);var pe={},fe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var se in _e)if(se!=="default"&&Object.prototype.hasOwnProperty.call(_e,se)){var De=fe?Object.getOwnPropertyDescriptor(_e,se):null;De&&(De.get||De.set)?Object.defineProperty(pe,se,De):pe[se]=_e[se]}return pe.default=_e,ge&&ge.set(_e,pe),pe}var ie=function(){return{api:"https://api.mapbox.com/directions/v5/",profile:"mapbox/driving-traffic",alternatives:!1,congestion:!1,unit:"imperial",flyTo:!0,placeholderOrigin:"Choose a starting place",placeholderDestination:"Choose destination",zoom:16,language:"en",compile:null,proximity:!1,styles:[],controls:{profileSwitcher:!0,inputs:!0,instructions:!0},instructions:{showWaypointInstructions:!0},geocoder:{},interactive:!0,events:{},origin:{},destination:{},hoverMarker:{},waypoints:[],originQuery:null,destinationQuery:null,originQueryCoordinates:null,destinationQueryCoordinates:null,directions:[],fetchDirectionsRequest:null,routeIndex:0,routePadding:80}};function re(){var _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ie(),me=arguments.length>1?arguments[1]:void 0;switch(me.type){case N.SET_OPTIONS:return(0,r.default)({},_e,me.options);case N.DIRECTIONS_PROFILE:return Object.assign({},_e,{profile:me.profile});case N.ORIGIN:return Object.assign({},_e,{origin:me.origin,hoverMarker:{}});case N.DESTINATION:return Object.assign({},_e,{destination:me.destination,hoverMarker:{}});case N.HOVER_MARKER:return Object.assign({},_e,{hoverMarker:me.hoverMarker});case N.WAYPOINTS:return Object.assign({},_e,{waypoints:me.waypoints});case N.ORIGIN_QUERY:return Object.assign({},_e,{originQuery:me.query});case N.DESTINATION_QUERY:return Object.assign({},_e,{destinationQuery:me.query});case N.ORIGIN_FROM_COORDINATES:return Object.assign({},_e,{originQueryCoordinates:me.coordinates});case N.DESTINATION_FROM_COORDINATES:return Object.assign({},_e,{destinationQueryCoordinates:me.coordinates});case N.ORIGIN_CLEAR:return Object.assign({},_e,{origin:{},originQuery:"",waypoints:[],directions:[]});case N.DESTINATION_CLEAR:return Object.assign({},_e,{destination:{},destinationQuery:"",waypoints:[],directions:[]});case N.DIRECTIONS_REQUEST_START:return Object.assign({},_e,{fetchDirectionsRequest:me.request});case N.DIRECTIONS:return Object.assign({},_e,{directions:me.directions,fetchDirectionsRequest:null});case N.ROUTE_INDEX:return Object.assign({},_e,{routeIndex:me.routeIndex});case N.ERROR:return Object.assign({},_e,{error:me.error});default:return _e}}var Te=re;A.default=Te},{"../constants/action_types.js":26,"merge-options":14}],34:[function(w,S,A){Object.defineProperty(A,"__esModule",{value:!0}),A.default=void 0;function L(Te){return Te[0]>=-180&&Te[0]<=180&&Te[1]>=-90&&Te[1]<=90}function N(Te,_e){return Te=Te.geometry.coordinates,_e=_e.geometry.coordinates,Te.join()===_e.join()||Te[0].toFixed(3)===_e[0].toFixed(3)&&Te[1].toFixed(3)===_e[1].toFixed(3)}function r(Te){var _e=360,me=((Te- -180)%_e+_e)%_e+-180;return me===-180?180:me}function F(Te,_e){var me=0;return Math.floor(_e)!==_e&&(me=_e.toString().split(".")[1].length),Te.toFixed(Math.min(me,5))}function B(Te,_e){return{type:"Feature",geometry:{type:"Point",coordinates:Te},properties:_e||{}}}function $(Te,_e){return Te.legs.reduce(function(me,ge,pe){pe>0&&(me[me.length-1].maneuver.type="waypoint",ge.steps[0].maneuver.type="");var fe=me.concat(ge.steps);return _e?fe.filter(_e):fe},[])}var ie={duration:function(_e){var me=Math.floor(_e/60),ge=Math.floor(me/60);return _e%=60,me%=60,ge===0&&me===0?_e+"s":ge===0?me+"min":ge+"h "+me+"min"},imperial:function(_e){var me=_e/1609.344;return me>=100?me.toFixed(0)+"mi":me>=10?me.toFixed(1)+"mi":me>=.1?me.toFixed(2)+"mi":(me*5280).toFixed(0)+"ft"},metric:function(_e){return _e>=1e5?(_e/1e3).toFixed(0)+"km":_e>=1e4?(_e/1e3).toFixed(1)+"km":_e>=100?(_e/1e3).toFixed(2)+"km":_e.toFixed(0)+"m"}},re={format:ie,coordinateMatch:N,createPoint:B,validCoords:L,wrap:r,roundWithOriginalPrecision:F,getAllSteps:$};A.default=re},{}]},{},[32])(32)})}(Ux)),Ux.exports}var hk=uk();const dk=Nb(hk);eh.accessToken="pk.eyJ1Ijoic2F5YWlib3NsIiwiYSI6ImNtZGlycGU2cTBkdGQya3NkN2JjYng3dGwifQ.FNgp4LLGPFZ7KzvV6mCjaw";const fk=()=>{const f=Re.useRef(null),[g,w]=Re.useState(null),[S,A]=Re.useState(null),L=[72.54397295960953,23.036021910957402];return Re.useEffect(()=>{if(!navigator.geolocation){alert("Geolocation not supported");return}navigator.geolocation.getCurrentPosition(N=>{const r=[N.coords.longitude,N.coords.latitude],F=new eh.Map({container:f.current,style:"mapbox://styles/mapbox/streets-v11",center:r,zoom:13}),B=new dk({accessToken:eh.accessToken,unit:"metric",profile:"mapbox/driving"});return F.addControl(B,"top-left"),B.setOrigin(r),B.setDestination(L),B.on("route",$=>{const ie=$.route[0];w((ie.distance/1e3).toFixed(2)),A((ie.duration/60).toFixed(2))}),()=>F.remove()},N=>{console.error("Geolocation error:",N),alert("Unable to access location")})},[]),W.jsxs("div",{children:[W.jsx("div",{ref:f,style:{height:"500px"}}),g&&S&&W.jsxs("div",{className:"p-4 bg-white shadow rounded",children:[W.jsxs("p",{children:["🛣️ Distance: ",g," km"]}),W.jsxs("p",{children:["⏱️ Duration: ",S," mins"]})]})]})};function pk(){const[f,g]=Re.useState(""),[w,S]=Re.useState(""),[A,L]=Re.useState(1),[N,r]=Re.useState(""),[F,B]=Re.useState(!0),$=gu(),{login:ie}=Im(),re=async()=>{const me=F?{email:f,role:"user"}:{phone:f,role:"user"};try{const ge=await $b(me);ge.newUser?$("/register",{state:{identifier:f,isEmail:F,otp:ge.otp}}):ge.otp?(r(`OTP sent to your ${F?"email":"phone"}`),L(2)):r(ge.msg||"Unexpected response from server.")}catch{r("Failed to request OTP. Please try again.")}},Te=async()=>{const me=F?{email:f,otp:w}:{phone:f,otp:w};try{const ge=await Zb(me);ge.token?(localStorage.setItem("token",ge.token),localStorage.setItem("role",ge.user.role),localStorage.setItem("user",JSON.stringify(ge.user)),ie(ge.user),$("/user-dashboard",{replace:!0})):r(ge.msg||"Invalid OTP. Try again.")}catch{r("Verification failed. Please try again.")}},_e=()=>{L(1),S(""),r("")};return W.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-400 via-orange-700 to-red-500 flex items-center justify-center px-4",children:W.jsxs("div",{className:"bg-white/20 backdrop-blur-lg p-8 rounded-3xl shadow-2xl w-full max-w-md text-white space-y-6",children:[W.jsxs("div",{className:"text-center",children:[W.jsx("div",{className:"bg-white/30 p-3 rounded-full inline-block mb-2",children:W.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:W.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 14l9-5-9-5-9 5 9 5z"})})}),W.jsxs("h2",{className:"text-3xl font-bold",children:["Welcome to ",W.jsx("span",{className:"text-yellow-300",children:"FoodYah"})]}),W.jsx("p",{className:"text-sm text-orange-100",children:"Sign in to continue your culinary journey"})]}),W.jsxs("div",{className:"flex justify-center gap-4",children:[W.jsx("button",{className:`px-5 py-2 rounded-full font-medium ${F?"bg-yellow-400 text-black":"bg-white/10 text-white"}`,onClick:()=>B(!0),disabled:A!==1,children:"Email"}),W.jsx("button",{className:`px-5 py-2 rounded-full font-medium ${F?"bg-white/10 text-white":"bg-yellow-400 text-black"}`,onClick:()=>B(!1),disabled:A!==1,children:"Phone"})]}),A===1?W.jsxs(W.Fragment,{children:[W.jsx("input",{type:"text",placeholder:F?"Enter your email":"Enter your phone number",value:f,onChange:me=>g(me.target.value),className:"w-full px-4 py-3 rounded-md bg-white/25 placeholder-white text-white focus:outline-none focus:ring-2 focus:ring-yellow-300"}),W.jsx("button",{onClick:re,className:"w-full py-3 mt-2 rounded-lg bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 font-semibold",children:"Request OTP"})]}):W.jsxs(W.Fragment,{children:[W.jsx("input",{type:"text",placeholder:"Enter OTP",value:w,onChange:me=>S(me.target.value),className:"w-full px-4 py-3 rounded-md bg-white/25 placeholder-white text-white focus:outline-none focus:ring-2 focus:ring-green-300"}),W.jsxs("div",{className:"flex justify-between gap-4",children:[W.jsx("button",{onClick:_e,className:"w-1/2 py-3 mt-2 rounded-lg bg-white/30 hover:bg-white/40 font-semibold",children:"← Back"}),W.jsx("button",{onClick:Te,className:"w-1/2 py-3 mt-2 rounded-lg bg-gradient-to-r from-green-400 to-green-600 hover:from-green-500 hover:to-green-700 font-semibold",children:"Verify OTP"})]})]}),N&&W.jsx("p",{className:"text-center text-yellow-100 text-sm",children:N}),W.jsxs("p",{className:"text-xs text-center text-orange-100 pt-2",children:["New here?"," ",W.jsx(lc,{to:"/register",children:W.jsx("span",{className:"underline",children:"Register"})})]}),W.jsxs("p",{className:"text-xs text-center text-orange-100",children:["By continuing, you agree to our"," ",W.jsx("span",{className:"underline",children:"Terms"})," and"," ",W.jsx("span",{className:"underline",children:"Privacy Policy"}),"."]})]})})}function mk(){const g=Nc()?.state||{},[w,S]=Re.useState(""),[A,L]=Re.useState(g?.otp||""),[N,r]=Re.useState(""),[F,B]=Re.useState(""),$=gu(),ie=async()=>{const _e=await(await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:w,email:F,phone:N,otp:A,role:"restaurant"})})).json();_e.success?(alert("Your registration is complete. Please login."),$("/login",{replace:!0})):alert(_e.msg||"Registration failed.")};return W.jsxs("div",{className:"min-h-screen flex",children:[W.jsx("div",{className:"hidden md:flex w-1/2 bg-cover bg-center",style:{backgroundImage:"url('/your-partner-banner.jpg')"},children:W.jsxs("div",{className:"h-full w-full bg-black bg-opacity-50 p-10 flex flex-col justify-center text-white",children:[W.jsx("p",{className:"uppercase text-sm tracking-wider text-orange-400 mb-2",children:"Partner with FoodYah!"}),W.jsx("h1",{className:"text-4xl font-bold leading-snug",children:"Access to FoodYah tools and support"})]})}),W.jsx("div",{className:"w-full md:w-1/2 flex items-center justify-center bg-gray-50",children:W.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg w-full max-w-sm",children:[W.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Register"}),W.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Complete your registration to continue"}),W.jsx("input",{type:"text",placeholder:"Full Name",value:w,onChange:re=>S(re.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-md mb-4 focus:ring-2 focus:ring-orange-400 focus:outline-none"}),W.jsx("input",{type:"email",placeholder:"Your Email",value:F,onChange:re=>B(re.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-md mb-4 focus:ring-2 focus:ring-orange-400 focus:outline-none"}),W.jsx("input",{type:"tel",placeholder:"Your Phone Number",value:N,onChange:re=>r(re.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-md mb-4 focus:ring-2 focus:ring-orange-400 focus:outline-none"}),W.jsx("input",{type:"text",placeholder:"OTP",value:A,onChange:re=>L(re.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-md mb-6 focus:ring-2 focus:ring-green-400 focus:outline-none"}),W.jsx("button",{onClick:ie,className:"w-full py-3 bg-orange-400 hover:bg-orange-500 text-white font-semibold rounded-md transition",children:"Register"}),W.jsxs("p",{className:"text-xs text-center text-gray-400 mt-6",children:["By continuing, you agree to our"," ",W.jsx("span",{className:"underline",children:"Terms of Service"})," and"," ",W.jsx("span",{className:"underline",children:"Privacy Policy"}),"."]})]})})]})}eh.accessToken=kE;const gk=({lat:f,lon:g})=>{const w=Re.useRef(null);return Re.useEffect(()=>{if(!f||!g)return;const S=new eh.Map({container:w.current,style:"mapbox://styles/mapbox/streets-v11",center:[g,f],zoom:15});return new eh.Marker().setLngLat([g,f]).addTo(S),()=>S.remove()},[f,g]),W.jsx("div",{children:W.jsx("div",{ref:w,style:{width:"95%",margin:"10px auto",height:"400px",border:"2px solid black",borderRadius:"8px"}})})},_k=()=>{const{state:f}=Nc(),g=gu(),w=f?.restaurant,[S,A]=Re.useState(""),[L,N]=Re.useState(!1),r=async F=>{if(!S.trim())return alert("Please enter remarks.");N(!0);try{const $=await(await fetch("/api/restaurant/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({restaurantId:w._id,status:F,remarks:S})})).json();N(!1),$.success?(alert(`Restaurant has been ${F}.`),g("/admin")):alert("Action failed. "+($.message||""))}catch{N(!1),alert("Something went wrong.")}};return w?W.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:W.jsxs("div",{className:"max-w-6xl mx-auto bg-white shadow-lg rounded-xl p-6 space-y-8",children:[W.jsxs("div",{className:"flex justify-between items-center border-b pb-4",children:[W.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Verify Restaurant"}),W.jsx("button",{onClick:()=>g(-1),className:"px-4 py-2 bg-gray-100 text-sm rounded hover:bg-gray-200",children:"← Back"})]}),W.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-800",children:[W.jsx(nf,{label:"Name",value:w.name}),W.jsx(nf,{label:"Email",value:w.email}),W.jsx(nf,{label:"Phone",value:w.phone}),W.jsx(nf,{label:"Cuisine Types",value:w.cuisine_types}),W.jsx(nf,{label:"Status",value:w.status}),W.jsx(nf,{label:"Rating",value:w.rating}),W.jsx(nf,{label:"Total Orders",value:w.total_orders}),W.jsx(nf,{label:"Commission %",value:`${w.commission_percentage}%`}),W.jsx(nf,{label:"Registration Date",value:new Date(w.registration_date).toLocaleString()})]}),W.jsxs("div",{children:[W.jsx("h2",{className:"text-xl font-semibold mb-2",children:"📍 Address"}),W.jsxs("div",{className:"ml-4 space-y-1 text-sm text-gray-700",children:[W.jsx("p",{children:w.addresses?.[0]?.addressLine}),W.jsxs("p",{children:[w.addresses?.[0]?.city,","," ",w.addresses?.[0]?.state," -"," ",w.addresses?.[0]?.pincode]})]}),W.jsx("div",{children:W.jsx(gk,{lat:w.addresses?.[0]?.location?.coordinates[1],lon:w.addresses?.[0]?.location?.coordinates[0]})})]}),W.jsxs("div",{children:[W.jsx("h2",{className:"text-xl font-semibold mb-2",children:"📄 Documents"}),W.jsxs("div",{className:"flex flex-wrap gap-6 ml-2",children:[W.jsx(o2,{label:"FSSAI",url:`/api/file/${w.documents?.fssai}`}),W.jsx(o2,{label:"GST",url:`/api/file/${w.documents?.gst}`})]})]}),W.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:[W.jsx(l2,{title:"Logo Image",imageId:w.logo_images?.[0]}),W.jsx(l2,{title:"Theme Image",imageId:w.theme_images?.[0]})]}),W.jsxs("div",{children:[W.jsx("h2",{className:"text-xl font-semibold mb-2",children:"🍽️ Menu Images"}),W.jsx("ul",{className:"ml-6 list-disc space-y-1 text-blue-700 text-sm",children:w.menu_images?.map((F,B)=>W.jsx("li",{children:W.jsxs("a",{href:`/api/file/${F}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline",children:["View Menu Image ",B+1]})},B))})]}),W.jsxs("div",{className:"border-t pt-6 space-y-4",children:[W.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"✅ Admin Action"}),W.jsx("textarea",{rows:4,className:"w-full border rounded px-4 py-2 focus:ring focus:ring-blue-200",placeholder:"Enter your remarks...",value:S,onChange:F=>A(F.target.value)}),W.jsxs("div",{className:"flex gap-4",children:[W.jsx("button",{onClick:()=>r("active"),disabled:L,className:"px-5 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:"✅ Approve"}),W.jsx("button",{onClick:()=>r("rejected"),disabled:L,className:"px-5 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50",children:"❌ Reject"})]})]})]})}):W.jsxs("div",{className:"p-6 text-center",children:[W.jsx("p",{className:"text-red-600 text-lg font-medium",children:"No restaurant data found. Please go back."}),W.jsx("button",{onClick:()=>g(-1),className:"mt-4 px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"← Go Back"})]})},nf=({label:f,value:g})=>W.jsxs("div",{children:[W.jsx("p",{className:"text-sm text-gray-500",children:f}),W.jsx("p",{className:"text-base font-medium text-gray-900 break-words",children:g||"N/A"})]}),o2=({label:f,url:g})=>W.jsxs("div",{className:"space-y-1",children:[W.jsx("p",{className:"text-sm font-medium text-gray-700",children:f}),g?W.jsxs("a",{href:g,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:["🔗 View ",f]}):W.jsx("p",{className:"text-sm text-red-500",children:"Not uploaded"})]}),l2=({title:f,imageId:g})=>W.jsxs("div",{className:"text-center space-y-2",children:[W.jsx("p",{className:"font-semibold text-sm",children:f}),g?W.jsx("img",{src:`/api/file/${g}`,alt:f,className:"h-32 object-contain mx-auto border rounded"}):W.jsx("p",{className:"text-red-500 text-sm",children:"Not uploaded"})]}),DA=Re.createContext({});function yk(f){const g=Re.useRef(null);return g.current===null&&(g.current=f()),g.current}const s1=typeof window<"u",vk=s1?Re.useLayoutEffect:Re.useEffect,a1=Re.createContext(null);function o1(f,g){f.indexOf(g)===-1&&f.push(g)}function l1(f,g){const w=f.indexOf(g);w>-1&&f.splice(w,1)}const lf=(f,g,w)=>w>g?g:w<f?f:w;let c1=()=>{};const cf={},PA=f=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(f);function OA(f){return typeof f=="object"&&f!==null}const LA=f=>/^0[^.\s]+$/u.test(f);function u1(f){let g;return()=>(g===void 0&&(g=f()),g)}const mu=f=>f,xk=(f,g)=>w=>g(f(w)),hy=(...f)=>f.reduce(xk),ty=(f,g,w)=>{const S=g-f;return S===0?1:(w-f)/S};class h1{constructor(){this.subscriptions=[]}add(g){return o1(this.subscriptions,g),()=>l1(this.subscriptions,g)}notify(g,w,S){const A=this.subscriptions.length;if(A)if(A===1)this.subscriptions[0](g,w,S);else for(let L=0;L<A;L++){const N=this.subscriptions[L];N&&N(g,w,S)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Jh=f=>f*1e3,ed=f=>f/1e3;function zA(f,g){return g?f*(1e3/g):0}const kA=(f,g,w)=>(((1-3*w+3*g)*f+(3*w-6*g))*f+3*g)*f,bk=1e-7,wk=12;function Tk(f,g,w,S,A){let L,N,r=0;do N=g+(w-g)/2,L=kA(N,S,A)-f,L>0?w=N:g=N;while(Math.abs(L)>bk&&++r<wk);return N}function dy(f,g,w,S){if(f===g&&w===S)return mu;const A=L=>Tk(L,0,1,f,w);return L=>L===0||L===1?L:kA(A(L),g,S)}const NA=f=>g=>g<=.5?f(2*g)/2:(2-f(2*(1-g)))/2,FA=f=>g=>1-f(1-g),BA=dy(.33,1.53,.69,.99),d1=FA(BA),jA=NA(d1),VA=f=>(f*=2)<1?.5*d1(f):.5*(2-Math.pow(2,-10*(f-1))),f1=f=>1-Math.sin(Math.acos(f)),UA=FA(f1),GA=NA(f1),Sk=dy(.42,0,1,1),Ek=dy(0,0,.58,1),HA=dy(.42,0,.58,1),Ak=f=>Array.isArray(f)&&typeof f[0]!="number",qA=f=>Array.isArray(f)&&typeof f[0]=="number",Ck={linear:mu,easeIn:Sk,easeInOut:HA,easeOut:Ek,circIn:f1,circInOut:GA,circOut:UA,backIn:d1,backInOut:jA,backOut:BA,anticipate:VA},Mk=f=>typeof f=="string",c2=f=>{if(qA(f)){c1(f.length===4);const[g,w,S,A]=f;return dy(g,w,S,A)}else if(Mk(f))return Ck[f];return f},Ov=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Ik(f,g){let w=new Set,S=new Set,A=!1,L=!1;const N=new WeakSet;let r={delta:0,timestamp:0,isProcessing:!1};function F($){N.has($)&&(B.schedule($),f()),$(r)}const B={schedule:($,ie=!1,re=!1)=>{const _e=re&&A?w:S;return ie&&N.add($),_e.has($)||_e.add($),$},cancel:$=>{S.delete($),N.delete($)},process:$=>{if(r=$,A){L=!0;return}A=!0,[w,S]=[S,w],w.forEach(F),w.clear(),A=!1,L&&(L=!1,B.process($))}};return B}const Rk=40;function $A(f,g){let w=!1,S=!0;const A={delta:0,timestamp:0,isProcessing:!1},L=()=>w=!0,N=Ov.reduce((se,De)=>(se[De]=Ik(L),se),{}),{setup:r,read:F,resolveKeyframes:B,preUpdate:$,update:ie,preRender:re,render:Te,postRender:_e}=N,me=()=>{const se=cf.useManualTiming?A.timestamp:performance.now();w=!1,cf.useManualTiming||(A.delta=S?1e3/60:Math.max(Math.min(se-A.timestamp,Rk),1)),A.timestamp=se,A.isProcessing=!0,r.process(A),F.process(A),B.process(A),$.process(A),ie.process(A),re.process(A),Te.process(A),_e.process(A),A.isProcessing=!1,w&&g&&(S=!1,f(me))},ge=()=>{w=!0,S=!0,A.isProcessing||f(me)};return{schedule:Ov.reduce((se,De)=>{const we=N[De];return se[De]=(ht,At=!1,gt=!1)=>(w||ge(),we.schedule(ht,At,gt)),se},{}),cancel:se=>{for(let De=0;De<Ov.length;De++)N[Ov[De]].cancel(se)},state:A,steps:N}}const{schedule:Ws,cancel:pp,state:zo,steps:Gx}=$A(typeof requestAnimationFrame<"u"?requestAnimationFrame:mu,!0);let Gv;function Dk(){Gv=void 0}const cc={now:()=>(Gv===void 0&&cc.set(zo.isProcessing||cf.useManualTiming?zo.timestamp:performance.now()),Gv),set:f=>{Gv=f,queueMicrotask(Dk)}},ZA=f=>g=>typeof g=="string"&&g.startsWith(f),p1=ZA("--"),Pk=ZA("var(--"),m1=f=>Pk(f)?Ok.test(f.split("/*")[0].trim()):!1,Ok=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,kg={test:f=>typeof f=="number",parse:parseFloat,transform:f=>f},iy={...kg,transform:f=>lf(0,1,f)},Lv={...kg,default:1},$_=f=>Math.round(f*1e5)/1e5,g1=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Lk(f){return f==null}const zk=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,_1=(f,g)=>w=>!!(typeof w=="string"&&zk.test(w)&&w.startsWith(f)||g&&!Lk(w)&&Object.prototype.hasOwnProperty.call(w,g)),WA=(f,g,w)=>S=>{if(typeof S!="string")return S;const[A,L,N,r]=S.match(g1);return{[f]:parseFloat(A),[g]:parseFloat(L),[w]:parseFloat(N),alpha:r!==void 0?parseFloat(r):1}},kk=f=>lf(0,255,f),Hx={...kg,transform:f=>Math.round(kk(f))},Sm={test:_1("rgb","red"),parse:WA("red","green","blue"),transform:({red:f,green:g,blue:w,alpha:S=1})=>"rgba("+Hx.transform(f)+", "+Hx.transform(g)+", "+Hx.transform(w)+", "+$_(iy.transform(S))+")"};function Nk(f){let g="",w="",S="",A="";return f.length>5?(g=f.substring(1,3),w=f.substring(3,5),S=f.substring(5,7),A=f.substring(7,9)):(g=f.substring(1,2),w=f.substring(2,3),S=f.substring(3,4),A=f.substring(4,5),g+=g,w+=w,S+=S,A+=A),{red:parseInt(g,16),green:parseInt(w,16),blue:parseInt(S,16),alpha:A?parseInt(A,16)/255:1}}const gb={test:_1("#"),parse:Nk,transform:Sm.transform},fy=f=>({test:g=>typeof g=="string"&&g.endsWith(f)&&g.split(" ").length===1,parse:parseFloat,transform:g=>`${g}${f}`}),dp=fy("deg"),td=fy("%"),Wn=fy("px"),Fk=fy("vh"),Bk=fy("vw"),u2={...td,parse:f=>td.parse(f)/100,transform:f=>td.transform(f*100)},wg={test:_1("hsl","hue"),parse:WA("hue","saturation","lightness"),transform:({hue:f,saturation:g,lightness:w,alpha:S=1})=>"hsla("+Math.round(f)+", "+td.transform($_(g))+", "+td.transform($_(w))+", "+$_(iy.transform(S))+")"},Ka={test:f=>Sm.test(f)||gb.test(f)||wg.test(f),parse:f=>Sm.test(f)?Sm.parse(f):wg.test(f)?wg.parse(f):gb.parse(f),transform:f=>typeof f=="string"?f:f.hasOwnProperty("red")?Sm.transform(f):wg.transform(f),getAnimatableNone:f=>{const g=Ka.parse(f);return g.alpha=0,Ka.transform(g)}},jk=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Vk(f){return isNaN(f)&&typeof f=="string"&&(f.match(g1)?.length||0)+(f.match(jk)?.length||0)>0}const XA="number",YA="color",Uk="var",Gk="var(",h2="${}",Hk=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ny(f){const g=f.toString(),w=[],S={color:[],number:[],var:[]},A=[];let L=0;const r=g.replace(Hk,F=>(Ka.test(F)?(S.color.push(L),A.push(YA),w.push(Ka.parse(F))):F.startsWith(Gk)?(S.var.push(L),A.push(Uk),w.push(F)):(S.number.push(L),A.push(XA),w.push(parseFloat(F))),++L,h2)).split(h2);return{values:w,split:r,indexes:S,types:A}}function KA(f){return ny(f).values}function QA(f){const{split:g,types:w}=ny(f),S=g.length;return A=>{let L="";for(let N=0;N<S;N++)if(L+=g[N],A[N]!==void 0){const r=w[N];r===XA?L+=$_(A[N]):r===YA?L+=Ka.transform(A[N]):L+=A[N]}return L}}const qk=f=>typeof f=="number"?0:Ka.test(f)?Ka.getAnimatableNone(f):f;function $k(f){const g=KA(f);return QA(f)(g.map(qk))}const mp={test:Vk,parse:KA,createTransformer:QA,getAnimatableNone:$k};function qx(f,g,w){return w<0&&(w+=1),w>1&&(w-=1),w<1/6?f+(g-f)*6*w:w<1/2?g:w<2/3?f+(g-f)*(2/3-w)*6:f}function Zk({hue:f,saturation:g,lightness:w,alpha:S}){f/=360,g/=100,w/=100;let A=0,L=0,N=0;if(!g)A=L=N=w;else{const r=w<.5?w*(1+g):w+g-w*g,F=2*w-r;A=qx(F,r,f+1/3),L=qx(F,r,f),N=qx(F,r,f-1/3)}return{red:Math.round(A*255),green:Math.round(L*255),blue:Math.round(N*255),alpha:S}}function r0(f,g){return w=>w>0?g:f}const sa=(f,g,w)=>f+(g-f)*w,$x=(f,g,w)=>{const S=f*f,A=w*(g*g-S)+S;return A<0?0:Math.sqrt(A)},Wk=[gb,Sm,wg],Xk=f=>Wk.find(g=>g.test(f));function d2(f){const g=Xk(f);if(!g)return!1;let w=g.parse(f);return g===wg&&(w=Zk(w)),w}const f2=(f,g)=>{const w=d2(f),S=d2(g);if(!w||!S)return r0(f,g);const A={...w};return L=>(A.red=$x(w.red,S.red,L),A.green=$x(w.green,S.green,L),A.blue=$x(w.blue,S.blue,L),A.alpha=sa(w.alpha,S.alpha,L),Sm.transform(A))},_b=new Set(["none","hidden"]);function Yk(f,g){return _b.has(f)?w=>w<=0?f:g:w=>w>=1?g:f}function Kk(f,g){return w=>sa(f,g,w)}function y1(f){return typeof f=="number"?Kk:typeof f=="string"?m1(f)?r0:Ka.test(f)?f2:eN:Array.isArray(f)?JA:typeof f=="object"?Ka.test(f)?f2:Qk:r0}function JA(f,g){const w=[...f],S=w.length,A=f.map((L,N)=>y1(L)(L,g[N]));return L=>{for(let N=0;N<S;N++)w[N]=A[N](L);return w}}function Qk(f,g){const w={...f,...g},S={};for(const A in w)f[A]!==void 0&&g[A]!==void 0&&(S[A]=y1(f[A])(f[A],g[A]));return A=>{for(const L in S)w[L]=S[L](A);return w}}function Jk(f,g){const w=[],S={color:0,var:0,number:0};for(let A=0;A<g.values.length;A++){const L=g.types[A],N=f.indexes[L][S[L]],r=f.values[N]??0;w[A]=r,S[L]++}return w}const eN=(f,g)=>{const w=mp.createTransformer(g),S=ny(f),A=ny(g);return S.indexes.var.length===A.indexes.var.length&&S.indexes.color.length===A.indexes.color.length&&S.indexes.number.length>=A.indexes.number.length?_b.has(f)&&!A.values.length||_b.has(g)&&!S.values.length?Yk(f,g):hy(JA(Jk(S,A),A.values),w):r0(f,g)};function eC(f,g,w){return typeof f=="number"&&typeof g=="number"&&typeof w=="number"?sa(f,g,w):y1(f)(f,g)}const tN=f=>{const g=({timestamp:w})=>f(w);return{start:(w=!0)=>Ws.update(g,w),stop:()=>pp(g),now:()=>zo.isProcessing?zo.timestamp:cc.now()}},tC=(f,g,w=10)=>{let S="";const A=Math.max(Math.round(g/w),2);for(let L=0;L<A;L++)S+=Math.round(f(L/(A-1))*1e4)/1e4+", ";return`linear(${S.substring(0,S.length-2)})`},s0=2e4;function v1(f){let g=0;const w=50;let S=f.next(g);for(;!S.done&&g<s0;)g+=w,S=f.next(g);return g>=s0?1/0:g}function iN(f,g=100,w){const S=w({...f,keyframes:[0,g]}),A=Math.min(v1(S),s0);return{type:"keyframes",ease:L=>S.next(A*L).value/g,duration:ed(A)}}const nN=5;function iC(f,g,w){const S=Math.max(g-nN,0);return zA(w-f(S),g-S)}const ma={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Zx=.001;function rN({duration:f=ma.duration,bounce:g=ma.bounce,velocity:w=ma.velocity,mass:S=ma.mass}){let A,L,N=1-g;N=lf(ma.minDamping,ma.maxDamping,N),f=lf(ma.minDuration,ma.maxDuration,ed(f)),N<1?(A=B=>{const $=B*N,ie=$*f,re=$-w,Te=yb(B,N),_e=Math.exp(-ie);return Zx-re/Te*_e},L=B=>{const ie=B*N*f,re=ie*w+w,Te=Math.pow(N,2)*Math.pow(B,2)*f,_e=Math.exp(-ie),me=yb(Math.pow(B,2),N);return(-A(B)+Zx>0?-1:1)*((re-Te)*_e)/me}):(A=B=>{const $=Math.exp(-B*f),ie=(B-w)*f+1;return-Zx+$*ie},L=B=>{const $=Math.exp(-B*f),ie=(w-B)*(f*f);return $*ie});const r=5/f,F=aN(A,L,r);if(f=Jh(f),isNaN(F))return{stiffness:ma.stiffness,damping:ma.damping,duration:f};{const B=Math.pow(F,2)*S;return{stiffness:B,damping:N*2*Math.sqrt(S*B),duration:f}}}const sN=12;function aN(f,g,w){let S=w;for(let A=1;A<sN;A++)S=S-f(S)/g(S);return S}function yb(f,g){return f*Math.sqrt(1-g*g)}const oN=["duration","bounce"],lN=["stiffness","damping","mass"];function p2(f,g){return g.some(w=>f[w]!==void 0)}function cN(f){let g={velocity:ma.velocity,stiffness:ma.stiffness,damping:ma.damping,mass:ma.mass,isResolvedFromDuration:!1,...f};if(!p2(f,lN)&&p2(f,oN))if(f.visualDuration){const w=f.visualDuration,S=2*Math.PI/(w*1.2),A=S*S,L=2*lf(.05,1,1-(f.bounce||0))*Math.sqrt(A);g={...g,mass:ma.mass,stiffness:A,damping:L}}else{const w=rN(f);g={...g,...w,mass:ma.mass},g.isResolvedFromDuration=!0}return g}function a0(f=ma.visualDuration,g=ma.bounce){const w=typeof f!="object"?{visualDuration:f,keyframes:[0,1],bounce:g}:f;let{restSpeed:S,restDelta:A}=w;const L=w.keyframes[0],N=w.keyframes[w.keyframes.length-1],r={done:!1,value:L},{stiffness:F,damping:B,mass:$,duration:ie,velocity:re,isResolvedFromDuration:Te}=cN({...w,velocity:-ed(w.velocity||0)}),_e=re||0,me=B/(2*Math.sqrt(F*$)),ge=N-L,pe=ed(Math.sqrt(F/$)),fe=Math.abs(ge)<5;S||(S=fe?ma.restSpeed.granular:ma.restSpeed.default),A||(A=fe?ma.restDelta.granular:ma.restDelta.default);let se;if(me<1){const we=yb(pe,me);se=ht=>{const At=Math.exp(-me*pe*ht);return N-At*((_e+me*pe*ge)/we*Math.sin(we*ht)+ge*Math.cos(we*ht))}}else if(me===1)se=we=>N-Math.exp(-pe*we)*(ge+(_e+pe*ge)*we);else{const we=pe*Math.sqrt(me*me-1);se=ht=>{const At=Math.exp(-me*pe*ht),gt=Math.min(we*ht,300);return N-At*((_e+me*pe*ge)*Math.sinh(gt)+we*ge*Math.cosh(gt))/we}}const De={calculatedDuration:Te&&ie||null,next:we=>{const ht=se(we);if(Te)r.done=we>=ie;else{let At=we===0?_e:0;me<1&&(At=we===0?Jh(_e):iC(se,we,ht));const gt=Math.abs(At)<=S,Xe=Math.abs(N-ht)<=A;r.done=gt&&Xe}return r.value=r.done?N:ht,r},toString:()=>{const we=Math.min(v1(De),s0),ht=tC(At=>De.next(we*At).value,we,30);return we+"ms "+ht},toTransition:()=>{}};return De}a0.applyToOptions=f=>{const g=iN(f,100,a0);return f.ease=g.ease,f.duration=Jh(g.duration),f.type="keyframes",f};function vb({keyframes:f,velocity:g=0,power:w=.8,timeConstant:S=325,bounceDamping:A=10,bounceStiffness:L=500,modifyTarget:N,min:r,max:F,restDelta:B=.5,restSpeed:$}){const ie=f[0],re={done:!1,value:ie},Te=gt=>r!==void 0&&gt<r||F!==void 0&&gt>F,_e=gt=>r===void 0?F:F===void 0||Math.abs(r-gt)<Math.abs(F-gt)?r:F;let me=w*g;const ge=ie+me,pe=N===void 0?ge:N(ge);pe!==ge&&(me=pe-ie);const fe=gt=>-me*Math.exp(-gt/S),se=gt=>pe+fe(gt),De=gt=>{const Xe=fe(gt),je=se(gt);re.done=Math.abs(Xe)<=B,re.value=re.done?pe:je};let we,ht;const At=gt=>{Te(re.value)&&(we=gt,ht=a0({keyframes:[re.value,_e(re.value)],velocity:iC(se,gt,re.value),damping:A,stiffness:L,restDelta:B,restSpeed:$}))};return At(0),{calculatedDuration:null,next:gt=>{let Xe=!1;return!ht&&we===void 0&&(Xe=!0,De(gt),At(gt)),we!==void 0&&gt>=we?ht.next(gt-we):(!Xe&&De(gt),re)}}}function uN(f,g,w){const S=[],A=w||cf.mix||eC,L=f.length-1;for(let N=0;N<L;N++){let r=A(f[N],f[N+1]);if(g){const F=Array.isArray(g)?g[N]||mu:g;r=hy(F,r)}S.push(r)}return S}function hN(f,g,{clamp:w=!0,ease:S,mixer:A}={}){const L=f.length;if(c1(L===g.length),L===1)return()=>g[0];if(L===2&&g[0]===g[1])return()=>g[1];const N=f[0]===f[1];f[0]>f[L-1]&&(f=[...f].reverse(),g=[...g].reverse());const r=uN(g,S,A),F=r.length,B=$=>{if(N&&$<f[0])return g[0];let ie=0;if(F>1)for(;ie<f.length-2&&!($<f[ie+1]);ie++);const re=ty(f[ie],f[ie+1],$);return r[ie](re)};return w?$=>B(lf(f[0],f[L-1],$)):B}function dN(f,g){const w=f[f.length-1];for(let S=1;S<=g;S++){const A=ty(0,g,S);f.push(sa(w,1,A))}}function fN(f){const g=[0];return dN(g,f.length-1),g}function pN(f,g){return f.map(w=>w*g)}function mN(f,g){return f.map(()=>g||HA).splice(0,f.length-1)}function Z_({duration:f=300,keyframes:g,times:w,ease:S="easeInOut"}){const A=Ak(S)?S.map(c2):c2(S),L={done:!1,value:g[0]},N=pN(w&&w.length===g.length?w:fN(g),f),r=hN(N,g,{ease:Array.isArray(A)?A:mN(g,A)});return{calculatedDuration:f,next:F=>(L.value=r(F),L.done=F>=f,L)}}const gN=f=>f!==null;function x1(f,{repeat:g,repeatType:w="loop"},S,A=1){const L=f.filter(gN),r=A<0||g&&w!=="loop"&&g%2===1?0:L.length-1;return!r||S===void 0?L[r]:S}const _N={decay:vb,inertia:vb,tween:Z_,keyframes:Z_,spring:a0};function nC(f){typeof f.type=="string"&&(f.type=_N[f.type])}class b1{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(g=>{this.resolve=g})}notifyFinished(){this.resolve()}then(g,w){return this.finished.then(g,w)}}const yN=f=>f/100;class w1 extends b1{constructor(g){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:w}=this.options;w&&w.updatedAt!==cc.now()&&this.tick(cc.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=g,this.initAnimation(),this.play(),g.autoplay===!1&&this.pause()}initAnimation(){const{options:g}=this;nC(g);const{type:w=Z_,repeat:S=0,repeatDelay:A=0,repeatType:L,velocity:N=0}=g;let{keyframes:r}=g;const F=w||Z_;F!==Z_&&typeof r[0]!="number"&&(this.mixKeyframes=hy(yN,eC(r[0],r[1])),r=[0,100]);const B=F({...g,keyframes:r});L==="mirror"&&(this.mirroredGenerator=F({...g,keyframes:[...r].reverse(),velocity:-N})),B.calculatedDuration===null&&(B.calculatedDuration=v1(B));const{calculatedDuration:$}=B;this.calculatedDuration=$,this.resolvedDuration=$+A,this.totalDuration=this.resolvedDuration*(S+1)-A,this.generator=B}updateTime(g){const w=Math.round(g-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=w}tick(g,w=!1){const{generator:S,totalDuration:A,mixKeyframes:L,mirroredGenerator:N,resolvedDuration:r,calculatedDuration:F}=this;if(this.startTime===null)return S.next(0);const{delay:B=0,keyframes:$,repeat:ie,repeatType:re,repeatDelay:Te,type:_e,onUpdate:me,finalKeyframe:ge}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,g):this.speed<0&&(this.startTime=Math.min(g-A/this.speed,this.startTime)),w?this.currentTime=g:this.updateTime(g);const pe=this.currentTime-B*(this.playbackSpeed>=0?1:-1),fe=this.playbackSpeed>=0?pe<0:pe>A;this.currentTime=Math.max(pe,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=A);let se=this.currentTime,De=S;if(ie){const gt=Math.min(this.currentTime,A)/r;let Xe=Math.floor(gt),je=gt%1;!je&&gt>=1&&(je=1),je===1&&Xe--,Xe=Math.min(Xe,ie+1),!!(Xe%2)&&(re==="reverse"?(je=1-je,Te&&(je-=Te/r)):re==="mirror"&&(De=N)),se=lf(0,1,je)*r}const we=fe?{done:!1,value:$[0]}:De.next(se);L&&(we.value=L(we.value));let{done:ht}=we;!fe&&F!==null&&(ht=this.playbackSpeed>=0?this.currentTime>=A:this.currentTime<=0);const At=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ht);return At&&_e!==vb&&(we.value=x1($,this.options,ge,this.speed)),me&&me(we.value),At&&this.finish(),we}then(g,w){return this.finished.then(g,w)}get duration(){return ed(this.calculatedDuration)}get time(){return ed(this.currentTime)}set time(g){g=Jh(g),this.currentTime=g,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=g:this.driver&&(this.startTime=this.driver.now()-g/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(g){this.updateTime(cc.now());const w=this.playbackSpeed!==g;this.playbackSpeed=g,w&&(this.time=ed(this.currentTime))}play(){if(this.isStopped)return;const{driver:g=tN,startTime:w}=this.options;this.driver||(this.driver=g(A=>this.tick(A))),this.options.onPlay?.();const S=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=S):this.holdTime!==null?this.startTime=S-this.holdTime:this.startTime||(this.startTime=w??S),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(cc.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(g){return this.startTime=0,this.tick(g,!0)}attachTimeline(g){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),g.observe(this)}}function vN(f){for(let g=1;g<f.length;g++)f[g]??(f[g]=f[g-1])}const Em=f=>f*180/Math.PI,xb=f=>{const g=Em(Math.atan2(f[1],f[0]));return bb(g)},xN={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:f=>(Math.abs(f[0])+Math.abs(f[3]))/2,rotate:xb,rotateZ:xb,skewX:f=>Em(Math.atan(f[1])),skewY:f=>Em(Math.atan(f[2])),skew:f=>(Math.abs(f[1])+Math.abs(f[2]))/2},bb=f=>(f=f%360,f<0&&(f+=360),f),m2=xb,g2=f=>Math.sqrt(f[0]*f[0]+f[1]*f[1]),_2=f=>Math.sqrt(f[4]*f[4]+f[5]*f[5]),bN={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:g2,scaleY:_2,scale:f=>(g2(f)+_2(f))/2,rotateX:f=>bb(Em(Math.atan2(f[6],f[5]))),rotateY:f=>bb(Em(Math.atan2(-f[2],f[0]))),rotateZ:m2,rotate:m2,skewX:f=>Em(Math.atan(f[4])),skewY:f=>Em(Math.atan(f[1])),skew:f=>(Math.abs(f[1])+Math.abs(f[4]))/2};function wb(f){return f.includes("scale")?1:0}function Tb(f,g){if(!f||f==="none")return wb(g);const w=f.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let S,A;if(w)S=bN,A=w;else{const r=f.match(/^matrix\(([-\d.e\s,]+)\)$/u);S=xN,A=r}if(!A)return wb(g);const L=S[g],N=A[1].split(",").map(TN);return typeof L=="function"?L(N):N[L]}const wN=(f,g)=>{const{transform:w="none"}=getComputedStyle(f);return Tb(w,g)};function TN(f){return parseFloat(f.trim())}const Ng=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Fg=new Set(Ng),y2=f=>f===kg||f===Wn,SN=new Set(["x","y","z"]),EN=Ng.filter(f=>!SN.has(f));function AN(f){const g=[];return EN.forEach(w=>{const S=f.getValue(w);S!==void 0&&(g.push([w,S.get()]),S.set(w.startsWith("scale")?1:0))}),g}const Am={width:({x:f},{paddingLeft:g="0",paddingRight:w="0"})=>f.max-f.min-parseFloat(g)-parseFloat(w),height:({y:f},{paddingTop:g="0",paddingBottom:w="0"})=>f.max-f.min-parseFloat(g)-parseFloat(w),top:(f,{top:g})=>parseFloat(g),left:(f,{left:g})=>parseFloat(g),bottom:({y:f},{top:g})=>parseFloat(g)+(f.max-f.min),right:({x:f},{left:g})=>parseFloat(g)+(f.max-f.min),x:(f,{transform:g})=>Tb(g,"x"),y:(f,{transform:g})=>Tb(g,"y")};Am.translateX=Am.x;Am.translateY=Am.y;const Cm=new Set;let Sb=!1,Eb=!1,Ab=!1;function rC(){if(Eb){const f=Array.from(Cm).filter(S=>S.needsMeasurement),g=new Set(f.map(S=>S.element)),w=new Map;g.forEach(S=>{const A=AN(S);A.length&&(w.set(S,A),S.render())}),f.forEach(S=>S.measureInitialState()),g.forEach(S=>{S.render();const A=w.get(S);A&&A.forEach(([L,N])=>{S.getValue(L)?.set(N)})}),f.forEach(S=>S.measureEndState()),f.forEach(S=>{S.suspendedScrollY!==void 0&&window.scrollTo(0,S.suspendedScrollY)})}Eb=!1,Sb=!1,Cm.forEach(f=>f.complete(Ab)),Cm.clear()}function sC(){Cm.forEach(f=>{f.readKeyframes(),f.needsMeasurement&&(Eb=!0)})}function CN(){Ab=!0,sC(),rC(),Ab=!1}class T1{constructor(g,w,S,A,L,N=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...g],this.onComplete=w,this.name=S,this.motionValue=A,this.element=L,this.isAsync=N}scheduleResolve(){this.state="scheduled",this.isAsync?(Cm.add(this),Sb||(Sb=!0,Ws.read(sC),Ws.resolveKeyframes(rC))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:g,name:w,element:S,motionValue:A}=this;if(g[0]===null){const L=A?.get(),N=g[g.length-1];if(L!==void 0)g[0]=L;else if(S&&w){const r=S.readValue(w,N);r!=null&&(g[0]=r)}g[0]===void 0&&(g[0]=N),A&&L===void 0&&A.set(g[0])}vN(g)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(g=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,g),Cm.delete(this)}cancel(){this.state==="scheduled"&&(Cm.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const MN=f=>f.startsWith("--");function IN(f,g,w){MN(g)?f.style.setProperty(g,w):f.style[g]=w}const RN=u1(()=>window.ScrollTimeline!==void 0),DN={};function PN(f,g){const w=u1(f);return()=>DN[g]??w()}const aC=PN(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),q_=([f,g,w,S])=>`cubic-bezier(${f}, ${g}, ${w}, ${S})`,v2={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:q_([0,.65,.55,1]),circOut:q_([.55,0,1,.45]),backIn:q_([.31,.01,.66,-.59]),backOut:q_([.33,1.53,.69,.99])};function oC(f,g){if(f)return typeof f=="function"?aC()?tC(f,g):"ease-out":qA(f)?q_(f):Array.isArray(f)?f.map(w=>oC(w,g)||v2.easeOut):v2[f]}function ON(f,g,w,{delay:S=0,duration:A=300,repeat:L=0,repeatType:N="loop",ease:r="easeOut",times:F}={},B=void 0){const $={[g]:w};F&&($.offset=F);const ie=oC(r,A);Array.isArray(ie)&&($.easing=ie);const re={delay:S,duration:A,easing:Array.isArray(ie)?"linear":ie,fill:"both",iterations:L+1,direction:N==="reverse"?"alternate":"normal"};return B&&(re.pseudoElement=B),f.animate($,re)}function lC(f){return typeof f=="function"&&"applyToOptions"in f}function LN({type:f,...g}){return lC(f)&&aC()?f.applyToOptions(g):(g.duration??(g.duration=300),g.ease??(g.ease="easeOut"),g)}class zN extends b1{constructor(g){if(super(),this.finishedTime=null,this.isStopped=!1,!g)return;const{element:w,name:S,keyframes:A,pseudoElement:L,allowFlatten:N=!1,finalKeyframe:r,onComplete:F}=g;this.isPseudoElement=!!L,this.allowFlatten=N,this.options=g,c1(typeof g.type!="string");const B=LN(g);this.animation=ON(w,S,A,B,L),B.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!L){const $=x1(A,this.options,r,this.speed);this.updateMotionValue?this.updateMotionValue($):IN(w,S,$),this.animation.cancel()}F?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:g}=this;g==="idle"||g==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const g=this.animation.effect?.getComputedTiming?.().duration||0;return ed(Number(g))}get time(){return ed(Number(this.animation.currentTime)||0)}set time(g){this.finishedTime=null,this.animation.currentTime=Jh(g)}get speed(){return this.animation.playbackRate}set speed(g){g<0&&(this.finishedTime=null),this.animation.playbackRate=g}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(g){this.animation.startTime=g}attachTimeline({timeline:g,observe:w}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,g&&RN()?(this.animation.timeline=g,mu):w(this)}}const cC={anticipate:VA,backInOut:jA,circInOut:GA};function kN(f){return f in cC}function NN(f){typeof f.ease=="string"&&kN(f.ease)&&(f.ease=cC[f.ease])}const x2=10;class FN extends zN{constructor(g){NN(g),nC(g),super(g),g.startTime&&(this.startTime=g.startTime),this.options=g}updateMotionValue(g){const{motionValue:w,onUpdate:S,onComplete:A,element:L,...N}=this.options;if(!w)return;if(g!==void 0){w.set(g);return}const r=new w1({...N,autoplay:!1}),F=Jh(this.finishedTime??this.time);w.setWithVelocity(r.sample(F-x2).value,r.sample(F).value,x2),r.stop()}}const b2=(f,g)=>g==="zIndex"?!1:!!(typeof f=="number"||Array.isArray(f)||typeof f=="string"&&(mp.test(f)||f==="0")&&!f.startsWith("url("));function BN(f){const g=f[0];if(f.length===1)return!0;for(let w=0;w<f.length;w++)if(f[w]!==g)return!0}function jN(f,g,w,S){const A=f[0];if(A===null)return!1;if(g==="display"||g==="visibility")return!0;const L=f[f.length-1],N=b2(A,g),r=b2(L,g);return!N||!r?!1:BN(f)||(w==="spring"||lC(w))&&S}function Cb(f){f.duration=0,f.type}const VN=new Set(["opacity","clipPath","filter","transform"]),UN=u1(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function GN(f){const{motionValue:g,name:w,repeatDelay:S,repeatType:A,damping:L,type:N}=f;if(!(g?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:F,transformTemplate:B}=g.owner.getProps();return UN()&&w&&VN.has(w)&&(w!=="transform"||!B)&&!F&&!S&&A!=="mirror"&&L!==0&&N!=="inertia"}const HN=40;class qN extends b1{constructor({autoplay:g=!0,delay:w=0,type:S="keyframes",repeat:A=0,repeatDelay:L=0,repeatType:N="loop",keyframes:r,name:F,motionValue:B,element:$,...ie}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=cc.now();const re={autoplay:g,delay:w,type:S,repeat:A,repeatDelay:L,repeatType:N,name:F,motionValue:B,element:$,...ie},Te=$?.KeyframeResolver||T1;this.keyframeResolver=new Te(r,(_e,me,ge)=>this.onKeyframesResolved(_e,me,re,!ge),F,B,$),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(g,w,S,A){this.keyframeResolver=void 0;const{name:L,type:N,velocity:r,delay:F,isHandoff:B,onUpdate:$}=S;this.resolvedAt=cc.now(),jN(g,L,N,r)||((cf.instantAnimations||!F)&&$?.(x1(g,S,w)),g[0]=g[g.length-1],Cb(S),S.repeat=0);const re={startTime:A?this.resolvedAt?this.resolvedAt-this.createdAt>HN?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:w,...S,keyframes:g},Te=!B&&GN(re)?new FN({...re,element:re.motionValue.owner.current}):new w1(re);Te.finished.then(()=>this.notifyFinished()).catch(mu),this.pendingTimeline&&(this.stopTimeline=Te.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=Te}get finished(){return this._animation?this.animation.finished:this._finished}then(g,w){return this.finished.finally(g).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),CN()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(g){this.animation.time=g}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(g){this.animation.speed=g}get startTime(){return this.animation.startTime}attachTimeline(g){return this._animation?this.stopTimeline=this.animation.attachTimeline(g):this.pendingTimeline=g,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const $N=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function ZN(f){const g=$N.exec(f);if(!g)return[,];const[,w,S,A]=g;return[`--${w??S}`,A]}function uC(f,g,w=1){const[S,A]=ZN(f);if(!S)return;const L=window.getComputedStyle(g).getPropertyValue(S);if(L){const N=L.trim();return PA(N)?parseFloat(N):N}return m1(A)?uC(A,g,w+1):A}function S1(f,g){return f?.[g]??f?.default??f}const hC=new Set(["width","height","top","left","right","bottom",...Ng]),WN={test:f=>f==="auto",parse:f=>f},dC=f=>g=>g.test(f),fC=[kg,Wn,td,dp,Bk,Fk,WN],w2=f=>fC.find(dC(f));function XN(f){return typeof f=="number"?f===0:f!==null?f==="none"||f==="0"||LA(f):!0}const YN=new Set(["brightness","contrast","saturate","opacity"]);function KN(f){const[g,w]=f.slice(0,-1).split("(");if(g==="drop-shadow")return f;const[S]=w.match(g1)||[];if(!S)return f;const A=w.replace(S,"");let L=YN.has(g)?1:0;return S!==w&&(L*=100),g+"("+L+A+")"}const QN=/\b([a-z-]*)\(.*?\)/gu,Mb={...mp,getAnimatableNone:f=>{const g=f.match(QN);return g?g.map(KN).join(" "):f}},T2={...kg,transform:Math.round},JN={rotate:dp,rotateX:dp,rotateY:dp,rotateZ:dp,scale:Lv,scaleX:Lv,scaleY:Lv,scaleZ:Lv,skew:dp,skewX:dp,skewY:dp,distance:Wn,translateX:Wn,translateY:Wn,translateZ:Wn,x:Wn,y:Wn,z:Wn,perspective:Wn,transformPerspective:Wn,opacity:iy,originX:u2,originY:u2,originZ:Wn},E1={borderWidth:Wn,borderTopWidth:Wn,borderRightWidth:Wn,borderBottomWidth:Wn,borderLeftWidth:Wn,borderRadius:Wn,radius:Wn,borderTopLeftRadius:Wn,borderTopRightRadius:Wn,borderBottomRightRadius:Wn,borderBottomLeftRadius:Wn,width:Wn,maxWidth:Wn,height:Wn,maxHeight:Wn,top:Wn,right:Wn,bottom:Wn,left:Wn,padding:Wn,paddingTop:Wn,paddingRight:Wn,paddingBottom:Wn,paddingLeft:Wn,margin:Wn,marginTop:Wn,marginRight:Wn,marginBottom:Wn,marginLeft:Wn,backgroundPositionX:Wn,backgroundPositionY:Wn,...JN,zIndex:T2,fillOpacity:iy,strokeOpacity:iy,numOctaves:T2},eF={...E1,color:Ka,backgroundColor:Ka,outlineColor:Ka,fill:Ka,stroke:Ka,borderColor:Ka,borderTopColor:Ka,borderRightColor:Ka,borderBottomColor:Ka,borderLeftColor:Ka,filter:Mb,WebkitFilter:Mb},pC=f=>eF[f];function mC(f,g){let w=pC(f);return w!==Mb&&(w=mp),w.getAnimatableNone?w.getAnimatableNone(g):void 0}const tF=new Set(["auto","none","0"]);function iF(f,g,w){let S=0,A;for(;S<f.length&&!A;){const L=f[S];typeof L=="string"&&!tF.has(L)&&ny(L).values.length&&(A=f[S]),S++}if(A&&w)for(const L of g)f[L]=mC(w,A)}class nF extends T1{constructor(g,w,S,A,L){super(g,w,S,A,L,!0)}readKeyframes(){const{unresolvedKeyframes:g,element:w,name:S}=this;if(!w||!w.current)return;super.readKeyframes();for(let F=0;F<g.length;F++){let B=g[F];if(typeof B=="string"&&(B=B.trim(),m1(B))){const $=uC(B,w.current);$!==void 0&&(g[F]=$),F===g.length-1&&(this.finalKeyframe=B)}}if(this.resolveNoneKeyframes(),!hC.has(S)||g.length!==2)return;const[A,L]=g,N=w2(A),r=w2(L);if(N!==r)if(y2(N)&&y2(r))for(let F=0;F<g.length;F++){const B=g[F];typeof B=="string"&&(g[F]=parseFloat(B))}else Am[S]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:g,name:w}=this,S=[];for(let A=0;A<g.length;A++)(g[A]===null||XN(g[A]))&&S.push(A);S.length&&iF(g,S,w)}measureInitialState(){const{element:g,unresolvedKeyframes:w,name:S}=this;if(!g||!g.current)return;S==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Am[S](g.measureViewportBox(),window.getComputedStyle(g.current)),w[0]=this.measuredOrigin;const A=w[w.length-1];A!==void 0&&g.getValue(S,A).jump(A,!1)}measureEndState(){const{element:g,name:w,unresolvedKeyframes:S}=this;if(!g||!g.current)return;const A=g.getValue(w);A&&A.jump(this.measuredOrigin,!1);const L=S.length-1,N=S[L];S[L]=Am[w](g.measureViewportBox(),window.getComputedStyle(g.current)),N!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=N),this.removedTransforms?.length&&this.removedTransforms.forEach(([r,F])=>{g.getValue(r).set(F)}),this.resolveNoneKeyframes()}}function rF(f,g,w){if(f instanceof EventTarget)return[f];if(typeof f=="string"){let S=document;const A=w?.[f]??S.querySelectorAll(f);return A?Array.from(A):[]}return Array.from(f)}const gC=(f,g)=>g&&typeof f=="number"?g.transform(f):f;function sF(f){return OA(f)&&"offsetHeight"in f}const S2=30,aF=f=>!isNaN(parseFloat(f));class oF{constructor(g,w={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=S=>{const A=cc.now();if(this.updatedAt!==A&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(S),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const L of this.dependents)L.dirty()},this.hasAnimated=!1,this.setCurrent(g),this.owner=w.owner}setCurrent(g){this.current=g,this.updatedAt=cc.now(),this.canTrackVelocity===null&&g!==void 0&&(this.canTrackVelocity=aF(this.current))}setPrevFrameValue(g=this.current){this.prevFrameValue=g,this.prevUpdatedAt=this.updatedAt}onChange(g){return this.on("change",g)}on(g,w){this.events[g]||(this.events[g]=new h1);const S=this.events[g].add(w);return g==="change"?()=>{S(),Ws.read(()=>{this.events.change.getSize()||this.stop()})}:S}clearListeners(){for(const g in this.events)this.events[g].clear()}attach(g,w){this.passiveEffect=g,this.stopPassiveEffect=w}set(g){this.passiveEffect?this.passiveEffect(g,this.updateAndNotify):this.updateAndNotify(g)}setWithVelocity(g,w,S){this.set(w),this.prev=void 0,this.prevFrameValue=g,this.prevUpdatedAt=this.updatedAt-S}jump(g,w=!0){this.updateAndNotify(g),this.prev=g,this.prevUpdatedAt=this.prevFrameValue=void 0,w&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(g){this.dependents||(this.dependents=new Set),this.dependents.add(g)}removeDependent(g){this.dependents&&this.dependents.delete(g)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const g=cc.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||g-this.updatedAt>S2)return 0;const w=Math.min(this.updatedAt-this.prevUpdatedAt,S2);return zA(parseFloat(this.current)-parseFloat(this.prevFrameValue),w)}start(g){return this.stop(),new Promise(w=>{this.hasAnimated=!0,this.animation=g(w),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Rg(f,g){return new oF(f,g)}const{schedule:A1}=$A(queueMicrotask,!1),Ju={x:!1,y:!1};function _C(){return Ju.x||Ju.y}function lF(f){return f==="x"||f==="y"?Ju[f]?null:(Ju[f]=!0,()=>{Ju[f]=!1}):Ju.x||Ju.y?null:(Ju.x=Ju.y=!0,()=>{Ju.x=Ju.y=!1})}function yC(f,g){const w=rF(f),S=new AbortController,A={passive:!0,...g,signal:S.signal};return[w,A,()=>S.abort()]}function E2(f){return!(f.pointerType==="touch"||_C())}function cF(f,g,w={}){const[S,A,L]=yC(f,w),N=r=>{if(!E2(r))return;const{target:F}=r,B=g(F,r);if(typeof B!="function"||!F)return;const $=ie=>{E2(ie)&&(B(ie),F.removeEventListener("pointerleave",$))};F.addEventListener("pointerleave",$,A)};return S.forEach(r=>{r.addEventListener("pointerenter",N,A)}),L}const vC=(f,g)=>g?f===g?!0:vC(f,g.parentElement):!1,C1=f=>f.pointerType==="mouse"?typeof f.button!="number"||f.button<=0:f.isPrimary!==!1,uF=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function hF(f){return uF.has(f.tagName)||f.tabIndex!==-1}const Hv=new WeakSet;function A2(f){return g=>{g.key==="Enter"&&f(g)}}function Wx(f,g){f.dispatchEvent(new PointerEvent("pointer"+g,{isPrimary:!0,bubbles:!0}))}const dF=(f,g)=>{const w=f.currentTarget;if(!w)return;const S=A2(()=>{if(Hv.has(w))return;Wx(w,"down");const A=A2(()=>{Wx(w,"up")}),L=()=>Wx(w,"cancel");w.addEventListener("keyup",A,g),w.addEventListener("blur",L,g)});w.addEventListener("keydown",S,g),w.addEventListener("blur",()=>w.removeEventListener("keydown",S),g)};function C2(f){return C1(f)&&!_C()}function fF(f,g,w={}){const[S,A,L]=yC(f,w),N=r=>{const F=r.currentTarget;if(!C2(r))return;Hv.add(F);const B=g(F,r),$=(Te,_e)=>{window.removeEventListener("pointerup",ie),window.removeEventListener("pointercancel",re),Hv.has(F)&&Hv.delete(F),C2(Te)&&typeof B=="function"&&B(Te,{success:_e})},ie=Te=>{$(Te,F===window||F===document||w.useGlobalTarget||vC(F,Te.target))},re=Te=>{$(Te,!1)};window.addEventListener("pointerup",ie,A),window.addEventListener("pointercancel",re,A)};return S.forEach(r=>{(w.useGlobalTarget?window:r).addEventListener("pointerdown",N,A),sF(r)&&(r.addEventListener("focus",B=>dF(B,A)),!hF(r)&&!r.hasAttribute("tabindex")&&(r.tabIndex=0))}),L}function xC(f){return OA(f)&&"ownerSVGElement"in f}function pF(f){return xC(f)&&f.tagName==="svg"}const ul=f=>!!(f&&f.getVelocity),mF=[...fC,Ka,mp],gF=f=>mF.find(dC(f)),bC=Re.createContext({transformPagePoint:f=>f,isStatic:!1,reducedMotion:"never"});function _F(f=!0){const g=Re.useContext(a1);if(g===null)return[!0,null];const{isPresent:w,onExitComplete:S,register:A}=g,L=Re.useId();Re.useEffect(()=>{if(f)return A(L)},[f]);const N=Re.useCallback(()=>f&&S&&S(L),[L,S,f]);return!w&&S?[!1,N]:[!0]}const wC=Re.createContext({strict:!1}),M2={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Dg={};for(const f in M2)Dg[f]={isEnabled:g=>M2[f].some(w=>!!g[w])};function yF(f){for(const g in f)Dg[g]={...Dg[g],...f[g]}}const vF=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function o0(f){return f.startsWith("while")||f.startsWith("drag")&&f!=="draggable"||f.startsWith("layout")||f.startsWith("onTap")||f.startsWith("onPan")||f.startsWith("onLayout")||vF.has(f)}let TC=f=>!o0(f);function xF(f){typeof f=="function"&&(TC=g=>g.startsWith("on")?!o0(g):f(g))}try{xF(require("@emotion/is-prop-valid").default)}catch{}function bF(f,g,w){const S={};for(const A in f)A==="values"&&typeof f.values=="object"||(TC(A)||w===!0&&o0(A)||!g&&!o0(A)||f.draggable&&A.startsWith("onDrag"))&&(S[A]=f[A]);return S}const g0=Re.createContext({});function _0(f){return f!==null&&typeof f=="object"&&typeof f.start=="function"}function ry(f){return typeof f=="string"||Array.isArray(f)}const M1=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],I1=["initial",...M1];function y0(f){return _0(f.animate)||I1.some(g=>ry(f[g]))}function SC(f){return!!(y0(f)||f.variants)}function wF(f,g){if(y0(f)){const{initial:w,animate:S}=f;return{initial:w===!1||ry(w)?w:void 0,animate:ry(S)?S:void 0}}return f.inherit!==!1?g:{}}function TF(f){const{initial:g,animate:w}=wF(f,Re.useContext(g0));return Re.useMemo(()=>({initial:g,animate:w}),[I2(g),I2(w)])}function I2(f){return Array.isArray(f)?f.join(" "):f}const sy={};function SF(f){for(const g in f)sy[g]=f[g],p1(g)&&(sy[g].isCSSVariable=!0)}function EC(f,{layout:g,layoutId:w}){return Fg.has(f)||f.startsWith("origin")||(g||w!==void 0)&&(!!sy[f]||f==="opacity")}const EF={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},AF=Ng.length;function CF(f,g,w){let S="",A=!0;for(let L=0;L<AF;L++){const N=Ng[L],r=f[N];if(r===void 0)continue;let F=!0;if(typeof r=="number"?F=r===(N.startsWith("scale")?1:0):F=parseFloat(r)===0,!F||w){const B=gC(r,E1[N]);if(!F){A=!1;const $=EF[N]||N;S+=`${$}(${B}) `}w&&(g[N]=B)}}return S=S.trim(),w?S=w(g,A?"":S):A&&(S="none"),S}function R1(f,g,w){const{style:S,vars:A,transformOrigin:L}=f;let N=!1,r=!1;for(const F in g){const B=g[F];if(Fg.has(F)){N=!0;continue}else if(p1(F)){A[F]=B;continue}else{const $=gC(B,E1[F]);F.startsWith("origin")?(r=!0,L[F]=$):S[F]=$}}if(g.transform||(N||w?S.transform=CF(g,f.transform,w):S.transform&&(S.transform="none")),r){const{originX:F="50%",originY:B="50%",originZ:$=0}=L;S.transformOrigin=`${F} ${B} ${$}`}}const D1=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function AC(f,g,w){for(const S in g)!ul(g[S])&&!EC(S,w)&&(f[S]=g[S])}function MF({transformTemplate:f},g){return Re.useMemo(()=>{const w=D1();return R1(w,g,f),Object.assign({},w.vars,w.style)},[g])}function IF(f,g){const w=f.style||{},S={};return AC(S,w,f),Object.assign(S,MF(f,g)),S}function RF(f,g){const w={},S=IF(f,g);return f.drag&&f.dragListener!==!1&&(w.draggable=!1,S.userSelect=S.WebkitUserSelect=S.WebkitTouchCallout="none",S.touchAction=f.drag===!0?"none":`pan-${f.drag==="x"?"y":"x"}`),f.tabIndex===void 0&&(f.onTap||f.onTapStart||f.whileTap)&&(w.tabIndex=0),w.style=S,w}const DF={offset:"stroke-dashoffset",array:"stroke-dasharray"},PF={offset:"strokeDashoffset",array:"strokeDasharray"};function OF(f,g,w=1,S=0,A=!0){f.pathLength=1;const L=A?DF:PF;f[L.offset]=Wn.transform(-S);const N=Wn.transform(g),r=Wn.transform(w);f[L.array]=`${N} ${r}`}function CC(f,{attrX:g,attrY:w,attrScale:S,pathLength:A,pathSpacing:L=1,pathOffset:N=0,...r},F,B,$){if(R1(f,r,B),F){f.style.viewBox&&(f.attrs.viewBox=f.style.viewBox);return}f.attrs=f.style,f.style={};const{attrs:ie,style:re}=f;ie.transform&&(re.transform=ie.transform,delete ie.transform),(re.transform||ie.transformOrigin)&&(re.transformOrigin=ie.transformOrigin??"50% 50%",delete ie.transformOrigin),re.transform&&(re.transformBox=$?.transformBox??"fill-box",delete ie.transformBox),g!==void 0&&(ie.x=g),w!==void 0&&(ie.y=w),S!==void 0&&(ie.scale=S),A!==void 0&&OF(ie,A,L,N,!1)}const MC=()=>({...D1(),attrs:{}}),IC=f=>typeof f=="string"&&f.toLowerCase()==="svg";function LF(f,g,w,S){const A=Re.useMemo(()=>{const L=MC();return CC(L,g,IC(S),f.transformTemplate,f.style),{...L.attrs,style:{...L.style}}},[g]);if(f.style){const L={};AC(L,f.style,f),A.style={...L,...A.style}}return A}const zF=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function P1(f){return typeof f!="string"||f.includes("-")?!1:!!(zF.indexOf(f)>-1||/[A-Z]/u.test(f))}function kF(f,g,w,{latestValues:S},A,L=!1){const r=(P1(f)?LF:RF)(g,S,A,f),F=bF(g,typeof f=="string",L),B=f!==Re.Fragment?{...F,...r,ref:w}:{},{children:$}=g,ie=Re.useMemo(()=>ul($)?$.get():$,[$]);return Re.createElement(f,{...B,children:ie})}function R2(f){const g=[{},{}];return f?.values.forEach((w,S)=>{g[0][S]=w.get(),g[1][S]=w.getVelocity()}),g}function O1(f,g,w,S){if(typeof g=="function"){const[A,L]=R2(S);g=g(w!==void 0?w:f.custom,A,L)}if(typeof g=="string"&&(g=f.variants&&f.variants[g]),typeof g=="function"){const[A,L]=R2(S);g=g(w!==void 0?w:f.custom,A,L)}return g}function qv(f){return ul(f)?f.get():f}function NF({scrapeMotionValuesFromProps:f,createRenderState:g},w,S,A){return{latestValues:FF(w,S,A,f),renderState:g()}}function FF(f,g,w,S){const A={},L=S(f,{});for(const re in L)A[re]=qv(L[re]);let{initial:N,animate:r}=f;const F=y0(f),B=SC(f);g&&B&&!F&&f.inherit!==!1&&(N===void 0&&(N=g.initial),r===void 0&&(r=g.animate));let $=w?w.initial===!1:!1;$=$||N===!1;const ie=$?r:N;if(ie&&typeof ie!="boolean"&&!_0(ie)){const re=Array.isArray(ie)?ie:[ie];for(let Te=0;Te<re.length;Te++){const _e=O1(f,re[Te]);if(_e){const{transitionEnd:me,transition:ge,...pe}=_e;for(const fe in pe){let se=pe[fe];if(Array.isArray(se)){const De=$?se.length-1:0;se=se[De]}se!==null&&(A[fe]=se)}for(const fe in me)A[fe]=me[fe]}}}return A}const RC=f=>(g,w)=>{const S=Re.useContext(g0),A=Re.useContext(a1),L=()=>NF(f,g,S,A);return w?L():yk(L)};function L1(f,g,w){const{style:S}=f,A={};for(const L in S)(ul(S[L])||g.style&&ul(g.style[L])||EC(L,f)||w?.getValue(L)?.liveStyle!==void 0)&&(A[L]=S[L]);return A}const BF=RC({scrapeMotionValuesFromProps:L1,createRenderState:D1});function DC(f,g,w){const S=L1(f,g,w);for(const A in f)if(ul(f[A])||ul(g[A])){const L=Ng.indexOf(A)!==-1?"attr"+A.charAt(0).toUpperCase()+A.substring(1):A;S[L]=f[A]}return S}const jF=RC({scrapeMotionValuesFromProps:DC,createRenderState:MC}),VF=Symbol.for("motionComponentSymbol");function Tg(f){return f&&typeof f=="object"&&Object.prototype.hasOwnProperty.call(f,"current")}function UF(f,g,w){return Re.useCallback(S=>{S&&f.onMount&&f.onMount(S),g&&(S?g.mount(S):g.unmount()),w&&(typeof w=="function"?w(S):Tg(w)&&(w.current=S))},[g])}const z1=f=>f.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),GF="framerAppearId",PC="data-"+z1(GF),OC=Re.createContext({});function HF(f,g,w,S,A){const{visualElement:L}=Re.useContext(g0),N=Re.useContext(wC),r=Re.useContext(a1),F=Re.useContext(bC).reducedMotion,B=Re.useRef(null);S=S||N.renderer,!B.current&&S&&(B.current=S(f,{visualState:g,parent:L,props:w,presenceContext:r,blockInitialAnimation:r?r.initial===!1:!1,reducedMotionConfig:F}));const $=B.current,ie=Re.useContext(OC);$&&!$.projection&&A&&($.type==="html"||$.type==="svg")&&qF(B.current,w,A,ie);const re=Re.useRef(!1);Re.useInsertionEffect(()=>{$&&re.current&&$.update(w,r)});const Te=w[PC],_e=Re.useRef(!!Te&&!window.MotionHandoffIsComplete?.(Te)&&window.MotionHasOptimisedAnimation?.(Te));return vk(()=>{$&&(re.current=!0,window.MotionIsMounted=!0,$.updateFeatures(),$.scheduleRenderMicrotask(),_e.current&&$.animationState&&$.animationState.animateChanges())}),Re.useEffect(()=>{$&&(!_e.current&&$.animationState&&$.animationState.animateChanges(),_e.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(Te)}),_e.current=!1),$.enteringChildren=void 0)}),$}function qF(f,g,w,S){const{layoutId:A,layout:L,drag:N,dragConstraints:r,layoutScroll:F,layoutRoot:B,layoutCrossfade:$}=g;f.projection=new w(f.latestValues,g["data-framer-portal-id"]?void 0:LC(f.parent)),f.projection.setOptions({layoutId:A,layout:L,alwaysMeasureLayout:!!N||r&&Tg(r),visualElement:f,animationType:typeof L=="string"?L:"both",initialPromotionConfig:S,crossfade:$,layoutScroll:F,layoutRoot:B})}function LC(f){if(f)return f.options.allowProjection!==!1?f.projection:LC(f.parent)}function Xx(f,{forwardMotionProps:g=!1}={},w,S){w&&yF(w);const A=P1(f)?jF:BF;function L(r,F){let B;const $={...Re.useContext(bC),...r,layoutId:$F(r)},{isStatic:ie}=$,re=TF(r),Te=A(r,ie);if(!ie&&s1){ZF();const _e=WF($);B=_e.MeasureLayout,re.visualElement=HF(f,Te,$,S,_e.ProjectionNode)}return W.jsxs(g0.Provider,{value:re,children:[B&&re.visualElement?W.jsx(B,{visualElement:re.visualElement,...$}):null,kF(f,r,UF(Te,re.visualElement,F),Te,ie,g)]})}L.displayName=`motion.${typeof f=="string"?f:`create(${f.displayName??f.name??""})`}`;const N=Re.forwardRef(L);return N[VF]=f,N}function $F({layoutId:f}){const g=Re.useContext(DA).id;return g&&f!==void 0?g+"-"+f:f}function ZF(f,g){Re.useContext(wC).strict}function WF(f){const{drag:g,layout:w}=Dg;if(!g&&!w)return{};const S={...g,...w};return{MeasureLayout:g?.isEnabled(f)||w?.isEnabled(f)?S.MeasureLayout:void 0,ProjectionNode:S.ProjectionNode}}function XF(f,g){if(typeof Proxy>"u")return Xx;const w=new Map,S=(L,N)=>Xx(L,N,f,g),A=(L,N)=>S(L,N);return new Proxy(A,{get:(L,N)=>N==="create"?S:(w.has(N)||w.set(N,Xx(N,void 0,f,g)),w.get(N))})}function zC({top:f,left:g,right:w,bottom:S}){return{x:{min:g,max:w},y:{min:f,max:S}}}function YF({x:f,y:g}){return{top:g.min,right:f.max,bottom:g.max,left:f.min}}function KF(f,g){if(!g)return f;const w=g({x:f.left,y:f.top}),S=g({x:f.right,y:f.bottom});return{top:w.y,left:w.x,bottom:S.y,right:S.x}}function Yx(f){return f===void 0||f===1}function Ib({scale:f,scaleX:g,scaleY:w}){return!Yx(f)||!Yx(g)||!Yx(w)}function Tm(f){return Ib(f)||kC(f)||f.z||f.rotate||f.rotateX||f.rotateY||f.skewX||f.skewY}function kC(f){return D2(f.x)||D2(f.y)}function D2(f){return f&&f!=="0%"}function l0(f,g,w){const S=f-w,A=g*S;return w+A}function P2(f,g,w,S,A){return A!==void 0&&(f=l0(f,A,S)),l0(f,w,S)+g}function Rb(f,g=0,w=1,S,A){f.min=P2(f.min,g,w,S,A),f.max=P2(f.max,g,w,S,A)}function NC(f,{x:g,y:w}){Rb(f.x,g.translate,g.scale,g.originPoint),Rb(f.y,w.translate,w.scale,w.originPoint)}const O2=.999999999999,L2=1.0000000000001;function QF(f,g,w,S=!1){const A=w.length;if(!A)return;g.x=g.y=1;let L,N;for(let r=0;r<A;r++){L=w[r],N=L.projectionDelta;const{visualElement:F}=L.options;F&&F.props.style&&F.props.style.display==="contents"||(S&&L.options.layoutScroll&&L.scroll&&L!==L.root&&Eg(f,{x:-L.scroll.offset.x,y:-L.scroll.offset.y}),N&&(g.x*=N.x.scale,g.y*=N.y.scale,NC(f,N)),S&&Tm(L.latestValues)&&Eg(f,L.latestValues))}g.x<L2&&g.x>O2&&(g.x=1),g.y<L2&&g.y>O2&&(g.y=1)}function Sg(f,g){f.min=f.min+g,f.max=f.max+g}function z2(f,g,w,S,A=.5){const L=sa(f.min,f.max,A);Rb(f,g,w,L,S)}function Eg(f,g){z2(f.x,g.x,g.scaleX,g.scale,g.originX),z2(f.y,g.y,g.scaleY,g.scale,g.originY)}function FC(f,g){return zC(KF(f.getBoundingClientRect(),g))}function JF(f,g,w){const S=FC(f,w),{scroll:A}=g;return A&&(Sg(S.x,A.offset.x),Sg(S.y,A.offset.y)),S}const k2=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ag=()=>({x:k2(),y:k2()}),N2=()=>({min:0,max:0}),za=()=>({x:N2(),y:N2()}),Db={current:null},BC={current:!1};function e4(){if(BC.current=!0,!!s1)if(window.matchMedia){const f=window.matchMedia("(prefers-reduced-motion)"),g=()=>Db.current=f.matches;f.addEventListener("change",g),g()}else Db.current=!1}const t4=new WeakMap;function i4(f,g,w){for(const S in g){const A=g[S],L=w[S];if(ul(A))f.addValue(S,A);else if(ul(L))f.addValue(S,Rg(A,{owner:f}));else if(L!==A)if(f.hasValue(S)){const N=f.getValue(S);N.liveStyle===!0?N.jump(A):N.hasAnimated||N.set(A)}else{const N=f.getStaticValue(S);f.addValue(S,Rg(N!==void 0?N:A,{owner:f}))}}for(const S in w)g[S]===void 0&&f.removeValue(S);return g}const F2=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class n4{scrapeMotionValuesFromProps(g,w,S){return{}}constructor({parent:g,props:w,presenceContext:S,reducedMotionConfig:A,blockInitialAnimation:L,visualState:N},r={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=T1,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const re=cc.now();this.renderScheduledAt<re&&(this.renderScheduledAt=re,Ws.render(this.render,!1,!0))};const{latestValues:F,renderState:B}=N;this.latestValues=F,this.baseTarget={...F},this.initialValues=w.initial?{...F}:{},this.renderState=B,this.parent=g,this.props=w,this.presenceContext=S,this.depth=g?g.depth+1:0,this.reducedMotionConfig=A,this.options=r,this.blockInitialAnimation=!!L,this.isControllingVariants=y0(w),this.isVariantNode=SC(w),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(g&&g.current);const{willChange:$,...ie}=this.scrapeMotionValuesFromProps(w,{},this);for(const re in ie){const Te=ie[re];F[re]!==void 0&&ul(Te)&&Te.set(F[re])}}mount(g){this.current=g,t4.set(g,this),this.projection&&!this.projection.instance&&this.projection.mount(g),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((w,S)=>this.bindToMotionValue(S,w)),BC.current||e4(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Db.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),pp(this.notifyUpdate),pp(this.render),this.valueSubscriptions.forEach(g=>g()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const g in this.events)this.events[g].clear();for(const g in this.features){const w=this.features[g];w&&(w.unmount(),w.isMounted=!1)}this.current=null}addChild(g){this.children.add(g),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(g)}removeChild(g){this.children.delete(g),this.enteringChildren&&this.enteringChildren.delete(g)}bindToMotionValue(g,w){this.valueSubscriptions.has(g)&&this.valueSubscriptions.get(g)();const S=Fg.has(g);S&&this.onBindTransform&&this.onBindTransform();const A=w.on("change",N=>{this.latestValues[g]=N,this.props.onUpdate&&Ws.preRender(this.notifyUpdate),S&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let L;window.MotionCheckAppearSync&&(L=window.MotionCheckAppearSync(this,g,w)),this.valueSubscriptions.set(g,()=>{A(),L&&L(),w.owner&&w.stop()})}sortNodePosition(g){return!this.current||!this.sortInstanceNodePosition||this.type!==g.type?0:this.sortInstanceNodePosition(this.current,g.current)}updateFeatures(){let g="animation";for(g in Dg){const w=Dg[g];if(!w)continue;const{isEnabled:S,Feature:A}=w;if(!this.features[g]&&A&&S(this.props)&&(this.features[g]=new A(this)),this.features[g]){const L=this.features[g];L.isMounted?L.update():(L.mount(),L.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):za()}getStaticValue(g){return this.latestValues[g]}setStaticValue(g,w){this.latestValues[g]=w}update(g,w){(g.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=g,this.prevPresenceContext=this.presenceContext,this.presenceContext=w;for(let S=0;S<F2.length;S++){const A=F2[S];this.propEventSubscriptions[A]&&(this.propEventSubscriptions[A](),delete this.propEventSubscriptions[A]);const L="on"+A,N=g[L];N&&(this.propEventSubscriptions[A]=this.on(A,N))}this.prevMotionValues=i4(this,this.scrapeMotionValuesFromProps(g,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(g){return this.props.variants?this.props.variants[g]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(g){const w=this.getClosestVariantNode();if(w)return w.variantChildren&&w.variantChildren.add(g),()=>w.variantChildren.delete(g)}addValue(g,w){const S=this.values.get(g);w!==S&&(S&&this.removeValue(g),this.bindToMotionValue(g,w),this.values.set(g,w),this.latestValues[g]=w.get())}removeValue(g){this.values.delete(g);const w=this.valueSubscriptions.get(g);w&&(w(),this.valueSubscriptions.delete(g)),delete this.latestValues[g],this.removeValueFromRenderState(g,this.renderState)}hasValue(g){return this.values.has(g)}getValue(g,w){if(this.props.values&&this.props.values[g])return this.props.values[g];let S=this.values.get(g);return S===void 0&&w!==void 0&&(S=Rg(w===null?void 0:w,{owner:this}),this.addValue(g,S)),S}readValue(g,w){let S=this.latestValues[g]!==void 0||!this.current?this.latestValues[g]:this.getBaseTargetFromProps(this.props,g)??this.readValueFromInstance(this.current,g,this.options);return S!=null&&(typeof S=="string"&&(PA(S)||LA(S))?S=parseFloat(S):!gF(S)&&mp.test(w)&&(S=mC(g,w)),this.setBaseTarget(g,ul(S)?S.get():S)),ul(S)?S.get():S}setBaseTarget(g,w){this.baseTarget[g]=w}getBaseTarget(g){const{initial:w}=this.props;let S;if(typeof w=="string"||typeof w=="object"){const L=O1(this.props,w,this.presenceContext?.custom);L&&(S=L[g])}if(w&&S!==void 0)return S;const A=this.getBaseTargetFromProps(this.props,g);return A!==void 0&&!ul(A)?A:this.initialValues[g]!==void 0&&S===void 0?void 0:this.baseTarget[g]}on(g,w){return this.events[g]||(this.events[g]=new h1),this.events[g].add(w)}notify(g,...w){this.events[g]&&this.events[g].notify(...w)}scheduleRenderMicrotask(){A1.render(this.render)}}class jC extends n4{constructor(){super(...arguments),this.KeyframeResolver=nF}sortInstanceNodePosition(g,w){return g.compareDocumentPosition(w)&2?1:-1}getBaseTargetFromProps(g,w){return g.style?g.style[w]:void 0}removeValueFromRenderState(g,{vars:w,style:S}){delete w[g],delete S[g]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:g}=this.props;ul(g)&&(this.childSubscription=g.on("change",w=>{this.current&&(this.current.textContent=`${w}`)}))}}function VC(f,{style:g,vars:w},S,A){const L=f.style;let N;for(N in g)L[N]=g[N];A?.applyProjectionStyles(L,S);for(N in w)L.setProperty(N,w[N])}function r4(f){return window.getComputedStyle(f)}class s4 extends jC{constructor(){super(...arguments),this.type="html",this.renderInstance=VC}readValueFromInstance(g,w){if(Fg.has(w))return this.projection?.isProjecting?wb(w):wN(g,w);{const S=r4(g),A=(p1(w)?S.getPropertyValue(w):S[w])||0;return typeof A=="string"?A.trim():A}}measureInstanceViewportBox(g,{transformPagePoint:w}){return FC(g,w)}build(g,w,S){R1(g,w,S.transformTemplate)}scrapeMotionValuesFromProps(g,w,S){return L1(g,w,S)}}const UC=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function a4(f,g,w,S){VC(f,g,void 0,S);for(const A in g.attrs)f.setAttribute(UC.has(A)?A:z1(A),g.attrs[A])}class o4 extends jC{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=za}getBaseTargetFromProps(g,w){return g[w]}readValueFromInstance(g,w){if(Fg.has(w)){const S=pC(w);return S&&S.default||0}return w=UC.has(w)?w:z1(w),g.getAttribute(w)}scrapeMotionValuesFromProps(g,w,S){return DC(g,w,S)}build(g,w,S){CC(g,w,this.isSVGTag,S.transformTemplate,S.style)}renderInstance(g,w,S,A){a4(g,w,S,A)}mount(g){this.isSVGTag=IC(g.tagName),super.mount(g)}}const l4=(f,g)=>P1(f)?new o4(g):new s4(g,{allowProjection:f!==Re.Fragment});function Mg(f,g,w){const S=f.getProps();return O1(S,g,w!==void 0?w:S.custom,f)}const Pb=f=>Array.isArray(f);function c4(f,g,w){f.hasValue(g)?f.getValue(g).set(w):f.addValue(g,Rg(w))}function u4(f){return Pb(f)?f[f.length-1]||0:f}function h4(f,g){const w=Mg(f,g);let{transitionEnd:S={},transition:A={},...L}=w||{};L={...L,...S};for(const N in L){const r=u4(L[N]);c4(f,N,r)}}function d4(f){return!!(ul(f)&&f.add)}function Ob(f,g){const w=f.getValue("willChange");if(d4(w))return w.add(g);if(!w&&cf.WillChange){const S=new cf.WillChange("auto");f.addValue("willChange",S),S.add(g)}}function GC(f){return f.props[PC]}const f4=f=>f!==null;function p4(f,{repeat:g,repeatType:w="loop"},S){const A=f.filter(f4),L=g&&w!=="loop"&&g%2===1?0:A.length-1;return A[L]}const m4={type:"spring",stiffness:500,damping:25,restSpeed:10},g4=f=>({type:"spring",stiffness:550,damping:f===0?2*Math.sqrt(550):30,restSpeed:10}),_4={type:"keyframes",duration:.8},y4={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},v4=(f,{keyframes:g})=>g.length>2?_4:Fg.has(f)?f.startsWith("scale")?g4(g[1]):m4:y4;function x4({when:f,delay:g,delayChildren:w,staggerChildren:S,staggerDirection:A,repeat:L,repeatType:N,repeatDelay:r,from:F,elapsed:B,...$}){return!!Object.keys($).length}const k1=(f,g,w,S={},A,L)=>N=>{const r=S1(S,f)||{},F=r.delay||S.delay||0;let{elapsed:B=0}=S;B=B-Jh(F);const $={keyframes:Array.isArray(w)?w:[null,w],ease:"easeOut",velocity:g.getVelocity(),...r,delay:-B,onUpdate:re=>{g.set(re),r.onUpdate&&r.onUpdate(re)},onComplete:()=>{N(),r.onComplete&&r.onComplete()},name:f,motionValue:g,element:L?void 0:A};x4(r)||Object.assign($,v4(f,$)),$.duration&&($.duration=Jh($.duration)),$.repeatDelay&&($.repeatDelay=Jh($.repeatDelay)),$.from!==void 0&&($.keyframes[0]=$.from);let ie=!1;if(($.type===!1||$.duration===0&&!$.repeatDelay)&&(Cb($),$.delay===0&&(ie=!0)),(cf.instantAnimations||cf.skipAnimations)&&(ie=!0,Cb($),$.delay=0),$.allowFlatten=!r.type&&!r.ease,ie&&!L&&g.get()!==void 0){const re=p4($.keyframes,r);if(re!==void 0){Ws.update(()=>{$.onUpdate(re),$.onComplete()});return}}return r.isSync?new w1($):new qN($)};function b4({protectedKeys:f,needsAnimating:g},w){const S=f.hasOwnProperty(w)&&g[w]!==!0;return g[w]=!1,S}function HC(f,g,{delay:w=0,transitionOverride:S,type:A}={}){let{transition:L=f.getDefaultTransition(),transitionEnd:N,...r}=g;S&&(L=S);const F=[],B=A&&f.animationState&&f.animationState.getState()[A];for(const $ in r){const ie=f.getValue($,f.latestValues[$]??null),re=r[$];if(re===void 0||B&&b4(B,$))continue;const Te={delay:w,...S1(L||{},$)},_e=ie.get();if(_e!==void 0&&!ie.isAnimating&&!Array.isArray(re)&&re===_e&&!Te.velocity)continue;let me=!1;if(window.MotionHandoffAnimation){const pe=GC(f);if(pe){const fe=window.MotionHandoffAnimation(pe,$,Ws);fe!==null&&(Te.startTime=fe,me=!0)}}Ob(f,$),ie.start(k1($,ie,re,f.shouldReduceMotion&&hC.has($)?{type:!1}:Te,f,me));const ge=ie.animation;ge&&F.push(ge)}return N&&Promise.all(F).then(()=>{Ws.update(()=>{N&&h4(f,N)})}),F}function qC(f,g,w,S=0,A=1){const L=Array.from(f).sort((B,$)=>B.sortNodePosition($)).indexOf(g),N=f.size,r=(N-1)*S;return typeof w=="function"?w(L,N):A===1?L*S:r-L*S}function Lb(f,g,w={}){const S=Mg(f,g,w.type==="exit"?f.presenceContext?.custom:void 0);let{transition:A=f.getDefaultTransition()||{}}=S||{};w.transitionOverride&&(A=w.transitionOverride);const L=S?()=>Promise.all(HC(f,S,w)):()=>Promise.resolve(),N=f.variantChildren&&f.variantChildren.size?(F=0)=>{const{delayChildren:B=0,staggerChildren:$,staggerDirection:ie}=A;return w4(f,g,F,B,$,ie,w)}:()=>Promise.resolve(),{when:r}=A;if(r){const[F,B]=r==="beforeChildren"?[L,N]:[N,L];return F().then(()=>B())}else return Promise.all([L(),N(w.delay)])}function w4(f,g,w=0,S=0,A=0,L=1,N){const r=[];for(const F of f.variantChildren)F.notify("AnimationStart",g),r.push(Lb(F,g,{...N,delay:w+(typeof S=="function"?0:S)+qC(f.variantChildren,F,S,A,L)}).then(()=>F.notify("AnimationComplete",g)));return Promise.all(r)}function T4(f,g,w={}){f.notify("AnimationStart",g);let S;if(Array.isArray(g)){const A=g.map(L=>Lb(f,L,w));S=Promise.all(A)}else if(typeof g=="string")S=Lb(f,g,w);else{const A=typeof g=="function"?Mg(f,g,w.custom):g;S=Promise.all(HC(f,A,w))}return S.then(()=>{f.notify("AnimationComplete",g)})}function $C(f,g){if(!Array.isArray(g))return!1;const w=g.length;if(w!==f.length)return!1;for(let S=0;S<w;S++)if(g[S]!==f[S])return!1;return!0}const S4=I1.length;function ZC(f){if(!f)return;if(!f.isControllingVariants){const w=f.parent?ZC(f.parent)||{}:{};return f.props.initial!==void 0&&(w.initial=f.props.initial),w}const g={};for(let w=0;w<S4;w++){const S=I1[w],A=f.props[S];(ry(A)||A===!1)&&(g[S]=A)}return g}const E4=[...M1].reverse(),A4=M1.length;function C4(f){return g=>Promise.all(g.map(({animation:w,options:S})=>T4(f,w,S)))}function M4(f){let g=C4(f),w=B2(),S=!0;const A=F=>(B,$)=>{const ie=Mg(f,$,F==="exit"?f.presenceContext?.custom:void 0);if(ie){const{transition:re,transitionEnd:Te,..._e}=ie;B={...B,..._e,...Te}}return B};function L(F){g=F(f)}function N(F){const{props:B}=f,$=ZC(f.parent)||{},ie=[],re=new Set;let Te={},_e=1/0;for(let ge=0;ge<A4;ge++){const pe=E4[ge],fe=w[pe],se=B[pe]!==void 0?B[pe]:$[pe],De=ry(se),we=pe===F?fe.isActive:null;we===!1&&(_e=ge);let ht=se===$[pe]&&se!==B[pe]&&De;if(ht&&S&&f.manuallyAnimateOnMount&&(ht=!1),fe.protectedKeys={...Te},!fe.isActive&&we===null||!se&&!fe.prevProp||_0(se)||typeof se=="boolean")continue;const At=I4(fe.prevProp,se);let gt=At||pe===F&&fe.isActive&&!ht&&De||ge>_e&&De,Xe=!1;const je=Array.isArray(se)?se:[se];let $e=je.reduce(A(pe),{});we===!1&&($e={});const{prevResolvedValues:It={}}=fe,Lt={...It,...$e},ct=kt=>{gt=!0,re.has(kt)&&(Xe=!0,re.delete(kt)),fe.needsAnimating[kt]=!0;const ii=f.getValue(kt);ii&&(ii.liveStyle=!1)};for(const kt in Lt){const ii=$e[kt],Li=It[kt];if(Te.hasOwnProperty(kt))continue;let Ve=!1;Pb(ii)&&Pb(Li)?Ve=!$C(ii,Li):Ve=ii!==Li,Ve?ii!=null?ct(kt):re.add(kt):ii!==void 0&&re.has(kt)?ct(kt):fe.protectedKeys[kt]=!0}fe.prevProp=se,fe.prevResolvedValues=$e,fe.isActive&&(Te={...Te,...$e}),S&&f.blockInitialAnimation&&(gt=!1);const Et=ht&&At;gt&&(!Et||Xe)&&ie.push(...je.map(kt=>{const ii={type:pe};if(typeof kt=="string"&&S&&!Et&&f.manuallyAnimateOnMount&&f.parent){const{parent:Li}=f,Ve=Mg(Li,kt);if(Li.enteringChildren&&Ve){const{delayChildren:Dt}=Ve.transition||{};ii.delay=qC(Li.enteringChildren,f,Dt)}}return{animation:kt,options:ii}}))}if(re.size){const ge={};if(typeof B.initial!="boolean"){const pe=Mg(f,Array.isArray(B.initial)?B.initial[0]:B.initial);pe&&pe.transition&&(ge.transition=pe.transition)}re.forEach(pe=>{const fe=f.getBaseTarget(pe),se=f.getValue(pe);se&&(se.liveStyle=!0),ge[pe]=fe??null}),ie.push({animation:ge})}let me=!!ie.length;return S&&(B.initial===!1||B.initial===B.animate)&&!f.manuallyAnimateOnMount&&(me=!1),S=!1,me?g(ie):Promise.resolve()}function r(F,B){if(w[F].isActive===B)return Promise.resolve();f.variantChildren?.forEach(ie=>ie.animationState?.setActive(F,B)),w[F].isActive=B;const $=N(F);for(const ie in w)w[ie].protectedKeys={};return $}return{animateChanges:N,setActive:r,setAnimateFunction:L,getState:()=>w,reset:()=>{w=B2(),S=!0}}}function I4(f,g){return typeof g=="string"?g!==f:Array.isArray(g)?!$C(g,f):!1}function bm(f=!1){return{isActive:f,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function B2(){return{animate:bm(!0),whileInView:bm(),whileHover:bm(),whileTap:bm(),whileDrag:bm(),whileFocus:bm(),exit:bm()}}class gp{constructor(g){this.isMounted=!1,this.node=g}update(){}}class R4 extends gp{constructor(g){super(g),g.animationState||(g.animationState=M4(g))}updateAnimationControlsSubscription(){const{animate:g}=this.node.getProps();_0(g)&&(this.unmountControls=g.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:g}=this.node.getProps(),{animate:w}=this.node.prevProps||{};g!==w&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let D4=0;class P4 extends gp{constructor(){super(...arguments),this.id=D4++}update(){if(!this.node.presenceContext)return;const{isPresent:g,onExitComplete:w}=this.node.presenceContext,{isPresent:S}=this.node.prevPresenceContext||{};if(!this.node.animationState||g===S)return;const A=this.node.animationState.setActive("exit",!g);w&&!g&&A.then(()=>{w(this.id)})}mount(){const{register:g,onExitComplete:w}=this.node.presenceContext||{};w&&w(this.id),g&&(this.unmount=g(this.id))}unmount(){}}const O4={animation:{Feature:R4},exit:{Feature:P4}};function ay(f,g,w,S={passive:!0}){return f.addEventListener(g,w,S),()=>f.removeEventListener(g,w)}function py(f){return{point:{x:f.pageX,y:f.pageY}}}const L4=f=>g=>C1(g)&&f(g,py(g));function W_(f,g,w,S){return ay(f,g,L4(w),S)}const WC=1e-4,z4=1-WC,k4=1+WC,XC=.01,N4=0-XC,F4=0+XC;function Rl(f){return f.max-f.min}function B4(f,g,w){return Math.abs(f-g)<=w}function j2(f,g,w,S=.5){f.origin=S,f.originPoint=sa(g.min,g.max,f.origin),f.scale=Rl(w)/Rl(g),f.translate=sa(w.min,w.max,f.origin)-f.originPoint,(f.scale>=z4&&f.scale<=k4||isNaN(f.scale))&&(f.scale=1),(f.translate>=N4&&f.translate<=F4||isNaN(f.translate))&&(f.translate=0)}function X_(f,g,w,S){j2(f.x,g.x,w.x,S?S.originX:void 0),j2(f.y,g.y,w.y,S?S.originY:void 0)}function V2(f,g,w){f.min=w.min+g.min,f.max=f.min+Rl(g)}function j4(f,g,w){V2(f.x,g.x,w.x),V2(f.y,g.y,w.y)}function U2(f,g,w){f.min=g.min-w.min,f.max=f.min+Rl(g)}function Y_(f,g,w){U2(f.x,g.x,w.x),U2(f.y,g.y,w.y)}function pu(f){return[f("x"),f("y")]}const YC=({current:f})=>f?f.ownerDocument.defaultView:null,G2=(f,g)=>Math.abs(f-g);function V4(f,g){const w=G2(f.x,g.x),S=G2(f.y,g.y);return Math.sqrt(w**2+S**2)}class KC{constructor(g,w,{transformPagePoint:S,contextWindow:A=window,dragSnapToOrigin:L=!1,distanceThreshold:N=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const re=Qx(this.lastMoveEventInfo,this.history),Te=this.startEvent!==null,_e=V4(re.offset,{x:0,y:0})>=this.distanceThreshold;if(!Te&&!_e)return;const{point:me}=re,{timestamp:ge}=zo;this.history.push({...me,timestamp:ge});const{onStart:pe,onMove:fe}=this.handlers;Te||(pe&&pe(this.lastMoveEvent,re),this.startEvent=this.lastMoveEvent),fe&&fe(this.lastMoveEvent,re)},this.handlePointerMove=(re,Te)=>{this.lastMoveEvent=re,this.lastMoveEventInfo=Kx(Te,this.transformPagePoint),Ws.update(this.updatePoint,!0)},this.handlePointerUp=(re,Te)=>{this.end();const{onEnd:_e,onSessionEnd:me,resumeAnimation:ge}=this.handlers;if(this.dragSnapToOrigin&&ge&&ge(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const pe=Qx(re.type==="pointercancel"?this.lastMoveEventInfo:Kx(Te,this.transformPagePoint),this.history);this.startEvent&&_e&&_e(re,pe),me&&me(re,pe)},!C1(g))return;this.dragSnapToOrigin=L,this.handlers=w,this.transformPagePoint=S,this.distanceThreshold=N,this.contextWindow=A||window;const r=py(g),F=Kx(r,this.transformPagePoint),{point:B}=F,{timestamp:$}=zo;this.history=[{...B,timestamp:$}];const{onSessionStart:ie}=w;ie&&ie(g,Qx(F,this.history)),this.removeListeners=hy(W_(this.contextWindow,"pointermove",this.handlePointerMove),W_(this.contextWindow,"pointerup",this.handlePointerUp),W_(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(g){this.handlers=g}end(){this.removeListeners&&this.removeListeners(),pp(this.updatePoint)}}function Kx(f,g){return g?{point:g(f.point)}:f}function H2(f,g){return{x:f.x-g.x,y:f.y-g.y}}function Qx({point:f},g){return{point:f,delta:H2(f,QC(g)),offset:H2(f,U4(g)),velocity:G4(g,.1)}}function U4(f){return f[0]}function QC(f){return f[f.length-1]}function G4(f,g){if(f.length<2)return{x:0,y:0};let w=f.length-1,S=null;const A=QC(f);for(;w>=0&&(S=f[w],!(A.timestamp-S.timestamp>Jh(g)));)w--;if(!S)return{x:0,y:0};const L=ed(A.timestamp-S.timestamp);if(L===0)return{x:0,y:0};const N={x:(A.x-S.x)/L,y:(A.y-S.y)/L};return N.x===1/0&&(N.x=0),N.y===1/0&&(N.y=0),N}function H4(f,{min:g,max:w},S){return g!==void 0&&f<g?f=S?sa(g,f,S.min):Math.max(f,g):w!==void 0&&f>w&&(f=S?sa(w,f,S.max):Math.min(f,w)),f}function q2(f,g,w){return{min:g!==void 0?f.min+g:void 0,max:w!==void 0?f.max+w-(f.max-f.min):void 0}}function q4(f,{top:g,left:w,bottom:S,right:A}){return{x:q2(f.x,w,A),y:q2(f.y,g,S)}}function $2(f,g){let w=g.min-f.min,S=g.max-f.max;return g.max-g.min<f.max-f.min&&([w,S]=[S,w]),{min:w,max:S}}function $4(f,g){return{x:$2(f.x,g.x),y:$2(f.y,g.y)}}function Z4(f,g){let w=.5;const S=Rl(f),A=Rl(g);return A>S?w=ty(g.min,g.max-S,f.min):S>A&&(w=ty(f.min,f.max-A,g.min)),lf(0,1,w)}function W4(f,g){const w={};return g.min!==void 0&&(w.min=g.min-f.min),g.max!==void 0&&(w.max=g.max-f.min),w}const zb=.35;function X4(f=zb){return f===!1?f=0:f===!0&&(f=zb),{x:Z2(f,"left","right"),y:Z2(f,"top","bottom")}}function Z2(f,g,w){return{min:W2(f,g),max:W2(f,w)}}function W2(f,g){return typeof f=="number"?f:f[g]||0}const Y4=new WeakMap;class K4{constructor(g){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=za(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=g}start(g,{snapToCursor:w=!1,distanceThreshold:S}={}){const{presenceContext:A}=this.visualElement;if(A&&A.isPresent===!1)return;const L=ie=>{const{dragSnapToOrigin:re}=this.getProps();re?this.pauseAnimation():this.stopAnimation(),w&&this.snapToCursor(py(ie).point)},N=(ie,re)=>{const{drag:Te,dragPropagation:_e,onDragStart:me}=this.getProps();if(Te&&!_e&&(this.openDragLock&&this.openDragLock(),this.openDragLock=lF(Te),!this.openDragLock))return;this.latestPointerEvent=ie,this.latestPanInfo=re,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),pu(pe=>{let fe=this.getAxisMotionValue(pe).get()||0;if(td.test(fe)){const{projection:se}=this.visualElement;if(se&&se.layout){const De=se.layout.layoutBox[pe];De&&(fe=Rl(De)*(parseFloat(fe)/100))}}this.originPoint[pe]=fe}),me&&Ws.postRender(()=>me(ie,re)),Ob(this.visualElement,"transform");const{animationState:ge}=this.visualElement;ge&&ge.setActive("whileDrag",!0)},r=(ie,re)=>{this.latestPointerEvent=ie,this.latestPanInfo=re;const{dragPropagation:Te,dragDirectionLock:_e,onDirectionLock:me,onDrag:ge}=this.getProps();if(!Te&&!this.openDragLock)return;const{offset:pe}=re;if(_e&&this.currentDirection===null){this.currentDirection=Q4(pe),this.currentDirection!==null&&me&&me(this.currentDirection);return}this.updateAxis("x",re.point,pe),this.updateAxis("y",re.point,pe),this.visualElement.render(),ge&&ge(ie,re)},F=(ie,re)=>{this.latestPointerEvent=ie,this.latestPanInfo=re,this.stop(ie,re),this.latestPointerEvent=null,this.latestPanInfo=null},B=()=>pu(ie=>this.getAnimationState(ie)==="paused"&&this.getAxisMotionValue(ie).animation?.play()),{dragSnapToOrigin:$}=this.getProps();this.panSession=new KC(g,{onSessionStart:L,onStart:N,onMove:r,onSessionEnd:F,resumeAnimation:B},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:$,distanceThreshold:S,contextWindow:YC(this.visualElement)})}stop(g,w){const S=g||this.latestPointerEvent,A=w||this.latestPanInfo,L=this.isDragging;if(this.cancel(),!L||!A||!S)return;const{velocity:N}=A;this.startAnimation(N);const{onDragEnd:r}=this.getProps();r&&Ws.postRender(()=>r(S,A))}cancel(){this.isDragging=!1;const{projection:g,animationState:w}=this.visualElement;g&&(g.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:S}=this.getProps();!S&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),w&&w.setActive("whileDrag",!1)}updateAxis(g,w,S){const{drag:A}=this.getProps();if(!S||!zv(g,A,this.currentDirection))return;const L=this.getAxisMotionValue(g);let N=this.originPoint[g]+S[g];this.constraints&&this.constraints[g]&&(N=H4(N,this.constraints[g],this.elastic[g])),L.set(N)}resolveConstraints(){const{dragConstraints:g,dragElastic:w}=this.getProps(),S=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,A=this.constraints;g&&Tg(g)?this.constraints||(this.constraints=this.resolveRefConstraints()):g&&S?this.constraints=q4(S.layoutBox,g):this.constraints=!1,this.elastic=X4(w),A!==this.constraints&&S&&this.constraints&&!this.hasMutatedConstraints&&pu(L=>{this.constraints!==!1&&this.getAxisMotionValue(L)&&(this.constraints[L]=W4(S.layoutBox[L],this.constraints[L]))})}resolveRefConstraints(){const{dragConstraints:g,onMeasureDragConstraints:w}=this.getProps();if(!g||!Tg(g))return!1;const S=g.current,{projection:A}=this.visualElement;if(!A||!A.layout)return!1;const L=JF(S,A.root,this.visualElement.getTransformPagePoint());let N=$4(A.layout.layoutBox,L);if(w){const r=w(YF(N));this.hasMutatedConstraints=!!r,r&&(N=zC(r))}return N}startAnimation(g){const{drag:w,dragMomentum:S,dragElastic:A,dragTransition:L,dragSnapToOrigin:N,onDragTransitionEnd:r}=this.getProps(),F=this.constraints||{},B=pu($=>{if(!zv($,w,this.currentDirection))return;let ie=F&&F[$]||{};N&&(ie={min:0,max:0});const re=A?200:1e6,Te=A?40:1e7,_e={type:"inertia",velocity:S?g[$]:0,bounceStiffness:re,bounceDamping:Te,timeConstant:750,restDelta:1,restSpeed:10,...L,...ie};return this.startAxisValueAnimation($,_e)});return Promise.all(B).then(r)}startAxisValueAnimation(g,w){const S=this.getAxisMotionValue(g);return Ob(this.visualElement,g),S.start(k1(g,S,0,w,this.visualElement,!1))}stopAnimation(){pu(g=>this.getAxisMotionValue(g).stop())}pauseAnimation(){pu(g=>this.getAxisMotionValue(g).animation?.pause())}getAnimationState(g){return this.getAxisMotionValue(g).animation?.state}getAxisMotionValue(g){const w=`_drag${g.toUpperCase()}`,S=this.visualElement.getProps(),A=S[w];return A||this.visualElement.getValue(g,(S.initial?S.initial[g]:void 0)||0)}snapToCursor(g){pu(w=>{const{drag:S}=this.getProps();if(!zv(w,S,this.currentDirection))return;const{projection:A}=this.visualElement,L=this.getAxisMotionValue(w);if(A&&A.layout){const{min:N,max:r}=A.layout.layoutBox[w];L.set(g[w]-sa(N,r,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:g,dragConstraints:w}=this.getProps(),{projection:S}=this.visualElement;if(!Tg(w)||!S||!this.constraints)return;this.stopAnimation();const A={x:0,y:0};pu(N=>{const r=this.getAxisMotionValue(N);if(r&&this.constraints!==!1){const F=r.get();A[N]=Z4({min:F,max:F},this.constraints[N])}});const{transformTemplate:L}=this.visualElement.getProps();this.visualElement.current.style.transform=L?L({},""):"none",S.root&&S.root.updateScroll(),S.updateLayout(),this.resolveConstraints(),pu(N=>{if(!zv(N,g,null))return;const r=this.getAxisMotionValue(N),{min:F,max:B}=this.constraints[N];r.set(sa(F,B,A[N]))})}addListeners(){if(!this.visualElement.current)return;Y4.set(this.visualElement,this);const g=this.visualElement.current,w=W_(g,"pointerdown",F=>{const{drag:B,dragListener:$=!0}=this.getProps();B&&$&&this.start(F)}),S=()=>{const{dragConstraints:F}=this.getProps();Tg(F)&&F.current&&(this.constraints=this.resolveRefConstraints())},{projection:A}=this.visualElement,L=A.addEventListener("measure",S);A&&!A.layout&&(A.root&&A.root.updateScroll(),A.updateLayout()),Ws.read(S);const N=ay(window,"resize",()=>this.scalePositionWithinConstraints()),r=A.addEventListener("didUpdate",({delta:F,hasLayoutChanged:B})=>{this.isDragging&&B&&(pu($=>{const ie=this.getAxisMotionValue($);ie&&(this.originPoint[$]+=F[$].translate,ie.set(ie.get()+F[$].translate))}),this.visualElement.render())});return()=>{N(),w(),L(),r&&r()}}getProps(){const g=this.visualElement.getProps(),{drag:w=!1,dragDirectionLock:S=!1,dragPropagation:A=!1,dragConstraints:L=!1,dragElastic:N=zb,dragMomentum:r=!0}=g;return{...g,drag:w,dragDirectionLock:S,dragPropagation:A,dragConstraints:L,dragElastic:N,dragMomentum:r}}}function zv(f,g,w){return(g===!0||g===f)&&(w===null||w===f)}function Q4(f,g=10){let w=null;return Math.abs(f.y)>g?w="y":Math.abs(f.x)>g&&(w="x"),w}class J4 extends gp{constructor(g){super(g),this.removeGroupControls=mu,this.removeListeners=mu,this.controls=new K4(g)}mount(){const{dragControls:g}=this.node.getProps();g&&(this.removeGroupControls=g.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||mu}unmount(){this.removeGroupControls(),this.removeListeners()}}const X2=f=>(g,w)=>{f&&Ws.postRender(()=>f(g,w))};class eB extends gp{constructor(){super(...arguments),this.removePointerDownListener=mu}onPointerDown(g){this.session=new KC(g,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:YC(this.node)})}createPanHandlers(){const{onPanSessionStart:g,onPanStart:w,onPan:S,onPanEnd:A}=this.node.getProps();return{onSessionStart:X2(g),onStart:X2(w),onMove:S,onEnd:(L,N)=>{delete this.session,A&&Ws.postRender(()=>A(L,N))}}}mount(){this.removePointerDownListener=W_(this.node.current,"pointerdown",g=>this.onPointerDown(g))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const $v={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Y2(f,g){return g.max===g.min?0:f/(g.max-g.min)*100}const G_={correct:(f,g)=>{if(!g.target)return f;if(typeof f=="string")if(Wn.test(f))f=parseFloat(f);else return f;const w=Y2(f,g.target.x),S=Y2(f,g.target.y);return`${w}% ${S}%`}},tB={correct:(f,{treeScale:g,projectionDelta:w})=>{const S=f,A=mp.parse(f);if(A.length>5)return S;const L=mp.createTransformer(f),N=typeof A[0]!="number"?1:0,r=w.x.scale*g.x,F=w.y.scale*g.y;A[0+N]/=r,A[1+N]/=F;const B=sa(r,F,.5);return typeof A[2+N]=="number"&&(A[2+N]/=B),typeof A[3+N]=="number"&&(A[3+N]/=B),L(A)}};let Jx=!1;class iB extends Re.Component{componentDidMount(){const{visualElement:g,layoutGroup:w,switchLayoutGroup:S,layoutId:A}=this.props,{projection:L}=g;SF(nB),L&&(w.group&&w.group.add(L),S&&S.register&&A&&S.register(L),Jx&&L.root.didUpdate(),L.addEventListener("animationComplete",()=>{this.safeToRemove()}),L.setOptions({...L.options,onExitComplete:()=>this.safeToRemove()})),$v.hasEverUpdated=!0}getSnapshotBeforeUpdate(g){const{layoutDependency:w,visualElement:S,drag:A,isPresent:L}=this.props,{projection:N}=S;return N&&(N.isPresent=L,Jx=!0,A||g.layoutDependency!==w||w===void 0||g.isPresent!==L?N.willUpdate():this.safeToRemove(),g.isPresent!==L&&(L?N.promote():N.relegate()||Ws.postRender(()=>{const r=N.getStack();(!r||!r.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:g}=this.props.visualElement;g&&(g.root.didUpdate(),A1.postRender(()=>{!g.currentAnimation&&g.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:g,layoutGroup:w,switchLayoutGroup:S}=this.props,{projection:A}=g;Jx=!0,A&&(A.scheduleCheckAfterUnmount(),w&&w.group&&w.group.remove(A),S&&S.deregister&&S.deregister(A))}safeToRemove(){const{safeToRemove:g}=this.props;g&&g()}render(){return null}}function JC(f){const[g,w]=_F(),S=Re.useContext(DA);return W.jsx(iB,{...f,layoutGroup:S,switchLayoutGroup:Re.useContext(OC),isPresent:g,safeToRemove:w})}const nB={borderRadius:{...G_,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:G_,borderTopRightRadius:G_,borderBottomLeftRadius:G_,borderBottomRightRadius:G_,boxShadow:tB};function rB(f,g,w){const S=ul(f)?f:Rg(f);return S.start(k1("",S,g,w)),S.animation}const sB=(f,g)=>f.depth-g.depth;class aB{constructor(){this.children=[],this.isDirty=!1}add(g){o1(this.children,g),this.isDirty=!0}remove(g){l1(this.children,g),this.isDirty=!0}forEach(g){this.isDirty&&this.children.sort(sB),this.isDirty=!1,this.children.forEach(g)}}function oB(f,g){const w=cc.now(),S=({timestamp:A})=>{const L=A-w;L>=g&&(pp(S),f(L-g))};return Ws.setup(S,!0),()=>pp(S)}const eM=["TopLeft","TopRight","BottomLeft","BottomRight"],lB=eM.length,K2=f=>typeof f=="string"?parseFloat(f):f,Q2=f=>typeof f=="number"||Wn.test(f);function cB(f,g,w,S,A,L){A?(f.opacity=sa(0,w.opacity??1,uB(S)),f.opacityExit=sa(g.opacity??1,0,hB(S))):L&&(f.opacity=sa(g.opacity??1,w.opacity??1,S));for(let N=0;N<lB;N++){const r=`border${eM[N]}Radius`;let F=J2(g,r),B=J2(w,r);if(F===void 0&&B===void 0)continue;F||(F=0),B||(B=0),F===0||B===0||Q2(F)===Q2(B)?(f[r]=Math.max(sa(K2(F),K2(B),S),0),(td.test(B)||td.test(F))&&(f[r]+="%")):f[r]=B}(g.rotate||w.rotate)&&(f.rotate=sa(g.rotate||0,w.rotate||0,S))}function J2(f,g){return f[g]!==void 0?f[g]:f.borderRadius}const uB=tM(0,.5,UA),hB=tM(.5,.95,mu);function tM(f,g,w){return S=>S<f?0:S>g?1:w(ty(f,g,S))}function eE(f,g){f.min=g.min,f.max=g.max}function fu(f,g){eE(f.x,g.x),eE(f.y,g.y)}function tE(f,g){f.translate=g.translate,f.scale=g.scale,f.originPoint=g.originPoint,f.origin=g.origin}function iE(f,g,w,S,A){return f-=g,f=l0(f,1/w,S),A!==void 0&&(f=l0(f,1/A,S)),f}function dB(f,g=0,w=1,S=.5,A,L=f,N=f){if(td.test(g)&&(g=parseFloat(g),g=sa(N.min,N.max,g/100)-N.min),typeof g!="number")return;let r=sa(L.min,L.max,S);f===L&&(r-=g),f.min=iE(f.min,g,w,r,A),f.max=iE(f.max,g,w,r,A)}function nE(f,g,[w,S,A],L,N){dB(f,g[w],g[S],g[A],g.scale,L,N)}const fB=["x","scaleX","originX"],pB=["y","scaleY","originY"];function rE(f,g,w,S){nE(f.x,g,fB,w?w.x:void 0,S?S.x:void 0),nE(f.y,g,pB,w?w.y:void 0,S?S.y:void 0)}function sE(f){return f.translate===0&&f.scale===1}function iM(f){return sE(f.x)&&sE(f.y)}function aE(f,g){return f.min===g.min&&f.max===g.max}function mB(f,g){return aE(f.x,g.x)&&aE(f.y,g.y)}function oE(f,g){return Math.round(f.min)===Math.round(g.min)&&Math.round(f.max)===Math.round(g.max)}function nM(f,g){return oE(f.x,g.x)&&oE(f.y,g.y)}function lE(f){return Rl(f.x)/Rl(f.y)}function cE(f,g){return f.translate===g.translate&&f.scale===g.scale&&f.originPoint===g.originPoint}class gB{constructor(){this.members=[]}add(g){o1(this.members,g),g.scheduleRender()}remove(g){if(l1(this.members,g),g===this.prevLead&&(this.prevLead=void 0),g===this.lead){const w=this.members[this.members.length-1];w&&this.promote(w)}}relegate(g){const w=this.members.findIndex(A=>g===A);if(w===0)return!1;let S;for(let A=w;A>=0;A--){const L=this.members[A];if(L.isPresent!==!1){S=L;break}}return S?(this.promote(S),!0):!1}promote(g,w){const S=this.lead;if(g!==S&&(this.prevLead=S,this.lead=g,g.show(),S)){S.instance&&S.scheduleRender(),g.scheduleRender(),g.resumeFrom=S,w&&(g.resumeFrom.preserveOpacity=!0),S.snapshot&&(g.snapshot=S.snapshot,g.snapshot.latestValues=S.animationValues||S.latestValues),g.root&&g.root.isUpdating&&(g.isLayoutDirty=!0);const{crossfade:A}=g.options;A===!1&&S.hide()}}exitAnimationComplete(){this.members.forEach(g=>{const{options:w,resumingFrom:S}=g;w.onExitComplete&&w.onExitComplete(),S&&S.options.onExitComplete&&S.options.onExitComplete()})}scheduleRender(){this.members.forEach(g=>{g.instance&&g.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function _B(f,g,w){let S="";const A=f.x.translate/g.x,L=f.y.translate/g.y,N=w?.z||0;if((A||L||N)&&(S=`translate3d(${A}px, ${L}px, ${N}px) `),(g.x!==1||g.y!==1)&&(S+=`scale(${1/g.x}, ${1/g.y}) `),w){const{transformPerspective:B,rotate:$,rotateX:ie,rotateY:re,skewX:Te,skewY:_e}=w;B&&(S=`perspective(${B}px) ${S}`),$&&(S+=`rotate(${$}deg) `),ie&&(S+=`rotateX(${ie}deg) `),re&&(S+=`rotateY(${re}deg) `),Te&&(S+=`skewX(${Te}deg) `),_e&&(S+=`skewY(${_e}deg) `)}const r=f.x.scale*g.x,F=f.y.scale*g.y;return(r!==1||F!==1)&&(S+=`scale(${r}, ${F})`),S||"none"}const eb=["","X","Y","Z"],yB=1e3;let vB=0;function tb(f,g,w,S){const{latestValues:A}=g;A[f]&&(w[f]=A[f],g.setStaticValue(f,0),S&&(S[f]=0))}function rM(f){if(f.hasCheckedOptimisedAppear=!0,f.root===f)return;const{visualElement:g}=f.options;if(!g)return;const w=GC(g);if(window.MotionHasOptimisedAnimation(w,"transform")){const{layout:A,layoutId:L}=f.options;window.MotionCancelOptimisedAnimation(w,"transform",Ws,!(A||L))}const{parent:S}=f;S&&!S.hasCheckedOptimisedAppear&&rM(S)}function sM({attachResizeListener:f,defaultParent:g,measureScroll:w,checkIsScrollRoot:S,resetTransform:A}){return class{constructor(N={},r=g?.()){this.id=vB++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(wB),this.nodes.forEach(AB),this.nodes.forEach(CB),this.nodes.forEach(TB)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=N,this.root=r?r.root||r:this,this.path=r?[...r.path,r]:[],this.parent=r,this.depth=r?r.depth+1:0;for(let F=0;F<this.path.length;F++)this.path[F].shouldResetTransform=!0;this.root===this&&(this.nodes=new aB)}addEventListener(N,r){return this.eventHandlers.has(N)||this.eventHandlers.set(N,new h1),this.eventHandlers.get(N).add(r)}notifyListeners(N,...r){const F=this.eventHandlers.get(N);F&&F.notify(...r)}hasListeners(N){return this.eventHandlers.has(N)}mount(N){if(this.instance)return;this.isSVG=xC(N)&&!pF(N),this.instance=N;const{layoutId:r,layout:F,visualElement:B}=this.options;if(B&&!B.current&&B.mount(N),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(F||r)&&(this.isLayoutDirty=!0),f){let $,ie=0;const re=()=>this.root.updateBlockedByResize=!1;Ws.read(()=>{ie=window.innerWidth}),f(N,()=>{const Te=window.innerWidth;Te!==ie&&(ie=Te,this.root.updateBlockedByResize=!0,$&&$(),$=oB(re,250),$v.hasAnimatedSinceResize&&($v.hasAnimatedSinceResize=!1,this.nodes.forEach(dE)))})}r&&this.root.registerSharedNode(r,this),this.options.animate!==!1&&B&&(r||F)&&this.addEventListener("didUpdate",({delta:$,hasLayoutChanged:ie,hasRelativeLayoutChanged:re,layout:Te})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const _e=this.options.transition||B.getDefaultTransition()||PB,{onLayoutAnimationStart:me,onLayoutAnimationComplete:ge}=B.getProps(),pe=!this.targetLayout||!nM(this.targetLayout,Te),fe=!ie&&re;if(this.options.layoutRoot||this.resumeFrom||fe||ie&&(pe||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const se={...S1(_e,"layout"),onPlay:me,onComplete:ge};(B.shouldReduceMotion||this.options.layoutRoot)&&(se.delay=0,se.type=!1),this.startAnimation(se),this.setAnimationOrigin($,fe)}else ie||dE(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=Te})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const N=this.getStack();N&&N.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),pp(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(MB),this.animationId++)}getTransformTemplate(){const{visualElement:N}=this.options;return N&&N.getProps().transformTemplate}willUpdate(N=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&rM(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let $=0;$<this.path.length;$++){const ie=this.path[$];ie.shouldResetTransform=!0,ie.updateScroll("snapshot"),ie.options.layoutRoot&&ie.willUpdate(!1)}const{layoutId:r,layout:F}=this.options;if(r===void 0&&!F)return;const B=this.getTransformTemplate();this.prevTransformTemplateValue=B?B(this.latestValues,""):void 0,this.updateSnapshot(),N&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(uE);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(hE);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(EB),this.nodes.forEach(xB),this.nodes.forEach(bB)):this.nodes.forEach(hE),this.clearAllSnapshots();const r=cc.now();zo.delta=lf(0,1e3/60,r-zo.timestamp),zo.timestamp=r,zo.isProcessing=!0,Gx.update.process(zo),Gx.preRender.process(zo),Gx.render.process(zo),zo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,A1.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(SB),this.sharedNodes.forEach(IB)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ws.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ws.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Rl(this.snapshot.measuredBox.x)&&!Rl(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let F=0;F<this.path.length;F++)this.path[F].updateScroll();const N=this.layout;this.layout=this.measure(!1),this.layoutCorrected=za(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:r}=this.options;r&&r.notify("LayoutMeasure",this.layout.layoutBox,N?N.layoutBox:void 0)}updateScroll(N="measure"){let r=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===N&&(r=!1),r&&this.instance){const F=S(this.instance);this.scroll={animationId:this.root.animationId,phase:N,isRoot:F,offset:w(this.instance),wasRoot:this.scroll?this.scroll.isRoot:F}}}resetTransform(){if(!A)return;const N=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,r=this.projectionDelta&&!iM(this.projectionDelta),F=this.getTransformTemplate(),B=F?F(this.latestValues,""):void 0,$=B!==this.prevTransformTemplateValue;N&&this.instance&&(r||Tm(this.latestValues)||$)&&(A(this.instance,B),this.shouldResetTransform=!1,this.scheduleRender())}measure(N=!0){const r=this.measurePageBox();let F=this.removeElementScroll(r);return N&&(F=this.removeTransform(F)),OB(F),{animationId:this.root.animationId,measuredBox:r,layoutBox:F,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:N}=this.options;if(!N)return za();const r=N.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(LB))){const{scroll:B}=this.root;B&&(Sg(r.x,B.offset.x),Sg(r.y,B.offset.y))}return r}removeElementScroll(N){const r=za();if(fu(r,N),this.scroll?.wasRoot)return r;for(let F=0;F<this.path.length;F++){const B=this.path[F],{scroll:$,options:ie}=B;B!==this.root&&$&&ie.layoutScroll&&($.wasRoot&&fu(r,N),Sg(r.x,$.offset.x),Sg(r.y,$.offset.y))}return r}applyTransform(N,r=!1){const F=za();fu(F,N);for(let B=0;B<this.path.length;B++){const $=this.path[B];!r&&$.options.layoutScroll&&$.scroll&&$!==$.root&&Eg(F,{x:-$.scroll.offset.x,y:-$.scroll.offset.y}),Tm($.latestValues)&&Eg(F,$.latestValues)}return Tm(this.latestValues)&&Eg(F,this.latestValues),F}removeTransform(N){const r=za();fu(r,N);for(let F=0;F<this.path.length;F++){const B=this.path[F];if(!B.instance||!Tm(B.latestValues))continue;Ib(B.latestValues)&&B.updateSnapshot();const $=za(),ie=B.measurePageBox();fu($,ie),rE(r,B.latestValues,B.snapshot?B.snapshot.layoutBox:void 0,$)}return Tm(this.latestValues)&&rE(r,this.latestValues),r}setTargetDelta(N){this.targetDelta=N,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(N){this.options={...this.options,...N,crossfade:N.crossfade!==void 0?N.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==zo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(N=!1){const r=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=r.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=r.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=r.isSharedProjectionDirty);const F=!!this.resumingFrom||this!==r;if(!(N||F&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:$,layoutId:ie}=this.options;if(!(!this.layout||!($||ie))){if(this.resolvedRelativeTargetAt=zo.timestamp,!this.targetDelta&&!this.relativeTarget){const re=this.getClosestProjectingParent();re&&re.layout&&this.animationProgress!==1?(this.relativeParent=re,this.forceRelativeParentToResolveTarget(),this.relativeTarget=za(),this.relativeTargetOrigin=za(),Y_(this.relativeTargetOrigin,this.layout.layoutBox,re.layout.layoutBox),fu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=za(),this.targetWithTransforms=za()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),j4(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):fu(this.target,this.layout.layoutBox),NC(this.target,this.targetDelta)):fu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const re=this.getClosestProjectingParent();re&&!!re.resumingFrom==!!this.resumingFrom&&!re.options.layoutScroll&&re.target&&this.animationProgress!==1?(this.relativeParent=re,this.forceRelativeParentToResolveTarget(),this.relativeTarget=za(),this.relativeTargetOrigin=za(),Y_(this.relativeTargetOrigin,this.target,re.target),fu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||Ib(this.parent.latestValues)||kC(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const N=this.getLead(),r=!!this.resumingFrom||this!==N;let F=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(F=!1),r&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(F=!1),this.resolvedRelativeTargetAt===zo.timestamp&&(F=!1),F)return;const{layout:B,layoutId:$}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(B||$))return;fu(this.layoutCorrected,this.layout.layoutBox);const ie=this.treeScale.x,re=this.treeScale.y;QF(this.layoutCorrected,this.treeScale,this.path,r),N.layout&&!N.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(N.target=N.layout.layoutBox,N.targetWithTransforms=za());const{target:Te}=N;if(!Te){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(tE(this.prevProjectionDelta.x,this.projectionDelta.x),tE(this.prevProjectionDelta.y,this.projectionDelta.y)),X_(this.projectionDelta,this.layoutCorrected,Te,this.latestValues),(this.treeScale.x!==ie||this.treeScale.y!==re||!cE(this.projectionDelta.x,this.prevProjectionDelta.x)||!cE(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",Te))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(N=!0){if(this.options.visualElement?.scheduleRender(),N){const r=this.getStack();r&&r.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ag(),this.projectionDelta=Ag(),this.projectionDeltaWithTransform=Ag()}setAnimationOrigin(N,r=!1){const F=this.snapshot,B=F?F.latestValues:{},$={...this.latestValues},ie=Ag();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!r;const re=za(),Te=F?F.source:void 0,_e=this.layout?this.layout.source:void 0,me=Te!==_e,ge=this.getStack(),pe=!ge||ge.members.length<=1,fe=!!(me&&!pe&&this.options.crossfade===!0&&!this.path.some(DB));this.animationProgress=0;let se;this.mixTargetDelta=De=>{const we=De/1e3;fE(ie.x,N.x,we),fE(ie.y,N.y,we),this.setTargetDelta(ie),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Y_(re,this.layout.layoutBox,this.relativeParent.layout.layoutBox),RB(this.relativeTarget,this.relativeTargetOrigin,re,we),se&&mB(this.relativeTarget,se)&&(this.isProjectionDirty=!1),se||(se=za()),fu(se,this.relativeTarget)),me&&(this.animationValues=$,cB($,B,this.latestValues,we,fe,pe)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=we},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(N){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(pp(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ws.update(()=>{$v.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Rg(0)),this.currentAnimation=rB(this.motionValue,[0,1e3],{...N,velocity:0,isSync:!0,onUpdate:r=>{this.mixTargetDelta(r),N.onUpdate&&N.onUpdate(r)},onStop:()=>{},onComplete:()=>{N.onComplete&&N.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const N=this.getStack();N&&N.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(yB),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const N=this.getLead();let{targetWithTransforms:r,target:F,layout:B,latestValues:$}=N;if(!(!r||!F||!B)){if(this!==N&&this.layout&&B&&aM(this.options.animationType,this.layout.layoutBox,B.layoutBox)){F=this.target||za();const ie=Rl(this.layout.layoutBox.x);F.x.min=N.target.x.min,F.x.max=F.x.min+ie;const re=Rl(this.layout.layoutBox.y);F.y.min=N.target.y.min,F.y.max=F.y.min+re}fu(r,F),Eg(r,$),X_(this.projectionDeltaWithTransform,this.layoutCorrected,r,$)}}registerSharedNode(N,r){this.sharedNodes.has(N)||this.sharedNodes.set(N,new gB),this.sharedNodes.get(N).add(r);const B=r.options.initialPromotionConfig;r.promote({transition:B?B.transition:void 0,preserveFollowOpacity:B&&B.shouldPreserveFollowOpacity?B.shouldPreserveFollowOpacity(r):void 0})}isLead(){const N=this.getStack();return N?N.lead===this:!0}getLead(){const{layoutId:N}=this.options;return N?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:N}=this.options;return N?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:N}=this.options;if(N)return this.root.sharedNodes.get(N)}promote({needsReset:N,transition:r,preserveFollowOpacity:F}={}){const B=this.getStack();B&&B.promote(this,F),N&&(this.projectionDelta=void 0,this.needsReset=!0),r&&this.setOptions({transition:r})}relegate(){const N=this.getStack();return N?N.relegate(this):!1}resetSkewAndRotation(){const{visualElement:N}=this.options;if(!N)return;let r=!1;const{latestValues:F}=N;if((F.z||F.rotate||F.rotateX||F.rotateY||F.rotateZ||F.skewX||F.skewY)&&(r=!0),!r)return;const B={};F.z&&tb("z",N,B,this.animationValues);for(let $=0;$<eb.length;$++)tb(`rotate${eb[$]}`,N,B,this.animationValues),tb(`skew${eb[$]}`,N,B,this.animationValues);N.render();for(const $ in B)N.setStaticValue($,B[$]),this.animationValues&&(this.animationValues[$]=B[$]);N.scheduleRender()}applyProjectionStyles(N,r){if(!this.instance||this.isSVG)return;if(!this.isVisible){N.visibility="hidden";return}const F=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,N.visibility="",N.opacity="",N.pointerEvents=qv(r?.pointerEvents)||"",N.transform=F?F(this.latestValues,""):"none";return}const B=this.getLead();if(!this.projectionDelta||!this.layout||!B.target){this.options.layoutId&&(N.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,N.pointerEvents=qv(r?.pointerEvents)||""),this.hasProjected&&!Tm(this.latestValues)&&(N.transform=F?F({},""):"none",this.hasProjected=!1);return}N.visibility="";const $=B.animationValues||B.latestValues;this.applyTransformsToTarget();let ie=_B(this.projectionDeltaWithTransform,this.treeScale,$);F&&(ie=F($,ie)),N.transform=ie;const{x:re,y:Te}=this.projectionDelta;N.transformOrigin=`${re.origin*100}% ${Te.origin*100}% 0`,B.animationValues?N.opacity=B===this?$.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:$.opacityExit:N.opacity=B===this?$.opacity!==void 0?$.opacity:"":$.opacityExit!==void 0?$.opacityExit:0;for(const _e in sy){if($[_e]===void 0)continue;const{correct:me,applyTo:ge,isCSSVariable:pe}=sy[_e],fe=ie==="none"?$[_e]:me($[_e],B);if(ge){const se=ge.length;for(let De=0;De<se;De++)N[ge[De]]=fe}else pe?this.options.visualElement.renderState.vars[_e]=fe:N[_e]=fe}this.options.layoutId&&(N.pointerEvents=B===this?qv(r?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(N=>N.currentAnimation?.stop()),this.root.nodes.forEach(uE),this.root.sharedNodes.clear()}}}function xB(f){f.updateLayout()}function bB(f){const g=f.resumeFrom?.snapshot||f.snapshot;if(f.isLead()&&f.layout&&g&&f.hasListeners("didUpdate")){const{layoutBox:w,measuredBox:S}=f.layout,{animationType:A}=f.options,L=g.source!==f.layout.source;A==="size"?pu($=>{const ie=L?g.measuredBox[$]:g.layoutBox[$],re=Rl(ie);ie.min=w[$].min,ie.max=ie.min+re}):aM(A,g.layoutBox,w)&&pu($=>{const ie=L?g.measuredBox[$]:g.layoutBox[$],re=Rl(w[$]);ie.max=ie.min+re,f.relativeTarget&&!f.currentAnimation&&(f.isProjectionDirty=!0,f.relativeTarget[$].max=f.relativeTarget[$].min+re)});const N=Ag();X_(N,w,g.layoutBox);const r=Ag();L?X_(r,f.applyTransform(S,!0),g.measuredBox):X_(r,w,g.layoutBox);const F=!iM(N);let B=!1;if(!f.resumeFrom){const $=f.getClosestProjectingParent();if($&&!$.resumeFrom){const{snapshot:ie,layout:re}=$;if(ie&&re){const Te=za();Y_(Te,g.layoutBox,ie.layoutBox);const _e=za();Y_(_e,w,re.layoutBox),nM(Te,_e)||(B=!0),$.options.layoutRoot&&(f.relativeTarget=_e,f.relativeTargetOrigin=Te,f.relativeParent=$)}}}f.notifyListeners("didUpdate",{layout:w,snapshot:g,delta:r,layoutDelta:N,hasLayoutChanged:F,hasRelativeLayoutChanged:B})}else if(f.isLead()){const{onExitComplete:w}=f.options;w&&w()}f.options.transition=void 0}function wB(f){f.parent&&(f.isProjecting()||(f.isProjectionDirty=f.parent.isProjectionDirty),f.isSharedProjectionDirty||(f.isSharedProjectionDirty=!!(f.isProjectionDirty||f.parent.isProjectionDirty||f.parent.isSharedProjectionDirty)),f.isTransformDirty||(f.isTransformDirty=f.parent.isTransformDirty))}function TB(f){f.isProjectionDirty=f.isSharedProjectionDirty=f.isTransformDirty=!1}function SB(f){f.clearSnapshot()}function uE(f){f.clearMeasurements()}function hE(f){f.isLayoutDirty=!1}function EB(f){const{visualElement:g}=f.options;g&&g.getProps().onBeforeLayoutMeasure&&g.notify("BeforeLayoutMeasure"),f.resetTransform()}function dE(f){f.finishAnimation(),f.targetDelta=f.relativeTarget=f.target=void 0,f.isProjectionDirty=!0}function AB(f){f.resolveTargetDelta()}function CB(f){f.calcProjection()}function MB(f){f.resetSkewAndRotation()}function IB(f){f.removeLeadSnapshot()}function fE(f,g,w){f.translate=sa(g.translate,0,w),f.scale=sa(g.scale,1,w),f.origin=g.origin,f.originPoint=g.originPoint}function pE(f,g,w,S){f.min=sa(g.min,w.min,S),f.max=sa(g.max,w.max,S)}function RB(f,g,w,S){pE(f.x,g.x,w.x,S),pE(f.y,g.y,w.y,S)}function DB(f){return f.animationValues&&f.animationValues.opacityExit!==void 0}const PB={duration:.45,ease:[.4,0,.1,1]},mE=f=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(f),gE=mE("applewebkit/")&&!mE("chrome/")?Math.round:mu;function _E(f){f.min=gE(f.min),f.max=gE(f.max)}function OB(f){_E(f.x),_E(f.y)}function aM(f,g,w){return f==="position"||f==="preserve-aspect"&&!B4(lE(g),lE(w),.2)}function LB(f){return f!==f.root&&f.scroll?.wasRoot}const zB=sM({attachResizeListener:(f,g)=>ay(f,"resize",g),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ib={current:void 0},oM=sM({measureScroll:f=>({x:f.scrollLeft,y:f.scrollTop}),defaultParent:()=>{if(!ib.current){const f=new zB({});f.mount(window),f.setOptions({layoutScroll:!0}),ib.current=f}return ib.current},resetTransform:(f,g)=>{f.style.transform=g!==void 0?g:"none"},checkIsScrollRoot:f=>window.getComputedStyle(f).position==="fixed"}),kB={pan:{Feature:eB},drag:{Feature:J4,ProjectionNode:oM,MeasureLayout:JC}};function yE(f,g,w){const{props:S}=f;f.animationState&&S.whileHover&&f.animationState.setActive("whileHover",w==="Start");const A="onHover"+w,L=S[A];L&&Ws.postRender(()=>L(g,py(g)))}class NB extends gp{mount(){const{current:g}=this.node;g&&(this.unmount=cF(g,(w,S)=>(yE(this.node,S,"Start"),A=>yE(this.node,A,"End"))))}unmount(){}}class FB extends gp{constructor(){super(...arguments),this.isActive=!1}onFocus(){let g=!1;try{g=this.node.current.matches(":focus-visible")}catch{g=!0}!g||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=hy(ay(this.node.current,"focus",()=>this.onFocus()),ay(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function vE(f,g,w){const{props:S}=f;if(f.current instanceof HTMLButtonElement&&f.current.disabled)return;f.animationState&&S.whileTap&&f.animationState.setActive("whileTap",w==="Start");const A="onTap"+(w==="End"?"":w),L=S[A];L&&Ws.postRender(()=>L(g,py(g)))}class BB extends gp{mount(){const{current:g}=this.node;g&&(this.unmount=fF(g,(w,S)=>(vE(this.node,S,"Start"),(A,{success:L})=>vE(this.node,A,L?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const kb=new WeakMap,nb=new WeakMap,jB=f=>{const g=kb.get(f.target);g&&g(f)},VB=f=>{f.forEach(jB)};function UB({root:f,...g}){const w=f||document;nb.has(w)||nb.set(w,{});const S=nb.get(w),A=JSON.stringify(g);return S[A]||(S[A]=new IntersectionObserver(VB,{root:f,...g})),S[A]}function GB(f,g,w){const S=UB(g);return kb.set(f,w),S.observe(f),()=>{kb.delete(f),S.unobserve(f)}}const HB={some:0,all:1};class qB extends gp{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:g={}}=this.node.getProps(),{root:w,margin:S,amount:A="some",once:L}=g,N={root:w?w.current:void 0,rootMargin:S,threshold:typeof A=="number"?A:HB[A]},r=F=>{const{isIntersecting:B}=F;if(this.isInView===B||(this.isInView=B,L&&!B&&this.hasEnteredView))return;B&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",B);const{onViewportEnter:$,onViewportLeave:ie}=this.node.getProps(),re=B?$:ie;re&&re(F)};return GB(this.node.current,N,r)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:g,prevProps:w}=this.node;["amount","margin","root"].some($B(g,w))&&this.startObserver()}unmount(){}}function $B({viewport:f={}},{viewport:g={}}={}){return w=>f[w]!==g[w]}const ZB={inView:{Feature:qB},tap:{Feature:BB},focus:{Feature:FB},hover:{Feature:NB}},WB={layout:{ProjectionNode:oM,MeasureLayout:JC}},XB={...O4,...ZB,...kB,...WB},Xh=XF(XB,l4),YB=()=>{const[f,g]=Re.useState(""),[w,S]=Re.useState(""),[A,L]=Re.useState(""),N=()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}navigator.geolocation.getCurrentPosition(B=>{const{latitude:$,longitude:ie,accuracy:re}=B.coords;S($.toFixed(6)),L(ie.toFixed(6)),sessionStorage.setItem("user_lat",$),sessionStorage.setItem("user_lng",ie),g(`Lat: ${$.toFixed(6)}, Lng: ${ie.toFixed(6)} (±${re} meters)`)},B=>{console.error("Location error:",B.message),alert("Unable to retrieve your location")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},r={hidden:{opacity:0,x:-100},visible:{opacity:1,x:0,transition:{duration:.6,when:"beforeChildren",staggerChildren:.2}}},F={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return Re.useEffect(()=>{N()},[]),W.jsxs("div",{className:"min-h-screen flex flex-col md:flex-row font-sans",children:[W.jsxs(Xh.div,{className:"md:w-1/2 bg-gradient-to-br from-orange-500 to-orange-600 text-white p-8 sm:p-12 flex flex-col justify-center",variants:r,initial:"hidden",animate:"visible",children:[W.jsx(Xh.h1,{className:"text-lg sm:text-xl font-bold text-gray-100 mb-2",variants:F,children:"FOODYAH"}),W.jsx(Xh.h2,{className:"text-3xl sm:text-4xl lg:text-5xl font-bold mb-4",variants:F,children:"Welcome to FoodYah!"}),W.jsxs(Xh.p,{className:"text-base sm:text-lg mb-8",variants:F,children:["Order from multiple restaurants in one single order.",W.jsx("br",{}),"Use code: ",W.jsx("strong",{children:"ES50"})," to get ",W.jsx("strong",{children:"FLAT 50% OFF"})," ","on your 1st order."]}),W.jsx(Xh.div,{className:"flex flex-col sm:flex-row items-center space-y-3 sm:space-y-0 sm:space-x-4",variants:F,children:W.jsx(lc,{to:"/foods-corner",children:W.jsx("button",{className:"bg-yellow-400 hover:bg-yellow-300 text-black px-4 py-2 rounded font-semibold transition duration-200",children:"Order Now"})})})]}),W.jsx(Xh.div,{className:"md:w-1/2 relative bg-cover bg-center",style:{backgroundImage:"url('/bg.png')"},initial:{opacity:0,x:100},animate:{opacity:1,x:0},transition:{duration:.5},children:W.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-60 flex flex-col justify-center items-center text-center text-white px-6 sm:px-12 py-10",children:[W.jsx(Xh.h2,{className:"text-3xl sm:text-4xl font-bold mb-2",initial:{scale:.8},animate:{scale:1},transition:{delay:.3},children:"FLAT ₹150 OFF"}),W.jsx("p",{className:"text-base sm:text-lg mb-2",children:"on First 3 Orders"}),W.jsx("div",{className:"bg-white text-orange-700 px-4 py-1 rounded font-bold inline-block mb-6",children:"Code: FOODCOURT"}),W.jsx(Xh.div,{className:"grid grid-cols-3 gap-3 w-full max-w-sm sm:max-w-md",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:["/behrouz.png","/faasos.png","/ovenstory.png","/wendys.png","/goodbowl.png"].map((B,$)=>W.jsx(Xh.img,{src:B,alt:"",className:"rounded-lg w-full hover:scale-105 transition-transform duration-300",whileHover:{scale:1.1}},$))}),W.jsx("p",{className:"text-sm mt-6 italic",children:"*T&C Apply"}),W.jsx("p",{className:"text-xs mt-2",children:"4.3+ rated app • 10M+ downloads • Available in 70+ cities"})]})})]})},KB=()=>{const[f,g]=Re.useState([]),w=gu(),S=sessionStorage.getItem("user_lat"),A=sessionStorage.getItem("user_lng");console.log(S),Re.useEffect(()=>{fetch(`/api/restaurant/data/${S}/${A}`).then(r=>r.json()).then(g).catch(r=>console.error("Fetch error:",r))},[S,A]);const L=r=>`/api/file/${r}`,N=r=>{w(`/menu-listing/${r._id}/menu`,{state:{restaurant:r}})};return W.jsx("div",{className:" bg-white p-2 sm:p-4",children:W.jsxs("div",{className:"max-w-7xl mx-auto",children:[W.jsx("h4",{className:"text-2xl font-bold text-center text-gray-900 mb-5",children:W.jsxs("span",{className:"text-red-500 inline-flex items-center",children:[W.jsx($z,{})," Top Restaurants"]})}),W.jsx("div",{className:"flex space-x-6 overflow-x-auto mb-10 hide-scrollbar bg-gray-100 rounded-2xl p-4",children:f.success!==!1?f?.map(r=>W.jsx("div",{onClick:()=>N(r),className:"flex flex-col items-center cursor-pointer transition-transform hover:scale-105",children:W.jsx("img",{loading:"lazy",src:r.logo_images?.[0]?L(r.logo_images[0]):"",alt:r.name,className:"m-2 w-16 h-16 rounded-full border-2 border-red-400 object-cover shadow-md"})},r._id)):W.jsx("div",{children:W.jsx("p",{className:"text-sm text-red-600 bg-red-100 border border-red-300 px-4 py-2 rounded-md mb-2",children:"There is no restaurants available in this place."})})}),W.jsx("h4",{className:"text-2xl font-bold text-center text-gray-900 mb-5",children:W.jsx("div",{className:"flex justify-end mt-6",children:W.jsx(lc,{to:"/explore-all-restaurants",children:W.jsx("button",{className:`px-6 py-2 text-sm rounded-full font-semibold tracking-wide uppercase 
              text-black cursor-pointer
               border border-[#616467] hover:bg-[#616467] hover:text-white 
               transition duration-300 shadow-[inset_0_0_0_1.5px_#616467]`,children:"Explore all restaurants"})})})}),W.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 mb-12",children:f.success!==!1?f.map(r=>W.jsxs(Xh.div,{layout:!0,onClick:()=>N(r),className:"bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition cursor-pointer",children:[W.jsx("img",{loading:"lazy",src:r.theme_images?.[0]?L(r.theme_images[0]):"",alt:r.name,className:"w-full h-48 object-cover rounded-t-2xl"}),W.jsxs("div",{className:"p-4",children:[W.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-1",children:r.name}),W.jsxs("p",{className:"text-sm text-gray-500",children:[r.address?.line1,", ",r.address?.city]}),W.jsxs("div",{className:"mt-3 px-3 py-1 bg-red-100 text-red-600 text-xs rounded-full inline-block font-medium",children:["🎉 50% OFF with code"," ",W.jsx("span",{className:"font-bold",children:"FIRSTTIME"})]})]})]},r._id)):""})]})})},QB=()=>{const{state:f}=Nc(),g=f?.restaurant,[w,S]=Re.useState([]),[A,L]=Re.useState({}),[N,r]=Re.useState("All"),[F,B]=Re.useState("All");Re.useEffect(()=>{g?._id&&fetch(`/api/menu/restaurant/${g._id}`).then(se=>se.json()).then(se=>S(se?.data||[])).catch(se=>{console.error("Failed to fetch menu items:",se),S([])})},[g]);const $=Re.useMemo(()=>{const se=new Set(w.map(De=>De.category||"Uncategorized"));return["All",...Array.from(se)]},[w]),ie=Re.useMemo(()=>w.filter(se=>{const De=N==="All"||se.type?.toLowerCase()===N.toLowerCase(),we=F==="All"||se.category===F;return De&&we}),[w,N,F]),re=Re.useMemo(()=>Object.values(A).reduce((se,De)=>se+De,0),[A]),Te=Re.useMemo(()=>w.reduce((se,De)=>{const we=A[De._id]||0;return se+De.price*we},0),[A,w]),_e=se=>`/api/file/menu-image/${se}`,me=se=>L(De=>({...De,[se]:(De[se]||0)+1})),ge=se=>L(De=>{const we={...De};return we[se]>1?we[se]--:delete we[se],we}),pe={All:"bg-blue-600 text-white hover:bg-blue-700",Veg:"bg-green-600 text-white hover:bg-green-700","Non-Veg":"bg-red-600 text-white hover:bg-red-700"},fe="bg-white text-gray-800 border hover:bg-gray-100 cursor-pointer";return W.jsxs("div",{className:"bg-gray-100 h-screen overflow-hidden",children:[W.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col lg:flex-row gap-8 h-full px-4 py-6",children:[W.jsxs("div",{className:"lg:w-1/4 w-full lg:sticky lg:top-6 self-start h-fit",children:[W.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-4",children:"🍴 Categories"}),W.jsx("div",{className:"space-y-2",children:$.map(se=>W.jsx("button",{onClick:()=>B(se),className:`w-full text-left px-4 py-2 rounded-lg transition ${F===se?"bg-red-500 text-white font-semibold":"bg-white text-gray-800 hover:bg-gray-100"}`,children:se},se))})]}),W.jsxs("div",{className:"lg:w-3/4 w-full h-full overflow-y-auto pr-2",children:[W.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:["🍽️ Meals at"," ",W.jsx("span",{className:"text-red-700",children:g?.name||"..."})]}),W.jsx("div",{className:"flex flex-wrap gap-3 mb-6",children:["All","Veg","Non-Veg"].map(se=>W.jsx("button",{onClick:()=>r(se),className:`px-4 py-1 rounded-full text-sm font-semibold transition duration-200 ${N===se?pe[se]:fe}`,children:se},se))}),ie.length===0?W.jsx("p",{className:"text-gray-500 text-center",children:"No menu items found."}):W.jsx("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-4 pb-24",children:ie.map(se=>W.jsxs("div",{className:"bg-white rounded-xl shadow hover:shadow-md transition overflow-hidden",children:[W.jsx("img",{src:se.image?_e(se.image):"https://via.placeholder.com/300x200?text=No+Image",alt:se.name,className:"w-full h-48 object-cover"}),W.jsxs("div",{className:"p-4 flex flex-col gap-2",children:[W.jsxs("div",{className:"flex justify-between items-start",children:[W.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:se.name}),W.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${se.type==="Veg"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:se.type})]}),W.jsx("p",{className:"text-gray-500 text-sm line-clamp-2",children:se.description}),W.jsxs("div",{className:"flex justify-between items-center mt-2",children:[W.jsxs("span",{className:"text-md font-bold text-red-500",children:["₹",se.price]}),W.jsx("div",{className:"flex items-center gap-2",children:A[se._id]?W.jsxs(W.Fragment,{children:[W.jsx("button",{onClick:()=>ge(se._id),className:"px-2 py-1 bg-gray-200 rounded hover:bg-gray-300",children:"−"}),W.jsx("span",{className:"font-semibold text-gray-800",children:A[se._id]}),W.jsx("button",{onClick:()=>me(se._id),className:"px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600",children:"+"})]}):W.jsx("button",{onClick:()=>me(se._id),className:"px-4 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600",children:"Add"})})]})]})]},se._id))})]})]}),re>0&&W.jsxs("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-200 shadow-lg border border-gray-200 rounded-full px-6 py-3 flex items-center justify-between gap-8 z-50",children:[W.jsxs("span",{className:"font-semibold text-gray-800 text-sm",children:["🛒 ",re," item",re>1?"s":""]}),W.jsxs("span",{className:"font-bold text-orange-600 text-md",children:["Total: ₹",Te]}),W.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Checkout"})]})]})},rb="/api/menu",JB=()=>{const[f,g]=Re.useState([]),[w,S]=Re.useState(""),A=async()=>{const r=await fetch(`${rb}/get-category`),{data:F}=await r.json();g(F)},L=async r=>{if(r.preventDefault(),!w.trim())return;await(await fetch(`${rb}/add-category`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:w})})).json(),S(""),A()},N=async r=>{confirm("Are you sure you want to delete this category?")&&(await fetch(`${rb}/delete-category/${r}`,{method:"DELETE"}),A())};return Re.useEffect(()=>{A()},[]),W.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[W.jsx("h1",{className:"text-3xl font-extrabold text-gray-800 mb-6 text-center",children:"🍽️ Food Category Dashboard"}),W.jsxs("form",{onSubmit:L,className:"flex flex-col sm:flex-row gap-4 mb-8 justify-center items-center",children:[W.jsx("input",{type:"text",placeholder:"Enter new category name",value:w,onChange:r=>S(r.target.value),className:"w-full sm:w-1/2 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),W.jsx("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg transition",children:"Add Category"})]}),f.length===0?W.jsx("p",{className:"text-center text-gray-500",children:"No categories found."}):W.jsx("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5",children:f.map(r=>W.jsxs("div",{className:"bg-white border border-gray-200 shadow-md rounded-xl p-4 flex justify-between items-center hover:shadow-lg transition",children:[W.jsx("span",{className:"font-medium text-gray-700",children:r.name}),W.jsx("button",{onClick:()=>N(r._id),className:"text-red-500 hover:text-red-700 font-semibold",title:"Delete category",children:"✕"})]},r._id))})]})},e5=()=>{const[f,g]=Re.useState([]),[w,S]=Re.useState(1),[A,L]=Re.useState(!0),[N,r]=Re.useState(!1),[F,B]=Re.useState(null),[$,ie]=Re.useState(""),[re,Te]=Re.useState([]),_e=Re.useRef(null),me=Re.useRef(null),ge=Re.useRef(null),pe=gu(),fe=sessionStorage.getItem("user_lat"),se=sessionStorage.getItem("user_lng"),De=async je=>{r(!0);try{const It=await(await fetch(`/api/restaurant/lazy/${fe}/${se}/?page=${je}`)).json();if(It.success)g(Lt=>{const ct=new Set(Lt.map(Qe=>Qe._id)),Et=It.data.filter(Qe=>!ct.has(Qe._id));return[...Lt,...Et]}),L(It.hasMore);else throw new Error(It.message||"Failed to load restaurants")}catch($e){console.error("Error:",$e),B("Something went wrong while loading.")}finally{r(!1)}};Re.useEffect(()=>{De(w)},[w]);const we=Re.useCallback(()=>{me.current&&me.current.disconnect(),me.current=new IntersectionObserver(je=>{je[0].isIntersecting&&A&&!N&&S(It=>It+1)}),ge.current&&me.current.observe(ge.current)},[A,N]);Re.useEffect(()=>(we(),()=>me.current?.disconnect()),[we]);const ht=je=>`/api/file/${je}`,At=je=>{pe(`/menu-listing/${je._id}/menu`,{state:{restaurant:je}})},gt=je=>{const $e=je.target.value;ie($e),_e.current&&clearTimeout(_e.current),_e.current=setTimeout(()=>{if(!$e.trim())return Te([]);fetch(`/api/search/suggestions?q=${$e}`).then(It=>It.json()).then(It=>Te(It.suggestions||[])).catch(()=>Te([]))},300)},Xe=je=>{console.log(je),je.type==="restaurant"?pe(`/menu-listing/${je._id}/menu`,{state:{restaurant:{_id:je._id,name:je.name}}}):je.type==="menu"&&pe(`/menu-listing/${je.restaurantId}/menu`,{state:{fromSearch:!0,highlightedMenu:je.name,restaurant:{_id:je.restaurantId,name:je.restaurant}}}),Te([]),ie("")};return console.log(re),W.jsx("div",{className:"min-h-screen bg-gray-100 p-6",children:W.jsxs("div",{className:"max-w-7xl mx-auto",children:[W.jsx("h1",{className:"text-3xl font-bold mb-6 text-gray-800",children:"🍽️ All Restaurants"}),W.jsxs("div",{className:"mb-6 relative",children:[W.jsx("input",{type:"text",placeholder:"🔍 Search restaurants or menu...",value:$,onChange:gt,className:"w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400"}),re.length>0&&W.jsx("ul",{className:"absolute left-0 right-0 bg-white border border-gray-200 mt-1 rounded-lg shadow z-50 max-h-60 overflow-auto",children:re.map((je,$e)=>W.jsx("li",{className:"p-3 hover:bg-gray-100 cursor-pointer text-sm",onClick:()=>Xe(je),children:je.type==="restaurant"?W.jsxs("span",{children:["🍴 ",W.jsx("strong",{children:je.name})," (Restaurant)"]}):W.jsxs("span",{children:["🥘 ",W.jsx("strong",{children:je.name})," from"," ",W.jsx("em",{children:je.restaurant})]})},$e))})]}),W.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-6 bg-white p-2 pb-4 pt-4 rounded",children:f.map(je=>W.jsxs("div",{className:"bg-white p-4 rounded-lg shadow hover:shadow-md transition cursor-pointer",onClick:()=>At(je),children:[W.jsx("img",{loading:"lazy",src:je.theme_images?.[0]?ht(je.theme_images[0]):"",alt:je.name,className:"w-full h-48 object-cover rounded-t-2xl"}),W.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:je.name}),W.jsx("p",{className:"text-sm text-gray-600",children:je.email}),W.jsx("p",{className:"text-sm text-gray-600",children:je.phone}),W.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Cuisine: ",je.cuisine_types]})]},je._id))}),W.jsx("div",{ref:ge,className:"h-10 mt-4"}),N&&W.jsx("div",{className:"mt-6 text-center text-blue-500 font-medium",children:"Loading more..."}),!A&&!N&&W.jsx("div",{className:"mt-6 text-center text-gray-500",children:"🎉 You’ve reached the end!"}),F&&W.jsx("div",{className:"mt-6 text-center text-red-500 font-medium",children:F})]})})},t5="/api/auth/getUserData",i5=()=>{const{user:f}=Im(),g="admin@gmail.com",[w,S]=Re.useState([]),[A,L]=Re.useState(""),[N,r]=Re.useState(1),[F,B]=Re.useState(1),[$,ie]=Re.useState(!1),[re,Te]=Re.useState({name:"",email:"",phone:"",password:""}),_e=async()=>{const ge=await fetch(`${t5}?search=${A}&page=${N}&limit=10`),{data:pe,totalPages:fe}=await ge.json();S(pe),B(fe)},me=async(ge,pe)=>{if(window.confirm("Are you sure you want to delete this user?"))try{(await fetch(`/api/auth/deleteUser/${ge}/${pe}`,{method:"DELETE"})).ok?S(De=>De.filter(we=>we._id!==ge)):console.error("Failed to delete user")}catch(se){console.error("Error:",se)}};return Re.useEffect(()=>{_e()},[A,N]),W.jsxs("div",{className:"p-6 space-y-6",children:[W.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Users List"}),W.jsx("input",{type:"text",placeholder:"Search by name or location...",className:"w-full md:w-1/3 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:A,onChange:ge=>{L(ge.target.value),r(1)}}),W.jsx("div",{className:"flex justify-end",children:f?.email===g?W.jsx("button",{onClick:()=>ie(!0),className:"px-4 py-2 mb-4 bg-green-600 text-white rounded hover:bg-green-700",children:"Add Admin"}):""}),W.jsx("div",{className:"overflow-x-auto shadow rounded-lg border border-gray-200",children:W.jsxs("table",{className:"min-w-full divide-y divide-gray-200 bg-white",children:[W.jsx("thead",{className:"bg-gray-100",children:W.jsxs("tr",{className:"text-center",children:[W.jsx("th",{className:"px-6 py-3 text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Name"}),W.jsx("th",{className:"px-6 py-3 text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Email"}),W.jsx("th",{className:"px-6 py-3 text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Phone No"}),W.jsx("th",{className:"px-6 py-3 text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Role"}),W.jsx("th",{className:"px-6 py-3 text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Action"})]})}),W.jsx("tbody",{className:"divide-y divide-gray-200",children:w.map(ge=>W.jsxs("tr",{className:"hover:bg-gray-50 transition duration-150 text-center",children:[W.jsx("td",{className:"px-6 py-4 text-sm text-gray-800",children:ge.name}),W.jsx("td",{className:"px-6 py-4 text-sm text-gray-800",children:ge.email}),W.jsx("td",{className:"px-6 py-4 text-sm text-gray-800",children:ge.phone}),W.jsx("td",{className:`px-6 py-4 text-sm text-gray-800 ${ge.role==="admin"?"bg-yellow-300":ge.role==="user"?"bg-green-300":ge.role==="restaurant"?"bg-orange-300":ge.role==="delivery"?"bg-red-300":""}`,children:ge.role}),W.jsx("td",{className:"px-6 py-4",children:ge.email===g||ge.email===f?.email?"":W.jsx("button",{onClick:()=>me(ge._id,ge.role),className:"px-4 py-2 text-sm bg-red-600 text-white rounded-md hover:bg-red-700 transition cursor-pointer",children:"Delete"})})]},ge._id))})]})}),W.jsxs("div",{className:"flex justify-center items-center gap-2",children:[W.jsx("button",{onClick:()=>r(ge=>ge-1),disabled:N===1,className:"px-3 py-1 text-sm border border-gray-300 rounded-md disabled:opacity-50 hover:bg-gray-100",children:"Prev"}),[...Array(F)].map((ge,pe)=>W.jsx("button",{onClick:()=>r(pe+1),className:`px-3 py-1 text-sm border rounded-md ${N===pe+1?"bg-blue-500 text-white border-blue-500":"border-gray-300 hover:bg-gray-100"}`,children:pe+1},pe)),W.jsx("button",{onClick:()=>r(ge=>ge+1),disabled:N===F,className:"px-3 py-1 text-sm border border-gray-300 rounded-md disabled:opacity-50 hover:bg-gray-100",children:"Next"})]}),$&&W.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex justify-center items-center z-50",children:W.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md space-y-4",children:[W.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Add New Admin"}),W.jsx("input",{type:"text",placeholder:"Name",value:re.name,onChange:ge=>Te({...re,name:ge.target.value}),className:"w-full border border-gray-300 px-4 py-2 rounded"}),W.jsx("input",{type:"email",placeholder:"Email",value:re.email,onChange:ge=>Te({...re,email:ge.target.value}),className:"w-full border border-gray-300 px-4 py-2 rounded"}),W.jsx("input",{type:"text",placeholder:"Phone",value:re.phone,onChange:ge=>Te({...re,phone:ge.target.value}),className:"w-full border border-gray-300 px-4 py-2 rounded"}),W.jsxs("div",{className:"flex justify-end gap-2",children:[W.jsx("button",{onClick:()=>ie(!1),className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",children:"Cancel"}),W.jsx("button",{onClick:async()=>{try{(await fetch("/api/auth/addAdminUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...re,role:"admin"})})).ok?(ie(!1),Te({name:"",email:"",phone:""}),_e()):alert("Failed to add admin")}catch(ge){console.error(ge),alert("Server error")}},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Add Admin"})]})]})})]})},n5=()=>{const{user:f}=Im(),[g,w]=Re.useState({lng:77.5946,lat:12.9716}),[S,A]=Re.useState(""),[L,N]=Re.useState([]),[r,F]=Re.useState(!1),[B,$]=Re.useState({label:"Home",addressLine:"",city:"",pincode:"",state:"",country:""}),ie=async()=>{try{const ge=await fetch(`/api/map/getAddress/${f.id}`),pe=await ge.json();ge.ok&&N(pe)}catch(ge){console.error("Failed to load addresses",ge)}};Re.useEffect(()=>{f?.id&&ie()},[f]);const re=ge=>{$({...B,[ge.target.name]:ge.target.value})},Te=async()=>{if(!S)return alert("Select a valid address.");const ge={...B,addressLine:B.addressLine||S,id:f.id,isDefault:L.length===0,location:{type:"Point",coordinates:[g.lng,g.lat]}};try{const pe=await fetch("/api/map/address",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ge)}),fe=await pe.json();pe.ok?(ie(),F(!1),alert("Address saved!")):alert(fe.message||"Save failed.")}catch(pe){console.error("Save error",pe),alert("Save failed.")}},_e=async ge=>{if(confirm("Delete this address?"))try{(await fetch(`/api/map/address/${f.id}/${ge}`,{method:"DELETE"})).ok&&(ie(),alert("Deleted!"))}catch(pe){console.error("Delete error",pe)}},me=async ge=>{try{(await fetch(`/api/map/address/${f.id}/${ge}/default`,{method:"PUT"})).ok&&(ie(),alert("Default address updated!"))}catch(pe){console.error("Set default error",pe)}};return W.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6 space-y-6",children:[W.jsxs("div",{className:"bg-white shadow rounded-xl p-6 space-y-4",children:[W.jsx("h2",{className:"text-2xl font-bold mb-4",children:"📍 Your Addresses"}),L.length?W.jsx("ul",{className:"space-y-4",children:L.map(ge=>W.jsxs("li",{className:"p-4 rounded-lg border bg-gray-50 flex flex-col sm:flex-row justify-between gap-4",children:[W.jsxs("div",{children:[W.jsxs("p",{className:"font-semibold text-lg",children:[ge.label,ge.isDefault&&W.jsx("span",{className:"ml-2 text-sm text-blue-600",children:"⭐ Default"})]}),W.jsx("p",{className:"text-sm",children:ge.addressLine}),W.jsxs("p",{className:"text-xs text-gray-500",children:[ge.city,", ",ge.pincode,", ",ge.state,", ",ge.country]})]}),W.jsxs("div",{className:"flex gap-2 items-center",children:[!ge.isDefault&&W.jsx("button",{onClick:()=>me(ge._id),className:"text-sm bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600",children:"⭐ Make Default"}),W.jsx("button",{onClick:()=>_e(ge._id),className:"text-sm bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600",children:"🗑 Delete"})]})]},ge._id))}):W.jsx("p",{className:"text-gray-500",children:"No addresses saved yet."}),W.jsx("button",{onClick:()=>F(!0),className:"mt-4 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700",children:"➕ Add Address"})]}),r&&W.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:W.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl w-full space-y-6 relative",children:[W.jsx("button",{onClick:()=>F(!1),className:"absolute top-2 right-3 text-xl text-gray-500 hover:text-black",children:"✖"}),W.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[W.jsxs("select",{name:"label",value:B.label,onChange:re,className:"border px-3 py-2 rounded-lg",children:[W.jsx("option",{value:"Home",children:"🏠 Home"}),W.jsx("option",{value:"Work",children:"🏢 Work"}),W.jsx("option",{value:"Other",children:"📦 Other"})]}),W.jsx("input",{name:"addressLine",placeholder:"Address Line",value:B.addressLine,onChange:re,className:"border px-3 py-2 rounded-lg"}),W.jsx("input",{name:"city",placeholder:"City",value:B.city,onChange:re,className:"border px-3 py-2 rounded-lg"}),W.jsx("input",{name:"pincode",placeholder:"Pincode",value:B.pincode,onChange:re,className:"border px-3 py-2 rounded-lg"})]}),W.jsx(IA,{initialCoords:g,onAddressSelect:(ge,pe,fe,se)=>{w({lng:ge,lat:pe}),A(fe),$(De=>({...De,addressLine:De.addressLine||fe,state:se.state||De.state,country:se.country||De.country}))}}),W.jsxs("div",{className:"flex justify-between items-center",children:[W.jsxs("p",{className:"text-sm text-gray-700",children:[W.jsx("strong",{children:"📍 Address:"})," ",S||"Not selected"]}),W.jsx("button",{onClick:Te,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700",children:"💾 Save"})]})]})})]})},wm=({children:f})=>{const[g,w]=Re.useState(!1);return W.jsxs("div",{className:"flex",children:[W.jsx(ak,{isOpen:g,onClose:()=>w(!1)}),g&&W.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 z-40 md:hidden",onClick:()=>w(!1)}),W.jsxs("div",{className:"flex-1 flex flex-col bg-gray-50 min-h-screen",children:[W.jsx(ok,{onToggleSidebar:()=>w(!0)}),W.jsx("main",{className:"p-1 flex-1",children:f})]})]})},sb=({children:f})=>W.jsx("div",{className:"flex",children:W.jsxs("div",{className:"flex-1 flex flex-col bg-gray-50 min-h-screen",children:[W.jsx(lk,{}),W.jsx("main",{className:"p-1 flex-1",children:f})]})});function r5(){return W.jsx(JD,{children:W.jsxs(RD,{children:[W.jsx(fo,{path:"/",element:W.jsx(jP,{})}),W.jsx(fo,{path:"/Login",element:W.jsx(hP,{})}),W.jsx(fo,{path:"/user-login",element:W.jsx(pk,{})}),W.jsx(fo,{path:"/admin-login",element:W.jsx(ck,{})}),W.jsx(fo,{path:"/register",element:W.jsx(dP,{})}),W.jsx(fo,{path:"/restaurant-register",element:W.jsx(mk,{})}),W.jsx(fo,{path:"/restaurant-partner",element:W.jsx(NP,{})}),W.jsx(fo,{path:"/explore-foods",element:W.jsx(YB,{})}),W.jsx(fo,{path:"/foods-corner",element:W.jsx(sb,{children:W.jsx(KB,{})})}),W.jsx(fo,{path:"/explore-all-restaurants",element:W.jsx(sb,{children:W.jsx(e5,{})})}),W.jsx(fo,{path:"/menu-listing/:id/menu",element:W.jsx(sb,{children:W.jsx(QB,{})})}),W.jsx(fo,{path:"/admin",element:W.jsx(vm,{allowedRoles:["admin"],children:W.jsx(wm,{children:W.jsx(BP,{})})})}),W.jsx(fo,{path:"/user-management",element:W.jsx(vm,{allowedRoles:["admin"],children:W.jsx(wm,{children:W.jsx(i5,{})})})}),W.jsx(fo,{path:"/food-category",element:W.jsx(vm,{allowedRoles:["admin"],children:W.jsx(wm,{children:W.jsx(JB,{})})})}),W.jsx(fo,{path:"/admin/verify/:id",element:W.jsx(vm,{allowedRoles:["admin"],children:W.jsx(wm,{children:W.jsx(_k,{})})})}),W.jsx(fo,{path:"/restaurant-onboard",element:W.jsx(vm,{allowedRoles:["restaurant"],children:W.jsx(wm,{children:W.jsx(Nz,{})})})}),W.jsx(fo,{path:"/address-registration",element:W.jsx(vm,{allowedRoles:["user"],children:W.jsx(wm,{children:W.jsx(n5,{})})})}),W.jsx(fo,{path:"/user-dashboard",element:W.jsx(vm,{allowedRoles:["user"],children:W.jsx(wm,{children:W.jsx(fk,{})})})})]})})}BR.createRoot(document.getElementById("root")).render(W.jsx(Re.StrictMode,{children:W.jsx(uP,{children:W.jsx(r5,{})})}));
